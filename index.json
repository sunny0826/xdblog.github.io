[{"authors":["admin","éƒ­æ—­ä¸œ"],"categories":null,"content":" éƒ­æ—­ä¸œï¼Œ2018å¹´4æœˆåŠ å…¥å‡¯äº¬ç§‘æŠ€ã€‚æ›¾ä»»é«˜çº§ç ”å‘å’Œè¿ç»´å¼€å‘å·¥ç¨‹å¸ˆã€é˜¿é‡Œäº‘MVPã€CCF ä¼šå‘˜ï¼Œç°ä»»å‡¯äº¬ç§‘æŠ€ç ”å‘ä¸­å¿ƒæŠ€æœ¯æ”¯æŒéƒ¨è¿ç»´è´Ÿè´£äººï¼Œè´Ÿè´£å…¬å¸è¿ç»´å›¢é˜Ÿå»ºè®¾ã€‚çƒ­çˆ±å¼€æºï¼Œä¹äºåˆ†äº«ï¼Œè‡´åŠ›äºæ¨è¡Œdevopsç†å¿µåŠç›¸å…³æŠ€æœ¯ï¼Œæå‡å¼€å‘æ•ˆç‡ï¼Œæé«˜äº¤ä»˜è´¨é‡ä¸é€Ÿåº¦ï¼Œç›®å‰ä¸“æ³¨äºäº‘åŸç”Ÿåº”ç”¨çš„å®è·µï¼Œå¹¶æ¢ç´¢æ›´é«˜æ•ˆçš„è¿ç»´ç³»ç»Ÿæ¶æ„ã€‚\nå…³äºæˆ‘ä»¬ å‡¯äº¬ç§‘æŠ€è‡´åŠ›äºæ¨åŠ¨ç‰©æµè¡Œä¸šçš„æ•°å­—åŒ–å’Œæ™ºæ…§åŒ–ï¼Œä¸ºå°å¾®ç‰©æµä¼ä¸šå’Œè½¦ä¸»æä¾›çº¿ä¸ŠåŒ–çš„å¼€æ”¾å¹³å°ï¼Œæ¢ç´¢è§£å†³ç‰©æµè¡Œä¸šè¿è¾“æˆæœ¬é«˜ã€èèµ„é—¨æ§›é«˜ç­‰ç—›ç‚¹ï¼Œä¸ºç‰©æµè¡Œä¸šé™æœ¬å¢æ•ˆã€‚ å‡¯äº¬ç§‘æŠ€æ‹¥æœ‰èš‚èšé‡‘æœã€çº¢æ‰èµ„æœ¬ã€ä¸­èˆªä¿¡æ‰˜ã€å¾·é‚¦è¯åˆ¸ç­‰çŸ¥åè‚¡ä¸œã€‚å‡¯äº¬ç§‘æŠ€è”åˆä¼˜è´¨è‚¡ä¸œèµ„æºï¼Œå…±åŒæ‰“é€ æœ€æ‡‚å°å¾®ç‰©æµä¼ä¸šå’Œè½¦ä¸»çš„æ•°æ®ã€ç§‘æŠ€å’Œæ™®æƒ é‡‘èæœåŠ¡ï¼Œé€šè¿‡å‡¯äº¬ç‰©æµäº‘çº¿ä¸ŠåŒ–å¹³å°ï¼Œå°†å¹¿å¤§ç‰©æµäººæ—¥å¸¸ç»è¥æ‰€éœ€çš„è´§ç‰©è¿è¾“ç®¡ç†ã€è½¦è¾†ç®¡ç†ã€èµ„é‡‘ç»“ç®—ç®¡ç†ã€é‡‘èæœåŠ¡ç®¡ç†ç­‰å…¨é¢çº¿ä¸ŠåŒ–ã€æ•°å­—åŒ–ï¼Œè®©ç‰©æµäººç”Ÿæ„æ›´å¥½åšã€‚\n","date":1581911499,"expirydate":-62135596800,"kind":"taxonomy","lang":"zh","lastmod":1581911499,"objectID":"cd54ffc1a2f3316b02c71b69207ea6f1","permalink":"https://guoxudong.io/authors/guoxudong/","publishdate":"0001-01-01T00:00:00Z","relpermalink":"/authors/guoxudong/","section":"authors","summary":"éƒ­æ—­ä¸œï¼Œ2018å¹´4æœˆåŠ å…¥å‡¯äº¬ç§‘æŠ€ã€‚æ›¾ä»»é«˜çº§ç ”å‘å’Œè¿ç»´å¼€å‘å·¥ç¨‹å¸ˆã€é˜¿é‡Œäº‘MVPã€CCF ä¼šå‘˜ï¼Œç°ä»»å‡¯äº¬ç§‘æŠ€ç ”å‘ä¸­å¿ƒæŠ€æœ¯æ”¯æŒéƒ¨è¿ç»´è´Ÿè´£äººï¼Œè´Ÿè´£å…¬","tags":null,"title":"éƒ­æ—­ä¸œ","type":"authors"},{"authors":["admin"],"categories":null,"content":" éƒ­æ—­ä¸œï¼Œ2018å¹´4æœˆåŠ å…¥å‡¯äº¬ç§‘æŠ€ã€‚æ›¾ä»»é«˜çº§ç ”å‘å’Œè¿ç»´å¼€å‘å·¥ç¨‹å¸ˆã€é˜¿é‡Œäº‘MVPã€CCF ä¼šå‘˜ï¼Œç°ä»»å‡¯äº¬ç§‘æŠ€ç ”å‘ä¸­å¿ƒæ¶æ„\u0026amp;è¿ç»´éƒ¨è¿ç»´è´Ÿè´£äººï¼Œè´Ÿè´£å…¬å¸è¿ç»´å›¢é˜Ÿå»ºè®¾ã€‚çƒ­çˆ±å¼€æºï¼Œè‡´åŠ›äºæ¨è¡Œdevopsç†å¿µåŠç›¸å…³æŠ€æœ¯ï¼Œæå‡å¼€å‘æ•ˆç‡ï¼Œæé«˜äº¤ä»˜è´¨é‡ä¸é€Ÿåº¦ï¼Œä¸“æ³¨äºäº‘å¹³å°çš„å®¹å™¨åŒ–å®è·µï¼Œæ¢ç´¢æ›´é«˜æ•ˆçš„è¿ç»´ç³»ç»Ÿæ¶æ„ã€‚\nå…³äºæˆ‘ä»¬ å‡¯äº¬ç§‘æŠ€è‡´åŠ›äºæ¨åŠ¨ç‰©æµè¡Œä¸šçš„æ•°å­—åŒ–å’Œæ™ºæ…§åŒ–ï¼Œä¸ºå°å¾®ç‰©æµä¼ä¸šå’Œè½¦ä¸»æä¾›çº¿ä¸ŠåŒ–çš„å¼€æ”¾å¹³å°ï¼Œæ¢ç´¢è§£å†³ç‰©æµè¡Œä¸šè¿è¾“æˆæœ¬é«˜ã€èèµ„é—¨æ§›é«˜ç­‰ç—›ç‚¹ï¼Œä¸ºç‰©æµè¡Œä¸šé™æœ¬å¢æ•ˆã€‚ å‡¯äº¬ç§‘æŠ€æ‹¥æœ‰èš‚èšé‡‘æœã€çº¢æ‰èµ„æœ¬ã€ä¸­èˆªä¿¡æ‰˜ã€å¾·é‚¦è¯åˆ¸ç­‰çŸ¥åè‚¡ä¸œã€‚å‡¯äº¬ç§‘æŠ€è”åˆä¼˜è´¨è‚¡ä¸œèµ„æºï¼Œå…±åŒæ‰“é€ æœ€æ‡‚å°å¾®ç‰©æµä¼ä¸šå’Œè½¦ä¸»çš„æ•°æ®ã€ç§‘æŠ€å’Œæ™®æƒ é‡‘èæœåŠ¡ï¼Œé€šè¿‡å‡¯äº¬ç‰©æµäº‘çº¿ä¸ŠåŒ–å¹³å°ï¼Œå°†å¹¿å¤§ç‰©æµäººæ—¥å¸¸ç»è¥æ‰€éœ€çš„è´§ç‰©è¿è¾“ç®¡ç†ã€è½¦è¾†ç®¡ç†ã€èµ„é‡‘ç»“ç®—ç®¡ç†ã€é‡‘èæœåŠ¡ç®¡ç†ç­‰å…¨é¢çº¿ä¸ŠåŒ–ã€æ•°å­—åŒ–ï¼Œè®©ç‰©æµäººç”Ÿæ„æ›´å¥½åšã€‚\n","date":1561939200,"expirydate":-62135596800,"kind":"taxonomy","lang":"zh","lastmod":1561939200,"objectID":"2525497d367e79493fd32b198b28f040","permalink":"https://guoxudong.io/authors/admin/","publishdate":"0001-01-01T00:00:00Z","relpermalink":"/authors/admin/","section":"authors","summary":"éƒ­æ—­ä¸œï¼Œ2018å¹´4æœˆåŠ å…¥å‡¯äº¬ç§‘æŠ€ã€‚æ›¾ä»»é«˜çº§ç ”å‘å’Œè¿ç»´å¼€å‘å·¥ç¨‹å¸ˆã€é˜¿é‡Œäº‘MVPã€CCF ä¼šå‘˜ï¼Œç°ä»»å‡¯äº¬ç§‘æŠ€ç ”å‘ä¸­å¿ƒæ¶æ„\u0026amp;è¿ç»´éƒ¨è¿ç»´è´Ÿè´£","tags":null,"title":"éƒ­æ—­ä¸œ","type":"authors"},{"authors":["éƒ­æ—­ä¸œ"],"categories":["è¾¹ç¼˜è®¡ç®—"],"content":" å‰è¨€ k3s æ˜¯ç”± Rancher Labs äº2019å¹´å¹´åˆæ¨å‡ºçš„ä¸€æ¬¾è½»é‡çº§ Kubernetes å‘è¡Œç‰ˆï¼Œæ»¡è¶³åœ¨è¾¹ç¼˜è®¡ç®—ç¯å¢ƒä¸­è¿è¡Œåœ¨ x86ã€ARM64 å’Œ ARMv7 å¤„ç†å™¨ä¸Šçš„å°å‹ã€æ˜“äºç®¡ç†çš„ Kubernetes é›†ç¾¤æ—¥ç›Šå¢é•¿çš„éœ€æ±‚ã€‚\nk3s é™¤äº†åœ¨è¾¹ç¼˜è®¡ç®—é¢†åŸŸçš„åº”ç”¨å¤–ï¼Œåœ¨ç ”å‘ä¾§çš„è¡¨ç°ä¹Ÿååˆ†å‡ºè‰²ã€‚æˆ‘ä»¬å¯ä»¥å¿«é€Ÿåœ¨æœ¬åœ°æ‹‰èµ·ä¸€ä¸ªè½»é‡çº§çš„ k8s é›†ç¾¤ï¼Œè€Œ k3d åˆ™æ˜¯ k3s ç¤¾åŒºåˆ›å»ºçš„ä¸€ä¸ªå°å·¥å…·ï¼Œå¯ä»¥åœ¨ä¸€ä¸ª docker è¿›ç¨‹ä¸­è¿è¡Œæ•´ä¸ª k3s é›†ç¾¤ï¼Œç›¸æ¯”ç›´æ¥ä½¿ç”¨ k3s è¿è¡Œåœ¨æœ¬åœ°ï¼Œæ›´å¥½ç®¡ç†å’Œéƒ¨ç½²ã€‚\nåœ¨æ—¥å¸¸å·¥ä½œä¸­ï¼Œæ—¶é•¿è¦åœ¨æœ¬åœ°é›†ç¾¤å’Œå¤šä¸ªè¿œç¨‹é›†ç¾¤ä¹‹é—´åˆ‡æ¢æ¥å®Œæˆè¿ç»´å·¥ä½œï¼Œè¿™æ—¶ä½¿ç”¨ kubecm å¿«é€Ÿå°† k3s é›†ç¾¤çš„ kubeconfig ä¸ç°æœ‰é›†ç¾¤çš„ kubeconfig åˆå¹¶ï¼Œå¹¶å¯å¿«é€Ÿåˆ‡æ¢é›†ç¾¤ï¼Œå¼€å‘è¿ç»´ä¸¤ä¸è¯¯ã€‚\nå®‰è£… k3d k3d æä¾›äº†å¤šç§å®‰è£…æ–¹å¼ï¼Œååˆ†æ–¹ä¾¿ã€‚\nä½¿ç”¨è„šæœ¬å®‰è£… ç›´æ¥ä½¿ç”¨ wget å’Œ curl å®‰è£…\nwget -q -O - https://raw.githubusercontent.com/rancher/k3d/master/install.sh | bash # æˆ– curl -s https://raw.githubusercontent.com/rancher/k3d/master/install.sh | bash  å®‰è£…æŒ‡å®šç‰ˆæœ¬\nwget -q -O - https://raw.githubusercontent.com/rancher/k3d/master/install.sh | TAG=v1.3.4 bash # æˆ– curl -s https://raw.githubusercontent.com/rancher/k3d/master/install.sh | TAG=v1.3.4 bash  ä½¿ç”¨ Homebrew å®‰è£… MacOS æˆ–å®‰è£…äº† Homebrew çš„ Linux å¯ä»¥ä½¿ç”¨ brew å®‰è£…ï¼š\nbrew install k3d  å…¶ä»– è¿˜å¯ä»¥ç›´æ¥å‰å¾€ release é¡µé¢ ä¸‹è½½äºŒè¿›åˆ¶å¯æ‰§è¡Œæ–‡ä»¶ï¼Œæˆ–è€…ç›´æ¥ä½¿ç”¨ go install github.com/rancher/k3d å®‰è£…ã€‚\nåˆ›å»º k3s é›†ç¾¤ åˆ›å»º k3s é›†ç¾¤ä¹Ÿååˆ†ç®€å•ï¼Œä¸€è¡Œå‘½ä»¤å°±å¯æ‹‰èµ·ï¼Œé€Ÿåº¦éå¸¸å¿«ã€‚\n$ k3d create -n k3s-local INFO[0000] Created cluster network with ID facae4a046b169721805f93ec21ba1acb65b9efb8cf35866529178cb0fba75a9 INFO[0000] Created docker volume k3d-k3s-local-images INFO[0000] Creating cluster [k3s-local] INFO[0000] Creating server using docker.io/rancher/k3s:v1.0.1... INFO[0000] SUCCESS: created cluster [k3s-local] INFO[0000] You can now use the cluster with: export KUBECONFIG=\u0026quot;$(k3d get-kubeconfig --name='k3s-local')\u0026quot; kubectl cluster-info  ä½†æ˜¯ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå¦‚æœæ²¡æœ‰æ¢¯å­çš„è¯ï¼Œk3s é›†ç¾¤è™½ç„¶æ‹‰èµ·æ¥å¾ˆå¿«ï¼Œä½†å› ä¸ºæ‹‰ä¸åˆ°é•œåƒï¼Œé›†ç¾¤ç»„ä»¶éƒ½æ— æ³•æ­£å¸¸æ‹‰èµ·ã€‚\n$ export KUBECONFIG=\u0026quot;$(k3d get-kubeconfig --name='k3s-local')\u0026quot; $ kubectl get pod -n kube-system NAME READY STATUS RESTARTS AGE helm-install-traefik-8wxmr 0/1 ContainerCreating 0 3m30s metrics-server-6d684c7b5-j4sc7 0/1 ContainerCreating 0 3m30s coredns-d798c9dd-j6lpw 0/1 ContainerCreating 0 3m30s local-path-provisioner-58fb86bdfd-wv7sw 0/1 ContainerCreating 0 3m30s $ kubectl describe pod coredns-d798c9dd-j6lpw -n kube-system ... Events: Type Reason Age From Message ---- ------ ---- ---- ------- Normal Scheduled \u0026lt;unknown\u0026gt; default-scheduler Successfully assigned kube-system/coredns-d798c9dd-j6lpw to k3d-k3s-local-server Warning FailedCreatePodSandBox 7s (x7 over 4m30s) kubelet, k3d-k3s-local-server Failed create pod sandbox: rpc error: code = Unknown desc = failed to get sandbox image \u0026quot;k8s.gcr.io/pause:3.1\u0026quot;: failed to pull image \u0026quot;k8s.gcr.io/pause:3.1\u0026quot;: failed to pull and unpack image \u0026quot;k8s.gcr.io/pause:3.1\u0026quot;: failed to resolve reference \u0026quot;k8s.gcr.io/pause:3.1\u0026quot;: failed to do request: Head https://k8s.gcr.io/v2/pause/manifests/3.1: dial tcp 64.233.189.82:443: i/o timeout  ç¦»çº¿å®‰è£… å¦‚æœæ²¡æœ‰æ¢¯å­çš„è¯ï¼Œå°±åªèƒ½é€‰æ‹©ä½¿ç”¨ç¦»çº¿å®‰è£…ã€‚\nä¸‹è½½ç¦»çº¿é•œåƒ å‰å¾€ release é¡µé¢ ä¸‹è½½æŒ‡å®šç‰ˆæœ¬çš„é•œåƒï¼Œè¿™é‡Œæˆ‘ä»¬ä¸‹è½½æœ€æ–°çš„ v1.17.2+k3s1 é•œåƒã€‚\nä¸‹è½½åˆ° ~/airgap ç›®å½•ä¸­ï¼Œå¹¶è¿›è¡Œè§£å‹ï¼Œå°†è§£å‹åçš„ç›®å½•é‡å‘½åä¸º 1.17.2ã€‚\nè¿è¡Œç¦»çº¿é•œåƒ è¿™é‡Œå†æ¬¡è¿è¡Œ k3dï¼Œéƒ¨ç½² k3s é›†ç¾¤ã€‚è¿™é‡Œè¦æ³¨æ„çš„æ˜¯ï¼ŒæŒ‚è½½ç¦»çº¿é•œåƒçš„è¯ï¼Œå¿…é¡»ä½¿ç”¨ -i flag æ¥æŒ‡å®šé•œåƒç‰ˆæœ¬ï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ v1.17.2+k3s1 ç‰ˆæœ¬ï¼Œè€Œé•œåƒçš„ tag åˆ™æ˜¯ v1.17.2-k3s1ï¼Œå¦‚æœä¸ç¡®å®š tagï¼Œå¯ä»¥å» DockerHub ä¸ŠæŸ¥çœ‹ã€‚\n$ k3d create -n k3s-local -i rancher/k3s:v1.17.2-k3s1 -v $(pwd)/airgap/v1.17.2/:/var/lib/rancher/k3s/agent/images/ INFO[0000] Created cluster network with ID 10b3fca995fcb491ae1fe1c901672bf6f0a0fd6f51785ba8403947d2773ebd43 INFO[0000] Created docker volume k3d-k3s-local-images INFO[0000] Creating cluster [k3s-local] INFO[0000] Creating server using docker.io/rancher/k3s:v1.17.2-k3s1... INFO[0000] SUCCESS: created cluster [k3s-local] INFO[0000] You can now use the cluster with: export KUBECONFIG=\u0026quot;$(k3d get-kubeconfig --name='k3s-local')\u0026quot; kubectl cluster-info  æŸ¥çœ‹ k3s é›†ç¾¤ç»„ä»¶å¯åŠ¨çŠ¶æ€ï¼š\n$ export KUBECONFIG=\u0026quot;$(k3d get-kubeconfig --name='k3s-local')\u0026quot; $ kubectl get pod -A -w NAMESPACE NAME READY STATUS RESTARTS AGE kube-system local-path-provisioner-58fb86bdfd-7jzbw 0/1 ContainerCreating 0 6m35s kube-system coredns-d798c9dd-jhmds 1/1 Running 0 6m35s kube-system metrics-server-6d684c7b5-4x2cd 1/1 Running 0 6m35s kube-system traefik-6787cddb4b-9v7r4 0/1 ContainerCreating 0 16s kube-system svclb-traefik-fzrqj 0/2 ContainerCreating 0 15s kube-system helm-install-traefik-h8k2j 0/1 Completed 0 6m35s kube-system svclb-traefik-fzrqj 2/2 Running 0 21s  ä½¿ç”¨ kubecm åœ¨ k3s é›†ç¾¤å¯åŠ¨æˆåŠŸåï¼Œä½¿ç”¨ kubecmï¼Œå°† k3s çš„ kubeconfig ä¸ç°æœ‰ kubeconfig åˆå¹¶ã€‚\nkubecm add -f $(k3d get-kubeconfig --name='k3s-local') -n k3s -c  åˆ‡æ¢é›†ç¾¤ï¼Œé€‰æ‹© k3sã€‚\n$ kubecm s Use the arrow keys to navigate: â†“ â†‘ â†’ â† and / toggles search Select Kube Context ğŸ˜¼ k3s(*) prod-tg test â†“ banma --------- Info ---------- Name: k3s Cluster: cluster-485d6mhcfm User: user-485d6mhcfm  ç°åœ¨å°±å¯ä»¥åœ¨æœ¬åœ°ä½¿ç”¨ k3s é›†ç¾¤è¿›è¡Œå¼€å‘å·¥ä½œï¼Œè€Œæœ‰è¿ç»´å·¥ä½œçš„æ—¶å€™ï¼Œä½¿ç”¨ kubecm switch å¿«é€Ÿåˆ‡æ¢é›†ç¾¤ã€‚\nç»“è¯­ k3s åŒæ—¶æ”¯æŒ x86_64ã€ARM64 å’Œ ARMv7 æ¶æ„ï¼Œå®ƒå¯ä»¥ååˆ†çµæ´»åœ°è·¨ä»»ä½•è¾¹ç¼˜åŸºç¡€æ¶æ„å·¥ä½œã€‚ä¸æ k3s åœ¨è¾¹ç¼˜è®¡ç®—é¢†åŸŸçš„åº”ç”¨ï¼Œä¸ä¹‹å‰ä½¿ç”¨çš„ minikube ç›¸æ¯”ï¼Œk3s è£å‰ªæ‰äº†è®¸å¤šç”¨ä¸åˆ°çš„åŠŸèƒ½ï¼Œå¹¶ä¸”å®‰è£…æ›´ç®€å•ï¼Œå¯åŠ¨æ›´å¿«ï¼Œç©ºé—´å ç”¨ä¹Ÿæ›´å°ã€‚ç›¸ä¿¡ k3s åœ¨å¼€å‘ä¾§çš„ä½œç”¨ä¹Ÿä¼šè¶Šæ¥è¶Šå¤§ï¼Œä½¿äº‘åŸç”Ÿåº”ç”¨çš„å¼€å‘æ›´åŠ çš„ä¾¿åˆ©ã€‚\n","date":1581911499,"expirydate":-62135596800,"kind":"page","lang":"zh","lastmod":1581911499,"objectID":"3936f4eb6081098c2ab5bc8663ee5e7a","permalink":"https://guoxudong.io/post/k3d-k3s-kubecm/","publishdate":"2020-02-17T11:51:39+08:00","relpermalink":"/post/k3d-k3s-kubecm/","section":"post","summary":"ä½¿ç”¨ k3d åœ¨æœ¬åœ°å¿«é€Ÿæ­å»ºè½»é‡çº§ k8s é›†ç¾¤ - k3sï¼Œå¹¶ä½¿ç”¨ kubecm ç®¡ç†æ‰€æœ‰é›†ç¾¤ã€‚","tags":["k3s","k3d","kubecm","Kubernetes"],"title":"K3d+Kubecm æœ¬åœ°å¼€å‘è¿ç»´ä¸¤ä¸è¯¯","type":"post"},{"authors":["éƒ­æ—­ä¸œ"],"categories":["è‚ºç‚ç–«æƒ…"],"content":" å‰è¨€ æ–°å‹å† çŠ¶ç—…æ¯’ç–«æƒ…æ±¹æ¶Œè€Œæ¥ï¼Œå…¨å›½å„åœ°ä¸¥é˜²æ­»å®ˆï¼Œè€Œç–«æƒ…çš„å®æ—¶æ•°æ®ä¹Ÿé€šè¿‡ä¸åŒçš„æ¸ é“ï¼Œå¦‚å¾®ä¿¡åŸå¸‚æœåŠ¡çš„ç–«æƒ…åŠ¨æ€è®¢é˜…ã€æ”¯ä»˜å®çš„ç–«æƒ…å®æ—¶è¿½è¸ªã€æ–°æµªæ–°é—»çš„ç–«æƒ…å®æ—¶åŠ¨æ€ç­‰ç­‰ï¼Œå„ç§å¹³å°çº·çº·å°†ç–«æƒ…çš„å®æ—¶åŠ¨æ€è¿›è¡Œå±•ç¤ºï¼Œç¡®ä¿äººä»¬å¯ä»¥ç¬¬ä¸€æ—¶é—´äº†è§£ç–«æƒ…çš„å‘å±•æƒ…å†µã€‚\nè€Œæ— è®ºæ˜¯å“ªä¸€å®¶çš„æ•°æ®æ¨é€å’Œå±•ç¤ºï¼Œéƒ½æ˜¯é¢å‘å¤§ä¼—çš„ï¼Œå¹¶ä¸èƒ½ä¸ªæ€§åŒ–çš„å±•ç¤ºæˆ‘ä»¬æœ€å…³å¿ƒçš„é‚£äº›æ•°æ®ï¼Œæ‰€ä»¥è¿™æ—¶å°±éœ€è¦è‡ªåˆ¶ä¸€ä¸ªç–«æƒ…åŠ¨æ€å±•ç¤ºçš„ Dashboard äº†ã€‚\nè¯´åˆ° Dashboardï¼Œç¬¬ä¸€ä¸ªè”æƒ³åˆ°çš„å½“ç„¶å°±æ˜¯ Grafana äº†ï¼ŒGrafana æ˜¯è‡ª2014å¹´ä»¥æ¥æ¨å‡ºçš„å¤šå¹³å°å¼€æºåˆ†æå’Œäº¤äº’å¼å¯è§†åŒ–è½¯ä»¶ã€‚è¿æ¥æ”¯æŒçš„æ•°æ®æºï¼Œå®ƒä¼šæä¾› Web å›¾è¡¨çš„å±•ç¤ºä»¥åŠæŠ¥è­¦ã€‚ç»ˆç«¯ç”¨æˆ·å¯ä»¥é€šè¿‡æ’ä»¶è¿›è¡Œæ‹“å±•ï¼Œä»è€Œä½¿ç”¨äº¤äº’å¼çš„æŸ¥è¯¢åŠå±•ç¤ºå¤æ‚çš„ç›‘æ§ä»ªè¡¨ç›˜ã€‚\né¡¹ç›®å‡†å¤‡ æ˜ç¡®ç›®æ ‡ï¼Œæˆ‘ä»¬è¿™é‡Œéœ€è¦å®šåˆ¶ä¸€ä¸ª Dashboard ç”¨äºå±•ç¤ºç–«æƒ…åŠ¨æ€ï¼Œç”±äºæˆ‘ç›®å‰åœ¨ä¸Šæµ·ï¼Œéœ€è¦å±•ç¤ºå…¨å›½å’Œä¸Šæµ·çš„ç¡®è¯Šã€ç–‘ä¼¼ã€æ²»æ„ˆå’Œæ­»äº¡ç—…ä¾‹æ•°ï¼›åŒæ—¶è¿˜éœ€è¦ä¸€ä¸ªç—…ä¾‹å‘å±•æ›²çº¿ï¼Œç”¨æ¥è§‚å¯Ÿç–«æƒ…å‘å±•è¶‹åŠ¿ï¼›å„çœåŒºæƒ…å†µå·²ç»ä¸Šæµ·å„åŒºæƒ…å†µä¹Ÿæ˜¯éœ€è¦çš„ã€‚\nGrafana åªæ˜¯ä¸€ä¸ªå±•ç¤ºæ•°æ®çš„å·¥å…·ï¼Œé¦–å…ˆéœ€è¦çš„æ˜¯æ•°æ®æºï¼Œç›®å‰å¸‚é¢ä¸Šå¹¶æ²¡æœ‰å¯ä»¥ç›´æ¥ç”¨äº Grafana çš„ç–«æƒ…æ•°æ®æºï¼Œè¿™é‡Œæˆ‘ä»¬éœ€è¦ï¼š\n éœ€è¦ä¸€ä¸ª Grafanaï¼Œæ— è®ºæ˜¯åœ¨ä½ çš„ç¬”è®°æœ¬ç”µè„‘ä¸Šï¼Œè¿˜æ˜¯åœ¨ä½ çš„ K8S é›†ç¾¤ä¸­ï¼ˆè¿™é‡Œæ¨èä½¿ç”¨ docker è¿›è¡Œè¿è¡Œ Grafanaï¼Œå¦‚æœéƒ¨ç½²åœ¨ K8S é›†ç¾¤ä¸­ï¼Œé‚£æ›´å¥½ï¼‰ã€‚\n å®‰è£… SimpleJson æ’ä»¶ï¼Œå®ƒå¯ä»¥å°† json æ ¼å¼çš„æ•°æ®ï¼Œç”¨ä½œ Grafana çš„æ•°æ®æºã€‚\n  å¼€å‘æ•°æ®æº æ•°æ®æºè¿™é‡Œä½¿ç”¨ Python Bottle è¿›è¡Œå¼€å‘ï¼Œå½“ç„¶ä½ ä¹Ÿå¯ä»¥é€‰æ‹© flaskï¼Œéƒ½æ˜¯ä¸€æ ·çš„ï¼Œæˆ‘ä½¿ç”¨ Bottle çš„åŸå› æ˜¯ä¹‹å‰å¼€å‘çš„ Grafana æ•°æ®æºæ˜¯ä½¿ç”¨ Bottle å¼€å‘çš„ï¼Œè¿™é‡Œç›´æ¥æ‹¿æ¥å°±å¯ä»¥ç”¨ï¼Œè°ƒè¯•é…ç½®ç”šè‡³ç”¨äºæ„å»º docker é•œåƒçš„ Dockerfile å’Œç”¨äºéƒ¨ç½² K8S çš„ deploy.yaml éƒ½æœ‰ç°æˆå¯ä»¥ç”¨çš„ã€‚ä½¿ç”¨ Python å¼€å‘ Grafana æ•°æ®æºå¾ˆç®€å•ï¼Œåªæœ‰ç¬¦åˆ SimpleJson çš„æ ¼å¼è¦æ±‚å³å¯ã€‚å¯ä»¥æ ¹æ® Oz Nahum Tiram çš„åšæ–‡ Visualize almost anything with Grafana and Python æ¥å­¦ä¹ å¦‚æœä½¿ç”¨ Python ä½œä¸º Grafana çš„æ•°æ®æºã€‚\nåœ¨å¯¹æ•°æ®æºçš„å®šåˆ¶ä¸­ï¼Œä½¿ç”¨ä¸¤ç§ç±»å‹çš„çš„æ•°æ®ï¼š\n timeserie ç±»å‹ï¼š\nç”¨äºå±•ç¤ºå…¨å›½ï¼ˆå«æ¸¯æ¾³å°ï¼‰å’Œä¸Šæµ·åœ°åŒºçš„ç–«æƒ…å®æ—¶åŠ¨æ€ï¼Œå±•ç¤ºç¡®è¯Šã€ç–‘ä¼¼ã€æ²»æ„ˆå’Œæ­»äº¡æ•°ï¼Œå¹¶ä¸”å±•ç¤ºè¾ƒæ˜¨æ—¥å¢åŠ çš„æ•°é‡ï¼Œç»˜åˆ¶äº†ã€ç¡®è¯Š/ç–‘ä¼¼ã€‘æ•°å’Œã€æ²»æ„ˆ/æ­»äº¡ã€‘æ•°çš„å¯¹æ¯”æ›²çº¿ã€‚\nè¿™é‡Œåªè¦å°†å…¨å›½ç¡®è¯Šæ•° gntotal ä¸ å½“å‰æ—¶é—´æˆ³ç»„åˆè¿”å›å³å¯ï¼Œå…¶ä»–æŒ‡æ ‡ä¹Ÿæ˜¯è¿™ç§æ–¹å¼ã€‚\n@app.post('/query') def query(): print(request.json) body = [] all_data = getDataSync() time_stamp = int(round(time.time() * 1000)) for target in request.json['targets']: name = target['target'] if name == 'gntotal': body.append({'target': 'gntotal', 'datapoints': [[all_data['gntotal'], time_stamp]]}) body = dumps(body) return HTTPResponse(body=body, headers={'Content-Type': 'application/json'})  table ç±»å‹ï¼š\nç”¨äºç»˜åˆ¶ä¸­å›½å„çœç¡®è¯Šã€ç–‘ä¼¼ã€æ²»æ„ˆå’Œæ­»äº¡ç—…ä¾‹æ•°è¡¨æ ¼ï¼Œä»¥åŠä¸Šæµ·å„åŒºç¡®è¯Šã€ç–‘ä¼¼ã€æ²»æ„ˆå’Œæ­»äº¡ç—…ä¾‹æ•°è¡¨æ ¼ã€‚\nå–å‡ºæ•°æ®ä¸­çš„åç§°ä»¥åŠç¡®è¯Šã€ç–‘ä¼¼ã€æ²»æ„ˆå’Œæ­»äº¡æ•°ï¼Œappend åˆ° rows ä¸­å³å¯ã€‚\n@app.post('/query') def query(): print(request.json) body = [] all_data = getDataSync() sh_data = getShDataSync() if request.json['targets'][0]['type'] == 'table': rows = [] for data in all_data['list']: row = [data['name'], data['value'], data['susNum'], data['cureNum'], data['deathNum']] rows.append(row) sh_rows = [] for data in sh_data['city']: row = [data['name'], data['conNum'], data['susNum'], data['cureNum'], data['deathNum']] sh_rows.append(row) bodies = {'all': [{ \u0026quot;columns\u0026quot;: [ {\u0026quot;text\u0026quot;: \u0026quot;çœä»½\u0026quot;, \u0026quot;type\u0026quot;: \u0026quot;name\u0026quot;}, {\u0026quot;text\u0026quot;: \u0026quot;ç¡®è¯Š\u0026quot;, \u0026quot; type\u0026quot;: \u0026quot;conNum\u0026quot;}, {\u0026quot;text\u0026quot;: \u0026quot;ç–‘ä¼¼\u0026quot;, \u0026quot; type\u0026quot;: \u0026quot;susNum\u0026quot;}, {\u0026quot;text\u0026quot;: \u0026quot;æ²»æ„ˆ\u0026quot;, \u0026quot;type\u0026quot;: \u0026quot;cureNum\u0026quot;}, {\u0026quot;text\u0026quot;: \u0026quot;æ­»äº¡\u0026quot;, \u0026quot;type\u0026quot;: \u0026quot;deathNum\u0026quot;} ], \u0026quot;rows\u0026quot;: rows, \u0026quot;type\u0026quot;: \u0026quot;table\u0026quot; }], 'sh': [{ \u0026quot;columns\u0026quot;: [ {\u0026quot;text\u0026quot;: \u0026quot;çœä»½\u0026quot;, \u0026quot;type\u0026quot;: \u0026quot;name\u0026quot;}, {\u0026quot;text\u0026quot;: \u0026quot;ç¡®è¯Š\u0026quot;, \u0026quot; type\u0026quot;: \u0026quot;value\u0026quot;}, {\u0026quot;text\u0026quot;: \u0026quot;ç–‘ä¼¼\u0026quot;, \u0026quot; type\u0026quot;: \u0026quot;susNum\u0026quot;}, {\u0026quot;text\u0026quot;: \u0026quot;æ²»æ„ˆ\u0026quot;, \u0026quot;type\u0026quot;: \u0026quot;cureNum\u0026quot;}, {\u0026quot;text\u0026quot;: \u0026quot;æ­»äº¡\u0026quot;, \u0026quot;type\u0026quot;: \u0026quot;deathNum\u0026quot;} ], \u0026quot;rows\u0026quot;: sh_rows, \u0026quot;type\u0026quot;: \u0026quot;table\u0026quot; }]} series = request.json['targets'][0]['target'] body = dumps(bodies[series]) return HTTPResponse(body=body, headers={'Content-Type': 'application/json'})   é€‰æ‹©å±•ç¤º Panel ç±»å‹ æ€»çš„æ¥è¯´ï¼Œä½¿ç”¨äº†4ç§ Panel è¿›è¡Œå±•ç¤ºï¼š\n å±•ç¤ºç—…ä¾‹æ•°çš„å±•ç¤ºå—ï¼Œä½¿ç”¨ Singlestat å±•ç¤ºæ•°æ®å¯¹æ¯”æ›²çº¿ï¼Œä½¿ç”¨ Graph å±•ç¤ºè¡¨æ ¼ï¼Œä½¿ç”¨ Table æ–‡å­—æ ‡é¢˜ï¼Œä½¿ç”¨ Text  é…ç½®æ•°æ®æº ç—…ä¾‹æ•°å±•ç¤ºå—ï¼š è¿™é‡Œåªæœ‰ä¸€ä¸ªå€¼ï¼Œæ‰€ä»¥è¦é€‰æ‹© Firstã€‚\nç—…ä¾‹æ•°å‘å±•è¶‹åŠ¿å›¾ï¼š è¿™é‡Œå°†ã€ç¡®è¯Š/ç–‘ä¼¼ã€‘å’Œã€æ²»æ„ˆ/æ­»äº¡ã€‘æ•°è¿›è¡Œå¯¹æ¯”ã€‚\næ•°æ®è¡¨æ ¼ï¼š æ•ˆæœ æ•´ä½“æ•ˆæœè¿˜å¯ä»¥ï¼Œå…ˆå·²ç”¨ä½œå…¬å¸å¤§å±å±•ç¤ºç–«æƒ…æƒ…å†µï¼ˆè¿™é‡Œæˆ‘å¸ç”¨äºå±•ç¤ºå±å¹•è¾ƒå°ï¼Œåªä¸è¿‡æ˜¯ä¸€ä¸ªå°ç±³ç”µè§†ï¼Œæ•…å­—ä½“å’Œå±•ç¤ºå—éƒ½åšçš„å¤§äº†ä¸€äº›ï¼‰ã€‚\næ„å»º å°†ä»£ç æ‰“åŒ…æˆä¸º docker é•œåƒï¼Œå°±å¯ä»¥è¿è¡Œåœ¨ä»»æ„ç¯å¢ƒä»¥åŠ K8S é›†ç¾¤äº†ï¼Œé•œåƒå·²ä¸Šä¼  dockerhub ç›´æ¥æ‹‰å–é•œåƒï¼Œå¼€ç®±å³é£Ÿã€‚\n# Dockerfile FROM python:3.7.3-alpine3.9 LABEL maintainer=\u0026quot;sunnydog0826@gmail.com\u0026quot; COPY . /app RUN echo \u0026quot;https://mirrors.aliyun.com/alpine/v3.9/main/\u0026quot; \u0026gt; /etc/apk/repositories \\ \u0026amp;\u0026amp; apk update \\ \u0026amp;\u0026amp; apk add --no-cache gcc g++ python3-dev python-dev linux-headers libffi-dev openssl-dev make \\ \u0026amp;\u0026amp; pip3 install -r /app/requestments.txt -i http://mirrors.aliyun.com/pypi/simple --trusted-host mirrors.aliyun.com WORKDIR /app ENTRYPOINT [\u0026quot;uwsgi\u0026quot;,\u0026quot;--ini\u0026quot;,\u0026quot;uwsgi.ini\u0026quot;]  è¿è¡Œ  æ‹‰å–é•œåƒ\ndocker pull guoxudongdocker/feiyan-datasource  è¿è¡Œé•œåƒ\ndocker run -d --name datasource -p 8088:3000 guoxudongdocker/feiyan-datasource  æ·»åŠ æ•°æ®æº\né€‰æ‹© SimpleJson ç±»å‹çš„æ•°æ®æºï¼Œç‚¹å‡»æ·»åŠ ï¼Œå¡«å…¥æ•°æ®æºåœ°å€ï¼š\n å¯¼å…¥ Dashboard\nç‚¹å‡» Upload.json fileï¼Œé€‰æ‹© wuhan2020-grafana/dashboard.json\n ä½¿ç”¨ K8S éƒ¨ç½²ï¼ˆå¯é€‰ï¼‰\nkubectl apply -f deploy.yaml   ç»“è¯­ æˆªæ­¢ç›®å‰ï¼ˆ2020å¹´2æœˆ14æ—¥ï¼‰ï¼Œç—…ä¾‹æ•°è¿˜åœ¨ä¸æ–­çš„å¢åŠ ï¼Œä½†æ˜¯ç–‘ä¼¼ç—…ä¾‹æ•°è¶‹åŠ¿å¼€å§‹ä¸‹é™ï¼Œå¯ä»¥çœ‹å‡ºï¼Œç›®å‰æ–°å‹è‚ºç‚çš„ç¡®è¯Šé€Ÿåº¦å¢åŠ äº†ï¼›æ²»æ„ˆæ•°ä¹Ÿåœ¨ä¸æ–­çš„å¢åŠ ï¼›ä¸Šæµ·åœ°åŒºå’Œå…¶ä»–åœ°åŒºæ¯”èµ·æ¥ï¼Œè™½ç„¶æœ‰å¤§æ‰¹è¿”å·¥äººå‘˜è¿›å…¥ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰å¢åŠ ç‰¹åˆ«å¤šçš„ç—…ä¾‹æ•°ï¼Œå„ä¸ªç¤¾åŒºä¸¥é˜²æ­»å®ˆçš„æ•ˆæœåˆæ˜¾ï¼›åŒæ—¶ä¸Šæµ·ä¸€ç›´ä¿æŒç€æ­»äº¡1äººçš„æƒ…å†µï¼Œè€Œä¸”ä¸­å›½é¦–ä¾‹æ–°å‹è‚ºç‚æ²»æ„ˆçš„ä¹Ÿåœ¨ä¸Šæµ·ã€‚æ€»çš„æ¥è¯´åªè¦å¤§å®¶æ³¨æ„é¢„é˜²ï¼Œå¾…åœ¨å®¶ä¸­ï¼Œå¤šæ¶ˆæ¯’ï¼Œå¤šé€šé£ï¼Œä¸€å®šå¯ä»¥æˆ˜èƒœç–«æƒ…ï¼Œåº¦è¿‡éš¾å…³ã€‚\nå¯¼å…¥ Dashboard çš„ json æ–‡ä»¶å’Œéƒ¨ç½² K8S çš„ yaml æ–‡ä»¶éƒ½å¯ä»¥åœ¨ GitHub ä¸Šæ‰¾åˆ°ã€‚\né¡¹ç›®åœ°å€ï¼šhttps://github.com/sunny0826/wuhan2020-grafana\n","date":1581646372,"expirydate":-62135596800,"kind":"page","lang":"zh","lastmod":1581646372,"objectID":"f704c08f5bf2bfb7ea5c660f129eaf8c","permalink":"https://guoxudong.io/post/feiyan-grafana/","publishdate":"2020-02-14T10:12:52+08:00","relpermalink":"/post/feiyan-grafana/","section":"post","summary":"å¼€å‘ Grafana Dashboard å±•ç¤ºæ–°å‹è‚ºç‚ç–«æƒ…åŠ¨æ€ã€‚","tags":["è‚ºç‚ç–«æƒ…"],"title":"ä½¿ç”¨ Grafana å±•ç¤ºè‚ºç‚ç–«æƒ…åŠ¨æ€","type":"post"},{"authors":["éƒ­æ—­ä¸œ"],"categories":["æ•ˆç‡"],"content":" å‰è¨€  â€œéå¸¸æ—¶æœŸå‘¼å”¤éå¸¸æ‹…å½“â€   è¿™æ˜¯æˆ‘å¸ CEO å¼ ä¸–ä¼Ÿåœ¨å¤å·¥å½“å¤©è‡´å…¨ä½“å‘˜å·¥å…¬å¼€ä¿¡çš„é¢˜ç›®ã€‚2020å¹´ï¼Œåœ¨ç¬¬ä¸€ä¸ªä¸èµ°äº²æˆšçš„æ˜¥èŠ‚è¿‡åï¼Œæˆ‘ä»¬é¼ å¹´çš„å·¥ä½œï¼Œä»¥è¿œç¨‹åŠå…¬çš„å½¢å¼å¼€å§‹äº†ã€‚\nåœ¨è¿›è¡Œäº†ä¸€å‘¨çš„è¿œç¨‹åŠå…¬ä¹‹åï¼Œæˆ‘ä»¬äº2æœˆ10æ—¥æ­£å¼å¤å·¥ï¼Œä½†æ˜¯ç”±äºæˆ‘æŠµæ²ªè‡ªæˆ‘éš”ç¦»æœªæ»¡7æ—¥ï¼Œåªå¾—ç»§ç»­åœ¨å®¶è¿œç¨‹åŠå…¬ï¼Œä½†æ˜¯ä¸èƒ½å› ä¸ºåœ¨å®¶åŠå…¬å°±æ”¾ä½å¯¹è‡ªå·±çš„è¦æ±‚ï¼Œæ•…ç»“åˆåœ¨å‡æœŸæµè§ˆçš„ä¸€ç³»åˆ—ä»‹ç»è¿œç¨‹åŠå…¬çš„æ–‡ç« ï¼Œä»¥åŠç–«æƒ…é˜²æ§çŸ¥è¯†ï¼Œæ€»ç»“äº†è¿™ç¯‡è¿œç¨‹åŠåœ¨å…¬å¸åŠå…¬æŒ‡å—ï¼Œå¸Œæœ›å¯¹å¤§å®¶æœ‰æ‰€å¸®åŠ©ã€‚\nå–æ¶ˆæ™¨ä¼š ä¹‹æ‰€ä»¥å°†è¿™ä¸ªæ”¾åœ¨æœ€å‰é¢ï¼Œæ˜¯ç”±äºè¿™ä¸ªåœ¨å¹³æ—¶åŠå…¬ä¸­çš„â€œæ­£å¸¸æ“ä½œâ€ï¼Œåœ¨è¿œç¨‹åŠå…¬çš„ç¯å¢ƒä¸‹ï¼Œæˆä¸ºäº†ä¸€åœºç¾éš¾ã€‚2æœˆ3æ—¥å¼€å§‹ï¼Œä¼ä¸šå¼€å§‹å¤å·¥ï¼Œä½†ç”±äºç–«æƒ…è¿˜åœ¨æ‰©æ•£ï¼Œæ‰€ä»¥å¤§å®¶ä¸çº¦è€ŒåŒçš„é€‰æ‹©äº†è¿œç¨‹åŠå…¬\u0026hellip;è€Œå¾€æ—¥é‡Œé‚£äº›â€œç¨³å¦‚è€ç‹—â€çš„è¿œç¨‹åŠå…¬è½¯ä»¶ï¼Œé˜¿é‡Œå·´å·´çš„é’‰é’‰ï¼Œè…¾è®¯çš„ä¼ä¸šå¾®ä¿¡ï¼Œåä¸ºçš„ WeLink ç›¸ç»§å‡ºç°äº†æ¯”è¾ƒå¤§çš„å»¶è¿Ÿç”šè‡³å´©æºƒç°è±¡ã€‚åŒæ—¶è¿˜æœ‰å…¶ä»–çš„åŸå› ï¼š\n å®¶é‡Œçš„ç½‘ç»œæ¡ä»¶ä¸ä½³ï¼Œå¯èƒ½å‡ºç°å»¶è¿Ÿæˆ–è€…æ‰çº¿çš„ç°è±¡ åŒä¸€æ—¶é—´ï¼Œåªæœ‰èƒ½ä¸€ä¸ªäººè¯´è¯ï¼Œæ²Ÿé€šæ•ˆç‡å¾ˆä½ ä¸€äº›ä¸å¿…è¦çš„å‘è¨€ï¼Œæ¯”å¦‚éœ€è¦å•ç‹¬æ²Ÿé€šçš„é—®é¢˜ï¼Œå ç”¨å¤§é‡å¤§å®¶çš„æ—¶é—´ å‡ºç°å¤šäººç­‰ä¸€äººçš„æƒ…å†µ ğŸ˜† æ²¡æ´—è„¸ï¼Œæ²¡æ´—å¤´ï¼Œç´ é¢œç­‰å…¶ä»–é—®é¢˜  åŒæ—¶ç”±äºä¸­å°å­¦çº¿ä¸Šè¯¾å ‚çš„å¼€å§‹ï¼Œå„è·¯äººæ°‘æ•™å¸ˆçº·çº·è½¬å‹åå…«çº¿ä¸»æ’­ï¼Œç½‘ç»œç¯å¢ƒæ›´æ˜¯å˜çš„æ‹¥æŒ¤ä¸å ªã€‚\næ•…å–æ¶ˆçº¿ä¸Šæ™¨ä¼šï¼Œè¿™é‡Œå°±æ˜¾çš„æ¯”è¾ƒåˆç†ï¼ŒåŒæ—¶å¯ä»¥é‡‡ç”¨å¼‚æ­¥çš„ååŒæ–¹å¼ï¼Œé€šè¿‡ jira å’Œ confluence è¿›è¡Œå·¥ä½œçš„ååŒã€‚åˆ©ç”¨ jira å®æ—¶æ›´æ–°è‡ªå·±ä»»åŠ¡çš„çŠ¶æ€ï¼Œé¡¹ç›®ç»„é•¿ä¸ç»„å‘˜ä¹Ÿå¯ä»¥å®æ—¶é€šè¿‡ jira äº†è§£é¡¹ç›®çš„å®æ—¶è¿›åº¦ï¼Œè¿™æ ·å°±å‡å°‘äº†é¢å¯¹é¢çš„æ²Ÿé€šï¼Œå®‰å…¨åˆé«˜æ•ˆã€‚\nä¾‹å¦‚ï¼š\nç›®æ ‡åˆ†çº§ è¿œç¨‹åŠå…¬æ¯”ç»Ÿä¸€åŠå…¬éœ€è¦æ›´åŠ ç»†ç²’åº¦çš„å·¥ä½œåˆ†çº§ï¼Œä»€ä¹ˆäº‹æƒ…åº”è¯¥é©¬ä¸Šåšï¼Œä»€ä¹ˆäº‹æƒ…å¯ä»¥æ”¾ä¸€æ”¾ï¼Œä»€ä¹ˆæ—¶å€™å¯¹æ¥çš„åŒäº‹æœ‰æ—¶é—´ï¼Œè¿™äº›éƒ½éœ€è¦è§„åˆ’çš„æ›´åŠ ä»”ç»†ã€‚\nå°†å·¥ä½œå†…å®¹è¿›è¡Œç»†ç²’åº¦æ‹†åˆ†ï¼Œä½¿ç”¨ä¸ªäººçœ‹æ¿ï¼Œæ—¶é—´ç®¡ç†å·¥å…·ç”šè‡³è®°äº‹æœ¬æ‹†åˆ†è‡ªå·±æ¯å¤©çš„å·¥ä½œæ—¶é—´å®‰æ’ï¼Œæ¯å‘¨å¯¹è‡ªå·±å·¥ä½œçš„ä»»åŠ¡åˆ—è¡¨è¿›è¡Œå›é¡¾ï¼Œå°†å·²å®Œæˆçš„æ ‡è®°ï¼Œå°†æœ¬å‘¨æ–°å¢åŠ çš„ä»»åŠ¡åŠ å…¥è¿›æ¥ï¼Œè¿™æ ·å¾ˆå®¹æ˜“è®©æˆ‘ä»¬åœ¨å‘¨ä¸€çš„æ—¶å€™å¯¹å·¥ä½œçš„ä¼˜å…ˆçº§æœ‰ä¸ªå¿«é€Ÿæ¢³ç†ï¼Œå¹¶ä¸”ä¸å®¹æ˜“é—æ¼ä¸€äº›ç»†èŠ‚å·¥ä½œã€‚\næ¨èä½¿ç”¨å››è±¡é™æ³•æ¥å¯¹è‡ªå·±ç›®å‰çš„å·¥ä½œè¿›è¡Œåˆ†çº§ï¼Œæ ¹æ®ç´§æ€¥æƒ…å†µå’Œé‡è¦æƒ…å†µï¼Œå¯¹è‡ªå·±çš„å·¥ä½œè¿›è¡Œåˆ†çº§ï¼Œä¼˜å…ˆå¤„ç†é‚£äº›ç´§æ€¥ä¸”é‡è¦çš„äº‹æƒ…ï¼ŒåŒæ ·ä¸ªäººçœ‹æ¿ä¹Ÿå¯ä»¥å¸®åŠ©æ‚¨è®°å½•å®Œæˆçš„ä»»åŠ¡å’Œå¾…å®Œæˆçš„ä»»åŠ¡ï¼Œè¿™æ ·å†™æ—¥æŠ¥/å‘¨æŠ¥å°±å¯ä»¥ç›´æ¥æ‹¿æ¥ç”¨ï¼Œä¸ç”¨å†ç»å°½è„‘æ±å›å¿†ä»Šå¤©/æœ¬å‘¨éƒ½åšäº†ä»€ä¹ˆï¼Œä¸ªäººçœ‹æ¿è¿™é‡Œæ¨è Trelloï¼Œä¸ªäººå…è´¹ä½¿ç”¨ã€‚\næå‡ä¸ªäººæ•ˆç‡ æ¸…æ™°åŒºåˆ†å·¥ä½œæ—¶é—´å’Œä¼‘æ¯æ—¶é—´ åœ¨å®¶åŠå…¬ï¼Œå·¥ä½œæ•ˆç‡å¾ˆå®¹æ˜“å˜å·®ã€‚æ¯•ç«Ÿæ²™å‘å’ŒåºŠå°±åœ¨èº«è¾¹ï¼Œå¾ˆå®¹æ˜“å·¥ä½œç€çªç„¶å°±æƒ³å»ä¼‘æ¯ä¸€ä¼šå„¿ã€‚è¿™é‡Œå°±éœ€è¦åœ¨å®¶é‡Œåˆ’åˆ†å‡ºä¸€ä¸ª ã€å·¥ä½œåŒºã€‘ ï¼Œå¹¶åœ¨å·¥ä½œåŒºä¸­å‡†å¤‡ä¸Šç­æ‰€éœ€çš„ä¸€åˆ‡ï¼›åŒæ—¶è¦æŒ‰æ—¶èµ·åºŠï¼Œç©¿æˆ´æ•´é½ï¼Œåƒå¥½æ—©ç‚¹ï¼Œç„¶åè¿›å…¥å·¥ä½œåŒºå¼€å§‹ä¸€å¤©çš„å·¥ä½œï¼Œé€šè¿‡è¿™ç§ç®€å•çš„ ä»ªå¼æ„Ÿ å¯ä»¥è®©æˆ‘ä»¬å¿«é€Ÿè¿›å…¥å·¥ä½œçŠ¶æ€ï¼Œæ›´å¥½çš„æé«˜æ•ˆç‡ï¼Œä¸è‡³äºå‡ºç°ã€Œåœ¨å®¶å·¥ä½œå±…ç„¶æ¯”åœ¨å…¬å¸ä¸‹ç­æ™šã€çš„æƒ…å†µã€‚\næŒ‰æ—¥ç¨‹å·¥ä½œ åˆ‡è®°ï¼Œåœ¨å®¶åŠå…¬åªæ˜¯åœ°ç‚¹å˜äº†ï¼Œå·¥ä½œæ—¶é—´å’Œå†…å®¹å¹¶æ²¡æœ‰å˜ã€‚æŒ‰ç…§ä¸Šæ–‡ä¸­æåˆ°çš„ç›®æ ‡åˆ†çº§ï¼Œåˆç†çš„å°†ç›®æ ‡åˆ†ä¸ºæ—¥ç¨‹ï¼Œå¹¶åœ¨è‡ªå·±çš„çœ‹æ¿ä¸­è¿›è¡Œè®°å½•ï¼Œä¿æŒé’‰é’‰/å¾®ä¿¡å®æ—¶åœ¨çº¿ï¼Œé˜²æ­¢çªç„¶å‡ºç°ç´§æ€¥ä¸”é‡è¦çš„çªå‘ä»»åŠ¡ï¼ŒåŒæ—¶ä¹Ÿå°†éç´§æ€¥é—®é¢˜éƒ½æ¨åå¤„ç†ï¼Œè®©èšç„¦å·¥ä½œçš„æ•´å—æ—¶é—´å°½é‡ä¸å—å¹²æ‰°ã€‚\nçæƒœè‡ªå·±çš„æ—¶é—´ä¹Ÿçæƒœä»–äººçš„æ—¶é—´ è¿™æ˜¯æ¯ä¸ªèŒåœºäººåº”æœ‰çš„è‡ªå¾‹ï¼Œå°‘å¼€æ— æ•ˆä¼šè®®ï¼Œå¤šç”¨å¼‚æ­¥ååŒä»£æ›¿å®æ—¶ååŒï¼›éç´§æ€¥äº‹ä»¶ç»™å¯¹æ–¹æ›´å¤šå“åº”ç¼“å†²æ—¶é—´ï¼›èƒ½åœ¨ Confluence é‡Œæœåˆ°çš„å†…å®¹å°½é‡ä¸åœ¨ç¾¤é‡Œæé—®ã€‚ï¼ˆè¿ç»´ç»„æä¾›é’‰é’‰åº”ç­”æœºå™¨äººï¼ŒåŸºç¡€èµ„æºç›¸å…³çš„é—®é¢˜ï¼Œå¯ä»¥å…ˆ @ ç¾¤å†…æœºå™¨äººè¿›è¡Œæé—®ï¼‰ã€‚\næ¦œæ ·ä½œç”¨ ä¸»è¦è´Ÿè´£äººè‡ªä¸»æ€§åœ°é«˜æ•ˆç‡å®Œæˆå·¥ä½œï¼Œå°½é‡å°‘ä¼ æ’­è´Ÿé¢çš„ä¿¡æ¯ã€‚è´Ÿè´£äººä¸»åŠ¨å»æ‰§è¡Œå…¬å¸è§„ç« å’Œåœ¨ç–«æƒ…æœŸé—´å‘æŒ¥è¡¨ç‡ä½œç”¨ï¼Œä¸ºå…¶ä»–åŒäº‹æä¾›è‰¯å¥½çš„è¡¨ç‡ï¼Œå°åˆ°è¯·å‡æµç¨‹çš„è§„èŒƒï¼Œå¤§åˆ°å¯¹ç–«åŒºåŒäº‹çš„ç”Ÿæ´»çš„å…³å¿ƒå’Œæ”¯æŒã€‚æ¦œæ ·çš„ä½œç”¨ï¼Œå¯ä»¥è®©åŒäº‹ä»¬å¿ƒå®‰ï¼Œæ›´å¿«çš„æŠ•å…¥åˆ°å·¥ä½œå½“ä¸­ï¼Œé½å¿ƒååŠ›ï¼Œå…±åŒåº¦è¿‡éš¾å…³ã€‚\nå®‰å…¨ä¿éšœ  å®‰å…¨ç¬¬ä¸€ï¼å®‰å…¨ç¬¬ä¸€ï¼å®‰å…¨ç¬¬ä¸€ï¼é‡è¦çš„äº‹æƒ…è¯´ä¸‰éã€‚   é“è·¯åƒä¸‡æ¡ï¼Œå®‰å…¨ç¬¬ä¸€æ¡ã€‚åœ¨è¿™ä¸ªç‰¹æ®Šçš„æ—¶æœŸï¼Œæˆ‘ä»¬åšçš„æ‰€æœ‰åŠªåŠ›å…¶å®éƒ½æ˜¯å»ºç«‹åœ¨è‡ªèº«å®‰å…¨çš„å‰æä¸‹ï¼Œå¦‚æœæ²¡æœ‰è‡ªèº«å®‰å…¨ï¼Œé‚£ä¹ˆä¸€åˆ‡å·¥ä½œå°±éƒ½å˜çš„æ²¡æœ‰æ„ä¹‰äº†ã€‚\nä¸‹é¢ä»‹ç»ä¸€äº›åœ¨ä¸åŒåœºåˆä¸­çš„å®‰å…¨å»ºè®®ï¼š\nä¸Šç­è·¯ä¸Š å°½é‡é¿å…ä¹˜åå…¬å…±äº¤é€šï¼Œå»ºè®®æ­¥è¡Œã€éª‘è¡Œæˆ–ä¹˜åç§å®¶è½¦ä¸Šç­ã€‚å¦‚å¿…é¡»ä¹˜åå…¬å…±äº¤é€šå·¥å…·æ—¶ï¼ŒåŠ¡å¿…å…¨ç¨‹ä½©æˆ´å£ç½©ï¼Œé€”ä¸­å°½é‡é¿å…ç”¨æ‰‹è§¦æ‘¸è½¦ä¸Šç‰©å“ã€‚\næˆ´å£ç½©çš„åŒæ—¶ä¹Ÿè¦æˆ´ä¸Šæ‰‹å¥—ï¼ˆå†¬å¤©çš„æ‰‹å¥—æˆ–è€…æˆ·å¤–æ‰‹å¥—çš†å¯ï¼‰ï¼Œåœ¨åœ°é“ã€æ±½è½¦å’Œå…¬å…±åœºæ‰€ä¸è¦æ‘˜ä¸‹æ‰‹å¥—ã€‚åŒæ ·è¦å°å¿ƒæ¥¼æ¢¯æ‰¶æ‰‹ã€ç”µæ¢¯æŒ‰é’®ã€‚å°½é‡è¿œç¦»ä»–äºº1ç±³ï¼šç‰¹åˆ«æ˜¯åœ¨å…¬å…±åœºæ‰€æ—¶ï¼Œåº”è¯¥é€‚å½“ä¸ä»–äººä¿æŒè·ç¦»ã€‚å¦‚åœ¨è·¯ä¸Šæ—¶ï¼Œå°½å¯èƒ½è¿œç¦»å…¶ä»–äººï¼ˆè‡³å°‘1ç±³ï¼‰ã€‚\nåˆ°è¾¾å›­åŒºä¹‹åï¼Œå°½é‡èµ°æ¥¼æ¢¯ï¼Œä¸è¦ä¹˜ç”µæ¢¯ã€‚\nç…§ç‰‡æä¾›äººï¼š@ç‹æ²›\nåŠå…¬å®¤å†…  åŠå…¬å®¤å†…ä¸å¼€ä¸­å¤®ç©ºè°ƒï¼Œè¯·å¢æ·»è¡£ç‰©   ä¿æŒåŠå…¬åŒºç¯å¢ƒæ¸…æ´ï¼Œå»ºè®®æ¯æ—¥é€šé£3æ¬¡ï¼Œæ¯æ¬¡20-30åˆ†é’Ÿï¼Œé€šé£æ—¶æ³¨æ„ä¿æš–ã€‚äººä¸äººä¹‹é—´ä¿æŒ1ç±³ä»¥ä¸Šè·ç¦»ï¼ŒåŠå…¬å®¤ä¸­ä¸è¦æ‘˜é™¤å£ç½©ï¼Œå¹¶ä¸”ä¸è¦æ‰“å¼€ä¸­å¤®ç©ºè°ƒï¼Œè¯·å¢æ·»è¡£ç‰©ã€‚\nåˆ°è¾¾å…¬å¸çš„ç¬¬ä¸€ä»¶äº‹ï¼Œå…ˆæ´—æ‰‹ï¼Œä¹‹åå†æ¸…ç†å·¥ä½ï¼Œæœ‰æ¡ä»¶çš„åŒå­¦ä½¿ç”¨é…’ç²¾æˆ–è€…æ¶ˆæ¯’æ¹¿å·¾å°†æ‰‹å¯ä»¥æ¥è§¦åˆ°çš„åœ°æ–¹è¿›è¡Œæ¶ˆæ¯’ï¼Œé”®ç›˜ã€é¼ æ ‡ã€ç¬”è®°æœ¬ã€æ¡Œé¢ç­‰éƒ½æ˜¯é¦–è¦æ¸…æ´ç›®æ ‡ã€‚åŒæ—¶ä¸è¦ç”¨æ‰‹è§¦æ‘¸çœ¼ç›ï¼Œæœ‰æ¡ä»¶çš„åŒå­¦å¯ä»¥å¸¦ä¸ŠæŠ¤ç›®é•œã€‚\nä¼šè®®å®¤å†… å·¥ä½œåŠå…¬ä¸­å‡å°‘ä¼šè®®ï¼ˆå¯ä»¥ç”¨è¿œç¨‹ä¼šè®®æ–¹å¼ä»£æ›¿ï¼‰ï¼Œå¦‚æœéè¦å¼€ä¼šéœ€è¦åšåˆ°ä»¥ä¸‹ä¸‰ç‚¹ï¼š\n ä¸ºå‚ä¼šäººå‘˜é…å¤‡ä¸€æ¬¡æ€§åŒ»ç”¨å£ç½©ç­‰ç‰©å“ï¼› ä¼šåœºåº§ä½é—´éš”å»ºè®®1ç±³ä»¥ä¸Šï¼› ä¼šè®®æ—¶é—´è¾ƒé•¿çš„å»ºè®®æ¯å°æ—¶é€šé£1æ¬¡ã€‚  åˆé¥­æ—¶é—´ é¥­å‰è¦æ´—æ‰‹ï¼Œå»ºè®®è‡ªå·±å¸¦é¥­ï¼Œå¸¦ç“¶è£…çŸ¿æ³‰æ°´ï¼Œä¸è¦å’Œåˆ«äººä¸€èµ·è¿›é¤ï¼Œå°¤å…¶ä¸è¦é¢å¯¹é¢è¿›é¤ï¼Œé¿å…è‚‰ç±»ç”Ÿé£Ÿã€‚å»ºè®®è¥å…»é…é¤ï¼Œæ¸…æ·¡é€‚å£ã€‚\nä¿æŒä¹è§‚çš„å¿ƒæ€ ç”±äºæˆ‘çš„æ¯äº²æ˜¯åŒ»ç”Ÿçš„ç¼˜æ•…ï¼Œåœ¨è¿™æ¬¡ç–«æƒ…æœŸé—´å¤šæ¬¡å¬è¯´æœ‰äººæ„Ÿè§‰è‡ªå·±å‡ºç°äº†è‚ºç‚ç—‡çŠ¶ï¼Œä½†æ˜¯æ£€æµ‹åå´ååˆ†æ­£å¸¸ï¼Œè¿™å°±æ˜¯ è¿‡åº¦ç„¦è™‘ å¼•å‘çš„èº«ä½“ä¸é€‚ã€‚\nå¯¹äºæ²¡æœ‰å»è¿‡ç–«åŒºï¼Œå¹¶ä¸”æ²¡æœ‰å’Œç–«åŒºå‡ºæ¥çš„äººè¿›è¡Œè¿‡æ¥è§¦çš„äººï¼Œä¸»è¦è¿˜æ˜¯åº”è¯¥æŠŠç²¾åŠ›æ”¾åœ¨é¢„é˜²å’Œæ¶ˆæ¯’ä¸Šï¼Œä¸è¦ç–‘ç¥ç–‘é¬¼ï¼Œä¿æŒä¹è§‚çš„å¿ƒæ€å’Œå……è¶³çš„ç¡çœ ï¼Œç›¸ä¿¡æˆ‘ä»¬ä¸€å®šèƒ½åº¦è¿‡è¿™æ¬¡çš„éš¾å…³ï¼\nå‚è€ƒèµ„æ–™  ç–«æƒ…ä¸‹çš„é˜¿é‡Œå‘˜å·¥ï¼Œçº¦å®šè¿™æ ·ä¸Šç­\n è°ƒæŸ¥å®Œ150ä¸ªè¿œç¨‹åŠå…¬å›¢é˜Ÿï¼Œæˆ‘ä»¬å‘ç°äº†è¿™å‡ ä¸ªçœŸç›¸\n å¼€å·¥åœ¨å³ï¼Œåœ¨åŠå…¬å®¤ä¸­å¦‚ä½•ç»ƒæˆâ€œç™¾æ¯’ä¸ä¾µâ€ï¼Ÿ\n  ","date":1581303146,"expirydate":-62135596800,"kind":"page","lang":"zh","lastmod":1581303146,"objectID":"684ee07e191732a3c83e7027cefa4b08","permalink":"https://guoxudong.io/post/work-4-home/","publishdate":"2020-02-10T10:52:26+08:00","relpermalink":"/post/work-4-home/","section":"post","summary":"åœ¨ç–«æƒ…æœŸé—´ï¼Œå¦‚ä½•å®‰å…¨æœ‰æ•ˆçš„ åœ¨å®¶/å…¬å¸ åŠå…¬","tags":["è¿œç¨‹åŠå…¬","é«˜æ•ˆåŠå…¬","å®‰å…¨åŠå…¬"],"title":"ç–«æƒ…æœŸé—´ã€åœ¨å®¶/å…¬å¸ã€‘è¿œç¨‹åŠå…¬æŒ‡å—","type":"post"},{"authors":["éƒ­æ—­ä¸œ"],"categories":["kubernetes"],"content":" å‰è¨€ è¯¥é¡¹ç›®è„±èƒäº mergeKubeConfig é¡¹ç›®ï¼Œæœ€æ—©å†™è¯¥é¡¹ç›®çš„ç›®çš„æ˜¯åœ¨ä¸€å †æ‚ä¹±æ— ç« çš„ kubeconfig ä¸­è‡ªç”±çš„åˆ‡æ¢ã€‚éšç€éœ€è¦æ“ä½œçš„ Kubernetes é›†ç¾¤è¶Šæ¥è¶Šå¤šï¼Œåœ¨ä¸åŒçš„é›†ç¾¤ä¹‹é—´åˆ‡æ¢ä¹Ÿè¶Šæ¥è¶Šéº»çƒ¦ï¼Œè€Œæ“ä½œ Kubernetes é›†ç¾¤çš„æœ¬è´¨ä¸è¿‡æ˜¯é€šè¿‡ kubeconfig è®¿é—® Kubernetes é›†ç¾¤çš„ API Serverï¼Œä»¥æ“ä½œ Kubernetes çš„å„ç§èµ„æºï¼Œè€Œ kubeconfig ä¸è¿‡æ˜¯ä¸€ä¸ª yaml æ–‡ä»¶ï¼Œç”¨æ¥ä¿å­˜è®¿é—®é›†ç¾¤çš„å¯†é’¥ï¼Œæœ€æ—©çš„ mergeKubeConfig ä¸è¿‡æ˜¯ä¸€ä¸ªæ“ä½œ yaml æ–‡ä»¶çš„ Python è„šæœ¬ã€‚è€Œéšç€ golang å­¦ä¹ çš„æ·±å…¥ï¼Œä¹Ÿå°±åŠ¨äº†é‡å†™è¿™ä¸ªé¡¹ç›®çš„å¿µå¤´ï¼Œå°±è¿™æ · kubecm è¯ç”Ÿäº†ã€‚\nkubecm kubecm ç”± golang ç¼–å†™ï¼Œæ”¯æŒ Mac Linux å’Œ windows å¹³å°ï¼Œdelete rename switch æä¾›æ¯”è¾ƒå®ç”¨çš„äº¤äº’å¼çš„æ“ä½œï¼Œç›®å‰çš„åŠŸèƒ½åŒ…æ‹¬ï¼š\n add ï¼šæ·»åŠ æ–°çš„ kubeconfig åˆ° $HOME/.kube/config ä¸­ completion ï¼šå‘½ä»¤è¡Œè‡ªåŠ¨è¡¥å…¨åŠŸèƒ½ deleteï¼šåˆ é™¤å·²æœ‰çš„ context ï¼Œæä¾›äº¤äº’å¼å’ŒæŒ‡å®šåˆ é™¤ä¸¤ç§æ–¹å¼ mergeï¼šå°†æŒ‡å®šç›®å½•ä¸­çš„ kubeconfig åˆå¹¶ä¸ºä¸€ä¸ª kubeconfig æ–‡ä»¶ renameï¼šé‡åæŒ‡å®šçš„ contextï¼Œæä¾›äº¤äº’å¼å’ŒæŒ‡å®šé‡å‘½åä¸¤ç§æ–¹å¼ switchï¼šäº¤äº’å¼åˆ‡æ¢ context  å®‰è£… kubecm æ”¯æŒ Mac Linux å’Œ windows å¹³å°ï¼Œå®‰è£…æ–¹å¼ä¹Ÿæ¯”è¾ƒç®€å•ï¼š\nMacOS  ä½¿ç”¨ brew æˆ–è€…ç›´æ¥ä¸‹è½½äºŒè¿›åˆ¶å¯æ‰§è¡Œæ–‡ä»¶   brew install sunny0826/tap/kubecm  Linux  ä¸‹è½½äºŒè¿›åˆ¶å¯æ‰§è¡Œæ–‡ä»¶   # linux x86_64 curl -Lo kubecm.tar.gz https://github.com/sunny0826/kubecm/releases/download/v${VERSION}/kubecm_${VERSION}_Linux_x86_64.tar.gz tar -zxvf kubecm.tar.gz kubecm cd kubecm sudo mv kubecm /usr/local/bin/  Windows  ä¸‹è½½äºŒè¿›åˆ¶å¯æ‰§è¡Œæ–‡ä»¶ï¼Œå¹¶å°†æ–‡ä»¶ç§»åŠ¨åˆ° $PATH ä¸­å³å¯   å‘½ä»¤è¡Œè‡ªåŠ¨è¡¥å…¨  kubecm æä¾›äº†å’Œ kubectl ä¸€æ ·çš„ completion å‘½ä»¤è¡Œè‡ªåŠ¨è¡¥å…¨åŠŸèƒ½ï¼ˆæ”¯æŒ bash/zshï¼‰   ä»¥ zsh ä¸ºä¾‹ï¼Œåœ¨ $HOME/.zshrc ä¸­æ·»åŠ \nsource \u0026lt;(kubecm completion zsh)  ç„¶åä½¿ç”¨ source å‘½ä»¤ï¼Œä½¿å…¶ç”Ÿæ•ˆ\nsource $HOME/.zshrc  ä¹‹åï¼Œåœ¨è¾“å…¥ kubecm åæŒ‰ tab é”®ï¼Œå°±å¯ä»¥çœ‹åˆ°å‘½ä»¤è¡Œè‡ªåŠ¨è¡¥å…¨çš„å†…å®¹\næ“ä½œ kubeconfig  kubecm å¯ä»¥å®ç° kubeconfig çš„æŸ¥çœ‹ã€æ·»åŠ ã€åˆ é™¤ã€åˆå¹¶ã€é‡å‘½åå’Œåˆ‡æ¢   æŸ¥çœ‹ # æŸ¥çœ‹ $HOME/.kube/config ä¸­æ‰€æœ‰çš„ context kubecm  æ·»åŠ  # æ·»åŠ  example.yaml åˆ° $HOME/.kube/config.yamlï¼Œè¯¥æ–¹å¼ä¸ä¼šè¦†ç›–æº kubeconfigï¼Œåªä¼šåœ¨å½“å‰ç›®å½•ä¸­ç”Ÿæˆä¸€ä¸ª config.yaml æ–‡ä»¶ kubecm add -f example.yaml # åŠŸèƒ½åŒä¸Šï¼Œä½†æ˜¯ä¼šå°† example.yaml ä¸­çš„ context å‘½åä¸º test kubecm add -f example.yaml -n test # æ·»åŠ  -c ä¼šè¦†ç›–æº kubeconfig kubecm add -f example.yaml -c  åˆ é™¤ # äº¤äº’å¼åˆ é™¤ kubecm delete # åˆ é™¤æŒ‡å®š context kubecm delete my-context  åˆå¹¶ # åˆå¹¶ test ç›®å½•ä¸­çš„ kubeconfig,è¯¥æ–¹å¼ä¸ä¼šè¦†ç›–æº kubeconfigï¼Œåªä¼šåœ¨å½“å‰ç›®å½•ä¸­ç”Ÿæˆä¸€ä¸ª config.yaml æ–‡ä»¶ kubecm merge -f test # æ·»åŠ  -c ä¼šè¦†ç›–æº kubeconfig kubecm merge -f test -c  é‡å‘½å # äº¤äº’å¼é‡å‘½å kubecm rename # å°† dev é‡å‘½åä¸º test kubecm rename -o dev -n test # é‡å‘½å current-context ä¸º dev kubecm rename -n dev -c  åˆ‡æ¢é»˜è®¤ namespace # äº¤äº’å¼åˆ‡æ¢ namespace kubecm namespace # æˆ–è€… kubecm ns # åˆ‡æ¢é»˜è®¤ namespace ä¸º kube-system kubecm ns kube-system  æ•ˆæœå±•ç¤º è§†é¢‘ä»‹ç»   ç»“è¯­ kubecm é¡¹ç›®çš„åˆè¡·ä¸ºå­¦ä¹  golang å¹¶ç†Ÿæ‚‰ client-go çš„ä½¿ç”¨ï¼Œéšç€ä½¿ç”¨çš„æ·±å…¥ï¼Œæ–­æ–­ç»­ç»­å¢åŠ äº†ä¸å°‘åŠŸèƒ½ï¼Œå¼€å‘å‡ºäº†ä¸€ä¸ªçœ‹ä¸Šå»è¿˜ç®—æ­£è§„çš„é¡¹ç›®ã€‚æ€»çš„æ¥è¯´éƒ½æ˜¯æ ¹æ®è‡ªå·±çš„å–œå¥½æ¥å¼€å‘çš„ä¸šä½™é¡¹ç›®ï¼Œæ¬¢è¿å„ä½é€šè¿‡ ISSUE æ¥è¿›è¡Œäº¤æµå’Œè®¨è®ºã€‚\n","date":1575857266,"expirydate":-62135596800,"kind":"page","lang":"zh","lastmod":1575857266,"objectID":"c71ec97d1a710872078b68a80210ac7c","permalink":"https://guoxudong.io/post/kubecm/","publishdate":"2019-12-09T10:07:46+08:00","relpermalink":"/post/kubecm/","section":"post","summary":"ä»‹ç»ä¸€æ¬¾å°å·¥å…·ï¼škubecmï¼Œå¸®åŠ©ä½ ç®¡ç†æ‚ä¹±æ— ç« çš„ kubeconfigã€‚ ","tags":["kubernetes"],"title":"Kubecmï¼šç®¡ç†ä½ çš„ kubeconfig","type":"post"},{"authors":["éƒ­æ—­ä¸œ"],"categories":["kubernetes"],"content":" å‰è¨€ è¿™æ¬¡è¦ä»‹ç»ä¸€ä¸ª Kubernetes èµ„æºè§‚æµ‹å·¥å…·ï¼Œå®æ—¶ç›‘æ§ Kubernetes é›†ç¾¤ä¸­å„ç§èµ„æºçš„æ–°å»ºã€æ›´æ–°å’Œåˆ é™¤ï¼Œå¹¶å®æ—¶é€šçŸ¥åˆ°å„ç§åä½œè½¯ä»¶/èŠå¤©è½¯ä»¶ï¼Œç›®å‰æ”¯æŒçš„é€šçŸ¥æ¸ é“æœ‰ï¼š\n slack hipchat mattermost flock webhook  æˆ‘è¿™è¾¹å¼€å‘äº†é’‰é’‰çš„é€šçŸ¥æ¸ é“ï¼Œä½†æ˜¯åœ¨ä¸Šæ¸¸ ISSUE#198 ä¸­æå‡ºçš„è´¡çŒ®è¯·æ±‚å¹¶æ²¡æœ‰å¾—åˆ°å›åº”ï¼Œæ‰€ä»¥è¿™è¾¹åªèƒ½ fork äº†ä»£ç ï¼Œç„¶åè‡ªå·±è¿›è¡Œäº†å¼€å‘ï¼Œä»¥æ”¯æŒé’‰é’‰é€šçŸ¥ã€‚\nå®‰è£… è¿™é‡Œæ¨èä½¿ç”¨ helm è¿›è¡Œå®‰è£…ï¼Œå¿«é€Ÿéƒ¨ç½²\nhelm install kubewatch stable/kubewatch \\ --set rbac.create=true \\ --set slack.channel='#YOUR_CHANNEL' \\ --set slack.token='xoxb-YOUR_TOKEN' \\ --set resourcesToWatch.pod=true \\ --set resourcesToWatch.daemonset=true  å¦‚æœæƒ³ä½¿ç”¨é’‰é’‰é€šçŸ¥ï¼Œåˆ™å¯ä»¥åœ¨ GitHub ä¸Šæ‹‰å–æˆ‘çš„ä»£ç ï¼Œä»£ç ä¸­åŒ…å« helm chart åŒ…ï¼Œå¯ç›´æ¥è¿›è¡Œå®‰è£…\ngit clone https://github.com/sunny0826/kubewatch-chat.git cd kubewatch-chat helm install kubewatch kubewatch \\ --set dingtalk.sign=\u0026quot;XXX\u0026quot; \\ --set dingtalk.token=\u0026quot;XXXX-XXXX-XXXX\u0026quot;  é’‰é’‰é…ç½® åœ¨é’‰é’‰ä¸­åˆ›å»º æ™ºèƒ½ç¾¤åŠ©æ‰‹ ï¼Œä¹‹å\nè·å– token å¤åˆ¶çš„ webhook ä¸­ https://oapi.dingtalk.com/robot/send?access_token={YOUR_TOKEN}, {YOUR_TOKEN} å°±æ˜¯è¦å¡«å…¥çš„ tokenã€‚\nå®‰å…¨è®¾ç½® é’‰é’‰æ™ºèƒ½ç¾¤åŠ©æ‰‹åœ¨æ›´æ–°åæ–°å¢äº†å®‰å…¨è®¾ç½®ï¼Œæä¾›ä¸‰ç§éªŒè¯æ–¹å¼ è‡ªå®šä¹‰å…³é”®è¯ åŠ ç­¾ IPåœ°å€ï¼ˆæ®µï¼‰ï¼Œè¿™é‡Œæ¨èä½¿ç”¨ IPåœ°å€ï¼ˆæ®µï¼‰çš„æ–¹å¼ï¼Œç›´æ¥å°† Kubernetes é›†ç¾¤çš„å‡ºå£ IP å¡«å…¥è®¾ç½®å³å¯ã€‚åŒæ—¶ä¹Ÿæä¾›äº† åŠ ç­¾ çš„æ–¹å¼ï¼Œæ‹·è´ç§˜é’¥ï¼Œå°†å…¶å¡«å…¥ dingtalk.sign ä¸­ã€‚\né¡¹ç›®é…ç½® ç¼–è¾‘ kubewatch/value.yaml ï¼Œä¿®æ”¹é…ç½®\n## Global Docker image parameters ## Please, note that this will override the image parameters, including dependencies, configured to use the global value ## Current available global Docker image parameters: imageRegistry and imagePullSecrets ## # global: # imageRegistry: myRegistryName # imagePullSecrets: # - myRegistryKeySecretName slack: enabled: false channel: \u0026quot;\u0026quot; token: \u0026quot;xoxb\u0026quot; hipchat: enabled: false # room: \u0026quot;\u0026quot; # token: \u0026quot;\u0026quot; # url: \u0026quot;\u0026quot; mattermost: enabled: false # channel: \u0026quot;\u0026quot; # url: \u0026quot;\u0026quot; # username: \u0026quot;\u0026quot; flock: enabled: false # url: \u0026quot;\u0026quot; webhook: enabled: false # url: \u0026quot;\u0026quot; dingtalk: enabled: true token: \u0026quot;\u0026quot; sign: \u0026quot;\u0026quot; # namespace to watch, leave it empty for watching all. namespaceToWatch: \u0026quot;\u0026quot; # Resources to watch resourcesToWatch: deployment: true replicationcontroller: false replicaset: false daemonset: false services: false pod: true job: false persistentvolume: false image: registry: docker.io # repository: bitnami/kubewatch repository: guoxudongdocker/kubewatch-chart # tag: 0.0.4-debian-9-r405 tag: latest pullPolicy: Always ## Optionally specify an array of imagePullSecrets. ## Secrets must be manually created in the namespace. ## ref: https://kubernetes.io/docs/tasks/configure-pod-container/pull-image-private-registry/ ## # pullSecrets: # - myRegistryKeySecretName ## String to partially override kubewatch.fullname template (will maintain the release name) ## # nameOverride: ## String to fully override kubewatch.fullname template ## # fullnameOverride: rbac: # If true, create \u0026amp; use RBAC resources # create: true serviceAccount: # Specifies whether a ServiceAccount should be created create: true # The name of the ServiceAccount to use. # If not set and create is true, a name is generated using the fullname template name: resources: {} # limits: # cpu: 100m # memory: 300Mi # requests: # cpu: 100m # memory: 300Mi # Affinity for pod assignment # Ref: https://kubernetes.io/docs/concepts/configuration/assign-pod-node/#affinity-and-anti-affinity # affinity: {} # Tolerations for pod assignment # Ref: https://kubernetes.io/docs/concepts/configuration/taint-and-toleration/ tolerations: [] # Node labels for pod assignment # Ref: https://kubernetes.io/docs/user-guide/node-selection/ nodeSelector: {} podAnnotations: {} podLabels: {} replicaCount: 1  ä½¿ç”¨ value.yaml å®‰è£…\ngit clone https://github.com/sunny0826/kubewatch-chat.git cd kubewatch-chat helm install my-release -f kubewatch/values.yaml  Slack é…ç½® Slack ä¸º kubewatch é»˜è®¤çš„é€šçŸ¥è½¯ä»¶ï¼Œè¿™é‡Œå°±ä¸ç®€ä»‹ Slack çš„å®‰è£…å’Œæ³¨å†Œï¼Œç›´æ¥ä»åˆ›å»º APP å¼€å§‹\nåˆ›å»ºä¸€ä¸ª APP è¿›å»åˆ›å»º APP é¡µé¢\né€‰æ‹© App Name å’Œ Development Slack Workspace\næ·»åŠ  Bot ç”¨æˆ· æ·»åŠ  App åˆ° Workspace è·å– Bot-token é€šçŸ¥æ•ˆæœ åœ¨ Slack ä¸­ï¼Œåˆ›å»º æ›´æ–° åˆ é™¤ åˆ†åˆ«ä»¥ç»¿ã€é»„å’Œçº¢è‰²ä»£è¡¨\nåœ¨é’‰é’‰ä¸­ï¼Œæˆ‘è¿›è¡Œäº†æ±‰åŒ–\nç»“è¯­ å¯¹äº kubewatch æˆ‘ä»¬è¿™é‡Œä¸»è¦ç”¨ä½œç›‘æ§å„ç§ CronJob çš„å®šæ—¶è§¦å‘çŠ¶æ€ï¼Œå·²ç» ConfigMap å’Œ Secrets çš„çŠ¶æ€å˜åŒ–ï¼ŒåŒæ—¶ä¹Ÿè§‚å¯Ÿ HPA è§¦å‘çš„å¼¹æ€§ä¼¸ç¼©çš„çŠ¶æ€ï¼Œå¯ä»¥å®æ—¶è§‚æµ‹åˆ°ä¸šåŠ¡é«˜å³°çš„åˆ°æ¥ï¼Œæ˜¯ä¸€ä¸ªä¸é”™çš„å°å·¥å…·ã€‚\n","date":1575450591,"expirydate":-62135596800,"kind":"page","lang":"zh","lastmod":1575450591,"objectID":"f2b91b63275f7fbab7fa86f4fcc1705d","permalink":"https://guoxudong.io/post/kubewatch/","publishdate":"2019-12-04T17:09:51+08:00","relpermalink":"/post/kubewatch/","section":"post","summary":"ç”¨äºè§‚æµ‹ Kubernetes èµ„æºæƒ…å†µï¼Œå¹¶å®æ—¶é€šçŸ¥åˆ°å„ç§åä½œè½¯ä»¶/èŠå¤©è½¯ä»¶","tags":["kubernetes","å®¹å™¨"],"title":"å°å·¥å…·ä»‹ç»ï¼šKubeWatch","type":"post"},{"authors":["éƒ­æ—­ä¸œ"],"categories":["kubernetes"],"content":" å‰è¨€ åœ¨è¿‘æ—¥çš„ä¸€ä¸ªé£å’Œæ—¥ä¸½çš„ä¸‹åˆï¼Œæ­£åœ¨å¿«ä¹çš„å†™ bug æ—¶ï¼Œçªç„¶é—´é’‰é’‰å°±è¢« call çˆ†äº†ï¼ŒåŸæ¥æ˜¯ k8s æµ‹è¯•é›†ç¾¤çš„ä¸€ä¸ª namespace çªç„¶ä¸è§äº†ã€‚è¿™ä¸ª namespace é‡Œé¢æœ‰ 60 å¤šä¸ªæœåŠ¡ï¼Œç¬é—´å…¨éƒ¨æ²¡æœ‰äº†â€¦â€¦è™½ç„¶å¾—ç›Šäºæˆ‘ä»¬çš„ CI/CD ç³»ç»Ÿï¼Œè¿™äº›æœåŠ¡å¾ˆå¿«éƒ½é‡æ–°éƒ¨ç½²å¹¶æ­£å¸¸è¿è¡Œäº†ï¼Œä½†æ˜¯å¦‚æœåœ¨ç”Ÿäº§ç¯å¢ƒï¼Œé‚£åæœå°±æ˜¯ä¸å¯æƒ³è±¡çš„äº†ã€‚åœ¨æ’æŸ¥è¿™ä¸ªé—®é¢˜å‘ç”Ÿçš„åŸå› çš„åŒæ—¶ï¼Œé›†ç¾¤èµ„æºçš„ç¾å¤‡å’Œæ¢å¤åŠŸèƒ½å°±æä¸Šæ—¥ç¨‹äº†ï¼Œè¿™æ—¶ Velero å°±å‡ºç°äº†ã€‚\nVelero Velero æ˜¯ VMWare å¼€æºçš„ k8s é›†ç¾¤å¤‡ä»½ã€è¿ç§»å·¥å…·ã€‚å¯ä»¥å¸®åŠ©æˆ‘ä»¬å®Œæˆ k8s çš„ä¾‹è¡Œå¤‡ä»½å·¥ä½œï¼Œä»¥ä¾¿åœ¨å‡ºç°ä¸Šé¢é—®é¢˜çš„æ—¶å€™å¯ä»¥å¿«é€Ÿè¿›è¡Œæ¢å¤ã€‚åŒæ—¶ä¹Ÿæä¾›äº†é›†ç¾¤è¿ç§»åŠŸèƒ½ï¼Œå¯ä»¥å°† k8s èµ„æºè¿ç§»åˆ°å…¶ä»– k8s é›†ç¾¤çš„åŠŸèƒ½ã€‚Velero å°†é›†ç¾¤èµ„æºä¿å­˜åœ¨å¯¹è±¡å­˜å‚¨ä¸­ï¼Œé»˜è®¤æƒ…å†µä¸‹å¯ä»¥ä½¿ç”¨ AWSã€Azureã€GCP çš„å¯¹è±¡å­˜å‚¨ï¼ŒåŒæ—¶ä¹Ÿç»™å‡ºäº†æ’ä»¶åŠŸèƒ½ç”¨æ¥æ‹“å±•å…¶ä»–å¹³å°çš„å­˜å‚¨ï¼Œè¿™é‡Œæˆ‘ä»¬ç”¨åˆ°çš„å°±æ˜¯é˜¿é‡Œäº‘çš„å¯¹è±¡å­˜å‚¨ OSSï¼Œé˜¿é‡Œäº‘ä¹Ÿæä¾›äº† Velero çš„æ’ä»¶ï¼Œç”¨äºå°†å¤‡ä»½å­˜å‚¨åˆ° OSS ä¸­ã€‚ä¸‹é¢æˆ‘å°±ä»‹ç»ä¸€ä¸‹å¦‚ä½•åœ¨é˜¿é‡Œäº‘å®¹å™¨æœåŠ¡ ACK ä½¿ç”¨ Velero å®Œæˆå¤‡ä»½å’Œè¿ç§»ã€‚\n Velero åœ°å€ï¼šhttps://github.com/vmware-tanzu/velero\nACK æ’ä»¶åœ°å€ï¼šhttps://github.com/AliyunContainerService/velero-plugin\n ä¸‹è½½ Velero å®¢æˆ·ç«¯ Velero ç”±å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ç»„æˆï¼ŒæœåŠ¡å™¨éƒ¨ç½²åœ¨ç›®æ ‡ k8s é›†ç¾¤ä¸Šï¼Œè€Œå®¢æˆ·ç«¯åˆ™æ˜¯è¿è¡Œåœ¨æœ¬åœ°çš„å‘½ä»¤è¡Œå·¥å…·ã€‚\n å‰å¾€ Velero çš„ Release é¡µé¢ ä¸‹è½½å®¢æˆ·ç«¯ï¼Œç›´æ¥åœ¨ GitHub ä¸Šä¸‹è½½å³å¯ è§£å‹ release åŒ… å°† release åŒ…ä¸­çš„äºŒè¿›åˆ¶æ–‡ä»¶ velero ç§»åŠ¨åˆ° $PATH ä¸­çš„æŸä¸ªç›®å½•ä¸‹ æ‰§è¡Œ velero -h æµ‹è¯•  åˆ›å»º OSS bucket åˆ›å»ºä¸€ä¸ª OSS bucket ç”¨äºå­˜å‚¨å¤‡ä»½æ–‡ä»¶ï¼Œè¿™é‡Œä¹Ÿå¯ä»¥ç”¨å·²æœ‰çš„ bucketï¼Œä¹‹åä¼šåœ¨ bucket ä¸­åˆ›å»º backupsã€metadataã€restoresä¸‰ä¸ªç›®å½•ï¼Œè¿™é‡Œå»ºè®®åœ¨å·²æœ‰çš„ bucket ä¸­åˆ›å»ºä¸€ä¸ªå­ç›®å½•ç”¨äºå­˜å‚¨å¤‡ä»½æ–‡ä»¶ã€‚\nåˆ›å»º OSS çš„æ—¶å€™ä¸€å®šè¦é€‰å¯¹åŒºåŸŸï¼Œè¦å’Œ ACK é›†ç¾¤åœ¨åŒä¸€ä¸ªåŒºåŸŸï¼Œå­˜å‚¨ç±»å‹å’Œè¯»å†™æƒé™é€‰æ‹©æ ‡å‡†å­˜å‚¨å’Œç§æœ‰ï¼š\nåˆ›å»ºé˜¿é‡Œäº‘ RAM ç”¨æˆ· è¿™é‡Œéœ€è¦åˆ›å»ºä¸€ä¸ªé˜¿é‡Œäº‘ RAM çš„ç”¨æˆ·ï¼Œç”¨äºæ“ä½œ OSS ä»¥åŠ ACK èµ„æºã€‚\n æ–°å»ºæƒé™ç­–ç•¥\nç­–ç•¥å†…å®¹ï¼š\n{ \u0026quot;Version\u0026quot;: \u0026quot;1\u0026quot;, \u0026quot;Statement\u0026quot;: [ { \u0026quot;Action\u0026quot;: [ \u0026quot;ecs:DescribeSnapshots\u0026quot;, \u0026quot;ecs:CreateSnapshot\u0026quot;, \u0026quot;ecs:DeleteSnapshot\u0026quot;, \u0026quot;ecs:DescribeDisks\u0026quot;, \u0026quot;ecs:CreateDisk\u0026quot;, \u0026quot;ecs:Addtags\u0026quot;, \u0026quot;oss:PutObject\u0026quot;, \u0026quot;oss:GetObject\u0026quot;, \u0026quot;oss:DeleteObject\u0026quot;, \u0026quot;oss:GetBucket\u0026quot;, \u0026quot;oss:ListObjects\u0026quot; ], \u0026quot;Resource\u0026quot;: [ \u0026quot;*\u0026quot; ], \u0026quot;Effect\u0026quot;: \u0026quot;Allow\u0026quot; } ] }  æ–°å»ºç”¨æˆ·\nåœ¨æ–°å»ºç”¨æˆ·çš„æ—¶å€™è¦é€‰æ‹© ç¼–ç¨‹è®¿é—®ï¼Œæ¥è·å– AccessKeyID å’Œ AccessKeySecretï¼Œè¿™é‡Œè¯·åˆ›å»ºä¸€ä¸ªæ–°ç”¨äºç”¨äºå¤‡ä»½ï¼Œä¸è¦ä½¿ç”¨è€ç”¨æˆ·çš„ AK å’Œ ASã€‚\n  éƒ¨ç½²æœåŠ¡ç«¯  æ‹‰å– Velero æ’ä»¶ åˆ°æœ¬åœ°\ngit clone https://github.com/AliyunContainerService/velero-plugin  é…ç½®ä¿®æ”¹\n ä¿®æ”¹ install/credentials-velero æ–‡ä»¶ï¼Œå°†æ–°å»ºç”¨æˆ·ä¸­è·å¾—çš„ AccessKeyID å’Œ AccessKeySecret å¡«å…¥ï¼Œè¿™é‡Œçš„ OSS EndPoint ä¸ºä¹‹å‰ OSS çš„è®¿é—®åŸŸåï¼ˆæ³¨ï¼šè¿™é‡Œéœ€è¦é€‰æ‹©å¤–ç½‘è®¿é—®çš„ EndPointã€‚ï¼‰ï¼š\nALIBABA_CLOUD_ACCESS_KEY_ID=\u0026lt;ALIBABA_CLOUD_ACCESS_KEY_ID\u0026gt; ALIBABA_CLOUD_ACCESS_KEY_SECRET=\u0026lt;ALIBABA_CLOUD_ACCESS_KEY_SECRET\u0026gt; ALIBABA_CLOUD_OSS_ENDPOINT=\u0026lt;ALIBABA_CLOUD_OSS_ENDPOINT\u0026gt;  ä¿®æ”¹ install/01-velero.yamlï¼Œå°† OSS é…ç½®å¡«å…¥ï¼š\n--- apiVersion: velero.io/v1 kind: BackupStorageLocation metadata: labels: component: velero name: default namespace: velero spec: config: {} objectStorage: bucket: \u0026lt;ALIBABA_CLOUD_OSS_BUCKET\u0026gt; # OSS bucket åç§° prefix: \u0026lt;OSS_PREFIX\u0026gt; # bucket å­ç›®å½• provider: alibabacloud --- apiVersion: velero.io/v1 kind: VolumeSnapshotLocation metadata: labels: component: velero name: default namespace: velero spec: config: region: \u0026lt;REGION\u0026gt; # åœ°åŸŸï¼Œå¦‚æœæ˜¯åä¸œ2ï¼ˆä¸Šæµ·ï¼‰ï¼Œåˆ™ä¸º cn-shanghai provider: alibabacloud  k8s éƒ¨ç½² Velero æœåŠ¡\n# æ–°å»º namespace kubectl create namespace velero # éƒ¨ç½² credentials-velero çš„ secret kubectl create secret generic cloud-credentials --namespace velero --from-file cloud=install/credentials-velero # éƒ¨ç½² CRD kubectl apply -f install/00-crds.yaml # éƒ¨ç½² Velero kubectl apply -f install/01-velero.yaml  æµ‹è¯• Velero çŠ¶æ€\n$ velero version Client: Version: v1.1.0 Git commit: a357f21aec6b39a8244dd23e469cc4519f1fe608 Server: Version: v1.1.0  å¯ä»¥çœ‹åˆ° Velero çš„å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯å·²ç»éƒ¨ç½²æˆåŠŸã€‚\n æœåŠ¡ç«¯æ¸…ç†\nåœ¨å®Œæˆæµ‹è¯•æˆ–è€…éœ€è¦é‡æ–°å®‰è£…æ—¶ï¼Œæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤è¿›è¡Œæ¸…ç†ï¼š\nkubectl delete namespace/velero clusterrolebinding/velero kubectl delete crds -l component=velero    å¤‡ä»½æµ‹è¯• velero-plugin é¡¹ç›®ä¸­å·²ç»ç»™å‡º example ç”¨äºæµ‹è¯•å¤‡ä»½ã€‚\n éƒ¨ç½²æµ‹è¯•æœåŠ¡\nkubectl apply -f examples/base.yaml  å¯¹ nginx-example æ‰€åœ¨çš„ namespace è¿›è¡Œå¤‡ä»½\nvelero backup create nginx-backup --include-namespaces nginx-example --wait  æ¨¡æ‹Ÿ namespace è¢«è¯¯åˆ \nkubectl delete namespaces nginx-example  ä½¿ç”¨ Velero è¿›è¡Œæ¢å¤\nvelero restore create --from-backup nginx-backup --wait   é›†ç¾¤è¿ç§» è¿ç§»æ–¹æ³•åŒå¤‡ä»½ï¼Œåœ¨å¤‡ä»½ååˆ‡æ¢é›†ç¾¤ï¼Œåœ¨æ–°é›†ç¾¤æ¢å¤å¤‡ä»½å³å¯ã€‚\né«˜çº§ç”¨æ³•  å®šæ—¶å¤‡ä»½\nå¯¹é›†ç¾¤èµ„æºè¿›è¡Œå®šæ—¶å¤‡ä»½ï¼Œåˆ™å¯åœ¨å‘ç”Ÿæ„å¤–çš„æƒ…å†µä¸‹ï¼Œè¿›è¡Œæ¢å¤ï¼ˆé»˜è®¤æƒ…å†µä¸‹ï¼Œå¤‡ä»½ä¿ç•™ 30 å¤©ï¼‰ã€‚\n# æ¯æ—¥1ç‚¹è¿›è¡Œå¤‡ä»½ velero create schedule \u0026lt;SCHEDULE NAME\u0026gt; --schedule=\u0026quot;0 1 * * *\u0026quot; # æ¯æ—¥1ç‚¹è¿›è¡Œå¤‡ä»½ï¼Œå¤‡ä»½ä¿ç•™48å°æ—¶ velero create schedule \u0026lt;SCHEDULE NAME\u0026gt; --schedule=\u0026quot;0 1 * * *\u0026quot; --ttl 48h # æ¯6å°æ—¶è¿›è¡Œä¸€æ¬¡å¤‡ä»½ velero create schedule \u0026lt;SCHEDULE NAME\u0026gt; --schedule=\u0026quot;@every 6h\u0026quot; # æ¯æ—¥å¯¹ web namespace è¿›è¡Œä¸€æ¬¡å¤‡ä»½ velero create schedule \u0026lt;SCHEDULE NAME\u0026gt; --schedule=\u0026quot;@every 24h\u0026quot; --include-namespaces web  å®šæ—¶å¤‡ä»½çš„åç§°ä¸ºï¼š\u0026lt;SCHEDULE NAME\u0026gt;-\u0026lt;TIMESTAMP\u0026gt;ï¼Œæ¢å¤å‘½ä»¤ä¸ºï¼švelero restore create --from-backup \u0026lt;SCHEDULE NAME\u0026gt;-\u0026lt;TIMESTAMP\u0026gt;ã€‚\n å¤‡ä»½åˆ é™¤\nç›´æ¥æ‰§è¡Œå‘½ä»¤è¿›è¡Œåˆ é™¤\nvelero delete backups \u0026lt;BACKUP_NAME\u0026gt;  å¤‡ä»½èµ„æºæŸ¥çœ‹\nå¤‡ä»½æŸ¥çœ‹\nvelero backup get  æŸ¥çœ‹å®šæ—¶å¤‡ä»½\nvelero schedule get  æŸ¥çœ‹å¯æ¢å¤å¤‡ä»½\nvelero restore get  å¤‡ä»½æ’é™¤é¡¹ç›®\nå¯ä¸ºèµ„æºæ·»åŠ æŒ‡å®šæ ‡ç­¾ï¼Œæ·»åŠ æ ‡ç­¾çš„èµ„æºåœ¨å¤‡ä»½çš„æ—¶å€™è¢«æ’é™¤ã€‚\n# æ·»åŠ æ ‡ç­¾ kubectl label -n \u0026lt;ITEM_NAMESPACE\u0026gt; \u0026lt;RESOURCE\u0026gt;/\u0026lt;NAME\u0026gt; velero.io/exclude-from-backup=true # ä¸º default namespace æ·»åŠ æ ‡ç­¾ kubectl label -n default namespace/default velero.io/exclude-from-backup=true   é—®é¢˜æ±‡æ€» æ—¶åŒºé—®é¢˜ è¿›è¡Œå®šæ—¶å¤‡ä»½æ—¶ï¼Œå‘ç°å¤‡ä»½ä½¿ç”¨çš„äº‹ UTC æ—¶é—´ï¼Œå¹¶ä¸æ˜¯æœ¬åœ°æ—¶é—´ï¼Œç»è¿‡æ’æŸ¥åå‘ç°æ˜¯ velero é•œåƒçš„æ—¶åŒºé—®é¢˜ï¼Œåœ¨è°ƒæ•´åå°±ä¼šæ­£å¸¸å®šæ—¶å¤‡ä»½äº†ï¼Œè¿™é‡Œæˆ‘é‡æ–°è°ƒæ•´äº†æ—¶åŒºï¼Œç›´æ¥è°ƒæ•´é•œåƒå°±å¥½ï¼Œä¿®æ”¹ install/01-velero.yaml æ–‡ä»¶ï¼Œå°†é•œåƒæ›¿æ¢ä¸º registry-vpc.cn-shanghai.aliyuncs.com/keking/velero:latestã€‚\nimage: caption: \u0026quot;Image from: [**Pexels**](https://www.pexels.com)\u0026quot; focal_point: \u0026quot;\u0026quot; preview_only: false --- apiVersion: extensions/v1beta1 kind: Deployment metadata: name: velero namespace: velero spec: replicas: 1 selector: matchLabels: deploy: velero template: metadata: annotations: prometheus.io/path: /metrics prometheus.io/port: \u0026quot;8085\u0026quot; prometheus.io/scrape: \u0026quot;true\u0026quot; labels: component: velero deploy: velero spec: serviceAccountName: velero containers: - name: velero # sync from gcr.io/heptio-images/velero:latest image: registry-vpc.cn-shanghai.aliyuncs.com/keking/velero:latest # ä¿®å¤æ—¶åŒºåçš„é•œåƒ imagePullPolicy: IfNotPresent command: - /velero args: - server - --default-volume-snapshot-locations=alibabacloud:default env: - name: VELERO_SCRATCH_DIR value: /scratch - name: ALIBABA_CLOUD_CREDENTIALS_FILE value: /credentials/cloud volumeMounts: - mountPath: /plugins name: plugins - mountPath: /scratch name: scratch - mountPath: /credentials name: cloud-credentials initContainers: - image: registry.cn-hangzhou.aliyuncs.com/acs/velero-plugin-alibabacloud:v1.2 imagePullPolicy: IfNotPresent name: velero-plugin-alibabacloud volumeMounts: - mountPath: /target name: plugins volumes: - emptyDir: {} name: plugins - emptyDir: {} name: scratch - name: cloud-credentials secret: secretName: cloud-credentials  ç‰ˆæœ¬é—®é¢˜ æˆªæ­¢å‘ç¨¿æ—¶ï¼ŒVelero å·²ç»å‘å¸ƒäº† v1.2.0 ç‰ˆæœ¬ï¼Œç›®å‰ ACK çš„ Velero çš„æ’ä»¶è¿˜æœªå‡çº§ã€‚\nç»“è¯­ è¿‘æ—¥æ­£å¥½æœ‰ k8s é›†ç¾¤æœåŠ¡è¿ç§»æœåŠ¡çš„éœ€æ±‚ï¼Œä½¿ç”¨ Velero å®Œæˆäº†æœåŠ¡çš„è¿ç§»ï¼ŒåŒæ—¶ä¹Ÿæ¯æ—¥è¿›è¡Œé›†ç¾¤èµ„æºå¤‡ä»½ï¼Œå…¶èƒ½åŠ›å¯ä»¥æ»¡è¶³å®¹å™¨æœåŠ¡çš„ç¾å¤‡å’Œè¿ç§»åœºæ™¯ï¼Œå®æµ‹å¯ç”¨ï¼Œç°å·²è¿è¡Œåœ¨æ‰€æœ‰çš„ k8s é›†ç¾¤ã€‚\n","date":1573607602,"expirydate":-62135596800,"kind":"page","lang":"zh","lastmod":1573607602,"objectID":"c12bbc3b7b62a701db3f5eb2dd453273","permalink":"https://guoxudong.io/post/aliyun-velero/","publishdate":"2019-11-13T09:13:22+08:00","relpermalink":"/post/aliyun-velero/","section":"post","summary":"æœ¬æ–‡ä»‹ç»äº†ä½¿ç”¨ Velero æ¥è¿›è¡Œ k8s é›†ç¾¤èµ„æºè¿›è¡Œå¤‡ä»½å’Œè¿ç§»ã€‚","tags":["é˜¿é‡Œäº‘","kubernetes","velero"],"title":"ä½¿ç”¨ Velero è¿›è¡Œé›†ç¾¤å¤‡ä»½ä¸è¿ç§»","type":"post"},{"authors":["éƒ­æ—­ä¸œ"],"categories":["kubernetes"],"content":" å‰è¨€ å¯¹äºé˜¿é‡Œäº‘ç”¨æˆ·æ¥è¯´ï¼Œé˜¿é‡Œäº‘ç›‘æ§æ˜¯ä¸€ä¸ªå¾ˆä¸é”™çš„äº§å“ï¼Œé¦–å…ˆå®ƒåœ¨é…é¢å†…ä½¿ç”¨æ˜¯å…è´¹çš„ï¼å…è´¹çš„ï¼å…è´¹çš„ï¼é‡è¦çš„äº‹æƒ…è¯´ä¸‰éã€‚ä»–çš„åŠŸèƒ½ç±»ä¼¼äº zabbixï¼Œä½†æ˜¯æ¯” zabbix æä¾›äº†æ›´å¤šçš„ç›‘æ§é¡¹ï¼ŒåŸºæœ¬ä¸Šåœ¨äº‘ä¸Šä½¿ç”¨çš„èµ„æºéƒ½å¯ä»¥é€šè¿‡äº‘ç›‘æ§æ¥å®æ—¶ç›‘æ§ã€‚è€Œå®ƒæä¾›çš„å¼€ç®±å³ç”¨æ–¹å¼ï¼Œå¤©ç„¶é›†æˆäº‘èµ„æºï¼Œå¹¶æä¾›å¤šç§å‘Šè­¦æ–¹å¼ï¼Œå…å»äº†ç›‘æ§ä¸å‘Šè­¦ç³»ç»Ÿæ­å»ºä¸ç»´æŠ¤çš„ç¹çï¼Œå¹¶ä¸”å‡å°‘äº†èµ„æºçš„æ¶ˆè€—ï¼Œæ¯”è´­ä¹° ECS è‡ªå·±æ­å»º zabbix è¦å°‘æ¶ˆè€—å¾ˆå¤šèµ„æºã€‚åŒæ—¶é˜¿é‡Œäº‘ç›‘æ§å’Œé˜¿é‡Œäº‘å…¶ä»–æœåŠ¡ä¸€æ ·ï¼Œä¹Ÿæä¾›äº†æ¯”è¾ƒå®Œæ•´çš„ OpenApi ä»¥åŠå„ç§è¯­è¨€çš„ sdkï¼Œå¯ä»¥åŸºäºé˜¿é‡Œäº‘çš„ OpenApi å°†å…¶ä¸è‡ªå·±çš„ç³»ç»Ÿé›†æˆã€‚æˆ‘ä»¬ä¹‹å‰ä¹Ÿæ˜¯è¿™ä¹ˆåšçš„ï¼Œä½†æ˜¯éšç€ç›‘æ§é¡¹çš„å¢åŠ ï¼Œä»¥åŠç»å¸¸éœ€è¦åœ¨åŠå…¬åœºåœ°ç›‘æ§æŠ•å±çš„ä¸“é¡¹ç›‘æ§é¡µï¼Œå…‰å‡­æˆ‘ä»¬çš„è¿ç»´å¼€å‘å·¥ç¨‹å¸ˆä½¿ç”¨ vue å†™é€Ÿåº¦æ˜æ˜¾è·Ÿä¸ä¸Šï¼Œè€Œä¸”é¡µé¢çš„ç¾è§‚ç¨‹åº¦ä¹Ÿå·®å¾ˆå¤šã€‚\næ‰‹å†™å‰ç«¯ VS Grafana æ‰‹å†™å‰ç«¯è™½ç„¶å¯å®šåˆ¶åŒ–ç¨‹åº¦æ›´é«˜ï¼Œä½†æ˜¯éœ€è¦æ¶ˆè€—å¤§é‡ç²¾åŠ›è¿›è¡Œè°ƒè¯•ï¼Œå¯¹äºè¿ç»´äººå‘˜ï¼Œå“ªæ€•æ˜¯è¿ç»´å¼€å‘ä¹Ÿæ˜¯åƒä¸æ¶ˆçš„ï¼ˆå‰ç«¯å°å“¥å“¥å’Œå°å§å§æ˜¯ä¸ä¼šæ¥å¸®ä½ çš„ï¼Œä¸‹å›¾å°±æ˜¯æˆ‘å»å¹´æ‹¿ vue å†™çš„ä¼ª Grafana å±•ç¤ºé¡µé¢ï¼ŒèŠ±è´¹äº†å¤§çº¦ä¸€å‘¨æ—¶é—´åœ¨è°ƒæ•´è¿™äº›å‰ç«¯å…ƒç´ ï¼‰ã€‚ Grafana åˆ™æ ‡å‡†åŒ–ç¨‹åº¦å¾ˆé«˜ï¼Œå±•ç¤ºä¹Ÿæ›´åŠ ç¬¦åˆå¤§ä¼—å®¡ç¾ï¼ŒæŸäº›å®šåˆ¶åŒ–éœ€æ±‚å¯ä»¥é€šè¿‡è‡ªå®šä¹‰ DataSource æˆ–è€… AJAX æ’ä»¶çš„ iframe æ¨¡å¼å®Œæˆã€‚å¼€å‘åç«¯ DataSource è‚¯å®šå°±æ²¡æœ‰å‰ç«¯è°ƒæ•´ css é‚£ä¹ˆç—›è‹¦å’Œè€—æ—¶äº†ï¼Œæ•´ä½“é…ç½®å¼€å‘ä¸€ä¸ªè¿™æ ·çš„é¡µé¢å¯èƒ½åªæ¶ˆè€—ä¸€äººå¤©å°±èƒ½å®Œæˆã€‚è€Œåœ¨æ–°äº§å“ä¸Šçº¿æ—¶ï¼Œæ„å»ºä¸€ä¸ªä¸“é¡¹ç›‘æ§å±•ç¤ºé¡µé¢é€Ÿåº¦å°±æ›´å¿«äº†ï¼Œå‡ åˆ†é’Ÿå†…å°±èƒ½å®Œæˆã€‚ å…³äºé˜¿é‡Œäº‘ç›‘æ§ äº‘ç›‘æ§ï¼ˆCloudMonitorï¼‰æ˜¯ä¸€é¡¹é’ˆå¯¹é˜¿é‡Œäº‘èµ„æºå’Œäº’è”ç½‘åº”ç”¨è¿›è¡Œç›‘æ§çš„æœåŠ¡ã€‚\näº‘ç›‘æ§ä¸ºäº‘ä¸Šç”¨æˆ·æä¾›å¼€ç®±å³ç”¨çš„ä¼ä¸šçº§å¼€æ”¾å‹ä¸€ç«™å¼ç›‘æ§è§£å†³æ–¹æ¡ˆã€‚æ¶µç›– IT è®¾æ–½åŸºç¡€ç›‘æ§ï¼Œå¤–ç½‘ç½‘ç»œè´¨é‡æ‹¨æµ‹ç›‘æ§ï¼ŒåŸºäºäº‹ä»¶ã€è‡ªå®šä¹‰æŒ‡æ ‡ã€æ—¥å¿—çš„ä¸šåŠ¡ç›‘æ§ã€‚ä¸ºæ‚¨å…¨æ–¹ä½æä¾›æ›´é«˜æ•ˆã€æ›´å…¨é¢ã€æ›´çœé’±çš„ç›‘æ§æœåŠ¡ã€‚é€šè¿‡æä¾›è·¨äº§å“ã€è·¨åœ°åŸŸçš„åº”ç”¨åˆ†ç»„ç®¡ç†æ¨¡å‹å’ŒæŠ¥è­¦æ¨¡æ¿ï¼Œå¸®åŠ©æ‚¨å¿«é€Ÿæ„å»ºæ”¯æŒå‡ åç§äº‘äº§å“ã€ç®¡ç†æ•°ä¸‡å®ä¾‹çš„é«˜æ•ˆç›‘æ§æŠ¥è­¦ç®¡ç†ä½“ç³»ã€‚é€šè¿‡æä¾› Dashboardï¼Œå¸®åŠ©æ‚¨å¿«é€Ÿæ„å»ºè‡ªå®šä¹‰ä¸šåŠ¡ç›‘æ§å¤§ç›˜ã€‚ä½¿ç”¨äº‘ç›‘æ§ï¼Œä¸ä½†å¯ä»¥å¸®åŠ©æ‚¨æå‡æ‚¨çš„ç³»ç»ŸæœåŠ¡å¯ç”¨æ—¶é•¿ï¼Œè¿˜å¯ä»¥é™ä½ä¼ä¸š IT è¿ç»´ç›‘æ§æˆæœ¬ã€‚\näº‘ç›‘æ§æœåŠ¡å¯ç”¨äºæ”¶é›†è·å–é˜¿é‡Œäº‘èµ„æºçš„ç›‘æ§æŒ‡æ ‡æˆ–ç”¨æˆ·è‡ªå®šä¹‰çš„ç›‘æ§æŒ‡æ ‡ï¼Œæ¢æµ‹æœåŠ¡å¯ç”¨æ€§ï¼Œä»¥åŠé’ˆå¯¹æŒ‡æ ‡è®¾ç½®è­¦æŠ¥ã€‚ä½¿æ‚¨å…¨é¢äº†è§£é˜¿é‡Œäº‘ä¸Šçš„èµ„æºä½¿ç”¨æƒ…å†µã€ä¸šåŠ¡çš„è¿è¡ŒçŠ¶å†µå’Œå¥åº·åº¦ï¼Œå¹¶åŠæ—¶æ”¶åˆ°å¼‚å¸¸æŠ¥è­¦åšå‡ºååº”ï¼Œä¿è¯åº”ç”¨ç¨‹åºé¡ºç•…è¿è¡Œã€‚\nå…³äº Grafana Grafana æ˜¯ä¸€ä¸ªè·¨å¹³å°çš„å¼€æºçš„åº¦é‡åˆ†æå’Œå¯è§†åŒ–å·¥å…·ï¼Œå¯ä»¥é€šè¿‡å°†é‡‡é›†çš„æ•°æ®æŸ¥è¯¢ç„¶åå¯è§†åŒ–çš„å±•ç¤ºï¼Œå¹¶åŠæ—¶é€šçŸ¥ã€‚ç”±äºäº‘ç›‘æ§çš„ Grafana è¿˜æ²¡æœ‰æ”¯æŒå‘Šè­¦ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿™é‡Œåªç”¨äº† Grafana çš„å¯è§†åŒ–åŠŸèƒ½ï¼Œè€Œå‘Šè­¦æœ¬èº«å°±æ˜¯äº‘ç›‘æ§è‡ªå¸¦çš„ï¼Œæ‰€ä»¥ä¹Ÿä¸éœ€è¦ä¾èµ– Grafana æ¥å®ç°ã€‚è€Œæˆ‘ä»¬çš„ Prometheus ä¹Ÿä½¿ç”¨äº† Grafana è¿›è¡Œæ•°æ®å¯è§†åŒ–ï¼Œæ‰€ä»¥æœ‰ç°æˆçš„ Grafana-Server ä½¿ç”¨ã€‚\né˜¿é‡Œäº‘ç›‘æ§å¯¹æ¥ Grafana é¦–å…ˆ Grafana æœåŠ¡çš„éƒ¨ç½²æ–¹å¼è¿™é‡Œå°±ä¸åšä»‹ç»äº†ï¼Œè¯·ä½¿ç”¨è¾ƒæ–°ç‰ˆæœ¬çš„ Grafanaï¼Œæœ€å¥½æ˜¯ 5.5.0+ã€‚åæ–‡ä¸­ä¹Ÿæœ‰æˆ‘å¼€æºçš„åŸºäºé˜¿é‡Œäº‘äº‘ç›‘æ§çš„ Grafana çš„ helm chartï¼Œå¯ä»¥ä½¿ç”¨ helm å®‰è£…ï¼Œå¹¶ä¼šç›´æ¥å¯¼å…¥äº‘ç›‘æ§çš„æŒ‡æ ‡ï¼Œè¿™ä¸ªä¼šåœ¨åæ–‡ä¸­ä»‹ç»ã€‚\nå®‰è£…é˜¿é‡Œäº‘ç›‘æ§æ’ä»¶ è¿›å…¥æ’ä»¶ç›®å½•è¿›è¡Œå®‰è£…\ncd /var/lib/grafana/plugins/ git clone https://github.com/aliyun/aliyun-cms-grafana.git service grafana-server restart  å¦‚æœæ˜¯ä½¿ç”¨ docker æˆ–è€…éƒ¨ç½²åœ¨ k8s é›†ç¾¤ï¼Œè¿™é‡Œä¹Ÿå¯ä»¥ä½¿ç”¨ç¯å¢ƒå˜é‡åœ¨ Grafana éƒ¨ç½²çš„æ—¶å€™è¿›è¡Œå®‰è£…\n... spec: containers: - env: - name: GF_INSTALL_PLUGINS # å¤šä¸ªæ’ä»¶è¯·ä½¿ç”¨,éš”å¼€ value: grafana-simple-json-datasource,https://github.com/aliyun/aliyun-cms-grafana/archive/master.zip;aliyun-cms-grafana ...  æ‚¨ä¹Ÿå¯ä»¥ä¸‹è½½ aliyun-cms-grafana.zip æ’ä»¶è§£å‹åï¼Œä¸Šä¼ æœåŠ¡å™¨çš„ Grafana çš„ plugins ç›®å½•ä¸‹ï¼Œé‡å¯ grafana-server å³å¯ã€‚\né…ç½®äº‘ç›‘æ§ DataSource  Grafana å¯åŠ¨åï¼Œè¿›å…¥ Configuration é¡µé¢ï¼Œé€‰æ‹© DataSource Tab é¡µï¼Œå•å‡»å³ä¸Šæ–¹çš„Add data sourceï¼Œæ·»åŠ æ•°æ®æºã€‚ é€‰ä¸­CMS Grafana Serviceï¼Œå•å‡»selectã€‚  å¡«å†™é…ç½®é¡¹ï¼ŒURL æ ¹æ®äº‘ç›‘æ§æ‰€åœ¨åœ°åŸŸå¡«å†™ï¼Œå¹¶ä¸”å¡«å†™é˜¿é‡Œäº‘è´¦å·çš„ accessKeyId å’Œ accessSecretï¼Œå®Œæˆåå•å‡»Save\u0026amp;Testã€‚   åˆ›å»º Dashboard  å•å‡» Create -\u0026gt; Dashboard -\u0026gt; Add Query é…ç½®å›¾æ ‡ï¼Œæ•°æ®æºé€‰æ‹©ä¹‹å‰æ·»åŠ çš„ CMS Grafana Serviceï¼Œç„¶åæ–‡æ¡£ä¸­çš„é…ç½®é¡¹å¡«å…¥æŒ‡æ ‡å³å¯ï¼ˆè¿™é‡Œè¦æ³¨æ„çš„æ˜¯ï¼Œäº‘ç›‘æ§ API ç»™è¿”å›çš„åªæœ‰å®ä¾‹ IDï¼Œå¹¶æ²¡æœ‰è‡ªå®šä¹‰çš„å®ä¾‹åç§°ï¼Œè¿™é‡Œéœ€è¦æ‰‹åŠ¨å°†å…¶å¡«å…¥ Y - column describe ä¸­ï¼›è€Œä¸”åªæ”¯æŒè¾“å…¥å•ä¸ª Dimensionï¼Œè‹¥è¾“å…¥å¤šä¸ªï¼Œé»˜è®¤é€‰ç¬¬ä¸€ä¸ªï¼Œç”±äºè¿™äº›é—®é¢˜æ‰æœ‰äº†åç»­æˆ‘å¼€å‘çš„ cms-grafana-builder çš„åŠ¨æœºï¼‰ã€‚  é…ç½®å‚è€ƒ äº‘äº§å“ç›‘æ§é¡¹ï¼Œ   ä½¿ç”¨ helm chart çš„æ–¹å¼éƒ¨ç½² Grafana é¡¹ç›®åœ°å€ï¼šhttps://github.com/sunny0826/cms-grafana-builder\ncms-grafana-builder ç”±äºä¸Šæ–‡ä¸­çš„é—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦æ‰‹åŠ¨é€‰æ‹©æ¯ä¸ªå®ä¾‹ ID åˆ° Dimension ä¸­ï¼Œå¹¶ä¸”è¿˜è¦è®²è¯¥å®ä¾‹çš„åç§°é”®å…¥ Y - column describe ä¸­ï¼Œååˆ†çš„ç¹çï¼Œæ ¹æœ¬ä¸å¯èƒ½å¤§æ‰¹é‡çš„è¾“å…¥ã€‚\nè¿™å°±æ˜¯æˆ‘å¼€å‘è¿™ä¸ª Grafana æŒ‡æ ‡å‚æ•°ç”Ÿæˆå™¨çš„åŸå› ï¼Œèµ·åˆåªæ˜¯ä¸€ä¸ª python è„šæœ¬ï¼Œç”¨æ¥å°†æˆ‘ä»¬è¦ç›‘æ§çš„æŒ‡æ ‡ç»„è£…æˆä¸€ä¸ª Grafana å¯ä»¥ä½¿ç”¨ json æ–‡ä»¶ï¼Œä¹‹åç»“åˆ Grafana çš„å®¹å™¨åŒ–éƒ¨ç½²æ–¹æ³•ï¼Œå°†å…¶åšæˆäº†ä¸€ä¸ª helm chartã€‚å¯ä»¥åœ¨å¯åŠ¨çš„æ—¶å€™è‡ªåŠ¨å°†éœ€è¦çš„å‚æ•°ç”Ÿæˆï¼Œå¹¶ä¸”æ¯æ—¥ä¼šå¯¹æ‰€æœ‰æŒ‡æ ‡è¿›è¡Œæ›´æ–°ï¼Œè¿™æ ·å°±ä¸ç”¨æ¯æ¬¡æ–°è´­æˆ–è€…é‡Šæ”¾æ‰èµ„æºåè¿˜éœ€è¦å†è·‘ä¸€éè„šæœ¬ã€‚\néƒ¨ç½² åªéœ€è¦å°†é¡¹ç›®æ‹‰å–ä¸‹æ¥è¿è¡Œ helm install å‘½ä»¤\nhelm install my-release kk-grafana-cms \\ --namespace {your_namespace} \\ --set access_key_id={your_access_key_id} \\ --set access_secret={your_access_secret} \\ --set region_id={your_aliyun_region_id} \\ --set password={admin_password}  æ›´å¤šè¯¦æƒ…è§ github READMEï¼Œæ¬¢è¿æ issue äº¤æµã€‚\næŒ‡æ ‡é€‰æ‹© åœ¨éƒ¨ç½²æˆåŠŸåï¼Œå¯ä¿®æ”¹ ConfigMapï¼šgrafana-cms-metricï¼Œç„¶åä¿®æ”¹å¯¹åº”çš„ç›‘æ§æŒ‡æ ‡é¡¹ã€‚\næ•ˆæœ ECS: RDS: EIP: Redis: åè®° ä¸ºäº†æ»¡è¶³å…¬å¸éœ€æ±‚ï¼Œåç»­è¿˜å¼€å‘ DataSource å®šåˆ¶éƒ¨åˆ†ï¼Œç”¨äºå…¬å¸ç›‘æ§å¤§å±çš„å±•ç¤ºï¼Œè¿™éƒ¨åˆ†æ˜¯å¦ä¸€ä¸ªé¡¹ç›®ï¼Œä¸åœ¨è¿™ä¸ªé¡¹ç›®é‡Œï¼Œå°±ä¸ç»†è¯´äº†ï¼Œä¹‹åæœ‰æœºä¼šæ€»ç»“åå†è¿›è¡Œåˆ†äº«ã€‚\n","date":1573096116,"expirydate":-62135596800,"kind":"page","lang":"zh","lastmod":1573096116,"objectID":"17fd9893f68861c9afc27193aae1220d","permalink":"https://guoxudong.io/post/aliyun-cms-grafana/","publishdate":"2019-11-07T11:08:36+08:00","relpermalink":"/post/aliyun-cms-grafana/","section":"post","summary":"æœ¬æ–‡ä»‹ç»ä½¿ç”¨ Grafana å±•ç¤ºé˜¿é‡Œäº‘ç›‘æ§æŒ‡æ ‡çš„æ–¹æ³•ï¼Œå¹¶æä¾›äº†ä½¿ç”¨ helm chart ä¸€é”®éƒ¨ç½²åŒ…å«é˜¿é‡Œäº‘ç›‘æ§ dashboard çš„ Grafana-Serverã€‚","tags":["é˜¿é‡Œäº‘","kubernetes","grafana"],"title":"ä½¿ç”¨ Grafana å±•ç¤ºé˜¿é‡Œäº‘ç›‘æ§æŒ‡æ ‡","type":"post"},{"authors":["éƒ­æ—­ä¸œ"],"categories":["kubernetes"],"content":" å‰è¨€ 9æœˆ25æ—¥æ™šå—é‚€æ¥åˆ°é˜¿é‡Œäº‘é£å¤©å›­åŒºå‚åŠ é˜¿é‡Œäº‘MVPäº§å“å¤œè°ˆï¼Œåœ¨ä¼šä¸Šé‡åˆ°äº†å®¹å™¨æœåŠ¡å›¢é˜Ÿçš„è´Ÿè´£äººæ˜“ç«‹ï¼Œå¹¶å°±å®¹å™¨æœåŠ¡è¿›è¡Œäº†äº¤æµã€‚æ­¤æ¬¡å‚åŠ å¤œè°ˆçš„é™¤äº†æ¥è‡ªå…¨çƒå„åœ°çš„é˜¿é‡Œäº‘MVPï¼Œè¿˜æœ‰æ¥è‡ªå®‰å…¨å›¢é˜Ÿã€å®¹å™¨å›¢é˜Ÿã€AIoT å›¢é˜Ÿã€å¤§æ•°æ®å›¢é˜Ÿã€æ•°æ®åº“å›¢é˜Ÿã€äººå·¥æ™ºèƒ½å›¢é˜Ÿã€ä¸­é—´ä»¶å›¢é˜Ÿã€æœç´¢å¼•æ“\u0026amp;æ™ºèƒ½æ¨èå›¢é˜Ÿçš„è´Ÿè´£äºº\u0026amp;äº§å“ç»ç†ã€‚å„ä¸ªå‚ä¼šçš„MVPå¯ä»¥æ ¹æ®è‡ªå·±çš„ç ”ç©¶æ–¹å‘æˆ–è€…æ„Ÿå…´è¶£çš„æ–¹å‘é€‰æ‹©ï¼Œç›´æ¥ä¸å›¢é˜Ÿè´Ÿè´£äººé¢å¯¹é¢äº¤æµï¼Œè·å–é˜¿é‡Œäº‘äº§å“çš„æœ€æ–°ä¿¡æ¯ï¼Œå¹¶æå‡ºä½¿ç”¨æ„è§ï¼Œä¿ƒè¿›äº§å“çš„å‘å±•ã€‚ç”±äºä¸»è¦ä»äº‹äº‘åŸç”Ÿ\u0026amp;å®¹å™¨æ–¹é¢çš„å·¥ä½œï¼Œæˆ‘é€‰æ‹©äº†å®¹å™¨å›¢é˜Ÿï¼Œä¸é˜¿é‡Œäº‘å®¹å™¨æœåŠ¡å›¢é˜Ÿè´Ÿè´£äººæ˜“ç«‹å°±å®¹å™¨æœåŠ¡è¿›è¡Œäº¤æµï¼Œæœ¬æ–‡è®°å½•äº†éƒ¨åˆ†äº¤æµå†…å®¹ã€‚\nå®¹å™¨æœåŠ¡äº¤æµ å…³äºé›†ç¾¤ç‰ˆæœ¬\u0026amp;é›†ç¾¤å‡çº§ ä¼—æ‰€å‘¨çŸ¥ï¼ŒKubernetes ä»¥éå¸¸ç¨³å®šçš„3ä¸ªæœˆå‘å¸ƒä¸€ä¸ªç‰ˆæœ¬é€Ÿåº¦åœ¨é«˜é€Ÿè¿­ä»£è¿™ï¼ŒKubernetes v1.16.0 ä¹Ÿå³å°† release ï¼Œä½†æ˜¯ç›®å‰ ACK çš„ Kubernetes ç‰ˆæœ¬ä¾æ—§ä¸º v1.12.6-aliyun.1 å·²è½åå®˜æ–¹4ä¸ªå¤§ç‰ˆæœ¬ã€‚å¾—åˆ°çš„å›å¤æ˜¯æ–°ç‰ˆæœ¬ 1.14 å·²ç»ä¸Šçº¿ï¼Œä¸‹å‘¨å°±å¯ä»¥å‡çº§äº†ï¼Œ1.14 ç‰ˆæœ¬ä¹‹å‰å·²ç»ä¸Šçº¿ï¼Œåªä¸è¿‡ä¸€ç›´åœ¨ç°åº¦æµ‹è¯•ï¼Œä¸‹å‘¨ï¼ˆ2019å¹´9æœˆ29æ—¥ï¼‰å°±å…¨é¢æ”¾å¼€å‡çº§äº†ã€‚æˆªæ­¢å†™è¿™ç¯‡æ–‡ç« çš„æ—¶å€™ï¼Œæˆ‘ä»¬çš„å¤šä¸ª Kubernetes é›†ç¾¤å·²æˆåŠŸå‡çº§åˆ° v1.14.6-aliyun.1 ï¼Œè™½ç„¶åœ¨å‡çº§çš„æ—¶å€™å‡ºç°äº†ä¸€ç‚¹å°é—®é¢˜ï¼Œä½†æ˜¯æœ€åè¿˜æ˜¯é¡ºåˆ©è§£å†³äº†ã€‚\nç„¶åå°±æ˜¯é›†ç¾¤å‡çº§çš„é—®é¢˜ï¼Œé›†ç¾¤å‡çº§çš„æ—¶å€™ä¼šå»ºè®®å¯¹æ‰€æœ‰èŠ‚ç‚¹æ‰“å¿«ç…§ï¼Œç¡®ä¿èŠ‚ç‚¹å®‰å…¨ï¼Œä½†æ˜¯å¦‚æœåœ¨èŠ‚ç‚¹å‡çº§å½“ä¸­å¤±è´¥ï¼Œå°±ä¼šå‡ºç°ä¸€åŠä¸ºæ–°ç‰ˆæœ¬èŠ‚ç‚¹ï¼Œä¸€åŠä¸ºæ—§ç‰ˆæœ¬èŠ‚ç‚¹çš„é—®é¢˜ã€‚æˆ‘ä»¬çš„ä¸€ä¸ªèŠ‚ç‚¹å‡çº§å¤±è´¥ï¼Œå°±å‡ºç°äº†ä¸Šè¿°é—®é¢˜ï¼Œæœ€åè¿˜æ˜¯å°†è¯¥èŠ‚ç‚¹å®¹å™¨é©±æ•£ï¼Œå¹¶å°†è¯¥èŠ‚ç‚¹ç§»å‡ºé›†ç¾¤æ‰è§£å†³äº†å‡çº§é—®é¢˜ã€‚å¸Œæœ›é›†ç¾¤å‡çº§æä¾›æ•´ä½“çŠ¶æ€ä¿å­˜\u0026amp;å›é€€åŠŸèƒ½ï¼Œç¡®ä¿å¦‚æœå‡çº§å¤±è´¥ï¼ˆæˆ–è€…å‡ºç°æ–°æ—§ç‰ˆæœ¬ä¸å…¼å®¹é—®é¢˜ï¼‰çš„æ—¶å€™å¯ä»¥å®‰å…¨å›é€€åˆ°ä¹‹å‰ç‰ˆæœ¬ã€‚\nå…³äºå®¹å™¨æœåŠ¡å‰ç«¯å±•ç¤º ACK çš„ WEB ç•Œé¢ç›¸å¯¹ç®€é™‹ï¼Œä¸€ç›´ä»¥æ¥éƒ½æ˜¯å¯¹ Kubernetes Dashboard è¿›è¡Œäº†ç®€å•çš„åŒ…è£…ï¼Œå’Œå…¶ä»–å…¬æœ‰äº‘ç›¸æ¯”ç¡®å®ä¸å¦‚ã€‚ä¸è¿‡è¿™ä¹Ÿä¸æ˜¯å®¹å™¨æœåŠ¡ç‹¬æœ‰çš„é—®é¢˜ï¼Œé˜¿é‡Œäº‘ä½ äº§å“ä¼—å¤šï¼Œå¤§éƒ¨åˆ†éƒ½æœ‰è¿™æ ·çš„é—®é¢˜ã€‚ä¸æ˜“ç«‹äº¤æµå¾—çŸ¥ï¼Œå®¹å™¨æœåŠ¡å›¢é˜Ÿç›®å‰ä¸»è¦çš„ä»»åŠ¡è¿˜æ˜¯ç¡®ä¿ Kubernetes é›†ç¾¤çš„å®‰å…¨ç¨³å®šè¿è¡Œï¼Œä»–ä»¬åœ¨å®‰å…¨å’Œå¯ç”¨æ€§ä¸ŠèŠ±è´¹çš„å¤§é‡ç²¾åŠ›ï¼Œè²Œä¼¼å¹¶æ²¡æœ‰æ‹¿åˆ°ä»€ä¹ˆå‰ç«¯å¼€å‘èµ„æºã€‚æˆ‘æ³¨æ„åˆ°åƒè´¹ç”¨ä¸­å¿ƒã€æ—¥å¿—æœåŠ¡ç­‰äº§å“éƒ½æœ‰äº†æ–°ç‰ˆé¡µé¢ï¼Œè¿™é‡Œå¸Œæœ›èƒ½å®¹å™¨æœåŠ¡é¡µé¢ä¹Ÿèƒ½å°½å¿«æ”¹ç‰ˆï¼Œæé«˜é¡µé¢æ“ä½œçš„ä¾¿æ·å’Œç¾è§‚ã€‚\nå…³äºæˆæƒç®¡ç† ä¸€ç›´ä»¥æ¥å®¹å™¨æœåŠ¡éƒ½æœ‰æˆæƒç®¡ç†åŠŸèƒ½ï¼Œåæ¥éƒ½åŸºäºRAMé‡æ–°åšäº†æˆæƒç®¡ç†åŠŸèƒ½ã€‚ä½†æ˜¯RAMæƒé™ç®¡ç†ç­–ç•¥ååˆ†å¤æ‚ï¼Œé…ç½®èµ·æ¥ä¹Ÿå¾ˆéº»çƒ¦ï¼Œä¸åŒçš„ç­–ç•¥ç»“æ„å’Œè¯­æ³•å­¦ä¹ èµ·æ¥éå¸¸å›°éš¾ã€‚åœ¨é…ç½®å’Œç®¡ç†èµ·æ¥éå¸¸å›°éš¾ï¼Œæˆ‘ä»¬åªèƒ½æŠŠæ‰€æœ‰æƒé™æ”¶å›ï¼Œæ¯é¡¹æƒé™éƒ½è¦æ ¹æ®éœ€æ±‚æå·¥å•æ¥è¿›è¡Œé…ç½®ï¼Œè¿˜æ—¶é•¿ä¼šå‡ºç°é…ç½®ä¸ç”Ÿæ•ˆçš„é—®é¢˜ã€‚è€Œä¸”è¿™ä¸ªé—®é¢˜ä¸€æå‡ºï¼Œå°±å¼•èµ·äº†å¤§å®¶çš„å…±é¸£ï¼Œåäº†è§£å¾—çŸ¥ï¼Œä¸ºäº†å®‰å…¨åˆè§„çš„è¦æ±‚ï¼Œæ“ä½œä¾¿æ·å’Œå®‰å…¨åˆè§„æ²¡æ³•å…¼é¡¾ã€‚è¿™é‡Œå¸Œæœ›æˆæƒç®¡ç†ä¸Šèƒ½åœ¨ç¡®ä¿åˆè§„çš„åŒæ—¶ï¼Œèƒ½æå‡RAMæ“ä½œçš„ä¾¿æ·æ€§ã€‚\nåè®° å…³äºå®¹å™¨æœåŠ¡çš„äº¤æµä¸»è¦æ˜¯ä»¥ä¸Šå‡ ç‚¹ï¼Œå…¶ä»–çš„è¿˜åŒ…æ‹¬ç›‘æ§ã€å­˜å‚¨å’Œ CI/CD æ–¹é¢è¿›è¡Œäº†äº¤æµï¼ŒåŒæ—¶ä¹Ÿè·å¾—äº†ä¸å°‘å»ºè®®ã€‚å½“é¢ç»™é˜¿é‡Œäº‘æéœ€æ±‚çš„æœºä¼šå¹¶ä¸å¤šï¼Œæˆ‘ä¹Ÿæ˜¯æŠ“ä½æœºä¼šï¼ŒæŠŠæ—¥å¸¸ä½¿ç”¨ ACK çš„é—®é¢˜æ±‡æ€»ä¹‹åä¸€è‚¡è„‘çš„ä¸¢äº†å‡ºå»ã€‚æœ‰ç±»ä¼¼éœ€æ±‚çš„åŒå­¦å¯ä»¥åœ¨é˜¿é‡Œäº‘çš„è†å¬å¹³å°ä¸Šç»™é˜¿é‡Œäº‘æäº¤å»ºè®®ï¼Œä»¥æˆ‘çš„ç»éªŒï¼Œåˆç†çš„éœ€æ±‚ä¼šå¾ˆå¿«å®¡æ ¸é€šè¿‡å¹¶æ’æœŸå¼€å‘ï¼Œæ¢å¥è¯è¯´å°±æ˜¯â€œäººäººéƒ½å¯ä»¥æ˜¯é˜¿é‡Œäº‘çš„äº§å“ç»ç†â€ã€‚\n","date":1569807155,"expirydate":-62135596800,"kind":"page","lang":"zh","lastmod":1569807155,"objectID":"d76de41331167f4ac1c804c8958592b7","permalink":"https://guoxudong.io/post/aliyun-product-meetup/","publishdate":"2019-09-30T09:32:35+08:00","relpermalink":"/post/aliyun-product-meetup/","section":"post","summary":"9æœˆ25æ—¥æ™šå—é‚€æ¥åˆ°é˜¿é‡Œäº‘é£å¤©å›­åŒºå‚åŠ é˜¿é‡Œäº‘MVPäº§å“å¤œè°ˆï¼Œåœ¨ä¼šä¸Šé‡åˆ°äº†å®¹å™¨æœåŠ¡å›¢é˜Ÿçš„è´Ÿè´£äººæ˜“ç«‹ï¼Œå¹¶å°±å®¹å™¨æœåŠ¡è¿›è¡Œäº†äº¤æµã€‚","tags":["é˜¿é‡Œäº‘","å®¹å™¨"],"title":"é˜¿é‡Œäº‘äº§å“å¤œè°ˆ-å®¹å™¨æœåŠ¡äº¤æµ","type":"post"},{"authors":["éƒ­æ—­ä¸œ"],"categories":["å…¬ç›Š"],"content":" å‰è¨€ æœ¬æ¬¡å‚åŠ äº‘æ –å¤§ä¼šï¼Œé™¤äº†å—åˆ°é˜¿é‡Œäº‘å¼€å‘è€…ç¤¾åŒºçš„é‚€è¯·ï¼ŒåŒæ—¶ä¹Ÿå—åˆ°äº†é˜¿é‡Œç ä¸Šå…¬ç›Šå›¢é˜Ÿçš„é‚€è¯·ï¼Œäº9æœˆ25æ—¥ä¸‹åˆå‚åŠ äº†é˜¿é‡Œå·´å·´æŠ€æœ¯å…¬ç›Šä¸“åœºã€‚è¯´æ¥æƒ­æ„§ï¼Œä½œä¸ºä¸€ä¸ªç å†œå…³æ³¨å¹¶åŠ å…¥ç ä¸Šå…¬ç›Šå·²åŠå¹´æœ‰ä½™ï¼Œä½†æ˜¯é™¤äº†åœ¨å¹³å°ä¸Šä»¥è‡ªå·±çš„ç»éªŒæ¥ç»™å‡ºå„ç§å»ºè®®å¤–ï¼Œå¹¶æ²¡æœ‰è´¡çŒ®ä»€ä¹ˆå®è´¨çš„ä»£ç ï¼Œè¿™ä¹Ÿå¯èƒ½æ˜¯å› ä¸ºæˆ‘ä¸“èŒè¿ç»´å¼€å‘ï¼Œåœ¨devopså’Œæ•ˆèƒ½æå‡ä¸Šæœ‰å¾ˆå¤šè‡ªå·±çš„è§è§£ï¼Œä½†å¯¹äºå‰ç«¯UIå’Œå„ç§å®˜ç½‘çš„æ„å»ºå¹¶ä¸æ˜¯å¾ˆåœ¨è¡Œã€‚\né˜¿é‡Œå·´å·´ä¸å…¬ç›Š ä¸€ç›´ä»¥æ¥æˆ‘å¯¹äºå…¬ç›Šçš„ç†è§£è¿˜æ˜¯åœç•™åœ¨å¾ˆæµ…çš„é˜¶æ®µï¼Œè€Œä¸”å¾ˆé•¿ä¸€æ®µæ—¶é—´ä»¥æ¥ï¼Œå…¬ç›Šè¿˜æ˜¯åœç•™åœ¨æœ‰é™çš„åœˆå­å†…ï¼Œåƒæˆ‘è¿™æ ·çš„æŠ€æœ¯äººä¸å…¬ç›Šå®Œå…¨å°±æ˜¯ä¸¤ä¸ªä¸–ç•Œã€‚è€Œé˜¿é‡Œå·´å·´æ¨å‡ºçš„ç ä¸Šå…¬ç›Šåˆ™æ”¹å˜äº†è¿™ä¸€ç‚¹ï¼Œè¿™ä¸ªå¹³å°è®©æˆ‘äº†è§£åˆ°ï¼ŒåŸæ¥å…¬ç›Šé™¤äº†æåŠ©ä¹‹å¤–è¿˜èƒ½ä»¥è‡ªå·±çš„æŠ€æœ¯èƒ½åŠ›åšå‡ºæ›´å¤§çš„è´¡çŒ®ã€‚æ­¤æ¬¡æŠ€æœ¯å…¬ç›Šä¸“åœºï¼Œé˜¿é‡Œå‘å¸ƒäº†æŠ€æœ¯å…¬ç›ŠåŸºé‡‘ï¼Œæˆ‘ä¹Ÿæ˜¯ç¬¬ä¸€æ¬¡è§åˆ°è¿™ä¹ˆå¤šçš„é˜¿é‡Œåˆä¼™äººï¼Œå¯è§å…¬ç›Šåœ¨é˜¿é‡Œå·´å·´é›†å›¢å†…éƒ¨çš„é‡è¦ã€‚é˜¿é‡Œå·´å·´ä¸åªåœ¨é›†å›¢å†…éƒ¨æ¨è¿›å…¬ç›Šï¼Œè€Œä¸”è¿˜ä¸ºæˆ‘ä»¬è¿™æ ·çš„æ™®é€šäººæä¾›äº†åƒç ä¸Šå…¬ç›Šã€èš‚èšæ£®æ—ã€ä¸€ä¹¦ç­‰å¹³å°å’Œäº§å“ï¼Œè®©è¶Šæ¥è¶Šå¤šçš„äººå‚ä¸åˆ°å…¬ç›Šäº‹ä¸šä¸­ï¼Œè®©æ›´å¤šçš„äººå¹³ç­‰çš„äº«æœ‰æŠ€æœ¯çº¢åˆ©ã€‚\nè®©ä»£ç æ›´æœ‰æ¸©åº¦ å‚åŠ ç ä¸Šå…¬ç›Šçš„åˆè¡·åªä¸è¿‡æ˜¯æƒ³ä¸ºå…¬ç›Šäº‹ä¸šåšä¸€äº›åŠ›æ‰€èƒ½åŠçš„äº‹æƒ…ï¼Œå°¤å…¶æ˜¯ä½¿ç”¨ä»£ç è¿™ç§æ–¹å¼ï¼Œåœ¨å…¬ç›Šäº‹ä¸šä¸Šå±•ç¤ºæˆ‘ä»¬æŠ€æœ¯äººçš„æ‰åã€‚ä¹Ÿç¬¦åˆä¸æˆ‘çš„ä»·å€¼è§‚ï¼šæŠ€æœ¯è®©ä¸–ç•Œæ›´ç¾å¥½ã€‚æˆ‘ä»¬æŠ€æœ¯äººå¯ä»¥é€šè¿‡ä¸€ç§æ¯”æåŠ©æ›´æœ‰æ¸©åº¦çš„æ–¹å¼ï¼šä»£ç ï¼Œæ¥è®©æˆ‘ä»¬çš„ä¸–ç•Œè¶Šæ¥è¶Šç¾å¥½ã€‚\nåœ¨å…¬ç›Šä¸“åœºä¸­æœ‰å¹¸ç»“è¯†äº† Michael HERMANN è€å¸ˆï¼Œä½œä¸ºä¸€ä¸ªå¾·å›½äººï¼Œä»–å´æ“è¿™ä¸€å£æµåˆ©çš„ä¸­æ–‡ï¼Œåå‡ å¹´å¦‚ä¸€æ—¥çš„åœ¨ä¸­å›½åè¿œçš„ä¹¡æ‘ä¸­ä¸ºé‚£é‡Œçš„å­©å­å¸¦å»æ•™è‚²ï¼ŒåŒæ—¶ä¹Ÿä¸ºå­©å­ä»¬å¸¦å»äº†å¸Œæœ›ã€‚åœ¨ä¸“åœºåçš„å…¬ç›Šæ²Ÿé€šä¼šæœ‰å¹¸ä¸ Michael è€å¸ˆä¸€æ¡Œï¼Œè¿™æ˜¯ä¸€ä½å¯çˆ±çš„è€äººï¼Œååˆ†å…³æ³¨ä¸­å›½åè¿œåœ°åŒºå­©å­ä»¬çš„æ•™è‚²é—®é¢˜ï¼Œåœ¨ä»–çš„èº«ä¸Šæˆ‘çœ‹åˆ°äº†ä¸€ä¸ªä½œä¸ºå…¬ç›Šäººçš„åšæŒï¼Œåœ¨ä»–çœ¼é‡Œå›½ç±ã€æ–‡åŒ–ã€åœ°åŸŸéƒ½æ²¡æœ‰å·®åˆ«ï¼Œæœ‰çš„åªæ˜¯å¸Œæœ›è¿™äº›ç”Ÿæ´»åœ¨åè¿œåœ°åŒºçš„å­©å­éƒ½äº«æœ‰å—æ•™è‚²çš„æƒåˆ©ï¼Œååˆ†å€¼å¾—æ•¬ä½©ã€‚åŒæ—¶è¿˜ç»“è¯†äº†è®¸å¤šå¿—åŒé“åˆçš„ç å†œæœ‹å‹ï¼Œå¤§å®¶éƒ½å¸Œæœ›ç”¨è‡ªå·±æ¸©æš–çš„ä»£ç ä¸ºå…¬ç›Šäº‹ä¸šåšå‡ºè‡ªå·±çš„è´¡çŒ®ã€‚\næˆ‘ä»¬åªæœ‰ä¸€ä¸ªåœ°çƒ ä¹‹åã€Šç”¨ç°ä»£ç§‘æŠ€åŠ©åŠ›ä¸­å›½è™è±¹ä¿æŠ¤ã€‹çš„ä¸»é¢˜åˆ†äº«ï¼Œè®©æˆ‘äº†è§£åˆ°äº†ï¼Œç¯å¢ƒçš„ä¿æŠ¤ä¹Ÿæ˜¯å…¬ç›Šä¸­å¾ˆé‡è¦çš„ä¸€éƒ¨åˆ†ã€‚è€Œç§‘æŠ€çš„å‘å±•ï¼Œè®©ä»äº‹åŠ¨ç‰©ä¿æŠ¤çš„äººå‘˜å¯ä»¥åšçš„æ›´ä»”ç»†æ›´å®Œå–„ï¼Œå¯¹äºAIã€å¤§æ•°æ®çš„åº”ç”¨ï¼Œä½¿å¾—å¯¹äºé‡ç”ŸåŠ¨ç‰©çš„ä¿æŠ¤æ›´ç²¾å‡†ã€‚æŠ€æœ¯èµ‹èƒ½é‡ç”ŸåŠ¨ç‰©ä¿æŠ¤ï¼Œå¯ä»¥æ›´å¥½çš„ä¿æŠ¤é‡ç”ŸåŠ¨ç‰©ï¼ŒåŒæ—¶ä¹Ÿè®©åŠ¨ç‰©ä¿æŠ¤äººå‘˜çš„å·¥ä½œæ›´è½»æ¾ï¼Œè®©è¿™äº›å¸¸å¹´åœ¨å¤§å±±å¯†æ—ä¸­ä¿æŠ¤é‡ç”ŸåŠ¨ç‰©çš„ç§‘å­¦å®¶ä¸å†é‚£ä¹ˆè¾›è‹¦ï¼ŒåŒæ—¶æ›´å¥½çš„ä¿æŠ¤é‡ç”ŸåŠ¨ç‰©ã€‚\nåè®° ä¹‹åå—éƒ½å…¬ç›ŠåŸºé‡‘ä¼šç†äº‹é•¿å¾æ°¸å…‰åˆ†äº«äº†ã€Šäº’è”ç½‘å¸¦æ¥çš„æ—¶ä»£æ”¹å˜ã€‹ï¼Œäº†è§£åˆ°äº†äº’è”ç½‘å…¬ç›Šå¹¶ä¸åªæ˜¯åˆšåˆšå…´èµ·ï¼Œè€Œæ˜¯ä¸€ç›´åœ¨åŠªåŠ›ï¼›è€Œè”åˆå›½ä¸–ç•Œç²®é£Ÿè®¡åˆ’ç½²é©»åä»£è¡¨å±ˆå››å–œåˆ™å¸¦æ¥äº†ã€Šä¸ºäº†â€œé›¶é¥¥é¥¿â€ç›®æ ‡ã€‹ã€‚æ„Ÿè°¢é˜¿é‡Œå·´å·´æä¾›äº†è¿™ä¸ªæœºä¼šï¼Œè®©æˆ‘è¿™æ ·çš„æŠ€æœ¯äººå¯ä»¥å‚ä¸åˆ°å…¬ç›Šäº‹ä¸šå½“ä¸­ï¼Œä¸ºå…¬ç›Šäº‹ä¸šè´¡çŒ®å‡ºè‡ªå·±çš„åŠ›é‡ã€‚\n","date":1569721931,"expirydate":-62135596800,"kind":"page","lang":"zh","lastmod":1569721931,"objectID":"160982f9deb28dbfa40c1ac5a98e2f76","permalink":"https://guoxudong.io/post/alibaba-public-welfare/","publishdate":"2019-09-29T09:52:11+08:00","relpermalink":"/post/alibaba-public-welfare/","section":"post","summary":"9æœˆ25æ—¥ä¸‹åˆå‚åŠ é˜¿é‡Œå·´å·´æŠ€æœ¯å…¬ç›Šä¸“åœºè®°å½•ä¸æ„Ÿæƒ³ã€‚","tags":["å…¬ç›Š"],"title":"å½“ç å†œé‡è§å…¬ç›Š","type":"post"},{"authors":["éƒ­æ—­ä¸œ"],"categories":["devops"],"content":" å‰è¨€ ä½¿ç”¨ drone CI å·²æœ‰å°åŠå¹´ï¼Œåœ¨å°†åŸæœ‰é¡¹ç›®çš„ CI ç³»ç»Ÿä» jenkins å‘ drone è¿ç§»çš„æ—¶å€™ï¼Œä¹Ÿé™†é™†ç»­ç»­é‡åˆ°äº†ä¸€äº›é—®é¢˜ã€‚åœ¨è¿™æ®µæ—¶é—´ï¼Œä¹Ÿå®Œæˆäº†ä½¿ç”¨å®˜æ–¹æ’ä»¶åˆ°æ’ä»¶å®šåˆ¶çš„è½¬å˜ï¼Œä½¿å¾— drone CI æµç¨‹æ›´è´´åˆæˆ‘ä»¬ devops å¼€å‘æµç¨‹ã€‚é€šè¿‡è¿™ç¯‡æ–‡ç« æ€»ç»“ä¸€ä¸‹ç›®å‰æˆ‘ä»¬å¯¹ drone è¿›è¡Œçš„ä¸€äº›å®šåˆ¶åŒ–å¼€å‘ä»¥åŠä½¿ç”¨æŠ€å·§ï¼Œç”±äº drone å®˜æ–¹çš„æ–‡æ¡£ä¸æ˜¯å¾ˆè¯¦ç»†ï¼Œæ‰€ä»¥ä¹Ÿå¸Œæœ›é€šè¿‡è¿™ç§æ–¹æ³•æ¥å’Œå…¶ä»–ä½¿ç”¨ drone çš„ç”¨æˆ·åˆ†äº«å’Œäº¤æµä½¿ç”¨ç»éªŒã€‚\nå¹¶è¡Œæ„å»º åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œdrone ä¼šæŒ‰ç…§æ­¥éª¤æ‰§è¡Œï¼Œä½†æ˜¯æœ‰æ—¶ä¼šé‡åˆ°å‰åç«¯åœ¨åŒä¸€ä¸ª repo çš„æƒ…å†µï¼Œè¿™æ—¶ä½¿ç”¨å¹¶è¡Œæ„å»ºå°±å¯ä»¥çœå»å¾ˆå¤šçš„æ„å»ºæ—¶é—´ã€‚\n æ„å»ºæµç¨‹ï¼š\n åœ¨ä¸‹é¢çš„ç¤ºä¾‹é‡Œä¼šå±•ç¤ºä¸€ä¸ªå¦‚ä¸‹æµç¨‹ï¼šrepo ä¸­åŒ…å«ä¸€ä¸ªç”± Java å†™çš„æœåŠ¡ä»¥åŠä¸€ä¸ª vue å‰ç«¯é¡¹ç›®ï¼Œmaven æ„å»ºå’Œ npm æ„å»ºåŒæ—¶è¿›è¡Œï¼Œmaven æ„å»ºæˆåŠŸåä¼šé•œåƒ docker é•œåƒæ„å»ºå¹¶ä¸Šä¼ é•œåƒä»“åº“ï¼Œdocker æ„å»ºæˆåŠŸåä¼šé•œåƒ k8s éƒ¨ç½²ï¼Œéƒ¨ç½²æˆåŠŸåä¼šè¿›è¡Œ vue é¡¹ç›®å‰ç«¯å‘å¸ƒï¼Œåœ¨ k8s éƒ¨ç½²æˆåŠŸå¹¶ä¸”å‰ç«¯å‘å¸ƒæˆåŠŸåï¼Œè¿›è¡Œé’‰é’‰æ„å»ºæˆåŠŸåŒæ—¶ï¼Œå¦åˆ™è¿›è¡Œé’‰é’‰æ„å»ºå¤±è´¥é€šçŸ¥ã€‚\nå‰ç«¯æ„å»º â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” å‰ç«¯å‘å¸ƒ \\ / \\ \\ / é’‰é’‰é€šçŸ¥ \\ / / åç«¯æ„å»º â€”â€” é•œåƒæ„å»º â€”â€” k8séƒ¨ç½² â€”â€”â€”â€”â€”â€”   .drone.yml é…ç½®\n kind: \u0026quot;pipeline\u0026quot; name: \u0026quot;default\u0026quot; steps: - name: \u0026quot;Mavenç¼–è¯‘\u0026quot; image: \u0026quot;guoxudongdocker/drone-maven\u0026quot; commands: - \u0026quot;mvn clean install\u0026quot; depends_on: [ \u0026quot;clone\u0026quot; ] - name: \u0026quot;æ„å»ºé•œåƒ\u0026quot; image: \u0026quot;guoxudongdocker/drone-docker\u0026quot; settings: username: from_secret: \u0026quot;docker_user\u0026quot; password: from_secret: \u0026quot;docker_pass\u0026quot; dockerfile: \u0026quot;Dockerfile\u0026quot; repo: \u0026quot;registry-vpc.cn-shanghai.aliyuncs.com/guoxudong/test\u0026quot; registry: \u0026quot;registry-vpc.cn-shanghai.aliyuncs.com\u0026quot; tags: \u0026quot;${DRONE_BUILD_NUMBER}\u0026quot; depends_on: [ \u0026quot;Mavenç¼–è¯‘\u0026quot; ] - name: \u0026quot;Kubernetes éƒ¨ç½²\u0026quot; image: \u0026quot;guoxudongdocker/kubectl\u0026quot; settings: config: \u0026quot;deploy/overlays/uat\u0026quot; timeout: 300 check: false depends_on: [ \u0026quot;æ„å»ºé•œåƒ\u0026quot; ] - name: \u0026quot;å‰ç«¯æ„å»º\u0026quot; image: \u0026quot;guoxudongdocker/node-drone\u0026quot; commands: - \u0026quot;npm install\u0026quot; - \u0026quot;npm run build\u0026quot; depends_on: [ \u0026quot;clone\u0026quot; ] - name: \u0026quot;å‰ç«¯ä¸Šä¼ \u0026quot; image: \u0026quot;guoxudongdocker/node-drone\u0026quot; commands: - \u0026quot;do something\u0026quot; depends_on: [ \u0026quot;å‰ç«¯æ„å»º\u0026quot;,\u0026quot;Kubernetes éƒ¨ç½²\u0026quot; ] - name: \u0026quot;é’‰é’‰é€šçŸ¥\u0026quot; image: \u0026quot;guoxudongdocker/drone-dingtalk\u0026quot; settings: token: from_secret: \u0026quot;dingding\u0026quot; type: \u0026quot;markdown\u0026quot; message_color: true message_pic: true sha_link: true depends_on: [ \u0026quot;å‰ç«¯ä¸Šä¼ \u0026quot;,\u0026quot;Kubernetes éƒ¨ç½²\u0026quot; ] when: status: - \u0026quot;failure\u0026quot; - \u0026quot;success\u0026quot;  å¤šå­é¡¹ç›®æ„å»º åœ¨ä½¿ç”¨ drone ä¸­é‡åˆ°çš„æœ€å¤§é—®é¢˜å°±æ˜¯ï¼Œæˆ‘ä»¬æœ‰å¾ˆå¤šé¡¹ç›®éƒ½æ˜¯åœ¨ä¸€ä¸ª repo ä¸­æœ‰å¾ˆå¤šå­é¡¹ç›®ï¼Œè€Œæ¯ä¸ªå­é¡¹ç›®éƒ½æ˜¯ k8s ä¸­çš„ä¸€ä¸ªæœåŠ¡ï¼Œè¿™æ—¶ä¸€ä¸ª .drone.yml æ–‡ä»¶å¾ˆéš¾æŠŠæ‰€æœ‰çš„æœåŠ¡éƒ½å›Šæ‹¬ã€‚è€Œåˆä¸æƒ³æ¯ä¸ªå­é¡¹ç›®æ‹‰ä¸€ä¸ªåˆ†æ”¯ç®¡ç†ï¼Œå½“å‰çš„æ¨¡å¼å°±å¾ˆä¸åˆé€‚ã€‚\næ’ä»¶å¼€å‘ é’ˆå¯¹è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¯¹ drone è¿›è¡Œäº†å®šåˆ¶åŒ–å¼€å‘ï¼Œä¼šåœ¨æ¯æ¬¡æäº¤ä»£ç åï¼Œå¯¹æ–°æäº¤çš„ä»£ç å’Œè€ä»£ç è¿›è¡Œæ¯”è¾ƒï¼Œç­›é€‰å‡ºåšäº†ä¿®æ”¹çš„å­é¡¹ç›®ï¼Œç„¶åå¯¹æœ‰ä¿®æ”¹çš„å­é¡¹ç›®å°½å¿ƒ CI ï¼Œå…¶ä½™çš„å­é¡¹ç›®åˆ™ä¸è¿›è¡Œå‘å¸ƒã€‚\nè€Œä»¥ä¸Šçš„æ–¹å¼ä»…é€‚ç”¨äºæµ‹è¯•ç¯å¢ƒçš„å¿«é€Ÿè¿­ä»£ï¼Œç”Ÿäº§ç¯å¢ƒåˆ™é‡‡ç”¨ tag çš„æ¨¡å¼ï¼Œé’ˆå¯¹ä¸åŒçš„å­é¡¹ç›®ï¼Œæ‰“ä¸åŒå‰ç¼€çš„ tag ï¼Œæ¯”å¦‚å­é¡¹ç›®ä¸º test1 ï¼Œåˆ™æ‰“ test1-v0.0.1 çš„ tagï¼Œå°±ä¼šå¯¹è¯¥å­é¡¹ç›®è¿›è¡Œç”Ÿäº§å‘å¸ƒã€‚\næ„å»ºæ•ˆæœ  æœ‰ä¿®æ”¹çš„å­é¡¹ç›®\n æ— ä¿®æ”¹çš„å­é¡¹ç›®\n  Kubernetes å‘å¸ƒçŠ¶æ€æ£€æŸ¥ ä¹‹å‰çš„ Kubernetes å‘å¸ƒåªæ˜¯å°†æœåŠ¡å‘å¸ƒåˆ° Kubernetes é›†ç¾¤ï¼Œå¹¶ä¸ç®¡æœåŠ¡æ˜¯å¦æ­£å¸¸å¯åŠ¨ã€‚é’ˆå¯¹è¿™ä¸ªé—®é¢˜ä»¥åŠæˆ‘ä»¬çš„ Kubernetes åº”ç”¨ç®¡ç†æ¨¡å¼ï¼Œæˆ‘ä»¬å¼€å‘äº† drone çš„ Kubernetes å‘å¸ƒæ’ä»¶ï¼Œè¯¥æ’ä»¶åŒ…æ‹¬ kubectl ã€kustomizeã€kubedog ï¼Œæ¥å®Œå–„æˆ‘ä»¬çš„ Kubernetes å‘å¸ƒ step ã€‚\n .drone.yml\n steps: - name: Kubernetes éƒ¨ç½² image: guoxudongdocker/kubectl volumes: - name: kube path: /root/.kube settings: check: false # è¯¥å‚æ•°ä¸ºæ˜¯å¦å¼€å¯å­æ¨¡å—æ£€æŸ¥ config: deploy/overlays/uat # è¿™é‡Œä½¿ç”¨ kustomize ,è¯¦ç»†ä½¿ç”¨æ–¹æ³•è¯·è§ https://github.com/kubernetes-sigs/kustomize timeout: 300 # kubedog çš„æ£€æµ‹è¶…æ—¶ name: {your-deployment-name} # å¦‚æœå¼€å¯å­æ¨¡å—æ£€æŸ¥åˆ™éœ€è¦å¡«å…¥å­æ¨¡å—åç§° ... volumes: - name: kube host: path: /tmp/cache/.kube # kubeconfig æŒ‚è½½ä½ç½® trigger: branch: - master # è§¦å‘ CI çš„åˆ†æ”¯  ä½¿ç”¨è¯¥æ’ä»¶ä¼šå¦‚æœä¸ºæµ‹è¯•æ„å»ºï¼Œåˆ™ä¼šè‡ªåŠ¨è®¾ç½® docker é•œåƒ tag ä¸º DRONE_BUILD_NUMBER ï¼›å¦‚æœä¸ºç”Ÿäº§æ„å»ºï¼ˆgit tagï¼‰ï¼Œåˆ™å«è‡ªåŠ¨è®¾ç½® docker é•œåƒ tag ä¸º DRONE_TAG ï¼Œç„¶åé€šè¿‡ kubectl apply -k . è¿›è¡Œéƒ¨ç½²ï¼ŒåŒæ—¶ä½¿ç”¨ kubedog è¿›è¡Œéƒ¨ç½²çŠ¶æ€æ£€æŸ¥ï¼Œå¦‚æœæœåŠ¡æ­£å¸¸å¯åŠ¨åˆ™è¯¥ step é€šè¿‡ï¼Œå¦‚æœè¶…æ—¶æˆ–è€…éƒ¨ç½²æŠ¥é”™åˆ™è¯¥ step å¤±è´¥ã€‚\nç»“è¯­ æ ¹æ®æˆ‘ä»¬ç›®å‰çš„å¼€å‘æ¨¡å¼ï¼Œå¯¹ drone æ’ä»¶è¿›è¡Œäº†å…¨æ–¹ä½çš„å¼€å‘ã€‚ç”±äº dockerhub çš„é•œåƒæ‹‰å–ç»å¸¸è¶…æ—¶ï¼Œåˆ™å°†é•œåƒæ¨é€åˆ°äº†æˆ‘ä»¬è‡ªå·±çš„é•œåƒä»“åº“ï¼›å¯¹é’‰é’‰é€šçŸ¥ä¹Ÿè¿›è¡Œäº†ä¼˜åŒ–ï¼›åŒæ—¶ä¹Ÿæ ¹æ®æˆ‘ä»¬ç›®å‰çš„å¼€å‘è¯­è¨€è¿›è¡Œäº†æ’ä»¶çš„å¼€å‘ï¼Œæä¾›äº†åŸºäº Java ã€Python ä»¥åŠ Node.js çš„ drone æ’ä»¶ï¼ŒåŸºæœ¬å¯ä»¥æ»¡è¶³æˆ‘ä»¬ç°åœ¨çš„ CI éœ€æ±‚ï¼Œä½†éšç€ drone çš„æ·±å…¥ä½¿ç”¨ï¼Œè¶Šæ¥è¶Šå¤šçš„é—®é¢˜å°†ä¼šæš´éœ²å‡ºæ¥ã€‚åç»­å°†ä¼šä¸æ–­è§£å†³é‡åˆ°çš„é—®é¢˜ï¼ŒæŒç»­ä¼˜åŒ–ã€‚\n","date":1568181189,"expirydate":-62135596800,"kind":"page","lang":"zh","lastmod":1568181189,"objectID":"3492d1fe277fe03d425b7875868ae380","permalink":"https://guoxudong.io/post/drone-optimize/","publishdate":"2019-09-11T13:53:09+08:00","relpermalink":"/post/drone-optimize/","section":"post","summary":"é€šè¿‡è¿™ç¯‡æ–‡ç« æ€»ç»“ä¸€ä¸‹ç›®å‰æˆ‘ä»¬å¯¹ drone è¿›è¡Œäº†ä¸€äº›å®šåˆ¶åŒ–å¼€å‘ä»¥åŠä½¿ç”¨æŠ€å·§ï¼Œç”±äº drone å®˜æ–¹çš„æ–‡æ¡£ä¸æ˜¯å¾ˆè¯¦ç»†ï¼Œæ‰€ä»¥ä¹Ÿå¸Œæœ›é€šè¿‡è¿™ç§æ–¹æ³•æ¥å’Œå…¶ä»–ä½¿ç”¨ drone çš„ç”¨æˆ·åˆ†äº«å’Œäº¤æµä½¿ç”¨ç»éªŒã€‚","tags":["devops","drone","å·¥å…·"],"title":"ç©è½¬ Drone CI","type":"post"},{"authors":["éƒ­æ—­ä¸œ"],"categories":["éƒ¨ç½²å®‰è£…"],"content":" æœ¬æ–‡æ¡£ä»‹ç»äº†åœ¨ Github / Gitee çš„é™æ€é¡µæ‰˜ç®¡PagesæœåŠ¡éƒ¨ç½²SSLè¯ä¹¦ï¼Œé…ç½®HTTPSå®‰å…¨è®¿é—®çš„æ“ä½œè¯´æ˜ã€‚\nPagesæœåŠ¡ Github/Giteeçš„Pagesæ˜¯ä¸€ä¸ªå…è´¹çš„é™æ€ç½‘é¡µæ‰˜ç®¡æœåŠ¡ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨Githubæˆ–ç äº‘Pagesæ‰˜ç®¡åšå®¢ã€é¡¹ç›®å®˜ç½‘ç­‰é™æ€ç½‘é¡µã€‚å¸¸è§çš„é™æ€ç«™ç‚¹ç”Ÿæˆå™¨æœ‰ï¼šHugoã€Jekyllã€Hexoç­‰ï¼Œå¯ä»¥ç”¨æ¥ç”Ÿæˆé™æ€ç«™ç‚¹ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæ‰˜ç®¡çš„ç«™ç‚¹ä½¿ç”¨ github.io / gitee.io åŸŸåæ¥è®¿é—®ç«™ç‚¹ï¼ŒåŒæ—¶ä¹Ÿæ”¯æŒè‡ªå®šä¹‰åŸŸåï¼Œå¹¶é…ç½®å¼ºåˆ¶ä½¿ç”¨HTTPSã€‚\n æ³¨æ„ï¼šå¦‚æœè¦åœ¨ Gitee Pages ä¸Šé…ç½®è‡ªå®šä¹‰åŸŸå+HTTPSï¼Œåˆ™éœ€è¦å¼€å¯ Gitee Pages Pro ã€‚\n Github Pages æœåŠ¡éƒ¨ç½²SSLè¯ä¹¦ å‰ææ¡ä»¶  GitHub ä»“åº“ å¼€å¯ GitHub Pages  è¯ä¹¦ç­¾å‘  è´­ä¹°è¯ä¹¦åç‚¹å‡»ç”³è¯·\n è¯ä¹¦ç”³è¯·\nå¦‚æœè¯¥åŸŸåæ˜¯ç”±é˜¿é‡Œäº‘è´­ä¹°ï¼Œåˆ™é€‰æ‹©è‡ªåŠ¨DNSéªŒè¯ï¼Œå¦‚æœä¸æ˜¯åœ¨é˜¿é‡Œäº‘è´­ä¹°çš„ï¼Œå¯ä»¥é€‰æ‹©æ‰‹åŠ¨éªŒè¯ã€‚\n è¯ä¹¦ç­¾å‘\nè¯ä¹¦é€šè¿‡ç”³è¯·åï¼Œä¼šæ”¶åˆ°è¯ä¹¦ç­¾å‘çš„é‚®ä»¶ã€‚\n  è®¾ç½®è‡ªå®šä¹‰åŸŸå  è§£æåŸŸå\nåœ¨è¯ä¹¦ç­¾å‘æˆåŠŸåï¼Œæ·»åŠ DNSè§£æï¼Œå°†ç»‘å®šäº†SSLè¯ä¹¦çš„åŸŸåè§£æåˆ° YourRepo.github.io ã€‚\n é…ç½®åŸŸå\nè§£æä¹‹åå°†åŸŸåæ·»åŠ åˆ° Custom domain å¹¶ä¸”ç‚¹å‡» Save ï¼ŒGithubä¼šè‡ªåŠ¨éªŒè¯ï¼Œå‡ºç°Your site is published at https://YourDomainName.com/åˆ™è¯æ˜è§£ææˆåŠŸã€‚\n  Gitee Pages Pro æœåŠ¡éƒ¨ç½²SSLè¯ä¹¦ å‰ææ¡ä»¶  Gitee ä»“åº“ å¼€å¯ Gitee Pages Pro   Gitee éœ€è¦å¼€å¯ Gitee Pages Pro æœåŠ¡æ‰æ”¯æŒè‡ªå®šä¹‰åŸŸå+HTTPSã€‚\n è¯ä¹¦ç­¾å‘ è¯ä¹¦ç­¾å‘åŒ Github Pagesã€‚è¿™é‡Œä»‹ç»éé˜¿é‡Œäº‘è´­ä¹°çš„åŸŸåï¼Œè¿›è¡Œè¯ä¹¦ç”³è¯·ã€‚\n è´­ä¹°è¯ä¹¦æµç¨‹å¦‚ä¸Š\n ç”³è¯·è¯ä¹¦\nè¯ä¹¦éªŒè¯æ–¹å¼é€‰æ‹©æ‰‹å·¥DNSéªŒè¯ã€‚\n æ‹·è´éªŒè¯ä¿¡æ¯\næ‹·è´éªŒè¯ä¿¡æ¯å†…çš„è®°å½•å€¼ã€‚\n éªŒè¯è§£æ\nè¿›å…¥è´­ä¹°åŸŸåæ‰€åœ¨ç½‘ç«™è¿›è¡ŒDNSè§£æï¼Œè¿™é‡Œä»¥name.comä¸ºä¾‹ï¼š\nè§£ææˆåŠŸä¹‹åï¼Œè¿”å›é˜¿é‡Œäº‘SSLè¯ä¹¦ç®¡ç†é¡µé¢ç‚¹å‡»éªŒè¯.\n è¯ä¹¦ç­¾å‘\nç­¾å‘æˆåŠŸåä¼šæ”¶åˆ°ç­¾å‘æˆåŠŸçš„é‚®ä»¶ã€‚\n  è®¾ç½®è‡ªå®šä¹‰åŸŸå  è§£æåŸŸå\nè¿›å…¥åŸŸåæ‰€åœ¨ç½‘ç«™ï¼Œæ·»åŠ DNSè§£æè®°å½•ï¼Œå°†ç»‘å®šäº†SSLè¯ä¹¦çš„åŸŸåè§£æåˆ°gitee.gitee.io\n é…ç½®åŸŸå\n åŸŸåæ·»åŠ åˆ°è‡ªå®šä¹‰åŸŸå\n é…ç½®è¯ä¹¦\n è¯ä¹¦ä¸‹è½½ï¼Œé€‰æ‹© nginx ç±»å‹ã€‚\n gitee pages é…ç½®è¯ä¹¦ï¼Œå°†è¯ä¹¦æ–‡ä»¶ä¸ç§é’¥æ–‡ä»¶è´´å…¥å¹¶æäº¤ã€‚\n å‹¾é€‰å¼ºåˆ¶ä½¿ç”¨HTTPSï¼Œå¹¶ä¿å­˜ã€‚\n    éªŒè¯ åœ¨Github/Giteeé…ç½®æˆåŠŸä¹‹åï¼Œæ‚¨å¯åœ¨æµè§ˆå™¨ä¸­è¾“å…¥ https://www.YourDomainName.com éªŒè¯è¯ä¹¦å®‰è£…ç»“æœã€‚å¯ä»¥æ­£å¸¸è®¿é—®é™æ€æ‰˜ç®¡ç«™ç‚¹ï¼Œå¹¶ä¸”æµè§ˆå™¨åœ°å€æ æ˜¾ç¤ºç»¿è‰²çš„å°é”æ ‡è¯†è¯´æ˜è¯ä¹¦å®‰è£…æˆåŠŸã€‚\n","date":1566524215,"expirydate":-62135596800,"kind":"page","lang":"zh","lastmod":1566524215,"objectID":"deaf3224dbe7ec2fb608a59877ff08b7","permalink":"https://guoxudong.io/post/aliyun-ssl/","publishdate":"2019-08-23T09:36:55+08:00","relpermalink":"/post/aliyun-ssl/","section":"post","summary":"æœ¬æ–‡æ¡£ä»‹ç»äº†åœ¨ Github/Gitee çš„é™æ€é¡µæ‰˜ç®¡PagesæœåŠ¡éƒ¨ç½²SSLè¯ä¹¦ï¼Œé…ç½®HTTPSå®‰å…¨è®¿é—®çš„æ“ä½œè¯´æ˜ã€‚","tags":["é˜¿é‡Œäº‘"],"title":"GitHub/Gitee é™æ€é¡µæ‰˜ç®¡é¡µéƒ¨ç½²SSLè¯ä¹¦","type":"post"},{"authors":["éƒ­æ—­ä¸œ"],"categories":["kubernetes"],"content":" å‰è¨€ æœ€è¿‘å¯¹å…¬å¸ Kubernetes é›†ç¾¤çš„ nginx-ingress-controller è¿›è¡Œäº†å‡çº§ï¼Œä½†æ˜¯å‡çº§åå´å‡ºç°äº†å¤§é—®é¢˜ï¼Œä¹‹å‰æ‰€æœ‰é‡‡ç”¨ nginx.ingress.kubernetes.io/rewrite-target: / æ³¨é‡Šè¿›è¡Œé‡å®šå‘çš„ Ingress è·¯ç”±å…¨éƒ¨å¤±æ•ˆäº†ï¼Œä½†æ˜¯é‚£äº›ç›´æ¥è§£æäº†åŸŸåï¼Œæ²¡æœ‰è¿›è¡Œé‡å®šå‘çš„å´æ²¡æœ‰å‘ç”Ÿè¿™ä¸ªé—®é¢˜ã€‚\né—®é¢˜åˆ†æ  é¦–å…ˆæ£€æŸ¥å¯¹åº”æœåŠ¡å¥åº·çŠ¶æ€ï¼Œå‘ç°æ‰€æœ‰å‡ºé—®é¢˜çš„æœåŠ¡çš„çŠ¶æ€å‡æ­£å¸¸ï¼ŒåŒæ—¶å—å½±å“çš„ä¹‹å http è°ƒç”¨ï¼Œè€Œ RPC è°ƒç”¨å´ä¸å—å½±å“ï¼Œè¿™æ—¶é—®é¢˜å°±å®šä½åˆ°äº† ingressã€‚ ç„¶åæ£€æŸ¥ nginx-ingress-controller ï¼Œå‘ç° nginx-ingress-controller çš„çŠ¶æ€ä¹Ÿæ˜¯æ­£å¸¸çš„ï¼Œè·¯ç”±ä¹Ÿæ˜¯æ­£å¸¸çš„ã€‚ æœ€åå‘ç°å—å½±å“çš„åªæœ‰æ·»åŠ äº†é‡å®šå‘ç­–ç•¥çš„ ingress ã€‚  é—®é¢˜è§£å†³ é—®é¢˜å·²ç»å®šä½ï¼Œæ¥ä¸‹æ¥å°±æ˜¯ç€æ‰‹è§£å†³é—®é¢˜ï¼Œè¿™æ—¶å€™å€¼å¾—æ³¨æ„çš„å°±æ˜¯ä¹‹å‰è¿›è¡Œäº†ä»€ä¹ˆå˜æ›´ï¼šå‡çº§äº† nginx-ingress-controller ç‰ˆæœ¬ï¼çœ‹æ¥é—®é¢˜å°±å‡ºç°åœ¨æ–°ç‰ˆæœ¬ä¸Šï¼Œé‚£ä¹ˆå°±æ‰“å¼€å®˜æ–¹æ–‡æ¡£ï¼šhttps://kubernetes.github.io/ingress-nginx/examples/rewrite/ çœ‹ä¸€ä¸‹å§ã€‚\nAttention  Starting in Version 0.22.0, ingress definitions using the annotation nginx.ingress.kubernetes.io/rewrite-target are not backwards compatible with previous versions. In Version 0.22.0 and beyond, any substrings within the request URI that need to be passed to the rewritten path must explicitly be defined in a capture group.\n æ–‡æ¡£ä¸Šç»™å‡ºäº†éå¸¸æ˜æ˜¾çš„è­¦å‘Šâš ï¸ï¼šä» V0.22.0 ç‰ˆæœ¬å¼€å§‹å°†ä¸å†å…¼å®¹ä¹‹å‰çš„å…¥å£å®šä¹‰ï¼Œå†æŸ¥çœ‹ä¸€ä¸‹æˆ‘çš„ nginx-ingress-controller ç‰ˆæœ¬ï¼Œæœç„¶é—®é¢˜å‡ºç°æ¥è¿™é‡Œã€‚\nNote  Captured groups are saved in numbered placeholders, chronologically, in the form $1, $2 \u0026hellip; $n. These placeholders can be used as parameters in the rewrite-target annotation.\n ç¤ºä¾‹ åˆ°è¿™é‡Œé—®é¢˜å·²ç»è§£å†³äº†ï¼Œåœ¨æ›´æ–°äº† ingress çš„é…ç½®ä¹‹åï¼Œä¹‹å‰æ‰€æœ‰æ— æ³•é‡å®šå‘çš„æœåŠ¡ç°åœ¨éƒ½å·²ç»å¯ä»¥æ­£å¸¸è®¿é—®äº†ã€‚ä¿®æ”¹è§å¦‚ä¸‹ç¤ºä¾‹ï¼š\n$ echo ' apiVersion: extensions/v1beta1 kind: Ingress metadata: annotations: nginx.ingress.kubernetes.io/rewrite-target: /$2 name: rewrite namespace: default spec: rules: - host: rewrite.bar.com http: paths: - backend: serviceName: http-svc servicePort: 80 path: /something(/|$)(.*) ' | kubectl create -f -  ç»“è¯­ è§£å†³è¿™ä¸ªé—®é¢˜çš„å®é™…æ—¶é—´è™½ç„¶ä¸é•¿ï¼Œä½†æ˜¯ç€å®è®©äººå‡ºäº†ä¸€èº«å†·æ±—ï¼ŒåŒæ—¶ä¹Ÿç»™äº†æˆ‘è­¦ç¤ºï¼šå˜æ›´æœ‰é£é™©ï¼Œå‡çº§éœ€è°¨æ…ã€‚åœ¨å‡çº§ä¹‹å‰éœ€è¦å…ˆæµè§ˆæ–°ç‰ˆæœ¬çš„å‡çº§ä¿¡æ¯ï¼ŒåŒæ—¶éœ€è¦åˆ¶å®šå®Œå–„çš„å›æ»šç­–ç•¥ï¼Œç¡®ä¿ä¸‡æ— ä¸€å¤±ã€‚\n","date":1565925337,"expirydate":-62135596800,"kind":"page","lang":"zh","lastmod":1565925337,"objectID":"76420f90a66ee6197f23f863e31ea15b","permalink":"https://guoxudong.io/post/nginx-ingress-error/","publishdate":"2019-08-16T11:15:37+08:00","relpermalink":"/post/nginx-ingress-error/","section":"post","summary":"è®°å½• Nginx-Ingress é‡å®šå‘å¤±è´¥é—®é¢˜çš„è§£å†³è¿‡ç¨‹ã€‚","tags":["kubernetes","å®¹å™¨"],"title":"è§£å†³ Nginx-Ingress é‡å®šå‘å¤±è´¥é—®é¢˜","type":"post"},{"authors":null,"categories":["ç¿»è¯‘"],"content":"  éšç€3å¹´å‰é‡æ„ Dailymotion æ ¸å¿ƒAPIçš„å†³å®šï¼Œæˆ‘ä»¬å¸Œæœ›æä¾›ä¸€ç§æ›´æœ‰æ•ˆçš„æ–¹å¼æ¥æ‰˜ç®¡åº”ç”¨ç¨‹åºï¼Œä¿ƒè¿›æˆ‘ä»¬çš„å¼€å‘å’Œç”Ÿäº§å·¥ä½œæµç¨‹ã€‚ æœ€ç»ˆå†³å®šä½¿ç”¨å®¹å™¨ç¼–æ’å¹³å°æ¥å®ç°è¿™ä¸€ç›®æ ‡ï¼Œé‚£ä¹ˆè‡ªç„¶å°±é€‰æ‹©äº† Kubernetesã€‚\n é‚£ä¹ˆä¸ºä»€ä¹ˆè¦å»ºç«‹è‡ªå·±çš„Kuberneteså¹³å°ï¼Ÿ\nå€Ÿç”± Google Cloud å¿«é€Ÿæ¨åŠ¨çš„ API æŠ•å…¥ç”Ÿäº§  2016å¹´å¤\n ä¸‰å¹´å‰ï¼Œåœ¨ Vivendi æ”¶è´­ Dailymotion ä¹‹åï¼Œæ‰€æœ‰å¼€å‘å›¢é˜Ÿéƒ½ä¸“æ³¨äºä¸€ä¸ªç›®æ ‡ï¼šæä¾›å…¨æ–°çš„ Dailymotion äº§å“ã€‚\næ ¹æ®å¯¹å®¹å™¨ã€ç¼–æ’è§£å†³æ–¹æ¡ˆå’Œä»¥å‰çš„ç»éªŒçš„åˆ†æï¼Œä½¿æˆ‘ä»¬ç¡®ä¿¡ Kubernetes æ˜¯æ­£ç¡®çš„é€‰æ‹©ã€‚è®¸å¤šå¼€å‘äººå‘˜å·²ç»æŒæ¡äº†è¿™ä¸€æ¦‚å¿µå¹¶çŸ¥é“å¦‚ä½•ä½¿ç”¨ Kubernetes ï¼Œè¿™å¯¹æˆ‘ä»¬çš„åŸºç¡€è®¾æ–½è½¬å‹æ¥è¯´æ˜¯ä¸€ä¸ªå·¨å¤§çš„ä¼˜åŠ¿ã€‚åœ¨åŸºç¡€æ¶æ„æ–¹é¢ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªå¼ºå¤§è€Œçµæ´»çš„å¹³å°æ¥æ‰˜ç®¡è¿™äº›æ–°å‹çš„äº‘åŸç”Ÿåº”ç”¨ç¨‹åºã€‚è€Œå…¬æœ‰äº‘ä¸ºæˆ‘ä»¬æä¾›äº†æå¤§çš„ä¾¿åˆ©ï¼Œäºæ˜¯æˆ‘ä»¬å†³å®šåœ¨ Google Kubernetes Engine ä¸Šéƒ¨ç½²æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºï¼Œå³ä½¿ä¹‹åæˆ‘ä»¬ä¹Ÿä¼šåœ¨è‡ªå·±çš„æ•°æ®ä¸­å¿ƒä¸­è¿›è¡Œæ··åˆéƒ¨ç½²ã€‚\nä¸ºä½•é€‰æ‹© GKE ï¼Ÿ æˆ‘ä»¬åšå‡ºè¿™ä¸ªé€‰æ‹©ä¸»è¦æ˜¯å‡ºäºæŠ€æœ¯åŸå› ï¼Œä½†ä¹Ÿå› ä¸ºæˆ‘ä»¬éœ€è¦å¿«é€Ÿæä¾›åŸºç¡€è®¾æ–½æ¥æ»¡è¶³ Dailymotion çš„ä¸šåŠ¡éœ€æ±‚ã€‚å¹¶ä¸”å¯¹æ‰˜ç®¡çš„åº”ç”¨ç¨‹åºï¼ˆå¦‚åœ°ç†åˆ†å¸ƒï¼Œå¯ä¼¸ç¼©æ€§å’Œå¼¹æ€§ï¼‰æœ‰ä¸€äº›è¦æ±‚ã€‚\nDailymotion çš„ GKE é›†ç¾¤\nDailymotion ä½œä¸ºä¸€ä¸ªå…¨çƒæ€§çš„è§†é¢‘å¹³å°ï¼Œéœ€è¦é€šè¿‡å‡å°‘å»¶è¿Ÿæ¥æ”¹å–„ç”¨æˆ·ä½“éªŒã€‚ä¹‹å‰æˆ‘ä»¬ä»…åœ¨å·´é»æä¾› API ï¼Œä½†è¿™æ ·å¹¶éæœ€ä½³ï¼Œæˆ‘ä»¬å¸Œæœ›èƒ½å¤Ÿåœ¨æ¬§æ´²ã€äºšæ´²ä»¥åŠç¾å›½æ‰˜ç®¡æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºã€‚\nè¿™ç§å»¶è¿Ÿé™åˆ¶æ„å‘³ç€æˆ‘ä»¬åœ¨å¹³å°çš„ç½‘ç»œè®¾è®¡æ–¹é¢é¢ä¸´ç€å·¨å¤§çš„æŒ‘æˆ˜ã€‚å¤§å¤šæ•°äº‘ä¾›åº”å•†è¦æ±‚æˆ‘ä»¬åœ¨æ¯ä¸ªåœ°åŒºåˆ›å»ºä¸€ä¸ªç½‘ç»œï¼Œå¹¶å°†æ‰€æœ‰è¿™äº›ç½‘ç»œé€šè¿‡ VPN ä¸æ‰˜ç®¡æœåŠ¡äº’è¿ï¼Œä½† Google Cloud å…è®¸æˆ‘ä»¬åœ¨æ‰€æœ‰ Google åœ°åŒºåˆ›å»ºä¸€ä¸ªå®Œå…¨è·¯ç”±çš„å•ä¸€ç½‘ç»œï¼Œè¯¥ç½‘ç»œåœ¨è¿è¥æ–¹é¢æä¾›äº†ä¾¿åˆ©å¹¶æé«˜äº†æ•ˆç‡ã€‚\næ­¤å¤–ï¼ŒGoogle Cloud çš„ç½‘ç»œå’Œè´Ÿè½½å‡è¡¡æœåŠ¡éå¸¸æ£’ã€‚å®ƒå¯ä»¥å°†æˆ‘ä»¬çš„ç”¨æˆ·è·¯ç”±åˆ°æœ€è¿‘çš„é›†ç¾¤ï¼Œå¹¶ä¸”åœ¨å‘ç”Ÿæ•…éšœçš„æƒ…å†µä¸‹ï¼Œæµé‡ä¼šè‡ªåŠ¨è·¯ç”±åˆ°å¦ä¸€ä¸ªåŒºåŸŸè€Œæ— éœ€ä»»ä½•äººä¸ºå¹²é¢„ã€‚\nGoogle è´Ÿè½½å‡è¡¡ç›‘æ§\næˆ‘ä»¬çš„å¹³å°åŒæ ·éœ€è¦ä½¿ç”¨ GPUï¼Œè€Œ Google Cloud å…è®¸æˆ‘ä»¬ä»¥éå¸¸æœ‰æ•ˆçš„æ–¹å¼ç›´æ¥åœ¨æˆ‘ä»¬çš„ Kubernetes é›†ç¾¤ä¸­ä½¿ç”¨å®ƒä»¬ã€‚\næ‰€æœ‰è¿™ä¸€åˆ‡ä½¿æˆ‘ä»¬åœ¨å¯åŠ¨å6ä¸ªæœˆå¼€å§‹æ¥å…¥ Google Cloud åŸºç¡€æ¶æ„ä¸Šçš„ç”Ÿäº§æµé‡ã€‚\nä½†æ˜¯ï¼Œå°½ç®¡å…·æœ‰æ•´ä½“ä¼˜åŠ¿ï¼Œä½†ä½¿ç”¨å…±æœ‰äº‘æœåŠ¡è¿˜æ˜¯è¦èŠ±è´¹ä¸å°‘æˆæœ¬ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬è¦è¯„ä¼°é‡‡å–çš„æ¯é¡¹æ‰˜ç®¡æœåŠ¡ï¼Œä»¥ä¾¿å°†æ¥å°†å…¶å†…éƒ¨åŒ–ã€‚äº‹å®ä¸Šï¼Œæˆ‘ä»¬åœ¨2016å¹´åº•å¼€å§‹æ„å»ºæˆ‘ä»¬çš„æœ¬åœ°é›†ç¾¤ï¼Œå¹¶å¯åŠ¨äº†æˆ‘ä»¬çš„æ··åˆç­–ç•¥ã€‚\nåœ¨ Dailymotion çš„å†…éƒ¨æ„å»ºå®¹å™¨ç¼–æ’å¹³å°  2016å¹´ç§‹\n çœ‹åˆ°æ•´ä¸ªæŠ€æœ¯æ ˆå·²ç»å‡†å¤‡å¥½åœ¨ç”Ÿäº§ç¯å¢ƒä¸­åº”ç”¨ï¼Œä½†APIä»åœ¨å¼€å‘ä¸­ï¼Œè¿™ä½¿å¾—æˆ‘ä»¬æœ‰æ—¶é—´ä¸“æ³¨æ­å»ºæˆ‘ä»¬çš„æœ¬åœ°é›†ç¾¤ã€‚\nDailymotion å¤šå¹´æ¥åœ¨å…¨çƒæ‹¥æœ‰è‡ªå·±çš„å†…å®¹åˆ†å‘ç½‘ç»œï¼Œæ¯æœˆæœ‰è¶…è¿‡30äº¿çš„è§†é¢‘æ’­æ”¾é‡ã€‚æ˜¾ç„¶ï¼Œæˆ‘ä»¬å¸Œæœ›åˆ©ç”¨ç°æœ‰çš„ä¼˜åŠ¿å¹¶åœ¨æˆ‘ä»¬ç°æœ‰çš„æ•°æ®ä¸­å¿ƒéƒ¨ç½²è‡ªå·±çš„ Kubernetes é›†ç¾¤ã€‚\næˆ‘çš„ç›®å‰æ‹¥æœ‰6ä¸ªæ•°æ®ä¸­å¿ƒçš„2500å¤šå°æœåŠ¡å™¨ã€‚æ‰€æœ‰è¿™äº›éƒ½ä½¿ç”¨ Saltstack è¿›è¡Œé…ç½®ï¼Œæˆ‘ä»¬å¼€å§‹å‡†å¤‡æ‰€æœ‰éœ€è¦çš„å…¬å¼æ¥åˆ›å»ºä¸»èŠ‚ç‚¹ã€å·¥ä½œèŠ‚ç‚¹ä»¥åŠ Etcd é›†ç¾¤ã€‚\nç½‘ç»œéƒ¨åˆ† æˆ‘ä»¬çš„ç½‘ç»œæ˜¯ä¸€ä¸ªå®Œå…¨è·¯ç”±çš„ç½‘ç»œã€‚æ¯ä¸ªæœåŠ¡å™¨ä½¿ç”¨Exabgpé€šè¿‡ç½‘ç»œå¹¿æ’­è‡ªå·±çš„IPã€‚æˆ‘ä»¬æ¯”è¾ƒäº†å‡ ä¸ªç½‘ç»œæ’ä»¶ï¼Œ Calico ä½¿ç”¨çš„æ˜¯ä¸‰å±‚ç½‘ç»œï¼Œå› æ­¤è¿™æ˜¯å”¯ä¸€æ»¡è¶³æˆ‘ä»¬éœ€æ±‚çš„ç½‘ç»œæ’ä»¶ã€‚\nç”±äºæˆ‘ä»¬æƒ³è¦é‡ç”¨åŸºç¡€æ¶æ„ä¸­çš„æ‰€æœ‰ç°æœ‰å·¥å…·ï¼Œé¦–å…ˆè¦è§£å†³çš„é—®é¢˜æ˜¯æ’å…¥ä¸€ä¸ªè‡ªåˆ¶ç½‘ç»œå·¥å…·ï¼ˆæˆ‘ä»¬æ‰€æœ‰æœåŠ¡å™¨éƒ½ä½¿ç”¨å®ƒï¼‰ï¼Œé€šè¿‡æˆ‘ä»¬çš„ Kubernetes èŠ‚ç‚¹é€šè¿‡ç½‘ç»œå¹¿æ’­ IP èŒƒå›´ã€‚æˆ‘ä»¬è®© Calico ä¸º pod åˆ†é… IPï¼Œä½†ä¸ä½¿ç”¨å®ƒä¸æˆ‘ä»¬çš„ç½‘ç»œè®¾å¤‡è¿›è¡ŒBGPä¼šè¯ã€‚è·¯ç”±å®é™…ä¸Šæ˜¯ç”±Exabgpå¤„ç†çš„ï¼Œå®ƒå®£å¸ƒäº†Calicoä½¿ç”¨çš„å­ç½‘ã€‚è¿™ä½¿æˆ‘ä»¬å¯ä»¥ä»å†…éƒ¨ç½‘ç»œè®¿é—®ä»»ä½•podï¼Œå°¤å…¶æ˜¯æ¥è‡ªæˆ‘ä»¬çš„è´Ÿè½½å‡è¡¡å™¨ã€‚\næˆ‘ä»¬å¦‚ä½•ç®¡ç†å…¥å£æµé‡ ä¸ºäº†å°†ä¼ å…¥çš„è¯·æ±‚è·¯ç”±åˆ°æ­£ç¡®çš„æœåŠ¡ï¼Œæˆ‘ä»¬å¸Œæœ›ä½¿ç”¨ Ingress Controllers ä¸ Kubernetes çš„å…¥å£èµ„æºé›†æˆã€‚\n3å¹´å‰ï¼Œnginx-ingress-controller æ˜¯æœ€æˆç†Ÿçš„æ§åˆ¶å™¨ ï¼Œå¹¶ä¸” Nginx å·²ç»ä½¿ç”¨å¤šå¹´ï¼Œå¹¶ä»¥å…¶ç¨³å®šæ€§å’Œæ€§èƒ½è€Œé—»åã€‚\nåœ¨æˆ‘ä»¬çš„è®¾è®¡ä¸­ï¼Œæˆ‘ä»¬å†³å®šåœ¨ä¸“ç”¨çš„ 10Gbps åˆ€ç‰‡æœåŠ¡å™¨ä¸Šæ‰˜ç®¡æˆ‘ä»¬çš„æ§åˆ¶å™¨ã€‚æ¯ä¸ªæ§åˆ¶å™¨éƒ½æ’å…¥å…¶æ‰€å±é›†ç¾¤çš„ kube-apiserver ç«¯ç‚¹ã€‚åœ¨è¿™äº›æœåŠ¡å™¨ä¸Šï¼Œæˆ‘ä»¬è¿˜ä½¿ç”¨Exabgpæ¥å¹¿æ’­å…¬å…±æˆ–ç§æœ‰IPã€‚æˆ‘ä»¬çš„ç½‘ç»œæ‹“æ‰‘å…è®¸æˆ‘ä»¬ä½¿ç”¨æ¥è‡ªè¿™äº›æ§åˆ¶å™¨çš„BGPå°†æ‰€æœ‰æµé‡ç›´æ¥è·¯ç”±åˆ°æˆ‘ä»¬çš„podï¼Œè€Œæ— éœ€ä½¿ç”¨NodePortæœåŠ¡ç±»å‹ã€‚è¿™æ ·å¯ä»¥é¿å…èŠ‚ç‚¹ä¹‹é—´çš„æ°´å¹³æµé‡ï¼Œä»è€Œæé«˜æ•ˆç‡ã€‚\nä» Internet åˆ° pods çš„æµé‡\nç°åœ¨æˆ‘ä»¬å·²ç»çœ‹åˆ°äº†æˆ‘ä»¬å¦‚ä½•æ„å»ºæ··åˆå¹³å°ï¼Œæˆ‘ä»¬å¯ä»¥æ·±å…¥äº†è§£æµé‡è¿ç§»æœ¬èº«ã€‚\nå°†æµé‡ä» Google Cloud è¿ç§»åˆ° Dailymotions åŸºç¡€æ¶æ„  2018å¹´ç§‹\n ç»è¿‡è¿‘2å¹´çš„æ„å»ºã€æµ‹è¯•å’Œå¾®è°ƒï¼Œæˆ‘ä»¬å‘ç°è‡ªå·±æ‹¥æœ‰å®Œæ•´çš„ Kubernetes æŠ€æœ¯æ ˆï¼Œå¯ä»¥æ¥æ”¶éƒ¨åˆ†æµé‡ã€‚\nç›®å‰ï¼Œæˆ‘ä»¬çš„è·¯ç”±ç­–ç•¥éå¸¸ç®€å•ï¼Œä½†è¶³ä»¥è§£å†³æˆ‘ä»¬çš„é—®é¢˜ã€‚é™¤äº†æˆ‘ä»¬çš„å…¬å…±IPï¼ˆGoogle Cloudå’ŒDailymotionï¼‰ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜ä½¿ç”¨AWS Route 53 æ¥å®šä¹‰ç­–ç•¥å¹¶å°†ç»ˆç«¯ç”¨æˆ·æµé‡å¼•å…¥æˆ‘ä»¬é€‰æ‹©çš„é›†ç¾¤ã€‚\nä½¿ç”¨Route 53çš„è·¯ç”±ç­–ç•¥ç¤ºä¾‹\nåœ¨ Google Cloud ä¸Šå¾ˆç®€å•ï¼Œå› ä¸ºæˆ‘ä»¬ä¸ºæ‰€æœ‰ç¾¤é›†ä½¿ç”¨å”¯ä¸€çš„IPï¼Œå¹¶ä¸”ç”¨æˆ·è¢«è·¯ç”±åˆ°ä»–æœ€è¿‘çš„ GKE ç¾¤é›†ã€‚å¯¹äºæˆ‘ä»¬æ¥è¯´ï¼Œæˆ‘ä»¬ä¸ä½¿ç”¨ç›¸åŒçš„æŠ€æœ¯ï¼Œå› æ­¤æˆ‘ä»¬æ¯ä¸ªç¾¤é›†éƒ½æœ‰ä¸åŒçš„IPã€‚\nåœ¨æ­¤æ¬¡è¿ç§»è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†ç›®æ ‡å›½å®¶é€æ­¥çº³å…¥æˆ‘ä»¬çš„é›†ç¾¤å¹¶åˆ†æå…¶æ”¶ç›Šã€‚\nç”±äºæˆ‘ä»¬çš„GKEé›†ç¾¤é…ç½®äº†è‡ªåŠ¨è°ƒèŠ‚è‡ªå®šä¹‰æŒ‡æ ‡ï¼Œå› æ­¤å®ƒä»¬ä¼šæ ¹æ®ä¼ å…¥æµé‡è¿›è¡Œæ‰©å±•/ç¼©å°ã€‚\nåœ¨æ­£å¸¸æ¨¡å¼ä¸‹ï¼ŒåŒºåŸŸçš„æ‰€æœ‰æµé‡éƒ½è·¯ç”±åˆ°æˆ‘ä»¬çš„å†…éƒ¨éƒ¨ç½²é›†ç¾¤ï¼Œè€ŒGKEé›†ç¾¤åˆ™ä½¿ç”¨Route 53æä¾›çš„è¿è¡ŒçŠ¶å†µæ£€æŸ¥ä½œä¸ºæ•…éšœè½¬ç§»ã€‚\nç»“è¯­ æˆ‘ä»¬æ¥ä¸‹æ¥çš„æ­¥éª¤æ˜¯å®Œå…¨è‡ªåŠ¨åŒ–æˆ‘ä»¬çš„è·¯ç”±ç­–ç•¥ï¼Œä»¥å®ç°è‡ªåŠ¨æ··åˆç­–ç•¥ï¼Œä¸æ–­å¢å¼ºæˆ‘ä»¬çš„ç”¨æˆ·ä½“éªŒã€‚åœ¨æ•ˆç›Šæ–¹é¢ï¼Œæˆ‘ä»¬å¤§å¤§é™ä½äº†äº‘çš„æˆæœ¬ï¼Œç”šè‡³æ”¹å–„äº†APIå“åº”æ—¶é—´ã€‚æˆ‘ä»¬ç›¸ä¿¡æˆ‘ä»¬çš„äº‘å¹³å°è¶³ä»¥åœ¨éœ€è¦æ—¶å¤„ç†æ›´å¤šæµé‡ã€‚\n","date":1565071290,"expirydate":-62135596800,"kind":"page","lang":"zh","lastmod":1565071290,"objectID":"6e3a65efbe515e1971fed4e2b26a9107","permalink":"https://guoxudong.io/post/how-we-built-our-hybrid-kubernetes-platfor/","publishdate":"2019-08-06T14:01:30+08:00","relpermalink":"/post/how-we-built-our-hybrid-kubernetes-platfor/","section":"post","summary":"éšç€3å¹´å‰é‡æ„ Dailymotion æ ¸å¿ƒAPIçš„å†³å®šï¼Œæˆ‘ä»¬å¸Œæœ›æä¾›ä¸€ç§æ›´æœ‰æ•ˆçš„æ–¹å¼æ¥æ‰˜ç®¡åº”ç”¨ç¨‹åºï¼Œä¿ƒè¿›æˆ‘ä»¬çš„å¼€å‘å’Œç”Ÿäº§å·¥ä½œæµç¨‹ã€‚ æœ€ç»ˆå†³å®šä½¿ç”¨å®¹å™¨ç¼–æ’å¹³å°æ¥å®ç°è¿™ä¸€ç›®æ ‡ï¼Œé‚£ä¹ˆè‡ªç„¶å°±é€‰æ‹©äº† Kubernetesã€‚","tags":["ç¿»è¯‘","kubernetes"],"title":"å¦‚ä½•æ„å»ºæ··åˆKuberneteså¹³å°","type":"post"},{"authors":["éƒ­æ—­ä¸œ"],"categories":["go"],"content":" å‰è¨€ ç»è¿‡ä¸Šç¯‡æ–‡ç« ï¼Œæˆ‘ä»¬å·²ç»å¯ä»¥åœ¨ GitHub ä¸Šæ„å»ºä¸€ä¸ªçœ‹ä¸Šå»æ­£ç»çš„ Golang é¡¹ç›®äº†ï¼Œä½†è¿™å¹¶ä¸æ˜¯ç»“æŸã€‚ä¸€ä¸ªçœŸæ­£çš„ç”¨ Golang æ„å»ºçš„å¯æ‰§è¡Œæ–‡ä»¶æ˜¯å¯ä»¥åœ¨å…¨å¹³å°è¿è¡Œçš„ï¼Œå‰æ–‡ä¸­æˆ‘ä»¬ä½¿ç”¨ goreleaser å‘å¸ƒäº†ä¸€ä¸ªéå¸¸æ¼‚äº®çš„ release é¡µé¢ï¼Œå¹¶åœ¨ release é¡µé¢ä¸Šæä¾›å¤šå¹³å°çš„å¯æ‰§è¡Œæ–‡ä»¶ä¸‹è½½ã€‚ä½†æ˜¯å¦‚æœåªæ˜¯æ‹¿ç€å¯æ‰§è¡Œæ–‡ä»¶åˆ°å¤„æ‹·è´æ‰§è¡Œï¼Œæ€»å½’ä¸å¤Ÿä¼˜é›…ï¼Œæ‰€ä»¥è¿™é‡Œå°±ä»‹ç»å¦‚ä½•åœ¨ Homebrew ä¸Šå‘å¸ƒè‡ªå·±çš„ Golang åº”ç”¨ï¼Œå¦‚ä½•åƒå„ç§ç‰›é€¼çš„é¡¹ç›®é‚£æ ·ä½¿ç”¨ brew ä¸€é”®å®‰è£…è‡ªå·±çš„é¡¹ç›®ã€‚\nHomebrew å¯¹äºä½¿ç”¨ macOS çš„ç”¨æˆ·æ¥è¯´ï¼ŒHomebrew ä¸€ç‚¹ä¹Ÿä¸é™Œç”Ÿï¼Œå®ƒç±»ä¼¼äº CentOS çš„ yum å’Œ Ubuntu çš„ apt-get ã€‚\nHomebrew æ˜¯æœ€åˆç”± Max Howell ç”¨ Ruby å†™çš„ OS X è½¯ä»¶ç®¡ç†ç³»ç»Ÿï¼Œå…¶ä»£ç å¼€æºåœ¨ GitHub ä¸Šã€‚\nHomebrew ç»™è‡ªå·±è´´äº†ä¸ªä¸€å¥è¯ç®€ä»‹ï¼šThe missing package manager for OS Xã€‚ç¿»è¯‘è¿‡æ¥æˆä¸­æ–‡å°±æ˜¯ï¼šmacOS ç¼ºå¤±çš„è½¯ä»¶åŒ…çš„ç®¡ç†å™¨ã€‚åå‰¯å…¶å®åœ°æ˜¯ï¼ŒHomebrew çœŸçš„å¾ˆå¥½ç”¨ã€‚å®‰è£…ã€å‡çº§ã€å¸è½½ç­‰æ“ä½œï¼Œåœ¨ Homebrew çš„ç”Ÿæ€ä¸‹ï¼Œéƒ½åªéœ€è¦ä¸€æ¡å‘½ä»¤å°±å¯ä»¥äº†ã€‚å¹¶ä¸” Homebrew ä¼šè‡ªåŠ¨ä¸ºä½ è§£å†³è½¯ä»¶åŒ…çš„ä¾èµ–é—®é¢˜ã€‚\nå‘å¸ƒæ­¥éª¤  åˆ›å»º Formula ä¿®æ”¹ rb è„šæœ¬ æœ¬åœ°æµ‹è¯• åˆ›å»º Tap å®é™…å®‰è£…  åˆ›å»º Formula é¦–å…ˆè¿›å…¥ release é¡µé¢ï¼Œæ‹·è´ macOS çš„ Darwin åŒ…åœ°å€\nç„¶åé€šè¿‡å‘½ä»¤åœ¨æœ¬åœ°åˆ›å»º Formula\nbrew create https://github.com/sunny0826/kubecm/releases/download/v0.0.1/kubecm_0.0.1_Darwin_x86_64.tar.gz  é€šè¿‡è¿™ä¸ªå‘½ä»¤ï¼Œbrew ä¼šåˆ›å»ºä¸€ä¸ªåä¸º kubecm.rb çš„æ–‡ä»¶åœ¨ /usr/local/Homebrew/Library/Taps/homebrew/homebrew-core/Formula/ ç›®å½•ã€‚\nä¿®æ”¹ rb è„šæœ¬ ç„¶ååœ¨è¯¥ç›®å½•å¯ä»¥çœ‹åˆ° kubecm.rb è¿™ä¸ªè„šæœ¬ï¼š\n# Documentation: https://github.com/Homebrew/brew/blob/master/share/doc/homebrew/Formula-Cookbook.md # http://www.rubydoc.info/github/Homebrew/brew/master/Formula # PLEASE REMOVE ALL GENERATED COMMENTS BEFORE SUBMITTING YOUR PULL REQUEST! class OtfccMac64 \u0026lt; Formula desc \u0026quot;\u0026quot; homepage \u0026quot;\u0026quot; url \u0026quot;https://github.com/sunny0826/kubecm/releases/download/v0.0.1/kubecm_0.0.1_Darwin_x86_64.tar.gz\u0026quot; version \u0026quot;0.0.1\u0026quot; sha256 \u0026quot;f393b14f9c42c890b8a60949b13a8f9b5c3f814daa8b18901656ccc3b866f646\u0026quot; # depends_on \u0026quot;cmake\u0026quot; =\u0026gt; :build depends_on :x11 # if your formula requires any X11/XQuartz components def install # ENV.deparallelize # if your formula fails when building in parallel # Remove unrecognized options if warned by configure system \u0026quot;./configure\u0026quot;, \u0026quot;--disable-debug\u0026quot;, \u0026quot;--disable-dependency-tracking\u0026quot;, \u0026quot;--disable-silent-rules\u0026quot;, \u0026quot;--prefix=#{prefix}\u0026quot; # system \u0026quot;cmake\u0026quot;, \u0026quot;.\u0026quot;, *std_cmake_args system \u0026quot;make\u0026quot;, \u0026quot;install\u0026quot; # if this fails, try separate make/make install steps end test do # `test do` will create, run in and delete a temporary directory. # # This test will fail and we won't accept that! It's enough to just replace # \u0026quot;false\u0026quot; with the main program this formula installs, but it'd be nice if you # were more thorough. Run the test with `brew test otfcc-win32`. Options passed # to `brew install` such as `--HEAD` also need to be provided to `brew test`. # # The installed folder is not in the path, so use the entire path to any # executables being tested: `system \u0026quot;#{bin}/program\u0026quot;, \u0026quot;do\u0026quot;, \u0026quot;something\u0026quot;`. system \u0026quot;false\u0026quot; end end  é»˜è®¤æä¾›çš„è„šæœ¬å¹¶ä¸é€‚åˆæˆ‘ä»¬ï¼Œä¿®æ”¹è¿™ä¸ªè„šæœ¬ï¼š\nclass Kubecm \u0026lt; Formula desc \u0026quot;Merge multiple kubeconfig\u0026quot; homepage \u0026quot;https://github.com/sunny0826/kubecm\u0026quot; url \u0026quot;https://github.com/sunny0826/kubecm/releases/download/v0.0.1/kubecm_0.0.1_Darwin_x86_64.tar.gz\u0026quot; version \u0026quot;0.0.1\u0026quot; sha256 \u0026quot;8c2766e7720049ba0ce9e3d20b7511796a6ba224ce1386cd1d4ef8cc6e1315cd\u0026quot; # depends_on \u0026quot;cmake\u0026quot; =\u0026gt; :build def install bin.install \u0026quot;kubecm\u0026quot; end end  åˆ†å¸ƒå¡«ä¸Š desc ã€ homepage ã€url ç­‰ä¿¡æ¯ï¼Œç”±äºè¿™é‡Œä¸‹è½½çš„æ˜¯ darwin åŒ…ï¼Œæ‰€ä»¥ç›´æ¥åœ¨ install ä¸­å¡«ä¸Š bin.install \u0026quot;kubecm\u0026quot; å³å¯ã€‚\næœ¬åœ°æµ‹è¯• ä¿å­˜è„šæœ¬ï¼Œç„¶åä½¿ç”¨ brew install kubecm è¿›è¡Œæµ‹è¯•ï¼ŒæŸ¥çœ‹ç»“æœï¼š\nUpdating Homebrew... Fast-forwarded master to origin/master. Fast-forwarded master to origin/master. ==\u0026gt; Auto-updated Homebrew! Updated 2 taps (sunny0826/tap, homebrew/cask). ==\u0026gt; Updated Formulae sunny0826/tap/kubecm ==\u0026gt; Downloading https://github.com/sunny0826/kubecm/releases/download/v0.0.1/kubecm_0.0.1_Darwin_x86_64.tar.gz Already downloaded: /Users/guoxudong/Library/Caches/Homebrew/kubecm-86.64.tar.gz ğŸº /usr/local/Cellar/kubecm/86.64: 5 files, 5.4MB, built in 1 second  å¯ä»¥çœ‹åˆ°å·²ç»å®‰è£…æˆåŠŸäº†ï¼\nåˆ›å»º Tap åœ¨æœ¬åœ°æµ‹è¯•æˆåŠŸä¹‹åï¼Œå°±å¯ä»¥æŠŠä»–å‘å¸ƒäº†ã€‚è¿™é‡Œéœ€è¦åœ¨ GitHub ä¸Šåˆ›å»ºä¸€ä¸ªåä¸º homebrew-tap çš„ repo æ³¨æ„è¯¥ repo éœ€è¦ä»¥ homebrew- ä¸ºå‰ç¼€ï¼Œåƒæ˜¯è¿™æ ·ã€‚\nç„¶åå°†åˆšæ‰çš„ kubecm.rb è„šæœ¬ä¸Šä¼ åˆ°è¿™ä¸ª repo ï¼Œç„¶åå°±å¯ä»¥é€šè¿‡ brew çš„æ–¹å¼å®‰è£…äº†ã€‚\nå®é™…æµ‹è¯• å‘å¸ƒå¥½ä¹‹åï¼Œå°±å¯ä»¥æµ‹è¯•å‘å¸ƒæˆåŠŸæ²¡æœ‰äº†ã€‚\né¦–å…ˆå¸è½½ä¹‹å‰ä½¿ç”¨æœ¬åœ°è„šæœ¬å®‰è£…çš„åº”ç”¨ï¼š\n$ brew uninstall kubecm Uninstalling /usr/local/Cellar/kubecm/86.64... (5 files, 5.4MB)  ç„¶åä½¿ç”¨\nbrew tap sunny0826/tap \u0026amp;\u0026amp; brew install kubecm  æˆ–è€…\nbrew install sunny0826/tap/kubecm  æ¥è¿›è¡Œå®‰è£…ã€‚\nç»“è¯­ åˆ°è¿™æˆ‘ä»¬å°±æˆåŠŸçš„åœ¨ Homebrew ä¸Šå‘å¸ƒäº†è‡ªå·±çš„ Golang åº”ç”¨ï¼Œæœ¬ç¯‡ä¸­çš„æ–¹æ³•ä»…é€‚åˆ Golang å¼€å‘çš„äºŒè¿›åˆ¶å¯æ‰§è¡Œæ–‡ä»¶çš„å‘å¸ƒï¼Œå…¶ä»–è¯­è¨€çš„å‘å¸ƒéœ€è¦åœ¨ .rb è„šæœ¬ä¸Šæœ‰æ‰€ä¿®æ”¹ï¼Œæ›´å¤šå†…å®¹è¯·å‚è€ƒå®˜æ–¹æ–‡æ¡£ã€‚è¿™é‡Œè¦å†ä»‹ç»ä¸€ä¸‹æˆ‘ç”¨ Golang å¼€å‘çš„å¦ä¸€ä¸ªå°å·¥å…· kubecm ï¼Œè¯¥é¡¹ç›®ä¹‹å‰æˆ‘æ˜¯ä½¿ç”¨ python å¼€å‘çš„ï¼Œç”¨äºåˆå¹¶å¤šä¸ª kubeconfig æ–‡ä»¶ï¼Œæœ¬æ¬¡é‡å†™æ–°å¢äº†æŸ¥çœ‹æ‰€æœ‰ kubeconfig å’Œ åˆ é™¤ kubeconfig ä¸­ context ç­‰åŠŸèƒ½ï¼ŒåŒæ—¶ä¹Ÿåœ¨ Homebrew ä¸Šå‘å¸ƒï¼Œæ¬¢è¿æ‹ç –ã€‚\n","date":1564043277,"expirydate":-62135596800,"kind":"page","lang":"zh","lastmod":1564043277,"objectID":"ce459a58346e0302631338d1a5b9458b","permalink":"https://guoxudong.io/post/golang-to-homebrew/","publishdate":"2019-07-25T16:27:57+08:00","relpermalink":"/post/golang-to-homebrew/","section":"post","summary":"æœ¬æ–‡ä»‹ç»å¦‚ä½•åœ¨ Homebrew ä¸Šå‘å¸ƒ Golang é¡¹ç›®ã€‚","tags":["go"],"title":"Golang è£…é€¼æŒ‡å— â…¡ï¼šåœ¨ Homwebrew ä¸Šå‘å¸ƒ Golang é¡¹ç›®","type":"post"},{"authors":["éƒ­æ—­ä¸œ"],"categories":["go"],"content":" å‰è¨€ æ¥è§¦ golang æ—¶é—´å¾ˆé•¿ï¼Œä½†æ˜¯çœŸæ­£åŠ¨æ‰‹å¼€å§‹å†™ golang ä¹Ÿå°±æ˜¯åœ¨æœ€è¿‘ã€‚è™½ç„¶å†™çš„ä¸å¤šï¼Œä½†æ˜¯è§è¿‡çš„ golang é¡¹ç›®å¯æ˜¯ä¸è®¡å…¶æ•°ï¼Œä» Kubernetes å’Œ istio åˆ°äº²èº«å‚ä¸çš„ kustomize å†åˆ° Kubernetes ç”Ÿæ€åœˆçš„ä¼—å¤šå°å·¥å…·ï¼Œæ¯”å¦‚ï¼š kubeval ã€ kubedog ç­‰ã€‚ä»é¡¹ç›®ä½¿ç”¨è€…å’Œè´¡çŒ®è€…çš„è§’åº¦æ¥è§¦äº†å„ç§å½¢å½¢è‰²è‰²çš„ golang é¡¹ç›®ã€‚ä½œä¸ºä¸€ä¸ªå¼€å‘äººå‘˜ï¼Œåœ¨äº«å—å„ç§å¼€æºé¡¹ç›®å¸¦æ¥ä¾¿åˆ©çš„åŒæ—¶ï¼Œä¹Ÿå¸Œæœ›è‡ªå·±åŠ¨æ‰‹å¼€å‘ä¸€ä¸ª golang é¡¹ç›®ã€‚ä»¥æˆ‘é˜…é¡¹ç›®æ— æ•°çš„ç»éªŒï¼Œé‚£ä¹ˆè‚¯å®šè¦æ„å»ºä¸€ä¸ªçœ‹ä¸Šå»æ­£è§„çš„ GitHub é¡¹ç›®ã€‚\nGoLand è®¾ç½® Go å¼€å‘ç¯å¢ƒçš„å®‰è£…ç½‘ä¸Šæ•™ç¨‹å¾ˆå¤šï¼Œè¿™é‡Œå°±ä¸åšä»‹ç»äº†ã€‚è¿™é‡Œä¸»è¦ä»‹ç»ä¸€ä¸‹åœ¨ GoLand ä¸Šå¼€å‘ç¯å¢ƒçš„è®¾ç½®ï¼Œè¿™é‡Œçš„è®¾ç½®ä¸»è¦åœ¨ MacOS ä¸Šè¿›è¡Œï¼Œå…¶ä»–ç³»ç»Ÿå¯èƒ½æœ‰æ‰€ä¸åŒã€‚\nä½¿ç”¨Goland IDE vgo vgo æ˜¯åŸºäº Go Module è§„èŒƒçš„åŒ…ç®¡ç†å·¥å…·ï¼ŒåŒå®˜æ–¹çš„ go mod å‘½ä»¤å·¥å…·ç±»ä¼¼ã€‚\n å¼€å¯ vgoï¼ŒGoLand-\u0026gt;Preferences-\u0026gt;GO-\u0026gt;Go Modules(vgo)  æ‰‹åŠ¨ä¿®æ”¹ go.mod\nå…¶ä¸­ latest ä¸ºæœ€æ–°ç‰ˆæœ¬ï¼ŒGoLand ä¼šå»ä¸‹è½½æœ€æ–°ä¾èµ–ä»£ç ï¼Œä¸‹è½½æˆåŠŸåä¼šä¿®æ”¹ go.mod å¹¶ä¸”ç”Ÿæˆ go.sum ä¾èµ–åˆ†ææ–‡ä»¶ã€‚\nmodule github.com/sunny0826/hamal go 1.12 require ( github.com/mitchellh/go-homedir latest github.com/spf13/cobra latest github.com/spf13/viper latest )  æ›´æ–°æˆåŠŸ\nåœ¨æ›´æ–°æˆåŠŸåï¼Œä¼šç”Ÿæˆ go.sum æ–‡ä»¶å¹¶ä¿®æ”¹ go.mod æ–‡ä»¶ã€‚\nmodule github.com/sunny0826/hamal go 1.12 require ( github.com/mitchellh/go-homedir v1.1.0 github.com/spf13/cobra v0.0.5 github.com/spf13/viper v1.4.0 )  ä½¿ç”¨å¿«æ·é”® âŒ¥(option)+â†©(return) æˆ–è€…ç‚¹å‡»é¼ æ ‡å³é”®, é€‰æ‹© Sync packages of github.com/sunny0826/hamal åœ¨ import å¤„å¯¼å…¥ä¾èµ–ã€‚\n  é…ç½®ä»£ç† å¦‚æœè¦é€‰å‡º golang æœ€åŠé€€ä¸€ä¸ªåŸå› ï¼Œé‚£ä¹ˆä¾èµ–ä¸‹è½½éš¾è‚¯å®šå¾—ç¥¨æœ€é«˜ï¼è¿™ä¸ªæ—¶å€™ä¸€ä¸ªåˆé€‚çš„æ¢¯å­å°±å¾ˆé‡è¦äº†ï¼Œå¦‚æœæ²¡æœ‰è¿™ä¸ªæ¢¯å­ï¼Œä¸Šé¢çš„è¿™æ­¥å°±å®Œå…¨æ— æ³•å®Œæˆã€‚è¿™é‡Œä¸»è¦ä»‹ç» GoLand ä¸Šçš„é…ç½®ï¼ŒShadowsocks çš„å®‰è£…å’Œé…ç½®å°±ä¸åšä»‹ç»äº†ã€‚\nGoLand-\u0026gt;Preferences-\u0026gt;Appearance \u0026amp; Behavior-\u0026gt;System Settings-\u0026gt;HTTP Proxy è¿™é‡Œè®¾ç½®å¥½ä¹‹åï¼Œåˆ«å¿˜äº†ç‚¹å‡» Check connection æµ‹è¯•ä¸€ä¸‹æ¢¯å­æ­æˆæ²¡æœ‰ã€‚ é…ç½® go fmtã€ goimports å’Œ golangci-lint è¿™ä¸‰ä¸ªå·¥å…·éƒ½æ˜¯ GoLand è‡ªå¸¦çš„ï¼Œè®¾ç½®èµ·æ¥ååˆ†ç®€å•:GoLand-\u0026gt;Preferences-\u0026gt;Tools-\u0026gt;File Watchersï¼Œç‚¹å‡»æ·»åŠ å³å¯ã€‚ä¹‹ååœ¨å†™å®Œä»£ç ä¹‹åå°±ä¼šè‡ªåŠ¨è§¦å‘è¿™3ä¸ªå·¥å…·çš„è‡ªåŠ¨æ£€æµ‹ï¼Œå·¥å…·ä½œç”¨ï¼š\n go fmt : ç»Ÿä¸€çš„ä»£ç æ ¼å¼åŒ–å·¥å…·ã€‚ golangci-lint : é™æ€ä»£ç è´¨é‡æ£€æµ‹å·¥å…·ï¼Œç”¨äºåŒ…çš„è´¨é‡åˆ†æã€‚ goimports : è‡ªåŠ¨ import ä¾èµ–åŒ…å·¥å…·ã€‚  å®‰è£…é…ç½® golint GoLand æ²¡æœ‰è‡ªå¸¦ golint å·¥å…·ï¼Œéœ€è¦æ‰‹åŠ¨å®‰è£…ï¼š\nmkdir -p $GOPATH/src/golang.org/x/ cd $GOPATH/src/golang.org/x/ git clone https://github.com/golang/lint.git git clone https://github.com/golang/tools.git cd $GOPATH/src/golang.org/x/lint/golint go install  å®‰è£…æˆåŠŸä¹‹åå°†ä¼šåœ¨ $GOPATH/bin ç›®å½•ä¸‹çœ‹åˆ°è‡ªåŠ¨ç”Ÿæˆäº† golint äºŒè¿›åˆ¶å·¥å…·æ–‡ä»¶ã€‚\nGoLand é…ç½® golintï¼Œä¿®æ”¹ Name, Program, Arguments ä¸‰é¡¹é…ç½®ï¼Œå…¶ä¸­ Arguments éœ€è¦åŠ ä¸Š -set_exit_status å‚æ•°ï¼Œå¦‚å›¾æ‰€ç¤ºï¼š\nTravis CI æŒç»­é›†æˆ åœ¨ Github ä¸Šè£…é€¼æ€ä¹ˆèƒ½å°‘çš„äº† Travis CI ï¼Œç›´æ¥ç™»å½• Travis CIï¼Œä½¿ç”¨ GitHub ç™»å½•ï¼Œç„¶åé€‰æ‹©éœ€è¦ä½¿ç”¨ Travis CI çš„é¡¹ç›®ï¼Œåœ¨é¡¹ç›®æ ¹ç›®å½•æ·»åŠ  .travis.yml ï¼Œå†…å®¹å¦‚ä¸‹ï¼š\nlanguage: go go: - 1.12.5 sudo: required install: - echo \u0026quot;install\u0026quot; script: - echo \u0026quot;script\u0026quot;  è¿™é‡Œåªæ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼Œåœ¨æ¯æ¬¡ push ä»£ç ä¹‹åï¼Œéƒ½ä¼šè§¦å‘ CIï¼Œå…·ä½“è¯­æ³•å¯ä»¥å‚çœ‹å®˜æ–¹æ–‡æ¡£ã€‚\nè£…é€¼é‡ç‚¹ï¼š ä½ ä»¥ä¸ºä½¿ç”¨ Travis CI å°±æ˜¯ä¸ºäº†æŒç»­é›†æˆå—ï¼Ÿé‚£å°±å¤ªå¤©çœŸäº†ï¼ä½¿ç”¨ Travis CI å½“ç„¶ä¸ºäº†ä»–çš„ Badges ï¼Œå°† RESULT æ‹·è´åˆ°ä½ çš„ README.md é‡Œé¢å°±å¥½äº†ã€‚\nGO Report Card åˆä¸€è£…é€¼é‡ç‚¹ï¼šæˆ‘ä»¬åœ¨ GoLand ä¸Šå®‰è£…äº† golint ç­‰å·¥å…·è¿›è¡Œä»£ç è´¨é‡æ£€æµ‹ï¼Œåœ¨æ’¸ç çš„æ—¶å€™å°±èƒ½è¿›è¡Œä»£ç æ£€æŸ¥ï¼Œé‚£ä¹ˆè¿™ä¸ªå°±æ˜¯ä¸ºäº†çº¯è£…é€¼äº†ã€‚GO Report Card æ˜¯ä¸€ä¸ª golang ä»£ç æ£€æµ‹ç½‘ç«™ï¼Œä½ åªéœ€æŠŠ Github åœ°å€å¡«ä¸Šå»å³å¯ã€‚è·å– Badges çš„æ–¹æ³•å’Œ Travis CI ç±»ä¼¼ï¼Œå°† MarkDown ä¸­çš„å†…å®¹æ‹·è´åˆ° RERADME.md ä¸­å°±å¥½ã€‚\nGoReleaser æŒç»­é›†æˆæœ‰äº†ï¼Œä»£ç æ£€æŸ¥ä¹Ÿæœ‰äº†ï¼Œå†ä¸‹é¢å°±æ˜¯æ€ä¹ˆå‘å¸ƒä¸€ä¸ªæ¼‚äº®çš„ release äº†ã€‚å¦‚æœè¿˜åœ¨æ‰‹åŠ¨å‘å¸ƒ release ï¼Œé‚£ä¹ˆå°±åˆæ‰ low äº†ã€‚ä½¿ç”¨ GoReleaser ä¸€è¡Œå‘½ä»¤æ¥å‘å¸ƒä¸€ä¸ªæ¼‚äº®çš„ release å§ã€‚\nç”±äºä½¿ç”¨çš„çš„ MacOS ï¼Œè¿™é‡Œä½¿ç”¨ brew æ¥å®‰è£…ï¼š\nbrew install goreleaser  åœ¨é¡¹ç›®æ ¹ç›®å½•ç”Ÿæˆ .goreleaser.yml é…ç½®ï¼š\ngoreleaser init  é…ç½®å¥½äº†ä»¥åè¦è®°å¾—å¾€ .gitignore åŠ ä¸Š distï¼Œå› ä¸º goreleaser ä¼šé»˜è®¤æŠŠç¼–è¯‘ç¼–è¯‘å¥½çš„æ–‡ä»¶è¾“å‡ºåˆ° dist ç›®å½•ä¸­ã€‚\ngoreleaser é…ç½®å¥½åï¼Œå¯ä»¥å…ˆç¼–è¯‘æµ‹è¯•ä¸€ä¸‹ï¼š\ngoreleaser --skip-validate --skip-publish --snapshot  æ³¨æ„ï¼š é¦–æ¬¡ä½¿ç”¨ goreleaser è¦é…ç½® GITHUB_TOKEN ï¼Œå¯ä»¥åœ¨è¿™é‡Œç”³è¯·ï¼Œç”³è¯·å¥½ä¹‹åè¿è¡Œä¸‹é¢çš„å‘½ä»¤é…ç½®GITHUB_TOKEN\nexport GITHUB_TOKEN=\u0026lt;YOUR_TOKEN\u0026gt;  ç¡®ä¿æ²¡æœ‰é—®é¢˜ï¼Œé‚£ä¹ˆå°±å¯ä»¥æ“ä½œ git å’Œ goreleaser æ¥å‘å¸ƒ release äº†ã€‚\ngit add . git commit -m \u0026quot;add goreleaser\u0026quot; git tag -a v0.0.3 -m \u0026quot;First release\u0026quot; git push origin master git push origin v0.0.3  å…¨éƒ¨æå®šåï¼Œä¸€è¡Œå‘½ä»¤èµ·é£ï¼š\ngoreleaser  goreleaser é…åˆ CI é£Ÿç”¨ï¼Œæ•ˆæœæ›´ä½³ï¼Œè¿™é‡Œå°±ä¸åšä»‹ç»äº†ã€‚ Badges å±•ç¤ºç¥å™¨ è¿™é‡Œä»‹ç»ä¸€ä¸ªå±•ç¤º Badges çš„ç¥å™¨ï¼šhttps://shields.io/ ã€‚è¿™ä¸ªç½‘ç«™æä¾›å„ç§å„æ ·çš„ Badges ï¼Œå¦‚æœä½ æ„¿æ„ï¼Œå®Œå…¨å¯ä»¥æŠŠä½ çš„ GitHub README.md å¡«æ»¡ï¼Œæœ‰å…´è¶£çš„åŒå­¦å¯ä»¥è‡ªå–ã€‚ åè®° åˆ°è¿™é‡Œå¯ä»¥åœ¨ GitHub ä¸Šè£…é€¼çš„ golang é…ç½®å·²ç»ä»‹ç»çš„å·®ä¸å¤šäº†ï¼Œå…¶å®è¿˜æœ‰ Codecovã€CircleCI ç­‰å·¥å…·ï¼Œè¿™é‡Œå°±ä¸åšä»‹ç»äº†ã€‚è¿™é‡Œè¦ä»‹ç»çš„æ˜¯æˆ‘ä»¬çš„ç¬¬ä¸€ä¸ª golang é¡¹ç›® Hamalï¼Œè¯¥é¡¹ç›®æ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·ï¼Œç”¨æ¥åœ¨ä¸åŒçš„é•œåƒä»“åº“ä¹‹é—´åŒæ­¥é•œåƒã€‚ç”±äºæˆ‘å¸æ¨è¡Œæ··åˆäº‘ï¼Œä½¿ç”¨äº†é˜¿é‡Œäº‘ä¸åä¸ºäº‘ï¼Œè€Œåœ¨é˜¿é‡Œäº‘æˆ–åä¸ºäº‘ç¯å¢ƒäº’ç›¸æ¨é•œåƒçš„æ—¶å€™æ—¶é—´éƒ½æ¯”è¾ƒé•¿ï¼Œæ‰€ä»¥å¼€å‘è¿™ä¸ªå°å·¥å…·ç”¨äºåœ¨åŠå…¬ç½‘ç»œé•œåƒåŒæ­¥ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥ç”¨æ¥å°†æˆ‘åœ¨ dockerhub ä¸Šæ‰˜ç®¡çš„é•œåƒåŒæ­¥åˆ°æˆ‘ä»¬çš„ç§æœ‰ä»“åº“ï¼Œæ¬¢è¿æ‹ç –ã€‚\n","date":1563503906,"expirydate":-62135596800,"kind":"page","lang":"zh","lastmod":1563503906,"objectID":"6836e615be8429ee2092d1749a00a74b","permalink":"https://guoxudong.io/post/golang-project/","publishdate":"2019-07-19T10:38:26+08:00","relpermalink":"/post/golang-project/","section":"post","summary":"æ¥è§¦ golang æ—¶é—´å¾ˆé•¿ï¼Œä½†æ˜¯çœŸæ­£åŠ¨æ‰‹å¼€å§‹å†™ golang ä¹Ÿå°±æ˜¯åœ¨æœ€è¿‘ã€‚è·Ÿç€æˆ‘åœ¨ GitHub ä¸Šæ„å»ºä¸€ä¸ªçœ‹ä¸Šå»æ­£è§„çš„ Golang é¡¹ç›®ã€‚","tags":["go"],"title":"Golang è£…é€¼æŒ‡å—ï¼šåœ¨ GitHub ä¸Šæ„å»ºä¸€ä¸ªçœ‹ä¸Šå»æ­£è§„çš„ Golang é¡¹ç›®","type":"post"},{"authors":null,"categories":["ç¿»è¯‘"],"content":"  Dailymotion åœ¨ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ Kubernetes å·²ç»3å¹´äº†ï¼Œä½†æ˜¯ä¹Ÿé¢ä¸´ç€å¤šé›†ç¾¤éƒ¨ç½²åº”ç”¨çš„æŒ‘æˆ˜ï¼Œè¿™ä¹Ÿæ˜¯åœ¨è¿‡å»çš„å‡ å¹´ä¸­æˆ‘ä¸€ç›´åŠªåŠ›ä¼˜åŒ–å·¥å…·å’Œæ”¹è¿›å·¥ä½œæµçš„åŸå› ã€‚\n å‰è¨€ æœ¬æ–‡å°†é‡ç‚¹ä»‹ç»æˆ‘ä»¬å¦‚ä½•åœ¨å…¨çƒå¤šä¸ª Kubernetes é›†ç¾¤ä¸Šéƒ¨ç½²æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºã€‚\nä¸ºäº†å°†åº”ç”¨ä¸€æ¬¡éƒ¨ç½²åˆ°å¤šä¸ª Kubernetes é›†ç¾¤ï¼Œæˆ‘ä»¬ä½¿ç”¨äº† Helmï¼Œå¹¶å°†æ‰€æœ‰ chart å­˜å‚¨åœ¨ä¸€ä¸ª git ä»“åº“ä¸­ã€‚æˆ‘ä»¬ä½¿ç”¨ umbrella æ¥éƒ¨ç½²ç”±å¤šä¸ªæœåŠ¡ç»„æˆçš„å®Œæ•´åº”ç”¨ç¨‹åºï¼Œè¿™åŸºæœ¬ä¸Šæ˜¯ä¸€ä¸ªå£°æ˜ä¾èµ–å…³ç³»çš„ chart ï¼Œå…¶å…è®¸æˆ‘ä»¬åœ¨å•ä¸ªå‘½ä»¤è¡Œä¸­å¼•å¯¼æˆ‘ä»¬çš„ API åŠå…¶æœåŠ¡ã€‚\næ­¤å¤–ï¼Œæˆ‘ä»¬åœ¨ä½¿ç”¨ Helm ä¹‹å‰ä¼šè¿è¡Œä¸€ä¸ª python è„šæœ¬ï¼Œç”¨æ¥è¿›è¡Œæ£€æŸ¥ï¼Œæ„å»º chart ï¼Œæ·»åŠ  secrets å¹¶éƒ¨ç½²æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºã€‚æ‰€æœ‰è¿™äº›ä»»åŠ¡éƒ½æ˜¯ä½¿ç”¨ docker é•œåƒåœ¨ CI å¹³å°ä¸Šå®Œæˆçš„ã€‚\nä¸‹é¢å°±è¿›è¡Œè¯¦ç»†ä»‹ç»\næ³¨æ„ï¼ï¼š å½“ä½ é˜…è¯»è¿™ç¯‡åšæ–‡çš„æ—¶å€™ï¼ŒHelm 3 çš„ç¬¬ä¸€ä¸ª release å·²ç»å‘å¸ƒã€‚è¿™ä¸ªç‰ˆæœ¬å¸¦æ¥äº†ä¸€ç³»åˆ—å¢å¼ºåŠŸèƒ½ï¼Œè‚¯å®šä¼šè§£å†³æˆ‘ä»¬è¿‡å»é‡åˆ°çš„ä¸€äº›é—®é¢˜ã€‚\nimage: caption: \u0026ldquo;Image from: Pexels\u0026ldquo; focal_point: \u0026ldquo;\u0026rdquo;\npreview_only: false Charts å¼€å‘æµç¨‹ åœ¨å¼€å‘åº”ç”¨ç¨‹åºæ—¶ï¼Œæˆ‘ä»¬ä½¿ç”¨åˆ†æ”¯å·¥ä½œæµï¼Œå¼€å‘ chart æ—¶ä¹Ÿä½¿ç”¨ç›¸åŒæµç¨‹ã€‚\n é¦–å…ˆï¼Œdev åˆ†æ”¯ç”¨äºæ„å»ºè¦åœ¨å¼€å‘é›†ç¾¤ä¸Šè¿›è¡Œæµ‹è¯•çš„ chart ã€‚ ç„¶åï¼Œå½“å‘èµ· PR è¯·æ±‚åˆ° master åˆ†æ”¯æ—¶ï¼Œå°†å‘å¸ƒåˆ°æ¼”ç¤ºç¯å¢ƒä¸­è¿›è¡ŒéªŒè¯ã€‚ æœ€ç»ˆï¼Œæˆ‘ä»¬å°† PR è¯·æ±‚æäº¤çš„ä¿®æ”¹åˆå¹¶åˆ° prod åˆ†æ”¯ï¼Œå°†è¿™ä¸ªä¿®æ”¹åº”ç”¨äºç”Ÿäº§ç¯å¢ƒã€‚  æˆ‘ä»¬ä½¿ç”¨ Chartmuseum ä½œä¸ºç§æœ‰ä»“åº“æ¥å­˜å‚¨ chart ï¼Œæ¯ä¸ªç¯å¢ƒéƒ½æœ‰ä¸€ä¸ª ã€‚è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥åœ¨ç¯å¢ƒä¹‹é—´å®ç°æ˜ç¡®çš„éš”ç¦»ï¼Œå¹¶ä¸”ç¡®ä¿è¯¥ chart åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨ä¹‹å‰å·²ç»è¿‡æµ‹è¯•ã€‚\næ¯ä¸ªç¯å¢ƒçš„ Chart ä»“åº“\nå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå½“å¼€å‘äººå‘˜ push ä»£ç åˆ°ä»–ä»¬çš„ dev åˆ†æ”¯æ—¶ï¼Œä»–ä»¬çš„ chart ç‰ˆæœ¬ä¹Ÿä¼šè‡ªåŠ¨ push åˆ° dev ç¯å¢ƒçš„ Chartmuseum ã€‚å› æ­¤ï¼Œæ‰€æœ‰å¼€å‘äººå‘˜éƒ½ä½¿ç”¨ç›¸åŒçš„ dev å­˜å‚¨åº“ï¼Œä»–ä»¬å¿…é¡»å°å¿ƒçš„æŒ‡å®šè‡ªå·±çš„ chart ç‰ˆæœ¬ï¼Œä»¥é¿å…ä½¿ç”¨å…¶ä»–äººçš„å¯¹ chart çš„æ›´æ”¹ã€‚\næ­¤å¤–ï¼Œæˆ‘ä»¬çš„ python è„šæœ¬é€šè¿‡ä½¿ç”¨ Kubeval åœ¨å®ƒä»¬æ¨é€åˆ° Chartmusem ä¹‹å‰éªŒè¯ Kubernetes å¯¹è±¡ä¸ Kubernetes OpenAPI è§„èŒƒã€‚\n chart å¼€å‘å·¥ä½œæµ\n  æ ¹æ® gazr.io è§„èŒƒè®¾ç½®æˆ‘ä»¬çš„ pipeline ä»»åŠ¡ï¼ˆlintï¼Œunit-testï¼‰ã€‚ push docker é•œåƒï¼Œè¯¥é•œåƒåŒ…å«éƒ¨ç½²åº”ç”¨ç¨‹åºçš„ Python å·¥å…·ã€‚ æ ¹æ®åˆ†æ”¯åç§°è®¾ç½®ç›¸åº”ç¯å¢ƒã€‚ ä½¿ç”¨ Kubeval æ£€æŸ¥ Kubernetes yamls ã€‚ è‡ªåŠ¨å¢åŠ  chart ç‰ˆæœ¬åŠå…¶çˆ¶é¡¹ï¼ˆå–å†³äºæ›´æ”¹çš„ chart ï¼‰ã€‚ å°† chart push åˆ°ä¸å…¶ç¯å¢ƒå¯¹åº”çš„ Chartmuseum ã€‚  ç®¡ç†é›†ç¾¤å·®å¼‚  Cluster federation\n æˆ‘ä»¬ä½¿ç”¨ Kubernetes cluster federationï¼Œå®ƒå…è®¸æˆ‘ä»¬ä»å•ä¸ª API ç«¯å£°æ˜ Kubernetes å¯¹è±¡ã€‚ä½†æ˜¯æˆ‘ä»¬é‡åˆ°çš„é—®é¢˜æ˜¯ï¼Œæ— æ³•åœ¨ federation ç«¯ä¸­åˆ›å»ºæŸäº› Kubernetes å¯¹è±¡ï¼Œå› æ­¤å¾ˆéš¾ç»´æŠ¤ federation å¯¹è±¡å’Œå…¶ä»–çš„ç¾¤é›†å¯¹è±¡ã€‚\nä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å†³å®šç‹¬ç«‹ç®¡ç†æˆ‘ä»¬çš„é›†ç¾¤ï¼Œåè€Œä½¿è¿™ä¸ªè¿‡ç¨‹å˜å¾—æ›´åŠ å®¹æ˜“ï¼ˆæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ federation v1ï¼Œv2 å¯èƒ½æœ‰æ‰€æ”¹å–„ï¼‰ã€‚\n å¹³å°åœ°ç†åˆ†å¸ƒ\n ç›®å‰ï¼Œæˆ‘ä»¬çš„å¹³å°åˆ†å¸ƒåœ¨6ä¸ªåœ°åŒºï¼Œ3ä¸ªåœ¨è‡ªå·±çš„æ•°æ®ä¸­å¿ƒï¼Œ3ä¸ªåœ¨å…¬æœ‰äº‘ã€‚\nåˆ†å¸ƒå¼éƒ¨ç½²\n Helm global values\n 4ä¸ªå…¨å±€çš„ Helm value å®šä¹‰é›†ç¾¤é—´çš„å·®å¼‚ã€‚è¿™äº›æ˜¯æˆ‘ä»¬æ‰€æœ‰ chart çš„æœ€å°é»˜è®¤å€¼ã€‚\nglobal: cloud: True env: staging region: us-central1 clusterName: staging-us-central1  global values\nè¿™äº›ä¿¡æ¯æœ‰åŠ©äºæˆ‘ä»¬ä¸ºåº”ç”¨ç¨‹åºå®šä¹‰ä¸Šä¸‹æ–‡ï¼Œå®ƒä»¬å¯ç”¨äºç›‘æ§ï¼Œè·Ÿè¸ªï¼Œè®°å½•ï¼Œè¿›è¡Œå¤–éƒ¨è°ƒç”¨ï¼Œæ‰©å±•ç­‰è®¸å¤šå†…å®¹\u0026hellip;\u0026hellip;\n cloudï¼šæˆ‘ä»¬æœ‰ä¸€ä¸ªæ··åˆ Kubernetes é›†ç¾¤ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬çš„ API éƒ¨ç½²åœ¨ GCP å’Œæˆ‘ä»¬è‡ªå·±çš„æ•°æ®ä¸­å¿ƒã€‚ envï¼šå¯¹äºéç”Ÿäº§ç¯å¢ƒï¼ŒæŸäº›å€¼å¯èƒ½ä¼šå‘ç”Ÿå˜åŒ–ã€‚æœ¬è´¨ä¸Šæ˜¯èµ„æºå®šä¹‰å’Œè‡ªåŠ¨æ‰©å±•é…ç½®ã€‚ regionï¼šæ­¤ä¿¡æ¯ç”¨äºæ ‡è¯†ç¾¤é›†çš„ä½ç½®ï¼Œå¹¶å¯ç”¨äºå®šä¹‰å¤–éƒ¨æœåŠ¡çš„æœ€è¿‘ç«¯ç‚¹ã€‚ clusterNameï¼šå¦‚æœæˆ‘ä»¬æƒ³è¦ä¸ºæ¯ä¸ªç¾¤é›†å®šä¹‰ä¸€ä¸ªå€¼ã€‚  ä¸‹é¢æ˜¯ä¸€ä¸ªå…·ä½“çš„ç¤ºä¾‹ï¼š\n{{/* Returns Horizontal Pod Autoscaler replicas for GraphQL*/}} {{- define \u0026quot;graphql.hpaReplicas\u0026quot; -}} {{- if eq .Values.global.env \u0026quot;prod\u0026quot; }} {{- if eq .Values.global.region \u0026quot;europe-west1\u0026quot; }} minReplicas: 40 {{- else }} minReplicas: 150 {{- end }} maxReplicas: 1400 {{- else }} minReplicas: 4 maxReplicas: 20 {{- end }} {{- end -}}  helm template example\nè¯·æ³¨æ„ï¼Œæ­¤é€»è¾‘åœ¨å¸®åŠ©æ¨¡æ¿ä¸­å®šä¹‰ï¼Œä»¥ä¿æŒ Kubernetes YAML çš„å¯è¯»æ€§ã€‚\n å£°æ˜åº”ç”¨\n æˆ‘ä»¬çš„éƒ¨ç½²å·¥å…·åŸºäºå‡ ä¸ª YAML æ–‡ä»¶ï¼Œä¸‹é¢æ˜¯æˆ‘ä»¬å£°æ˜æœåŠ¡åŠå…¶æ¯ä¸ªé›†ç¾¤çš„æ‰©å±•æ‹“æ‰‘ï¼ˆå‰¯æœ¬æ•°é‡ï¼‰çš„ç¤ºä¾‹ã€‚\nreleases: - foo.world foo.world: # Release name services: # List of dailymotion's apps/projects foobar: chart_name: foo-foobar repo: git@github.com:dailymotion/foobar contexts: prod-europe-west1: deployments: - name: foo-bar-baz replicas: 18 - name: another-deployment replicas: 3  service definition\nè¿™æ˜¯éƒ¨ç½²å·¥ä½œæµçš„æ‰€æœ‰æ­¥éª¤ï¼Œæœ€åä¸€æ­¥å°†åœ¨å¤šä¸ªç”Ÿäº§é›†ç¾¤ä¸ŠåŒæ—¶éƒ¨ç½²åº”ç”¨ç¨‹åºã€‚\nJenkins deployment steps\nSecrets æ€ä¹ˆåŠ åœ¨å®‰å…¨é¢†åŸŸï¼Œæˆ‘ä»¬ä¸“æ³¨äºè·Ÿè¸ªå¯èƒ½åœ¨ä¸åŒä½ç½®ä¼ æ’­çš„æ‰€æœ‰çš„ Secrets ï¼Œå¹¶å°†å…¶å­˜å‚¨åœ¨å·´é»çš„ Vault ã€‚\næˆ‘ä»¬çš„éƒ¨ç½²å·¥å…·è´Ÿè´£ä» Vault æ£€ç´¢åŠ å¯†çš„å€¼ï¼Œå¹¶åœ¨éƒ¨ç½²æ—¶å°†å…¶æ³¨å…¥ Helm ã€‚\nä¸ºæ­¤ï¼Œæˆ‘ä»¬å®šä¹‰äº†å­˜å‚¨åœ¨ Vault ä¸­çš„ Secrets ä¸æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºæ‰€éœ€çš„ Secrets ä¹‹é—´çš„æ˜ å°„ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\nsecrets: - secret_id: \u0026quot;stack1-app1-password\u0026quot; contexts: - name: \u0026quot;default\u0026quot; vaultPath: \u0026quot;/kv/dev/stack1/app1/test\u0026quot; vaultKey: \u0026quot;password\u0026quot; - name: \u0026quot;cluster1\u0026quot; vaultPath: \u0026quot;/kv/dev/stack1/app1/test\u0026quot; vaultKey: \u0026quot;password\u0026quot;   å®šä¹‰å°† Secrets å†™å…¥ Vault æ—¶è¦éµå¾ªçš„é€šç”¨è§„åˆ™ã€‚ å¦‚æœ Secrets æœ‰ç‰¹å®šçš„ä¸Šä¸‹æ–‡/é›†ç¾¤ï¼Œåˆ™å¿…é¡»æ·»åŠ ç‰¹å®šæ¡ç›®ã€‚ å¦åˆ™ï¼Œå°†ä½¿ç”¨é»˜è®¤å€¼ã€‚ å¯¹äºæ­¤åˆ—è¡¨ä¸­çš„æ¯ä¸ªé¡¹ç›®ï¼Œå°†åœ¨ Kubernetes Secrets ä¸­æ’å…¥ä¸€ä¸ª key/value ã€‚è¿™æ ·æˆ‘ä»¬ chart ä¸­çš„ Secrets æ¨¡æ¿éå¸¸ç®€å•ã€‚\napiVersion: v1 data: {{- range $key,$value := .Values.secrets }} {{ $key }}: {{ $value | b64enc | quote }} {{ end }} kind: Secret metadata: name: \u0026quot;{{ .Chart.Name }}\u0026quot; labels: chartVersion: \u0026quot;{{ .Chart.Version }}\u0026quot; tillerVersion: \u0026quot;{{ .Capabilities.TillerVersion.SemVer }}\u0026quot; type: Opaque   è­¦å‘Šä¸é™åˆ¶ image: caption: \u0026ldquo;Image from: Pexels\u0026ldquo; focal_point: \u0026ldquo;\u0026rdquo;\npreview_only: false æ“ä½œå¤šä¸ªå­˜å‚¨åº“ ç›®å‰ï¼Œchart å’Œåº”ç”¨ç¨‹åºå¼€å‘æ˜¯åˆ†ç¦»çš„ã€‚è¿™æ„å‘³ç€å¼€å‘äººå‘˜å¿…é¡»å¤„ç†ä¸¤ä¸ª git å­˜å‚¨åº“ï¼Œä¸€ä¸ªç”¨äºåº”ç”¨ç¨‹åºï¼Œå¦ä¸€ä¸ªç”¨äºå®šä¹‰å¦‚ä½•åœ¨ Kubernetes ä¸Šéƒ¨ç½²ã€‚è€Œ2ä¸ª git å­˜å‚¨åº“æ„å‘³ç€ä¸¤ä¸ªå·¥ä½œæµç¨‹ï¼Œè¿™å¯¹äºæ–°æ‰‹æ¥è¯´å¯èƒ½ç›¸å½“å¤æ‚ã€‚\nç®¡ç† umbrella charts å¯èƒ½å¾ˆæ£˜æ‰‹ å¦‚å‰æ‰€è¿°ï¼Œumbrella charts éå¸¸é€‚åˆå®šä¹‰ä¾èµ–å…³ç³»å¹¶å¿«é€Ÿéƒ¨ç½²å¤šä¸ªåº”ç”¨ç¨‹åºã€‚åŒæ—¶æˆ‘ä»¬ä½¿ç”¨ --reuse-values é€‰é¡¹ï¼Œä»¥é¿å…æ¯æ¬¡éƒ¨ç½²ä½œä¸º umbrella charts ä¸€éƒ¨åˆ†çš„åº”ç”¨ç¨‹åºæ—¶éƒ½è¦ä¼ é€’æ‰€æœ‰å€¼ã€‚\nåœ¨æˆ‘ä»¬çš„ CD å·¥ä½œæµä¸­ï¼Œåªæœ‰2ä¸ªå€¼ä¼šå®šæœŸæ›´æ”¹ï¼šå‰¯æœ¬æ•°é‡å’Œé•œåƒæ ‡ç­¾ï¼ˆç‰ˆæœ¬ï¼‰ã€‚å¯¹äºå…¶ä»–æ›´ç¨³å®šçš„å€¼ï¼Œéœ€è¦æ‰‹åŠ¨æ›´æ–°ï¼Œè€Œä¸”è¿™äº›å€¼å¹¶ä¸æ˜¯å¾ˆå®¹æ˜“å¼„æ¸…æ¥šã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬æ›¾é‡åˆ°è¿‡éƒ¨ç½² umbrella charts çš„ä¸€ä¸ªé”™è¯¯å¯¼è‡´ä¸¥é‡çš„ä¸­æ–­ã€‚\næ›´æ–°å¤šä¸ªé…ç½®æ–‡ä»¶ æ·»åŠ æ–°åº”ç”¨ç¨‹åºæ—¶ï¼Œå¼€å‘äººå‘˜å¿…é¡»æ›´æ”¹å¤šä¸ªæ–‡ä»¶ï¼šåº”ç”¨ç¨‹åºå£°æ˜ï¼Œ Secrets åˆ—è¡¨ï¼Œå¦‚æœåº”ç”¨ç¨‹åºæ˜¯ umbrella charts çš„ä¸€éƒ¨åˆ†ï¼Œåˆ™å°†å…¶æ·»åŠ åˆ°ä¾èµ–ã€‚\nåœ¨ Vault ä¸Šï¼Œ Jenkins æƒé™è¿‡å¤§ ç›®å‰ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ª AppRole å¯ä»¥è¯»å– Vault çš„æ‰€æœ‰ Secrets ã€‚\nå›æ»šè¿‡ç¨‹ä¸æ˜¯è‡ªåŠ¨åŒ–çš„ å›æ»šéœ€è¦åœ¨å¤šä¸ªé›†ç¾¤ä¸Šè¿è¡Œè¯¥å‘½ä»¤ï¼Œè¿™å¯èƒ½å®¹æ˜“å‡ºé”™ã€‚æˆ‘ä»¬åˆ¶ä½œæœ¬æ“ä½œæ‰‹å†Œæ˜¯å› ä¸ºæˆ‘ä»¬è¦ç¡®ä¿åº”ç”¨æ­£ç¡®çš„ç‰ˆæœ¬ ID ã€‚\nGitOps å®è·µ  ç›®æ ‡\n æˆ‘ä»¬çš„æƒ³æ³•æ˜¯å°† chart æ”¾å›åˆ°å®ƒéƒ¨ç½²çš„åº”ç”¨ç¨‹åºçš„å­˜å‚¨åº“ä¸‹ã€‚å·¥ä½œæµç¨‹ä¸åº”ç”¨åŒæ—¶å¼€å‘ï¼Œä¾‹å¦‚ï¼Œæ— è®ºä½•æ—¶åœ¨ä¸»æœåŠ¡å™¨ä¸Šåˆå¹¶åˆ†æ”¯ï¼Œéƒ½ä¼šè‡ªåŠ¨è§¦å‘éƒ¨ç½²ã€‚è¿™ç§æ–¹æ³•ä¸å½“å‰å·¥ä½œæµç¨‹çš„ä¸»è¦åŒºåˆ«åœ¨äºï¼Œæ‰€æœ‰å†…å®¹éƒ½å°†é€šè¿‡ git è¿›è¡Œç®¡ç†ï¼ˆåº”ç”¨ç¨‹åºæœ¬èº«ä»¥åŠæˆ‘ä»¬åœ¨ Kubernetes ä¸­éƒ¨ç½²å®ƒçš„æ–¹å¼ï¼‰ã€‚\nè¿™æ ·åšä¼˜ç‚¹ï¼š\n ä»å¼€å‘äººå‘˜çš„è§’åº¦æ¥çœ‹ï¼Œæ›´å®¹æ˜“ç†è§£ã€‚å­¦ä¹ å¦‚ä½•åœ¨æœ¬åœ° chart ä¸­åº”ç”¨æ›´æ”¹å°†æ›´å®¹æ˜“ã€‚ å°†æœåŠ¡ deployment å®šä¹‰åœ¨ä¸æ­¤æœåŠ¡çš„ä»£ç ç›¸åŒçš„ä½ç½®ã€‚ ç§»é™¤ umbrella charts ç®¡ç†ã€‚æœåŠ¡å°†æ‹¥æœ‰è‡ªå·±çš„ Helm ç‰ˆæœ¬ã€‚è¿™ä½¿å¾—åº”ç”¨ç¨‹åºç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼ˆå›æ»šï¼Œå‡çº§ï¼‰å½¢æˆé—­ç¯ï¼Œä¸ä¼šå½±å“å…¶ä»–æœåŠ¡ã€‚ git åŠŸèƒ½å¯¹ chart ç®¡ç†çš„å¥½å¤„ï¼šå›æ»šï¼Œå®¡è®¡æ—¥å¿—\u0026hellip;\u0026hellip;å¦‚æœè¦è¿˜åŸ chart æ›´æ”¹ï¼Œå¯ä»¥ä½¿ç”¨ git è¿›è¡Œæ›´æ”¹ã€‚åŒæ—¶éƒ¨ç½²å°†è‡ªåŠ¨è§¦å‘ã€‚ æˆ‘ä»¬è€ƒè™‘ä½¿ç”¨ Skaffold ç­‰å·¥å…·æ”¹è¿›å¼€å‘å·¥ä½œæµç¨‹ï¼Œè¿™äº›å·¥å…·å…è®¸å¼€å‘äººå‘˜åœ¨ç±»ä¼¼äºç”Ÿäº§çš„ç¯å¢ƒä¸­æµ‹è¯•ä»–ä»¬çš„æ›´æ”¹ã€‚   2æ­¥è¿ç§»\n æˆ‘ä»¬çš„å¼€å‘äººå‘˜å·²ä½¿ç”¨ä¸Šè¿°å·¥ä½œæµç¨‹2å¹´ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦å°½å¯èƒ½é¡ºåˆ©åœ°è¿›è¡Œè¿ç§»ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬å†³å®šåœ¨è¾¾åˆ°ç›®æ ‡ä¹‹å‰æ·»åŠ ä¸€ä¸ªä¸­é—´æ­¥éª¤ã€‚\nç¬¬ä¸€æ­¥å¾ˆç®€å•ï¼š\n æˆ‘ä»¬å°†ä¿ç•™ä¸€ä¸ªç±»ä¼¼çš„ç»“æ„æ¥é…ç½®æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºéƒ¨ç½²ï¼Œä½†æ˜¯åœ¨åä¸º â€œDailymotionReleaseâ€ çš„å•ä¸ªå¯¹è±¡ä¸­\napiVersion: \u0026quot;v1\u0026quot; kind: \u0026quot;DailymotionRelease\u0026quot; metadata: name: \u0026quot;app1.ns1\u0026quot; environment: \u0026quot;dev\u0026quot; branch: \u0026quot;mybranch\u0026quot; spec: slack_channel: \u0026quot;#admin\u0026quot; chart_name: \u0026quot;app1\u0026quot; scaling: - context: \u0026quot;dev-us-central1-0\u0026quot; replicas: - name: \u0026quot;hermes\u0026quot; count: 2 - context: \u0026quot;dev-europe-west1-0\u0026quot; replicas: - name: \u0026quot;app1-deploy\u0026quot; count: 2 secrets: - secret_id: \u0026quot;app1\u0026quot; contexts: - name: \u0026quot;default\u0026quot; vaultPath: \u0026quot;/kv/dev/ns1/app1/test\u0026quot; vaultKey: \u0026quot;password\u0026quot; - name: \u0026quot;dev-europe-west1-0\u0026quot; vaultPath: \u0026quot;/kv/dev/ns1/app1/test\u0026quot; vaultKey: \u0026quot;password\u0026quot;  æ¯ä¸ªåº”ç”¨ç¨‹åºä¸€ä¸ªç‰ˆæœ¬ï¼ˆä¸å†ä½¿ç”¨ umbrella charts ï¼‰\n å°† chart åŠ å…¥åº”ç”¨ç¨‹åº git å­˜å‚¨åº“ä¸­\n  æˆ‘ä»¬å·²ç»å¼€å§‹å‘æ‰€æœ‰å¼€å‘äººå‘˜ç§‘æ™®è¿™ä¸ªè¯ï¼Œå¹¶ä¸”è¿ç§»è¿‡ç¨‹å·²ç»å¼€å§‹ã€‚ç¬¬ä¸€æ­¥ä»ç„¶ä½¿ç”¨ CI å¹³å°è¿›è¡Œæ§åˆ¶ã€‚æˆ‘å°†åœ¨çŸ­æœŸå†…æ’°å†™å¦ä¸€ç¯‡åšæ–‡ï¼Œä»‹ç»ç¬¬äºŒæ­¥ï¼šæˆ‘ä»¬å¦‚ä½•é€šè¿‡ Flux å®ç°å‘ GitOps å·¥ä½œæµç¨‹çš„è¿ç§»ã€‚å°†æè¿°æˆ‘ä»¬çš„è®¾ç½®å’Œé¢ä¸´çš„æŒ‘æˆ˜ï¼ˆå¤šä¸ªå­˜å‚¨åº“ï¼ŒSecrets ç­‰ï¼‰ã€‚ æ•¬è¯·æœŸå¾…ï¼\n","date":1563085016,"expirydate":-62135596800,"kind":"page","lang":"zh","lastmod":1563085016,"objectID":"e4ed09e6443567e78c433e4a1ef54a44","permalink":"https://guoxudong.io/post/deploying-apps-on-multiple-kubernetes-clusters-with-hel/","publishdate":"2019-07-14T14:16:56+08:00","relpermalink":"/post/deploying-apps-on-multiple-kubernetes-clusters-with-hel/","section":"post","summary":"æœ¬æ–‡å°†é‡ç‚¹ä»‹ç»æˆ‘ä»¬å¦‚ä½•åœ¨å…¨çƒå¤šä¸ª Kubernetes é›†ç¾¤ä¸Šéƒ¨ç½²æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºã€‚ä¸ºäº†å°†åº”ç”¨ä¸€æ¬¡éƒ¨ç½²åˆ°å¤šä¸ª Kubernetes é›†ç¾¤ï¼Œæˆ‘ä»¬ä½¿ç”¨äº† Helm ï¼Œå¹¶å°†æ‰€æœ‰ chart å­˜å‚¨åœ¨ä¸€ä¸ª git ä»“åº“ä¸­ã€‚","tags":["ç¿»è¯‘","kubernetes"],"title":"ä½¿ç”¨ Helm åœ¨å¤šé›†ç¾¤éƒ¨ç½²åº”ç”¨","type":"post"},{"authors":["éƒ­æ—­ä¸œ"],"categories":["devops"],"content":" å‰è¨€ è¯´åˆ° GitOps å’Œ ChatOps ï¼Œé‚£å°±ä¸å¾—ä¸è°ˆåˆ° DevOps ã€‚ DevOps ä½œä¸ºä¸€ç§æ–‡åŒ–ï¼Œæ—¨åœ¨ä¿ƒè¿›å¼€å‘ã€æµ‹è¯•å’Œè¿ç»´äººå‘˜ä¹‹é—´çš„æ²Ÿé€šä¸åä½œã€‚è€Œä¿ƒè¿›åˆä½œçš„æ–¹å¼ï¼Œå¾€å¾€æ˜¯ä½¿ç”¨ä¸€ç³»åˆ—å·¥å…·ï¼Œå®Œæˆè¿™ä¸‰ä¸ªè§’è‰²çš„ç›¸äº’åä½œã€‚è¿™å¸¦æ¥çš„å¥½å¤„ä¹Ÿæ˜¯æ˜¾è€Œæ˜“è§çš„ï¼šæ›´å¿«çš„äº¤ä»˜é€Ÿåº¦å’Œæ›´ä½çš„äººåŠ›æˆæœ¬ã€‚è·ç›Šäº DevOps å’Œå…¬æœ‰äº‘ï¼Œä¸€ä¸ªè¿‘ç™¾äººçš„ç ”å‘å›¢é˜Ÿï¼Œå¯ä»¥åªé…å¤‡ä¸€åˆ°ä¸¤ä¸ªä¸“èŒè¿ç»´äººå‘˜ï¼Œé™ä½çš„æˆæœ¬ä¸è¨€è€Œå–»ã€‚æ—¢ç„¶ DevOps æ˜¯ä¸€ç§æ–‡åŒ–ï¼Œé‚£ä¹ˆåœ¨ä¸åŒçš„å›¢é˜Ÿåˆ™ä¼šæœ‰ä¸åŒçš„å®è·µï¼Œè€Œæ— è®ºå®è·µå¦‚ä½•ï¼Œå…¶æœ€ç»ˆç›®çš„éƒ½æ˜¯ä¸€æ ·çš„ï¼šæœ€å¤§åŒ–çš„å®ç°è‡ªåŠ¨åŒ–ï¼Œé‡Šæ”¾æ›´å¤šçš„äººåŠ›èµ„æºï¼Œåˆ›å»ºæ›´å¤§ä»·å€¼ã€‚\nè€Œ GitOps å’Œ ChatOps ï¼Œåˆ™æ˜¯ DevOps çš„ä¸¤ç§å®è·µã€‚è¿™ä¸¤ç§å®è·µåˆ†åˆ«é€šè¿‡ä½¿ç”¨ ç‰ˆæœ¬æ§åˆ¶è½¯ä»¶ Git å’Œå®æ—¶èŠå¤©è½¯ä»¶æ¥è¾¾åˆ°æå‡äº¤ä»˜é€Ÿåº¦å’Œç ”å‘æ•ˆç‡çš„ç›®çš„ã€‚\nGitOps GitOps æ˜¯ä¸€ç§å®ç°æŒç»­äº¤ä»˜çš„æ¨¡å‹ï¼Œå®ƒçš„æ ¸å¿ƒæ€æƒ³æ˜¯å°†åº”ç”¨ç³»ç»Ÿçš„å£°æ˜æ€§åŸºç¡€æ¶æ„å’Œåº”ç”¨ç¨‹åºå­˜æ”¾åœ¨ Git çš„ç‰ˆæœ¬æ§åˆ¶åº“ä¸­ã€‚\nå°† Git ä½œä¸ºäº¤ä»˜æµæ°´çº¿çš„æ ¸å¿ƒï¼Œæ¯ä¸ªå¼€å‘äººå‘˜éƒ½å¯ä»¥æäº¤æ‹‰å–è¯·æ±‚ï¼ˆPull Requestï¼‰å¹¶ä½¿ç”¨ Giâ€‹â€‹t æ¥åŠ é€Ÿå’Œç®€åŒ– Kubernetes çš„åº”ç”¨ç¨‹åºéƒ¨ç½²å’Œè¿ç»´ä»»åŠ¡ã€‚é€šè¿‡ä½¿ç”¨åƒ Git è¿™æ ·çš„ç®€å•ç†Ÿæ‚‰å·¥å…·ï¼Œå¼€å‘äººå‘˜å¯ä»¥æ›´é«˜æ•ˆåœ°å°†æ³¨æ„åŠ›é›†ä¸­åœ¨åˆ›å»ºæ–°åŠŸèƒ½è€Œä¸æ˜¯è¿ç»´ç›¸å…³ä»»åŠ¡ä¸Šã€‚\né€šè¿‡åº”ç”¨ GitOps ï¼Œåº”ç”¨ç³»ç»Ÿçš„åŸºç¡€æ¶æ„å’Œåº”ç”¨ç¨‹åºä»£ç å¯ä»¥å¿«é€ŸæŸ¥æ‰¾æ¥æºâ€”â€”åŸºç¡€æ¶æ„å’Œåº”ç”¨ç¨‹åºä»£ç éƒ½å­˜æ”¾åœ¨ gitlab ã€æˆ–è€… github ç­‰ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿä¸Šã€‚è¿™ä½¿å¼€å‘å›¢é˜Ÿå¯ä»¥æé«˜å¼€å‘å’Œéƒ¨ç½²é€Ÿåº¦å¹¶æé«˜åº”ç”¨ç³»ç»Ÿå¯é æ€§ã€‚\nå°† GitOps åº”ç”¨åœ¨æŒç»­äº¤ä»˜æµæ°´çº¿ä¸Šï¼Œæœ‰è¯¸å¤šä¼˜åŠ¿å’Œç‰¹ç‚¹ï¼š\n å®‰å…¨çš„äº‘åŸç”Ÿ CI/CD ç®¡é“æ¨¡å‹ æ›´å¿«çš„å¹³å‡éƒ¨ç½²æ—¶é—´å’Œå¹³å‡æ¢å¤æ—¶é—´ ç¨³å®šä¸”å¯é‡ç°çš„å›æ»šï¼ˆä¾‹å¦‚ï¼Œæ ¹æ®Gitæ¢å¤/å›æ»š/ forkï¼‰ ä¸ç›‘æ§å’Œå¯è§†åŒ–å·¥å…·ç›¸ç»“åˆï¼Œå¯¹å·²ç»éƒ¨ç½²çš„åº”ç”¨è¿›è¡Œå…¨æ–¹ä½çš„ç›‘æ§  åœ¨æˆ‘çœ‹æ¥ GitOps çš„æœ€å¤§ä¼˜åŠ¿å°±æ˜¯é€šè¿‡å®Œå–„çš„ git åˆ†æ”¯ç®¡ç†æ¥è¾¾åˆ°ç®¡ç†æ‰€æœ‰ CI/CD ç®¡é“æµæ°´çº¿çš„ç›®çš„ï¼Œä¸åŒçš„ç¯å¢ƒå¯ä»¥å¯¹åº”ä¸åŒåˆ†æ”¯ï¼Œåœ¨è¯¥ç¯å¢ƒå‡ºç°é—®é¢˜æ—¶å€™ï¼Œå¯ä»¥ç›´æ¥æŸ¥æ‰¾å¯¹åº”åˆ†æ”¯ä»£ç ï¼Œè¾¾åˆ°å¿«é€Ÿæ’æŸ¥é—®é¢˜çš„ç›®çš„ã€‚è€Œå¯¹äº Git çš„ç†Ÿæ‚‰ï¼Œæ›´æ˜¯çœå»å­¦ä¹ ä½¿ç”¨ä¸€èˆ¬ DevOps å·¥å…·æ‰€éœ€çš„å­¦ä¹ æˆæœ¬å’Œé…ç½®æ—¶é—´ï¼Œå¼€å‘äººå‘˜å¯ä»¥æ— ä»»ä½•åŸ¹è®­ç›´æ¥ä¸Šæ‰‹ä½¿ç”¨ï¼Œè¿›ä¸€æ­¥é™ä½äº†æ—¶é—´ä¸äººåŠ›æˆæœ¬ã€‚\nChatOps ChatOps ä»¥èŠå¤©å®¤ï¼ˆèŠå¤©ç¾¤ï¼‰ï¼Œå³å®æ—¶èŠå¤©è½¯ä»¶ä¸ºä¸­å¿ƒï¼Œé€šè¿‡ä¸€ç³»åˆ—çš„æœºå™¨äººå»å¯¹æ¥åå°çš„å„ç§æœåŠ¡ï¼Œå¼€å‘\u0026amp;æµ‹è¯•\u0026amp;è¿ç»´äººå‘˜åªéœ€è¦åœ¨èŠå¤©çª—å£ä¸­ä¸æœºå™¨äººå¯¹è¯ï¼Œå³å¯ä¸åå°æœåŠ¡è¿›è¡Œäº¤äº’ï¼Œæ•´ä¸ªå·¥ä½œçš„å±•å¼€å°±åƒæ˜¯ä½¿å”¤ä¸€ä¸ªæ™ºèƒ½åŠ©æ‰‹é‚£æ ·ç®€å•è‡ªç„¶ã€‚\nChatOps å¸¦æ¥äº†å¾ˆå¤šå¥½å¤„ï¼š\n å…¬å¼€é€æ˜ã€‚æ‰€æœ‰çš„å·¥ä½œæ¶ˆæ¯éƒ½åœ¨åŒä¸€ä¸ªèŠå¤©å¹³å°ä¸­æ²‰æ·€å¹¶å…¬å¼€ç»™æ‰€æœ‰ç›¸å…³æˆå‘˜ï¼Œæ¶ˆé™¤æ²Ÿé€šå£å’ï¼Œå·¥ä½œå†å²æœ‰è¿¹å¯å¾ªï¼Œå›¢é˜Ÿåˆä½œæ›´åŠ é¡ºç•…ã€‚ ä¸Šä¸‹æ–‡å…±äº«ã€‚å‡å°‘å› å·¥ä½œå°åˆ‡æ¢ç­‰å¯¹æ¶ˆæ¯çš„æˆªæ–­ï¼Œä¿è¯æ¶ˆæ¯çš„å®Œæ•´æ€§ï¼Œè®©å·¥ä½œæ‰¿æ¥æœ‰åºï¼Œå„è§’è‰²ï¼Œå„å·¥å…·éƒ½æˆä¸ºå®Œæˆå·¥ä½œæµä¸­çš„ä¸€ç¯ï¼Œæ‰“é€ çœŸæ­£æµç•…çš„å·¥ä½œä½“éªŒã€‚ ç§»åŠ¨å‹å¥½ã€‚åªéœ€è¦åœ¨å‰å°ä¸é¢„è®¾å¥½çš„æœºå™¨äººå¯¹è¯å³å¯å®Œæˆä¸åå°å·¥å…·ã€ç³»ç»Ÿçš„äº¤äº’ï¼Œåœ¨ç§»åŠ¨ç¯å¢ƒä¸‹æ— éœ€å†ä¸ä¼—å¤šå¤æ‚çš„å·¥å…·ç›´æ¥å¯¹æ¥ï¼Œå¤§å¤§æå‡ç§»åŠ¨åŠå…¬çš„å¯è¡Œæ€§ã€‚ DevOps æ–‡åŒ–æ‰“é€ ã€‚ç”¨ä¸æœºå™¨äººå¯¹è¯è¿™ç§ç®€å•çš„æ–¹å¼é™ä½ DevOps çš„æ¥å—é—¨æ§›ï¼Œè®©è¿™ç§è‡ªåŠ¨åŒ–åŠå…¬çš„ç†å¿µæ›´å®¹æ˜“çš„æ‰©å±•åˆ°å›¢é˜Ÿçš„æ¯ä¸€ä¸ªè§’è½ã€‚  å¯¹äº ChatOps çš„ç†è§£æœ€æ—©è¦æºäºåœ¨ GitHub ä¸Šå‚ä¸å¼€æºé¡¹ç›®çš„ä¸€äº›ç»å†ï¼Œåœ¨å‘ Kubernetes ç›¸å…³é¡¹ç›®æäº¤ PR æ—¶ï¼Œä¼šæœ‰ä¸€ä¸ªåå« k8s-ci-robot çš„å°æœºå™¨äººæ¥è‡ªåŠ¨ä¸ºè¯¥ RP æ‰“ä¸Šæ ‡ç­¾ï¼Œå¹¶ä¸”æ ¹æ®ä½ æäº¤ PR æ—¶çš„ comment ä¿¡æ¯æ¥ä¸ºä½ åˆ†é… Reviewersï¼Œå¦‚æœæ²¡æœ‰å¡«çš„è¯ï¼Œåˆ™ä¼šè‡ªåŠ¨ä¸ºä½ åˆ†é… Reviewers ç­‰åŠŸèƒ½ã€‚åŒæ—¶å¯ä»¥åœ¨ comment ä¸­è¾“å…¥å‘½ä»¤ï¼Œè¿˜å¯ä»¥è¿›è¡Œå…¶ä»–çš„æ“ä½œï¼Œè¯¦è§ï¼šå‘½ä»¤åˆ—è¡¨ã€‚è€Œå…¶å®è¿™ä¸ªæœºå™¨äººçš„åç«¯å°±æ˜¯åä¸º Prow çš„ç”± Google å‘èµ·çš„é€‚åº”äº‘åŸç”Ÿ CI/CD å¼€æºé¡¹ç›®ï¼Œæœ‰å…´è¶£çš„è¯æ¨èé˜…è¯»ï¼šProw å¿«é€Ÿå…¥é—¨å‘å¯¼ã€‚\nè€Œä¸€ç¯‡åä¸ºï¼šã€Šæ¹¾åŒºæ—¥æŠ¥æ˜¯å¦‚ä½•è¿ä½œçš„ï¼Ÿã€‹ æ–‡ç« æ›´æ˜¯è®©æˆ‘åšå®šä¿¡å¿ƒå¼€å§‹å¼€å‘è‡ªå·± ChatOps ç³»ç»Ÿã€‚è¯¥æ–‡ç« ä»‹ç»ä½œè€…æ˜¯æ€ä¹ˆè¿è¥ä¸€ä¸ªåå«æ¹¾åŒºæ—¥æŠ¥çš„ä¸ªäººåšå®¢ï¼Œè¿™ä¸ªåšå®¢é€šè¿‡11ä¸ªæ¸ é“ï¼ˆç½‘ç«™ï¼ŒiOS appï¼ŒAndroid appã€å¾®åšï¼Œå¾®ä¿¡ï¼ŒTwitterï¼ŒChrome æµè§ˆå™¨æ¨é€ã€Facebookã€é‚®ä»¶è®¢é˜…ã€RSSã€Telegramï¼‰æ¨èç»™è¯»è€…ï¼Œè€Œè¿™ä¸ª11ä¸ªæ¸ é“çš„å‘å¸ƒéƒ½æ˜¯é€šè¿‡ slack å’Œä½œè€…å¼€å‘çš„å°æœºå™¨äººå®Œæˆã€‚åœ¨æˆ‘è¿˜åœ¨ä¸ºä½¿ç”¨è„šæœ¬å¯ä»¥åœ¨å¤šæ¸ é“å‘å¸ƒä¸ªäººæŠ€æœ¯åšå®¢è€Œæ²¾æ²¾è‡ªå–œçš„æ—¶å€™ï¼Œäººå®¶æ—©åœ¨å¤šå¹´å‰å°±å¼€å§‹ä½¿ç”¨ ChatOps æ¨¡å¼å‘å¤šæ¸ é“ä½¿ç”¨å¤šæ ¼å¼è‡ªåŠ¨æ¨é€æ–‡ç« äº†ã€‚è¿™ä¹Ÿåšå®šäº†æˆ‘å¼€å‘æˆ‘ä»¬è‡ªå·±çš„ ChatOps ç³»ç»Ÿçš„å†³å¿ƒã€‚\nGitOps \u0026amp; ChatOps çš„å®è·µ ä½¿ç”¨ Drone å®ç° GitOps DevOps æ–‡åŒ–æ—©å·²åœ¨æˆ‘å¸è½åœ°ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬æœ‰å°†è¿‘ç™¾äººçš„ç ”å‘å›¢é˜Ÿï¼Œå´åªæœ‰ä¸¤ä¸ªä¸“èŒè¿ç»´çš„åŸå› ã€‚CI/CD æ–¹é¢æˆ‘ä»¬ä¹‹å‰ä½¿ç”¨çš„æ˜¯ jenkins ï¼Œ jenkins æ˜¯ä¸€ä¸ªååˆ†å¼ºå¤§çš„å·¥å…·ï¼Œä½†æ˜¯éšç€å…¬å¸çš„å‘å±•ï¼Œé¡¹ç›®ä¹Ÿè¶Šæ¥è¶Šå¤šï¼Œç²—ç•¥ç»Ÿè®¡äº†ä¸€ä¸‹æˆ‘ä»¬åœ¨ jenkins ä¸­æœ‰å‡ ç™¾ä¸ª Job ï¼Œè™½ç„¶æ‰€æœ‰é¡¹ç›®éƒ½ä½¿ç”¨ Jenkinsfile çš„æ–¹å¼å°† pipeline æŒä¹…åŒ–åˆ°äº† gitlab ä¸­ï¼Œä½†æ˜¯æ‰€æœ‰çš„ Job é…ç½®ï¼ŒåŒ…æ‹¬å‚æ•°åŒ–æ„å»ºé…ç½®ï¼ŒSCM é…ç½®ç­‰éƒ½æ˜¯ä¿å­˜åœ¨ jenkins ä¸Šï¼Œä¸€æ—¦æœ‰å¤±ï¼Œå‡ ç™¾ä¸ª Job \u0026hellip;å“­éƒ½æ²¡æœ‰åœ°æ–¹å“­å»ï¼ˆåˆ«é—®æˆ‘æ˜¯æ€ä¹ˆçŸ¥é“çš„ï¼‰ã€‚\nç»è¿‡è°ƒç ”æˆ‘ä»¬é€‰æ‹©äº† drone CI è¿›è¡Œ GitOps ï¼Œé€šè¿‡è‡ªå·±å¼€å‘ä¸åŒåŠŸèƒ½çš„æ’ä»¶ï¼Œå®Œå–„äº†æˆ‘ä»¬çš„æ•´ä¸ª CI/CD æµæ°´çº¿ã€‚è€Œæ’ä»¶çš„å¼€å‘ä¹Ÿå¹¶ä¸æ˜¯ä»å¤´å¼€å§‹ï¼Œè€Œæ˜¯ç›´æ¥ fork ç°æœ‰çš„æ’ä»¶è¿›è¡Œå®šåˆ¶åŒ–çš„äºŒæ¬¡å¼€å‘ï¼Œæœ‰å…´è¶£çš„å¯ä»¥åˆ°æˆ‘çš„ GitHub å’Œ DockerHub ä¸ŠæŸ¥çœ‹ã€‚\nå°†é¡¹ç›®é…ç½®è¿›è¡Œäº†åˆ†ç¦»ï¼Œé…ç½®ä½¿ç”¨å•ç‹¬çš„ git ä»“åº“ç»´æŠ¤ï¼ŒåŒæ—¶æ•´åˆäº†é•œåƒå®‰å…¨æ‰«æï¼Œé’‰é’‰é€šçŸ¥ç­‰åŠŸèƒ½ã€‚ ç”±äº drone CI çš„é…ç½®æ–‡ä»¶ .drone.yml éœ€è¦ç»Ÿä¸€è§„èŒƒï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨è‡ªå·±çš„ DevOps å¹³å°å¼€å‘äº† Drone é…ç½®é¡µé¢ï¼Œå¸®åŠ©å¼€å‘è‡ªä¸»é…ç½®ã€‚æˆ‘ä»¬æä¾›äº† Java ã€ Node ã€ Python ä¸‰ç§é…ç½®æ¨¡æ¿ï¼Œå¹¶ä¸”ç”±äº DevOps å¹³å°å·²ä¸ GitLab é›†æˆï¼Œå¯ä»¥ç›´æ¥å°†ç”Ÿæˆçš„ .drone.yml æ–‡ä»¶æ’å…¥åˆ°ç›¸åº” git é¡¹ç›®ä¸­ã€‚\nåŒæ—¶ä¹Ÿæä¾›äº†é’‰é’‰æ„å»ºé€šçŸ¥ï¼Œåœ¨æ„å»ºæˆåŠŸåä¼šå‘é€åˆ°ç›¸åº”çš„å¼€å‘ç¾¤ç»„ä¸­ï¼Œå¦‚æœéœ€å¸Œæœ›è‡ªåŠ¨å‘å¸ƒçš„è¯ï¼Œä¹Ÿå¯ç‚¹å‡»é€šçŸ¥ä¸­çš„è¿æ¥è‡ªè¡Œå‘å¸ƒã€‚\nè‡ªç ”å¹³å°é…åˆé’‰é’‰ Outgoing åŠŸèƒ½å®ç° ChatOps å‰é¢çš„æ„å»ºé€šçŸ¥æœºå™¨äººä½¿ç”¨çš„æ˜¯é’‰é’‰çš„è‡ªå®šä¹‰æœºå™¨äººï¼Œå°†æ„å»ºä¿¡æ¯æ¨é€åˆ°å„ä¸ªé¡¹ç›®ç¾¤ä¸­ã€‚è€Œé’‰é’‰æœºå™¨äººçš„ Outgoing åŠŸèƒ½ï¼Œåˆ™å¯ç”¨æ¥å®ç° ChatOps çš„åŠŸèƒ½ï¼ˆæ³¨æ„ï¼šé’‰é’‰çš„ Outgoing åŠŸèƒ½ç›®å‰è¿˜å¤„äºç°åº¦æµ‹è¯•é˜¶æ®µï¼Œæƒ³è¦ä½¿ç”¨çš„éœ€è¦è”ç³»å®˜æ–¹ç®¡ç†å‘˜å¼€å¯è¯¥åŠŸèƒ½ï¼‰ã€‚\nç”±äºæˆ‘å¸ä¸“èŒè¿ç»´äººå‘˜åªæœ‰ä¸¤ä½ï¼Œç®¡ç†ç€æ•´ä¸ªå›¢é˜Ÿå…¨éƒ¨çš„åŸºç¡€è®¾æ–½ã€‚ä½†æ˜¯éšç€å¼€å‘å›¢é˜Ÿçš„æ‰©å¼ ï¼Œè¿ç»´äººå‘˜æ¯å¤©è¦å¤„ç†å¤§é‡çš„å’¨è¯¢ç±»å·¥ä½œï¼Œè€Œè¿™ç±»å·¥ä½œæœ‰ç€é‡å¤æ€§å¼ºå’ŒæŠ€æœ¯æ€§å¼±çš„ç‰¹ç‚¹ï¼Œå¯¹äºè¿ç»´äººå‘˜çš„æŠ€æœ¯æ°´å¹³æ¯«æ— æå‡ï¼Œé‚£ä¹ˆè¿™ç±»å·¥ä½œäº¤ç»™æœºå™¨äººå²‚ä¸æ˜¯æ›´å¥½ã€‚å¾—ç›Šäºæˆ‘ä»¬ DevOps å¹³å°å®Œå–„çš„ API ï¼Œå°åŠ©æ‰‹æœºå™¨äººçš„å¼€å‘å¹¶ä¸å›°éš¾ã€‚\nå°åŠ©æ‰‹æœºå™¨äººçš„è¯ç”Ÿï¼Œæå¤§çš„æé«˜äº†å’¨è¯¢ç±»å·¥ä½œçš„æ•ˆç‡ï¼ŒåŒæ—¶ä¹Ÿé‡Šæ”¾äº†è¿ç»´äººå‘˜çš„å·¥ä½œæ—¶é—´ï¼Œè¿ç»´äººå‘˜å¯ä»¥å°†æ›´å¤šç²¾åŠ›æŠ•æ³¨åˆ°æ›´æœ‰æŠ€æœ¯å«é‡çš„äº‹æƒ…ä¸Šã€‚\nå°åŠ©æ‰‹æœºå™¨äººè¿˜æœ‰è¿ç»´ç‰ˆæœ¬ï¼ŒåŠŸèƒ½åŒ…æ‹¬ï¼šæ‰¹é‡æ“ä½œè™šæ‹Ÿæœºã€é‡å¯æœåŠ¡ã€DNS è§£æã€Kubernetes ä¿¡æ¯æ£€æµ‹\u0026amp;æ“ä½œç­‰åŠŸèƒ½ï¼Œç”±äºè¿˜æ˜¯æµ‹è¯•ç‰ˆæœ¬ï¼Œè¿™é‡Œå°±ä¸åšè¯¦ç»†ä»‹ç»äº†ã€‚\nç»“è¯­ ä¸Šæ–‡ä¸­ç®€è¦çš„ä»‹ç»äº† GitOps å’Œ ChatOps åœ¨æˆ‘å¸çš„è½åœ°å®è·µï¼Œä»å†³å®šè½åœ° GitOps å’Œ ChatOps è‡³ä»Šä¸è¿‡çŸ­çŸ­çš„2ä¸ªæœˆã€‚å¾—ç›Šäºæˆ‘å¸æµ“åšçš„ DevOps æ–‡åŒ–æ°›å›´ï¼Œè®©æˆ‘å¯ä»¥åœ¨æçŸ­çš„æ—¶é—´å†…å°† GitOps å’Œ ChatOps è½åœ°å®è·µã€‚ä½†æ¯•ç«Ÿå®è·µçš„æ—¶é—´è¿˜çŸ­ï¼Œå¾ˆå¤šéœ€æ±‚è¿˜åœ¨æ”¶é›†å’Œè°ƒç ”ä¸­ï¼Œåç»­çš„å¼€å‘è¿˜åœ¨æŒç»­è¿›è¡Œã€‚æ¬¢è¿å¯¹ GitOps å’Œ ChatOps æ„Ÿå…´è¶£çš„åŒå­¦ä¸€èµ·äº¤æµï¼Œå…±åŒæå‡ã€‚\nå‚è€ƒèµ„æ–™  GitOps DevOps ç†å¿µå‡çº§ï¼ŒChatOps æ¦‚è¿°åŠå®è·µç»éªŒ  ","date":1562808257,"expirydate":-62135596800,"kind":"page","lang":"zh","lastmod":1562808257,"objectID":"625c5d2f92183aac08c31f2caff1f9a0","permalink":"https://guoxudong.io/post/gitops-and-chatops/","publishdate":"2019-07-11T09:24:17+08:00","relpermalink":"/post/gitops-and-chatops/","section":"post","summary":"æœ¬æ–‡ä»‹ç» GitOps å’Œ ChatOps è¿™ä¸¤ç§ DevOps å®è·µï¼Œé€šè¿‡ç‰ˆæœ¬æ§åˆ¶è½¯ä»¶ Git å’Œå®æ—¶èŠå¤©è½¯ä»¶æ¥è¾¾åˆ°æå‡äº¤ä»˜é€Ÿåº¦å’Œç ”å‘æ•ˆç‡çš„ç›®çš„ã€‚","tags":["devops"],"title":"GitOps ä¸ ChatOps çš„è½åœ°å®è·µ","type":"post"},{"authors":["éƒ­æ—­ä¸œ"],"categories":["kubernetes"],"content":" å‰è¨€ ä»Šå¤©æ¥åˆ°ä¸€ä¸ªå°† NAS æ•°æ®å·æŒ‚è½½åˆ° Kubernetes é›†ç¾¤çš„éœ€æ±‚ï¼Œéœ€è¦å°†ä¸€ä¸ª NAS æ•°æ®å·æŒ‚è½½åˆ°é›†ç¾¤ä¸­ã€‚è¿™ä¸€å¾ˆç®€å•çš„æ“ä½œç”±äºå¥½ä¹…æ²¡æœ‰æ“ä½œäº†ï¼Œå»ç¿»çœ‹äº†ä¸€ä¸‹å®˜æ–¹æ–‡æ¡£ï¼Œå‘ç°å®˜æ–¹æ–‡æ¡£è¿˜åœ¨åœç•™åœ¨å»å¹´7æœˆä»½\u0026hellip;ä¸ºäº†é˜²æ­¢ä¹‹åè¿˜æœ‰ç›¸ä¼¼æƒ…å†µçš„å‘ç”Ÿï¼Œè¿™é‡Œå°†æ‰€æœ‰æ“ä½œåšä¸€ä¸ªç®€å•è®°å½•ã€‚\nè´­ä¹°å­˜å‚¨åŒ…ï¼ˆåˆ›å»ºæ–‡ä»¶ç³»ç»Ÿï¼‰ åœ¨æŒ‚è½½ NAS ä¹‹å‰ï¼Œé¦–å…ˆè¦å…ˆè´­ä¹° NAS æ–‡ä»¶å­˜å‚¨ï¼Œè¿™é‡Œæ¨èè´­ä¹°å­˜å‚¨åŒ…ï¼Œ100G çš„ SSD æ€¥é€Ÿå‹ä¸€å¹´åªéœ€1400å¤šï¼Œè€Œå®¹é‡å‹åªè¦279ï¼Œå¯¹äºæˆ‘è¿™ç§åªæœ‰å°‘é‡ NAS å­˜å‚¨éœ€æ±‚çš„äººæ¥è¯´æ˜¯æ˜¯é è°±çš„ï¼Œå› ä¸ºæˆ‘åªéœ€è¦5Gçš„å·¦å³çš„å­˜å‚¨ç©ºé—´ï¼ŒSSD æ€¥é€Ÿå‹ NAS ä¸€å¹´åªè¦18å—ï¼Œå®Œç¾ã€‚\né€‰æ‹©æƒ³è¦åˆ›å»º NAS æ‰€åœ¨ VPC å’Œ åŒºåŸŸ\næ·»åŠ æŒ‚è½½ç‚¹  ç‚¹å‡»æ·»åŠ æŒ‚è½½ç‚¹  é€‰æ‹© VPC ç½‘ç»œã€äº¤æ¢æœºå’Œæƒé™ç»„   Linux æŒ‚è½½ NAS æ•°æ®å· åœ¨æŒ‚è½½ç‚¹åˆ›å»ºæˆåŠŸåï¼Œå°±å¯ä»¥å°† NAS æ•°æ®å·æŒ‚è½½åˆ° Linux ç³»ç»Ÿï¼Œè¿™é‡Œä»¥ CentOS ä¸ºä¾‹ï¼š\nå®‰è£… NFS å®¢æˆ·ç«¯ å¦‚æœ Linux ç³»ç»Ÿè¦æŒ‚è½½ NAS ï¼Œé¦–å…ˆéœ€è¦å®‰è£… NFS å®¢æˆ·ç«¯\nsudo yum install nfs-utils  æŒ‚è½½ NFS æ–‡ä»¶ç³»ç»Ÿ è¿™é‡Œé˜¿é‡Œäº‘æ—©å°±è¿›è¡Œäº†ä¼˜åŒ–ï¼Œç‚¹å‡»åˆ›å»ºçš„æ–‡ä»¶ç³»ç»Ÿï¼Œé¡µé¢ä¸Šå°±å¯ä»¥ copy æŒ‚è½½å‘½ä»¤ã€‚é¡µé¢æä¾›äº†æŒ‚è½½åœ°å€çš„ copy å’ŒæŒ‚è½½å‘½ä»¤çš„ copy åŠŸèƒ½ã€‚\næŒ‚è½½å‘½ä»¤ï¼š\nsudo mount -t nfs -o vers=4,minorversion=0,noresvport xxxxx.cn-shanghai.nas.aliyuncs.com:/ /mnt  æŸ¥çœ‹æŒ‚è½½ç»“æœ ç›´æ¥åœ¨æŒ‚è½½æ•°æ®å·æ‰€åœ¨æœåŠ¡ä¸Šæ‰§è¡Œå‘½ä»¤ï¼š\ndf -h  å°±å¯ä»¥çœ‹åˆ°ç»“æœï¼š\nKubernetes é›†ç¾¤æŒ‚è½½ NAS æ•°æ®å· K8S çš„æŒä¹…æ•°æ®å·æŒ‚è½½å¤§åŒå°å¼‚ï¼Œæµç¨‹éƒ½æ˜¯ï¼šåˆ›å»ºPV -\u0026gt; åˆ›å»ºPVC -\u0026gt; ä½¿ç”¨PVC\nä¸‹é¢å°±ç®€å•ä»‹ç»åœ¨é˜¿é‡Œäº‘ä¸Šçš„æ“ä½œï¼š\nåˆ›å»ºå­˜å‚¨å·ï¼ˆPVï¼‰ é¦–å…ˆè¦åˆ›å»ºå­˜å‚¨å·ï¼Œé€‰æ‹© å®¹å™¨æœåŠ¡ -\u0026gt; å­˜å‚¨å· -\u0026gt; åˆ›å»º\nè¿™é‡Œè¦æ³¨æ„çš„æ˜¯ï¼šæŒ‚è½½ç‚¹åŸŸåä½¿ç”¨ä¸Šé¢é¢çš„æŒ‚è½½åœ°å€\nåˆ›å»ºå­˜å‚¨å£°æ˜ï¼ˆPVCï¼‰ é€‰æ‹© NAS -\u0026gt; å·²æœ‰å­˜å‚¨å·\né€‰æ‹©åˆšæ‰åˆ›å»ºçš„å­˜å‚¨å·\nä½¿ç”¨PVC ä½¿ç”¨çš„æ–¹æ³•è¿™é‡Œå°±ä¸åšè¯¦ç»†ä»‹ç»äº†ï¼Œç›¸å…³æ–‡ç« ä¹Ÿæ¯”è¾ƒå¤šï¼Œè¿™é‡Œå°±åªè®°å½• Deployment ä¸­ä½¿ç”¨çš„ yaml ç‰‡æ®µï¼š\n... volumeMounts: - mountPath: /data # æŒ‚è½½è·¯å¾„ name: volume-nas-test ... volumes: - name: volume-nas-test persistentVolumeClaim: claimName: nas-test # PVC åç§° ...  ç»“è¯­ è¿™é‡Œåªæ˜¯åšä¸€ä¸ªç®€å•çš„è®°å½•ï¼Œä»…é€‚ç”¨äºé˜¿é‡Œäº‘ ACK å®¹å™¨æœåŠ¡ï¼ŒåŒæ—¶ä¹Ÿæ˜¯ ACK çš„ä¸€ä¸ªç®€å•åº”ç”¨ã€‚ç”±äºä¸ç»å¸¸å¯¹æ•°æ®å·è¿›è¡Œæ“ä½œï¼Œè¿™é‡Œåšç®€å•çš„è®°å½•ï¼Œé˜²æ­¢ä»¥åä½¿ç”¨è¿˜è¦å†çœ‹ä¸€éæ–‡æ¡£ã€‚\n","date":1562569796,"expirydate":-62135596800,"kind":"page","lang":"zh","lastmod":1562569796,"objectID":"cd23ab85b476a5463bb681d85c60ee61","permalink":"https://guoxudong.io/post/nas-k8s/","publishdate":"2019-07-08T15:09:56+08:00","relpermalink":"/post/nas-k8s/","section":"post","summary":"è®°å½•åœ¨é˜¿é‡Œäº‘è´­ä¹°ã€é…ç½®ã€æŒ‚è½½ NAS æ•°æ®å·åˆ° Kubernetes é›†ç¾¤ï¼Œç”±äºå®˜æ–¹æ–‡æ¡£æ²¡æœ‰åŠæ—¶æ›´æ–°ï¼Œå¯ä»¥çœ‹åšæ˜¯å¯¹å®˜æ–¹æ–‡æ¡£çš„è¡¥å……ã€‚","tags":["é˜¿é‡Œäº‘","kubernetes","å®¹å™¨"],"title":"é˜¿é‡Œäº‘ ACK æŒ‚è½½ NAS æ•°æ®å·","type":"post"},{"authors":["éƒ­æ—­ä¸œ"],"categories":["åº”ç”¨ç¨‹åºå¼€å‘"],"content":"  åŸæ–‡åœ°å€ï¼šhttps://semver.org/lang/zh-CN/\nè¯­ä¹‰åŒ–ç‰ˆæœ¬ 2.0.0\næä¾›å¤šç§è¯­è¨€ï¼Œè¯­ä¹‰åŒ–ç‰ˆæœ¬æ§åˆ¶çš„è§„èŒƒæ˜¯ç”± Gravatars åˆ›åŠè€…å…¼ GitHub å…±åŒåˆ›åŠè€… Tom Preston-Werner æ‰€å»ºç«‹ã€‚\n æ‘˜è¦ ç‰ˆæœ¬æ ¼å¼ï¼šä¸»ç‰ˆæœ¬å·.æ¬¡ç‰ˆæœ¬å·.ä¿®è®¢å·ï¼Œç‰ˆæœ¬å·é€’å¢è§„åˆ™å¦‚ä¸‹ï¼š\n ä¸»ç‰ˆæœ¬å·ï¼šå½“ä½ åšäº†ä¸å…¼å®¹çš„ API ä¿®æ”¹ï¼Œ æ¬¡ç‰ˆæœ¬å·ï¼šå½“ä½ åšäº†å‘ä¸‹å…¼å®¹çš„åŠŸèƒ½æ€§æ–°å¢ï¼Œ ä¿®è®¢å·ï¼šå½“ä½ åšäº†å‘ä¸‹å…¼å®¹çš„é—®é¢˜ä¿®æ­£ã€‚  å…ˆè¡Œç‰ˆæœ¬å·åŠç‰ˆæœ¬ç¼–è¯‘å…ƒæ•°æ®å¯ä»¥åŠ åˆ°â€œä¸»ç‰ˆæœ¬å·.æ¬¡ç‰ˆæœ¬å·.ä¿®è®¢å·â€çš„åé¢ï¼Œä½œä¸ºå»¶ä¼¸ã€‚\nç®€ä»‹ åœ¨è½¯ä»¶ç®¡ç†çš„é¢†åŸŸé‡Œå­˜åœ¨ç€è¢«ç§°ä½œâ€œä¾èµ–åœ°ç‹±â€çš„æ­»äº¡ä¹‹è°·ï¼Œç³»ç»Ÿè§„æ¨¡è¶Šå¤§ï¼ŒåŠ å…¥çš„åŒ…è¶Šå¤šï¼Œä½ å°±è¶Šæœ‰å¯èƒ½åœ¨æœªæ¥çš„æŸä¸€å¤©å‘ç°è‡ªå·±å·²æ·±é™·ç»æœ›ä¹‹ä¸­ã€‚\nåœ¨ä¾èµ–é«˜çš„ç³»ç»Ÿä¸­å‘å¸ƒæ–°ç‰ˆæœ¬åŒ…å¯èƒ½å¾ˆå¿«ä¼šæˆä¸ºå™©æ¢¦ã€‚å¦‚æœä¾èµ–å…³ç³»è¿‡é«˜ï¼Œå¯èƒ½é¢ä¸´ç‰ˆæœ¬æ§åˆ¶è¢«é”æ­»çš„é£é™©ï¼ˆå¿…é¡»å¯¹æ¯ä¸€ä¸ªä¾èµ–åŒ…æ”¹ç‰ˆæ‰èƒ½å®ŒæˆæŸæ¬¡å‡çº§ï¼‰ã€‚è€Œå¦‚æœä¾èµ–å…³ç³»è¿‡äºæ¾æ•£ï¼Œåˆå°†æ— æ³•é¿å…ç‰ˆæœ¬çš„æ··ä¹±ï¼ˆå‡è®¾å…¼å®¹äºæœªæ¥çš„å¤šä¸ªç‰ˆæœ¬å·²è¶…å‡ºäº†åˆç†æ•°é‡ï¼‰ã€‚å½“ä½ ä¸“æ¡ˆçš„è¿›å±•å› ä¸ºç‰ˆæœ¬ä¾èµ–è¢«é”æ­»æˆ–ç‰ˆæœ¬æ··ä¹±å˜å¾—ä¸å¤Ÿç®€ä¾¿å’Œå¯é ï¼Œå°±æ„å‘³ç€ä½ æ­£å¤„äºä¾èµ–åœ°ç‹±ä¹‹ä¸­ã€‚\nä½œä¸ºè¿™ä¸ªé—®é¢˜çš„è§£å†³æ–¹æ¡ˆä¹‹ä¸€ï¼Œæˆ‘æè®®ç”¨ä¸€ç»„ç®€å•çš„è§„åˆ™åŠæ¡ä»¶æ¥çº¦æŸç‰ˆæœ¬å·çš„é…ç½®å’Œå¢é•¿ã€‚è¿™äº›è§„åˆ™æ˜¯æ ¹æ®ï¼ˆä½†ä¸å±€é™äºï¼‰å·²ç»è¢«å„ç§å°é—­ã€å¼€æ”¾æºç è½¯ä»¶æ‰€å¹¿æ³›ä½¿ç”¨çš„æƒ¯ä¾‹æ‰€è®¾è®¡ã€‚ä¸ºäº†è®©è¿™å¥—ç†è®ºè¿ä½œï¼Œä½ å¿…é¡»å…ˆæœ‰å®šä¹‰å¥½çš„å…¬å…± API ã€‚è¿™å¯ä»¥é€è¿‡æ–‡ä»¶å®šä¹‰æˆ–ä»£ç å¼ºåˆ¶è¦æ±‚æ¥å®ç°ã€‚æ— è®ºå¦‚ä½•ï¼Œè¿™å¥— API çš„æ¸…æ¥šæ˜äº†æ˜¯ååˆ†é‡è¦çš„ã€‚ä¸€æ—¦ä½ å®šä¹‰äº†å…¬å…± APIï¼Œä½ å°±å¯ä»¥é€è¿‡ä¿®æ”¹ç›¸åº”çš„ç‰ˆæœ¬å·æ¥å‘å¤§å®¶è¯´æ˜ä½ çš„ä¿®æ”¹ã€‚è€ƒè™‘ä½¿ç”¨è¿™æ ·çš„ç‰ˆæœ¬å·æ ¼å¼ï¼šX.Y.Z ï¼ˆä¸»ç‰ˆæœ¬å·.æ¬¡ç‰ˆæœ¬å·.ä¿®è®¢å·ï¼‰ä¿®å¤é—®é¢˜ä½†ä¸å½±å“API æ—¶ï¼Œé€’å¢ä¿®è®¢å·ï¼›API ä¿æŒå‘ä¸‹å…¼å®¹çš„æ–°å¢åŠä¿®æ”¹æ—¶ï¼Œé€’å¢æ¬¡ç‰ˆæœ¬å·ï¼›è¿›è¡Œä¸å‘ä¸‹å…¼å®¹çš„ä¿®æ”¹æ—¶ï¼Œé€’å¢ä¸»ç‰ˆæœ¬å·ã€‚\næˆ‘ç§°è¿™å¥—ç³»ç»Ÿä¸ºâ€œè¯­ä¹‰åŒ–çš„ç‰ˆæœ¬æ§åˆ¶â€ï¼Œåœ¨è¿™å¥—çº¦å®šä¸‹ï¼Œç‰ˆæœ¬å·åŠå…¶æ›´æ–°æ–¹å¼åŒ…å«äº†ç›¸é‚»ç‰ˆæœ¬é—´çš„åº•å±‚ä»£ç å’Œä¿®æ”¹å†…å®¹çš„ä¿¡æ¯ã€‚\nè¯­ä¹‰åŒ–ç‰ˆæœ¬æ§åˆ¶è§„èŒƒï¼ˆSemVerï¼‰ ä»¥ä¸‹å…³é”®è¯ MUSTã€MUST NOTã€REQUIREDã€SHALLã€SHALL NOTã€SHOULDã€SHOULD NOTã€ RECOMMENDEDã€MAYã€OPTIONAL ä¾ç…§ RFC 2119 çš„å™è¿°è§£è¯»ã€‚ï¼ˆè¯‘æ³¨ï¼šä¸ºäº†ä¿æŒè¯­å¥é¡ºç•…ï¼Œ ä»¥ä¸‹æ–‡ä»¶é‡åˆ°çš„å…³é”®è¯å°†ä¾ç…§æ•´å¥è¯­ä¹‰è¿›è¡Œç¿»è¯‘ï¼Œåœ¨æ­¤å…ˆä¸è¿›è¡Œä¸ªåˆ«ç¿»è¯‘ã€‚ï¼‰\n ä½¿ç”¨è¯­ä¹‰åŒ–ç‰ˆæœ¬æ§åˆ¶çš„è½¯ä»¶å¿…é¡»ï¼ˆMUSTï¼‰å®šä¹‰å…¬å…± APIã€‚è¯¥ API å¯ä»¥åœ¨ä»£ç ä¸­è¢«å®šä¹‰æˆ–å‡ºç°äºä¸¥è°¨çš„æ–‡ä»¶å†…ã€‚æ— è®ºä½•ç§å½¢å¼éƒ½åº”è¯¥åŠ›æ±‚ç²¾ç¡®ä¸”å®Œæ•´ã€‚ æ ‡å‡†çš„ç‰ˆæœ¬å·å¿…é¡»ï¼ˆMUSTï¼‰é‡‡ç”¨ X.Y.Z çš„æ ¼å¼ï¼Œå…¶ä¸­ Xã€Y å’Œ Z ä¸ºéè´Ÿçš„æ•´æ•°ï¼Œä¸”ç¦æ­¢ï¼ˆMUST NOTï¼‰åœ¨æ•°å­—å‰æ–¹è¡¥é›¶ã€‚X æ˜¯ä¸»ç‰ˆæœ¬å·ã€Y æ˜¯æ¬¡ç‰ˆæœ¬å·ã€è€Œ Z ä¸ºä¿®è®¢å·ã€‚æ¯ä¸ªå…ƒç´ å¿…é¡»ï¼ˆMUSTï¼‰ä»¥æ•°å€¼æ¥é€’å¢ã€‚ä¾‹å¦‚ï¼š1.9.1 -\u0026gt; 1.10.0 -\u0026gt; 1.11.0ã€‚ æ ‡è®°ç‰ˆæœ¬å·çš„è½¯ä»¶å‘è¡Œåï¼Œç¦æ­¢ï¼ˆMUST NOTï¼‰æ”¹å˜è¯¥ç‰ˆæœ¬è½¯ä»¶çš„å†…å®¹ã€‚ä»»ä½•ä¿®æ”¹éƒ½å¿…é¡»ï¼ˆMUSTï¼‰ä»¥æ–°ç‰ˆæœ¬å‘è¡Œã€‚ ä¸»ç‰ˆæœ¬å·ä¸ºé›¶ï¼ˆ0.y.zï¼‰çš„è½¯ä»¶å¤„äºå¼€å‘åˆå§‹é˜¶æ®µï¼Œä¸€åˆ‡éƒ½å¯èƒ½éšæ—¶è¢«æ”¹å˜ã€‚è¿™æ ·çš„å…¬å…± API ä¸åº”è¯¥è¢«è§†ä¸ºç¨³å®šç‰ˆã€‚ 1.0.0 çš„ç‰ˆæœ¬å·ç”¨äºç•Œå®šå…¬å…± API çš„å½¢æˆã€‚è¿™ä¸€ç‰ˆæœ¬ä¹‹åæ‰€æœ‰çš„ç‰ˆæœ¬å·æ›´æ–°éƒ½åŸºäºå…¬å…± API åŠå…¶ä¿®æ”¹å†…å®¹ã€‚ ä¿®è®¢å· Zï¼ˆx.y.Z | x \u0026gt; 0ï¼‰å¿…é¡»ï¼ˆMUSTï¼‰åœ¨åªåšäº†å‘ä¸‹å…¼å®¹çš„ä¿®æ­£æ—¶æ‰é€’å¢ã€‚è¿™é‡Œçš„ä¿®æ­£æŒ‡çš„æ˜¯é’ˆå¯¹ä¸æ­£ç¡®ç»“æœè€Œè¿›è¡Œçš„å†…éƒ¨ä¿®æ”¹ã€‚ æ¬¡ç‰ˆæœ¬å· Yï¼ˆx.Y.z | x \u0026gt; 0ï¼‰å¿…é¡»ï¼ˆMUSTï¼‰åœ¨æœ‰å‘ä¸‹å…¼å®¹çš„æ–°åŠŸèƒ½å‡ºç°æ—¶é€’å¢ã€‚åœ¨ä»»ä½•å…¬å…± API çš„åŠŸèƒ½è¢«æ ‡è®°ä¸ºå¼ƒç”¨æ—¶ä¹Ÿå¿…é¡»ï¼ˆMUSTï¼‰é€’å¢ã€‚ä¹Ÿå¯ä»¥ï¼ˆMAYï¼‰åœ¨å†…éƒ¨ç¨‹åºæœ‰å¤§é‡æ–°åŠŸèƒ½æˆ–æ”¹è¿›è¢«åŠ å…¥æ—¶é€’å¢ï¼Œå…¶ä¸­å¯ä»¥ï¼ˆMAYï¼‰åŒ…æ‹¬ä¿®è®¢çº§åˆ«çš„æ”¹å˜ã€‚æ¯å½“æ¬¡ç‰ˆæœ¬å·é€’å¢æ—¶ï¼Œä¿®è®¢å·å¿…é¡»ï¼ˆMUSTï¼‰å½’é›¶ã€‚ ä¸»ç‰ˆæœ¬å· Xï¼ˆX.y.z | X \u0026gt; 0ï¼‰å¿…é¡»ï¼ˆMUSTï¼‰åœ¨æœ‰ä»»ä½•ä¸å…¼å®¹çš„ä¿®æ”¹è¢«åŠ å…¥å…¬å…± API æ—¶é€’å¢ã€‚å…¶ä¸­å¯ä»¥ï¼ˆMAYï¼‰åŒ…æ‹¬æ¬¡ç‰ˆæœ¬å·åŠä¿®è®¢çº§åˆ«çš„æ”¹å˜ã€‚æ¯å½“ä¸»ç‰ˆæœ¬å·é€’å¢æ—¶ï¼Œæ¬¡ç‰ˆæœ¬å·å’Œä¿®è®¢å·å¿…é¡»ï¼ˆMUSTï¼‰å½’é›¶ã€‚ å…ˆè¡Œç‰ˆæœ¬å·å¯ä»¥ï¼ˆMAYï¼‰è¢«æ ‡æ³¨åœ¨ä¿®è®¢ç‰ˆä¹‹åï¼Œå…ˆåŠ ä¸Šä¸€ä¸ªè¿æ¥å·å†åŠ ä¸Šä¸€è¿ä¸²ä»¥å¥ç‚¹åˆ†éš”çš„æ ‡è¯†ç¬¦æ¥ä¿®é¥°ã€‚æ ‡è¯†ç¬¦å¿…é¡»ï¼ˆMUSTï¼‰ç”± ASCII å­—æ¯æ•°å­—å’Œè¿æ¥å· [0-9A-Za-z-] ç»„æˆï¼Œä¸”ç¦æ­¢ï¼ˆMUST NOTï¼‰ç•™ç™½ã€‚æ•°å­—å‹çš„æ ‡è¯†ç¬¦ç¦æ­¢ï¼ˆMUST NOTï¼‰åœ¨å‰æ–¹è¡¥é›¶ã€‚å…ˆè¡Œç‰ˆçš„ä¼˜å…ˆçº§ä½äºç›¸å…³è”çš„æ ‡å‡†ç‰ˆæœ¬ã€‚è¢«æ ‡ä¸Šå…ˆè¡Œç‰ˆæœ¬å·åˆ™è¡¨ç¤ºè¿™ä¸ªç‰ˆæœ¬å¹¶éç¨³å®šè€Œä¸”å¯èƒ½æ— æ³•æ»¡è¶³é¢„æœŸçš„å…¼å®¹æ€§éœ€æ±‚ã€‚èŒƒä¾‹ï¼š1.0.0-alphaã€1.0.0-alpha.1ã€1.0.0-0.3.7ã€1.0.0-x.7.z.92ã€‚ ç‰ˆæœ¬ç¼–è¯‘å…ƒæ•°æ®å¯ä»¥ï¼ˆMAYï¼‰è¢«æ ‡æ³¨åœ¨ä¿®è®¢ç‰ˆæˆ–å…ˆè¡Œç‰ˆæœ¬å·ä¹‹åï¼Œå…ˆåŠ ä¸Šä¸€ä¸ªåŠ å·å†åŠ ä¸Šä¸€è¿ä¸²ä»¥å¥ç‚¹åˆ†éš”çš„æ ‡è¯†ç¬¦æ¥ä¿®é¥°ã€‚æ ‡è¯†ç¬¦å¿…é¡»ï¼ˆMUSTï¼‰ç”± ASCII å­—æ¯æ•°å­—å’Œè¿æ¥å· [0-9A-Za-z-] ç»„æˆï¼Œä¸”ç¦æ­¢ï¼ˆMUST NOTï¼‰ç•™ç™½ã€‚å½“åˆ¤æ–­ç‰ˆæœ¬çš„ä¼˜å…ˆå±‚çº§æ—¶ï¼Œç‰ˆæœ¬ç¼–è¯‘å…ƒæ•°æ®å¯ï¼ˆSHOULDï¼‰è¢«å¿½ç•¥ã€‚å› æ­¤å½“ä¸¤ä¸ªç‰ˆæœ¬åªæœ‰åœ¨ç‰ˆæœ¬ç¼–è¯‘å…ƒæ•°æ®æœ‰å·®åˆ«æ—¶ï¼Œå±äºç›¸åŒçš„ä¼˜å…ˆå±‚çº§ã€‚èŒƒä¾‹ï¼š1.0.0-alpha+001ã€1.0.0+20130313144700ã€1.0.0-beta+exp.sha.5114f85ã€‚ ç‰ˆæœ¬çš„ä¼˜å…ˆå±‚çº§æŒ‡çš„æ˜¯ä¸åŒç‰ˆæœ¬åœ¨æ’åºæ—¶å¦‚ä½•æ¯”è¾ƒã€‚åˆ¤æ–­ä¼˜å…ˆå±‚çº§æ—¶ï¼Œå¿…é¡»ï¼ˆMUSTï¼‰æŠŠç‰ˆæœ¬ä¾åºæ‹†åˆ†ä¸ºä¸»ç‰ˆæœ¬å·ã€æ¬¡ç‰ˆæœ¬å·ã€ä¿®è®¢å·åŠå…ˆè¡Œç‰ˆæœ¬å·åè¿›è¡Œæ¯”è¾ƒï¼ˆç‰ˆæœ¬ç¼–è¯‘å…ƒæ•°æ®ä¸åœ¨è¿™ä»½æ¯”è¾ƒçš„åˆ—è¡¨ä¸­ï¼‰ã€‚ç”±å·¦åˆ°å³ä¾åºæ¯”è¾ƒæ¯ä¸ªæ ‡è¯†ç¬¦ï¼Œç¬¬ä¸€ä¸ªå·®å¼‚å€¼ç”¨æ¥å†³å®šä¼˜å…ˆå±‚çº§ï¼šä¸»ç‰ˆæœ¬å·ã€æ¬¡ç‰ˆæœ¬å·åŠä¿®è®¢å·ä»¥æ•°å€¼æ¯”è¾ƒï¼Œä¾‹å¦‚ï¼š1.0.0 \u0026lt; 2.0.0 \u0026lt; 2.1.0 \u0026lt; 2.1.1ã€‚å½“ä¸»ç‰ˆæœ¬å·ã€æ¬¡ç‰ˆæœ¬å·åŠä¿®è®¢å·éƒ½ç›¸åŒæ—¶ï¼Œæ”¹ä»¥ä¼˜å…ˆå±‚çº§æ¯”è¾ƒä½çš„å…ˆè¡Œç‰ˆæœ¬å·å†³å®šã€‚ä¾‹å¦‚ï¼š1.0.0-alpha \u0026lt; 1.0.0ã€‚æœ‰ç›¸åŒä¸»ç‰ˆæœ¬å·ã€æ¬¡ç‰ˆæœ¬å·åŠä¿®è®¢å·çš„ä¸¤ä¸ªå…ˆè¡Œç‰ˆæœ¬å·ï¼Œå…¶ä¼˜å…ˆå±‚çº§å¿…é¡»ï¼ˆMUSTï¼‰é€è¿‡ç”±å·¦åˆ°å³çš„æ¯ä¸ªè¢«å¥ç‚¹åˆ†éš”çš„æ ‡è¯†ç¬¦æ¥æ¯”è¾ƒï¼Œç›´åˆ°æ‰¾åˆ°ä¸€ä¸ªå·®å¼‚å€¼åå†³å®šï¼šåªæœ‰æ•°å­—çš„æ ‡è¯†ç¬¦ä»¥æ•°å€¼é«˜ä½æ¯”è¾ƒï¼Œæœ‰å­—æ¯æˆ–è¿æ¥å·æ—¶åˆ™é€å­—ä»¥ ASCII çš„æ’åºæ¥æ¯”è¾ƒã€‚æ•°å­—çš„æ ‡è¯†ç¬¦æ¯”éæ•°å­—çš„æ ‡è¯†ç¬¦ä¼˜å…ˆå±‚çº§ä½ã€‚è‹¥å¼€å¤´çš„æ ‡è¯†ç¬¦éƒ½ç›¸åŒæ—¶ï¼Œæ ä½æ¯”è¾ƒå¤šçš„å…ˆè¡Œç‰ˆæœ¬å·ä¼˜å…ˆå±‚çº§æ¯”è¾ƒé«˜ã€‚èŒƒä¾‹ï¼š1.0.0-alpha \u0026lt; 1.0.0-alpha.1 \u0026lt; 1.0.0-alpha.beta \u0026lt; 1.0.0-beta \u0026lt; 1.0.0-beta.2 \u0026lt; 1.0.0-beta.11 \u0026lt; 1.0.0-rc.1 \u0026lt; 1.0.0ã€‚  ä¸ºä»€ä¹ˆè¦ä½¿ç”¨è¯­ä¹‰åŒ–çš„ç‰ˆæœ¬æ§åˆ¶ï¼Ÿ è¿™å¹¶ä¸æ˜¯ä¸€ä¸ªæ–°çš„æˆ–è€…é©å‘½æ€§çš„æƒ³æ³•ã€‚å®é™…ä¸Šï¼Œä½ å¯èƒ½å·²ç»åœ¨åšä¸€äº›è¿‘ä¼¼çš„äº‹æƒ…äº†ã€‚é—®é¢˜åœ¨äºåªæ˜¯â€œè¿‘ä¼¼â€è¿˜ä¸å¤Ÿã€‚å¦‚æœæ²¡æœ‰æŸä¸ªæ­£å¼çš„è§„èŒƒå¯å¾ªï¼Œç‰ˆæœ¬å·å¯¹äºä¾èµ–çš„ç®¡ç†å¹¶æ— å®è´¨æ„ä¹‰ã€‚å°†ä¸Šè¿°çš„æƒ³æ³•å‘½åå¹¶ç»™äºˆæ¸…æ¥šçš„å®šä¹‰ï¼Œè®©ä½ å¯¹è½¯ä»¶ä½¿ç”¨è€…ä¼ è¾¾æ„å‘å˜å¾—å®¹æ˜“ã€‚ä¸€æ—¦è¿™äº›æ„å‘å˜å¾—æ¸…æ¥šï¼Œå¼¹æ€§ï¼ˆä½†åˆä¸ä¼šå¤ªå¼¹æ€§ï¼‰çš„ä¾èµ–è§„èŒƒå°±èƒ½è¾¾æˆã€‚\nä¸¾ä¸ªç®€å•çš„ä¾‹å­å°±å¯ä»¥å±•ç¤ºè¯­ä¹‰åŒ–çš„ç‰ˆæœ¬æ§åˆ¶å¦‚ä½•è®©ä¾èµ–åœ°ç‹±æˆä¸ºè¿‡å»ã€‚å‡è®¾æœ‰ä¸ªåä¸ºâ€œæ•‘ç«è½¦â€çš„å‡½å¼åº“ï¼Œå®ƒéœ€è¦å¦ä¸€ä¸ªåä¸ºâ€œæ¢¯å­â€å¹¶å·²ç»æœ‰ä½¿ç”¨è¯­ä¹‰åŒ–ç‰ˆæœ¬æ§åˆ¶çš„åŒ…ã€‚å½“æ•‘ç«è½¦åˆ›å»ºæ—¶ï¼Œæ¢¯å­çš„ç‰ˆæœ¬å·ä¸º 3.1.0ã€‚å› ä¸ºæ•‘ç«è½¦ä½¿ç”¨äº†ä¸€äº›ç‰ˆæœ¬ 3.1.0 æ‰€æ–°å¢çš„åŠŸèƒ½ï¼Œ ä½ å¯ä»¥æ”¾å¿ƒåœ°æŒ‡å®šä¾èµ–äºæ¢¯å­çš„ç‰ˆæœ¬å·å¤§ç­‰äº 3.1.0 ä½†å°äº 4.0.0ã€‚è¿™æ ·ï¼Œå½“æ¢¯å­ç‰ˆæœ¬ 3.1.1 å’Œ 3.2.0 å‘å¸ƒæ—¶ï¼Œä½ å¯ä»¥å°†ç›´æ¥å®ƒä»¬çº³å…¥ä½ çš„åŒ…ç®¡ç†ç³»ç»Ÿï¼Œå› ä¸ºå®ƒä»¬èƒ½ä¸åŸæœ‰ä¾èµ–çš„è½¯ä»¶å…¼å®¹ã€‚\nä½œä¸ºä¸€ä½è´Ÿè´£ä»»çš„å¼€å‘è€…ï¼Œä½ ç†å½“ç¡®ä¿æ¯æ¬¡åŒ…å‡çº§çš„è¿ä½œä¸ç‰ˆæœ¬å·çš„è¡¨è¿°ä¸€è‡´ã€‚ç°å®ä¸–ç•Œæ˜¯å¤æ‚çš„ï¼Œæˆ‘ä»¬é™¤äº†æé«˜è­¦è§‰å¤–èƒ½åšçš„ä¸å¤šã€‚ä½ æ‰€èƒ½åšçš„å°±æ˜¯è®©è¯­ä¹‰åŒ–çš„ç‰ˆæœ¬æ§åˆ¶ä¸ºä½ æä¾›ä¸€ä¸ªå¥å…¨çš„æ–¹å¼æ¥å‘è¡Œä»¥åŠå‡çº§åŒ…ï¼Œè€Œæ— éœ€æ¨å‡ºæ–°çš„ä¾èµ–åŒ…ï¼ŒèŠ‚çœä½ çš„æ—¶é—´åŠçƒ¦æ¼ã€‚\nå¦‚æœä½ å¯¹æ­¤è®¤åŒï¼Œå¸Œæœ›ç«‹å³å¼€å§‹ä½¿ç”¨è¯­ä¹‰åŒ–ç‰ˆæœ¬æ§åˆ¶ï¼Œä½ åªéœ€å£°æ˜ä½ çš„å‡½å¼åº“æ­£åœ¨ä½¿ç”¨å®ƒå¹¶éµå¾ªè¿™äº›è§„åˆ™å°±å¯ä»¥äº†ã€‚è¯·åœ¨ä½ çš„ README æ–‡ä»¶ä¸­ä¿ç•™æ­¤é¡µè¿ç»“ï¼Œè®©åˆ«äººä¹ŸçŸ¥é“è¿™äº›è§„åˆ™å¹¶ä»ä¸­å—ç›Šã€‚\nFAQ åœ¨ 0.y.z åˆå§‹å¼€å‘é˜¶æ®µï¼Œæˆ‘è¯¥å¦‚ä½•è¿›è¡Œç‰ˆæœ¬æ§åˆ¶ï¼Ÿ\næœ€ç®€å•çš„åšæ³•æ˜¯ä»¥ 0.1.0 ä½œä¸ºä½ çš„åˆå§‹åŒ–å¼€å‘ç‰ˆæœ¬ï¼Œå¹¶åœ¨åç»­çš„æ¯æ¬¡å‘è¡Œæ—¶é€’å¢æ¬¡ç‰ˆæœ¬å·ã€‚\nå¦‚ä½•åˆ¤æ–­å‘å¸ƒ 1.0.0 ç‰ˆæœ¬çš„æ—¶æœºï¼Ÿ\nå½“ä½ çš„è½¯ä»¶è¢«ç”¨äºæ­£å¼ç¯å¢ƒï¼Œå®ƒåº”è¯¥å·²ç»è¾¾åˆ°äº† 1.0.0 ç‰ˆã€‚å¦‚æœä½ å·²ç»æœ‰ä¸ªç¨³å®šçš„ API è¢«ä½¿ç”¨è€…ä¾èµ–ï¼Œä¹Ÿä¼šæ˜¯ 1.0.0 ç‰ˆã€‚å¦‚æœä½ å¾ˆæ‹…å¿ƒå‘ä¸‹å…¼å®¹çš„é—®é¢˜ï¼Œä¹Ÿåº”è¯¥ç®—æ˜¯ 1.0.0 ç‰ˆäº†ã€‚\nè¿™ä¸ä¼šé˜»ç¢å¿«é€Ÿå¼€å‘å’Œè¿­ä»£å—ï¼Ÿ\nä¸»ç‰ˆæœ¬å·ä¸ºé›¶çš„æ—¶å€™å°±æ˜¯ä¸ºäº†åšå¿«é€Ÿå¼€å‘ã€‚å¦‚æœä½ æ¯å¤©éƒ½åœ¨æ”¹å˜ APIï¼Œé‚£ä¹ˆä½ åº”è¯¥ä»åœ¨ä¸»ç‰ˆæœ¬å·ä¸ºé›¶çš„é˜¶æ®µï¼ˆ0.y.zï¼‰ï¼Œæˆ–æ˜¯æ­£åœ¨ä¸‹ä¸ªä¸»ç‰ˆæœ¬çš„ç‹¬ç«‹å¼€å‘åˆ†æ”¯ä¸­ã€‚\nå¯¹äºå…¬å…± APIï¼Œè‹¥å³ä½¿æ˜¯æœ€å°ä½†ä¸å‘ä¸‹å…¼å®¹çš„æ”¹å˜éƒ½éœ€è¦äº§ç”Ÿæ–°çš„ä¸»ç‰ˆæœ¬å·ï¼Œå²‚ä¸æ˜¯å¾ˆå¿«å°±è¾¾åˆ° 42.0.0 ç‰ˆï¼Ÿ\nè¿™æ˜¯å¼€å‘çš„è´£ä»»æ„Ÿå’Œå‰ç»æ€§çš„é—®é¢˜ã€‚ä¸å…¼å®¹çš„æ”¹å˜ä¸åº”è¯¥è½»æ˜“è¢«åŠ å…¥åˆ°æœ‰è®¸å¤šä¾èµ–ä»£ç çš„è½¯ä»¶ä¸­ã€‚å‡çº§æ‰€ä»˜å‡ºçš„ä»£ä»·å¯èƒ½æ˜¯å·¨å¤§çš„ã€‚è¦é€’å¢ä¸»ç‰ˆæœ¬å·æ¥å‘è¡Œä¸å…¼å®¹çš„æ”¹ç‰ˆï¼Œæ„å‘³ç€ä½ å¿…é¡»ä¸ºè¿™äº›æ”¹å˜æ‰€å¸¦æ¥çš„å½±å“æ·±æ€ç†Ÿè™‘ï¼Œå¹¶ä¸”è¯„ä¼°æ‰€æ¶‰åŠçš„æˆæœ¬åŠæ•ˆç›Šæ¯”ã€‚\nä¸ºæ•´ä¸ªå…¬å…± API å†™æ–‡ä»¶å¤ªè´¹äº‹äº†ï¼\nä¸ºä¾›ä»–äººä½¿ç”¨çš„è½¯ä»¶ç¼–å†™é€‚å½“çš„æ–‡ä»¶ï¼Œæ˜¯ä½ ä½œä¸ºä¸€åä¸“ä¸šå¼€å‘è€…åº”å°½çš„èŒè´£ã€‚ä¿æŒä¸“æ¡ˆé«˜æ•ˆä¸€ä¸ªéå¸¸é‡è¦çš„éƒ¨ä»½æ˜¯æŒæ§è½¯ä»¶çš„å¤æ‚åº¦ï¼Œå¦‚æœæ²¡æœ‰äººçŸ¥é“å¦‚ä½•ä½¿ç”¨ä½ çš„è½¯ä»¶æˆ–ä¸çŸ¥é“å“ªäº›å‡½æ•°çš„è°ƒç”¨æ˜¯å¯é çš„ï¼Œè¦æŒæ§å¤æ‚åº¦ä¼šæ˜¯å›°éš¾çš„ã€‚é•¿è¿œæ¥çœ‹ï¼Œä½¿ç”¨è¯­ä¹‰åŒ–ç‰ˆæœ¬æ§åˆ¶ä»¥åŠå¯¹äºå…¬å…± API æœ‰è‰¯å¥½è§„èŒƒçš„åšæŒï¼Œå¯ä»¥è®©æ¯ä¸ªäººåŠæ¯ä»¶äº‹éƒ½è¿è¡Œé¡ºç•…ã€‚\nä¸‡ä¸€ä¸å°å¿ƒæŠŠä¸€ä¸ªä¸å…¼å®¹çš„æ”¹ç‰ˆå½“æˆäº†æ¬¡ç‰ˆæœ¬å·å‘è¡Œäº†è¯¥æ€ä¹ˆåŠï¼Ÿ\nä¸€æ—¦å‘ç°è‡ªå·±ç ´åäº†è¯­ä¹‰åŒ–ç‰ˆæœ¬æ§åˆ¶çš„è§„èŒƒï¼Œå°±è¦ä¿®æ­£è¿™ä¸ªé—®é¢˜ï¼Œå¹¶å‘è¡Œä¸€ä¸ªæ–°çš„æ¬¡ç‰ˆæœ¬å·æ¥æ›´æ­£è¿™ä¸ªé—®é¢˜å¹¶ä¸”æ¢å¤å‘ä¸‹å…¼å®¹ã€‚å³ä½¿æ˜¯è¿™ç§æƒ…å†µï¼Œä¹Ÿä¸èƒ½å»ä¿®æ”¹å·²å‘è¡Œçš„ç‰ˆæœ¬ã€‚å¯ä»¥çš„è¯ï¼Œå°†æœ‰é—®é¢˜çš„ç‰ˆæœ¬å·è®°å½•åˆ°æ–‡ä»¶ä¸­ï¼Œå‘Šè¯‰ä½¿ç”¨è€…é—®é¢˜æ‰€åœ¨ï¼Œè®©ä»–ä»¬èƒ½å¤Ÿæ„è¯†åˆ°è¿™æ˜¯æœ‰é—®é¢˜çš„ç‰ˆæœ¬ã€‚\nå¦‚æœæˆ‘æ›´æ–°äº†è‡ªå·±çš„ä¾èµ–ä½†æ²¡æœ‰æ”¹å˜å…¬å…± API è¯¥æ€ä¹ˆåŠï¼Ÿ\nç”±äºæ²¡æœ‰å½±å“åˆ°å…¬å…± APIï¼Œè¿™å¯ä»¥è¢«è®¤å®šæ˜¯å…¼å®¹çš„ã€‚è‹¥æŸä¸ªè½¯ä»¶å’Œä½ çš„åŒ…æœ‰å…±åŒä¾èµ–ï¼Œåˆ™å®ƒä¼šæœ‰è‡ªå·±çš„ä¾èµ–è§„èŒƒï¼Œä½œè€…ä¹Ÿä¼šå‘ŠçŸ¥å¯èƒ½çš„å†²çªã€‚è¦åˆ¤æ–­æ”¹ç‰ˆæ˜¯å±äºä¿®è®¢ç­‰çº§æˆ–æ˜¯æ¬¡ç‰ˆç­‰çº§ï¼Œæ˜¯ä¾æ®ä½ æ›´æ–°çš„ä¾èµ–å…³ç³»æ˜¯ä¸ºäº†ä¿®å¤é—®é¢˜æˆ–æ˜¯åŠ å…¥æ–°åŠŸèƒ½ã€‚å¯¹äºåè€…ï¼Œæˆ‘ç»å¸¸ä¼šé¢„æœŸä¼´éšç€æ›´å¤šçš„ä»£ç ï¼Œè¿™æ˜¾ç„¶ä¼šæ˜¯ä¸€ä¸ªæ¬¡ç‰ˆæœ¬å·çº§åˆ«çš„é€’å¢ã€‚\nå¦‚æœæˆ‘å˜æ›´äº†å…¬å…± API ä½†æ— æ„ä¸­æœªéµå¾ªç‰ˆæœ¬å·çš„æ”¹åŠ¨æ€ä¹ˆåŠå‘¢ï¼Ÿï¼ˆæ„å³åœ¨ä¿®è®¢ç­‰çº§çš„å‘å¸ƒä¸­ï¼Œè¯¯å°†é‡å¤§ä¸”ä¸å…¼å®¹çš„æ”¹å˜åŠ åˆ°ä»£ç ä¹‹ä¸­ï¼‰\nè‡ªè¡Œåšæœ€ä½³çš„åˆ¤æ–­ã€‚å¦‚æœä½ æœ‰åºå¤§çš„ä½¿ç”¨è€…ç¾¤åœ¨ä¾ç…§å…¬å…± API çš„æ„å›¾è€Œå˜æ›´è¡Œä¸ºåä¼šå¤§å—å½±å“ï¼Œé‚£ä¹ˆæœ€å¥½åšä¸€æ¬¡ä¸»ç‰ˆæœ¬çš„å‘å¸ƒï¼Œå³ä½¿ä¸¥æ ¼æ¥è¯´è¿™ä¸ªä¿®å¤ä»…æ˜¯ä¿®è®¢ç­‰çº§çš„å‘å¸ƒã€‚è®°ä½ï¼Œ è¯­ä¹‰åŒ–çš„ç‰ˆæœ¬æ§åˆ¶å°±æ˜¯é€è¿‡ç‰ˆæœ¬å·çš„æ”¹å˜æ¥ä¼ è¾¾æ„ä¹‰ã€‚è‹¥è¿™äº›æ”¹å˜å¯¹ä½ çš„ä½¿ç”¨è€…æ˜¯é‡è¦çš„ï¼Œé‚£å°±é€è¿‡ç‰ˆæœ¬å·æ¥å‘ä»–ä»¬è¯´æ˜ã€‚\næˆ‘è¯¥å¦‚ä½•å¤„ç†å³å°†å¼ƒç”¨çš„åŠŸèƒ½ï¼Ÿ\nå¼ƒç”¨ç°å­˜çš„åŠŸèƒ½æ˜¯è½¯ä»¶å¼€å‘ä¸­çš„å®¶å¸¸ä¾¿é¥­ï¼Œä¹Ÿé€šå¸¸æ˜¯å‘å‰å‘å±•æ‰€å¿…é¡»çš„ã€‚å½“ä½ å¼ƒç”¨éƒ¨ä»½å…¬å…± API æ—¶ï¼Œä½ åº”è¯¥åšä¸¤ä»¶äº‹ï¼šï¼ˆ1ï¼‰æ›´æ–°ä½ çš„æ–‡ä»¶è®©ä½¿ç”¨è€…çŸ¥é“è¿™ä¸ªæ”¹å˜ï¼Œï¼ˆ2ï¼‰åœ¨é€‚å½“çš„æ—¶æœºå°†å¼ƒç”¨çš„åŠŸèƒ½é€è¿‡æ–°çš„æ¬¡ç‰ˆæœ¬å·å‘å¸ƒã€‚åœ¨æ–°çš„ä¸»ç‰ˆæœ¬å®Œå…¨ç§»é™¤å¼ƒç”¨åŠŸèƒ½å‰ï¼Œè‡³å°‘è¦æœ‰ä¸€ä¸ªæ¬¡ç‰ˆæœ¬åŒ…å«è¿™ä¸ªå¼ƒç”¨ä¿¡æ¯ï¼Œè¿™æ ·ä½¿ç”¨è€…æ‰èƒ½å¹³é¡ºåœ°è½¬ç§»åˆ°æ–°ç‰ˆ APIã€‚\nè¯­ä¹‰åŒ–ç‰ˆæœ¬å¯¹äºç‰ˆæœ¬çš„å­—ä¸²é•¿åº¦æ˜¯å¦æœ‰é™åˆ¶å‘¢ï¼Ÿ\næ²¡æœ‰ï¼Œè¯·è‡ªè¡Œåšé€‚å½“çš„åˆ¤æ–­ã€‚ä¸¾ä¾‹æ¥è¯´ï¼Œé•¿åˆ° 255 ä¸ªå­—å…ƒçš„ç‰ˆæœ¬å·²è¿‡åº¦å¤¸å¼ ã€‚å†è€…ï¼Œç‰¹å®šçš„ç³»ç»Ÿå¯¹äºå­—ä¸²é•¿åº¦å¯èƒ½ä¼šæœ‰ä»–ä»¬è‡ªå·±çš„é™åˆ¶ã€‚\nå…³äº è¯­ä¹‰åŒ–ç‰ˆæœ¬æ§åˆ¶çš„è§„èŒƒæ˜¯ç”± Gravatars åˆ›åŠè€…å…¼ GitHub å…±åŒåˆ›åŠè€… Tom Preston-Werner æ‰€å»ºç«‹ã€‚\nå¦‚æœæ‚¨æœ‰ä»»ä½•å»ºè®®ï¼Œè¯·åˆ° GitHub ä¸Šæå‡ºæ‚¨çš„é—®é¢˜ã€‚\nè®¸å¯è¯ çŸ¥è¯†å…±äº« ç½²å 3.0 (CC BY 3.0)\n","date":1562377242,"expirydate":-62135596800,"kind":"page","lang":"zh","lastmod":1562377242,"objectID":"d6fc08dd6087662b0feb22b953284abb","permalink":"https://guoxudong.io/post/semver/","publishdate":"2019-07-06T09:40:42+08:00","relpermalink":"/post/semver/","section":"post","summary":"è¯­ä¹‰åŒ–çš„ç‰ˆæœ¬æ§åˆ¶ï¼Œåœ¨è¿™å¥—çº¦å®šä¸‹ï¼Œç‰ˆæœ¬å·åŠå…¶æ›´æ–°æ–¹å¼åŒ…å«äº†ç›¸é‚»ç‰ˆæœ¬é—´çš„åº•å±‚ä»£ç å’Œä¿®æ”¹å†…å®¹çš„ä¿¡æ¯ã€‚","tags":["è½¯ä»¶è®¾è®¡","äº‘åŸç”Ÿ","å¾®æœåŠ¡"],"title":"è¯­ä¹‰åŒ–ç‰ˆæœ¬æ§åˆ¶è§„èŒƒï¼ˆSemVerï¼‰","type":"post"},{"authors":null,"categories":["ç¿»è¯‘"],"content":"  è½¬è‡ªæ˜é‡‘ç¤¾åŒºï¼ŒåŸæ–‡åœ°å€ï¼šhttps://juejin.im/post/5d1b2a656fb9a07edc0b7058\n Kubernetes å„¿ç«¥æ’å›¾æŒ‡å— çŒ®ç»™æ‰€æœ‰è¯•å›¾å‘å­©å­ä»¬è§£é‡Šè½¯ä»¶å·¥ç¨‹çš„å®¶é•¿ã€‚\nå¾ˆä¹…å¾ˆä¹…ä»¥å‰ï¼Œæœ‰ä¸€ä¸ªå« Phippy çš„åº”ç”¨ç¨‹åºã€‚å¥¹æ˜¯ä¸€ä¸ªç®€å•çš„åº”ç”¨ç¨‹åºï¼Œç”± PHP ç¼–å†™ä¸”åªæœ‰ä¸€ä¸ªé¡µé¢ã€‚å¥¹ä½åœ¨ä¸€ä¸ªéœ€è¦å’Œå…¶ä»–å¯æ€•çš„åº”ç”¨ç¨‹åºåˆ†äº«ç¯å¢ƒçš„ä¸»æœºä¸­ï¼Œå¥¹ä¸è®¤è¯†è¿™äº›åº”ç”¨ç¨‹åºå¹¶ä¸”ä¸æ„¿æ„å’Œä»–ä»¬æ¥å¾€ã€‚å¥¹å¸Œæœ›å¥¹èƒ½æ‹¥æœ‰ä¸€ä¸ªå±äºè‡ªå·±çš„ç¯å¢ƒï¼šåªæœ‰å¥¹è‡ªå·±å’Œå¥¹å¯ä»¥ç§°ä¹‹ä¸ºå®¶çš„ Web æœåŠ¡å™¨ã€‚\næ¯ä¸ªåº”ç”¨ç¨‹åºéƒ½æœ‰ä¸ªè¿è¡Œæ‰€ä¾èµ–çš„ç¯å¢ƒã€‚å¯¹äº PHP åº”ç”¨ç¨‹åºæ¥è¯´ï¼Œè¿™ä¸ªç¯å¢ƒå¯èƒ½åŒ…æ‹¬ Web æœåŠ¡å™¨ï¼Œä¸€ä¸ªå¯è¯»æ–‡ä»¶ç³»ç»Ÿå’Œ PHP å¼•æ“æœ¬èº«ã€‚\næœ‰ä¸€å¤©ï¼Œä¸€åªå–„è‰¯çš„é²¸é±¼å‡ºç°äº†ã€‚ä»–å»ºè®®å° Phippy ä½åœ¨å®¹å™¨é‡Œï¼Œè¿™æ ·å¯èƒ½ä¼šæ›´å¿«ä¹ã€‚æ‰€ä»¥åº”ç”¨ç¨‹åº Phippy è¿ç§»åˆ°äº†å®¹å™¨ä¸­ã€‚è¿™ä¸ªå®¹å™¨å¾ˆæ£’ï¼Œä½†æ˜¯â€¦â€¦å®ƒæœ‰ç‚¹åƒä¸€ä¸ªæ¼‚æµ®åœ¨å¤§æµ·ä¸­å¤®çš„è±ªåèµ·å±…å®¤ã€‚\nå®¹å™¨æä¾›äº†ä¸€ä¸ªç‹¬ç«‹çš„ç¯å¢ƒï¼Œåº”ç”¨ç¨‹åºå¯ä»¥åœ¨è¿™ä¸ªç¯å¢ƒä¸­è¿è¡Œã€‚ä½†æ˜¯è¿™äº›å­¤ç«‹çš„å®¹å™¨å¸¸å¸¸éœ€è¦è¢«ç®¡ç†å¹¶ä¸å¤–é¢çš„ä¸–ç•Œè¿æ¥ã€‚å¯¹äºå­¤ç«‹çš„å®¹å™¨è€Œè¨€ï¼Œå…±äº«æ–‡ä»¶ç³»ç»Ÿã€ç½‘ç»œé€šä¿¡ã€è°ƒåº¦ã€è´Ÿè½½å‡è¡¡å’Œåˆ†å‘éƒ½æ˜¯è¦é¢å¯¹çš„æŒ‘æˆ˜ã€‚\né²¸é±¼è€¸äº†è€¸è‚©ã€‚â€œå¯¹ä¸èµ·ï¼Œå­©å­ã€‚â€ä»–è¯´ç€ï¼Œæ¶ˆå¤±åœ¨æµ·é¢ä¸‹ã€‚å°±åœ¨ Phippy ç”šè‡³å¼€å§‹ç»æœ›æ—¶ï¼Œä¸€ä½é©¾é©¶ç€å·¨è½®çš„èˆ¹é•¿å‡ºç°åœ¨æµ·å¹³çº¿ä¸Šã€‚è¿™è‰˜èˆ¹ç”±å‡ åä¸ªç»‘åœ¨ä¸€èµ·çš„æœ¨ç­ç»„æˆï¼Œä½†ä»å¤–é¢æ¥çœ‹ï¼Œå®ƒå°±åƒä¸€è‰˜å·¨è½®ã€‚ â€œä½ å¥½å‘€ï¼Œè¿™ä½ PHP åº”ç”¨ç¨‹åºæœ‹å‹ã€‚æˆ‘æ˜¯ Kube èˆ¹é•¿ã€‚â€ç¿æ™ºçš„è€èˆ¹é•¿è¯´ã€‚\nâ€œKubernetesâ€ åœ¨å¸Œè…Šè¯­ä¸­æ˜¯èˆ¹é•¿çš„æ„æ€ã€‚æˆ‘ä»¬å¯ä»¥ä»è¿™ä¸ªå•è¯ä¸­å¾—åˆ° Cybernetic å’Œ Gubernatorial è¿™ä¸¤ä¸ªè¯ç»„ã€‚Kubernetes é¡¹ç›®ä¸“æ³¨äºæ„å»ºä¸€ä¸ªå¥å£®çš„å¹³å°ï¼Œç”¨äºåœ¨ç”Ÿäº§ç¯å¢ƒä¸­è¿è¡Œæ•°åƒä¸ªå®¹å™¨ã€‚\nâ€œæˆ‘æ˜¯ Phippyã€‚â€å°åº”ç”¨ç¨‹åºè¯´ã€‚\nâ€œå¾ˆé«˜å…´è®¤è¯†ä½ ã€‚â€èˆ¹é•¿ä¸€è¾¹è¯´ï¼Œä¸€è¾¹åœ¨å¥¹èº«ä¸Šè´´ä¸Šäº†ä¸€å¼ æ ‡æœ‰å§“åçš„æ ‡ç­¾ã€‚\nKubernetes ä½¿ç”¨æ ‡ç­¾ä½œä¸ºâ€œåç‰Œâ€æ¥æ ‡è¯†äº‹ç‰©ã€‚å®ƒå¯ä»¥æ ¹æ®è¿™äº›æ ‡ç­¾è¿›è¡ŒæŸ¥è¯¢ã€‚æ ‡ç­¾æ˜¯å¼€æ”¾æ€§çš„ï¼šä½ å¯ä»¥ç”¨ä»–ä»¬æ¥è¡¨ç¤ºè§’è‰²ã€ç¨³å®šæ€§æˆ–å…¶ä»–é‡è¦çš„å±æ€§ã€‚\nèˆ¹é•¿å»ºè®®åº”ç”¨ç¨‹åºæŠŠå¥¹çš„å®¹å™¨æ¬åˆ°èˆ¹ä¸Šçš„ä¸€ä¸ªèˆ¹èˆ±ä¸­ã€‚Phippy å¾ˆé«˜å…´åœ°æŠŠå¥¹çš„å®¹å™¨æ¬åˆ° Kube èˆ¹é•¿å·¨è½®çš„èˆ¹èˆ±å†…ã€‚Phippy è§‰å¾—è¿™é‡Œåƒå®¶ä¸€æ ·ã€‚\nåœ¨ Kubernetes ä¸­ï¼ŒPod ä»£è¡¨ä¸€ä¸ªå¯è¿è¡Œçš„å·¥ä½œå•å…ƒã€‚é€šå¸¸ï¼Œä½ ä¼šåœ¨ Pod ä¸­è¿è¡Œä¸€ä¸ªå®¹å™¨ã€‚ä½†æ˜¯å¯¹äºä¸€äº›å®¹å™¨ç´§å¯†è€¦åˆçš„æƒ…å†µï¼Œä½ å¯ä»¥é€‰æ‹©åœ¨åŒä¸€ä¸ª Pod ä¸­è¿è¡Œå¤šä¸ªå®¹å™¨ã€‚Kubernetes è´Ÿè´£å°†ä½ çš„ Pod å’Œç½‘ç»œä»¥åŠ Kubernetes çš„å…¶ä½™ç¯å¢ƒç›¸è¿ã€‚\nPhippy æœ‰ä¸€äº›ä¸åŒå¯»å¸¸çš„å…´è¶£ï¼Œå¥¹å¾ˆå–œæ¬¢é—ä¼ å­¦å’Œç»µç¾Šã€‚æ‰€ä»¥å¥¹é—®èˆ¹é•¿ï¼šâ€œå¦‚æœæˆ‘æƒ³å…‹éš†æˆ‘è‡ªå·±ï¼Œæ˜¯å¦å¯ä»¥æ ¹æ®éœ€æ±‚å…‹éš†ä»»æ„æ¬¡æ•°å‘¢ï¼Ÿâ€\nâ€œè¿™å¾ˆå®¹æ˜“ã€‚â€èˆ¹é•¿è¯´ã€‚èˆ¹é•¿æŠŠ Phippy ä»‹ç»ç»™äº† Replication Controllerã€‚\nReplication Controller æä¾›ä¸€ç§ç®¡ç†ä»»æ„æ•°é‡ Pod çš„æ–¹æ³•ã€‚ä¸€ä¸ª Replication Controller åŒ…å«ä¸€ä¸ª Pod æ¨¡æ¿ï¼Œè¯¥æ¨¡æ¿å¯ä»¥è¢«å¤åˆ¶ä»»æ„æ¬¡æ•°ã€‚é€šè¿‡ Replication Controllerï¼ŒKubernetes å°†ç®¡ç† Pod çš„ç”Ÿå‘½å‘¨æœŸï¼ŒåŒ…æ‹¬ä¼¸ç¼©ã€æ»šåŠ¨æ›´æ–°å’Œç›‘æ§ã€‚\næ— æ•°ä¸ªæ—¥å¤œï¼Œå°åº”ç”¨ç¨‹åºåœ¨å¥¹çš„èˆ¹èˆ±ä¸­ä¸å¥¹çš„å¤åˆ¶å“ç›¸å¤„ååˆ†æ„‰å¿«ã€‚ä½†ä¸è‡ªå·±ä¸ºä¼å¹¶æ²¡æœ‰æ‰€è¯´çš„é‚£ä¹ˆå¥½â€¦â€¦å³ä½¿ä½ æ‹¥æœ‰ N ä¸ªè‡ªå·±çš„å…‹éš†ä½“ã€‚ Kube èˆ¹é•¿æ…ˆç¥¥åœ°ç¬‘äº†ç¬‘ï¼šâ€œæˆ‘æ­£å¥½æœ‰ä¸€æ ·ä¸œè¥¿ã€‚â€ ä»–åˆšå¼€å£ï¼Œåœ¨ Phippy çš„ Replication Controller å’Œèˆ¹çš„å…¶ä»–éƒ¨åˆ†ä¹‹é—´æ‰“å¼€äº†ä¸€æ¡éš§é“ã€‚Kube èˆ¹é•¿ç¬‘ç€è¯´ï¼šâ€œå³ä½¿ä½ çš„å¤åˆ¶å“æ¥äº†åˆå»ï¼Œè¿™æ¡éš§é“å§‹ç»ˆä¼šç•™åœ¨è¿™é‡Œï¼Œä½ å¯ä»¥é€šè¿‡å®ƒå‘ç°å…¶ä»– Podï¼Œå…¶ä»– Pod ä¹Ÿå¯ä»¥å‘ç°ä½ ï¼â€\næœåŠ¡å‘ŠçŸ¥ Kubernetes ç¯å¢ƒçš„å…¶ä½™éƒ¨åˆ†ï¼ˆåŒ…æ‹¬å…¶ä»– Pod å’Œ Replication Controllerï¼‰ä½ çš„åº”ç”¨ç¨‹åºåŒ…å«äº†å“ªäº›æœåŠ¡ï¼Œå½“ Pod æ¥æ¥å¾€å¾€ï¼ŒæœåŠ¡çš„ IP åœ°å€å’Œç«¯å£å§‹ç»ˆä¿æŒä¸å˜ã€‚å…¶ä»–åº”ç”¨ç¨‹åºå¯ä»¥é€šè¿‡ Kurbenetes æœåŠ¡å‘ç°æ‰¾åˆ°ä½ çš„æœåŠ¡ã€‚\nå¤šäºäº†è¿™äº›æœåŠ¡ï¼ŒPhippy å¼€å§‹æ¢ç´¢èˆ¹çš„å…¶ä»–éƒ¨åˆ†ã€‚ä¸ä¹…ä¹‹åï¼ŒPhippy é‡åˆ°äº† Goldieã€‚ä»–ä»¬æˆäº†æœ€å¥½çš„æœ‹å‹ã€‚æœ‰ä¸€å¤©ï¼ŒGoldie åšäº†ä¸€ä»¶ä¸åŒå¯»å¸¸çš„äº‹ã€‚å¥¹é€ç»™ Phippy ä¸€ä»¶ç¤¼ç‰©ã€‚Phippy çœ‹äº†ç¤¼ç‰©ä¸€çœ¼ï¼Œæ‚²ä¼¤çš„æ³ªæ°´å¤ºçœ¶è€Œå‡ºã€‚ â€œä½ ä¸ºä»€ä¹ˆè¿™ä¹ˆä¼¤å¿ƒå‘¢ï¼Ÿâ€Goldie é—®é“ã€‚ â€œæˆ‘å–œæ¬¢è¿™ä¸ªç¤¼ç‰©ï¼Œä½†æˆ‘æ²¡æœ‰åœ°æ–¹å¯ä»¥æ”¾å®ƒï¼â€Phippy æŠ½å™é“ã€‚ ä½† Goldie çŸ¥é“è¯¥æ€ä¹ˆåšã€‚â€œä¸ºä»€ä¹ˆä¸æŠŠå®ƒæ”¾å…¥å·ä¸­å‘¢ï¼Ÿâ€\nå·è¡¨ç¤ºå®¹å™¨å¯ä»¥è®¿é—®å’Œå­˜å‚¨ä¿¡æ¯çš„ä½ç½®ã€‚å¯¹äºåº”ç”¨ç¨‹åºï¼Œå·æ˜¾ç¤ºä¸ºæœ¬åœ°æ–‡ä»¶ç³»ç»Ÿçš„ä¸€éƒ¨åˆ†ã€‚ä½†å·å¯ä»¥ç”±æœ¬åœ°å­˜å‚¨ã€Cephã€Glusterã€æŒä¹…æ€§å—å­˜å‚¨ï¼Œä»¥åŠå…¶ä»–å­˜å‚¨åç«¯æ”¯æŒã€‚ Phippy å–œæ¬¢åœ¨ Kube èˆ¹é•¿çš„èˆ¹ä¸Šç”Ÿæ´»ï¼Œå¥¹å¾ˆäº«å—æ¥è‡ªæ–°æœ‹å‹çš„é™ªä¼´ï¼ˆGoldie çš„æ¯ä¸ªå…‹éš†äººéƒ½åŒæ ·ä»¤äººæ„‰æ‚¦ï¼‰ã€‚ä½†æ˜¯ï¼Œå½“å¥¹å›æƒ³èµ·åœ¨å¯æ€•çš„ä¸»æœºåº¦è¿‡çš„æ—¥å­ï¼Œå¥¹æƒ³çŸ¥é“å¥¹æ˜¯å¦ä¹Ÿå¯ä»¥æ‹¥æœ‰ä¸€ç‚¹è‡ªå·±çš„éšç§ã€‚ â€œè¿™å¬èµ·æ¥åƒæ˜¯ä½ æ‰€éœ€è¦çš„ï¼Œâ€Kube èˆ¹é•¿è¯´ï¼Œâ€œè¿™æ˜¯ä¸€ä¸ªå‘½åç©ºé—´ã€‚â€\nå‘½åç©ºé—´æ˜¯ Kubernetes å†…éƒ¨çš„åˆ†ç»„æœºåˆ¶ã€‚æœåŠ¡ã€Podã€Replication Controller å’Œå·å¯ä»¥åœ¨å‘½åç©ºé—´å†…éƒ¨è½»æ¾åä½œï¼Œä½†å‘½åç©ºé—´æä¾›äº†ä¸é›†ç¾¤å…¶ä»–éƒ¨åˆ†ä¸€å®šç¨‹åº¦çš„éš”ç¦»ã€‚ Phippy ä¸å¥¹çš„æ–°æœ‹å‹ä¸€èµ·ä¹˜å Kube èˆ¹é•¿çš„å·¨è½®èˆªè¡Œäºå¤§æµ·ä¹‹ä¸Šã€‚å¥¹ç»å†äº†è®¸å¤šä¼Ÿå¤§çš„å†’é™©ï¼Œä½†æœ€é‡è¦çš„æ˜¯ï¼ŒPhippy æ‰¾åˆ°äº†è‡ªå·±çš„å®¶ã€‚ æ‰€ä»¥ Phippy ä»æ­¤è¿‡ä¸Šäº†å¹¸ç¦çš„ç”Ÿæ´»ã€‚\n","date":1562291458,"expirydate":-62135596800,"kind":"page","lang":"zh","lastmod":1562291458,"objectID":"ab7429a760c5aad064c3649f60037248","permalink":"https://guoxudong.io/post/the-childrens-illustrated-guide-to-kubernetes/","publishdate":"2019-07-05T09:50:58+08:00","relpermalink":"/post/the-childrens-illustrated-guide-to-kubernetes/","section":"post","summary":"çŒ®ç»™æ‰€æœ‰è¯•å›¾å‘å­©å­ä»¬è§£é‡Šè½¯ä»¶å·¥ç¨‹çš„å®¶é•¿ã€‚","tags":["ç¿»è¯‘","kubernetes"],"title":"ã€è½¬ã€‘Kubernetes å„¿ç«¥æ’å›¾æŒ‡å—","type":"post"},{"authors":["éƒ­æ—­ä¸œ"],"categories":["kustomize"],"content":"  åªè¦ä»”ç»†æ‰¾ï¼Œæƒ³è¦çš„è½®å­æ€»ä¼šæœ‰çš„ã€‚ \u0026mdash; æŸä¸çŸ¥å DevOps å·¥ç¨‹å¸ˆ\n æ„Ÿè°¢ kubernetes-dev çš„ Mailing List ï¼æ—©ä¸Šåœ¨æµè§ˆé‚®ä»¶æ—¶å‘ç°äº†ä¸‹é¢è¿™å°æœ‰è¶£çš„é‚®ä»¶ï¼š\næ¥è§¦ Kubernetes ä¹Ÿæœ‰ä¸çŸ­çš„æ—¶é—´äº†ï¼Œä¹Ÿè§è¯äº† Kubernetes å¹²æ‰ Swarm å’Œ Mesos æˆä¸ºå®¹å™¨ç¼–æ’é¢†åŸŸçš„äº‹å®æ ‡å‡†çš„è¿‡ç¨‹ã€‚åœ¨äº«å— Kubernetes åŠå…¶ç”Ÿæ€åœˆå¸¦æ¥çš„ä¾¿åˆ©çš„åŒæ—¶ä¹Ÿåœ¨ä¸º Kubernetes åŠ CNCF é¡¹ç›®è¿›è¡Œè´¡çŒ®ã€‚è€Œä½¿ç”¨ kubectlã€rancher ç”šè‡³æ˜¯ kui è¿™äº› CLI å’Œ UI å·¥å…·å¯¹ Kubernetes é›†ç¾¤è¿›è¡Œæ“ä½œå’Œè§‚å¯Ÿã€‚\nè™½ç„¶ä¸Šé¢è¿™äº›å·¥å…·ä¸ºæ“ä½œ Kubernetes é›†ç¾¤å¸¦æ¥äº†æå¤§çš„ä¾¿åˆ©ï¼Œä½†æ˜¯å½’æ ¹åˆ°åº•è¿˜æ˜¯ä¸€äº›å¼€æºé¡¹ç›®ï¼Œå¹¶ä¸èƒ½æ»¡è¶³æˆ‘ä»¬çš„å…¨éƒ¨éœ€æ±‚ã€‚æ‰€ä»¥æˆ‘ä»¬åªèƒ½æ ¹æ®æˆ‘ä»¬è‡ªå·±çš„éœ€æ±‚å’Œ Kubernetes çš„ api-server è¿›è¡Œå®šåˆ¶ï¼Œä½†æ˜¯ç”±äº Kubernetes çš„ api-server æ¯”è¾ƒå¤æ‚ï¼ŒçŸ­æ—¶é—´å†…å¹¶ä¸æ˜¯é‚£ä¹ˆå¥½æ¢³ç†çš„ã€‚\nkubernetes-client/python ç”±äºæˆ‘ä»¬è‡ªç ”çš„ DevOps å¹³å°æ˜¯ä½¿ç”¨ python å¼€å‘çš„ï¼Œæ‰€ä»¥æˆ‘ä¹ŸåŸºäº python è¯­è¨€å¼€å‘äº†ä¸€å¥— Kubernetes Client ï¼Œä½†æ€»çš„æ¥è¯´ç”±äº Kubernetes çš„åŠŸèƒ½å®åœ¨å¤ªå¤šï¼Œè€Œæˆ‘çš„å¼€å‘å®è·µå¹¶ä¸æ˜¯å¾ˆå¤šï¼Œå¼€å‘å‡ºæ¥çš„åŠŸèƒ½åªæ˜¯å·®å¼ºäººæ„ã€‚\nè€Œ kubernetes-client/python è¿™ä¸ªå®˜æ–¹ç»™å‡ºçš„è½®å­æ˜¯çœŸçš„é¦™ï¼\nå®‰è£…æ–¹ä¾¿ è¿™ä¸ªå®‰è£…æ–¹å¼ç®€å•çš„ä»¤äººå‘æŒ‡ï¼Œæ”¯æŒçš„ python ç‰ˆæœ¬ä¸º 2.7 | 3.4 | 3.5 | 3.6 | 3.7 å¹¶ä¸”å’Œæ‰€æœ‰ python ä¾èµ–åŒ…ä¸€æ ·ï¼Œåªéœ€è¦ä½¿ç”¨ pip å®‰è£…å³å¯ï¼š\npip install kubernetes  ç®€å•ç¤ºä¾‹ æŸ¥çœ‹æ‰€æœ‰çš„ pod ï¼š\n#!/usr/bin/env python #encoding: utf-8 #Author: guoxudong from kubernetes import client, config # Configs can be set in Configuration class directly or using helper utility config.load_kube_config() v1 = client.CoreV1Api() print(\u0026quot;Listing pods with their IPs:\u0026quot;) ret = v1.list_pod_for_all_namespaces(watch=False) for i in ret.items: print(\u0026quot;%s\\t%s\\t%s\u0026quot; % (i.status.pod_ip, i.metadata.namespace, i.metadata.name))  è¿è¡ŒæŸ¥çœ‹ç»“æœï¼š\nListing pods with their IPs: 172.22.1.126\tkube-system\tcoredns-5975fdf55b-bqgkx 172.22.0.2\tkube-system\tcoredns-5975fdf55b-vxbb4 10.16.16.13\tkube-system\tflexvolume-9ccf7 10.16.16.15\tkube-system\tflexvolume-h5xn2 10.16.16.14\tkube-system\tflexvolume-kvn5x 10.16.16.17\tkube-system\tflexvolume-mf4zv 10.16.16.14\tkube-system\tkube-proxy-worker-7lpfz 10.16.16.15\tkube-system\tkube-proxy-worker-9wd9s 10.16.16.17\tkube-system\tkube-proxy-worker-phbbj 10.16.16.13\tkube-system\tkube-proxy-worker-pst5d 172.22.1.9\tkube-system\tmetrics-server-78b597d5bf-wdvqh 172.22.1.12\tkube-system\tnginx-ingress-controller-796ccc5d76-9jh5s 172.22.1.125\tkube-system\tnginx-ingress-controller-796ccc5d76-jwwwz 10.16.16.17\tkube-system\tterway-6mfs8 10.16.16.14\tkube-system\tterway-fz9ck 10.16.16.13\tkube-system\tterway-t9777 10.16.16.15\tkube-system\tterway-xbxlp 172.22.1.8\tkube-system\ttiller-deploy-5b5d8dd754-wpcrc ...  æœç„¶æ˜¯ä¸€ä¸ªå¥½è½®å­ï¼Œå¼•å…¥ kubeconfig çš„æ–¹å¼åŠå±•ç¤ºæ‰€æœ‰ namespace çš„ pod çš„æ–¹æ³•å°è£…çš„ä¹Ÿååˆ†ç®€æ´ï¼Œæ˜¯ä¸ªéå¸¸æ¼‚äº®çš„èŒƒä¾‹ã€‚å»ºè®®å¯ä»¥çœ‹ä¸€ä¸‹æºç ï¼Œè‚¯å®šä¼šæœ‰æ”¶è·çš„ï¼\næ”¯æŒç‰ˆæœ¬ client-python éµå¾ª semver è§„èŒƒï¼Œæ‰€ä»¥åœ¨ client-python çš„ä¸»è¦ç‰ˆæœ¬å¢åŠ ä¹‹å‰ï¼Œä»£ç å°†ç»§ç»­ä½¿ç”¨æ˜ç¡®æ”¯æŒçš„ Kubernetes é›†ç¾¤ç‰ˆæœ¬ã€‚\n    Kubernetes 1.5 Kubernetes 1.6 Kubernetes 1.7 Kubernetes 1.8 Kubernetes 1.9 Kubernetes 1.10 Kubernetes 1.11 Kubernetes 1.12 Kubernetes 1.13 Kubernetes 1.14     client-python 1.0 âœ“ - - - - - - - - -   client-python 2.0 + âœ“ - - - - - - - -   client-python 3.0 + + âœ“ - - - - - - -   client-python 4.0 + + + âœ“ - - - - - -   client-python 5.0 + + + + âœ“ - - - - -   client-python 6.0 + + + + + âœ“ - - - -   client-python 7.0 + + + + + + âœ“ - - -   client-python 8.0 + + + + + + + âœ“ - -   client-python 9.0 + + + + + + + + âœ“ -   client-python 10.0 + + + + + + + + + âœ“   client-python HEAD + + + + + + + + + âœ“    Mailing List çš„é‡è¦æ€§ è¿™æ¬¡çš„æ”¶è·å¾ˆå¤§ç¨‹åº¦å¾—ç›Šäº kubernetes-dev çš„ Mailing List ä¹Ÿå°±æ˜¯é‚®ä»¶åˆ—è¡¨ã€‚è¿™ç§æ²Ÿé€šæ–¹å¼åœ¨å›½å†…ä¸æ˜¯å¾ˆæµè¡Œï¼Œå¤§å®¶æ›´å–œæ¬¢ä½¿ç”¨ QQ å’Œå¾®ä¿¡è¿™æ ·çš„å³æ—¶é€šè®¯è½¯ä»¶è¿›è¡Œäº¤æµï¼Œä½†æ˜¯å¤§å¤šæ•°è‘—åå¼€æºé¡¹ç›®éƒ½æ˜¯ä¸»è¦ä½¿ç”¨ Mailing List è¿›è¡Œäº¤æµï¼Œäº¤æµçš„æ•°é‡ç”šè‡³æ¯”åœ¨ GitHub issue ä¸­è¿˜å¤šï¼Œåœ¨ä¸ Apache ã€ CNCF é¡¹ç›®å¼€æºçš„è´¡çŒ®è€…å’Œç»´æŠ¤è€…äº¤æµä¸­å¾—çŸ¥äº†ä½¿ç”¨ Mailing List ä¸»è¦è€ƒè™‘æ˜¯ä¸€ä¸‹å‡ ç‚¹ï¼š\n è¿™ç§å¼‚æ­¥çš„äº¤æµæ–¹å¼å¯ä»¥è®©æ›´å¤šå…³å¿ƒè¯¥è¯é¢˜çš„å¼€å‘äººå‘˜ä¸€èµ·åŠ å…¥åˆ°è®¨è®ºä¸­ã€‚ mailing list æ˜¯æ°¸ä¹…ä¿ç•™çš„ï¼Œå¦‚æœä½ å¯¹æŸä¸ªè¯é¢˜æ„Ÿå…´è¶£ï¼Œå¯ä»¥éšæ—¶å›å¤é‚®ä»¶ï¼Œå…³æ³¨è¿™ä¸ªè¯é¢˜çš„å¼€å‘è€…éƒ½ä¼šæ”¶åˆ°é‚®ä»¶ï¼Œæ— è®ºè¿™ä¸ªè¯é¢˜æ˜¯æ˜¨å¤©æå‡ºçš„ï¼Œè¿˜æ˜¯å»å¹´æå‡ºçš„ï¼Œæœ‰åŠ©äºè§£å†³ä¸€äº›é™ˆå¹´è€ BUG ï¼ˆä¿—ç§°æŠ€æœ¯å€ºï¼‰ã€‚ å³æ—¶é€šè®¯è½¯ä»¶è™½ç„¶å¾ˆä¾¿åˆ©ï¼Œä½†æ˜¯é—®é¢˜å¾ˆå¿«ä¼šè¢«è¯„è®ºé¡¶æ‰ï¼Œè™½ç„¶è¯¸å¦‚ slack è¿™æ ·çš„å·¥å…·è§£å†³äº†éƒ¨åˆ†è¿™æ–¹é¢çš„é—®é¢˜ï¼Œä½†æ˜¯è¿˜æ˜¯ä¸å¦‚ mailing list å¥½ç”¨ã€‚ å¹¶ä¸æ˜¯æ‰€æœ‰åœ°åŒºçš„å¼€å‘è€…éƒ½æœ‰é«˜é€Ÿçš„å®½å¸¦ï¼Œæ€§èƒ½ä¼˜ç§€çš„PCï¼Œåœ¨åœ°çƒä¸Šå¾ˆå¤šåœ°åŒºè¿˜æ˜¯åªèƒ½ä½¿ç”¨æ‹¨å·ä¸Šç½‘ï¼Œç½‘é€Ÿåªæœ‰å‡ kb/sï¼Œä»–ä»¬ç”šè‡³ GitHub issue éƒ½æ— æ³•ä½¿ç”¨ã€‚ä½†æ˜¯ä½ ä¸èƒ½å‰¥å¤ºä»–ä»¬å‚ä¸å¼€æºé¡¹ç›®çš„æƒåˆ©ï¼Œè€Œ mailing list æ˜¯ä¸€ç§å¾ˆå¥½çš„äº¤æµæ–¹å¼ã€‚ é€šè¿‡ mailing list å¯ä»¥å¾ˆå¥½æŒæ¡ç¤¾åŒºåŠ¨æ€ï¼Œæ•ˆæœæ˜æ˜¾å¥½äº GitHub watch ï¼Œå› ä¸ºå¹¶ä¸æ˜¯é¡¹ç›®çš„æ‰€æœ‰ commit éƒ½æ˜¯ä½ å…³å¿ƒçš„ã€‚  ç»“è¯­ å¦‚æœä½ æœ‰å¿—äºå‚ä¸åˆ°å¼€æºè¿åŠ¨ï¼Œåœ¨äº«å—å¼€æºè½¯ä»¶å¸¦æ¥ä¾¿åˆ©çš„åŒäº‹ï¼Œè¿˜æƒ³ä¸ºå¼€æºè½¯ä»¶åšå‡ºè‡ªå·±çš„è´¡çŒ®ï¼Œé‚£ä¹ˆ mailing list æ˜¯ä½ è¿›å…¥ç¤¾åŒºæœ€å¥½çš„é€‰æ‹©ã€‚åœ¨ mailing list ä¸­å’Œæ¥è‡ªä¸–ç•Œå„åœ°å¿—åŒé“åˆçš„å¼€å‘è€…äº¤æµä¸­æå‡è‡ªå·±çš„èƒ½åŠ›ï¼Œåˆ›é€ æ›´å¤§çš„ä»·å€¼ï¼Œè¿ˆå‡ºä½ å‚ä¸å¼€æºè¿åŠ¨çš„ç¬¬ä¸€æ­¥ã€‚\n","date":1562203001,"expirydate":-62135596800,"kind":"page","lang":"zh","lastmod":1562203001,"objectID":"d30474b6811d32daf1bf147a9c5e0eac","permalink":"https://guoxudong.io/post/kubernetes-client-python/","publishdate":"2019-07-04T09:16:41+08:00","relpermalink":"/post/kubernetes-client-python/","section":"post","summary":"ä»å‘ç°ã€ä½¿ç”¨ Kubernetes Client/Python è¿™ä¸ªé¡¹ç›®çš„è¿‡ç¨‹ï¼Œè°ˆè°ˆ mailing list åœ¨å¼€æºé¡¹ç›®ä¸­çš„é‡è¦æ€§ã€‚","tags":["kubernetes","python","å·¥å…·"],"title":"ç”±ä¸€å°é‚®ä»¶çœ‹ Mailing List åœ¨å¼€æºé¡¹ç›®ä¸­çš„é‡è¦æ€§","type":"post"},{"authors":["éƒ­æ—­ä¸œ"],"categories":["kustomize"],"content":"  åœ¨ä»¥å¾€çš„ pipeline ä¸­ï¼Œä½¿ç”¨ kubectl è¿›è¡Œéƒ¨ç½² Deployment åæ— æ³•æ£€æŸ¥ Deployment æ˜¯å¦éƒ¨ç½²æˆåŠŸï¼Œåªèƒ½é€šè¿‡ä½¿ç”¨å‘½ä»¤/è„šæœ¬æ¥æ‰‹åŠ¨æ£€æŸ¥ Deployment çŠ¶æ€ï¼Œè€Œ kubedog è¿™ä¸ªå°å·¥å…·å®Œç¾è§£å†³äº†è¿™ä¸ªé—®é¢˜ï¼Œå®Œå–„äº† CI/CD æµæ°´çº¿çš„æœ€åä¸€æ­¥ã€‚\n KubeDog kubedog æ˜¯ä¸€ä¸ª lib åº“å’Œ CLI å°å·¥å…·ï¼Œå…è®¸åœ¨ CI/CD éƒ¨ç½² pipeline ä¸­è§‚å¯Ÿå’Œè·Ÿè¸ª Kubernetes èµ„æºã€‚ä¸ kustomize é…åˆï¼Œé›†æˆåˆ° pipeline ä¹‹åï¼Œå®Œç¾çš„è§£å†³äº† CI/CD çš„æœ€åä¸€æ­¥ï¼Œå®Œç¾çš„æ›¿ä»£äº†ä¹‹å‰ä¸å¤Ÿçµæ´»çš„è„šæœ¬ï¼ˆå¥½å§ï¼Œå…¶å®æˆ‘ä¹Ÿå¼€å‘äº†ç±»ä¼¼çš„å°å·¥å…·ï¼Œä½†æ˜¯æœ‰è¿™ä¹ˆå¥½ç”¨çš„è½®å­ï¼Œæ‹¿æ¥ç›´æ¥ç”¨ä½•ä¹è€Œä¸ä¸ºå‘¢ï¼Ÿï¼‰ã€‚\nkubedog æä¾›äº† lib åº“å’Œ CLI å°å·¥å…·ï¼Œè¿™é‡Œç”±äºæ˜¯ä»‹ç» CI/CD ä¸­çš„å®è·µï¼Œæ‰€ä»¥åªä»‹ç»å…¶ä¸­çš„ rollout track åŠŸèƒ½ã€‚ lib åº“çš„ä½¿ç”¨å’Œ CLI çš„ follow åŠŸèƒ½è¿™é‡Œå°±ä¸åšä»‹ç»äº†ï¼Œæœ‰å…´è¶£çš„åŒå­¦å¯ä»¥å» GitHub ä¸ŠæŸ¥çœ‹è¯¥é¡¹ç›®çš„å„ç§ä½¿ç”¨æ–¹å¼ã€‚\né›†æˆ KubeDog ç”±äºæˆ‘å¸ç›®å‰ä½¿ç”¨çš„æ˜¯ drone è¿›è¡Œ CI ï¼Œæ¯ä¸ª step éƒ½æ˜¯ç”±ä¸€ä¸ª docker åˆ¶ä½œçš„æ’ä»¶ç»„æˆã€‚æˆ‘åˆ¶ä½œäº†ä¸€ä¸ªåŒ…å« kubectl ã€ kustomize å’Œ kubedog çš„é•œåƒã€‚è¯¥é•œåƒå·²ä¸Šä¼  dockerhub ï¼Œéœ€è¦çš„å¯ä»¥è‡ªè¡Œæ‹‰å–ä½¿ç”¨ guoxudongdocker/kubectl ,è€Œè¯¥æ’ä»¶çš„ä½¿ç”¨ä¹Ÿåœ¨ GitHub å’Œ DockerHub ä¸ŠæŸ¥çœ‹ã€‚\nè€Œé›†æˆæ–¹å¼ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œç›´æ¥å°† kubectl ã€ kustomize å’Œ kubedog çš„å¯æ‰§è¡ŒåŒ…ä¸‹è½½åˆ° /usr/local/bin å¹¶èµ‹äºˆæ‰§è¡Œæƒé™å³å¯ï¼Œä¸‹é¢å°±æ˜¯ Dockerfile æ–‡ä»¶ï¼š\nFROM alpine LABEL maintainer=\u0026quot;sunnydog0826@gmail.com\u0026quot; ENV KUBE_LATEST_VERSION=\u0026quot;v1.14.1\u0026quot; RUN apk add --update ca-certificates \\ \u0026amp;\u0026amp; apk add --update -t deps curl \\ \u0026amp;\u0026amp; curl -L https://storage.googleapis.com/kubernetes-release/release/${KUBE_LATEST_VERSION}/bin/linux/amd64/kubectl -o /usr/local/bin/kubectl \\ \u0026amp;\u0026amp; chmod +x /usr/local/bin/kubectl \\ \u0026amp;\u0026amp; curl -L https://github.com/kubernetes-sigs/kustomize/releases/download/v2.0.3/kustomize_2.0.3_linux_amd64 -o /usr/local/bin/kustomize \\ \u0026amp;\u0026amp; chmod +x /usr/local/bin/kustomize \\ \u0026amp;\u0026amp; curl -L https://dl.bintray.com/flant/kubedog/v0.2.0/kubedog-linux-amd64-v0.2.0 -o /usr/local/bin/kubedog \\ \u0026amp;\u0026amp; chmod +x /usr/local/bin/kubedog \\ \u0026amp;\u0026amp; apk del --purge deps \\ \u0026amp;\u0026amp; rm /var/cache/apk/* WORKDIR /root ENTRYPOINT [\u0026quot;kubectl\u0026quot;] CMD [\u0026quot;help\u0026quot;]  Kustomize é…åˆ KubeDog ä½¿ç”¨ åœ¨é•œåƒæ„å»ºå¥½ä¹‹åå°±å¯ä»¥ç›´æ¥ä½¿ç”¨äº†ï¼Œè¿™é‡Œä½¿ç”¨çš„æ˜¯ DockerHub çš„é•œåƒä»“åº“ï¼Œè¿™é‡Œå»ºè®®å°†é•œåƒåŒæ­¥åˆ°ç§æœ‰ä»“åº“ï¼Œæ¯”å¦‚é˜¿é‡Œäº‘çš„å®¹å™¨é•œåƒæœåŠ¡æˆ–è€… Habor ï¼Œå› ä¸ºå›½å†…æ‹‰å– DockerHub çš„é•œåƒä¸å¤ªç¨³å®šï¼Œç»å¸¸ä¼šæ‹‰å–é•œåƒå¤±è´¥æˆ–è€…è®¿é—®è¶…æ—¶ï¼Œåœ¨ CI/CD æµæ°´çº¿ä¸­æ¨èä½¿ç”¨æ›´ç¨³å®šé•œåƒã€‚\nä»¥ä¸‹æ˜¯ .drone.yml ç¤ºä¾‹ï¼š\nkind: pipeline name: {your-pipeline-name} steps: - name: Kubernetes éƒ¨ç½² image: guoxudongdocker/kubectl volumes: - name: kube path: /root/.kube commands: - cd deploy/overlays/dev # è¿™é‡Œä½¿ç”¨ kustomize ,è¯¦ç»†ä½¿ç”¨æ–¹æ³•è¯·è§ https://github.com/kubernetes-sigs/kustomize - kustomize edit set image {your-docker-registry}:${DRONE_BUILD_NUMBER} - kubectl apply -k . \u0026amp;\u0026amp; kubedog rollout track deployment {your-deployment-name} -n {your-namespace} -t {your-tomeout} ... volumes: - name: kube host: path: /tmp/cache/.kube # kubeconfig æŒ‚è½½ä½ç½® trigger: branch: - master # è§¦å‘ CI çš„åˆ†æ”¯  ä»ä¸Šé¢çš„é…ç½®å¯è§ï¼Œåœ¨è¯¥ step ä¸­æ‰§è¡Œäº†å¦‚ä¸‹å‡ æ­¥ï¼š\n è¿›å…¥ patch æ‰€åœ¨è·¯å¾„ ä½¿ç”¨äº† Kustomize å‘½ä»¤ kustomize edit set image {your-docker-registry}:${DRONE_BUILD_NUMBER} æ–¹å¼å°†å‰é¢ step ä¸­æ„å»ºå¥½çš„é•œåƒçš„ tag æ’å…¥åˆ° patch ä¸­ ä½¿ç”¨ kubectl apply -k . è¿›è¡Œ k8s éƒ¨ç½²ï¼Œè¦æ³¨æ„æœ€åçš„é‚£ä¸ª . ä½¿ç”¨ kubedog è·Ÿè¸ª Deployment éƒ¨ç½²çŠ¶æ€   å‘½ä»¤è§£æï¼škubedog rollout track deployment {your-deployment-name} -n {your-namespace} -t {your-tomeout}\n deployment {your-deployment-name} : Deployment çš„åç§° -n {your-namespace} : Deployment æ‰€åœ¨çš„ namespace -t {your-tomeout} : è¶…æ—¶æ—¶é—´ï¼Œå•ä½ä¸ºç§’ï¼Œè¶…æ—¶åä¼šæŠ¥é”™ï¼Œè¿™é‡Œè¯·æ ¹æ®å®é™…éƒ¨ç½²æƒ…å†µè¿›è¡Œè®¾ç½®   ç»“è¯­ ä» Kubernetes release v1.14 ç‰ˆæœ¬å¼€å§‹ï¼Œkustomize é›†æˆåˆ° kubectl ä¸­ï¼Œè¶Šæ¥è¶Šå¤š k8S å‘¨è¾¹çš„å°å·¥å…·å‡ºç°ã€‚è¿™äº›å°å·¥å…·çš„å‡ºç°å¸®åŠ©äº† Kubernetes çš„ä½¿ç”¨è€…æ¥æ‹‰å¹³ Kubernetes çš„ä½¿ç”¨æ›²çº¿ï¼ŒåŒæ—¶ä¹Ÿæ ‡å¿—ç€ K8S çš„æˆç†Ÿï¼Œè¶Šæ¥è¶Šå¤šçš„å¼€å‘äººå‘˜åŸºäºä½¿ç”¨ K8S çš„ç—›ç‚¹å¼€å‘ç›¸å…³å·¥å…·ã€‚å¥—ç”¨ä¸€å¥ä»Šå¹´ KubeCon çš„ Keynote æ¼”è®²ä¸Šï¼Œé˜¿é‡Œäº‘æ™ºèƒ½å®¹å™¨å¹³å°è´Ÿè´£äººä¸å®‡çš„è¯ï¼š Kubernetes æ­£å½“æ—¶ï¼Œäº‘åŸç”Ÿæœªæ¥å¯æœŸ ã€‚\n","date":1562138431,"expirydate":-62135596800,"kind":"page","lang":"zh","lastmod":1562138431,"objectID":"ab3f556204e3746f3958a13d19fda9df","permalink":"https://guoxudong.io/post/kustomize-5/","publishdate":"2019-07-03T15:20:31+08:00","relpermalink":"/post/kustomize-5/","section":"post","summary":"åœ¨ä»¥å¾€çš„ pipeline ä¸­ï¼Œä½¿ç”¨ kubectl è¿›è¡Œéƒ¨ç½² Deployment åæ— æ³•æ£€æŸ¥ Deployment æ˜¯å¦éƒ¨ç½²æˆåŠŸï¼Œåªèƒ½é€šè¿‡ä½¿ç”¨å‘½ä»¤/è„šæœ¬æ¥æ‰‹åŠ¨æ£€æŸ¥ Deployment çŠ¶æ€ï¼Œè€Œ kubedog è¿™ä¸ªå°å·¥å…·å®Œç¾è§£å†³äº†è¿™ä¸ªé—®é¢˜ï¼Œå®Œå–„äº† CI/CD æµæ°´çº¿çš„æœ€åä¸€æ­¥ã€‚","tags":["kubernetes","kustomize","å·¥å…·"],"title":"ä½¿ç”¨ Kustomize å¸®ä½ ç®¡ç† kubernetes åº”ç”¨ï¼ˆäº”ï¼‰ï¼šé…åˆ kubedog å®Œå–„ CI/CD çš„æœ€åä¸€æ­¥","type":"post"},{"authors":["éƒ­æ—­ä¸œ"],"categories":["kustomize"],"content":" ç°è±¡ åœ¨æ—¥å¸¸ CI/CD æµç¨‹ä¸­ï¼Œå·²ç»å°† Kustomize é›†æˆåˆ° pipeline ä¸­ä½¿ç”¨ï¼Œä½†æ˜¯åœ¨å¯¹ä¸€ä¸ªé¡¹ç›®è¿›è¡Œ Kustomize æ”¹é€ æ—¶ï¼Œå°†å•ä¸ª deploy.yaml æ‹†åˆ†ä¸ºäº†è‹¥å¹²ä¸ª patch ä»¥è¾¾åˆ°çµæ´» Kubernetes éƒ¨ç½²çš„ç›®çš„ã€‚ä½†æ˜¯åœ¨ä½¿ç”¨ kubectl apply -k . å‘½ä»¤è¿›è¡Œéƒ¨ç½²çš„æ—¶å€™é‡åˆ°äº† error: failed to find an object with apps_v1_Deployment|myapp to apply the patch çš„æŠ¥é”™ã€‚\nè§£å†³ä¹‹è·¯ ç”±äºä¹‹å‰çš„ä½¿ç”¨ä¸­æ²¡æœ‰é‡åˆ°æ­¤ç±»æŠ¥é”™ï¼Œçœ‹æŠ¥é”™ä¿¡æ¯åƒæ˜¯ apiVersion çš„é—®é¢˜ï¼Œæ‰€ä»¥å…ˆæ£€æŸ¥äº†æ‰€æœ‰ patch çš„ apiVersion ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰æ‰¾åˆ°æœ‰ä»€ä¹ˆé—®é¢˜ã€‚\nGoogle æœç´¢ å¯¹è¯¥æŠ¥é”™è¿›è¡Œäº†æœç´¢ï¼Œæœç´¢åˆ°å¦‚ä¸‹ç»“æœï¼š\nï¼Ÿï¼Ÿï¼Ÿ ä¸ºä½•è¿™ä¸ª issue æ²¡æœ‰è§£å†³å°±è¢«æå‡ºè€…å…³é—­äº†ï¼Ÿ\né—®é¢˜è§£å†³ åœ¨ Google äº†ä¸€åœˆä¹‹åè¿˜æ˜¯æ²¡æœ‰æ‰¾åˆ°ä»€ä¹ˆæœ‰è¥å…»çš„å›ç­”ï¼Œé—®é¢˜åˆå›åˆ°äº†åŸç‚¹\u0026hellip;åªèƒ½å¯¹æ‰€æœ‰çš„ patch çš„æ¯ä¸ªå­—ç¬¦å’Œæ¯ä¸ªé…ç½®é€ä¸€è¿›è¡Œäº†æ£€æŸ¥ã€‚ç»“æœå‘ç°æ˜¯ name çš„å†…å®¹ base ä¸ overlays ä¸åŒ\u0026hellip; base ä¸­æ˜¯ name:myapp ï¼Œè€Œ overlays ä¸­æ˜¯ name:my-app \u0026hellip;\nå¥½å§ï¼Œissue å…³çš„æ˜¯æœ‰é“ç†çš„\u0026hellip;\n","date":1562132690,"expirydate":-62135596800,"kind":"page","lang":"zh","lastmod":1562132690,"objectID":"7e9caa8e104a2224b1fdbff449be4919","permalink":"https://guoxudong.io/post/kustomize-err-1/","publishdate":"2019-07-03T13:44:50+08:00","relpermalink":"/post/kustomize-err-1/","section":"post","summary":"è§£å†³ä½¿ç”¨ Kustomize æ—¶é‡åˆ°çš„æŠ¥é”™ï¼š error: failed to find an object with apps_v1_Deployment|myapp to apply the patch ","tags":["kubernetes","kustomize","å·¥å…·"],"title":"è®°ä¸€æ¬¡ä½¿ç”¨ Kustomize æ—¶é‡åˆ°çš„æ„šè ¢é—®é¢˜","type":"post"},{"authors":["éƒ­æ—­ä¸œ"],"categories":["ç¨‹åºå‘˜è¶£é—»"],"content":" å‰è¨€ 2019å¹´6æœˆ24-26æ—¥ï¼ŒKubeCon + CloudNativeCon + Open Source Summitå¤§ä¼šåœ¨ä¸Šæµ·ä¸–åšä¸­å¿ƒä¸¾è¡Œã€‚æœ¬æ¬¡å¤§ä¼šè§„æ¨¡ç©ºå‰ï¼Œé¢„è®¡æœ‰è¶…è¿‡40ä¸ªå›½å®¶ï¼Œ3500å¤šåäº‘åŸç”Ÿã€å¼€æºé¢†åŸŸçš„å¼€å‘è€…å‚åŠ ï¼Œé—¨ç¥¨æ›´æ˜¯æ—©æ—©å”®ç½„ã€‚ä½œä¸ºä¸€åäº‘åŸç”Ÿåº”ç”¨çš„ä½¿ç”¨è€…ä¸å¼€å‘è€…ï¼Œæˆ‘ä¹ŸæŠ¥åå‚ä¸äº†è¿™æ¬¡å¤§ä¼šã€‚\n6æœˆçš„ä¸Šæµ·å·²ç»å…¥æ¢…ï¼Œæ½®æ¹¿çš„ç©ºæ°”å¯¹äºå·²ç»åœ¨ä¸Šæµ·ç”Ÿæ´»å¥½å¤šå¹´çš„æˆ‘è¿˜æ˜¯ä¼šæ„Ÿå—åˆ°ä¸é€‚ï¼Œä½†æ˜¯è¿™äº›ä¹Ÿæ— æ³•é˜»ç¢ KubeCon å¸¦ç»™æˆ‘çš„å…´å¥‹ä¸æ¿€åŠ¨ï¼Œå†µä¸”è¿™æ¬¡æ˜¯åœ¨å®¶é—¨å£ä¸¾è¡Œï¼Œ3ç«™åœ°é“å°±èƒ½åˆ°è¾¾äº†ä¸–åšä¸­å¿ƒã€‚\nå‚ä¸æœ¬æ¬¡å¤§ä¼šä¸ä»…ä»…æ˜¯å› ä¸ºå¯ä»¥æ¥è§¦åˆ°æœ€æ–°çš„ Kubernetes \u0026amp; Cloud Native å®è·µï¼Œæ›´æ˜¯å› ä¸ºå¯ä»¥ä¸å¾ˆå¤šç¥äº¤å·²ä¹…çš„æœ‹å‹ä¼šé¢ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥ä¸å¾ˆå¤šä¸šç•Œå¤§ç‰›é¢å¯¹é¢çš„äº¤æµï¼Œè·å–å®è´µçš„ç»éªŒã€‚\nå›½å†…äº‘åŸç”Ÿå¼€æºåŠ›é‡å¼ºåŠ² ä¼šè®®ç¬¬ä¸€å¤©ï¼Œå…ˆåå‚åŠ äº†èš‚èšé‡‘æœç»„ç»‡çš„ SOFAStack Workshop å’Œç”± CNCF, VMware, é˜¿é‡Œäº‘å’Œ PingCAP è”åˆä¸»åŠçš„ä¸­å›½åŸåˆ›CNCFé¡¹ç›®ç¤¾åŒºæ²™é¾™ï¼ŒåŒæ—¶åœ¨åˆä¼‘æ—¶å€™çŸ­æš‚çš„æ—å¬äº†åä¸ºä¸»åŠçš„ Apache ServiceComb Meetup ã€‚\nä½œä¸º ServiceMesher ç¤¾åŒºçš„ä¸€å‘˜ï¼Œä¸ä¼šè®®çš„ç»„ç»‡è€…åœ¨ç¤¾åŒºä¸­éƒ½å¾ˆç†Ÿæ‚‰äº†ï¼Œè™½ç„¶æ²¡æœ‰æ³¨å†Œ SOFAStack Workshop ä¼šè®®ï¼Œä½†ä¹Ÿå¾ˆè‡ªç„¶çš„æ··è¿›å»äº†ã€‚ä½œä¸ºé‡‘èçº§åˆ†å¸ƒå¼æ¡†æ¶ SOFAStack ï¼Œæ˜¯ç”¨äºå¿«é€Ÿæ„å»ºé‡‘èçº§åˆ†å¸ƒå¼æ¶æ„çš„ä¸€å¥—ä¸­é—´ä»¶ï¼Œä¹Ÿæ˜¯å»ºç«‹äºèš‚èšé‡‘æœæµ·é‡é‡‘èåœºæ™¯é”¤ç‚¼å‡ºæ¥çš„æœ€ä½³å®è·µã€‚è€Œæ­¤æ¬¡çš„ Workshop æ›´æ˜¯ç»è¿‡äº†ç²¾å¿ƒçš„å‡†å¤‡ï¼Œå‡†å¤‡äº†å……è¶³çš„ææ–™ï¼Œå¹¶åœ¨èš‚èšåŒå­¦çš„å¸®åŠ©äº†ä½¿ç”¨ SOFAStack å®è·µäº† ä½¿ç”¨ SOFAStack å¿«é€Ÿæ„å»ºå¾®æœåŠ¡ ã€ SOFABoot åŠ¨æ€æ¨¡å—å®è·µ ã€ ä½¿ç”¨ Seata ä¿éšœæ”¯ä»˜ä¸€è‡´æ€§ ã€ åŸºäº Serverless è½»æ¾æ„å»ºäº‘ä¸Šåº”ç”¨ å’Œ ä½¿ç”¨ CloudMesh è½»æ¾å®è·µ Service Mesh äº”ä¸ªdemoã€‚åœ¨ Service Mesh æ–¹é¢ï¼Œèš‚èšçš„åŒå­¦å¼‚å¸¸çš„æ´»è·ƒï¼Œæ˜¯ Istio ä¸­æ–‡æ–‡æ¡£ç¿»è¯‘å’Œ ServiceMesher ç¤¾åŒºçš„ä¸»è¦ç»„ç»‡è€…ã€‚\nã€Šæœªæ¥æ¶æ„-ä»æœåŠ¡åŒ–åˆ°äº‘åŸç”Ÿã€‹ä½œè€…æ•–å°å‰‘è€å¸ˆç°åœºç­¾å\nåˆé¥­åçŸ­æš‚æ—å¬äº†åä¸ºä¸»åŠçš„ Apache ServiceComb Meetup ï¼Œè™½ç„¶æ—¶é—´çŸ­æš‚ï¼Œåªæœ‰ä¸åˆ°1ä¸ªå°æ—¶ï¼Œä½†æ˜¯å¯¹äºå›½å†…è¿ä½œå¼€æºé¡¹ç›®ï¼Œå°¤å…¶æ˜¯ Apache é¡¹ç›®æœ‰ä¸ªæ›´æ·±çš„ç†è§£ï¼ŒåŒæ—¶è®©æˆ‘è”æƒ³åˆ°äº†ä¹‹å‰åœ¨ ã€Šä»å¼€æºå°ç™½åˆ° Apache Member ï¼Œé˜¿é‡Œå·¥ç¨‹å¸ˆçš„æˆé•¿ç¬”è®°ã€‹ é˜¿é‡Œå·´å·´æŠ€æœ¯ä¸“å®¶æœ›é™¶æˆä¸ºçš„æ–‡ç« ï¼Œä¸­å›½çš„å¼€æºè½¯ä»¶å’Œå¼€å‘è€…åœ¨å¼€æºé¢†åŸŸèµ·åˆ°è¶Šæ¥è¶Šé‡è¦çš„ä½œç”¨ã€‚\nä¸‹åˆå‚åŠ äº†ç”± CNCF, VMware, é˜¿é‡Œäº‘å’Œ PingCAP è”åˆä¸»åŠçš„ä¸­å›½åŸåˆ›CNCFé¡¹ç›®ç¤¾åŒºæ²™é¾™ï¼Œè†å¬äº† Harbor ã€ Dragonfly ã€ TiKV ä¸‰ä¸ªä¸­å›½åŸåˆ› CNCF é¡¹ç›®çš„åˆ†äº«ï¼ŒåŒæ—¶ æå“ã€Dan Kohn ç­‰å¤§ä½¬ä¹Ÿåœ¨ä¼šä¸Šå‘è¨€è¡¨è¾¾äº†å¯¹å›½å†… CNCF å¼€æºé¡¹ç›®çš„è‚¯å®šåŠæœŸå¾…ã€‚è€Œåœ¨ä¼šä¸Šä¹Ÿç»“è¯†äº†é˜¿é‡Œäº‘å®¹å™¨é•œåƒæœåŠ¡çš„å¼€å‘å°å“¥ï¼Œä½œä¸ºé˜¿é‡Œäº‘çš„èµ„æ·±ç”¨æˆ·ä¸å¼€å‘å°å“¥è¿›è¡Œäº†äº¤æµï¼Œäº†è§£ä¸€äº›å®¹å™¨é•œåƒæœåŠ¡æ–¹é¢çš„æ–°åŠŸèƒ½ï¼ŒåŒæ—¶ä¹Ÿååº”äº†åœ¨ä½¿ç”¨ä¸­é‡åˆ°çš„é—®é¢˜ï¼Œæ€»çš„æ¥è¯´æ”¶è·é¢‡ä¸°ã€‚\nç°åœºæƒŠç° Linux åŠ Git åˆ›å§‹äºº Linus Torvalds å¤§ä¼šç¬¬äºŒå¤©çš„ Keynote ä¸€ç›´æ˜¯ Linux åŸºé‡‘ä¼šå®£ä¼ å…¶ç†å¿µï¼Œæ„¿æ™¯ä»¥åŠèµåŠ©å•†è¿›è¡Œå¸‚åœºå®£ä¼ çš„é‡è¦æ´»åŠ¨ã€‚è€Œå½“å¤©æœ€è®©äººæ¿€åŠ¨çš„å°±æ˜¯ Linus åœ¨ Keynote åçš„ä¸€æ¬¡å˜‰å®¾è°ˆè¯ï¼Œæ¯«ä¸å¤¸å¼ çš„è¯´ï¼Œæˆ‘çš„å·¥ä½œå°±æ˜¯ Linus ç»™çš„ã€‚è€Œä¸ºäº†çœ‹åˆ°æ´»çš„ Linus ï¼Œå¾ˆå¤šäººä¸€å¤§æ—©å°±åœ¨ red hall çš„é—¨å‰æ’èµ·äº†é•¿é˜Ÿï¼Œç”±äºæ²¡æœ‰çœ‹å¥½åº§ä½çš„åˆ†å¸ƒï¼Œæˆ‘åªæ˜¯æ‰¾åˆ°äº†ä¸€ä¸ªæ¯”è¾ƒåçš„ä½ç½®ï¼Œä½†æ˜¯è¿˜æ˜¯å¯ä»¥çœ‹çš„æ¯”è¾ƒæ¸…æ¥šã€‚ Linus æœ¬äººè¿˜æ˜¯ååˆ†å¹½é»˜çš„ï¼Œåœ¨è°ˆè¯ä¸­æåˆ°äº† Linux 5.1-rc6 çš„ release è®¡åˆ’ï¼ŒåŒæ—¶è¿˜è¯¢é—®ç°æˆæœ‰å¤šå°‘äººæ˜¯ä»äº‹å†…æ ¸å¼€å‘çš„ï¼Œä¸è¿‡ç°åœºä¸¾æ‰‹çš„åŒå­¦å¹¶ä¸å¤šã€‚\nKeynote ä¸Šè¿˜æåˆ°äº†ä¸­å›½åœ¨æ•´ä¸ªäº‘åŸç”Ÿè¿åŠ¨ä¸­çš„å·¨å¤§è´¡çŒ®ï¼Œä¸­å›½çš„ K8s contributors å·²ç»åœ¨å…¨çƒæ‰€æœ‰è´¡çŒ®è€…ä¸­æ’åç¬¬äºŒï¼Œè¶…è¿‡ 10% çš„ CNCF ä¼šå‘˜æ¥è‡ªä¸­å›½ï¼Œ26%çš„ Kubernetes çš„è®¤è¯ä¾›åº”å•†æ¥è‡ªä¸­å›½ï¼ŒåŒæ—¶ä¹Ÿå…¬å¸ƒäº†èš‚èšé‡‘æœä½œä¸ºé»„é‡‘ä¼šå‘˜åŠ å…¥ CNCFã€‚\nå¹³å‡æ¯å°æ—¶ä¸€ä¸ªçš„åˆ†ç»„ä¼šè®®ï¼Œæˆ‘çš„æ—¥ç¨‹å®‰æ’çš„æ»¡æ»¡çš„ï¼Œä½†å°±è¿™æ ·è¿˜æ˜¯å‡ºç°äº†ç”±äºåˆ°æ™šäº†æ— æ³•è¿›å…¥åˆ†ç»„ä¼šè®®å®¤çš„æƒ…å†µï¼Œæ³¨æ„è¿™é‡Œä¸æ˜¯å› ä¸ºåˆ°æ™šäº†ä¸è®©è¿›ï¼Œè€Œæ˜¯è¿›å»éƒ½æ²¡æœ‰ç«™çš„åœ°æ–¹ï¼å¯è§äººæ°”ä¹‹æ—ºï¼è®©æˆ‘æœ‰äº†åƒæ˜¯ä¸Šå­¦æ—¶å€™ç©¿æ¢­åœ¨æ•™å­¦æ¥¼ï¼Œèµ¶äººæ°”é«˜çš„é€‰ä¿®è¯¾çš„é”™è§‰ã€‚\nè€Œåœ¨èµåŠ©å•†å±•ç¤ºåŒºä¹Ÿæœ‰ä¸å°‘çš„æ”¶è·ï¼Œä¸rancherã€kongã€jenkinsç­‰å¼€æºè½¯ä»¶çš„å¼€å‘è€…è¿›è¡Œäº†äº¤æµï¼ŒåŒæ—¶ä¹Ÿè·å¾—äº†ä¸å°‘å°ç¤¼å“ã€‚æœ€å¤§çš„æ”¶è·å°±æ˜¯åœ¨é˜¿é‡Œäº‘å±•å°ä¸å¼ ç£Šå¤§ç¥çš„åˆå½±ã€‚\nä¸å¼ ç£Šå¤§ç¥çš„åˆå½±\nServiceMesher ç¤¾åŒºçš„å£®å¤§ å¹³æ—¶éƒ½æ˜¯åœ¨ç½‘ä¸Šä¸ç¤¾åŒºçš„æœ‹å‹ä»¬è¿›è¡Œäº¤æµï¼Œè®¨è®ºæŠ€æœ¯ï¼Œäº¤æµç»éªŒã€‚è€Œ KubeCon å°±å˜æˆäº†ä¸€åœºç½‘å‹é¢åŸºå¤§ä¼šï¼Œè§åˆ°äº†å¾ˆå¤šæœ‰è¿‡äº¤æµå’Œå¸®åŠ©è¿‡æˆ‘çš„æœ‹å‹ï¼ŒåŒ…æ‹¬ Jimmy ã€ å°å‰‘ ã€ç§€é¾™è€å“¥\u0026hellip;ç­‰ç­‰ï¼ŒåŒæ—¶ä¹Ÿè®¤è¯†äº†ä¸å°‘æ–°æœ‹å‹ã€‚ä¸å»å¹´11æœˆçš„ KubeCon ç›¸æ¯”ï¼Œç¤¾åŒºçš„æœ‹å‹è¶Šæ¥è¶Šå¤šï¼Œåœ¨çŸ­çŸ­åŠå¹´å†… Service Mesh ç›¸å…³ä¹¦ç±å·²ç»å‡ºç‰ˆäº†4æœ¬ï¼Œè€Œä½œè€…éƒ½æ˜¯ç¤¾åŒºæˆå‘˜ï¼Œå¯è§ç¤¾åŒºçš„æ´»è·ƒã€‚\nå†™åœ¨æœ€å æ­£å¦‚ KubeCon ç¬¬ä¸‰å¤© Keynote ä¸Šï¼Œé˜¿é‡Œäº‘æ™ºèƒ½å®¹å™¨å¹³å°è´Ÿè´£äººä¸å®‡çš„è¯ï¼šKubernetes æ­£å½“æ—¶ï¼Œäº‘åŸç”Ÿæœªæ¥å¯æœŸ ã€‚åœ¨ KubeCon ä¸Šçœ‹åˆ°äº‘åŸç”ŸåŠå¼€æºè½¯ä»¶çš„å‘å±•é€Ÿåº¦è¿…çŒ›ï¼Œå„å¤§å‚å•†ä¹Ÿéƒ½åœ¨æœ€è¿‘å‡ å¹´ç»„å»ºäº†è‡ªå·±çš„å¼€æºå›¢é˜Ÿï¼Œåœ¨ä½¿ç”¨å¼€æºè½¯ä»¶è·å–ä¾¿åˆ©çš„åŒæ—¶ä¹Ÿåœ¨å›é¦ˆç¤¾åŒºï¼Œè¿™ä¹Ÿæ˜¯è®©ç«äº‰å¯¹æ‰‹å…±åŒä¸ºä¸€æ¬¾å¼€æºè½¯ä»¶è¿›è¡Œè´¡çŒ®çš„åŸå› ã€‚ç›¸ä¿¡éšç€å¼€æºè¿åŠ¨åœ¨å›½å†…çš„æ·±å…¥ï¼Œå°†ä¼šå‡ºç°è¶Šæ¥è¶Šå¤šä¸­å›½åŸåˆ›çš„å¼€æºé¡¹ç›®ï¼Œä¹Ÿä¼šæœ‰æ›´å¤šçš„å¼€å‘è€…åŠ å…¥åˆ°å¼€æºé¡¹ç›®ä¸­ï¼Œåœ¨è´¡çŒ®çš„åŒæ—¶æå‡è‡ªå·±çš„æŠ€æœ¯æ°´å¹³ã€‚\n","date":1562033898,"expirydate":-62135596800,"kind":"page","lang":"zh","lastmod":1562033898,"objectID":"1e931237635191ed55923a5c2ff5e9ea","permalink":"https://guoxudong.io/post/kubecon-2019/","publishdate":"2019-07-02T10:18:18+08:00","relpermalink":"/post/kubecon-2019/","section":"post","summary":"2019å¹´6æœˆ24-26æ—¥ï¼ŒKubeCon + CloudNativeCon + Open Source Summitå¤§ä¼šåœ¨ä¸Šæµ·ä¸–åšä¸­å¿ƒä¸¾è¡Œã€‚æœ¬æ¬¡å¤§ä¼šè§„æ¨¡ç©ºå‰ï¼Œé¢„è®¡æœ‰è¶…è¿‡40ä¸ªå›½å®¶ï¼Œ3500å¤šåäº‘åŸç”Ÿã€å¼€æºé¢†åŸŸçš„å¼€å‘è€…å‚åŠ ï¼Œé—¨ç¥¨æ›´æ˜¯æ—©æ—©å”®ç½„ã€‚ä½œä¸ºä¸€åäº‘åŸç”Ÿåº”ç”¨çš„ä½¿ç”¨è€…ä¸å¼€å‘è€…ï¼Œæˆ‘ä¹ŸæŠ¥åå‚ä¸äº†è¿™æ¬¡å¤§ä¼šã€‚","tags":["äº‘åŸç”Ÿ"],"title":"Kubecon 2019 è§é—»ï¼šäº‘åŸç”Ÿæœªæ¥å¯æœŸ","type":"post"},{"authors":["éƒ­æ—­ä¸œ"],"categories":null,"content":"","date":1561939200,"expirydate":-62135596800,"kind":"page","lang":"zh","lastmod":1561939200,"objectID":"711b3f39486ff5b2c784fcff46a4397a","permalink":"https://guoxudong.io/publication/wx_contact/","publishdate":"2019-07-01T00:00:00Z","relpermalink":"/publication/wx_contact/","section":"publication","summary":"","tags":null,"title":"æ‰«ç å…³æ³¨","type":"publication"},{"authors":["éƒ­æ—­ä¸œ"],"categories":null,"content":" å¾®ä¿¡ è¦æ·»åŠ å¾®ä¿¡ï¼Œè¯·æ³¨æ˜å§“å-å…¬å¸ä¿¡æ¯\nGitHub https://github.com/sunny0826\né‚®ç®± sunnydog0826@gmail.com\nå‡¯äº¬æŠ€æœ¯å›¢é˜Ÿ https://my.oschina.net/keking\nå¾®ä¿¡å…¬ä¼—å· æ‰«ç å…³æ³¨\n","date":1561939200,"expirydate":-62135596800,"kind":"page","lang":"zh","lastmod":1561939200,"objectID":"39411413e0aa0daf78edc55b6eb471fd","permalink":"https://guoxudong.io/publication/contact_me/","publishdate":"2019-07-01T00:00:00Z","relpermalink":"/publication/contact_me/","section":"publication","summary":"å¾®ä¿¡ è¦æ·»åŠ å¾®ä¿¡ï¼Œè¯·æ³¨æ˜å§“å-å…¬å¸ä¿¡æ¯ GitHub https://github.com/sunny0826 é‚®ç®± sunnydog0826@gmail.com å‡¯äº¬æŠ€æœ¯å›¢é˜Ÿ https://my.oschina.net/keking å¾®ä¿¡å…¬ä¼—å· æ‰«ç å…³æ³¨","tags":null,"title":"è”ç³»æ–¹å¼","type":"publication"},{"authors":["éƒ­æ—­ä¸œ"],"categories":["kustomize"],"content":" å‰è¨€ åœ¨å‰é¢çš„æ–‡ç« ä¸­å·²ç»ä»‹ç»äº† kustomize æ˜¯ä»€ä¹ˆï¼Œä»¥åŠå¦‚ä½•å¼€å§‹ä½¿ç”¨å’Œå¦‚ä½•ç®€å•çš„åœ¨ CI/CD ä¸­ä½¿ç”¨ï¼Œæœ¬ç¯‡æ–‡ç« å°†ä¼šä»‹ç» kustomize çš„æ ¸å¿ƒæ–‡ä»¶ kustomization.yamlã€‚\nå¦å¤–ï¼Œåšä¸»å·²ç»å‘ kustomize è´¡çŒ®äº†ä¸­æ–‡æ–‡æ¡£ï¼Œå·²è¢«å®˜æ–¹é‡‡çº³ï¼Œç°åœ¨åœ¨ kustomize ä¸­çš„ docs/zh ç›®å½•ä¸­å°±å¯çœ‹åˆ°ï¼Œç¿»è¯‘çš„ä¸å¥½çš„åœ°æ–¹æ¬¢è¿æŒ‡æ­£ã€‚åŒæ—¶ä¹Ÿåœ¨ GitHub ä¸Šæ–°å»ºäº†ä¸€ä¸ª åä¸º kustomize-lab çš„ repo ç”¨äºæ¼”ç¤º kustomize çš„å„ç§ç”¨æ³•åŠæŠ€å·§ï¼Œæœ¬æ–‡ä¸­ä»‹ç»çš„å†…å®¹ä¹Ÿä¼šåŒæ­¥æ›´æ–°åˆ°è¯¥ repo ä¸­ï¼Œæ¬¢è¿ forkã€starã€PRã€‚\nkustomization.yaml çš„ä½œç”¨  Kustomize å…è®¸ç”¨æˆ·ä»¥ä¸€ä¸ªåº”ç”¨æè¿°æ–‡ä»¶ ï¼ˆYAML æ–‡ä»¶ï¼‰ä¸ºåŸºç¡€ï¼ˆBase YAMLï¼‰ï¼Œç„¶åé€šè¿‡ Overlay çš„æ–¹å¼ç”Ÿæˆæœ€ç»ˆéƒ¨ç½²åº”ç”¨æ‰€éœ€çš„æè¿°æ–‡ä»¶ã€‚\n æœ‰å‰é¢çš„æ–‡ç« ã€Šä½¿ç”¨ Kustomize å¸®ä½ ç®¡ç† kubernetes åº”ç”¨ï¼ˆäºŒï¼‰ï¼š Kustomize çš„ä½¿ç”¨æ–¹æ³•ã€‹ä¸­å·²ç»ä»‹ç»äº†ï¼Œæ¯ä¸ª base æˆ– overlays ä¸­éƒ½å¿…é¡»è¦æœ‰ä¸€ä¸ª kustomization.yamlï¼Œè¿™é‡Œæˆ‘ä»¬çœ‹ä¸€ä¸‹å®˜æ–¹ç¤ºä¾‹ helloWorld ä¸­çš„ kustomization.yamlï¼š\ncommonLabels: app: hello resources: - deployment.yaml - service.yaml - configMap.yaml  å¯ä»¥çœ‹åˆ°è¯¥é¡¹ç›®ä¸­åŒ…å«3ä¸ª resources ï¼Œ deployment.yamlã€service.yaml ã€ configMap.yamlã€‚\n. â””â”€â”€ helloWorld â”œâ”€â”€ configMap.yaml â”œâ”€â”€ deployment.yaml â”œâ”€â”€ kustomization.yaml â””â”€â”€ service.yaml  ç›´æ¥æ‰§è¡Œå‘½ä»¤ï¼š\nkustomize build helloWorld  å°±å¯ä»¥çœ‹åˆ°ç»“æœäº†ï¼š\napiVersion: v1 data: altGreeting: Good Morning! enableRisky: \u0026quot;false\u0026quot; kind: ConfigMap metadata: labels: app: hello name: the-map image: caption: \u0026quot;Image from: [**Pexels**](https://www.pexels.com)\u0026quot; focal_point: \u0026quot;\u0026quot; preview_only: false --- apiVersion: v1 kind: Service metadata: labels: app: hello name: the-service spec: ports: - port: 8666 protocol: TCP targetPort: 8080 selector: app: hello deployment: hello type: LoadBalancer image: caption: \u0026quot;Image from: [**Pexels**](https://www.pexels.com)\u0026quot; focal_point: \u0026quot;\u0026quot; preview_only: false --- apiVersion: apps/v1 kind: Deployment metadata: labels: app: hello name: the-deployment spec: replicas: 3 selector: matchLabels: app: hello template: metadata: labels: app: hello deployment: hello spec: containers: - command: - /hello - --port=8080 - --enableRiskyFeature=$(ENABLE_RISKY) env: - name: ALT_GREETING valueFrom: configMapKeyRef: key: altGreeting name: the-map - name: ENABLE_RISKY valueFrom: configMapKeyRef: key: enableRisky name: the-map image: monopole/hello:1 name: the-container ports: - containerPort: 8080  ä»ä¸Šé¢çš„ç»“æœå¯ä»¥çœ‹å¤§ kustomize é€šè¿‡ kustomization.yaml å°†3ä¸ª resources è¿›è¡Œäº†å¤„ç†ï¼Œç»™ä¸‰ä¸ª resources æ·»åŠ äº†å…±åŒçš„ labels app: hello ã€‚è¿™ä¸ªç¤ºä¾‹å±•ç¤ºäº† kustomization.yaml çš„ä½œç”¨ï¼šå°†ä¸åŒçš„ resources è¿›è¡Œæ•´åˆï¼ŒåŒæ—¶ä¸ºä»–ä»¬åŠ ä¸Šç›¸åŒçš„é…ç½®ã€‚\nè¿›é˜¶ä½¿ç”¨ ä¸Šé¢åªä¸è¿‡æ˜¯ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ï¼Œä¸‹é¢å°†ç»“åˆå®é™…æƒ…å†µåˆ†äº«ä¸€äº›æ¯”è¾ƒå®ç”¨çš„ç”¨æ³•\næ ¹æ®ç¯å¢ƒç”Ÿæˆä¸åŒé…ç½® åœ¨å®é™…çš„ä½¿ç”¨ä¸­ï¼Œä½¿ç”¨æœ€å¤šçš„å°±æ˜¯ä¸ºä¸åŒçš„ç¯å¢ƒé…ç½®ä¸åŒçš„ deploy.yamlï¼Œè€Œä½¿ç”¨ kustomize å¯ä»¥æŠŠé…ç½®æ‹†åˆ†ä¸ºå¤šä¸ªå°çš„ patch ï¼Œç„¶åé€šè¿‡ kustomize æ¥è¿›è¡Œç»„åˆã€‚è€Œæ ¹æ®ç¯å¢ƒçš„ä¸åŒï¼Œæ¯ä¸ª patch éƒ½å¯èƒ½ä¸åŒï¼ŒåŒ…æ‹¬åˆ†é…çš„èµ„æºã€è®¿é—®çš„æ–¹å¼ã€éƒ¨ç½²çš„èŠ‚ç‚¹éƒ½å¯ä»¥è‡ªç”±çš„å®šåˆ¶ã€‚\n. â”œâ”€â”€ flask-env â”‚ â”œâ”€â”€ README.md â”‚ â”œâ”€â”€ base â”‚ â”‚ â”œâ”€â”€ deployment.yaml â”‚ â”‚ â”œâ”€â”€ kustomization.yaml â”‚ â”‚ â””â”€â”€ service.yaml â”‚ â””â”€â”€ overlays â”‚ â”œâ”€â”€ dev â”‚ â”‚ â”œâ”€â”€ healthcheck_patch.yaml â”‚ â”‚ â”œâ”€â”€ kustomization.yaml â”‚ â”‚ â””â”€â”€ memorylimit_patch.yaml â”‚ â””â”€â”€ prod â”‚ â”œâ”€â”€ healthcheck_patch.yaml â”‚ â”œâ”€â”€ kustomization.yaml â”‚ â””â”€â”€ memorylimit_patch.yaml  è¿™é‡Œå¯ä»¥çœ‹åˆ°é…ç½®åˆ†ä¸ºäº† base å’Œ overlaysï¼Œ overlays åˆ™æ˜¯ç»§æ‰¿äº† base çš„é…ç½®ï¼ŒåŒæ—¶æ·»åŠ äº†è¯¸å¦‚ healthcheck å’Œ memorylimit ç­‰ä¸åŒçš„é…ç½®ï¼Œé‚£ä¹ˆæˆ‘ä»¬åˆ†åˆ«çœ‹ä¸€ä¸‹ base å’Œ overlays ä¸­ kustomization.yaml çš„å†…å®¹\n base\ncommonLabels: app: test-cicd resources: - service.yaml - deployment.yaml   base ä¸­çš„ kustomization.yaml ä¸­å®šä¹‰äº†ä¸€äº›åŸºç¡€é…ç½®\n overlays\nbases: - ../../base patchesStrategicMerge: - healthcheck_patch.yaml - memorylimit_patch.yaml namespace: devops-dev   overlays ä¸­çš„ kustomization.yaml åˆ™æ˜¯åŸºäº base æ–°å¢äº†ä¸€äº›ä¸ªæ€§åŒ–çš„é…ç½®ï¼Œæ¥è¾¾åˆ°ç”Ÿæˆä¸åŒç¯å¢ƒçš„ç›®çš„ã€‚\næ‰§è¡Œå‘½ä»¤\nkustomize build flask-env/overlays/dev  ç»“æœ\napiVersion: v1 kind: Service metadata: labels: app: test-cicd name: test-cicd namespace: devops-dev spec: ports: - name: http port: 80 targetPort: 80 selector: app: test-cicd type: ClusterIP image: caption: \u0026quot;Image from: [**Pexels**](https://www.pexels.com)\u0026quot; focal_point: \u0026quot;\u0026quot; preview_only: false --- apiVersion: apps/v1 kind: Deployment metadata: labels: app: test-cicd name: test-cicd namespace: devops-dev spec: replicas: 1 selector: matchLabels: app: test-cicd template: metadata: labels: app: test-cicd version: 0.0.3 spec: containers: - env: - name: ENV value: dev image: guoxudongdocker/flask-python:latest imagePullPolicy: Always livenessProbe: httpGet: path: / port: 80 initialDelaySeconds: 10 periodSeconds: 10 successThreshold: 1 timeoutSeconds: 20 name: test-cicd readinessProbe: httpGet: path: / port: 80 initialDelaySeconds: 10 periodSeconds: 10 successThreshold: 1 timeoutSeconds: 20 resources: limits: cpu: 300m memory: 500Mi requests: cpu: 300m memory: 500Mi volumeMounts: - mountPath: /etc/localtime name: host-time imagePullSecrets: - name: registry-pull-secret volumes: - hostPath: path: /etc/localtime name: host-time  å¯ä»¥çœ‹åˆ°åŒ…æ‹¬ replicasã€limitsã€requestsã€env ç­‰ dev ä¸­ä¸ªæ€§çš„é…ç½®éƒ½å·²ç»å‡ºç°åœ¨äº†ç”Ÿæˆçš„ yaml ä¸­ã€‚ç”±äºç¯‡å¹…æœ‰é™ï¼Œè¿™é‡Œæ²¡æœ‰æŠŠæ‰€æœ‰çš„é…ç½®æœ‰ç½—åˆ—å‡ºæ¥ï¼Œéœ€è¦çš„å¯ä»¥å» GitHub ä¸Šè‡ªå–ã€‚\nç»“è¯­ ä¸Šé¢æ‰€æœ‰çš„ kustomize build dir/ éƒ½å¯ä»¥ä½¿ç”¨ kubectl apply -k dir/ å®ç°ï¼Œä½†æ˜¯éœ€è¦ v14.0 ç‰ˆä»¥ä¸Šçš„ kubectlï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå…¶å®æˆ‘ä»¬åœ¨é›†æˆåˆ° CI/CD ä¸­çš„æ—¶å€™ï¼Œç”šè‡³éƒ½ä¸éœ€è¦ç”¨æ¥ kustomize å‘½ä»¤é›†ï¼Œæœ‰ kubectl å°±å¤Ÿäº†ã€‚\nç”±äºç¯‡å¹…æœ‰é™ï¼Œè¿™é‡Œæ²¡æ³•å§æ‰€æœ‰ kustomization.yaml çš„ç”¨é€”éƒ½ç½—åˆ—å‡ºæ¥ï¼Œä¸è¿‡å¯ä»¥åœ¨å®˜æ–¹æ–‡æ¡£ä¸­æ‰¾åˆ°æˆ‘æäº¤çš„ä¸­æ–‡ç¿»è¯‘ç‰ˆ kustomization.yamlï¼Œå¯ä»¥ç›´æ¥å»å®˜æ–¹ GitHub æŸ¥çœ‹ã€‚åŒæ—¶ kustomize-lab ä¼šæŒç»­æ›´è¡Œï¼Œæ•¬è¯·å…³æ³¨ã€‚\n","date":1558587012,"expirydate":-62135596800,"kind":"page","lang":"zh","lastmod":1558587012,"objectID":"22fb7732ca05c3c498912ca482816795","permalink":"https://guoxudong.io/post/kustomize-4/","publishdate":"2019-05-23T12:50:12+08:00","relpermalink":"/post/kustomize-4/","section":"post","summary":"æœ¬ç¯‡ä¸ºç³»åˆ—æ–‡ç« ç¬¬å››ç¯‡ï¼Œå°†ç®€è¿° kustomize çš„æ ¸å¿ƒé…ç½®æ–‡ä»¶ kustomization.yaml","tags":["kubernetes","kustomize","å·¥å…·"],"title":"ä½¿ç”¨ Kustomize å¸®ä½ ç®¡ç† kubernetes åº”ç”¨ï¼ˆå››ï¼‰ï¼šç®€è¿°æ ¸å¿ƒé…ç½® kustomization.yaml","type":"post"},{"authors":["éƒ­æ—­ä¸œ"],"categories":["devops"],"content":" å‰è¨€ å…¬å¸ä¹‹å‰ä¸€ç›´åœ¨ä½¿ç”¨ Jenkins ä½œä¸º CI/CD å·¥å…·ï¼Œ Jenkins éå¸¸å¼ºå¤§ï¼Œå®ƒå®Œæˆäº†å‡ ä¹æ‰€æœ‰ CI/CD çš„å·¥ä½œï¼Œå¹¶ä¸”åº”ç”¨äºæ•´ä¸ªå›¢é˜Ÿæœ‰å¥½é•¿ä¸€æ®µæ—¶é—´äº†ã€‚ä½†æ˜¯éšç€å…¬å¸æ¨èæ•°å­—åŒ–ã€æ™ºæ…§åŒ–ï¼Œä»¥åŠæœåŠ¡å®¹å™¨åŒ–çš„æ¨è¿›ï¼Œ Jenkins çš„ä¸€äº›å¼Šç«¯ä¹Ÿå‡¸æ˜¾äº†å‡ºæ¥ï¼š\n é‡é‡çº§ï¼š Jenkins åŠŸèƒ½ååˆ†é½å…¨ï¼Œå‡ ä¹å¯ä»¥åšæ‰€æœ‰çš„äº‹æƒ…ã€‚ä½†æ˜¯è¿™ä¹Ÿæ˜¯ä»–çš„ä¸€ä¸ªå¼Šç«¯ï¼Œè¿‡äºé‡é‡çº§ï¼Œæœ‰æ—¶å€™å¾€å¾€ä¸€ä¸ªå°çš„ä¿®æ”¹éœ€è¦æ”¹åŠ¨è®¸å¤šåœ°æ–¹ï¼Œå‡çº§\\ä¸‹è½½æ’ä»¶åéœ€è¦è¿›è¡Œé‡å¯ç­‰ã€‚ å‡çº§ä¸æ˜“ï¼š åœ¨ä¸€äº›å®‰å…¨ Jenkins ç›¸å…³çš„å®‰å…¨æ¼æ´è¢«å…¬å¼€åï¼Œæˆ‘ä»¬ä¼šå¯¹ Jenkins è¿›è¡Œå‡çº§ï¼Œä½†è¿™ä¹Ÿä¸æ˜¯ä¸€ä»¶å®¹æ˜“çš„äº‹ã€‚ä¹‹å‰å°±å‡ºç°è¿‡å‡çº§\\é‡å¯åï¼Œæ‰€æœ‰ job ä¸¢å¤±ï¼Œè™½ç„¶æˆ‘ä»¬æ‰€æœ‰é¡¹ç›®é…ç½®éƒ½æ˜¯ä»¥ Jenkinsfile çš„å½¢å¼ç»Ÿä¸€å­˜å‚¨ï¼Œä½†æ˜¯æ¯ä¸ª job éƒ½éœ€è¦é‡æ–°é‡æ–°åˆ›å»ºï¼ŒåŒ…æ‹¬æ¯ä¸ª job çš„æƒé™\u0026hellip;.._(Â´à½€`ã€ âˆ )_ æƒé™æ§åˆ¶å¤æ‚ï¼š è¿™å…¶å®ä¹Ÿæ˜¯ Jenkins çš„ä¸€å¤§ä¼˜åŠ¿ï¼Œå¯ä»¥ç²¾ç¡®æ§åˆ¶æ¯ä¸ªç”¨æˆ·çš„æƒé™ï¼Œä½†æ˜¯éœ€è¦èŠ±è´¹æ›´å¤šæ—¶é—´å»é…ç½®ï¼Œæ—¶é—´é•¿äº†ä¹Ÿä¼šå‡ºç°æƒé™æ··ä¹±çš„é—®é¢˜ã€‚ UI ç•Œé¢ï¼š è¿™ä¸ªå…¶å®æ˜¯åæ§½æœ€å¤šçš„éƒ¨åˆ†ï¼Œè™½ç„¶æœ‰è¯¸å¦‚ï¼šBlue Ocean è¿™æ ·çš„æ’ä»¶æ¥å±•ç¤º pipeline ï¼Œä½†æ˜¯è¿˜æ˜¯æ²¡æœ‰ä»æ ¹æœ¬æ”¹å˜å®ƒç®€é™‹çš„ UI ç•Œé¢ã€‚  é‚£ä¹ˆä¸ºä»€ä¹ˆé€‰æ‹©ä½¿ç”¨ Drone å‘¢ï¼Ÿ\nå…¶å®åœ¨ GitHub ä¸Šæäº¤ PR åï¼Œå¤§éƒ¨åˆ†å¼€æºé¡¹ç›®éƒ½ä¼šä½¿ç”¨ travis-ci å¯¹æäº¤çš„ä»£ç è¿›è¡Œ CI åŠæ£€æŸ¥ï¼Œè€Œå¦‚æœæ˜¯ Kubernetes ç›¸å…³çš„é¡¹ç›®ï¼Œåˆ™ä¼šä½¿ç”¨ prow è¿›è¡Œ CIã€‚ä½†æ˜¯ travis-ci åªèƒ½ç”¨äº GitHub ï¼Œåœ¨å¯»æ‰¾ç±»ä¼¼é¡¹ç›®çš„æ—¶å€™ï¼Œ Drone è¿›å…¥äº†æˆ‘çš„è§†é‡ã€‚\nå¤§é“è‡³ç®€ã€‚å’Œ Jenkins ç›¸æ¯”ï¼Œ Drone å°±è½»é‡çš„å¤šäº†ï¼Œä»åº”ç”¨æœ¬èº«çš„å®‰è£…éƒ¨ç½²åˆ°æµæ°´çº¿çš„æ„å»ºéƒ½ç®€æ´çš„å¤šã€‚ç”±äºæ˜¯å’Œæºç ç®¡ç†ç³»ç»Ÿç›¸é›†æˆï¼Œæ‰€ä»¥ Drone å¤©ç”Ÿå°±çœå»äº†å„ç§è´¦æˆ·\\æƒé™çš„é…ç½®ï¼Œç›´æ¥ä¸ gitlab ã€ github ã€ Bitbucket è¿™æ ·çš„æºç ç®¡ç†ç³»ç»Ÿæ“ä½œæºä»£ç çš„æƒé™ä¸€è‡´ã€‚æ­£å¦‚å®ƒå®˜ç½‘ä¸Šå†™çš„é‚£æ ·ï¼š\n Any Source Code Manager\nDrone integrates seamlessly with multiple source code management systems, including GitHub, GitHubEnterprise, Bitbucket, and GitLab.\nAny Platform\nDrone natively supports multiple operating systems and architectures, including Linux x64, ARM, ARM64 and Windows x64.\nAny Language\nDrone works with any language, database or service that runs inside a Docker container. Choose from thousands of public Docker images or provide your own.\n Drone å¤©ç”Ÿæ”¯æŒä»»ä½•æºç ç®¡ç†å·¥å…·ã€ä»»ä½•å¹³å°å’Œä»»ä½•è¯­è¨€ã€‚\nè€Œå†™è¿™ç¯‡æ–‡ç« çš„ç›®çš„ï¼Œå¹¶ä¸æ˜¯è¦å¹æ§è¿™ä¸ªå·¥å…·æœ‰å¤šä¹ˆçš„å¥½ç”¨ï¼Œè€Œæ˜¯è¦æ€»ç»“åœ¨æ­å»º drone å’Œä½¿ç”¨æ—¶å€™éœ€è¦çš„å„ç§å‘ï¼Œå¸®åŠ©è¯»è€…ç»•è¿‡è¿™äº›å‘ã€‚\nå£°æ˜ é‰´äºåœ¨ä½¿ç”¨ Drone CI ä¸­ï¼Œé‡åˆ°çš„å„ç§å‘éƒ½å’Œ Drone çš„ç‰ˆæœ¬æœ‰å…³ï¼Œè¿™é‡Œé¦–å…ˆå£°æ˜æˆ‘ä½¿ç”¨çš„ Drone ç‰ˆæœ¬ä¸º1.1ï¼Œä½¿ç”¨0.8ç‰ˆæœ¬çš„åŒå­¦è¯·ç»•é“ã€‚\næ­å»º Drone è¿™é‡Œè¦è¯´çš„å°±æ˜¯åœ¨ä½¿ç”¨ drone ä¸­é‡åˆ°çš„ç¬¬ä¸€ä¸ªå‘ï¼Œåœ¨æœ€åˆæ­£å‡†å¤‡æ­å»º drone çš„æ—¶å€™ Google äº†å¾ˆå¤šç›¸å…³çš„ blog ï¼Œå¤§éƒ¨åˆ† blog ï¼ˆåŒ…æ‹¬æŸäº› medium.com ä¸Šé¢è¿‘æœŸçš„è‹±æ–‡ blogï¼‰ æ¨èçš„å®‰è£…æ–¹å¼éƒ½æ˜¯ä½¿ç”¨ docker-composeï¼Œè€Œæ— ä¸€ä¾‹å¤–çš„éƒ½å¤±è´¥äº†\u0026hellip;èµ°æŠ•æ— è·¯ä¹‹ä¸‹ï¼Œæˆ‘å›åˆ°äº†å®˜ç½‘çš„æ–‡æ¡£ï¼Œå‘ç°1.0ä¹‹åè®¸å¤šå‚æ•°éƒ½å‘ç”Ÿäº†å˜åŒ–ï¼Œå¹¶ä¸”å®˜æ–¹æ¨èä½¿ç”¨ docker çš„æ–¹å¼è¿è¡Œ Droneã€‚\næ‰€ä»¥åœ¨ä½¿ç”¨ä»»ä½•å¼€æºè½¯ä»¶ä¹‹å‰éƒ½è¦å»é˜…è¯»å®ƒçš„æ–‡æ¡£ï¼Œä¸è¦è·Ÿç€ä¸€ç¯‡ blog å°±å¼€å§‹äº†ï¼ˆåŒ…æ‹¬æˆ‘çš„ï¼‰ï¼Œè¿™æ ·ä¼šå°‘è¸©å¾ˆå¤šå‘ï¼ï¼ï¼\nè¿™é‡Œä»¥ gitlab ä¸ºä¾‹ï¼Œå±•ç¤ºç½‘ä¸Šç‰ˆæœ¬å¯åŠ¨å‚æ•°å’Œå®é™…å‚æ•°çš„ä¸åŒï¼š\n   ä½œç”¨ å„ç§blog å®˜ç½‘æ–‡æ¡£     è®¾ç½® Drone çš„ç®¡ç†å‘˜ DRONE_ADMIN=admin DRONE_USER_CREATE=username:admin,admin:true   è®¾ç½®GitLabçš„åŸŸå DRONE_GITLAB_URL DRONE_SERVER_HOST   GitLabçš„Applicationä¸­çš„key DRONE_GITLAB_CLIENT DRONE_GITLAB_CLIENT_ID   GitLabçš„Applicationä¸­çš„secret DRONE_GITLAB_SECRET DRONE_GITLAB_CLIENT_SECRET   Drone åŸŸå DRONE_HOST DRONE_GITLAB_SERVER    ä¸Šé¢åªæ˜¯åˆ—ä¸¾äº†éƒ¨åˆ†å®˜æ–¹æ–‡æ¡£å’Œç½‘ä¸Šæµäº§ç‰ˆæœ¬çš„ä¸åŒï¼Œæ‰€ä»¥åœ¨ä½¿ç”¨ä¹‹å‰ä¸€å®šè¦ä»”ç»†é˜…è¯»å®˜æ–¹æ–‡æ¡£ã€‚ä¸‹é™„è¿è¡Œ drone çš„å‘½ä»¤ï¼š\ndocker run \\ --volume=/var/run/docker.sock:/var/run/docker.sock \\ --volume=/var/lib/drone:/data \\ --env=DRONE_GIT_ALWAYS_AUTH=false \\ --env=DRONE_GITLAB_SERVER={your-gitlab-url} \\ # gitlab çš„ URL --env=DRONE_GITLAB_CLIENT_ID={your-gitlab-applications-id} \\ #GitLabçš„Applicationä¸­çš„id --env=DRONE_GITLAB_CLIENT_SECRET={your-gitlab-applicati-secret} \\ #GitLabçš„Applicationä¸­çš„secret --env=DRONE_SERVER_HOST={your-drone-url} \\ # drone çš„URl --env=DRONE_SERVER_PROTO=http \\ --env=DRONE_TLS_AUTOCERT=false \\ --env=DRONE_USER_CREATE=username:{your-admin-username},admin:true \\ # Droneçš„ç®¡ç†å‘˜ --publish=8000:80 \\ --publish=443:443 \\ --restart=always \\ --detach=true \\ --name=drone \\ drone/drone:1.1  å…³äº gitlab Application çš„é…ç½®å’Œ Drone å…¶ä»–å‚æ•°å«ä¹‰è¯·å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼Œè¿™é‡Œåªå±•ç¤ºå•èŠ‚ç‚¹åŠçš„è¿è¡Œæ–¹å¼ã€‚\næ ¸å¿ƒæ–‡ä»¶ .drone.yml è¦ä½¿ç”¨ Drone åªéœ€åœ¨é¡¹ç›®æ ¹åˆ›å»ºä¸€ä¸ª .drone.yml æ–‡ä»¶å³å¯ï¼Œè¿™ä¸ªæ˜¯ Drone æ„å»ºè„šæœ¬çš„é…ç½®æ–‡ä»¶ï¼Œå®ƒéšé¡¹ç›®ä¸€å—è¿›è¡Œç‰ˆæœ¬ç®¡ç†ï¼Œå¼€å‘è€…ä¸éœ€è¦é¢å¤–å†å»ç»´æŠ¤ä¸€ä¸ªé…ç½®è„šæœ¬ã€‚å…¶å®ç°ä»£ CI ç¨‹åºéƒ½æ˜¯è¿™ä¹ˆåšäº†ï¼Œè¿™ä¸ªä¸»è¦æ˜¯ç›¸å¯¹äº Jekins æ¥è¯´çš„ã€‚è™½ç„¶ Jekins ä¹Ÿæœ‰æ’ä»¶æ”¯æŒï¼Œä½†æ¯•ç«Ÿè¿˜æ˜¯éœ€è¦é…ç½®ã€‚\n å€¼å¾—æ³¨æ„çš„äº‹è¿™ä¸ªæ–‡ä»¶æ—¶ .drone.ymlï¼Œç”±äº Kubernetes ä½¿ç”¨çš„å¤šäº†ï¼Œç¬¬ä¸€æ¬¡åˆ›å»ºäº†ä¸€ä¸ª .drone.yaml æ–‡ä»¶ï¼Œå¯¼è‡´æ€ä¹ˆéƒ½è·å–ä¸åˆ°é…ç½®\u0026hellip;_(Â´à½€`ã€ âˆ )_\u0026hellip; YAML å·¥ç¨‹å¸ˆçŸ³é”¤äº†\u0026hellip;\n è¿™é‡Œæ”¾ä¸€ä¸ª Java çš„ .drone.yml ï¼Œè¿™ä¸ªé¡¹ç›®æ˜¯ fork åˆ«äººçš„é¡¹ç›®ç”¨ä½œæ¼”ç¤ºï¼Œè®°å¾—è¦ä¿®æ”¹ deployment.yaml ä¸­çš„é•œåƒä»“åº“åœ°å€ä¿®æ”¹ä¸ºè‡ªå·±çš„ç§æœ‰ä»“åº“ã€‚\nç¤ºä¾‹é¡¹ç›®æºç ï¼šhttps://github.com/sunny0826/pipeline-example-maven\nkind: pipeline name: pipeline-example-maven steps: - name: Mavenç¼–è¯‘ image: maven:3-jdk-7 volumes: - name: cache path: /root/.m2 commands: - mvn clean install - name: æ„å»ºé•œåƒ image: plugins/docker volumes: - name: docker path: /var/run/docker.sock settings: username: from_secret: docker_user password: from_secret: docker_pass repo: {your-repo} registry: {your-registry} tags: ${DRONE_BUILD_NUMBER} - name: Kubernetes éƒ¨ç½² image: guoxudongdocker/kubectl:v1.14.1 volumes: - name: kube path: /root/.kube commands: - sed -i \u0026quot;s/#Tag/${DRONE_BUILD_NUMBER}/g\u0026quot; deployment.yaml - kubectl apply -f deployment.yaml - name: é’‰é’‰é€šçŸ¥ image: guoxudongdocker/drone-dingtalk settings: token: from_secret: dingding type: markdown message_color: true message_pic: true sha_link: true when: status: [failure, success] volumes: - name: cache host: path: /tmp/cache/.m2 - name: kube host: path: /tmp/cache/.kube/.test_kube - name: docker host: path: /var/run/docker.sock trigger: branch: - master  å€¼å¾—æ³¨æ„çš„äº‹ï¼šä¸Šé¢çš„è¿™ä¸ª .drone.yml æ–‡ä»¶å°†æœ¬åœ°çš„.m2æ–‡ä»¶ã€kubeconfigæ–‡ä»¶ã€docker.sock æ–‡ä»¶æŒ‚è½½åˆ° pipeline ä¸­ä»¥å®ç° maven æ‰“åŒ…ç¼“å­˜ï¼Œk8s éƒ¨ç½²ã€docker ç¼“å­˜çš„ä½œç”¨ï¼Œä»¥æé«˜ CI é€Ÿåº¦ã€‚è€Œæ˜¯ç”¨æŒ‚è½½éœ€è¦ç®¡ç†å‘˜åœ¨é¡¹ç›® settings ä¸­å‹¾é€‰ Trusted ï¼Œè¿™ä¸ªæ“ä½œåªèƒ½ç®¡ç†å‘˜è¿›è¡Œï¼Œæ™®é€šç”¨æˆ·æ˜¯çœ‹ä¸åˆ°è¿™ä¸ªé€‰é¡¹çš„ã€‚è€Œç®¡ç†å‘˜å°±æ˜¯åœ¨dockerè¿è¡Œæ—¶å€™ --env=DRONE_USER_CREATE=username:{your-admin-username},admin:true è®¾ç½®çš„ã€‚\nè€Œä¸Šä¼ é•œåƒå’Œé’‰é’‰åŒæ—¶éœ€è¦åœ¨ settings è®¾ç½®ä¸­æ·»åŠ  secret\n docker_userï¼šdocker ä»“åº“ç”¨æˆ·å docker_passï¼šdocker ä»“åº“å¯†ç  dingdingï¼š é’‰é’‰æœºå™¨äºº token   æ³¨æ„è¿™é‡Œçš„é’‰é’‰ token æ˜¯ webhook ä¸­ https://oapi.dingtalk.com/robot/send?access_token= åè¿™éƒ¨åˆ†  æ„å»ºç»“æœ æ·»åŠ  .drone.yml æ–‡ä»¶åï¼Œå‘ master åˆ†æ”¯æäº¤ä»£ç å³å¯å‡ºå‘ CI æ„å»º\nCI ç»“æŸåï¼Œä¼šåœ¨é’‰é’‰æœºå™¨äººæ‰€åœ¨ç¾¤æ”¶åˆ°é€šçŸ¥\næ’ä»¶æ”¯æŒ å¯ä»¥çœ‹åˆ°ï¼Œæ¯ä¸€æ­¥çš„é•œåƒéƒ½æ˜¯ä¸€ä¸ªé•œåƒï¼Œä¸Šé¢ pipeline ä¸­çš„ Kubernetes åŠé’‰é’‰é€šçŸ¥æ’ä»¶å°±æ˜¯æˆ‘å¼€å‘çš„ï¼Œå…·ä½“å¼€å‘æ–¹æ³•å¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼Œè€Œå®˜æ–¹ä¹Ÿæä¾›äº†è®¸å¤šå®˜æ–¹æ’ä»¶ã€‚\n æ„å»ºåéƒ¨ç½²ï¼šKubernetesã€helmã€scp æ„å»ºåé€šçŸ¥ï¼šé’‰é’‰ ã€Emailã€Slackã€å¾®ä¿¡  åè®° Drone æ•´ä½“ç”¨èµ·æ¥è¿˜æ˜¯å¾ˆæ–¹ä¾¿çš„ï¼Œæ­å»ºã€ä¸Šæ‰‹é€Ÿåº¦éƒ½å¾ˆå¿«ï¼Œä½†æ˜¯å®˜æ–¹æ–‡æ¡£ç»™çš„ä¸å¤Ÿè¯¦å®ï¼Œè€Œç½‘ä¸Šå……æ–¥ç€å„ç§å„æ ·0.8ç‰ˆæœ¬çš„çš„å®ä¾‹ï¼Œä½†æ˜¯å…¶å®å®˜ç½‘æ—©å°±å‘å¸ƒäº†1.0ç‰ˆæœ¬ï¼Œè€Œå®˜æ–¹å¹¶æ²¡æœ‰ example è¿™æ ·çš„ç¤ºä¾‹é¡¹ç›®ï¼Œè¿™æ ·å°±åˆæŠŠæœ¬æ¥é™ä¸‹æ¥çš„å­¦ä¹ æ›²çº¿æ‹‰é«˜äº†ã€‚è®¸å¤šå‘éƒ½éœ€è¦è‡ªå·±å»è¶Ÿï¼Œæˆ‘åœ¨æµ‹è¯• drone çš„æ—¶å€™ï¼Œå°±æ„æ„å»ºäº†ä¸Šç™¾æ¬¡ï¼Œä¸åœçš„ä¿®æ”¹ .drone.yml ï¼Œ commit ä¿¡æ¯çœ‹èµ·æ¥æ˜¯å¾ˆææ€–çš„ã€‚åç»­æŠ½ç©ºä¼šå‘å®˜æ–¹è´¡çŒ® example è¿™æ ·çš„ PRã€‚\n","date":1558400340,"expirydate":-62135596800,"kind":"page","lang":"zh","lastmod":1558400340,"objectID":"67f81b7dad5f6e2c804955d275320995","permalink":"https://guoxudong.io/post/drone-ci/","publishdate":"2019-05-21T08:59:00+08:00","relpermalink":"/post/drone-ci/","section":"post","summary":"æœ¬æ–‡ä»‹ç»ä¸€æ¬¾è½»é‡çº§çš„ CI å·¥å…· Drone ï¼ŒåŒæ—¶ä¹Ÿä»‹ç»åœ¨å®è·µä¸­é‡åˆ°çš„ä¸€äº›å‘ï¼Œå¸®åŠ©ä½ å¿«é€Ÿæ­å»ºæŒç»­é›†æˆæµæ°´çº¿ã€‚","tags":["devops","drone","å·¥å…·"],"title":"è½»é‡å¿«é€Ÿçš„ CI å·¥å…· Drone","type":"post"},{"authors":null,"categories":["ç¿»è¯‘"],"content":" åœ¨å½“å‰çš„ IT å®è·µä¸­ï¼Œä¸ºäº†æ”¯æŒé«˜æ•ˆå’Œå¿«æ·çš„è½¯ä»¶å¼€å‘ï¼Œå‡ºç°äº†å·¨å¤§çš„è½¬å˜ï¼šåœ¨å•ä½“åº”ç”¨çš„è½¯ä»¶æ¶æ„æ­£åœ¨é€æ¸è¢«å¾®æœåŠ¡æ¶æ„å–ä»£çš„æƒ…å†µä¸‹ï¼Œå¼€å‘ã€ QA å’Œè¿ç»´å›¢é˜Ÿä¸ºäº†æ‘†è„±äº†ä¹‹å‰ç›¸äº’å­¤ç«‹çš„çŠ¶å†µï¼Œå¼€å§‹ç›¸äº’å…³è”å¹¶èåˆç»Ÿä¸€ï¼Œæˆ‘ä»¬å°†å…¶ç§°ä¸ºDevOpsã€‚\nå½“ä»Šå¦‚æœä¸€ä¸ªæŠ€æœ¯é©±åŠ¨å‹ä¼ä¸šæƒ³è¦ä»¥å®¢æˆ·ä¸ºå¯¼å‘æ¥è¿›è¡Œå¿«é€Ÿçš„è½¯ä»¶è¿­ä»£ï¼Œé‚£ä¹ˆä»–ä»¬éœ€è¦æ›´å¿«é€Ÿçš„è½¯ä»¶å¼€å‘å’Œäº¤ä»˜å‘¨æœŸã€‚è€Œè¿™äº›éœ€æ±‚ç›´æ¥å¯¼è‡´äº† DevOps æ–‡åŒ–çš„æ ¸å¿ƒ CI/CD å®è·µçš„è¯ç”Ÿã€‚\nCI æŒç»­é›†æˆï¼šä¸€ç§ä¸“æ³¨äºä½¿å‘å¸ƒæ›´å®¹æ˜“çš„è½¯ä»¶å¼€å‘å®è·µã€‚\nCD æŒç»­äº¤ä»˜ï¼šæ˜¯æŒç»­é›†æˆçš„å»¶ä¼¸ï¼Œä»¥ç¡®ä¿æ‚¨å¯ä»¥ä»¥å¯æŒç»­çš„æ–¹å¼å¿«é€Ÿå‘å®¢æˆ·å‘å¸ƒæ–°çš„æ›´æ”¹ã€‚\næ—©æœŸæ•´ä¸ª SDLC éƒ½æ˜¯çº¿æ€§å’Œé¡ºåºçš„ï¼Œè¿™æ‹‰é•¿äº†äº§å“çš„å‘å¸ƒå‘¨æœŸã€‚ä½†éšç€å¿«é€Ÿå˜åŒ–çš„å¸‚åœºåŠ¨æ€ã€æ¿€çƒˆçš„ç«äº‰å’Œå¤šå˜çš„å®¢æˆ·éœ€æ±‚ï¼Œè¿™äº›éƒ½ä¼šå¯¼è‡´å…¬å¸æ— æ³•ç»§ç»­ä½¿ç”¨åŸå…ˆå¼€å‘æµç¨‹ã€‚ä»–ä»¬å¿…é¡»æ›´è´´è¿‘å®¢æˆ·ï¼Œéœ€è¦ä¸æ–­åˆ›æ–°ä»¥ä¿æŒä»–ä»¬çš„å‚ä¸ã€‚è€Œ DevOps ä¸ºæ­¤æä¾›äº†è§£å†³æ–¹æ¡ˆï¼Œå¹¶è¢«æŠ€æœ¯é©±åŠ¨çš„å…¬å¸å¹¿æ³›é‡‡ç”¨ï¼Œç”¨æ¥æ”¹è¿›å…¶å¿«é€Ÿäº¤ä»˜çš„æµç¨‹å’Œå®è·µã€‚\né‚£ä¹ˆè®©æˆ‘ä»¬è¯•ç€äº†è§£ä»€ä¹ˆæ˜¯ DevOps ï¼Ÿ\nDevOps å®šä¹‰ï¼š\næåˆ° DevOps æˆ‘ç»å¸¸å¼•ç”¨ w.r.t çš„è¯ï¼š\n ä»»ä½•å…¬å¸åœ¨å­¦ä¼šä½¿ç”¨æœ€ä½³ DevOps å®è·µè¿›è¡Œåä½œã€ç»Ÿä¸€å’Œè‡ªåŠ¨åŒ–æ‰€æœ‰å¼€å‘å’Œè¿ç»´æµç¨‹ä¹‹å‰ï¼Œéƒ½å°†æ— æ³•æ‰©å±•å’Œç»´æŒã€‚è¿™æ˜¯ä¸€ç§å°†æ¯ä¸ªäººè”ç³»åœ¨ä¸€èµ·å®ç°å…±åŒç›®æ ‡çš„æ–‡åŒ–ã€‚\n æ˜¯æ—¶å€™è®©æ‰€æœ‰å›¢é˜Ÿæˆå‘˜ä¸ä»–ä»¬çš„éƒ¨é—¨å¯†åˆ‡åˆä½œï¼Œé‡‡ç”¨å·¥å…·å’Œå®è·µæ¥é«˜æ•ˆåœ°äº¤ä»˜è½¯ä»¶äº§å“ã€‚\nAtlassian å°† DevOps å®šä¹‰ä¸ºï¼š\nDevOps æ˜¯ä¸€ç»„è½¯ä»¶å¼€å‘å’Œè¿ç»´å›¢é˜Ÿä¹‹é—´çš„è‡ªåŠ¨åŒ–æµç¨‹å®è·µï¼Œä»¥ä¾¿ä»–ä»¬å¯ä»¥å¿«é€Ÿã€å¯é åœ°æ„å»ºï¼Œæµ‹è¯•å’Œå‘å¸ƒè½¯ä»¶ã€‚DevOps çš„æ¦‚å¿µå»ºç«‹åœ¨ä¸ºè¿‡å»ç›¸å¯¹å­¤ç«‹çš„å›¢é˜Ÿä¹‹é—´å»ºç«‹åˆä½œæ–‡åŒ–çš„åŸºç¡€ä¸Šã€‚å…¶å¸¦æ¥çš„å¥½å¤„åŒ…æ‹¬æ›´åŠ å¯é ã€æ›´å¿«çš„è½¯ä»¶å‘å¸ƒï¼Œå¿«é€Ÿè§£å†³å…³é”®é—®é¢˜çš„èƒ½åŠ›ï¼Œä»¥åŠæ›´å¥½åœ°ç®¡ç†è®¡åˆ’å¤–çš„å·¥ä½œã€‚\nAmazon å°† DevOps å®šä¹‰ä¸ºï¼š\næ–‡åŒ–ç†å¿µã€å®è·µå’Œå·¥å…·çš„ç»“åˆï¼Œæé«˜äº†å›¢é˜Ÿçš„é«˜é€Ÿäº¤ä»˜åº”ç”¨ç¨‹åºå’ŒæœåŠ¡çš„èƒ½åŠ›ï¼šä¸ä½¿ç”¨å•ä½“åº”ç”¨çš„è½¯ä»¶å¼€å‘æ¶æ„ç®¡ç†æµç¨‹çš„å›¢é˜Ÿç›¸æ¯”ï¼Œä»¥æ›´å¿«çš„é€Ÿåº¦å¼€å‘å’Œæ”¹è¿›äº§å“ã€‚è¿™ç§é€Ÿåº¦ä½¿å›¢é˜Ÿèƒ½å¤Ÿæ›´å¥½åœ°ä¸ºå®¢æˆ·æœåŠ¡ï¼Œå¹¶åœ¨å¸‚åœºç«äº‰ä¸­å æ®æœ‰åˆ©åœ°ä½ã€‚\nMicrosoft ä»¥æ›´ç®€åŒ–çš„æ–¹å¼å®šä¹‰ DevOpsï¼š\nâ€œDevOps å¯ä»¥ä¸ºæˆ‘ä»¬çš„ç»ˆç«¯å®¢æˆ·æŒç»­æä¾›ä»·å€¼çš„äººå‘˜ï¼Œæµç¨‹å’Œäº§å“çš„ç»“åˆã€‚â€\næˆ‘è®¤ä¸º DevOps çš„æœ€ä½³è§£é‡Šä¸ºï¼šå®ƒæ˜¯ä¸€ç§æ–‡åŒ–ï¼Œæ˜¯ä¸€ç§å°†äººæ”¾åœ¨é¦–ä½å›¢é˜Ÿç†å¿µï¼Œä¸ºä»–ä»¬æä¾›é€‚å®œçš„ç¯å¢ƒï¼Œä½¿ä»–ä»¬èƒ½å¤Ÿè“¬å‹ƒå‘å±•ï¼Œå› æ­¤æ— è®ºä»–ä»¬å±äºä»€ä¹ˆéƒ¨é—¨ï¼Œéƒ½å¯ä»¥é€šè¿‡æ˜ç¡®çš„æµç¨‹è¿›è¡Œåä½œå’Œæ²Ÿé€šï¼Œä»è€Œå®ç°ç›®æ ‡ã€‚\nDevOps æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ å¦‚ä¸Šæ‰€è¿°ï¼ŒDevOps æ²¡æœ‰ä»»ä½•å›ºå®šçš„è§„åˆ™å’Œå®è·µï¼Œä½†å®ƒæ›´åƒæ˜¯é€šè¿‡æ¥è‡ªä¸åŒéƒ¨é—¨å…·æœ‰ä¸åŒçš„æŠ€èƒ½çš„å›¢é˜Ÿåœ¨ä¸€èµ·ä»¥å®ç°é¢„æœŸçš„ç»“æœçš„æ–‡åŒ–ã€‚é‚£ä¹ˆå®ƒå®é™…ä¸Šæ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Œè®©æˆ‘é€šè¿‡ä¸‹å›¾ç®€è¦è§£é‡Šä¸€ä¸‹ï¼š\nå› æ­¤ï¼Œå¼€å‘äººå‘˜ï¼ŒQA å’Œè¿ç»´å›¢é˜Ÿä½¿ç”¨ CI/CD å®è·µæ¥å®ç°å®¢æˆ·çš„é¢„æœŸç›®æ ‡ã€‚å¼€å‘äººå‘˜ç¼–å†™ä»£ç å¹¶å°†å…¶æäº¤åˆ° GitHub ç­‰æºç æ§åˆ¶å·¥å…·ã€‚DevOps å·¥ç¨‹å¸ˆä½¿ç”¨ CI å·¥å…·æ¥æå–ä»£ç ï¼Œæ¥è¿›è¡Œè‡ªåŠ¨åŒ–æµ‹è¯•ï¼Œå¹¶é€šè¿‡ CD å·¥å…·éƒ¨ç½²åˆ°å¤„ç†ç”Ÿäº§æˆ–æµ‹è¯•æœåŠ¡å™¨ã€‚\nå¼€å‘å’Œè¿ç»´äººå‘˜ä¸€èµ·å·¥ä½œï¼Œå¹¶ä½¿ç”¨å„ç§å·¥å…·è¿›è¡Œ CI/CD å’Œç›‘æ§ï¼Œä»¥å¿«é€Ÿå“åº”å®¢æˆ·éœ€æ±‚å¹¶ä¿®å¤é—®é¢˜å’Œé”™è¯¯ã€‚\nDevOpså·¥å…·åœ¨DevOpså‘¨æœŸçš„å„ä¸ªé˜¶æ®µï¼š å¦‚ä¸‹æ‰€ç¤ºï¼š DevOps å·¥ç¨‹å¸ˆå¯ä»¥ä½¿ç”¨å¤šç§å·¥å…·åœ¨æ•´ä¸ª DevOps ç”Ÿå‘½å‘¨æœŸçš„æ¯ä¸ªé˜¶æ®µè·å–æœŸæœ›çš„ç»“æœã€‚\nè®¡åˆ’ï¼š æ‚¨å¯ä»¥ä½¿ç”¨ Jira æˆ– Azure DevOps Board ä»¥æ•æ·æ–¹å¼ç®¡ç†å’Œè§„åˆ’æ‚¨çš„å·¥ä½œã€‚\nå¼€å‘ï¼š å¯¹äºä»£ç ç®¡ç†ï¼Œ Git ä»¥åˆ†å¸ƒå¼æ–¹å¼ç®¡ç†ä»£ç ç‰ˆæœ¬å†å²ã€åˆ†æ”¯ã€æ¨é€å’Œæ‹‰å–æœºåˆ¶çš„é¦–è¦å·¥å…·ã€‚æ‚¨è¿˜å¯ä»¥ä½¿ç”¨ Microsoft TFVCï¼ˆTeam Foundation Version Controlï¼‰ï¼Œè¿™æ˜¯ä¸€ä¸ªé›†ä¸­ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿã€‚\næµ‹è¯•ï¼š è¦è¿›è¡Œè‡ªåŠ¨åŒ–æµ‹è¯•ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ Selenium ã€ JUnit å’Œ Apache JMeter ã€‚\né›†æˆï¼š Jenkins æ˜¯ç›®å‰æœ€å—æ¬¢è¿çš„ CI å·¥å…·ä¹‹ä¸€ï¼Œå®ƒå¯ä»¥åšåˆ°æ— ç¼åœ°é›†æˆå¼€å‘å’Œè¿ç»´æµç¨‹ã€‚\nå…¶ä»– CI å·¥å…·è¿˜æœ‰ Travis ï¼† Bambooã€‚\néƒ¨ç½²å’Œé…ç½®ç®¡ç†ï¼š Docker æ˜¯æœ€å—æ¬¢è¿å’Œå¹¿æ³›ä½¿ç”¨çš„æŒç»­éƒ¨ç½²å·¥å…·ä¹‹ä¸€ã€‚å®ƒä¹Ÿæ˜¯è½¯ä»¶å®¹å™¨åŒ–å·¥å…·ã€‚\nå…¶ä»–éƒ¨ç½²å’Œé…ç½®ç®¡ç†å·¥å…·è¿˜æœ‰ Kubernetes ã€ Chef ã€Ansible å’Œ Puppetã€‚\nKubernetes æ˜¯ä¸€ä¸ªå¼€æºå®¹å™¨ç®¡ç†ï¼ˆç¼–æ’ï¼‰å·¥å…·ã€‚å…¶å®¹å™¨ç®¡ç†èŒè´£åŒ…æ‹¬å®¹å™¨éƒ¨ç½²ï¼Œå®¹å™¨æ‰©å±•å’Œä¼¸ç¼©ä»¥åŠå®¹å™¨çš„è´Ÿè½½å‡è¡¡ã€‚\nç›‘æ§ï¼š å°†äº§å“éƒ¨ç½²åˆ°æ­£ç¡®çš„ä½ç½®åï¼ŒæŒç»­çš„ç›‘æ§å°±å˜å¾—è‡³å…³é‡è¦ã€‚ Nagios ã€ Splunk å’Œ New Relics æ˜¯å¹¿æ³›ä½¿ç”¨çš„æŒç»­ç›‘æ§å·¥å…·ã€‚\nDevOps æœ€ä½³å®è·µï¼š æ­£å¦‚æ–‡ç« å¼€å¤´æ‰€è®¨è®ºçš„é‚£æ ·ï¼Œä¸ºäº†ä½¿æŠ€æœ¯é©±åŠ¨çš„å…¬å¸å˜å¾—æ›´åŠ ä»¥å®¢æˆ·ä¸ºå¯¼å‘ï¼Œä»–ä»¬éœ€è¦å°†è‡ªå·±ä»å•ä½“åº”ç”¨çš„è½¯ä»¶å¼€å‘å®è·µè½¬å˜ä¸ºä¸ºå®¢æˆ·å‘å¸ƒäº§å“çš„æ•æ·æ–¹å¼ã€‚è®©æˆ‘ä»¬è¯•ç€äº†è§£ä»–ä»¬éœ€è¦é‡‡ç”¨çš„æœ€ä½³ DevOpså®è·µï¼š\n æŒç»­é›†æˆ æŒç»­äº¤ä»˜ å¾®æœåŠ¡ åŸºç¡€è®¾æ–½å³ä»£ç  ç›‘æ§å’Œæ—¥å¿— æ²Ÿé€šä¸åä½œ  è®©æˆ‘ç®€è¦è§£é‡Šä¸€ä¸‹\n1. æŒç»­é›†æˆï¼š Amazon å°† CI å®šä¹‰ä¸ºï¼š\nDevOps è½¯ä»¶å¼€å‘å®è·µï¼Œå¼€å‘äººå‘˜å®šæœŸå°†ä»£ç ä¿®æ”¹åˆå¹¶åˆ°ä¸­å¤®å­˜å‚¨åº“ï¼Œç„¶åè¿è¡Œè‡ªåŠ¨æ„å»ºå’Œæµ‹è¯•ã€‚æŒç»­é›†æˆé€šå¸¸æ˜¯æŒ‡è½¯ä»¶å‘å¸ƒè¿‡ç¨‹çš„æ„å»ºæˆ–é›†æˆé˜¶æ®µï¼Œå¹¶ä¸”éœ€è¦è‡ªåŠ¨åŒ–ç»„ä»¶ï¼ˆä¾‹å¦‚ï¼ŒCI æˆ–æ„å»ºæœåŠ¡ï¼‰ã€‚æŒç»­é›†æˆçš„ç›®çš„æ˜¯æ›´å¿«åœ°å‘ç°å’Œè§£å†³é—®é¢˜ï¼Œæé«˜è½¯ä»¶è´¨é‡ï¼Œå¹¶å‡å°‘éªŒè¯å’Œå‘å¸ƒæ–°è½¯ä»¶æ›´æ–°æ‰€éœ€çš„æ—¶é—´ã€‚\n2.æŒç»­äº¤ä»˜ï¼š æŒç»­äº¤ä»˜æ˜¯ä¸€ç§è½¯ä»¶å¼€å‘å®è·µï¼Œå…¶ä¸­å¼€å‘äººå‘˜å®Œæˆçš„ä»»ä½•ä»£ç æ›´æ”¹éƒ½ä¼šè‡ªåŠ¨ä¸ºå‘å¸ƒåˆ°ç”Ÿäº§ç¯å¢ƒåšå¥½å‡†å¤‡ã€‚\né€šè¿‡åœ¨æ„å»ºé˜¶æ®µä¹‹åå°†æ‰€æœ‰çš„ä»£ç æ›´æ”¹éƒ¨ç½²åˆ°æµ‹è¯•ç¯å¢ƒæˆ–ç”Ÿäº§ç¯å¢ƒï¼ŒæŒç»­äº¤ä»˜å¯åœ¨æŒç»­é›†æˆæ—¶è¿›è¡Œæ‰©å±•ã€‚\n3. å¾®æœåŠ¡ï¼šæ•æ·å¼€å‘çš„æ¶æ„ è¿™æ˜¯ä¸€ç§æ–°çš„è½¯ä»¶è®¾è®¡æ–¹æ³•ï¼Œæ‚¨å¯ä»¥å°†å•ä¸ªåº”ç”¨ç¨‹åºæ‹†åˆ†ä¸ºä¸€ç»„å°å‹æœåŠ¡/æ¨¡å—ã€‚ä¸å•ä½“åº”ç”¨æ¶æ„å°†æ‰€æœ‰å‰ç«¯å’Œåç«¯ä»£ç åº“ä»¥åŠæ•°æ®åº“éƒ½å…¨éƒ¨éƒ¨ç½²åœ¨åŒä¸€ä¸ªæœåŠ¡å™¨åœ°å€ä¸­ç›¸æ¯”ï¼ŒåŸºäºå¾®æœåŠ¡æ¶æ„çš„åº”ç”¨ç¨‹åºè¢«åˆ†è§£ä¸ºæœåŠ¡ï¼Œå…¶ä¸­æ¯ä¸ªæœåŠ¡å™¨éƒ½åœ¨å…¶ä¸­è¿è¡Œä½¿ç”¨åŸºäº HTTP çš„åº”ç”¨ç¨‹åºç¼–ç¨‹æ¥å£ï¼ˆAPIï¼‰ï¼Œé€šè¿‡å®šä¹‰è‰¯å¥½çš„æ¥å£ä½¿è‡ªå·±ä¸å…¶ä»–æœåŠ¡è¿›è¡Œé€šä¿¡ã€‚\næŒ‰ç…§ Amazon çš„ä»‹ç»ï¼šï¼š\nå¾®æœåŠ¡æ˜¯å›´ç»•ä¸šåŠ¡èƒ½åŠ›æ„å»ºçš„; æ¯é¡¹æœåŠ¡çš„èŒƒå›´éƒ½æ˜¯ä¸€ä¸ªç®€å•çš„ç”¨é€”ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ä¸åŒçš„æ¡†æ¶æˆ–ç¼–ç¨‹è¯­è¨€æ¥ç¼–å†™å¾®æœåŠ¡å¹¶å°†å®ƒä»¬ä½œä¸ºå•ä¸ªæœåŠ¡æˆ–ä¸€ç»„æœåŠ¡ç‹¬ç«‹éƒ¨ç½²ã€‚\n4. åŸºç¡€è®¾æ–½å³ä»£ç ï¼šIaC æ˜¯é€šè¿‡æœºå™¨å¯è¯»å®šä¹‰æ–‡ä»¶ï¼ˆä»£ç åº“ï¼‰ç®¡ç†å’Œé…ç½®è®¡ç®—æœºæ•°æ®ä¸­å¿ƒçš„è¿‡ç¨‹ï¼Œè€Œä¸æ˜¯ç‰©ç†ç¡¬ä»¶é…ç½®æˆ–äº¤äº’å¼é…ç½®å·¥å…·ã€‚\nAmazon å®šä¹‰ IaC ä¸ºï¼š\nä½œä¸ºä½¿ç”¨ä»£ç å’Œè½¯ä»¶å¼€å‘æŠ€æœ¯ï¼ˆä¾‹å¦‚ç‰ˆæœ¬æ§åˆ¶å’ŒæŒç»­é›†æˆï¼‰æ¥é…ç½®å’Œç®¡ç†åŸºç¡€æ¶æ„çš„å®è·µã€‚äº‘æœåŠ¡çš„ API é©±åŠ¨æ¨¡å‹ä½¿å¼€å‘äººå‘˜å’Œç³»ç»Ÿç®¡ç†å‘˜èƒ½å¤Ÿä»¥ç¼–ç¨‹æ–¹å¼å¤§è§„æ¨¡åœ°ä¸åŸºç¡€æ¶æ„äº¤äº’ï¼Œè€Œä¸éœ€è¦æ‰‹åŠ¨è®¾ç½®å’Œé…ç½®èµ„æºã€‚\nå› æ­¤ï¼Œå¼€å‘äººå‘˜å¯ä»¥ä½¿ç”¨åŸºäºä»£ç çš„å·¥å…·ä¸åŸºç¡€æ¶æ„è¿›è¡Œäº¤äº’ï¼Œä½¿å…¶æ›´åƒåº”ç”¨ç¨‹åºã€‚è¿™ä½¿å¾—å¯ä»¥ä½¿ç”¨æ ‡å‡†åŒ–æ¨¡å¼å¿«é€Ÿéƒ¨ç½²åŸºç¡€æ¶æ„å’ŒæœåŠ¡å™¨ï¼Œä½¿ç”¨æœ€æ–°çš„è¡¥ä¸å’Œç‰ˆæœ¬è¿›è¡Œæ›´æ–°ï¼Œæˆ–ä»¥å‰¯æœ¬çš„æ–¹å¼è¿›è¡Œå¤åˆ¶éƒ¨ç½²ã€‚\nä¼ ç»Ÿçš„æœåŠ¡ï¼ˆç”Ÿå‘½å‘¨æœŸï¼‰è‡ªåŠ¨åŒ–å’Œé…ç½®ç®¡ç†å·¥å…·ç”¨äºå®ŒæˆIaCã€‚ç°åœ¨ä¼ä¸šä¹Ÿåœ¨ä½¿ç”¨è¿ç»­é…ç½®è‡ªåŠ¨åŒ–å·¥å…·æˆ–ç‹¬ç«‹çš„ IaC æ¡†æ¶ï¼Œä¾‹å¦‚ Microsoft çš„ PowerShell DSC æˆ– AWS CloudFormationã€‚\n5. ç›‘æ§ä¸æ—¥å¿— å…¬å¸å¯ä»¥é€šè¿‡ç›‘æ§æŒ‡æ ‡å’Œæ—¥å¿—ï¼Œæ¥äº†è§£å…¶åº”ç”¨ç¨‹åºå’ŒåŸºç¡€æ¶æ„çš„è¿è¡Œæƒ…å†µã€‚APMï¼ˆApplication performance management åº”ç”¨ç¨‹åºæ€§èƒ½ç®¡ç†ï¼‰å°† IT æŒ‡æ ‡è½¬æ¢ä¸ºæœ‰æ„ä¹‰çš„ä¸šåŠ¡æŒ‡æ ‡ï¼Œè‡´åŠ›äºæ£€æµ‹å’Œè¯Šæ–­å¤æ‚çš„åº”ç”¨ç¨‹åºæ€§èƒ½é—®é¢˜ï¼Œä»¥ç»´æŒé¢„æœŸçš„æœåŠ¡ç­‰çº§ã€‚\né€šè¿‡æ•è·ã€åˆ†ç±»ã€åˆ†æåº”ç”¨ç¨‹åºå’ŒåŸºç¡€æ¶æ„ç”Ÿæˆçš„æ•°æ®å’Œæ—¥å¿—ï¼Œå›¢é˜Ÿå¯ä»¥äº†è§£æ›´æ–°æ˜¯å¦‚ä½•å½±å“ç”¨æˆ·çš„ï¼Œä»è€Œæ·±å…¥äº†è§£é—®é¢˜æˆ–æŠ¥é”™çš„æ ¹æœ¬åŸå› ã€‚\nwiki ä¸­ä»‹ç»ï¼š\nå¯†åˆ‡ç›‘æ§ä¸¤ç»„æ€§èƒ½æŒ‡æ ‡ã€‚ç¬¬ä¸€ç»„æ€§èƒ½æŒ‡æ ‡å®šä¹‰äº†åº”ç”¨ç¨‹åºç»ˆç«¯ç”¨æˆ·æ‰€ä½“éªŒçš„æ€§èƒ½ã€‚æ€§èƒ½çš„ä¸€ä¸ªç¤ºä¾‹æ˜¯å³°å€¼è´Ÿè½½ä¸‹çš„å¹³å‡å“åº”æ—¶é—´ï¼ŒåŒ…æ‹¬åŠ è½½å’Œå“åº”æ—¶é—´ã€‚\n è´Ÿè½½æ˜¯åº”ç”¨ç¨‹åºå¤„ç†çš„äº‹åŠ¡é‡ï¼Œä¾‹å¦‚ï¼Œæ¯ç§’äº‹åŠ¡æ•°ï¼ˆtpsï¼‰ã€æ¯ç§’è¯·æ±‚æ•°ã€æ¯ç§’é¡µæ•°ã€‚åœ¨æ²¡æœ‰è¢«è®¡ç®—æœºçš„æœç´¢ã€è®¡ç®—ã€ä¼ è¾“ç­‰éœ€æ±‚åŠ è½½çš„æƒ…å†µä¸‹ï¼Œå¤§å¤šæ•°åº”ç”¨ç¨‹åºéƒ½è¶³å¤Ÿå¿«ï¼Œè¿™å°±æ˜¯å¼€å‘äººå‘˜åœ¨å¼€å‘è¿‡ç¨‹ä¸­å¯èƒ½æ— æ³•æ•è·æ€§èƒ½é—®é¢˜çš„åŸå› ã€‚ å“åº”æ—¶é—´æ˜¯åº”ç”¨ç¨‹åºåœ¨æ­¤ç±»è´Ÿè½½ä¸‹å“åº”ç”¨æˆ·æ“ä½œæ‰€éœ€çš„æ—¶é—´ã€‚  6. æ²Ÿé€šä¸åä½œ åœ¨æˆ‘çœ‹æ¥ï¼š\nå›¢é˜Ÿä¸­çš„ DevOps ä½œä¸ºä¸€ç§å®è·µå–å¾—æˆåŠŸï¼Œéœ€è¦2ä¸ªåŸºæœ¬æ”¯æŸ±ï¼šæ²Ÿé€šå’Œåä½œï¼Œæ‰èƒ½éå¸¸æœ‰æ•ˆåœ°å·¥ä½œã€‚å¦‚æœæ²¡æœ‰è¿™ç§æ„Ÿè§‰å¹¶ç†è§£ç´§å¯†ç»“åˆå›¢é˜Ÿå·¥ä½œçš„é‡è¦æ€§ï¼Œé‚£ä¹ˆé‡‡ç”¨ DevOps æœ€ä½³å®è·µå°†éå¸¸å›°éš¾ã€‚\nå¢åŠ å›¢é˜Ÿä¸­çš„æ²Ÿé€šå’Œåä½œæ˜¯ DevOpsæ–‡åŒ– çš„å…³é”®æ–¹é¢ä¹‹ä¸€ã€‚æœ‰äº†è¿™ç§æ–‡åŒ–ï¼Œå›¢é˜Ÿå°±ä¼šä»¥è‰¯å¥½çš„æ€åº¦å’ŒåŠ¨åŠ›èšé›†åœ¨ä¸€èµ·ï¼Œå›´ç»•ä¿¡æ¯å…±äº«å»ºç«‹å¼ºæœ‰åŠ›çš„æ–‡åŒ–è§„èŒƒï¼Œå¹¶é€šè¿‡æ²Ÿé€šå·¥å…·å’Œåº”ç”¨ä¿ƒè¿›æ²Ÿé€šï¼Œä½¿å›¢é˜Ÿçš„æ‰€æœ‰éƒ¨é—¨èƒ½å¤Ÿæ›´åŠ ç´§å¯†åœ°åè°ƒå…±åŒçš„ç›®æ ‡ã€‚\nä¸ºä½•é€‰æ‹©DevOpsï¼Ÿå®ƒçš„å¥½å¤„æ˜¯ä»€ä¹ˆï¼Ÿ è¦äº†è§£ DevOps æå‡çš„ä»·å€¼å·²ç»å…¶å¦‚ä½•è¢«å…¬å¸æ‰€é‡‡ç”¨ï¼š\nè®©æˆ‘ä»¬çœ‹çœ‹ç”± veritis å¸¦ç»™æ‚¨çš„ä»¥ä¸‹ä¿¡æ¯å›¾è¡¨ã€‚\nä»¥ä¸Šç»™å‡ºçš„å›¾è¡¨æ¸…æ¥šåœ°é˜è¿°äº† DevOps å®è·µçš„ä¸»è¦å¥½å¤„ï¼š\né€Ÿåº¦ DevOps ä¿ƒè¿›å›¢é˜Ÿçš„é«˜é€Ÿå¼€å‘ï¼Œä»¥ä¾¿æ‚¨å¯ä»¥æ›´å¿«åœ°ä¸ºå®¢æˆ·è¿›è¡Œåˆ›æ–°ï¼Œæ›´å¥½åœ°é€‚åº”ä¸æ–­å˜åŒ–çš„å¸‚åœºï¼Œå¹¶åœ¨æ¨åŠ¨ä¸šåŠ¡æˆæœæ–¹é¢æé«˜æ•ˆç‡ã€‚\nå¿«é€Ÿäº¤ä»˜ é€šè¿‡åŸºäº CI/CD çš„ DevOps æ–‡åŒ–ï¼Œç¼©çŸ­äº†åº”ç”¨ç¨‹åºå‘å¸ƒå‘¨æœŸï¼Œå…è®¸æ›´å¿«çš„å®¢æˆ·åé¦ˆå’Œæœ‰æ„ä¹‰çš„åˆ›æ–°åœ¨å›¢é˜Ÿå†…çš„è“¬å‹ƒå‘å±•ã€‚æ‚¨å¯ä»¥æ›´å¿«åœ°å‘å¸ƒæ–°åŠŸèƒ½å¹¶ä¿®å¤é”™è¯¯ï¼Œæ›´å¿«åœ°å“åº”å®¢æˆ·çš„éœ€æ±‚å¹¶å»ºç«‹ç«äº‰ä¼˜åŠ¿ã€‚\nå¯é æ€§ DevOps ä½¿æ‚¨èƒ½å¤Ÿé€šè¿‡æŒç»­é›†æˆå’ŒæŒç»­äº¤ä»˜ç­‰å®è·µä¸æ–­æé«˜æ‚¨çš„è½¯ä»¶è´¨é‡ï¼Œä»¥æµ‹è¯•æ¯é¡¹å˜æ›´çš„åŠŸèƒ½å’Œå®‰å…¨æ€§ã€‚è¿™é€ å°±äº†å¯é å’Œç»è¿‡æµ‹è¯•çš„åº”ç”¨ç¨‹åºå’Œå¼ºå¤§çš„åŸºç¡€è®¾æ–½çš„å¼€å‘ã€‚DevOps æŒç»­ç›‘æ§å’Œè®°å½•å®è·µå¯ä»¥å¸®åŠ©æ‚¨å®æ—¶äº†è§£è½¯ä»¶çš„æ€§èƒ½ã€‚\næ–‡åŒ– DevOps åŸ¹å…»äº†ä¸€ç§ä¼Ÿå¤§çš„å·¥ä½œæ–‡åŒ–ï¼Œåœ¨å…¶æ–‡åŒ–æ¨¡å¼ä¸‹å»ºç«‹æ›´æœ‰æ•ˆçš„å›¢é˜Ÿï¼Œå¼ºè°ƒæ‰€æœ‰æƒå’Œè´£ä»»ç­‰ä»·å€¼è§‚ã€‚\nå®‰å…¨ é€šè¿‡é‡‡ç”¨ DevOps æ¨¡å‹ï¼Œç»„ç»‡å¯ä»¥ä½¿ç”¨åŸºç¡€æ¶å³ä»£ç å’Œç­–ç•¥å³ä»£ç ï¼Œåœ¨ä¸ç‰ºç‰²å®‰å…¨æ€§çš„æƒ…å†µä¸‹å¤§è§„æ¨¡å®šä¹‰å’Œè·Ÿè¸ªåˆè§„æ€§ã€‚ä»–ä»¬å¯ä»¥åœ¨ä¿æŒæ§åˆ¶å’Œåˆè§„æ€§çš„åŒæ—¶å¿«é€Ÿè¿›æ­¥ã€‚\nDevOps çš„æŒ‘æˆ˜ åœ¨å›¢é˜Ÿä¸­å®æ–½ DevOps æ–‡åŒ–å¹¶ä¸å®¹æ˜“ã€‚æ²¡æœ‰æ ‡å‡†çš„è§„åˆ™å¯ä»¥å‚è€ƒï¼Œå®ƒæ›´åƒæ˜¯æ”¹å˜ä¸ªäººå’Œå›¢é˜Ÿçš„å¿ƒæ€çš„æ¸¸æˆã€‚è¿™å°±åƒè¦æ±‚äººä»¬ç¦»å¼€ä»–ä»¬çš„èˆ’é€‚åŒºã€‚\n â€œå½“ä½ è¯•å›¾åœ¨å›¢é˜Ÿä¸­å¸¦æ¥ä»»ä½•ç›¸å½“å¤§çš„å˜åŒ–æ—¶ï¼Œä¸€å¼€å§‹å¯èƒ½çœ‹èµ·æ¥å¾ˆéš¾ï¼Œä½†å½“ä½ æœ‰è¶³å¤Ÿå¤§çš„æ„æ„¿æ—¶ï¼Œå°±ä¼šå‘ç”Ÿå˜åŒ–ï¼Œå¹¶æ¸è¿›è¾¾æˆç›®æ ‡ã€‚â€\n å› æ­¤ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹é‡‡ç”¨ DevOps ä½œä¸ºæ–‡åŒ–çš„ä¸€äº›å¸¸è§æŒ‘æˆ˜ã€‚\n1. Dev Vs Ops å¿ƒæ€ ç”±äºé•¿æœŸçš„å¼€å‘å’Œè¿ç»´å›¢é˜Ÿä¸€ç›´åœ¨å­¤ç«‹åœ°å·¥ä½œï¼Œå®Œæˆä¸åŒçš„ä»»åŠ¡ã€‚æ‰€ä»¥ä»–ä»¬ç»è¿‡ç²¾å¿ƒè°ƒæ•´ï¼Œä»¥ä¸åŒçš„æ–¹å¼æ€è€ƒå’Œè¡ŒåŠ¨ã€‚å¼€å‘äººå‘˜è¯•å›¾å°½å¿«åˆ›æ–°å¹¶åšå‡ºæ”¹å˜ï¼Œè¿ç»´äººå‘˜åˆ™è¯•å›¾ä¿æŒ 100ï¼… çš„æœåŠ¡å¯ç”¨æ€§ã€‚ä»–ä»¬çš„ç›®æ ‡å’Œä¼˜å…ˆäº‹é¡¹æ˜¯ä¸åŒçš„ï¼Œæ‰€ä»¥å¦‚æœæˆ‘ä»¬å¿…é¡»å°† DevOps ä½œä¸ºå›¢é˜Ÿä¸­çš„æ–‡åŒ–å®è·µï¼Œé‚£ä¹ˆå¦‚æœä»–ä»¬çš„å¿ƒæ€è¿˜æ˜¯ä¸¤ä¸ªå­¤ç«‹çš„éƒ¨åˆ†ï¼Œé‚£ä¹ˆ DevOps å¿…å°†é»¯ç„¶å¤±è‰²ã€‚\nDevOps çš„å®è·µå°±æ˜¯å°†å›¢é˜Ÿæ•´åˆåœ¨ä¸€èµ·ï¼Œæ‰“ç ´ IT ç»„ç»‡å†…éƒ¨çš„å­¤å²›ã€‚å› æ­¤ï¼Œå°†å®ƒä»¬æ•´åˆä¸ºç»Ÿä¸€å•å…ƒä»¥å®ç°å…±åŒç›®æ ‡æ˜¯ä»»ä½•å…¬å¸åœ¨é‡‡ç”¨ DevOps å®è·µæ—¶éœ€è¦å…‹æœçš„ç¬¬ä¸€ä¸ªéšœç¢ã€‚\n2. ä»ä¼ ç»ŸåŸºç¡€è®¾æ–½è½¬å‘å¾®æœåŠ¡æ¶æ„ å¤šå¹´æ¥ï¼Œè¿™äº›å…¬å¸ä¸€ç›´å­˜åœ¨é—ç•™çš„åŸºç¡€è®¾æ–½ï¼Œä½†å¦‚æœä»–ä»¬å¿…é¡»å¿«é€Ÿåˆ›æ–°ï¼Œä»–ä»¬å¿…é¡»æ‘†è„±è¿™ç§æ–¹æ³•å¹¶é‡‡ç”¨æ›´å…·å¯æ‰©å±•æ€§çš„å¾®æœåŠ¡æ¶æ„ã€‚å°†åŸºç¡€è®¾æ–½å³ä»£ç ä¸å¾®æœåŠ¡ä¸€èµ·ä½¿ç”¨æ˜¯è¿ˆå‘æŒç»­åˆ›æ–°æœªæ¥çš„åˆä¸€æ­¥ã€‚\nç„¶è€Œï¼Œå°†æ¶æ„å˜ä¸ºå¾®æœåŠ¡æ¶æ„ç³»ç»Ÿå­˜åœ¨å¾ˆå¤§çš„éšœç¢ã€‚é‡‡ç”¨å¾®æœåŠ¡æ¶æ„éœ€è¦é‡‡ç”¨æœ€ä½³çš„ DevOps å®è·µä»¥åŠ CI/CD å®è·µã€‚è¿™ä¸ºå›¢é˜Ÿå¸¦æ¥äº†å·¨å¤§çš„å·¥ä½œé‡å’Œè¿ç»´æŒ‘æˆ˜ï¼ŒåŒæ—¶ä¹Ÿå¢åŠ äº†æˆæœ¬å› ç´ ã€‚\nç¡®å®ï¼Œå°†å¼€å‘ä¸éƒ¨ç½²è½¬å˜ä¸ºç°ä»£çš„è½¯ä»¶å¼€å‘æ–¹æ¡ˆå¯èƒ½ä¼šå¾ˆç—›è‹¦ï¼Œä½†ä¸€æ—¦é‡‡ç”¨å°±å¯ä»¥ä½¿æ‚¨çš„å›¢é˜Ÿå˜å¾—æ›´åŠ é«˜æ•ˆä¸å¯æ‰©å±•ã€‚\n3. å¼€å‘å’Œè¿ç»´å·¥å…·é›†çš„å†²çª å¼€å‘å›¢é˜Ÿçš„ç›®æ ‡å’ŒæŒ‡æ ‡å®Œå…¨ä¸åŒï¼Œå› æ­¤ä»–ä»¬å¯èƒ½éœ€è¦ä¸€ä¸ªè¿ç»´å›¢é˜Ÿå¯èƒ½ä¸éœ€è¦çš„å·¥å…·é›†ã€‚å› æ­¤ï¼Œå¿…é¡»å°†ä¸¤ä¸ªå›¢é˜Ÿèšé›†åœ¨ä¸€èµ·ï¼Œä»¥äº†è§£ä»–ä»¬ä¸¤è€…å¯ä»¥åˆä½œçš„ä½ç½®ï¼Œå¹¶æ•´åˆå¯¹ä»–ä»¬ä¸¤è€…éƒ½æœ‰æ„ä¹‰çš„å·¥å…·ï¼Œå¹¶ç»Ÿä¸€ä»–ä»¬å¯ä»¥ç›‘æ§çš„ç›®æ ‡å’ŒæŒ‡æ ‡ã€‚\nä¸€äº›å›¢é˜Ÿå¯èƒ½ä¸æ„¿æ„ä½¿ç”¨ä¼ ç»Ÿå·¥å…·ï¼Œè¿™äº›å·¥å…·ä¸ä»…æŠ€æœ¯ä¸Šè¾ƒå·®ï¼Œè€Œä¸”ç”±äºå…¼å®¹æ€§é—®é¢˜ä¹Ÿä¼šé™ä½æ•´ä¸ªåŸºç¡€æ¶æ„çš„é€Ÿåº¦ã€‚å› æ­¤ï¼Œè¯·ç¡®ä¿æ­£åœ¨ä½¿ç”¨çš„å·¥å…·ä¸å…¬å¸çš„äº§å“æ„¿æ™¯ä¿æŒä¸€è‡´ã€‚\næ€»ç»“ æ— è®ºæˆ‘ä»¬åœ¨å…¬å¸æ–¹é¢ä¸ä¸ªäººæ–¹é¢æœ‰å¤šä¹ˆä¸åŒï¼Œæˆ‘ä»¬éƒ½å¿…é¡»æ‘’å¼ƒå·®å¼‚å¹¶ä½œä¸ºä¸€ä¸ªæ•´ä½“æ¥å®ç°å®¢æˆ·éœ€æ±‚å’Œè§£å†³å®¢æˆ·çš„é—®é¢˜ã€‚å¦‚æœæˆ‘ä»¬èƒ½å¤Ÿåœ¨æˆ‘ä»¬å›¢é˜Ÿçš„å·¥ä½œæ–‡åŒ–ä¸­å¸æ”¶è¿™ç§ç†å¿µï¼Œé‚£ä¹ˆ DevOps å°†æˆä¸ºé‡è§†è¿‡ç¨‹å’Œæ”¶ç›Šçš„å®è´µå®è·µã€‚\n","date":1557366911,"expirydate":-62135596800,"kind":"page","lang":"zh","lastmod":1557366911,"objectID":"de0d1781bad24bf64c51ae06a72e064f","permalink":"https://guoxudong.io/post/all-about-devops-fundamentalsyou-ever-wanted-to-know/","publishdate":"2019-05-09T09:55:11+08:00","relpermalink":"/post/all-about-devops-fundamentalsyou-ever-wanted-to-know/","section":"post","summary":"åœ¨å½“å‰çš„ IT å®è·µä¸­ï¼Œä¸ºäº†æ”¯æŒé«˜æ•ˆå’Œå¿«æ·çš„è½¯ä»¶å¼€å‘ï¼Œå·²ç»å‡ºç°äº†ä¼Ÿå¤§çš„è½¬å˜--åœ¨ä¼ ç»Ÿçš„è½¯ä»¶æ¶æ„æ­£åœ¨é€æ¸è¢«å¾®æœåŠ¡æ¶æ„å–ä»£çš„æƒ…å†µä¸‹ï¼Œå¼€å‘ã€ QA å’Œè¿ç»´å›¢é˜Ÿä¸ºäº†æ‘†è„±äº†ä¹‹å‰ç›¸äº’å­¤ç«‹çš„çŠ¶å†µï¼Œå¼€å§‹å°†å¼€å‘ä¸è¿ç»´ç›¸äº’å…³è”å¹¶èåˆç»Ÿä¸€ï¼Œæˆ‘ä»¬å°†å…¶ç§°ä¸ºDevOpsã€‚","tags":["devops"],"title":"ä»€ä¹ˆæ˜¯ DevOps ï¼ŸDevOps æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ","type":"post"},{"authors":["éƒ­æ—­ä¸œ"],"categories":["kustomize"],"content":" å‰è¨€ é¦–å…ˆæ˜ç¡®è½¯ä»¶ç‰ˆæœ¬ï¼Œæˆ‘è¿™é‡Œä½¿ç”¨çš„æ˜¯ Jenkins ver. 2.121.3 ï¼Œè¿™ä¸ªç‰ˆæœ¬æ¯”è¾ƒè€ï¼Œå…¶ä¸Šå®‰è£… Kubernetes æ’ä»¶æ‰€ä½¿ç”¨ kubectl ç‰ˆæœ¬ä¹Ÿæ¯”è¾ƒè€ï¼Œæ— æ³•ä½¿ç”¨ Kustomize çš„ yaml æ–‡ä»¶éœ€è¦çš„ apiVersion: apps/v1 ï¼Œç›´æ¥ä½¿ç”¨ç”Ÿæˆ deploy.yaml æ–‡ä»¶ä¼šæŠ¥é”™ï¼Œæ‰€ä»¥è¿™é‡Œé€‰æ‹©äº†è‡ªå·±æ„å»ºä¸€ä¸ªåŒ…å« kubectl å’Œ kustomize çš„é•œåƒï¼Œåœ¨é•œåƒä¸­ä½¿ç”¨ Kustomize ç”Ÿæˆæ‰€éœ€ yaml æ–‡ä»¶å¹¶åœ¨ Kubernetes ä¸Šéƒ¨ç½²ã€‚\nè½¯ä»¶ç‰ˆæœ¬    è½¯ä»¶ ç‰ˆæœ¬     Jenkins 2.121.3   kubectl v1.14.1   kustomize v2.0.3    å‰æœŸå‡†å¤‡  Jenkins ï¼šæœ¬ç¯‡ä½¿ç”¨ Jenkins æ¼”ç¤º CI/CD ï¼Œå®‰è£… Jenkins å°±ä¸åœ¨èµ˜è¿°ï¼Œå¯ä»¥ä½¿ç”¨å¤šç§æ–¹æ³•å®‰è£… Jenkins ï¼Œè¯¦ç»†æ–¹æ³•è§å®˜ç½‘ã€‚åŒæ—¶ã€‚ CI/CD çš„å·¥å…·æœ‰å¾ˆå¤šï¼Œè¿™é‡Œä¸ºäº†çœäº‹ä½¿ç”¨ç¬”è€…ç°æœ‰çš„ Jenkins è¿›è¡Œæ¼”ç¤ºï¼Œä¸æ¨èä½¿ç”¨åŒç¬”è€…ä¸€æ ·çš„ç‰ˆæœ¬ï¼Œè¯·ä½¿ç”¨è¾ƒæ–°çš„ç‰ˆæœ¬ï¼›åŒæ—¶ä¹Ÿå¯ä»¥ä½¿ç”¨å…¶ä»– CI/CD å·¥å…·ï¼Œè¿™é‡Œæ¨èä½¿ç”¨ droneã€‚å¦‚æœæœ‰æ›´å¥½çš„æ–¹æ¡ˆï¼Œæ¬¢è¿äº¤æµï¼Œå¯ä»¥åœ¨å…³äºä¸­æ‰¾åˆ°æˆ‘çš„è”ç³»æ–¹å¼ã€‚ - Web åº”ç”¨ï¼šè¿™é‡Œä½¿ç”¨ flask å†™äº†ä¸€ä¸ªç®€å•çš„ web åº”ç”¨ï¼Œç”¨äºæ¼”ç¤ºï¼ŒåŒæ ·ä»¥ä¸Šä¼  dockerhub [```guoxudongdocker/flask-python```](https://hub.docker.com/r/guoxudongdocker/flask-python) ## ç›®å½•ç»“æ„ é¦–å…ˆçœ‹ä¸€ä¸‹ç›®å½•ç»“æ„ï¼Œç›®å½•ä¸­åŒ…æ‹¬ ```Dockerfile``` ã€ ```Jenkinsfile``` ã€ Kustomize è¦ä½¿ç”¨çš„ ```deploy``` ç›®å½•ä»¥åŠ web åº”ç”¨ç›®å½•ã€‚  bush\n  . â”œâ”€â”€ Dockerfile â”œâ”€â”€ Jenkinsfile â”œâ”€â”€ app â”‚ â”œâ”€â”€ main.py â”‚ â””â”€â”€ uwsgi.ini â””â”€â”€ deploy â”œâ”€â”€ base â”‚ â”œâ”€â”€ deployment.yaml â”‚ â”œâ”€â”€ kustomization.yaml â”‚ â””â”€â”€ service.yaml â””â”€â”€ overlays â”œâ”€â”€ dev â”‚ â”œâ”€â”€ healthcheck_patch.yaml â”‚ â”œâ”€â”€ kustomization.yaml â”‚ â””â”€â”€ memorylimit_patch.yaml â””â”€â”€ prod â”œâ”€â”€ healthcheck_patch.yaml â”œâ”€â”€ kustomization.yaml â””â”€â”€ memorylimit_patch.yaml\n è¿™é‡Œå¯ä»¥çœ‹åˆ° overlays æ€»å…±æœ‰ä¸¤ä¸ªå­ç›®å½• `dev` å’Œ `prod` ï¼Œåˆ†åˆ«ä»£è¡¨ä¸åŒç¯å¢ƒï¼Œåœ¨ä¸åŒçš„ç¯å¢ƒä¸­ï¼Œåº”ç”¨ä¸åŒçš„é…ç½®ã€‚ ## Jenkins é…ç½® Jenkins çš„é…ç½®ç›¸å¯¹ç®€å•ï¼Œåªéœ€è¦æ–°å»ºä¸€ä¸ª pipeline ç±»å‹çš„ job ![WX20190506-180159](https://wx4.sinaimg.cn/large/ad5fbf65gy1g2rr57oixbj20tn0ogq6v.jpg) å¢åŠ å‚æ•°åŒ–æ„å»ºï¼Œ**æ³¨**ï¼šå‚æ•°åŒ–æ„å»ºéœ€è¦å®‰è£… Jenkins æ’ä»¶ ![WX20190506-180918](https://ws4.sinaimg.cn/large/ad5fbf65gy1g2rrcb5ic9j21470q7mz8.jpg) ç„¶åé…ç½®ä»£ç ä»“åº“å³å¯ ![WX20190507-094958](https://ws3.sinaimg.cn/large/ad5fbf65gy1g2sij1xlb2j214w0nw0uw.jpg) ## Pipeline  groovy podTemplate(label: \u0026lsquo;jnlp-slave\u0026rsquo;, cloud: \u0026lsquo;kubernetes\u0026rsquo;, containers: [ containerTemplate( name: \u0026lsquo;jnlp\u0026rsquo;, image: \u0026lsquo;guoxudongdocker/jenkins-slave\u0026rsquo;, alwaysPullImage: true ), containerTemplate(name: \u0026lsquo;kubectl\u0026rsquo;, image: \u0026lsquo;guoxudongdocker/kubectl:v1.14.1\u0026rsquo;, command: \u0026lsquo;cat\u0026rsquo;, ttyEnabled: true), ], nodeSelector:\u0026lsquo;ci=jenkins\u0026rsquo;, volumes: [ hostPathVolume(mountPath: \u0026lsquo;/var/run/docker.sock\u0026rsquo;, hostPath: \u0026lsquo;/var/run/docker.sock\u0026rsquo;), hostPathVolume(mountPath: \u0026lsquo;/usr/bin/docker\u0026rsquo;, hostPath: \u0026lsquo;/usr/bin/docker\u0026rsquo;), hostPathVolume(mountPath: \u0026lsquo;/usr/local/jdk\u0026rsquo;, hostPath: \u0026lsquo;/usr/local/jdk\u0026rsquo;), hostPathVolume(mountPath: \u0026lsquo;/usr/local/maven\u0026rsquo;, hostPath: \u0026lsquo;/usr/local/maven\u0026rsquo;), secretVolume(mountPath: \u0026lsquo;/home/jenkins/.kube\u0026rsquo;, secretName: \u0026lsquo;devops-ctl\u0026rsquo;), ], ) { node(\u0026ldquo;jnlp-slave\u0026rdquo;){ stage(\u0026lsquo;Git Checkout\u0026rsquo;){ git branch: \u0026lsquo;${branch}\u0026rsquo;, url: \u0026lsquo;https://github.com/sunny0826/flask-python.git' } stage(\u0026lsquo;Build and Push Image\u0026rsquo;){ withCredentials([usernamePassword(credentialsId: \u0026lsquo;docker-register\u0026rsquo;, passwordVariable: \u0026lsquo;dockerPassword\u0026rsquo;, usernameVariable: \u0026lsquo;dockerUser\u0026rsquo;)]) { sh \u0026ldquo;\u0026rsquo; docker login -u ${dockerUser} -p ${dockerPassword} docker build -t guoxudongdocker/flask-python:${Tag} . docker push guoxudongdocker/flask-python:${Tag} \u0026ldquo;\u0026rsquo; } } stage(\u0026lsquo;Deploy to K8s\u0026rsquo;){ if (\u0026lsquo;true\u0026rsquo; == \u0026ldquo;${deploy}\u0026rdquo;) { container(\u0026lsquo;kubectl\u0026rsquo;) { sh \u0026ldquo;\u0026rsquo; cd deploy/base kustomize edit set image guoxudongdocker/flask-python:${Tag} \u0026ldquo;\u0026rsquo; echo \u0026ldquo;éƒ¨ç½²åˆ° Kubernetes\u0026rdquo; if (\u0026lsquo;prod\u0026rsquo; == \u0026ldquo;${ENV}\u0026rdquo;) { sh \u0026ldquo;\u0026rsquo; # kustomize build deploy/overlays/prod | kubectl apply -f - kubectl applt -k deploy/overlays/prod \u0026ldquo;\u0026rsquo; }else { sh \u0026ldquo;\u0026rsquo; # kustomize build deploy/overlays/dev | kubectl apply -f - kubectl applt -k deploy/overlays/dev \u0026ldquo;\u0026rsquo; }\t} }else{ echo \u0026ldquo;è·³è¿‡Deploy to K8s\u0026rdquo; }\n } }  }\n è¿™é‡Œè¦æ³¨æ„å‡ ç‚¹ï¼š - æ‹‰å– git ä¸­çš„ä»£ç éœ€è¦åœ¨ jenkins ä¸­é…ç½®å‡­æ®ã€‚ - ç¬”è€…çš„ jenkins éƒ¨ç½²åœ¨ Kubernetes ä¸Šï¼Œè¦æ“ä½œé›†ç¾¤çš„è¯ï¼Œéœ€è¦å°† kubeconfig ä»¥ Secret çš„å½¢å¼æŒ‚è½½åˆ° jenkins æ‰€åœ¨ namespaceã€‚ - `jenkins-slave` éœ€è¦ Java ç¯å¢ƒè¿è¡Œï¼Œæ‰€ä»¥è¦å°†å®¿ä¸»æœºçš„ `jdk` æŒ‚è½½åˆ° `jenkins-slave` ä¸­ã€‚ - åŒæ ·çš„ï¼Œå®¿ä¸»æœºä¸­éœ€è¦äº‹å…ˆå®‰è£… `docker`ã€‚ - `docker-register` ä¸º dockerhub çš„ç™»å½•å‡­è¯ï¼Œéœ€è¦åœ¨ jenkins ä¸­æ·»åŠ ç›¸åº”çš„å‡­è¯ã€‚ ## æ¼”ç¤º image: caption: \u0026quot;Image from: [**Pexels**](https://www.pexels.com)\u0026quot; focal_point: \u0026quot;\u0026quot; preview_only: false --- ### å¼€å§‹æ„å»º è¿™é‡Œé€‰æ‹©ç¯å¢ƒã€åˆ†æ”¯ï¼Œå¡«å…¥ç‰ˆæœ¬å³å¯å¼€å§‹æ„å»ºï¼Œ**æ³¨æ„ï¼š**è¿™é‡Œçš„ç‰ˆæœ¬å°†å·² tag çš„å½¢å¼æ ‡è®° docker é•œåƒã€‚ ![WX20190507-095142](https://ws2.sinaimg.cn/large/ad5fbf65gy1g2sikst7tuj20ob0evabw.jpg) è¿™é‡Œå°±å¯ä»¥çœ‹åˆ°æ„å»ºæˆåŠŸäº† ![WX20190507-103721](https://ws2.sinaimg.cn/large/ad5fbf65ly1g2sjw9w22ej20v80km0w3.jpg) ### æŸ¥çœ‹ç»“æœ è¿™é‡Œä¸ºäº†æ–¹ä¾¿ï¼ˆå…¶å®å°±æ˜¯æ‡’ï¼‰ï¼Œæˆ‘å°±ä¸ç»™è¿™ä¸ªæœåŠ¡æ·»åŠ  ingress æ¥ä»å¤–éƒ¨è®¿é—®äº†ï¼Œè¿™é‡Œä½¿ç”¨ [KT](https://yq.aliyun.com/articles/690519) æ‰“é€šæœ¬åœ°å’Œ k8s é›†ç¾¤ç½‘ç»œæ¥è¿›è¡Œè°ƒè¯•ã€‚ \u0026gt;ä¸ºäº†ç®€åŒ–åœ¨Kubernetesä¸‹è¿›è¡Œè”è°ƒæµ‹è¯•çš„å¤æ‚åº¦ï¼Œäº‘æ•ˆåœ¨SSHéš§é“ç½‘ç»œçš„åŸºç¡€ä¸Šå¹¶ç»“åˆKubernetesç‰¹æ€§æ„å»ºäº†ä¸€æ¬¾é¢å‘å¼€å‘è€…çš„è¾…åŠ©å·¥å…·kt è¿™é‡Œçœ‹åˆ°è¿™ä¸ªæœåŠ¡æ­£å¸¸å¯åŠ¨äº† ![WX20190507-104154](https://ws2.sinaimg.cn/large/ad5fbf65ly1g2sk11dnzxj20av027jrn.jpg) ### å‘å¸ƒæ–°ç‰ˆæœ¬ æ›´æ–° web æœåŠ¡å¹¶æäº¤ ![WX20190507-104936](https://ws4.sinaimg.cn/large/ad5fbf65gy1g2sk94v1c5j209702vwej.jpg) æŒ‰ç…§ä¸Šé¢æ­¥éª¤åœ¨ jenkins ä¸­é‡æ–°æ„å»ºï¼Œå½“ç„¶ä¹Ÿå¯ä»¥é…ç½®é’©å­ï¼Œæ¯æ¬¡ä»£ç æäº¤åè‡ªåŠ¨æ„å»º ### æŸ¥çœ‹æŸ¥çœ‹æ–°ç‰ˆæœ¬ åŒä¸Šé¢ä¸€æ ·ï¼Œåœ¨æ„å»ºæˆåŠŸåæŸ¥çœ‹æœåŠ¡æ˜¯å¦æ›´æ–° ![WX20190507-105539](https://wx4.sinaimg.cn/large/ad5fbf65gy1g2skfczaz4j20by01smx7.jpg) å¯ä»¥çœ‹åˆ°ï¼Œç‰ˆæœ¬å·²ç»æ›´æ–°äº† ### å‘å¸ƒç”Ÿäº§ç¯å¢ƒ è¿™é‡Œæ¨¡æ‹Ÿä¸€ä¸‹å‘å¸ƒç”Ÿäº§ç¯å¢ƒï¼Œå‡è®¾ç”Ÿäº§ç¯å¢ƒæ˜¯åœ¨ `devops-prod` çš„ namespace ä¸­ï¼Œè¿™é‡Œåªåšæ¼”ç¤ºä¹‹ç”¨ï¼ŒçœŸæ­£çš„ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œå¯èƒ½å­˜åœ¨ä¸æ­¢ä¸€ä¸ª k8s é›†ç¾¤ï¼Œè¿™æ—¶éœ€è¦ä¿®æ”¹ Jenkinsfile ä¸­çš„ `secretVolume` æ¥æŒ‚è½½ä¸åŒ k8s çš„ kubeconfig æ¥è¾¾åˆ°å‘å¸ƒåˆ°ä¸åŒé›†ç¾¤çš„ç›®çš„ã€‚å½“ç„¶ï¼Œä¸€èˆ¬å‘å¸ƒç”Ÿäº§ç¯å¢ƒåªéœ€é€‰æ‹©æµ‹è¯•é€šè¿‡çš„é•œåƒæ¥å‘å¸ƒå³å¯ï¼Œä¸éœ€è¦åœ¨è¿›è¡Œæ„å»ºæ‰“åŒ…ã€‚ ![WX20190507-110730](https://ws3.sinaimg.cn/large/ad5fbf65gy1g2skrnbjyuj20fc0bjmxp.jpg) ### æŸ¥çœ‹ç”Ÿäº§ç‰ˆæœ¬ ![WX20190507-110850](https://ws1.sinaimg.cn/large/ad5fbf65ly1g2skt3rp4yj20aq010glj.jpg) ### æ€»ç»“ ä¸Šé¢çš„è¿™äº›æ­¥éª¤ç®€å•çš„æ¼”ç¤ºäº†ä½¿ç”¨ jenkins è¿›è¡Œ CI/CD çš„æµç¨‹ï¼Œæµç¨‹ååˆ†ç®€å•ï¼Œè¿™é‡Œä»…ä¾›å‚è€ƒ ## Kustomize çš„ä½œç”¨ é‚£ä¹ˆï¼Œ Kustomize åœ¨æ•´ä¸ªæµç¨‹ä¸­åˆæ‰®æ¼”äº†ä¸€ä¸ªä»€ä¹ˆè§’è‰²å‘¢ï¼Ÿ ### æ›´æ–°é•œåƒ åœ¨ `jenkinsfile` ä¸­å¯ä»¥çœ‹åˆ°ï¼Œ kustomize æ›´æ–°äº†åŸºç¡€é…ç½®çš„é•œåƒç‰ˆæœ¬ï¼Œè¿™é‡Œæˆ‘ä»¬ä¹‹å‰ä¸€ç›´æ˜¯ä½¿ç”¨ `sed -i \u0026quot;s/#Tag/${Tag}/g\u0026quot; deploy.yaml` æ¥è¿›è¡Œæ›¿æ¢äº†ï¼Œä½†æ˜¯ä¸åŒç¯å¢ƒå­˜åœ¨æ¯”è¾ƒå¤šçš„å·®å¼‚ï¼Œéœ€è¦æ›¿æ¢çš„è¶Šæ¥è¶Šå¤šï¼Œå¯¼è‡´ Jekninsfile ä¹Ÿè¶Šæ¥è¶Šè‡ƒè‚¿å’Œéš¾ä»¥ç»´æŠ¤ã€‚ kustomize è§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚  bash kustomize edit set image guoxudongdocker/flask-python:${Tag}\n ### ç¯å¢ƒåŒºåˆ† ä¸Šé¢ä¹Ÿæåˆ°äº†ï¼Œä¸åŒçš„ç¯å¢ƒæˆ‘ä»¬å­˜åœ¨è¿™è®¸å¤šå·®å¼‚ï¼Œè™½ç„¶çœ‹ä¸Šå»å¤§è‡´ç±»ä¼¼ï¼Œä½†æ˜¯å¾ˆå¤šç»†èŠ‚éƒ½éœ€è¦ä¿®æ”¹ã€‚è¿™æ—¶ kustomize å°±èµ·åˆ°äº†å¾ˆå¤§çš„ä½œç”¨ï¼Œä¸åŒç¯å¢ƒç›¸åŒçš„é…ç½®éƒ½æ”¾åœ¨ `base` ä¸­ï¼Œè€Œå·®å¼‚å°±å¯ä»¥åœ¨ `overlays` ä¸­å®ç°ã€‚  bash . â”œâ”€â”€ base â”‚ â”œâ”€â”€ deployment.yaml â”‚ â”œâ”€â”€ kustomization.yaml â”‚ â””â”€â”€ service.yaml â””â”€â”€ overlays â”œâ”€â”€ dev â”‚ â”œâ”€â”€ healthcheck_patch.yaml â”‚ â”œâ”€â”€ kustomization.yaml â”‚ â””â”€â”€ memorylimit_patch.yaml â””â”€â”€ prod â”œâ”€â”€ healthcheck_patch.yaml â”œâ”€â”€ kustomization.yaml â””â”€â”€ memorylimit_patch.yaml\nå¯ä»¥çœ‹åˆ°ï¼Œ `base` ä¸­ç»´æŠ¤äº†é¡¹ç›®å…±åŒçš„åŸºç¡€é…ç½®ï¼Œå¦‚æœæœ‰é•œåƒç‰ˆæœ¬ç­‰åŸºç¡€é…ç½®éœ€è¦ä¿®æ”¹ï¼Œå¯ä»¥ä½¿ç”¨ `kustomize edit set image ...` æ¥ç›´æ¥ä¿®æ”¹åŸºç¡€é…ç½®ï¼Œè€ŒçœŸæ­£ä¸åŒç¯å¢ƒï¼Œæˆ–è€…ä¸åŒä½¿ç”¨æƒ…å†µçš„é…ç½®åˆ™åœ¨ `overlays` ä¸­ ä»¥ patch çš„å½¢å¼æ·»åŠ é…ç½®ã€‚è¿™é‡Œæˆ‘çš„é…ç½®æ˜¯ prod ç¯å¢ƒéƒ¨ç½²çš„å‰¯æœ¬ä¸º2ï¼ŒåŒæ—¶ç»™åˆ°çš„èµ„æºä¹Ÿæ›´å¤šï¼Œè¯¦æƒ…å¯ä»¥åœ¨ [Github](https://github.com/sunny0826/flask-python) ä¸ŠæŸ¥çœ‹ã€‚ ### ä¸ kubectl çš„é›†æˆ åœ¨ jenkinsfile ä¸­å¯ä»¥çœ‹åˆ°  bash\nkustomize build deploy/overlays/dev | kubectl apply -f - kubectl apply -k deploy/overlays/dev ```\nè¿™ä¸¤æ¡å‘½ä»¤çš„æ‰§è¡Œæ•ˆæœæ˜¯ä¸€æ ·çš„ï¼Œåœ¨ kubectl v1.14.0 ä»¥ä¸Šçš„ç‰ˆæœ¬ä¸­ï¼Œå·²ç»é›†æˆäº† kustomize ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ kubectl è¿›è¡Œéƒ¨ç½²ã€‚\nç»“è¯­ è¿™é‡Œåªæ˜¯å¯¹ kustomize åœ¨ CI/CD ä¸­ç®€å•åº”ç”¨çš„å±•ç¤ºï¼Œåªæ˜¯ä¸€ç§æ¯”è¾ƒç®€å•å’ŒåŸºç¡€çš„ä½¿ç”¨ï¼ŒçœŸæ­£çš„ CI æµç¨‹è¦æ¯”è¿™ä¸ªå¤æ‚çš„å¤šï¼Œè¿™é‡Œåªæ˜¯ä¸ºäº†æ¼”ç¤º kustomize çš„ä½¿ç”¨è€Œä¸´æ—¶æ­å»ºçš„ã€‚è€Œ kustomize è¿˜æœ‰å¾ˆå¤šé»‘ç§‘æŠ€çš„ç”¨æ³•ï¼Œå°†ä¼šåœ¨åç»­çš„æ–‡ç« ä¸­ä»‹ç»ã€‚\n","date":1557132388,"expirydate":-62135596800,"kind":"page","lang":"zh","lastmod":1557132388,"objectID":"bf98527e66030d5f83f2abbed286f159","permalink":"https://guoxudong.io/post/kustomize-3/","publishdate":"2019-05-06T16:46:28+08:00","relpermalink":"/post/kustomize-3/","section":"post","summary":"æœ¬ç¯‡ä¸ºç³»åˆ—æ–‡ç« ç¬¬ä¸‰ç¯‡ï¼Œä½¿ç”¨ jenkins å‘å¸ƒä¸€ä¸ªç®€å•çš„ä½¿ç”¨ flask å†™çš„ web é¡¹ç›®ï¼Œæ¥æ¼”ç¤ºåœ¨ CI/CD æµç¨‹ä¸­ Kustomize çš„ç®€å•ä½¿ç”¨ã€‚","tags":["kubernetes","kustomize","å·¥å…·"],"title":"ä½¿ç”¨ Kustomize å¸®ä½ ç®¡ç† kubernetes åº”ç”¨ï¼ˆä¸‰ï¼‰ï¼šå°† Kustomize åº”ç”¨äº CI/CD","type":"post"},{"authors":null,"categories":["devops"],"content":" DevOps ä¸ä»…ä»…æ˜¯å¼€å‘å’Œè¿è¥å›¢é˜Ÿã€‚å¦‚æœæ‚¨æƒ³è¦å……åˆ†å‘æŒ¥å‡º DevOps æ–¹æ³•çš„æ•æ·æ€§å’Œå“åº”åŠ›ï¼Œåˆ™å¿…é¡»åœ¨åº”ç”¨çš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸå†…åŒæ—¶å…¼é¡¾ IT å®‰å…¨æ€§ã€‚\nä¸ºä»€ä¹ˆï¼Ÿä»¥å¾€ï¼Œå®‰å…¨æ€§ä¼šåœ¨å¼€å‘çš„æœ€åé˜¶æ®µç”±ç‰¹å®šçš„å›¢é˜Ÿæ¥è´Ÿè´£å®ç°ã€‚å½“å¼€å‘å‘¨æœŸé•¿è¾¾æ•°æœˆã€ç”šè‡³æ•°å¹´æ—¶ï¼Œä¸Šè¿°åšæ³•ä¸å­˜åœ¨ä»»ä½•é—®é¢˜ï¼›ä½†æ˜¯ï¼Œè¿™ç§åšæ³•ç°åœ¨å·²ç»è¡Œä¸é€šäº†ã€‚æœ‰æ•ˆçš„ DevOps å¯é¡ºåˆ©æ¨è¿›å¿«é€Ÿé¢‘ç¹çš„å¼€å‘å‘¨æœŸï¼ˆæœ‰æ—¶å…¨ç¨‹åªæœ‰æ•°å‘¨æˆ–æ•°å¤©ï¼‰ï¼Œä½†æ˜¯è¿‡æ—¶çš„å®‰å…¨æªæ–½ä¼šå¯¹æ­¤é€ æˆè´Ÿé¢å½±å“ï¼Œå³ä½¿å¯¹äºæœ€é«˜æ•ˆçš„ DevOps è®¡åˆ’ä¹Ÿæ˜¯å¦‚æ­¤ã€‚\nç°åœ¨ï¼Œå®‰å…¨é˜²æŠ¤åœ¨ DevOps åä½œæ¡†æ¶ä¸­å±äºå…±åŒè´£ä»»ï¼Œè€Œä¸”éœ€è¦åœ¨æ•´ä¸ªå‘¨æœŸä¸­æ•´åˆç›¸åº”çš„å®‰å…¨åŠŸèƒ½ã€‚è¿™æ˜¯ä¸€ä¸ªéå¸¸é‡è¦çš„ç†å¿µã€‚å®ƒè¿˜ä½¿å¾—â€œDevSecOpsâ€ä¸€è¯åº”è¿è€Œç”Ÿï¼Œä»¥ç”¨äºå¼ºè°ƒå¿…é¡»ä¸º DevOps è®¡åˆ’æ‰“ä¸‹æ‰å®çš„å®‰å…¨åŸºç¡€ã€‚\nDevSecOps æ„å‘³ç€ï¼Œä»ä¸€å¼€å§‹å°±è¦è€ƒè™‘åº”ç”¨å’ŒåŸºç¡€æ¶æ„çš„å®‰å…¨æ€§ï¼›åŒæ—¶è¿˜è¦è®©æŸäº›å®‰å…¨ç½‘å…³å®ç°è‡ªåŠ¨åŒ–ï¼Œä»¥é˜²æ­¢ DevOps å·¥ä½œæµç¨‹å˜æ…¢ã€‚é€‰æ‹©æ­£ç¡®çš„å·¥å…·æ¥æŒç»­ç¡®ä¿å®‰å…¨æ€§æœ‰åŠ©äºå®ç°å®‰å…¨ç›®æ ‡ã€‚ä½†æ˜¯ï¼Œæœ‰æ•ˆçš„ DevOps å®‰å…¨é˜²æŠ¤éœ€è¦çš„ä¸ä»…æ˜¯æ–°å·¥å…·ã€‚å®ƒå»ºç«‹åœ¨ DevOps æ–‡åŒ–å˜é©çš„åŸºç¡€ä¸Šï¼Œä»¥ä¾¿å°½æ—©é›†æˆå®‰å…¨å›¢é˜Ÿçš„å·¥ä½œã€‚\nDevOps å®‰å…¨æ€§ä¸ºå†…ç½®ç‰¹æ€§ æ— è®ºæ‚¨å°†å…¶ç§°ä¸ºâ€œDevOpsâ€è¿˜æ˜¯â€œDevSecOpsâ€ï¼Œæœ€å¥½å§‹ç»ˆèƒ½åœ¨åº”ç”¨çš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸå†…ç¡®ä¿å®‰å…¨æ€§ã€‚DevSecOps å…³ä¹å†…ç½®å®‰å…¨æ€§ï¼Œè€Œä¸æ˜¯åº”ç”¨å’Œæ•°æ®å±‚é¢çš„å®‰å…¨æ€§ã€‚å¦‚æœå°†å®‰å…¨æ€§é—®é¢˜ç•™åˆ°å¼€å‘æµç¨‹çš„æœ€åç¯èŠ‚å†åŠ ä»¥è€ƒè™‘ï¼Œé‚£ä¹ˆé‡‡ç”¨ DevOps æ–¹æ¡ˆçš„ç»„ç»‡ä¼šå‘ç°è‡ªå·±çš„å¼€å‘å‘¨æœŸåˆå˜é•¿äº†ï¼Œè€Œè¿™æ˜¯ä»–ä»¬ä»ä¸€å¼€å§‹å°±æƒ³è¦é¿å…çš„æƒ…å†µã€‚\nåœ¨æŸç§ç¨‹åº¦ä¸Šï¼ŒDevSecOps å¼ºè°ƒï¼Œåœ¨ DevOps è®¡åˆ’åˆšå¯åŠ¨æ—¶å°±è¦é‚€è¯·å®‰å…¨å›¢é˜Ÿæ¥ç¡®ä¿ä¿¡æ¯çš„å®‰å…¨æ€§ï¼Œå¹¶åˆ¶å®šè‡ªåŠ¨å®‰å…¨é˜²æŠ¤è®¡åˆ’ã€‚å®ƒè¿˜å¼ºè°ƒï¼Œè¦å¸®åŠ©å¼€å‘äººå‘˜ä»ä»£ç å±‚é¢ç¡®ä¿å®‰å…¨æ€§ï¼›åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œå®‰å…¨å›¢é˜Ÿéœ€è¦é’ˆå¯¹å·²çŸ¥çš„å¨èƒåˆ†äº«å¯è§æ€§ä¿¡æ¯ã€æä¾›åé¦ˆå¹¶è¿›è¡Œæ™ºèƒ½åˆ†æã€‚è¿™å¯èƒ½è¿˜åŒ…æ‹¬ä¸ºå¼€å‘äººå‘˜æä¾›æ–°çš„å®‰å…¨åŸ¹è®­ï¼Œå› ä¸º DevSecOps å¹¶éå§‹ç»ˆç€çœ¼äºè¾ƒä¸ºä¼ ç»Ÿçš„åº”ç”¨å¼€å‘æ¨¡å¼ã€‚\né‚£ä¹ˆï¼Œæ€æ ·æ‰ç®—æ˜¯çœŸæ­£åœ°å®ç°äº†å†…ç½®å®‰å…¨æ€§ï¼Ÿå¯¹äºæ–°æ‰‹è€Œè¨€ï¼Œä¼˜è´¨çš„ DevSecOps ç­–ç•¥åº”èƒ½ç¡®å®šé£é™©æ‰¿å—èƒ½åŠ›å¹¶è¿›è¡Œé£é™©/æ”¶ç›Šåˆ†æã€‚åœ¨ä¸€ä¸ªç»™å®šçš„åº”ç”¨ä¸­ï¼Œéœ€è¦é…å¤‡å¤šå°‘ä¸ªå®‰å…¨æ§åˆ¶åŠŸèƒ½ï¼Ÿå¯¹äºä¸åŒçš„åº”ç”¨ï¼Œä¸Šå¸‚é€Ÿåº¦åˆæœ‰å¤šé‡è¦ï¼Ÿè‡ªåŠ¨æ‰§è¡Œé‡å¤ä»»åŠ¡æ˜¯ DevSecOps çš„å…³é”®æ‰€åœ¨ï¼Œå› ä¸ºåœ¨ç®¡é“ä¸­è¿è¡Œæ‰‹åŠ¨å®‰å…¨æ£€æŸ¥å¯èƒ½ä¼šéå¸¸è€—æ—¶ã€‚\nDevOps å®‰å…¨æ€§å¯è‡ªåŠ¨å®ç° ä¼ä¸šåº”è¯¥ï¼šç¡®ä¿é‡‡ç”¨æ—¶é—´çŸ­ã€é¢‘ç‡é«˜çš„å¼€å‘å‘¨æœŸï¼›é‡‡å–å®‰å…¨æªæ–½ï¼Œä»¥æœ€å¤§é™åº¦åœ°ç¼©çŸ­è¿è¥ä¸­æ–­æ—¶é—´ï¼›é‡‡ç”¨åˆ›æ–°æŠ€æœ¯ï¼Œå¦‚å®¹å™¨å’Œå¾®æœåŠ¡ï¼›åŒæ—¶ï¼Œè¿˜è¦ä¿ƒä½¿å¸¸è§çš„å­¤ç«‹å›¢é˜ŸåŠ å¼ºåˆä½œ â€” è¿™å¯¹æ‰€æœ‰ä¼ä¸šæ¥è¯´éƒ½æ˜¯ä¸€é¡¹è‰°å·¨çš„ä»»åŠ¡ã€‚ä¸Šè¿°æ‰€æœ‰ä¸¾æªéƒ½ä¸äººæœ‰å…³ï¼Œè€Œä¸”ä¼ä¸šå†…éƒ¨éœ€è¦ååŒåˆä½œï¼›ä½†æ˜¯ï¼Œè‡ªåŠ¨åŒ–æ‰æ˜¯æœ‰åŠ©äºåœ¨ DevSecOps æ¡†æ¶ä¸­å®ç°è¿™äº›äººå‘˜å˜åŒ–çš„å…³é”®æ‰€åœ¨ã€‚\né‚£ä¹ˆï¼Œä¼ä¸šåº”è¯¥åœ¨å“ªäº›æ–¹é¢å®ç°è‡ªåŠ¨åŒ–ï¼Ÿå…·ä½“åˆè¯¥æ€ä¹ˆåšå‘¢ï¼Ÿçº¢å¸½æä¾›äº†ç›¸åº”çš„ä¹¦é¢æŒ‡å—æ¥å¸®åŠ©è§£ç­”ä¸Šè¿°é—®é¢˜ã€‚ä¼ä¸šåº”è¯¥é€€åä¸€æ­¥ï¼Œå¹¶ç€çœ¼äºæ•´ä¸ªå¼€å‘å’Œè¿è¥ç¯å¢ƒã€‚å…¶ä¸­æ¶‰åŠï¼šæºæ§åˆ¶å­˜å‚¨åº“ï¼›å®¹å™¨æ³¨å†Œè¡¨ï¼›æŒç»­é›†æˆå’ŒæŒç»­éƒ¨ç½² (CI/CD) ç®¡é“ï¼›åº”ç”¨ç¼–ç¨‹æ¥å£ (API) çš„ç®¡ç†ã€ç¼–æ’å’Œå‘å¸ƒè‡ªåŠ¨åŒ–ï¼›ä»¥åŠè¿è¥ç®¡ç†å’Œç›‘æ§ã€‚\nå…¨æ–°çš„è‡ªåŠ¨åŒ–æŠ€æœ¯å·²å¸®åŠ©ä¼ä¸šæé«˜äº†å¼€å‘å®è·µçš„æ•æ·æ€§ï¼Œè¿˜åœ¨æ¨åŠ¨é‡‡ç”¨æ–°çš„å®‰å…¨æªæ–½æ–¹é¢èµ·åˆ°äº†é‡è¦ä½œç”¨ã€‚ä½†æ˜¯ï¼Œè‡ªåŠ¨åŒ–å¹¶ä¸æ˜¯è¿‘å¹´æ¥ IT é¢†åŸŸå‘ç”Ÿçš„å”¯ä¸€å˜åŒ–ã€‚ç°åœ¨ï¼Œå¯¹äºå¤§å¤šæ•° DevOps è®¡åˆ’è€Œè¨€ï¼Œå®¹å™¨å’Œå¾®æœåŠ¡ç­‰äº‘åŸç”ŸæŠ€æœ¯ä¹Ÿæ˜¯ä¸€ä¸ªéå¸¸é‡è¦çš„ç»„æˆéƒ¨åˆ†ã€‚æ‰€ä»¥ï¼Œä¼ä¸šå¿…é¡»è°ƒæ•´ DevOps å®‰å…¨æªæ–½ï¼Œä»¥é€‚åº”è¿™äº›æŠ€æœ¯ã€‚\nDevOps å®‰å…¨æ€§é€‚ç”¨äºå®¹å™¨å’Œå¾®æœåŠ¡ å¯é€šè¿‡å®¹å™¨å®ç°çš„è§„æ¨¡æ‰©å±•å’ŒåŸºç¡€æ¶æ„åŠ¨æ€æ€§æå‡æ”¹å˜äº†è®¸å¤šç»„ç»‡å¼€å±•ä¸šåŠ¡çš„æ–¹å¼ã€‚å› æ­¤ï¼ŒDevOps å®‰å…¨æ€§å®è·µå¿…é¡»é€‚åº”æ–°ç¯å¢ƒå¹¶éµå¾ªç‰¹å®šäºå®¹å™¨çš„å®‰å…¨å‡†åˆ™ã€‚äº‘åŸç”ŸæŠ€æœ¯ä¸é€‚åˆç”¨æ¥è½å®é™æ€å®‰å…¨ç­–ç•¥å’Œæ£€æŸ¥æ¸…å•ã€‚ç›¸åï¼Œç»„ç»‡å¿…é¡»åœ¨åº”ç”¨å’ŒåŸºç¡€æ¶æ„ç”Ÿå‘½å‘¨æœŸçš„æ¯ä¸ªé˜¶æ®µç¡®ä¿æŒç»­å®‰å…¨å¹¶æ•´åˆç›¸åº”çš„å®‰å…¨åŠŸèƒ½ã€‚\nDevSecOps æ„å‘³ç€ï¼Œè¦åœ¨åº”ç”¨å¼€å‘çš„æ•´ä¸ªè¿‡ç¨‹ä¸­ç¡®ä¿å®‰å…¨æ€§ã€‚è¦å®ç°ä¸ç®¡é“çš„è¿™ç§é›†æˆéœ€è¦ç§‰æŒä¸€ç§å…¨æ–°çš„æ€ç»´æ–¹å¼ï¼Œå°±åƒä½¿ç”¨æ–°å·¥å…·ä¸€æ ·ã€‚è€ƒè™‘åˆ°è¿™ä¸€ç‚¹ï¼ŒDevOps å›¢é˜Ÿåº”è¯¥å®ç°å®‰å…¨é˜²æŠ¤è‡ªåŠ¨åŒ–ï¼Œä»¥ä¿æŠ¤æ•´ä½“ç¯å¢ƒå’Œæ•°æ®ï¼›åŒæ—¶å®ç°æŒç»­é›†æˆ/æŒç»­äº¤ä»˜æµç¨‹â€”â€”å¯èƒ½è¿˜è¦ç¡®ä¿å®¹å™¨ä¸­çš„å¾®æœåŠ¡çš„å®‰å…¨æ€§ã€‚\n   ç¯å¢ƒå’Œæ•°æ®å®‰å…¨æ€§ï¼š CI/CD æµç¨‹å®‰å…¨æ€§ï¼š     å®ç°ç¯å¢ƒçš„æ ‡å‡†åŒ–å’Œè‡ªåŠ¨åŒ–ã€‚\næ¯é¡¹æœåŠ¡éƒ½åº”å…·æœ‰æœ€å°çš„æƒé™ï¼Œä»¥æœ€å¤§é™åº¦åœ°å‡å°‘æœªç»æˆæƒçš„è¿æ¥å’Œè®¿é—®ã€‚ é›†æˆé€‚ç”¨äºå®¹å™¨çš„å®‰å…¨æ€§æ‰«æç¨‹åºã€‚\nåº”åœ¨å‘æ³¨å†Œè¡¨æ·»åŠ å®¹å™¨çš„è¿‡ç¨‹ä¸­å®ç°è¿™ä¸€ç‚¹ã€‚   å®ç°ç”¨æˆ·èº«ä»½å’Œè®¿é—®æ§åˆ¶åŠŸèƒ½çš„é›†ä¸­åŒ–ã€‚\nç”±äºè¦åœ¨å¤šä¸ªç‚¹å‘èµ·èº«ä»½éªŒè¯ï¼Œå› æ­¤ä¸¥æ ¼çš„è®¿é—®æ§åˆ¶å’Œé›†ä¸­å¼èº«ä»½éªŒè¯æœºåˆ¶å¯¹äºç¡®ä¿å¾®æœåŠ¡å®‰å…¨æ€§è€Œè¨€è‡³å…³é‡è¦ã€‚ è‡ªåŠ¨åœ¨ CI è¿‡ç¨‹ä¸­å®Œæˆå®‰å…¨æ€§æµ‹è¯•ã€‚\nå…¶ä¸­åŒ…æ‹¬åœ¨æ„å»ºè¿‡ç¨‹ä¸­è¿è¡Œå®‰å…¨æ€§é™æ€åˆ†æå·¥å…·ï¼›è€Œä¸”åœ¨æ„å»ºç®¡é“ä¸­æå–ä»»ä½•é¢„æ„å»ºå®¹å™¨æ˜ åƒæ—¶ï¼Œéƒ½è¦è¿›è¡Œæ‰«æï¼Œä»¥æ£€æŸ¥æ˜¯å¦å­˜åœ¨å·²çŸ¥çš„å®‰å…¨æ¼æ´ã€‚   ä½¿è¿è¡Œå¾®æœåŠ¡çš„å®¹å™¨ç›¸äº’éš”ç¦»å¹¶ä¸ç½‘ç»œéš”ç¦»ã€‚\nè¿™åŒ…æ‹¬ä¼ è¾“ä¸­å’Œé™æ­¢çš„æ•°æ®ï¼Œå› ä¸ºè·å–è¿™ä¸¤ç±»æ•°æ®æ˜¯æ”»å‡»è€…çš„é«˜ä»·å€¼ç›®æ ‡ã€‚ åœ¨éªŒæ”¶æµ‹è¯•æµç¨‹ä¸­åŠ å…¥é’ˆå¯¹å®‰å…¨æ€§åŠŸèƒ½çš„è‡ªåŠ¨åŒ–æµ‹è¯•ã€‚\nè‡ªåŠ¨æ‰§è¡Œè¾“å…¥éªŒè¯æµ‹è¯•ï¼Œå¹¶é’ˆå¯¹éªŒè¯æ“ä½œå®ç°èº«ä»½éªŒè¯å’ŒæˆæƒåŠŸèƒ½çš„è‡ªåŠ¨åŒ–ã€‚   åŠ å¯†åº”ç”¨ä¸æœåŠ¡é—´çš„æ•°æ®ã€‚\nå…·æœ‰é›†æˆå¼å®‰å…¨åŠŸèƒ½çš„å®¹å™¨ç¼–æ’å¹³å°æœ‰åŠ©äºæœ€å¤§é™åº¦åœ°é™ä½å‘ç”Ÿæœªç»æˆæƒè®¿é—®çš„å¯èƒ½æ€§ã€‚ è‡ªåŠ¨æ‰§è¡Œå®‰å…¨æ€§æ›´æ–°ï¼Œ\nä¾‹å¦‚é’ˆå¯¹å·²çŸ¥æ¼æ´æ‰“ä¿®è¡¥ã€‚é€šè¿‡ DevOps å®ç°è¿™ä¸€ç‚¹ã€‚è¿™æ ·ï¼Œåœ¨åˆ›å»ºè®°å½•åœ¨æ¡ˆçš„å¯è·Ÿè¸ªæ›´æ”¹æ—¥å¿—æ—¶ï¼Œç®¡ç†å‘˜ä¾¿æ— éœ€ç™»å½•ç”Ÿäº§ç³»ç»Ÿã€‚   å¼•å…¥å®‰å…¨çš„ API ç½‘å…³ã€‚\nå®‰å…¨çš„ API å¯æé«˜æˆæƒå’Œè·¯ç”±çš„å¯è§æ€§ã€‚é€šè¿‡å‡å°‘å…¬å¼€çš„ APIï¼Œç»„ç»‡å¯ä»¥å‡å°æ”»å‡»é¢ã€‚ å®ç°ç³»ç»Ÿå’ŒæœåŠ¡é…ç½®ç®¡ç†åŠŸèƒ½çš„è‡ªåŠ¨åŒ–ã€‚\nè¿™æ ·å¯ä»¥ç¡®ä¿éµå®ˆå®‰å…¨ç­–ç•¥ï¼Œé¿å…å‡ºç°äººä¸ºé”™è¯¯ã€‚å®¡æ ¸å’Œè¡¥æ•‘æ“ä½œä¹Ÿåº”å®ç°è‡ªåŠ¨åŒ–ã€‚    ","date":1556865434,"expirydate":-62135596800,"kind":"page","lang":"zh","lastmod":1556865434,"objectID":"ccc88bd829982ba3ee58672f1bca2a1e","permalink":"https://guoxudong.io/post/what-is-devsecops/","publishdate":"2019-05-03T14:37:14+08:00","relpermalink":"/post/what-is-devsecops/","section":"post","summary":"DevOps ä¸ä»…ä»…æ˜¯å¼€å‘å’Œè¿è¥å›¢é˜Ÿã€‚å¦‚æœæ‚¨æƒ³è¦å……åˆ†å‘æŒ¥å‡º DevOps æ–¹æ³•çš„æ•æ·æ€§å’Œå“åº”åŠ›ï¼Œåˆ™å¿…é¡»åœ¨åº”ç”¨çš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸå†…åŒæ—¶å…¼é¡¾ IT å®‰å…¨æ€§ã€‚","tags":["devops"],"title":"ä»€ä¹ˆæ˜¯ DevSecOps ?","type":"post"},{"authors":["éƒ­æ—­ä¸œ"],"categories":["Kubernetes"],"content":"è¯¥PPT ä¸º 2019å¹´4æœˆ26æ—¥ åœ¨äº‘æ –ç¤¾åŒºåˆ†äº«ä½¿ç”¨ï¼Œè¿™é‡Œç•™ä½œå±•ç¤ºå’Œè®°å½•ï¼Œä¸‹è½½åœ°å€å¯ä»¥å‚è€ƒä¸‹æ–¹é“¾æ¥ã€‚\n ç”±äºå›¾ç‰‡èµ„æºä½äº GitHub ä¸Šï¼Œå›½å†…è®¿é—®å¯èƒ½ä¼šæœ‰äº›æ…¢ï¼Œå»ºè®®ä¸‹è½½è§‚çœ‹ã€‚\nPPT ä¸‹è½½åœ°å€ï¼šhttps://yq.aliyun.com/articles/700084\n","date":1556621184,"expirydate":-62135596800,"kind":"page","lang":"zh","lastmod":1556621184,"objectID":"0d1cb10fa870ad734ab32c695f1484e7","permalink":"https://guoxudong.io/post/aliyun-share/","publishdate":"2019-04-30T18:46:24+08:00","relpermalink":"/post/aliyun-share/","section":"post","summary":"è¯¥PPT ä¸º 2019å¹´4æœˆ26æ—¥ åœ¨äº‘æ –ç¤¾åŒºåˆ†äº«ä½¿ç”¨ï¼Œè¿™é‡Œç•™ä½œå±•ç¤ºå’Œè®°å½•ã€‚","tags":["Kubernetes","é˜¿é‡Œäº‘"],"title":"4æœˆ29æ—¥ äº‘æ –ç¤¾åŒºåˆ†äº«PPT -- é˜¿é‡Œäº‘å®¹å™¨æœåŠ¡çš„ä¼˜åŠ¿ä¸è°ƒä¼˜","type":"post"},{"authors":null,"categories":["ç¿»è¯‘"],"content":"  è¯»å®Œ Kubernetes: Up and Running åï¼Œæˆ‘å†™ä¸‹äº†è¿™ç¯‡æ–‡ç« ã€‚æ—¨åœ¨ä¸ºé‚£äº›è®¤ä¸ºæ–‡ç«  TL;DR çš„äººè¿›è¡Œä¸€äº›æ€»ç»“ï¼Œè¿™åŒæ—¶ä¹Ÿæ˜¯ä¸€ç§å¼ºè¿«è‡ªå·±æ£€æŸ¥æ‰€é˜…è¯»å†…å®¹çš„å¥½æ–¹æ³•ã€‚\n åŸºäº Google Borg çš„å¼€æºç³»ç»Ÿ K8S( Kubernetes ) æ˜¯ä¸€ä¸ªéå¸¸å¼ºå¤§çš„å®¹å™¨ç¼–æ’è°ƒåº¦ç³»ç»Ÿã€‚ å…¶æ•´ä¸ªç”Ÿæ€ç³»ç»Ÿï¼ŒåŒ…æ‹¬ï¼šå·¥å…·ï¼Œæ¨¡å—ï¼Œé™„åŠ ç»„ä»¶ç­‰ï¼Œéƒ½æ˜¯ä½¿ç”¨ Golang è¯­è¨€ç¼–å†™çš„ï¼Œè¿™ä½¿å¾— K8S åŠå…¶å‘¨è¾¹ç”Ÿæ€ç³»ç»ŸåŸºæœ¬ä¸Šæ˜¯é¢å‘ API å¯¹è±¡ã€è¿è¡Œé€Ÿåº¦éå¸¸å¿«çš„äºŒè¿›åˆ¶æ–‡ä»¶çš„é›†åˆï¼Œå¹¶ä¸”è¿™äº›äºŒè¿›åˆ¶æ–‡ä»¶éƒ½æœ‰å¾ˆå¥½çš„æ–‡æ¡£è®°å½•ï¼Œæ˜“äºç¼–å†™å’Œæ„å»ºåº”ç”¨ç¨‹åºã€‚\nåœ¨æ·±å…¥äº†è§£ä¹‹å‰ï¼Œæˆ‘æƒ³å…ˆä»‹ç»ä¸€ä¸‹ K8S çš„ç«äº‰å¯¹æ‰‹ï¼šECS ã€ Nomad å’Œ Mesos ã€‚ECS æ˜¯ AWS è‡ªå·±çš„ä¸šåŠ¡ç¼–æ’è§£å†³æ–¹æ¡ˆï¼Œè€Œæœ€è¿‘ AWS ä¸Šä¹Ÿå¼•å…¥äº†ä¸€ä¸ªæ‰˜ç®¡çš„ K8S ç³»ç»Ÿ \u0026ndash; EKS ã€‚ä¸¤è€…éƒ½æä¾› FARGATE ï¼Œå…è®¸ç”¨æˆ·è¿è¡Œå…¶åº”ç”¨å¹¶å¿½ç•¥å…¶è¿è¡Œç‰©ç†èµ„æºã€‚\nK8S ä½œä¸ºä¸€ä¸ªå¼€æºç³»ç»Ÿï¼Œåœ¨é‡‡ç”¨é‡ä¸Šæ¯«æ— ç–‘é—®æ˜¯æœ€å¤§èµ¢å®¶ï¼ŒåŒæ—¶å®ƒä¹Ÿå¯ä»¥ä»¥æ‰˜ç®¡å½¢å¼åœ¨ä¸‰ä¸ªä¸»è¦äº‘æä¾›å•†ä¸Šæä¾›æœåŠ¡ã€‚ç„¶è€Œï¼Œå®ƒæ¯”å…¶ä»–ç³»ç»Ÿæ›´åŠ å¤æ‚ã€‚K8S å¯ä»¥å¤„ç†å‡ ä¹ä»»ä½•ç±»å‹çš„å®¹å™¨åŒ–å·¥ä½œè´Ÿè½½ï¼Œä½†è¿™å¹¶ä¸æ„å‘³ç€æ¯ä¸ªäººéƒ½éœ€è¦å®ƒã€‚ç”¨æˆ·ä¹Ÿå¯ä»¥é€‰æ‹©å…¶ä»–è§£å†³æ–¹æ¡ˆï¼Œä¾‹å¦‚ï¼Œå•ç‹¬éƒ¨ç½²åœ¨ AWS ä¸Šçš„äº’è”ç½‘äº§å“å¯ä»¥åœ¨ç”Ÿäº§ç¯å¢ƒå¾ˆå¥½çš„ä½¿ç”¨ ECS è€Œé K8Sã€‚\nè¯è™½å¦‚æ­¤ï¼Œk8sä¹Ÿæœ‰å…¶ç¥å¥‡ä¹‹å¤„ \u0026ndash; å®ƒå¯ä»¥åœ¨ä»»ä½•åœ°æ–¹éƒ¨ç½²ï¼ŒåŒæ—¶æ‹¥æœ‰ä¸€ä¸ªæ´»è·ƒçš„ç¤¾åŒºå’Œæ•°ç™¾ä¸ªæ ¸å¿ƒå¼€å‘äººå‘˜ï¼Œä»¥åŠå…¶å¹¿æ³›ç”Ÿæ€ç³»ç»Ÿä¸­çš„æ•°åƒä¸ªå…¶ä»–å¼€æºè´¡çŒ®è€…ã€‚å®ƒå¿«é€Ÿã€æ–°é¢–ã€æ¨¡å—åŒ–å’Œé¢å‘ API ï¼Œä½¿å…¶æˆä¸ºå¯¹äºæ„å»ºæ’ä»¶å’ŒæœåŠ¡éå¸¸å‹å¥½çš„ç³»ç»Ÿã€‚\nè¯ä¸å¤šè¯´ï¼Œè¿™é‡ŒæŠŠ K8S åˆ†ä¸ºçš„11ä¸ªéƒ¨åˆ†ä»‹ç» 1. Pods Pods æ˜¯ K8S ä¸­åˆ›å»ºæˆ–éƒ¨ç½²çš„æœ€å°åŸºæœ¬å•ä½ã€‚ä¸€ä¸ª pod å¯ä»¥ç”±å¤šä¸ªå®¹å™¨ç»„æˆï¼Œè¿™äº›å®¹å™¨å°†å½¢æˆä¸€ä¸ªéƒ¨ç½²åœ¨å•ä¸ªèŠ‚ç‚¹ä¸Šçš„å•å…ƒã€‚ä¸€ä¸ª pod åŒ…å«ä¸€ä¸ªå®¹å™¨ä¹‹é—´å…±äº«çš„ IPã€‚åœ¨å¾®æœåŠ¡ä¸­ï¼Œ pod å°†æ˜¯æ‰§è¡ŒæŸäº›åç«¯å·¥ä½œæˆ–æä¾›ä¼ å…¥è¯·æ±‚çš„å¾®æœåŠ¡çš„å•ä¸ªå®ä¾‹ã€‚\n2. Nodes Node å°±æ˜¯æœåŠ¡å™¨ã€‚å®ƒä»¬æ˜¯ K8S éƒ¨ç½²å…¶ pod çš„â€œè£¸æœºâ€ï¼ˆä¹Ÿå¯ä»¥æ˜¯è™šæ‹Ÿæœºï¼‰ã€‚Nodes ä¸º K8S æä¾›å¯ç”¨çš„ç¾¤é›†èµ„æºï¼Œä»¥ä¿æŒæ•°æ®ï¼Œè¿è¡Œä½œä¸šï¼Œç»´æŠ¤å·¥ä½œè´Ÿè½½å’Œåˆ›å»ºç½‘ç»œè·¯ç”±ã€‚\n3. Labels \u0026amp; Annotations Labels æ˜¯ K8S åŠå…¶ç»ˆç«¯ç”¨æˆ·è¿‡æ»¤å’Œç­›é€‰ç³»ç»Ÿä¸­ç±»ä¼¼èµ„æºçš„æ–¹å¼ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªèµ„æºéœ€è¦â€œè®¿é—®â€æˆ–ä¸å¦ä¸€ä¸ªèµ„æºå…³è”çš„ç²˜åˆå‰‚ã€‚ä¾‹å¦‚ï¼šä¸€ä¸ª Service æƒ³è¦å¼€æ”¾ Deployment çš„ç«¯å£ã€‚æ— è®ºæ˜¯ç›‘æ§ï¼Œè®°å½•ï¼Œæ—¥å¿—ï¼Œæµ‹è¯•ï¼Œä»»ä½•k8sèµ„æºéƒ½åº”æ·»åŠ  Labels ä»¥ä¾›è¿›ä¸€æ­¥æ£€æŸ¥ã€‚ä¾‹å¦‚ï¼š app=worker ï¼Œä¸€ä¸ªç»™ç³»ç»Ÿä¸­æ‰€æœ‰å·¥ä½œ pod çš„æ ‡ç­¾ï¼Œç¨åå¯ä»¥ä½¿ç”¨ kubectl å·¥å…·æˆ– k8s api ä½¿ç”¨ --selector å­—æ®µè¿›è¡Œé€‰æ‹©ã€‚\nAnnotations ä¸ Labels éå¸¸ç±»ä¼¼ï¼Œä½†æ˜¯å®ƒé€šå¸¸ä»¥å­—ç¬¦ä¸²çš„å½¢å¼ç”¨äºå­˜å‚¨å…ƒæ•°æ®ï¼Œä½†ä»–ä¸èƒ½ç”¨äºæ ‡è¯†å’Œé€‰æ‹©å¯¹è±¡ï¼Œé€šå¸¸ä¹Ÿä¸ä¼šè¢« Kubernetes ç›´æ¥ä½¿ç”¨ï¼Œå…¶ä¸»è¦ç›®çš„æ˜¯æ–¹ä¾¿å·¥å…·æˆ–ç”¨æˆ·çš„é˜…è¯»å’ŒæŸ¥æ‰¾ç­‰ã€‚\n4. æœåŠ¡å‘ç° ä½œä¸ºç¼–æ’è°ƒåº¦å™¨ï¼Œæ§åˆ¶ä¸åŒå·¥ä½œè´Ÿè½½çš„èµ„æºï¼ŒK8S ç®¡ç† pods ã€jobs å’Œå…¶ä»–ä»»ä½•éœ€è¦ç½‘ç»œé€šä¿¡çš„ç‰©ç†èµ„æºã€‚ K8S ä½¿ç”¨ etcd ç®¡ç†è¿™äº›ã€‚ etcd æ˜¯ K8S çš„â€œå†…éƒ¨â€æ•°æ®åº“ï¼Œ Master èŠ‚ç‚¹ä½¿ç”¨å®ƒæ¥çŸ¥é“ä¸€åˆ‡èµ„æºéƒ½åœ¨å“ªé‡Œã€‚K8S è¿˜ä¸ºæ‚¨çš„æœåŠ¡æä¾›äº†å®æ—¶çš„ â€œæœåŠ¡å‘ç°â€ - æ‰€æœ‰ Pod éƒ½ä½¿ç”¨çš„è‡ªå®šä¹‰ DNS æœåŠ¡ï¼ˆCoreDNSï¼‰ï¼Œæ‚¨å¯ä»¥é€šè¿‡è§£æå…¶ä»–æœåŠ¡çš„åç§°æ¥è·å–å…¶ IP åœ°å€å’Œç«¯å£ã€‚å®ƒä¸éœ€è¦ä»»ä½•è®¾ç½®ï¼Œåœ¨ K8S é›†ç¾¤ä¸­â€œå¼€ç®±å³ç”¨â€ã€‚\n5. ReplicaSets è™½ç„¶ pod è¿è¡Œä»»åŠ¡ï¼Œä½†é€šå¸¸å•ä¸ªå®ä¾‹æ˜¯ä¸å¤Ÿçš„ã€‚å‡ºäºå¯¹å†—ä½™å’Œè´Ÿè½½å¤„ç†çš„è€ƒè™‘ï¼Œéœ€è¦è¿›è¡Œå¤åˆ¶å®¹å™¨ï¼Œå³â€œå¼¹æ€§ç¼©æ”¾â€ã€‚K8S ä½¿ç”¨ ReplicaSet æ¥å®ç°ä¼¸ç¼©æ‰©å±•ã€‚æ ¹æ®å‰¯æœ¬çš„æ•°é‡æ¥è¡¨ç¤ºç³»ç»Ÿçš„æœŸæœ›çŠ¶æ€ï¼Œå¹¶ä¸”åœ¨ä»»ä½•ç»™å®šæ—¶åˆ»ä¿æŒç³»ç»Ÿçš„å½“å‰çŠ¶æ€ã€‚\nè¿™ä¹Ÿæ˜¯é…ç½®è‡ªåŠ¨æ‰©å±•çš„åœ°æ–¹ï¼Œåœ¨ç³»ç»Ÿè´Ÿè½½é«˜æ—¶åˆ›å»ºæ–°çš„å‰¯æœ¬ï¼Œä»¥åŠåœ¨ä¸å†éœ€è¦è¿™äº›èµ„æºæ¥æ”¯æŒè¿è¡Œå·¥ä½œè´Ÿè½½æ—¶å‡å°‘æ‰©å±•ã€‚ç®€å•çš„è®²å°±æ˜¯ï¼šå°‘åˆ™å¢åŠ ï¼Œå¤šå¢åˆ é™¤ã€‚\n6. DaemonSets æœ‰æ—¶ï¼ŒæŸäº›åº”ç”¨ç¨‹åºåœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸Šåªéœ€è¦ä¸€ä¸ªå®ä¾‹ã€‚æœ€å¥½çš„ä¾‹å­å°±æ˜¯åƒ FileBeat è¿™æ ·çš„æ—¥å¿—é‡‡é›†ç»„ä»¶ã€‚ä¸ºäº†è®© agent ä»èŠ‚ç‚¹ä¸Šæ”¶é›†æ—¥å¿—ï¼Œå®ƒéœ€è¦è¿è¡Œåœ¨æ‰€æœ‰èŠ‚ç‚¹ä¸Šï¼Œä½†åªéœ€è¦ä¸€ä¸ªå®ä¾‹å³å¯ã€‚ä¸ºäº†åˆ›å»ºæ»¡è¶³ä¸Šé¢éœ€æ±‚çš„çš„å·¥ä½œè´Ÿè½½ï¼ŒK8S ä½¿ç”¨ DaemonSets æ¥å®Œæˆè¿™ä¸ªå·¥ä½œã€‚\n7. StatefulSets è™½ç„¶å¤§å¤šæ•°å¾®æœåŠ¡éƒ½æ˜¯æ— çŠ¶æ€çš„åº”ç”¨ç¨‹åºï¼Œä½†æ˜¯è¿˜æ˜¯æœ‰ä¸€éƒ¨åˆ†å¹¶ä¸æ˜¯ã€‚æœ‰çŠ¶æ€çš„å·¥ä½œè´Ÿè½½éœ€è¦ç”±æŸç§å¯é çš„ç£ç›˜å·æ¥æ”¯æŒã€‚è™½ç„¶åº”ç”¨ç¨‹åºå®¹å™¨æœ¬èº«å¯ä»¥æ˜¯ä¸å˜çš„ï¼Œå¹¶ä¸”å¯ä»¥ç”¨æ›´æ–°çš„ç‰ˆæœ¬æˆ–æ›´å¥åº·çš„å®ä¾‹æ¥æ›¿æ¢å®ƒä»¬ï¼Œä½†æ˜¯å³ä½¿ä½¿ç”¨å…¶ä»–å‰¯æœ¬ä¹Ÿæ˜¯éœ€è¦æŒä¹…åŒ–çš„æ•°æ®ã€‚ä¸ºæ­¤ï¼ŒStatefulSets å…è®¸éƒ¨ç½²æ•´ä¸ªç”Ÿå‘½å‘¨æœŸå†…éœ€è¦è¿è¡Œåœ¨åŒä¸€èŠ‚ç‚¹çš„åº”ç”¨ç¨‹åºã€‚å®ƒè¿˜ä¿ç•™äº†å®ƒçš„ â€œåç§°â€ ; å®¹å™¨å†…çš„ hostname å’Œæ•´ä¸ªé›†ç¾¤ä¸­æœåŠ¡å‘ç°çš„åç§°ã€‚ä¸€ä¸ªåŒ…å«3ä¸ª ZooKeeper çš„ StatefulSet å¯ä»¥å‘½åä¸º zk-1 ï¼Œzk-2 å’Œ zk-3 è¿˜å¯ä»¥æ‰©å±•ä¸ºåŒ…å«å…¶ä»–æˆå‘˜ï¼Œå¦‚ zk-4 ï¼Œ zk-5 ç­‰\u0026hellip; StatefulSets è¿˜éœ€è¦ç®¡ç† PVC ã€‚\n8. Jobs K8S æ ¸å¿ƒå›¢é˜Ÿè€ƒå¯Ÿäº†ç»å¤§å¤šæ•°éœ€è¦ä½¿ç”¨ç¼–æ’ç³»ç»Ÿçš„åº”ç”¨ç¨‹åºã€‚è™½ç„¶å¤§å¤šæ•°åº”ç”¨ç¨‹åºéœ€è¦æŒç»­çš„æ­£å¸¸è¿è¡Œæ—¶é—´æ¥å¤„ç†æœåŠ¡è¯·æ±‚ï¼Œä¾‹å¦‚ Web æœåŠ¡ï¼Œä½†æœ‰æ—¶ä¹Ÿéœ€è¦è¿è¡Œæ‰¹é‡ä»»åŠ¡å¹¶åœ¨ä»»åŠ¡å®Œæˆåè¿›è¡Œæ¸…ç†ã€‚å¦‚æœæ‚¨æ„¿æ„ï¼Œå¯ä»¥ä½¿ç”¨å°å‹æ— æœåŠ¡å™¨ç¯å¢ƒã€‚è€Œåœ¨ K8S ä¸­å®ç°è¿™ä¸€åŠŸèƒ½ï¼Œå¯ä»¥ä½¿ç”¨ Job èµ„æºã€‚Jobs æ­£æ˜¯å¬èµ·æ¥çš„é‚£æ ·ï¼Œä¸€ä¸ªå·¥ä½œè´Ÿè½½å®¹å™¨æ¥å®Œæˆç‰¹å®šçš„å·¥ä½œï¼Œå¹¶åœ¨æˆåŠŸåè¢«é”€æ¯ã€‚ä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­æ˜¯è®¾ç½®ä¸€ç»„ worker ï¼Œä»è¦å¤„ç†å’Œå­˜å‚¨çš„é˜Ÿåˆ—ä¸­è¯»å–ä»»åŠ¡ã€‚ä¸€æ—¦é˜Ÿåˆ—ä¸ºç©ºï¼Œç›´åˆ°ä¸‹ä¸€æ‰¹å‡†å¤‡å¥½è¿›è¡Œå¤„ç†ï¼Œéƒ½ä¸å†éœ€è¦å¯åŠ¨ workerã€‚\n9. ConfigMaps \u0026amp; Secrets å¦‚æœæ‚¨è¿˜ä¸ç†Ÿæ‚‰ Twelve-Factor App manifest ã€ŠåäºŒè¦ç´ åº”ç”¨ã€‹ ï¼Œå¯ä»¥ç‚¹å‡»é“¾æ¥äº†è§£ä¸€ä¸‹ã€‚ç°ä»£åº”ç”¨ç¨‹åºçš„ä¸€ä¸ªå…³é”®æ¦‚å¿µæ˜¯æ— ç¯å¢ƒï¼Œå¯é€šè¿‡æ³¨å…¥çš„ç¯å¢ƒå˜é‡è¿›è¡Œé…ç½®ã€‚åº”ç”¨ç¨‹åºåº”å®Œå…¨ä¸å…¶æ‰€åœ¨ä½ç½®æ— å…³ã€‚ConfigMaps åœ¨ K8S ä¸­å®ç°è¿™ä¸€é‡è¦æ¦‚å¿µã€‚å…¶æœ¬è´¨ä¸Šæ˜¯ç¯å¢ƒå˜é‡çš„ key-value åˆ—è¡¨ï¼Œè¿™äº›å˜é‡è¢«ä¼ é€’ç»™æ­£åœ¨è¿è¡Œçš„å·¥ä½œè´Ÿè½½ä»¥ç¡®å®šä¸åŒçš„ runtime è¡Œä¸ºã€‚\nSecrets ä¸ ConfigMaps ç±»ä¼¼ï¼Œé€šè¿‡åŠ å¯†çš„æ–¹å¼é˜²æ­¢å¯†é’¥ã€å¯†ç ã€è¯ä¹¦ç­‰æ•æ„Ÿä¿¡æ¯æ³„æ¼ã€‚\n æˆ‘ä¸ªäººè®¤ä¸ºåœ¨ä»»ä½•ç³»ç»Ÿä¸Šä½¿ç”¨å¯†ç çš„æœ€ä½³é€‰æ‹©æ˜¯ Hashicorp çš„ Vault ã€‚è¯·åŠ¡å¿…é˜…è¯»æˆ‘å»å¹´å†™çš„å…³äºå®ƒçš„æ–‡ç« ï¼Œå…³äº Vault å¯ä»¥ä¸ºä½ çš„äº§å“æä¾›çš„åŠŸèƒ½ï¼Œä»¥åŠæˆ‘çš„ä¸€ä½åŒäº‹å†™çš„å¦ä¸€ç¯‡æ›´å…·æŠ€æœ¯æ€§çš„[æ–‡ç« ](https://medium.com/prodopsio/taking-your-hashicorp-vault-to-the-next-level-8549e7988b24ï¼‰ã€‚\n 10. Deployments ä¸ºäº†ä½¿æ–°ç‰ˆæœ¬å¿«é€Ÿæ›¿æ¢åŸæœ‰çš„åº”ç”¨ç¨‹åºï¼Œæˆ‘ä»¬å¸Œæœ›å°†æ„å»ºã€æµ‹è¯•å’Œå‘å¸ƒåœ¨ä¸€å—æ¥å®ç° short feedback loops ã€‚K8S ä½¿ç”¨ Deployments æ¥ä¸æ–­éƒ¨ç½²æ–°è½¯ä»¶ï¼ŒDeployments æ˜¯ä¸€ç»„ç”¨æ¥æè¿°ç‰¹å®šè¿è¡Œå·¥ä½œè´Ÿè½½çš„å…ƒæ•°æ®ã€‚ä¾‹å¦‚ï¼šå‘å¸ƒæ–°ç‰ˆæœ¬ï¼Œbug ä¿®å¤ï¼Œç”šè‡³æ˜¯å›æ»šï¼ˆè¿™æ˜¯k8sçš„å¦ä¸€ä¸ªå†…éƒ¨é€‰é¡¹ï¼‰ã€‚\nåœ¨ K8S ä¸­éƒ¨ç½²è½¯ä»¶æœ‰ä¸¤ä¸ªä¸»è¦ç­–ç•¥ï¼š\n Replacementï¼šå°†ä½¿ç”¨æ–°å‰¯æœ¬æ›¿æ¢æ‚¨çš„æ•´ä¸ªå·¥ä½œè´Ÿè½½ï¼Œæ•´ä¸ªè¿‡ç¨‹éœ€è¦å¼ºåˆ¶åœæœºã€‚\n RollingUpdateï¼šk8sé€šè¿‡ä¸¤ç§ç‰¹å®šé…ç½®æ¥å®ç°ä½¿ç”¨æ–°çš„ Pods å®ä¾‹æ»šåŠ¨æ›´æ–°ï¼š\n MaxAvailable ï¼š è¯¥è®¾ç½®è¡¨ç¤ºåœ¨éƒ¨ç½²æ–°ç‰ˆæœ¬æ—¶å¯ç”¨çš„å·¥ä½œè´Ÿè½½çš„ç™¾åˆ†æ¯”ï¼ˆæˆ–ç¡®åˆ‡æ•°é‡ï¼‰ï¼Œ100ï¼…è¡¨ç¤ºâ€œæˆ‘æœ‰2ä¸ªå®¹å™¨ï¼Œä¿æŒ2ä¸ªå­˜æ´»å¹¶åœ¨æ•´ä¸ªéƒ¨ç½²æœŸé—´æ­£å¸¸æä¾›æœåŠ¡â€ã€‚ MaxSurge ï¼š è¯¥è®¾ç½®è¡¨ç¤ºå‡çº§æœŸé—´æ€» Pod æ•°æœ€å¤šå¯ä»¥è¶…å‡ºæœŸæœ›çš„ç™¾åˆ†æ¯”ï¼ˆæˆ–æ•°é‡ï¼‰ï¼Œ100ï¼…è¡¨ç¤ºâ€œæˆ‘æœ‰ X ä¸ªå®¹å™¨ï¼Œå†éƒ¨ç½² X ä¸ªå®¹å™¨ï¼Œç„¶åå¼€å§‹æ¨å‡ºæ—§å®¹å™¨â€ã€‚   11. Storage K8S åœ¨å­˜å‚¨ä¸Šæ·»åŠ äº†ä¸€å±‚æŠ½è±¡ï¼Œå·¥ä½œè´Ÿè½½å¯ä»¥ä¸ºä¸åŒçš„ä»»åŠ¡è¯·æ±‚ç‰¹å®šçš„å­˜å‚¨ï¼Œç”šè‡³å¯ä»¥ç®¡ç†æŒç»­çš„æ—¶é—´å¯ä»¥è¶…è¿‡æŸä¸ªpodçš„ç”Ÿå‘½å‘¨æœŸã€‚ä¸ºäº†ç®€çŸ­èµ·è§ï¼Œæˆ‘æƒ³å‘æ‚¨ä»‹ç»æˆ‘æœ€è¿‘å‘å¸ƒçš„å…³äºk8så­˜å‚¨çš„æ–‡ç« ï¼Œç‰¹åˆ«æ˜¯ä¸ºä»€ä¹ˆå®ƒä¸èƒ½å®Œå…¨è§£å†³æ•°æ®åº“éƒ¨ç½²ç­‰æ•°æ®æŒä¹…æ€§è¦æ±‚ã€‚\næ¦‚å¿µæ€§ç†è§£ K8S æ˜¯æ ¹æ®ä¸€äº›æŒ‡å¯¼æ–¹å‘è®¾è®¡å’Œå¼€å‘çš„ï¼Œè€ƒè™‘åˆ°ç¤¾åŒºçš„æ€§è´¨ï¼Œæ¯ä¸ªç‰¹å¾ã€æ¦‚å¿µå’Œæƒ³æ³•éƒ½è¢«å†…ç½®äºç³»ç»Ÿä¸­ã€‚æ­¤å¤–ï¼Œç»ˆç«¯ç”¨æˆ·ä¼šä»¥æŸç§æ–¹å¼ä½¿ç”¨è¯¥ç³»ç»Ÿï¼Œä½œä¸ºä¸€ä¸ªå¼€æºå’Œå…è´¹çš„ç³»ç»Ÿï¼Œä¸å±äºä»»ä½•äººï¼Œä½ å¯ä»¥ç”¨å®ƒåšä»»ä½•ä½ æƒ³è¦åšçš„äº‹ã€‚\né¢å‘ API ï¼šç³»ç»Ÿä¸­çš„æ¯ä¸ªéƒ¨åˆ†éƒ½ä»¥ä¸€ç§å¯é€šè¿‡è®°å½•è‰¯å¥½ä¸”å¯æ“ä½œçš„ API è¿›è¡Œäº¤äº’çš„æ–¹å¼è¿›è¡Œæ„å»ºã€‚æ ¸å¿ƒå¼€å‘äººå‘˜ç¡®ä¿ä½œä¸ºç»ˆç«¯ç”¨æˆ·çš„æ‚¨å¯ä»¥è¿›è¡Œæ›´æ”¹ï¼ŒæŸ¥è¯¢å’Œæ›´æ–°ï¼Œç”¨æ¥æä¾›æ›´å¥½çš„ç”¨æˆ·ä½“éªŒã€‚\nå·¥å…·å‹å¥½ ï¼š ä½œä¸ºä¸Šé¢ä¸€ç‚¹çš„è¡ç”Ÿï¼ŒK8S æ˜¯çƒ­è¡·äºåœ¨å…¶ API å‘¨å›´åˆ›å»ºå·¥å…·çš„ã€‚å®ƒå°†è‡ªèº«åšä¸ºä¸€ä¸ªåŸå§‹å¹³å°ï¼Œä»¥å¯å®šåˆ¶çš„æ–¹å¼æ„å»ºï¼Œä»¥ä¾›å…¶ä»–äººä½¿ç”¨ï¼Œå¹¶è¿›ä¸€æ­¥å¼€å‘ç”¨äºä¸åŒçš„å·¥å…·ã€‚æœ‰äº›å·²ç»å˜å¾—éå¸¸æœ‰åå¹¶è¢«å¹¿æ³›ä½¿ç”¨ï¼Œå¦‚ Spinnaker ï¼ŒIstio å’Œè®¸å¤šå…¶ä»–åŠŸå·¥å…·ã€‚\nå£°æ˜æ€§çŠ¶æ€ ï¼š é¼“åŠ±ç”¨æˆ·ä½¿ç”¨å…·æœ‰å£°æ˜æ€§æè¿°çš„ç³»ç»Ÿè€Œä¸æ˜¯å‘½ä»¤å¼æè¿°ã€‚è¿™æ„å‘³ç€ç³»ç»Ÿçš„çŠ¶æ€å’Œç»„ä»¶æœ€å¥½è¢«æè¿°ä¸ºåœ¨æŸç§ç‰ˆæœ¬æ§åˆ¶ï¼ˆå¦‚ git ï¼‰ä¸­ç®¡ç†çš„ä»£ç ï¼Œè€Œä¸ä¼šå› ä¸ºæŸä¸€å¤„æ‰‹åŠ¨æ›´æ”¹ä¹Ÿå¯¹æ•´ä½“æœ‰å½±å“ã€‚è¿™æ ·ï¼Œk8sæ›´å®¹æ˜“ç¾éš¾æ¢å¤ ï¼Œæ˜“äºåœ¨å›¢é˜Ÿä¹‹é—´åˆ†äº«å’Œä¼ é€’ã€‚\næœ€å æœ¬æ–‡è¯•å›¾å°†é‡ç‚¹æ”¾åœ¨ K8S çš„ä»‹ç»å’Œä¸»è¦æ¦‚å¿µä¸Šï¼Œå½“ç„¶ï¼ŒK8S è¿˜æœ‰å…¶ä»–éå¸¸é‡è¦çš„é¢†åŸŸï¼Œæ¯”å¦‚ç‰©ç†ç³»ç»Ÿæ„å»ºæ¨¡å—ï¼Œå¦‚ kubeletï¼Œ kube-proxy ï¼Œ api-server å’Œç»ˆç«¯æ“ä½œå·¥å…·ï¼škubectlã€‚æˆ‘å°†åœ¨ä¸‹ä¸€ç¯‡æ–‡ç« ä¸­è®¨è®ºä»¥åŠä»‹ç»è¿™äº›å¾ˆé…·çš„åŠŸèƒ½ã€‚\nåŸæ–‡åœ°å€ï¼š https://medium.com/prodopsio/an-8-minute-introduction-to-k8s-94fda1fa5184\n","date":1556602692,"expirydate":-62135596800,"kind":"page","lang":"zh","lastmod":1556602692,"objectID":"6772c5d0c004c1d460fa857832b8afdc","permalink":"https://guoxudong.io/post/an-8-minute-introduction-to-k8s/","publishdate":"2019-04-30T13:38:12+08:00","relpermalink":"/post/an-8-minute-introduction-to-k8s/","section":"post","summary":"8åˆ†é’Ÿå¿«é€Ÿäº†è§£ Kubernetes åŸºæœ¬æ¦‚å¿µï¼Œå¿«é€Ÿå…¥é—¨ K8Sã€‚","tags":["ç¿»è¯‘","kubernetes"],"title":"8åˆ†é’Ÿå…¥é—¨ K8S","type":"post"},{"authors":["éƒ­æ—­ä¸œ"],"categories":["ç¨‹åºå‘˜è¶£é—»"],"content":" é©¬ä¸Šå°±æ˜¯äº”ä¸€å‡æœŸäº†ï¼Œè€Œä¸”ä»Šå¹´çš„äº”ä¸€å‡æœŸæœ‰4å¤©ï¼æƒ³å¿…å¤§å®¶å·²ç»å®‰æ’å¥½æ˜¯åœ¨å®¶å†™ä»£ç è¿˜æ˜¯å‡ºé—¨å»å†’é™©äº†ã€‚ä¸è¿‡åœ¨äº”ä¸€å‡æœŸä¹‹å‰ï¼Œæˆ‘è¿™é‡Œæ¨èä¸€ä¸ªå¥½ç©çš„åˆå¥½ç”¨çš„è½¯ä»¶ç»™å¤§å®¶ã€‚\næƒ³å¿…å¤§éƒ¨åˆ†æœ‹å‹å’Œæˆ‘ä¸€æ ·åœ¨ä¸Šå‘¨å»çœ‹äº†å¤è”4ï¼Œå…¶ä¸­é’¢é“ä¾ æˆ˜è¡£åŠè®¾å¤‡å„ç§ç‚«é…·åˆæå…·ç§‘æŠ€æ„Ÿçš„æ“ä½œç•Œé¢ä¸€å®šè®©ä½ è®°å¿†çŠ¹æ–°ã€‚å¾ˆå¤šæœ‹å‹å¯èƒ½å’Œæˆ‘ä¸€æ ·ï¼Œéƒ½å¸Œæœ›æ‹¥æœ‰ä¸€å¥—è¿™æ ·çš„æ“ä½œç•Œé¢ï¼Œè¿™æ ·ä¸ç®¡æ˜¯å·¥ä½œè¿˜æ˜¯å­¦ä¹ éƒ½ä¼šå˜å¾—æœ‰è¶£è€Œé«˜æ•ˆï¼ˆä¸»è¦æ˜¯ç‚«é…·ï¼‰ã€‚å…¶å®å¾ˆæ—©ä»¥å‰æˆ‘å°±å°è¯•å†™è¿‡ï¼Œä½†æ˜¯ç”±äºæŠ€æœ¯æœ‰é™ï¼Œå†™å‡ºæ¥çš„å·¥å…·éƒ½ä¸æ˜¯å¾ˆç¬¦åˆæˆ‘çš„è¦æ±‚ï¼Œæ¸æ¸çš„ä¹Ÿå°±éƒ½åºŸå¼ƒäº†ã€‚è€Œä»Šå¤©è¦ä»‹ç»çš„è¿™ä¸ªè½¯ä»¶ï¼Œå®Œå…¨ç¬¦åˆæˆ‘çš„è¦æ±‚ï¼Œé«˜ç«¯å¤§æ°”ä¸Šæ¡£æ¬¡ï¼Œå¹¶ä¸”è¿˜æ˜¯å¼€æºçš„ã€‚\neDEX-UI eDEX-UI æ˜¯ä¸€ä¸ªå…¨å±ä¸”è·¨å¹³å°ã€å¯å®šåˆ¶çš„ç»ˆç«¯æ¨¡æ‹Ÿå™¨ï¼Œå…·æœ‰å…ˆè¿›çš„ç›‘æ§å’Œè§¦æ‘¸å±æ”¯æŒã€‚å®ƒçš„å¤–è§‚ç±»ä¼¼ç§‘å¹»çš„è®¡ç®—æœºç•Œé¢ã€‚åœ¨ä¿æŒæœªæ¥æ„Ÿçš„å¤–è§‚å’Œæ„Ÿè§‰çš„åŒæ—¶ï¼Œå®ƒåŠªåŠ›ä¿æŒä¸€å®šçš„åŠŸèƒ½æ°´å¹³å¹¶å¯ç”¨äºç°å®åœºæ™¯ï¼Œå…¶æ›´å¤§çš„ç›®æ ‡æ˜¯å°†ç§‘å¹»ç”¨æˆ·ä½“éªŒçº³å…¥ä¸»æµã€‚\nç‰¹æ€§  åŠŸèƒ½é½å…¨çš„ç»ˆç«¯ä»¿çœŸå™¨ï¼Œå¸¦æœ‰é€‰é¡¹å¡ã€é¢œè‰²ã€æ¨¡æ‹Ÿé¼ æ ‡ï¼Œå¹¶æ”¯æŒ curses å’Œç±»ä¼¼ cursesçš„åº”ç”¨ç¨‹åºã€‚ å®æ—¶ç³»ç»Ÿï¼ˆCPUã€RAMã€è¿›ç¨‹ï¼‰å’Œç½‘ç»œï¼ˆGeoIPã€æ´»åŠ¨è¿æ¥ã€ä¼ è¾“é€Ÿç‡ï¼‰ç›‘æ§ã€‚ å®Œå…¨æ”¯æŒè§¦æ‘¸å±ï¼ŒåŒ…æ‹¬å±å¹•é”®ç›˜ã€‚ å…·å¤‡è·Ÿéšç»ˆç«¯ CWDï¼ˆå½“å‰å·¥ä½œç›®å½•ï¼‰çš„ç›®å½•æŸ¥çœ‹å™¨ã€‚ åŒ…æ‹¬ä¸»é¢˜ã€å±å¹•é”®ç›˜å¸ƒå±€ã€CSS æ³¨å…¥ç­‰åœ¨å†…çš„é«˜çº§è‡ªå®šä¹‰ã€‚ ç”±æ‰åæ¨ªæº¢çš„å£°éŸ³è®¾è®¡å¸ˆåˆ¶ä½œçš„å¯é€‰éŸ³æ•ˆï¼Œå¯å®ç°æœ€ä½³çš„å¥½è±åé»‘å®¢æ°›å›´ã€‚  æ˜¾ç¤º è¿™é‡Œæˆ‘ä½¿ç”¨äº† tron-disrupted ä¸»é¢˜ï¼Œè¿˜æœ‰å¤šç§ä¸»é¢˜å¯ä»¥é€‰æ‹©\nå¯ä»¥çœ‹åˆ°è¿™é‡Œçš„ç•Œé¢ååˆ†ç‚«é…·ï¼Œå¯ä»¥ä¸ºæœ‰äº›ä¹å‘³çš„ shell æ“ä½œå¢æ·»ä¸€æŠ¹ä¹è¶£\né…ç½® eDEX-UI å¯ä»¥é€šè¿‡ settings.json æ–‡ä»¶è¿›è¡Œé…ç½®ï¼Œé…ç½®åŒ…æ‹¬æ‰§è¡Œçš„ shell ç±»å‹ã€å·¥ä½œç›®å½•ã€é”®ç›˜ç±»å‹ã€ä¸»é¢˜ç­‰\nsettings.json åœ¨ Mac ç³»ç»Ÿä¸­ï¼Œå­˜æ”¾åœ¨ /Users/guoxudong/Library/Application Support/eDEX-UI ä¸­ï¼Œé»˜è®¤çš„å·¥ä½œç›®å½•ä¹Ÿæ˜¯è¿™ä¸ªè·¯å¾„\nè¿™é‡Œå¯ä»¥çœ‹åˆ°æˆ‘é€‰æ‹©ä½¿ç”¨ zsh å’Œ tron-disrupted ä¸»é¢˜ï¼Œå¹¶å°†å·¥ä½œç›®å½•æ”¹ä¸ºäº†æˆ‘çš„ç”¨æˆ·ç©ºé—´\nå±€é™  ç›®å‰çœ‹æ¥è¯¥è½¯ä»¶çš„å…¨å¹³å°æ”¯æŒæ˜¯ä¸é”™çš„ï¼ŒåŒæ—¶è¿˜æ”¯æŒè§¦æ‘¸å±æ“ä½œï¼Œä½†æ˜¯ç›®å‰è¿˜æœªæµ‹è¯•åœ¨ pad ä¸Šä½¿ç”¨ï¼Œæµ‹è¯•ä¹‹åä¼šåœ¨åç»­æ–‡ç« ä¸­è¡¥å…… CPU å ç”¨è¿‡é«˜ï¼Œè¯¥è½¯ä»¶ CPU å ç”¨å¾ˆé«˜ï¼Œå¦‚æœæ˜¯é…ç½®ä¸€èˆ¬çš„ç”µè„‘ä¸å»ºè®®è®©å…¶ä½œä¸ºç»ˆç«¯å¸¸é©»ï¼Œå¶å°”æ‹¿å‡ºæ¥ç©ç©å³å¯  ","date":1556510147,"expirydate":-62135596800,"kind":"page","lang":"zh","lastmod":1556510147,"objectID":"d18c1494b219d348de7c4debaa808274","permalink":"https://guoxudong.io/post/edex-ui/","publishdate":"2019-04-29T11:55:47+08:00","relpermalink":"/post/edex-ui/","section":"post","summary":"eDEX-UI æ˜¯ä¸€ä¸ªå…¨å±ä¸”è·¨å¹³å°ã€å¯å®šåˆ¶çš„ç»ˆç«¯æ¨¡æ‹Ÿå™¨ï¼Œå…·æœ‰å…ˆè¿›çš„ç›‘æ§å’Œè§¦æ‘¸å±æ”¯æŒã€‚å®ƒçš„å¤–è§‚ç±»ä¼¼ç§‘å¹»çš„è®¡ç®—æœºç•Œé¢ã€‚åœ¨ä¿æŒæœªæ¥æ„Ÿçš„å¤–è§‚å’Œæ„Ÿè§‰çš„åŒæ—¶ï¼Œå®ƒåŠªåŠ›ä¿æŒä¸€å®šçš„åŠŸèƒ½æ°´å¹³å¹¶å¯ç”¨äºç°å®åœºæ™¯ï¼Œå…¶æ›´å¤§çš„ç›®æ ‡æ˜¯å°†ç§‘å¹»ç”¨æˆ·ä½“éªŒçº³å…¥ä¸»æµã€‚","tags":["å·¥å…·"],"title":"ç‚«é…·çš„ç»ˆç«¯è½¯ä»¶ eDEX-UI","type":"post"},{"authors":["éƒ­æ—­ä¸œ"],"categories":["kubernetes"],"content":" å‰è¨€ é€‰æ‹©é˜¿é‡Œäº‘çš„å®¹å™¨æœåŠ¡ï¼Œä¸»è¦åŸå› æ˜¯å…¬å¸ä¸»è¦ä¸šåŠ¡åŸºæœ¬éƒ½åœ¨è¿è¡Œåœ¨é˜¿é‡Œäº‘ä¸Šã€‚ç›¸è¾ƒè‡ªå»º kubernetes é›†ç¾¤ï¼Œå®¹å™¨æœåŠ¡çš„ä¼˜åŠ¿åœ¨äºéƒ¨ç½²ç›¸å¯¹ç®€å•ï¼Œä¸é˜¿é‡Œäº‘ VPC å®Œç¾å…¼å®¹ï¼Œç½‘ç»œçš„é…ç½®ç›¸å¯¹ç®€å•ï¼Œè€Œå¦‚æœä½¿ç”¨ kubeadm å®‰è£…éƒ¨ç½² kubernetes é›†ç¾¤ï¼Œé™¤äº†ä¼—æ‰€å‘¨çŸ¥çš„ç§‘å­¦ä¸Šç½‘çš„é—®é¢˜ï¼Œè¿˜æœ‰ä¸€ç³»åˆ—çš„é—®é¢˜ï¼ŒåŒ…æ‹¬ etcd ã€ Scheduler å’Œ Controller-Manager çš„é«˜å¯ç”¨é—®é¢˜ç­‰ã€‚å¹¶ä¸”å¦‚æœä½¿ç”¨æ‰˜ç®¡ç‰ˆçš„é˜¿é‡Œäº‘ kubernetes å®¹å™¨æœåŠ¡ï¼Œè¿˜ä¼šçœæ‰3å° master èŠ‚ç‚¹çš„é’±ï¼Œå¹¶ä¸”å¯èƒ½å°† master èŠ‚ç‚¹çš„è¿ç»´é—®é¢˜ä¸¢ç»™é˜¿é‡Œäº‘è§£å†³ï¼Œå¹¶ä¸”å…¶æä¾›çš„ master èŠ‚ç‚¹æ€§èƒ½è‚¯å®šä¼šæ¯”è‡ªè´­çš„é…ç½®å¥½ï¼Œè¿™ç‚¹æ˜¯é˜¿é‡Œäº‘å®¹å™¨æœåŠ¡çš„ç ”å‘å°å“¥åœ¨æ¥æˆ‘å¸äº¤æµæ—¶ä¸“é—¨å¼ºè°ƒçš„ã€‚\né—®é¢˜ å‰é¢å¹äº†é˜¿é‡Œäº‘å®¹å™¨æœåŠ¡çš„ä¼˜åŠ¿ï¼Œé‚£è¿™é‡Œå°±è¯´è¯´åœ¨å®è·µä¸­é‡åˆ°çš„å®¹å™¨æœåŠ¡çš„é—®é¢˜ï¼š\n åœ¨æ–°å»ºé›†ç¾¤çš„æ—¶å€™éœ€è¦é€‰æ‹©ç›¸åº”çš„ VPC å¹¶é€‰æ‹© Pod å’Œ Service æ‰€åœ¨çš„ç½‘æ®µï¼Œè¿™ä¸¤ä¸ªç½‘æ®µä¸èƒ½å’Œ Node èŠ‚ç‚¹å­˜åœ¨äºåŒä¸€ç½‘æ®µï¼Œä½†æ˜¯å¦‚æœæ‚¨åœ¨é˜¿é‡Œäº‘ä¸­å­˜åœ¨ä¸æ­¢ä¸€ä¸ª VPC ï¼ˆVPCçš„ç½‘æ®µå¯ä»¥æ˜¯ 10.0.0.0/8ï¼Œ172.16-31.0.0/12-16ï¼Œ192.168.0.0/16 ï¼‰ï¼Œå¦‚æœç½‘æ®µè®¾ç½®ä¸å¯¹çš„è¯ï¼Œå°±å¯èƒ½ä¼šä½¿åŸæœ¬å­˜åœ¨è¯¥ç½‘æ®µçš„ ECS å¤±è”ï¼Œéœ€è¦åˆ é™¤é›†ç¾¤é‡æ–°åˆ›å»ºã€‚å¦‚æœåˆ é™¤å¤±è´¥çš„è¯ï¼Œè¿˜éœ€è¦æ‰‹åŠ¨åˆ é™¤è·¯ç”±è¡¨ä¸­çš„è®°å½•ï¼ˆåˆ«é—®æˆ‘æ˜¯æ€ä¹ˆçŸ¥é“çš„ï¼‰ã€‚\n åœ¨ä½¿ç”¨å®¹å™¨æœåŠ¡åˆ›å»ºé›†ç¾¤åï¼Œä¼šåˆ›å»º2ä¸ª SLB ï¼ˆä¹‹å‰æ˜¯3ä¸ªï¼‰ï¼Œä¸€ä¸ªæ˜¯ SLB æ˜¯åœ¨ VPC ä¸Šå¹¶ä¸”ç»‘å®šä¸€ä¸ªå¼¹æ€§IPï¼ˆéœ€è¦åœ¨åˆ›å»ºçš„æ—¶å€™æ‰‹åŠ¨å‹¾é€‰åˆ›å»ºå¼¹æ€§IPï¼‰ç”¨äº API Serverï¼Œä¸€ä¸ªæ˜¯ç»å…¸ç½‘ç»œçš„ SLB ä½¿ç”¨æä¾›ç»™ Ingress ä½¿ç”¨ã€‚ä½†æ˜¯è¿™ä¸¤ä¸ªå¤–ç½‘IPåˆ›å»ºåçš„è§„æ ¼éƒ½æ˜¯é»˜è®¤æœ€å¤§å¸¦å®½ã€æŒ‰æµé‡æ”¶è´¹ï¼Œè¿™ä¸ªå¹¶ä¸ç¬¦åˆæˆ‘ä»¬çš„è¦æ±‚ï¼Œéœ€è¦æ‰‹åŠ¨ä¿®æ”¹ï¼Œç„¶è€Œè¿™ä¸ªä¿®æ”¹éƒ½ä¼šåœ¨ç¬¬äºŒå¤©æ‰èƒ½ç”Ÿæ•ˆã€‚\n å®¹å™¨æœåŠ¡åˆ›å»ºé›†ç¾¤åï¼ŒNode èŠ‚ç‚¹çš„åç§°ä¼šä½¿{region-id}.{ECS-id}çš„å½¢å¼ï¼Œè¿™ä¸ªå‘½åæ–¹å¼åœ¨é›†ç¾¤ç›‘æ§ï¼Œä½¿ç”¨ kubectl æ“ä½œé›†ç¾¤æ–¹é¢å°±æ˜¾å¾—æ¯”è¾ƒåäººç±»äº†ï¼Œæ¯æ¬¡éƒ½è¦å»æŸ¥ ECS id æ‰èƒ½ç¡®å®šæ˜¯å“ªä¸ªèŠ‚ç‚¹ï¼Œè€Œè¿™ä¸ª Node èŠ‚ç‚¹åç§°æ˜¯ä¸èƒ½ä¿®æ”¹çš„ï¼\n  ç½‘æ®µé—®é¢˜è§£å†³ è¿™ä¸ªæ¯”è¾ƒå¥½è§£å†³ï¼Œç”šè‡³å¯ä»¥è¯´ä¸ç”¨è§£å†³ï¼Œåªè¦æŠŠç½‘æ®µè§„åˆ’å¥½ï¼Œä¸è¦å‡ºç°ç½‘æ®µå†²çªå°±å¥½\nNode èŠ‚ç‚¹åç§°æ— æ³•ä¿®æ”¹é—®é¢˜è§£å†³ è¿™ä¸ªåŠŸèƒ½ä¹‹å‰å·²æœ‰äººåœ¨é˜¿é‡Œè†å¬å¹³å°æå‡ºè¿™ä¸ªé—®é¢˜äº†ï¼Œå’¨è¯¢äº†å®¹å™¨æœåŠ¡çš„ç ”å‘å°å“¥ï¼Œå¾—åˆ°çš„åé¦ˆæ˜¯è¯¥åŠŸèƒ½å·²ç»åœ¨ç°åº¦æµ‹è¯•äº†ï¼Œç›¸ä¿¡å¾ˆå¿«å°±å¯ä»¥ä¸Šçº¿äº†ã€‚\nåˆ›å»º SLB è§„æ ¼é—®é¢˜è§£å†³ ç›¸è¾ƒä¹‹å‰è‡ªåŠ¨åˆ›å»º3ä¸ª SLB çš„æ–¹å¼ï¼Œç›®å‰çš„ç‰ˆæœ¬åªä¼šè‡ªåŠ¨åˆ›å»º2ä¸ªå¹¶ä¸”æœ‰ä¸€ä¸ªæ˜¯ VPC å†…ç½‘+å¼¹æ€§IPçš„æ–¹å¼ï¼Œå·²ç»è¿›è¡Œäº†ä¼˜åŒ–ï¼Œä½†æ˜¯ ingress ç»‘å®šçš„ SLB è¿˜æ˜¯ç»å…¸ç½‘ç»œç±»å‹ï¼Œæ— æ³•æ¥å…¥äº‘é˜²ç«å¢™å¹¶ä¸”è§„æ ¼ä¹Ÿæ˜¯ä¸åˆé€‚çš„ã€‚è¿™é‡Œç»™å‡ºè§£å†³æ–¹æ¡ˆï¼š\næ–¹æ³•ä¸€ï¼šä½¿ç”¨ kubectl é…ç½® 1. åˆ›å»ºæ–°çš„ SLB  è¿™é‡Œéœ€è¦åˆ›å»ºä¸€ä¸ªæ–°çš„ SLB ç”¨æ¥ä»£æ›¿è‡ªåŠ¨åˆ›å»ºçš„ä¸ç¬¦åˆè¦æ±‚çš„ SLBã€‚è¿™é‡Œå¯ä»¥å…ˆç§ç½‘ SLB å…ˆä¸ç»‘å®šå¼¹æ€§IPã€‚è¿™é‡Œè¦æ³¨æ„çš„äº‹ï¼Œæ–°å»ºçš„ SLB éœ€è¦ä¸ k8sé›†ç¾¤å¤„äºåŒä¸€ VPC å†…ï¼Œå¦åˆ™åœ¨åç»­ä¼šç»‘å®šå¤±è´¥ã€‚  æŸ¥çœ‹æ–°è´­ä¹° SLB çš„ ID   2. åœ¨åˆ›å»ºé›†ç¾¤åé‡æ–°ç»‘å®š ingress-controller çš„ Service é¦–å…ˆéœ€è¦ä½¿ç”¨ kubectl æˆ–è€…ç›´æ¥åœ¨é˜¿é‡Œäº‘æ§åˆ¶å°æ“ä½œï¼Œåˆ›å»ºæ–°çš„ nginx-ingress-svc\n# nginx ingress service apiVersion: v1 kind: Service metadata: name: nginx-ingress-lb-{new-name} namespace: kube-system labels: app: nginx-ingress-lb-{new-name} annotations: # set loadbalancer to the specified slb id service.beta.kubernetes.io/alicloud-loadbalancer-id: {SLB-ID} # set loadbalancer address type to intranet if using private slb instance #service.beta.kubernetes.io/alicloud-loadbalancer-address-type: intranet service.beta.kubernetes.io/alicloud-loadbalancer-force-override-listeners: 'true' #service.beta.kubernetes.io/alicloud-loadbalancer-backend-label: node-role.kubernetes.io/ingress=true spec: type: LoadBalancer # do not route traffic to other nodes # and reserve client ip for upstream externalTrafficPolicy: \u0026quot;Local\u0026quot; ports: - port: 80 name: http targetPort: 80 - port: 443 name: https targetPort: 443 selector: # select app=ingress-nginx pods app: ingress-nginx  åˆ›å»ºæˆåŠŸåï¼Œå¯ä»¥è¿›åˆ° SLB é¡µé¢æŸ¥çœ‹ï¼Œå¯ä»¥çœ‹åˆ° 80 å’Œ 443 ç«¯å£çš„ç›‘å¬å·²ç»è¢«æ·»åŠ äº† 3. ç»‘å®šç¬¦åˆè¦æ±‚çš„å¼¹æ€§IP ç¡®å®š SLB åˆ›å»ºæˆåŠŸå¹¶ä¸”å·²ç»æˆåŠŸç›‘å¬åï¼Œè¿™é‡Œå°±å¯ä»¥ä¸º SLB ç»‘å®šç¬¦åˆæ‚¨éœ€æ±‚çš„å¼¹æ€§IPäº†ï¼Œè¿™é‡Œæˆ‘ä»¬ç»‘å®šä¸€ä¸ªæŒ‰å®½å¸¦è®¡è´¹2Mçš„å¼¹æ€§IP\n4. éªŒè¯è¿é€šæ€§ åˆ°ä¸Šé¢è¿™æ­¥ï¼Œæˆ‘ä»¬çš„ ingress å…¥å£ SLB å·²ç»åˆ›å»ºå®Œæˆï¼Œè¿™é‡Œæˆ‘ä»¬éªŒè¯ä¸€ä¸‹æ˜¯å¦è”é€šã€‚\n åœ¨k8sé›†ç¾¤ä¸­éƒ¨ç½²ä¸€ä¸ª nginx ï¼Œç›´æ¥åœ¨é˜¿é‡Œäº‘å®¹å™¨æœåŠ¡æ§åˆ¶å°æ“ä½œå³å¯ è¿™é‡Œåˆ›å»º ingress è·¯ç”±ï¼Œæ³¨æ„ï¼šè¿™é‡Œçš„åŸŸåéœ€è¦è§£æåˆ°åˆšæ‰åˆ›å»ºçš„ SLB ç»‘å®šçš„å¼¹æ€§IP  è®¿é—®è¯¥åŸŸåï¼Œæ˜¾ç¤º nginx æ¬¢è¿é¡µï¼Œåˆ™è¯æ˜ä¿®æ”¹æˆåŠŸ   æ–¹æ³•äºŒï¼š ä½¿ç”¨é˜¿é‡Œäº‘å®¹å™¨æœåŠ¡æ§åˆ¶å°é…ç½® 1. é˜¿é‡Œäº‘å®¹å™¨æ§åˆ¶å°åˆ›å»ºæ–° service  åœ¨é˜¿é‡Œäº‘å®¹å™¨æœåŠ¡æ§åˆ¶å°ï¼šè·¯ç”±ä¸è´Ÿè½½å‡è¡¡ \u0026ndash;\u0026gt; æœåŠ¡ ç‚¹å‡»åˆ›å»º é€‰æ‹© kube-system å‘½åç©ºé—´ ç±»å‹é€‰ä¸­è´Ÿè½½å‡è¡¡ - å†…ç½‘è®¿é—® å…³è” nginx-ingress-controller å¹¶æ·»åŠ ç«¯å£æ˜ å°„ ç‚¹å‡»åˆ›å»º  2. è¿›å…¥è´Ÿè½½å‡è¡¡æŸ¥çœ‹ SLB æ˜¯å¦åˆ›å»º å¯è§ SLB å·²ç»æˆåŠŸåˆ›å»º\n3. ç»‘å®šç¬¦åˆè¦æ±‚çš„å¼¹æ€§IP åŒæ–¹æ³•ä¸€\n4.éªŒè¯è¿é€šæ€§ åŒæ–¹æ³•ä¸€\nåç»­æ“ä½œ  åœ¨ç¡®å®šæ–°çš„ SLB åˆ›å»ºæˆåŠŸåï¼Œå°±å¯ä»¥å°†å®¹å™¨æœåŠ¡è‡ªåŠ¨åˆ›å»ºçš„ SLB é‡Šæ”¾äº† åˆ é™¤ kube-system ä¸­åŸæœ¬ç»‘å®šçš„ Service ï¼ˆç›®å‰ç‰ˆæœ¬å·²ç»å¯ä»¥å…³è”åˆ é™¤ç»‘å®šçš„ SLB äº†ï¼Œä¸ç”¨åˆ†å¼€æ“ä½œï¼‰ è¿™é‡Œåˆ«å¿˜äº†ï¼Œè‡ªåŠ¨åˆ›å»ºç»™API Server çš„SLBè¿˜æ˜¯æŒ‰æµé‡ä»˜è´¹çš„ï¼Œè®°å¾—é™é…  åè®° ä¸Šé¢çš„è¿™äº›é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆéƒ½å±äºä¸´æ—¶æ–¹æ¡ˆï¼Œå·²åœ¨é˜¿é‡Œçš„è†å¬å¹³å°æå‡ºäº†ä¸Šé¢çš„é—®é¢˜ï¼Œç›¸ä¿¡å¾ˆå¿«å°±ä¼šæœ‰æ‰€æ”¹è¿›ã€‚æ€»çš„æ¥è¯´ï¼Œé˜¿é‡Œäº‘å®¹å™¨æœåŠ¡åœ¨æä¾›ä¼˜è´¨çš„ kubernetes åŠŸèƒ½ï¼Œå¹¶ä¸”åªæ”¶ ECS çš„é’±ï¼Œå¯¹äºæƒ³å­¦ä¹  kubernetes åˆæ²¡æœ‰å¤ªå¤šèµ„é‡‘çš„åŒå­¦ä¹Ÿæ¯”è¾ƒå‹å¥½ï¼Œç›´æ¥ä¹°æŒ‰é‡ä»˜è´¹å®ä¾‹ï¼Œæµ‹è¯•å®Œé‡Šæ”¾å³å¯ï¼Œä¸ç”¨è´­ä¹° master èŠ‚ç‚¹ï¼Œååˆ†è‰¯å¿ƒï¼\n","date":1556202366,"expirydate":-62135596800,"kind":"page","lang":"zh","lastmod":1556202366,"objectID":"fe4313100487dc1237d95450e5cef8ab","permalink":"https://guoxudong.io/post/aliyun-k8s-perfect/","publishdate":"2019-04-25T22:26:06+08:00","relpermalink":"/post/aliyun-k8s-perfect/","section":"post","summary":"è¿™é‡Œè®°å½•äº†åœ¨å·¥ä½œä¸­é‡åˆ°é˜¿é‡Œäº‘å®¹å™¨æœåŠ¡çš„è°ƒä¼˜ä¼˜åŒ–æ–¹æ¡ˆï¼Œå¸®åŠ©æ‚¨ç»•è¿‡é˜¿é‡Œäº‘å®¹å™¨æœåŠ¡ä¸­çš„ä¸€äº›å‘ï¼Œæ¥ä½¿ç”¨æ›´å¥½æ›´ä¼˜è´¨çš„é˜¿é‡Œäº‘å®¹å™¨æœåŠ¡ã€‚","tags":["é˜¿é‡Œäº‘","kubernetes","å®¹å™¨"],"title":"é˜¿é‡Œäº‘å®¹å™¨æœåŠ¡æ–°å»ºé›†ç¾¤ä¼˜åŒ–æ–¹æ¡ˆ(æ›´æ–°ç‰ˆ)","type":"post"},{"authors":["éƒ­æ—­ä¸œ"],"categories":["ç¿»è¯‘"],"content":"  è™½ç„¶ Kubernetes èµ¢å¾—äº†å®¹å™¨ä¹‹ç«™ï¼Œä½†æ˜¯å…¶ä»ç„¶å¾ˆéš¾ä½¿ç”¨å¹¶ä¸”æ—¶é•¿å¼•èµ·äº‹æ•…ã€‚\n æˆ‘æƒ³æˆ‘åº”è¯¥ç»™è¿™ç¯‡æ–‡ç« åšä¸€ç‚¹åºè¨€ã€‚ kubernetes ä¸ºè®¸å¤šåº”ç”¨ç¨‹åºæä¾›æ–°çš„ runtime ï¼Œå¦‚æœä½¿ç”¨å¾—å½“ï¼Œå®ƒå¯ä»¥æˆä¸ºä¸€ä¸ªå¼ºå¤§çš„å·¥å…·ï¼Œå¹¶ä¸”å¯ä»¥å°†æ‚¨å†²å¤æ‚çš„å¼€å‘ç”Ÿå‘½å‘¨æœŸä¸­è§£æ”¾å‡ºæ¥ã€‚ç„¶è€Œåœ¨è¿‡å»çš„å‡ å¹´é‡Œï¼Œæˆ‘çœ‹åˆ°å¾ˆå¤šäººå’Œå…¬å¸éƒ½ä¼šæ­å»ºä»–ä»¬çš„ Kubernetes ï¼Œä½†å¸¸å¸¸åªæ˜¯å¤„äºæµ‹è¯•é˜¶æ®µï¼Œä»æœªè¿›å…¥åˆ°ç”Ÿäº§ã€‚\nKubernetes æ˜¯å¦‚ä½•è¿ä½œçš„ï¼Ÿ ç²—ç•¥çš„è®²ï¼Œ Kubernetes æˆ–è€… K8S çœ‹èµ·æ¥ååˆ†ç®€å•ã€‚æ‚¨è¿è¡Œçš„ Kubernetes èŠ‚ç‚¹è‡³å°‘è¢«åˆ†ä¸ºä¸¤ç±»ï¼šMaster å’Œ Workersã€‚Master èŠ‚ç‚¹é€šå¸¸ä¸è¿è¡Œä»»ä½•çœŸå®çš„å·¥ä½œè´Ÿè½½ï¼Œé‚£æ˜¯ Workers èŠ‚ç‚¹çš„å·¥ä½œã€‚\nKubernetes çš„ Master èŠ‚ç‚¹åŒ…å«ä¸€ä¸ªåå« API server çš„ç»„ä»¶ï¼Œå…¶æä¾›çš„ API å¯ä»¥é€šè¿‡ kubectl è°ƒç”¨ã€‚æ­¤å¤–è¿˜åŒ…æ‹¬ä¸€ä¸ª scheduler ï¼Œè´Ÿè´£è°ƒåº¦å®¹å™¨ï¼Œå†³å®šå®¹å™¨è¿è¡Œåœ¨å“ªä¸ªèŠ‚ç‚¹ã€‚æœ€åä¸€ä¸ªç»„ä»¶æ˜¯ controller-manager ï¼Œå®ƒå®é™…ä¸Šæ˜¯ä¸€ç»„å¤šä¸ªæ§åˆ¶å™¨ï¼Œè´Ÿè´£å¤„ç†èŠ‚ç‚¹ä¸­æ–­ã€å¤åˆ¶ã€åŠ å…¥ services å’Œ pods ï¼Œå¹¶ä¸”å¤„ç†æˆæƒç›¸å…³å†…å®¹ã€‚æ‰€æœ‰çš„æ•°æ®éƒ½å­˜å‚¨åœ¨ etcd ä¸­ï¼Œè¿™æ˜¯ä¸€ä¸ªå¯ä¿¡èµ–çš„åˆ†å¸ƒå¼é”®å€¼å­˜å‚¨æœåŠ¡ï¼ˆåŒ…å«ä¸€äº›éå¸¸é…·çš„åŠŸèƒ½ï¼‰ã€‚æ€»è€Œè¨€ä¹‹ï¼ŒMaster èŠ‚ç‚¹è´Ÿè´£ç®¡ç†é›†ç¾¤ï¼Œè¿™é‡Œæ²¡ä»€ä¹ˆç‰¹åˆ«å¤§çš„æƒŠå–œã€‚\nå¦ä¸€æ–¹é¢ï¼Œ çœŸå®çš„å·¥ä½œè´Ÿè½½è¿è¡Œåœ¨ Worker èŠ‚ç‚¹ä¸Šã€‚ä¸ºæ­¤ï¼Œå®ƒè¿˜åŒ…æ‹¬è®¸å¤šç»„ä»¶ã€‚é¦–å…ˆï¼ŒWorker èŠ‚ç‚¹ä¸Šä¼šè¿è¡Œ kubelet ï¼Œå®ƒæ˜¯ä¸è¯¥èŠ‚ç‚¹ä¸Šçš„å®¹å™¨ä¸€èµ·è¿è¡Œçš„ API ï¼Œè´Ÿè´£ä¸ç®¡æ§ç»„ä»¶æ²Ÿé€šï¼Œå¹¶æŒ‰ç…§ç®¡æ§ç»„ä»¶æŒ‡ç¤ºç®¡ç† Worker èŠ‚ç‚¹ã€‚å¦ä¸€ä¸ªç»„ä»¶å°±æ˜¯ kube-proxy ï¼Œå…¶è´Ÿè´£è½¬å‘ç½‘ç»œè¿æ¥ï¼Œæ ¹æ®æ‚¨çš„é…ç½®è¿è¡Œå®¹å™¨ã€‚å¯èƒ½è¿˜æœ‰å…¶ä»–ä¸œè¥¿ï¼Œå¦‚ kube-dns æˆ– gVisorã€‚æ‚¨è¿˜éœ€è¦é›†æˆæŸç§ overlay network æˆ–åº•å±‚ç½‘ç»œè®¾ç½®ï¼Œä»¥ä¾¿ Kubernetes å¯ä»¥ç®¡ç†æ‚¨çš„ pod ä¹‹é—´çš„ç½‘ç»œã€‚\nå¦‚æœæ‚¨æƒ³è¦ä¸€ä¸ªæ›´å®Œæ•´çš„æ¦‚è¿°ï¼Œå»ºè®®å»çœ‹ Kelsey Hightowers çš„ Kubernetes - The Hard Wayã€‚\nç”Ÿäº§å°±ç»ªçš„ Kubernetes åˆ°ç›®å‰ä¸ºæ­¢ï¼Œè¿™å¬èµ·æ¥å¹¶ä¸å¤ªç³Ÿç³•ã€‚åªæ˜¯å®‰è£…å‡ ä¸ªç¨‹åºã€é…ç½®ã€è¯ä¹¦ç­‰ã€‚ä¸è¦è¯¯ä¼šæˆ‘çš„æ„æ€ï¼Œè¿™ä»ç„¶æ˜¯ä¸€ä¸ªå­¦ä¹ æ›²çº¿ï¼Œä½†è¿™ä¹Ÿä¸æ˜¯ç³»ç»Ÿç®¡ç†å‘˜ä¸èƒ½å¤„ç†çš„é—®é¢˜ã€‚\nç„¶è€Œï¼Œç®€å•åœ°æ‰‹åŠ¨å®‰è£… Kubernetes å¹¶ä¸ä»£è¡¨å…¶å·²ç»å®Œå…¨å‡†å¤‡å°±ç»ªï¼Œæ‰€ä»¥è®©æˆ‘ä»¬è°ˆè°ˆè®©è¿™ä¸ªä¸œè¥¿è¿è¡Œèµ·æ¥æ‰€éœ€çš„æ­¥éª¤ã€‚\né¦–å…ˆï¼Œå®‰è£…ã€‚å¦‚æœæ‚¨æƒ³è¦æŸç§è‡ªåŠ¨å®‰è£…ï¼Œæ— è®ºæ˜¯ä½¿ç”¨ Ansible ï¼Œ Terraform è¿˜æ˜¯å…¶ä»–å·¥å…·ã€‚kops å¯ä»¥å¸®åŠ©æ‚¨è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä½†æ˜¯ä½¿ç”¨ kops æ„å‘³ç€æ‚¨å°†ä¸çŸ¥é“å®ƒæ˜¯å¦‚ä½•è®¾ç½®çš„ï¼Œå¹¶ä¸”å½“æ‚¨ä»¥åæƒ³è¦è°ƒè¯•æŸäº›ä¸œè¥¿æ—¶å¯èƒ½ä¼šå¼•èµ·ä¸€äº›å…¶ä»–é—®é¢˜ã€‚åº”å¯¹æ­¤è‡ªåŠ¨åŒ–è¿›è¡Œæµ‹è¯•ï¼Œå¹¶å®šæœŸè¿›è¡Œæ£€æŸ¥ã€‚\nå…¶æ¬¡ï¼Œæ‚¨éœ€è¦ç›‘æ§æ‚¨çš„ Kubernetes å®‰è£…ã€‚æ‰€ä»¥æ‚¨éœ€è¦ Prometheus ã€ Grafana ç­‰å·¥å…·ã€‚æ‚¨æ˜¯åœ¨ Kubernetes é‡Œé¢è¿è¡Œå®ƒå—ï¼Ÿ å¦‚æœæ‚¨çš„ Kubernetes æœ‰é—®é¢˜ï¼Œé‚£ä¹ˆæ‚¨çš„ç›‘æ§æ˜¯å¦ä¼šä¹Ÿä¼šæŒ‚æ‰ï¼Ÿ æˆ–è€…æ‚¨å•ç‹¬è¿è¡Œå®ƒï¼Ÿ å¦‚æœæ˜¯ï¼Œé‚£ä¹ˆæ‚¨åœ¨å“ªé‡Œè¿è¡Œå®ƒï¼Ÿ\nå¦å¤–å€¼å¾—æ³¨æ„çš„æ˜¯å¤‡ä»½ã€‚å¦‚æœæ‚¨çš„ Master å´©æºƒï¼Œæ•°æ®æ— æ³•æ¢å¤å¹¶ä¸”æ‚¨éœ€è¦é‡æ–°é…ç½®ç³»ç»Ÿä¸Šçš„æ‰€æœ‰ pod ï¼Œæ‚¨ä¼šæ€ä¹ˆåšï¼Ÿæ‚¨æ˜¯å¦æµ‹è¯•äº†å†æ¬¡è¿è¡Œ CI ç³»ç»Ÿä¸­æ‰€æœ‰ä½œä¸šæ‰€éœ€çš„æ—¶é—´ï¼Ÿæ‚¨æœ‰ç¾éš¾æ¢å¤è®¡åˆ’å—ï¼Ÿ\nç°åœ¨ï¼Œæ—¢ç„¶æˆ‘ä»¬åœ¨è°ˆè®º CI ç³»ç»Ÿï¼Œé‚£ä¹ˆæ‚¨éœ€è¦ä¸ºæ‚¨çš„é•œåƒè¿è¡Œ Docker é•œåƒä»“åº“ã€‚å½“ç„¶ï¼Œæ‚¨å¯ä»¥å†æ¬¡åœ¨ Kubernetes ä¸Šåšï¼Œä½†å¦‚æœ Kubernetes å´©æºƒ\u0026hellip;\u0026hellip;æ‚¨çŸ¥é“è¿™ä¸ªåæœã€‚å½“ç„¶ï¼ŒCI ç³»ç»Ÿä¸è¿è¡Œç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿéƒ½æœ‰è¿™ä¸ªé—®é¢˜ã€‚ç†æƒ³æƒ…å†µä¸‹ï¼Œè¿™äº›ç³»ç»Ÿæ˜¯ä¸ç”Ÿäº§ç¯å¢ƒéš”ç¦»çš„ï¼Œä»¥ä¾¿åœ¨ç³»ç»Ÿå‡ºç°é—®é¢˜æ—¶ï¼Œè‡³å°‘å¯ä»¥è®¿é—® git ï¼Œæ¥è¿›è¡Œé‡æ–°éƒ¨ç½²ç­‰æ“ä½œã€‚\næ•°æ®å­˜å‚¨ æœ€åï¼Œæˆ‘ä»¬æ¥è°ˆè°ˆæœ€é‡è¦çš„éƒ¨åˆ†ï¼šå­˜å‚¨ã€‚Kubernetes æœ¬èº«å¹¶ä¸æä¾›å­˜å‚¨è§£å†³æ–¹æ¡ˆã€‚å½“ç„¶ï¼Œæ‚¨å¯ä»¥å°†å­˜å‚¨æŒ‚è½½åˆ°ä¸»æœºå®‰è£…ç›®å½•ï¼Œä½†è¿™æ—¢ä¸æ¨èä¹Ÿä¸ç®€å•ã€‚\nåŸºæœ¬ä¸Šéœ€è¦åœ¨ Kubernetes ä¸‹ä½¿ç”¨æŸç§å­˜å‚¨ã€‚ä¾‹å¦‚ï¼Œrook ä½¿å¾—è¿è¡Œ Ceph ä½œä¸ºåº•å±‚å—å­˜å‚¨éœ€æ±‚çš„å˜å¾—ç›¸å¯¹ç®€å•ï¼Œä½†æˆ‘å¯¹ Ceph çš„ä½“éªŒæ˜¯å®ƒè¿˜æœ‰æœ‰å¾ˆå¤šåœ°æ–¹éœ€è¦è°ƒæ•´ï¼Œæ‰€ä»¥æ‚¨ç»ä¸æ˜¯åªéœ€ç‚¹å‡»ä¸‹ä¸€æ­¥å°±èƒ½èµ°å‡ºå›°å¢ƒã€‚\nè°ƒè¯• åœ¨ä¸å¼€å‘äººå‘˜è°ˆè®º Kubernetes æ—¶ï¼Œä¸€ç§å¸¸è§çš„å›ç­”ç»å¸¸å‡ºç°ï¼šåœ¨ä½¿ç”¨ Kubernetes æ—¶ï¼Œäººä»¬å¸¸å¸¸åœ¨è°ƒè¯•åº”ç”¨ç¨‹åºæ—¶é‡åˆ°é—®é¢˜ã€‚å³ä½¿æ˜¯ä¸€ä¸ªä¾‹å¦‚å®¹å™¨æœªèƒ½å¯åŠ¨çš„ç®€å•é—®é¢˜ï¼Œä¹Ÿä¼šå¼•èµ·æ··ä¹±ã€‚\nå½“ç„¶ï¼Œè¿™æ˜¯ä¸€ä¸ªæ•™è‚²é—®é¢˜ã€‚åœ¨è¿‡å»çš„å‡ åå¹´ä¸­ï¼Œå¼€å‘äººå‘˜å·²ç»å­¦ä¼šäº†è°ƒè¯•çš„â€œç»å…¸â€æ­¥éª¤ï¼šåœ¨ /vat/log/ ä¸­æŸ¥çœ‹æ—¥å¿—ç­‰ã€‚ä½†æ˜¯å¯¹äºå®¹å™¨ï¼Œæˆ‘ä»¬ç”šè‡³ä¸çŸ¥é“å®¹å™¨è¿è¡Œåœ¨å“ªä¸ªæœåŠ¡å™¨ä¸Šï¼Œå› æ­¤å®ƒå‘ˆç°å‡ºäº†ä¸€ç§èŒƒå¼è½¬æ¢ã€‚\né—®é¢˜ï¼šå¤æ‚ æ‚¨å¯èƒ½å·²ç»æ³¨æ„åˆ°æˆ‘æ­£åœ¨è·³è¿‡å…±æœ‰äº‘æä¾›å•†ç»™æ‚¨çš„ä¸œè¥¿ï¼Œå³ä½¿å®ƒä¸æ˜¯ä¸€ä¸ªå®Œæ•´çš„æ‰˜ç®¡ Kubernetesã€‚å½“ç„¶ï¼Œå¦‚æœæ‚¨ä½¿ç”¨æ‰˜ç®¡çš„ Kubernetes è§£å†³æ–¹æ¡ˆï¼Œè¿™å¾ˆå¥½ï¼Œé™¤äº†è°ƒè¯•ä¹‹å¤–ï¼Œæ‚¨ä¸éœ€è¦å¤„ç†ä¸Šé¢è¿™äº›é—®é¢˜ã€‚\nKubernetes æ‹¥æœ‰è®¸å¤šå¯ä»¥ç§»åŠ¨ç»„ä»¶ï¼Œä½† Kubernetes æœ¬èº«ä¹Ÿå¹¶ä¸èƒ½æä¾›å®Œæ•´çš„è§£å†³æ–¹æ¡ˆã€‚ä¾‹å¦‚ï¼ŒRedHat OpenShift å¯ä»¥ï¼Œä½†å®ƒéœ€è¦èŠ±é’±ï¼Œå¹¶ä¸”ä»ç„¶éœ€è¦æ·»åŠ è‡ªå·±çš„ä¸œè¥¿ã€‚\nç°åœ¨Kubernetesæ­£å¤„äº Gartner hype cycle çš„é¡¶å³°ï¼Œæ¯ä¸ªäººéƒ½æƒ³è¦å®ƒï¼Œä½†å¾ˆå°‘æœ‰äººçœŸæ­£ç†è§£å®ƒã€‚åœ¨æ¥ä¸‹æ¥çš„å‡ å¹´é‡Œï¼Œä¸å°‘å…¬å¸å¿…é¡»æ„è¯†åˆ° Kubernetes å¹¶ä¸æ˜¯é“¶å¼¹ï¼Œè€Œå¦‚ä½•æ­£ç¡®æœ‰æ•ˆåœ°ä½¿ç”¨å®ƒæ‰æ˜¯å…³é”®ã€‚\næˆ‘è®¤ä¸ºï¼Œå¦‚æœæ‚¨æœ‰èƒ½åŠ›å°† Ops å›¢é˜Ÿä¸“é—¨ç”¨äºä¸ºå¼€å‘äººå‘˜æ¥ç»´æŠ¤åº•å±‚å¹³å°ï¼Œé‚£ä¹ˆè¿è¡Œè‡ªå·±çš„ Kubernetes æ˜¯å€¼å¾—çš„ã€‚\n æœ¬æ–‡ä½œè€…ï¼šJanos Pasztor 2018-12-04\n åŸæ–‡åœ°å€ï¼šhttps://pasztor.at/blog/kubernetes-is-hard\n","date":1556072326,"expirydate":-62135596800,"kind":"page","lang":"zh","lastmod":1556072326,"objectID":"5a57dad9090f8b3eedcec900bbd509a0","permalink":"https://guoxudong.io/post/kubernetes-is-har/","publishdate":"2019-04-24T10:18:46+08:00","relpermalink":"/post/kubernetes-is-har/","section":"post","summary":"è™½ç„¶ Kubernetes èµ¢å¾—äº†å®¹å™¨æˆ˜äº‰ï¼Œä½†æ˜¯å…¶ä»ç„¶å¾ˆéš¾ä½¿ç”¨å¹¶ä¸”å¼•èµ·å¾ˆå¤šäº‹æ•…ã€‚","tags":["ç¿»è¯‘","kubernetes"],"title":"å›°éš¾çš„ Kubernetes","type":"post"},{"authors":["éƒ­æ—­ä¸œ"],"categories":["ç¨‹åºå‘˜è¶£é—»"],"content":" è¿™é‡Œçš„é»‘è¯ï¼Œå…¶å®å°±æ˜¯ GitHub ä¸Šçš„ä¸€äº›è¿·ä¹‹ç¼©å†™ï¼Œè¿™äº›æ­ªæœè€å¸æœºä»¬åœ¨ GitHub ä¸Šè‚†æ— å¿Œæƒ®çš„ä½¿ç”¨ç€ä»–ä»¬çš„â€œé»‘è¯â€ï¼Œè®©æˆ‘ä»¬è¿™äº›éè‹±è¯­æ¯è¯­å›½å®¶çš„æ–°å¸æœºåœ¨ code review æ—¶ç»å¸¸æ˜¯ä¸€è„¸æ‡µé€¼ + é»‘äººé—®å¥½\u0026hellip;\nimage: caption: \u0026ldquo;Image from: Pexels\u0026ldquo; focal_point: \u0026ldquo;\u0026rdquo;\npreview_only: false   image: caption: \u0026ldquo;Image from: Pexels\u0026ldquo; focal_point: \u0026ldquo;\u0026rdquo;\npreview_only: false è®°ä½ä¸‹é¢è¿™äº›â€œé»‘è¯â€ï¼Œä»¥åæˆ‘ä»¬ä¹Ÿå¯ä»¥æ„‰å¿«çš„åœ¨ GitHub ä¸Šè£…é€¼äº†~\n PR: Pull Request. æ‹‰å–è¯·æ±‚ï¼Œç»™å…¶ä»–é¡¹ç›®æäº¤ä»£ç ï¼Œè¿™ä¸ªæ˜¯æœ€ä¸ºå¸¸è§çš„ç¼©å†™ã€‚ WIP: Work In Progress. ä¼ è¯´ä¸­æ PR çš„æœ€ä½³å®è·µæ˜¯ï¼Œå¦‚æœä½ æœ‰ä¸ªæ”¹åŠ¨å¾ˆå¤§çš„ PRï¼Œå¯ä»¥åœ¨å†™äº†ä¸€éƒ¨åˆ†çš„æƒ…å†µä¸‹å…ˆæäº¤ï¼Œä½†æ˜¯åœ¨æ ‡é¢˜é‡Œå†™ä¸Š WIPï¼Œä»¥å‘Šè¯‰é¡¹ç›®ç»´æŠ¤è€…è¿™ä¸ªåŠŸèƒ½è¿˜æœªå®Œæˆï¼Œæ–¹ä¾¿ç»´æŠ¤è€…æå‰ review éƒ¨åˆ†æäº¤çš„ä»£ç ã€‚ LGTM: Looks Good To Me. å·²é˜… ä»£ç å·²ç»è¿‡ reviewï¼Œå¯ä»¥åˆå¹¶ã€‚ä¹Ÿå¯ç†è§£ä¸º â€œOJBKâ€ã€‚ SGTM: Sounds Good To Me. åŒä¸Šï¼Œä¹Ÿæ˜¯å·²ç»é€šè¿‡äº† review çš„æ„æ€ã€‚ PTAL: Please Take A Look. ä½ æ¥ç…ç…ï¼Ÿç”¨æ¥æç¤ºåˆ«äººæ¥çœ‹ä¸€ä¸‹ã€‚ TBR: To Be Reviewed. æç¤ºç»´æŠ¤è€…è¿›è¡Œ reviewã€‚ TL;DR: Too Long; Didn\u0026rsquo;t Read. å¤ªé•¿æ‡’å¾—çœ‹ã€‚ä¹Ÿæœ‰å¾ˆå¤šæ–‡æ¡£åœ¨åšç®€ç•¥æè¿°ä¹‹å‰ä¼šå†™è¿™ä¹ˆä¸€å¥ï¼Œç¬¬ä¸€æ¬¡çœ‹åˆ°çš„ååº”æ˜¯ï¼šè¿™TMæ˜¯å•¥ï¼Ÿ TBD: To Be Done(or Defined/Discussed/Decided/Determined). æ ¹æ®è¯­å¢ƒä¸åŒæ„ä¹‰æœ‰æ‰€åŒºåˆ«ï¼Œä½†ä¸€èˆ¬éƒ½æ˜¯è¿˜æ²¡æå®šçš„æ„æ€ã€‚  å‚è€ƒ LGTM? é‚£äº›è¿·ä¹‹ç¼©å†™ - farer.org\n","date":1555895484,"expirydate":-62135596800,"kind":"page","lang":"zh","lastmod":1555895484,"objectID":"108f4208cf323fa50893a8f3ef6d6076","permalink":"https://guoxudong.io/post/cant/","publishdate":"2019-04-22T09:11:24+08:00","relpermalink":"/post/cant/","section":"post","summary":"è¿™é‡Œæ€»ç»“äº†ä¸€äº›åœ¨ GitHub ä¸Šå¸¸è§çš„ï¼Œè¿™äº›ä¹±ä¸ƒå…«ç³Ÿçš„ç¼©å†™ç€å®ç»™å¾ˆå¤šæ–°å¸æœºå¸¦æ¥äº†è®¸å¤šå›°æ‰° :)","tags":["GitHub","ç¿»è¯‘"],"title":"GitHub é»‘è¯æŒ‡å—","type":"post"},{"authors":["éƒ­æ—­ä¸œ"],"categories":["ç¿»è¯‘"],"content":" Docker éå¸¸æ£’ï¼ å®ƒä½¿è½¯ä»¶å¼€å‘è€…æ— éœ€æ‹…å¿ƒé…ç½®å’Œä¾èµ–æ€§ï¼Œåœ¨ä»»ä½•åœ°æ–¹æ‰“åŒ…ï¼Œå‘é€å’Œè¿è¡Œä»–ä»¬çš„åº”ç”¨ç¨‹åºã€‚è€Œåœ¨ä¸ kubernetes ç›¸ç»“åˆåï¼Œå®ƒä½¿åº”ç”¨é›†ç¾¤éƒ¨ç½²å’Œç®¡ç†å˜å¾—æ›´æ–¹ä¾¿ã€‚è¿™ä½¿å¾— Docker æ·±å—è½¯ä»¶å¼€å‘è€…çš„å–œçˆ±ï¼Œè¶Šæ¥è¶Šå¤šçš„å¼€å‘è€…å¼€å§‹ä½¿ç”¨ Dockerã€‚\né‚£ä¹ˆ Docker åˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿ\nå®ƒæ˜¯æ„å»ºã€æµ‹è¯•ã€éƒ¨ç½²å’Œå‘å¸ƒå®¹å™¨åŒ–åº”ç”¨çš„å¹³å°ã€‚ç§°å…¶ä¸ºå¹³å°æ˜¯å› ä¸º Docker å…¶å®æ˜¯ä¸€å¥—ç”¨äºç®¡ç†ä¸å®¹å™¨ç›¸å…³çš„æ‰€æœ‰äº‹ç‰©çš„å·¥å…·ã€‚ä½œä¸º Docker çš„æ ¸å¿ƒï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°†æ·±å…¥æ¢è®¨å®¹å™¨ã€‚\nä»€ä¹ˆæ˜¯å®¹å™¨ï¼Ÿ å®¹å™¨æä¾›äº†åœ¨è®¡ç®—æœºä¸Šçš„éš”ç¦»ç¯å¢ƒä¸­å®‰è£…å’Œè¿è¡Œåº”ç”¨ç¨‹åºçš„æ–¹æ³•ã€‚åœ¨å®¹å™¨å†…è¿è¡Œçš„åº”ç”¨ç¨‹åºä»…å¯ä½¿ç”¨äºä¸ºè¯¥å®¹å™¨åˆ†é…çš„èµ„æºï¼Œä¾‹å¦‚ï¼šCPUï¼Œå†…å­˜ï¼Œç£ç›˜ï¼Œè¿›ç¨‹ç©ºé—´ï¼Œç”¨æˆ·ï¼Œç½‘ç»œï¼Œå·ç­‰ã€‚åœ¨ä½¿ç”¨æœ‰é™çš„å®¹å™¨èµ„æºçš„åŒæ—¶ï¼Œå¹¶ä¸ä¸å…¶ä»–å®¹å™¨å†²çªã€‚æ‚¨å¯ä»¥å°†å®¹å™¨è§†ä¸ºç®€æ˜“è®¡ç®—æœºä¸Šè¿è¡Œåº”ç”¨ç¨‹åºçš„éš”ç¦»æ²™ç®±ã€‚\nè¿™ä¸ªæ¦‚å¿µå¬èµ·æ¥å¾ˆç†Ÿæ‚‰ï¼Œæœ‰äº›ç±»ä¼¼äºè™šæ‹Ÿæœºã€‚ä½†å®ƒä»¬æœ‰ä¸€ä¸ªå…³é”®çš„åŒºåˆ«ï¼šå®¹å™¨ä½¿ç”¨çš„ä¸€ç§éå¸¸ä¸åŒçš„ï¼Œè½»é‡çš„æŠ€æœ¯æ¥å®ç°èµ„æºéš”ç¦»ã€‚å®¹å™¨åˆ©ç”¨äº†åº•å±‚ Linux å†…æ ¸çš„åŠŸèƒ½ï¼Œè€Œä¸æ˜¯è™šæ‹Ÿæœºé‡‡ç”¨çš„ hypervisor çš„æ–¹æ³•ã€‚æ¢å¥è¯è¯´ï¼Œå®¹å™¨è°ƒç”¨ Linux å‘½ä»¤æ¥åˆ†é…å’Œéš”ç¦»å‡ºä¸€ç»„èµ„æºï¼Œç„¶ååœ¨æ­¤ç©ºé—´ä¸­è¿è¡Œæ‚¨çš„åº”ç”¨ç¨‹åºã€‚æˆ‘ä»¬å¿«é€Ÿæ¥çœ‹ä¸‹ä¸¤ä¸ªè¿™æ ·çš„åŠŸèƒ½ï¼š\n namespaces\nç®€å•çš„è®²å°±æ˜¯ï¼ŒLinux namespace å…è®¸ç”¨æˆ·åœ¨ç‹¬ç«‹è¿›ç¨‹ä¹‹é—´éš”ç¦» CPU ç­‰èµ„æºã€‚è¿›ç¨‹çš„è®¿é—®æƒé™åŠå¯è§æ€§ä»…é™äºå…¶æ‰€åœ¨çš„ namespaces ã€‚å› æ­¤ï¼Œç”¨æˆ·æ— éœ€æ‹…å¿ƒåœ¨ä¸€ä¸ª namespace å†…è¿è¡Œçš„è¿›ç¨‹ä¸åœ¨å¦ä¸€ä¸ª namespace å†…è¿è¡Œçš„è¿›ç¨‹å†²çªã€‚ç”šè‡³å¯ä»¥åŒä¸€å°æœºå™¨ä¸Šçš„ä¸åŒå®¹å™¨ä¸­è¿è¡Œå…·æœ‰ç›¸åŒ PID çš„è¿›ç¨‹ã€‚åŒæ ·çš„ï¼Œä¸¤ä¸ªä¸åŒå®¹å™¨ä¸­çš„åº”ç”¨ç¨‹åºå¯ä»¥ä½¿ç”¨ç›¸åŒçš„ç«¯å£ã€‚\n cgroups\ncgroups å…è®¸å¯¹å¯ç”¨èµ„æºè®¾ç½®é™åˆ¶å’Œçº¦æŸã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥åœ¨ä¸€å°æ‹¥æœ‰ 16G å†…å­˜çš„è®¡ç®—æœºä¸Šåˆ›å»ºä¸€ä¸ª namespace ï¼Œé™åˆ¶å…¶å†…éƒ¨è¿›ç¨‹å¯ç”¨å†…å­˜ä¸º 1GBã€‚\n  åˆ°è¿™ï¼Œæ‚¨å¯èƒ½å·²ç»çŒœåˆ° Docker çš„å·¥ä½œåŸç†äº†ã€‚å½“æ‚¨è¯·æ±‚ Docker è¿è¡Œå®¹å™¨æ—¶ï¼ŒDocker ä¼šåœ¨æ‚¨çš„è®¡ç®—æœºä¸Šè®¾ç½®ä¸€ä¸ªèµ„æºéš”ç¦»çš„ç¯å¢ƒã€‚ç„¶å Docker ä¼šå°†æ‰“åŒ…çš„åº”ç”¨ç¨‹åºå’Œå…³è”çš„æ–‡ä»¶å¤åˆ¶åˆ° namespace å†…çš„æ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œæ­¤æ—¶ç¯å¢ƒçš„é…ç½®å°±å®Œæˆäº†ã€‚ä¹‹å Docker ä¼šæ‰§è¡Œæ‚¨æŒ‡å®šçš„å‘½ä»¤è¿è¡Œåº”ç”¨ç¨‹åºã€‚\nç®€è€Œè¨€ä¹‹ï¼ŒDocker é€šè¿‡ä½¿ç”¨ Linux namespace å’Œ cgroupï¼ˆä»¥åŠå…¶ä»–ä¸€äº›å‘½ä»¤ï¼‰æ¥åè°ƒé…ç½®å®¹å™¨ï¼Œå°†åº”ç”¨ç¨‹åºæ–‡ä»¶å¤åˆ¶åˆ°ä¸ºå®¹å™¨åˆ†é…çš„ç£ç›˜ï¼Œç„¶åè¿è¡Œå¯åŠ¨å‘½ä»¤ã€‚Docker è¿˜é™„å¸¦äº†è®¸å¤šå…¶ä»–ç”¨äºç®¡ç†å®¹å™¨çš„å·¥å…·ï¼Œä¾‹å¦‚ï¼šåˆ—å‡ºæ­£åœ¨è¿è¡Œçš„å®¹å™¨ï¼Œåœæ­¢å®¹å™¨ï¼Œå‘å¸ƒå®¹å™¨é•œåƒç­‰è®¸å¤šå…¶ä»–å·¥å…·ã€‚\nä¸è™šæ‹Ÿæœºç›¸æ¯”ï¼Œå®¹å™¨æ›´è½»é‡ä¸”é€Ÿåº¦æ›´å¿«ï¼Œå› ä¸ºå®ƒåˆ©ç”¨äº† Linux åº•å±‚æ“ä½œç³»ç»Ÿåœ¨éš”ç¦»çš„ç¯å¢ƒä¸­è¿è¡Œã€‚è™šæ‹Ÿæœºçš„ hypervisor åˆ›å»ºäº†ä¸€ä¸ªéå¸¸ç‰¢å›ºçš„è¾¹ç•Œï¼Œä»¥é˜²æ­¢åº”ç”¨ç¨‹åºçªç ´å®ƒï¼Œè€Œå®¹å™¨çš„è¾¹ç•Œä¸é‚£ä¹ˆå¼ºå¤§ã€‚å¦ä¸€ä¸ªåŒºåˆ«æ˜¯ï¼Œç”±äº namespace å’Œ cgroups åŠŸèƒ½ä»…åœ¨ Linux ä¸Šå¯ç”¨ï¼Œå› æ­¤å®¹å™¨æ— æ³•åœ¨å…¶ä»–æ“ä½œç³»ç»Ÿä¸Šè¿è¡Œã€‚æ­¤æ—¶æ‚¨å¯èƒ½æƒ³çŸ¥é“ Docker å¦‚ä½•åœ¨ macOS æˆ– Windows ä¸Šè¿è¡Œï¼Ÿ Docker å®é™…ä¸Šä½¿ç”¨äº†ä¸€ä¸ªæŠ€å·§ï¼Œå¹¶åœ¨é Linux æ“ä½œç³»ç»Ÿä¸Šå®‰è£… Linux è™šæ‹Ÿæœºï¼Œç„¶ååœ¨è™šæ‹Ÿæœºå†…è¿è¡Œå®¹å™¨ã€‚\nè®©æˆ‘ä»¬åˆ©ç”¨ç›®å‰ä¸ºæ­¢å­¦åˆ°çš„æ‰€æœ‰å†…å®¹ï¼Œä»å¤´å¼€å§‹åˆ›å»ºå’Œè¿è¡Œ Docker å®¹å™¨ã€‚å¦‚æœä½ è¿˜æ²¡æœ‰å°† Docker å®‰è£…åœ¨ä½ çš„æœºå™¨ä¸Šï¼Œå¯ä»¥å‚è€ƒè¿™é‡Œå®‰è£… Docker ã€‚åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ª Docker å®¹å™¨ï¼Œä¸‹è½½ä¸€ä¸ªç”¨ Cè¯­è¨€ å†™çš„ Web æœåŠ¡ï¼Œç¼–è¯‘å¹¶è¿è¡Œå®ƒï¼Œç„¶åä½¿ç”¨æµè§ˆå™¨è®¿é—®è¿™ä¸ª Web æœåŠ¡ã€‚\næˆ‘ä»¬å°†ä»æ‰€æœ‰ Docker é¡¹ç›®å¼€å§‹çš„åœ°æ–¹ï¼šåˆ›å»ºä¸€ä¸ª Dockerfile å¼€å§‹ã€‚æ­¤æ–‡ä»¶æè¿°äº†å¦‚ä½•åˆ›å»ºç”¨äºè¿è¡Œå®¹å™¨çš„ docker é•œåƒã€‚æ—¢ç„¶æˆ‘ä»¬è¿˜æ²¡æœ‰èŠåˆ°é•œåƒï¼Œé‚£ä¹ˆè®©æˆ‘ä»¬çœ‹ä¸€ä¸‹é•œåƒçš„å®˜æ–¹å®šä¹‰ï¼š\n é•œåƒæ˜¯ä¸€ä¸ªå¯æ‰§è¡ŒåŒ…ï¼Œå…¶åŒ…å«è¿è¡Œåº”ç”¨ç¨‹åºæ‰€éœ€çš„ä»£ç ã€è¿è¡Œæ—¶ã€åº“ã€ç¯å¢ƒå˜é‡å’Œé…ç½®æ–‡ä»¶ï¼Œå®¹å™¨æ˜¯é•œåƒçš„è¿è¡Œæ—¶å®ä¾‹ã€‚\n ç®€å•çš„è®²ï¼Œå½“ä½ è¦æ±‚ Docker è¿è¡Œä¸€ä¸ªå®¹å™¨æ—¶ï¼Œä½ å¿…é¡»ç»™å®ƒä¸€ä¸ªåŒ…å«å¦‚ä¸‹å†…å®¹çš„é•œåƒï¼š\n åŒ…å«åº”ç”¨ç¨‹åºåŠå…¶æ‰€æœ‰ä¾èµ–çš„æ–‡ä»¶ç³»ç»Ÿå¿«ç…§ã€‚ å®¹å™¨å¯åŠ¨æ—¶çš„è¿è¡Œå‘½ä»¤ã€‚  åœ¨ Docker çš„ä¸–ç•Œï¼Œä½¿ç”¨åˆ«äººçš„é•œåƒä½œä¸ºåŸºç¡€é•œåƒæ¥åˆ›å»ºè‡ªå·±çš„é•œåƒæ˜¯ååˆ†æ™®éçš„ã€‚ä¾‹å¦‚ï¼Œå®˜æ–¹ reds Docker é•œåƒå°±æ˜¯åŸºäº Debian æ–‡ä»¶ç³»ç»Ÿå¿«ç…§ï¼ˆrootfs tarballï¼‰ï¼Œå¹¶å®‰è£…åœ¨å…¶ä¸Šé…ç½® Redisã€‚\nåœ¨æˆ‘ä»¬çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬é€‰æ‹© Alpine Linux ä¸ºåŸºç¡€é•œåƒã€‚å½“æ‚¨åœ¨ Docker ä¸­çœ‹åˆ° â€œalpineâ€ æ—¶ï¼Œå®ƒé€šå¸¸æ„å‘³ç€ä¸€ä¸ªç²¾ç®€çš„åŸºæœ¬é•œåƒã€‚ Alpine Linux é•œåƒå¤§å°åªæœ‰çº¦ä¸º5 MBï¼\nåœ¨æ‚¨çš„è®¡ç®—æœºåˆ›å»ºä¸€ä¸ªæ–°ç›®å½•ï¼ˆä¾‹å¦‚ dockerprj ï¼‰ï¼Œç„¶åæ–°å»ºä¸€ä¸ª Dockerfile æ–‡ä»¶ã€‚\numermansoor:dockerprj$ touch Dockerfile  å°†å¦‚ä¸‹å†…å®¹ç²˜è´´åˆ° Dockerfileï¼š\n# Use Alpine Linux rootfs tarball to base our image on FROM alpine:3.9 # Set the working directory to be '/home' WORKDIR '/home' # Setup our application on container's file system RUN wget http://www.cs.cmu.edu/afs/cs/academic/class/15213-s00/www/class28/tiny.c \\ \u0026amp;\u0026amp; apk add build-base \\ \u0026amp;\u0026amp; gcc tiny.c -o tiny \\ \u0026amp;\u0026amp; echo 'Hello World' \u0026gt;\u0026gt; index.html # Start the web server. This is container's entry point CMD [\u0026quot;./tiny\u0026quot;, \u0026quot;8082\u0026quot;] # Expose port 8082 EXPOSE 8082  è¿™ä¸ª Dockerfile åŒ…å«åˆ›å»ºé•œåƒçš„å†…å®¹è¯´æ˜ã€‚æˆ‘ä»¬åˆ›å»ºé•œåƒåŸºäº Alpine Linuxï¼ˆrootfs tarballï¼‰ï¼Œå¹¶å°†å·¥ä½œç›®å½•è®¾ç½®ä¸º /home ã€‚æ¥ä¸‹æ¥ä¸‹è½½ï¼Œç¼–è¯‘å¹¶åˆ›å»ºäº†ä¸€ä¸ªç”¨Cç¼–å†™çš„ç®€å• Web æœåŠ¡å™¨çš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œç„¶åæŒ‡å®šåœ¨è¿è¡Œå®¹å™¨æ—¶è¦æ‰§è¡Œçš„å‘½ä»¤ï¼Œå¹¶å°†å®¹å™¨ç«¯å£8082æš´éœ²ç»™ä¸»æœºã€‚\nç°åœ¨ï¼Œæˆ‘ä»¬å°±å¯ä»¥æ„å»ºé•œåƒäº†ã€‚åœ¨ Dockerfile çš„åŒçº§ç›®å½•è¿è¡Œ docker build å‘½ä»¤ï¼š\numermansoor:dockerprj$ docker build -t codeahoydocker .  å¦‚æœè¿™ä¸ªå‘½ä»¤æˆåŠŸäº†ï¼Œæ‚¨å°†çœ‹åˆ°ï¼š\nSuccessfully tagged codeahoydocker:latest  æ­¤æ—¶æˆ‘ä»¬çš„é•œåƒå°±åˆ›å»ºæˆåŠŸäº†ï¼Œè¯¥é•œåƒä¸»è¦åŒ…æ‹¬ï¼š\n æ–‡ä»¶ç³»ç»Ÿå¿«ç…§ï¼ˆAlpine Linux å’Œ æˆ‘ä»¬å®‰è£…çš„ Web æœåŠ¡ï¼‰ å¯åŠ¨å‘½ä»¤ï¼ˆ./tiny 8092ï¼‰  æ—¢ç„¶æˆåŠŸæ„å»ºäº†é•œåƒï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤è¿è¡Œå®¹å™¨ã€‚\numermansoor:dockerprj$ docker run -p 8082:8082 codeahoydocker:latest  è®©æˆ‘ä»¬äº†è§£ä¸‹è¿™é‡Œå‘ç”Ÿäº†ä»€ä¹ˆã€‚\né€šè¿‡ docker run å‘½ä»¤ï¼Œæˆ‘ä»¬è¯·æ±‚ Docker åŸºäº codeahoydocker:latest é•œåƒåˆ›å»ºå’Œå¯åŠ¨ä¸€ä¸ªå®¹å™¨ã€‚-p 8082:8082 å°†æœ¬åœ°çš„8082ç«¯å£æ˜ å°„åˆ°å®¹å™¨çš„8082ç«¯å£ï¼ˆå®¹å™¨å†…çš„ Web æœåŠ¡å™¨æ­£åœ¨ç›‘å¬8082ç«¯å£ä¸Šçš„è¿æ¥ï¼‰ã€‚æ‰“å¼€ä½ çš„æµè§ˆå™¨å¹¶è®¿é—® localhost:8082/index.html ã€‚ä½ å°†å¯ä»¥çœ‹åˆ° Hello World ä¿¡æ¯ã€‚\næœ€åæˆ‘æƒ³è¡¥å……ä¸€ç‚¹ï¼Œè™½ç„¶ Docker éå¸¸æ£’ï¼Œè€Œä¸”å¯¹äºå¤§å¤šæ•°é¡¹ç›®æ¥è¯´å®ƒæ˜¯ä¸€ä¸ªä¸é”™çš„é€‰æ‹©ï¼Œä½†æˆ‘ä»¬å¹¶éå¤„å¤„éƒ½è¦ä½¿ç”¨å®ƒã€‚åœ¨æˆ‘çš„å·¥ä½œä¸­ï¼ŒDocker ä¸ Kubernetes ç»“åˆä½¿ç”¨ï¼Œå¯ä»¥éå¸¸è½»æ¾åœ°éƒ¨ç½²å’Œç®¡ç†åç«¯å¾®æœåŠ¡ï¼Œæˆ‘ä»¬ä¸å¿…ä¸ºæ¯ä¸ªæœåŠ¡é…ç½®æ–°çš„è¿è¡Œç¯å¢ƒã€‚å¦ä¸€æ–¹é¢ï¼Œå¯¹äºæ€§èƒ½å¯†é›†å‹åº”ç”¨ç¨‹åºï¼ŒDocker å¯èƒ½ä¸æ˜¯æœ€ä½³é€‰æ‹©ã€‚æˆ‘ç»æ‰‹çš„å…¶ä¸­ä¸€ä¸ªé¡¹ç›®å¿…é¡»å¤„ç†æ¥è‡ªç§»åŠ¨æ¸¸æˆå®¢æˆ·ç«¯çš„ TCP é•¿è¿æ¥ï¼ˆæ¯å°æœºå™¨1000ä¸ªï¼‰ï¼Œè¿™æ—¶ Docker ç½‘ç»œå‡ºç°äº†å¾ˆå¤šé—®é¢˜ï¼Œå¯¼è‡´æ— æ³•å°†å®ƒç”¨äºè¯¥é¡¹ç›®ã€‚\nå¸Œæœ›ä¸Šé¢è¿™äº›å†…å®¹æœ‰ç”¨ã€‚\n è¿™ç¯‡æ–‡ç« ç”± Umer Mansoor æ’°å†™ï¼Œå¯ä»¥åœ¨ Facebook æˆ– Twitter ä¸Šå…³æ³¨å¹¶ç•™ä¸‹è¯„è®ºã€‚\n åŸæ–‡åœ°å€ï¼š https://codeahoy.com/2019/04/12/what-are-containers-a-simple-guide-to-containerization-and-how-docker-works/\n","date":1555761290,"expirydate":-62135596800,"kind":"page","lang":"zh","lastmod":1555761290,"objectID":"dce85cd7440eb7c964881f0efb3d802d","permalink":"https://guoxudong.io/post/what-are-containers-a-simple-guide-to-containerization-and-how-docker-works/","publishdate":"2019-04-20T19:54:50+08:00","relpermalink":"/post/what-are-containers-a-simple-guide-to-containerization-and-how-docker-works/","section":"post","summary":"Docker éå¸¸æ£’ï¼ å®ƒä½¿è½¯ä»¶å¼€å‘è€…æ— éœ€æ‹…å¿ƒé…ç½®å’Œä¾èµ–æ€§ï¼Œåœ¨ä»»ä½•åœ°æ–¹æ‰“åŒ…ï¼Œå‘é€å’Œè¿è¡Œä»–ä»¬çš„åº”ç”¨ç¨‹åºã€‚è€Œåœ¨ä¸ kubernetes ç›¸ç»“åˆåï¼Œå®ƒä½¿åº”ç”¨é›†ç¾¤éƒ¨ç½²å’Œç®¡ç†å˜å¾—æ›´æ–¹ä¾¿ã€‚è¿™ä½¿å¾— Docker æ·±å—è½¯ä»¶å¼€å‘è€…çš„å–œçˆ±ï¼Œè¶Šæ¥è¶Šå¤šçš„å¼€å‘è€…å¼€å§‹ä½¿ç”¨ Dockerã€‚","tags":["ç¿»è¯‘","Docker","å®¹å™¨"],"title":"ä»€ä¹ˆçš„å®¹å™¨ï¼ŸDocker å·¥ä½œåŸç†åŠå®¹å™¨åŒ–ç®€æ˜“æŒ‡å—","type":"post"},{"authors":["éƒ­æ—­ä¸œ"],"categories":["kustomize"],"content":" æœ¬æ–‡ä»‹ç»ä½¿ç”¨å’Œç»´æŠ¤ Kustomize çš„æ–¹æ³•åŠæ­¥éª¤ã€‚\nå®šåˆ¶é…ç½® åœ¨è¿™ä¸ªå·¥ä½œæµæ–¹å¼ä¸­ï¼Œæ‰€æœ‰çš„é…ç½®æ–‡ä»¶ï¼ˆ YAML èµ„æºï¼‰éƒ½ä¸ºç”¨æˆ·æ‰€æœ‰ï¼Œå­˜åœ¨äºç§æœ‰ repo ä¸­ã€‚å…¶ä»–äººæ˜¯æ— æ³•ä½¿ç”¨çš„ã€‚\n åˆ›å»ºä¸€ä¸ªç›®å½•ç”¨äºç‰ˆæœ¬æ§åˆ¶\næˆ‘ä»¬å¸Œæœ›å°†ä¸€ä¸ªåä¸º ldap çš„ Kubernetes é›†ç¾¤åº”ç”¨çš„é…ç½®ä¿å­˜åœ¨è‡ªå·±çš„ repo ä¸­ã€‚ è¿™é‡Œä½¿ç”¨ git è¿›è¡Œç‰ˆæœ¬æ§åˆ¶ã€‚\ngit init ~/ldap  åˆ›å»ºä¸€ä¸ª base\nmkdir -p ~/ldap/base  åœ¨è¿™ä¸ªç›®å½•ä¸­åˆ›å»ºå¹¶æäº¤ kustomization.yaml æ–‡ä»¶å’Œä¸€ç»„èµ„æºï¼Œä¾‹å¦‚ deployment.yaml service.yaml ç­‰ã€‚\n åˆ›å»º overlays\nmkdir -p ~/ldap/overlays/staging mkdir -p ~/ldap/overlays/production  æ¯ä¸ªç›®å½•éƒ½éœ€è¦ä¸€ä¸ª kustomization.yaml æ–‡ä»¶ä»¥åŠä¸€ä¸ªæˆ–å¤šä¸ª patch ï¼Œä¾‹å¦‚ healthcheck_patch.yaml memorylimit_patch.yaml ç­‰ã€‚ã€‚\n productionç›®å½•åˆ™å¯èƒ½ä¼šåœ¨deployment``` ä¸­å¢åŠ åœ¨å‰¯æœ¬æ•°ã€‚\n ç”Ÿæˆ variants\nè¿è¡Œ kustomize ï¼Œå°†ç”Ÿæˆçš„é…ç½®ç”¨äº kubernetes åº”ç”¨éƒ¨ç½²\nkustomize build ~/ldap/overlays/staging | kubectl apply -f - kustomize build ~/ldap/overlays/production | kubectl apply -f -  åœ¨ kubernetes 1.14 ç‰ˆæœ¬ï¼Œ kustomize å·²ç»é›†æˆåˆ° kubectl å‘½ä»¤ä¸­ï¼Œæˆä¸ºäº†å…¶ä¸€ä¸ªå­å‘½ä»¤ï¼Œå¯ä½¿ç”¨ kubectl æ¥è¿›è¡Œéƒ¨ç½²\nkubectl apply -k ~/ldap/overlays/staging kubectl apply -k ~/ldap/overlays/production   ä½¿ç”¨ç°æˆçš„é…ç½® åœ¨è¿™ä¸ªå·¥ä½œæµæ–¹å¼ä¸­ï¼Œå¯ä»åˆ«äººçš„ repo ä¸­ fork kustomize é…ç½®ï¼Œå¹¶æ ¹æ®è‡ªå·±çš„éœ€æ±‚æ¥é…ç½®ã€‚\n é€šè¿‡ fork/modify/rebase ç­‰æ–¹å¼è·å¾—é…ç½®\n å°†å…¶å…‹éš†ä¸ºä½ è‡ªå·±çš„ base\nåœ¨è¿™ä¸ª bash ç›®å½•ç»´æŠ¤åœ¨ä¸€ä¸ª repo ä¸­ï¼Œåœ¨è¿™ä¸ªä¾‹å­ä½¿ç”¨ ladp çš„ repo\nmkdir ~/ldap git clone https://github.com/$USER/ldap ~/ldap/base cd ~/ldap/base git remote add upstream git@github.com:$USER/ldap  åˆ›å»º overlays\nå¦‚ä¸Šé¢çš„æ¡ˆä¾‹ä¸€æ ·ï¼Œåˆ›å»ºå¹¶å®Œå–„ overlays ç›®å½•ä¸­çš„å†…å®¹\nmkdir -p ~/ldap/overlays/staging mkdir -p ~/ldap/overlays/production  ç”¨æˆ·å¯ä»¥å°† overlays ç»´æŠ¤åœ¨ä¸åŒçš„ repo ä¸­\n ç”Ÿæˆ variants\nkustomize build ~/ldap/overlays/staging | kubectl apply -f - kustomize build ~/ldap/overlays/production | kubectl apply -f -  åœ¨ kubernetes 1.14 ç‰ˆæœ¬ï¼Œ kustomize å·²ç»é›†æˆåˆ° kubectl å‘½ä»¤ä¸­ï¼Œæˆä¸ºäº†å…¶ä¸€ä¸ªå­å‘½ä»¤ï¼Œå¯ä½¿ç”¨ kubectl æ¥è¿›è¡Œéƒ¨ç½²\nkubectl apply -k ~/ldap/overlays/staging kubectl apply -k ~/ldap/overlays/production  ï¼ˆå¯é€‰ï¼‰æ›´æ–° base ç”¨æˆ·å¯ä»¥å®šæœŸä»ä¸Šæ¸¸ repo ä¸­ rebase ä»–ä»¬çš„ base ä»¥ä¿è¯åŠæ—¶æ›´æ–°\ncd ~/ldap/base git fetch upstream git rebase upstream/master   å‚è€ƒ  kustomize workflows - github.com  ","date":1555661102,"expirydate":-62135596800,"kind":"page","lang":"zh","lastmod":1555661102,"objectID":"257919151edb205a36c7fed9bcafc247","permalink":"https://guoxudong.io/post/kustomize-2/","publishdate":"2019-04-19T16:05:02+08:00","relpermalink":"/post/kustomize-2/","section":"post","summary":"æœ¬ç¯‡ä¸ºç³»åˆ—æ–‡ç« ç¬¬äºŒç¯‡ï¼Œæ‰‹æŠŠæ‰‹æ•™ä½ ä½¿ç”¨ Kustomize çš„ä¸¤ç§æ–¹å¼ã€‚","tags":["kubernetes","kustomize","å·¥å…·"],"title":"ä½¿ç”¨ Kustomize å¸®ä½ ç®¡ç† kubernetes åº”ç”¨ï¼ˆäºŒï¼‰ï¼š Kustomize çš„ä½¿ç”¨æ–¹æ³•","type":"post"},{"authors":["éƒ­æ—­ä¸œ"],"categories":["é—®é¢˜è§£å†³"],"content":" å‰è¨€ Rancher 2.2.X ç‰ˆæœ¬äº3æœˆåº•æ­£å¼GAï¼Œæ–°ç‰ˆæœ¬å¤„ç†å…¶ä»–éƒ¨åˆ†çš„ä¼˜åŒ–ä»¥å¤–ï¼Œæœ€å¤§äº®ç‚¹è«è¿‡äºæœ¬èº«é›†æˆäº† Prometheus ï¼Œå¯ä»¥é€šè¿‡ Rancher è‡ªå¸¦ UI æˆ–è€… Grafana æŸ¥çœ‹é›†ç¾¤çš„å®æ—¶ç›‘æ§ï¼Œå¯¹æ‰€æœ‰ç›‘æ§è¿›è¡Œäº†ä¸€æ¬¡èšåˆï¼Œä¸ç”¨å†å’Œä¹‹å‰ä¸€æ ·ï¼Œæ¯ä¸ªé›†ç¾¤éƒ½è¦å®‰è£…ä¸€ä¸ª Prometheus ç”¨äºç›‘æ§ï¼Œè€Œå‘Šè­¦éƒ¨åˆ†ä¹Ÿå¯ä½¿ç”¨ Rancher è‡ªå¸¦çš„é€šçŸ¥ç»„ä»¶è¿›è¡Œå‘Šè­¦ã€‚é€šçŸ¥æ–¹å¼ç›®å‰æ”¯æŒ Slack ã€ é‚®ä»¶ã€ PagerDuty ã€ Webhook ã€ ä¼ä¸šå¾®ä¿¡ï¼Œç”±äºæˆ‘å¸åŠå…¬ä½¿ç”¨é’‰é’‰ï¼Œæ‰€ä»¥æˆ‘ä»¬ä½¿ç”¨äº† Webhook çš„æ–¹å¼ï¼Œå‘Šè­¦è§¦å‘åé€šçŸ¥æˆ‘ä»¬çš„æ¶ˆæ¯æœåŠ¡ï¼Œç„¶åæ¶ˆæ¯æœåŠ¡å°†å…¶å‘é€åˆ°é’‰é’‰è¿›è¡Œå‘Šè­¦ã€‚\né—®é¢˜ Rancher é›†æˆ Prometheus åï¼Œç›‘æ§æ–¹é¢å˜çš„ååˆ†å¼ºå¤§ï¼Œä¸ç”¨å†å¾˜å¾Šäºå¤šä¸ªé›†ç¾¤çš„ Grafana ï¼Œç›´æ¥åœ¨ Rancher ä¸Šå³å¯æŸ¥çœ‹ï¼Œéå¸¸æ–¹ä¾¿\nä½†æ˜¯åœ¨ä½¿ç”¨çš„æ—¶å€™ï¼Œæˆ‘å‘ç°äº†ä¸€ä¸ªé—®é¢˜ï¼šå°±æ˜¯åœ¨æŸ¥çœ‹ å·¥ä½œè´Ÿè½½å’Œ Pod çš„æ—¶å€™ä¼šæ˜¾ç¤º æ²¡æœ‰è¶³å¤Ÿçš„æ•°æ®ç»˜åˆ¶å›¾è¡¨\nè¿›å…¥ Grafana æŸ¥çœ‹ä¼šå‘ç°ï¼Œå…¶å®ç›‘æ§å‚æ•°æ˜¯å­˜åœ¨çš„ï¼Œä½†æ˜¯æ²¡æœ‰é‡‡é›†åˆ°å€¼ï¼Œæ‰€ä»¥å¹¶æ²¡æœ‰å±•ç¤ºå‡ºæ¥ã€‚\nè§£å†³ åœ¨æ£€æŸ¥äº†é…ç½®åå¹¶æ²¡æœ‰æ‰¾åˆ°åŸå› ï¼Œåªå¥½å» GitHub ä¸Šæä¸€ä¸ª issue æ¥è¯¢é—®ä¸€ä¸‹å¼€å‘è€…æˆ–è€…å…¶ä»–ç”¨æˆ·æœ‰æ— é‡åˆ°è¿™ä¸ªé—®é¢˜ã€‚\nRancher å®˜æ–¹çš„å¼€å‘è€…è¿˜æ˜¯ååˆ†è´Ÿè´£çš„ï¼Œ GitHub ä¸Šç”¨æˆ·åä¸º Logan çš„å®˜æ–¹å°å“¥æ¥æˆ‘æŒ‡å¯¼è§£å†³è¿™ä¸ªé—®é¢˜ã€‚\nå°å“¥å‘ç°æˆ‘æ˜¯å¯¼å…¥çš„é›†ç¾¤ï¼Œè¦æˆ‘è¿›å…¥ Prometheus æŸ¥çœ‹ï¼Œå‘ç° cattle-prometheus/exporter-kube-state-cluster-monitoring æœç„¶æ²¡æœ‰èµ·æ¥\nè§£å†³è¿™ä¸ªé—®é¢˜ï¼Œéœ€è¦åœ¨é›†ç¾¤ç›‘æ§é…ç½®ä¸­æ·»åŠ ä¸€ä¸ªé«˜çº§é€‰é¡¹ï¼Œæ’å…¥å€¼ä¸ºï¼šexporter-kubelets.https=false\nç‚¹å‡»ä¿å­˜ï¼Œé—®é¢˜å°±è§£å†³äº†ï¼\nåè®° ä½¿ç”¨ Rancher æœ‰åŠå¹´ï¼Œä»2.0ç‰ˆæœ¬ä¸€ç›´ç”¨åˆ°2.2ç‰ˆæœ¬ï¼Œè€Œ18å¹´åˆ†åˆ«åœ¨äº‘æ –å¤§ä¼šå’Œ KubeCon ä¸Šå¬äº† Rancher åˆ›å§‹äººæ¢èƒœåšå£«çš„æ¼”è®²ã€‚è€Œä»è¿™ä¸€ä¸ªå°é—®é¢˜ä¸Šå°±å¯ä»¥çœ‹åˆ° Rancher å®˜æ–¹å¯¹æ¯ä¸€ä¸ªç”¨æˆ·éƒ½æ˜¯ååˆ†é‡è§†çš„ã€‚\n","date":1555580768,"expirydate":-62135596800,"kind":"page","lang":"zh","lastmod":1555580768,"objectID":"b286690e5f23f66c320001dd3f3334e7","permalink":"https://guoxudong.io/post/rancher-prometheus-fix-question/","publishdate":"2019-04-18T17:46:08+08:00","relpermalink":"/post/rancher-prometheus-fix-question/","section":"post","summary":"è®°ä¸€æ¬¡åœ¨ Rancher å®˜æ–¹å°å“¥å¸®åŠ©ä¸‹è§£å†³ Rancher é—®é¢˜çš„è¿‡ç¨‹ã€‚","tags":["rancher","kubernetes","prometheus"],"title":"Rancher 2.2.1 è§£å†³å·¥ä½œè´Ÿè½½ç›‘æ§ä¸ºç©ºé—®é¢˜","type":"post"},{"authors":["éƒ­æ—­ä¸œ"],"categories":["ç¿»è¯‘"],"content":"  ä½œè€…ï¼šJeff Regan (Google), Phil Wittrock (Google) 2018-05-29\n å¦‚æœä½ åœ¨è¿è¡Œ kubernetes é›†ç¾¤ï¼Œä½ å¯èƒ½ä¼šæ‹·è´ä¸€äº›åŒ…å« kubernetes API å¯¹è±¡çš„ YAML æ–‡ä»¶ï¼Œå¹¶ä¸”æ ¹æ®ä½ çš„éœ€æ±‚æ¥ä¿®æ”¹è¿™äº›æ–‡ä»¶ï¼Œé€šè¿‡è¿™äº› YAML æ–‡ä»¶æ¥å®šä¹‰ä½ çš„ kubernetes é…ç½®ã€‚\nä½†æ˜¯è¿™ç§æ–¹æ³•å­˜åœ¨å¾ˆéš¾æ‰¾åˆ°é…ç½®çš„æºå¤´å¹¶å¯¹å…¶è¿›è¡Œæ”¹è¿›ã€‚ä»Šå¤© Google å®£å¸ƒæ¨å‡º Kustomize ï¼Œä¸€ä¸ªä½œä¸º SIG-CLI å­é¡¹ç›®çš„å‘½ä»¤è¡Œå·¥å…·ã€‚è¿™ä¸ªå·¥å…·æä¾›äº†ä¸€ä¸ªå…¨æ–°çš„ã€çº¯ç²¹çš„å£°æ˜å¼çš„æ–¹æ³•æ¥å®šåˆ¶ kubernetes é…ç½®ï¼Œéµå¾ªå¹¶åˆ©ç”¨æˆ‘ä»¬ç†Ÿæ‚‰ä¸”ç²¾å¿ƒè®¾è®¡çš„ Kubernetes APIã€‚\næœ‰è¿™æ ·ä¸€ä¸ªå¸¸è§çš„åœºæ™¯ï¼Œåœ¨äº’è”ç½‘ä¸Šå¯ä»¥çœ‹åˆ°åˆ«äººçš„ CMSï¼ˆcontent management systemï¼Œå†…å®¹ç®¡ç†ç³»ç»Ÿï¼‰çš„ kubernetes é…ç½®ï¼Œè¿™ä¸ªé…ç½®æ˜¯ä¸€ç»„åŒ…æ‹¬ Kubernetes API å¯¹è±¡çš„ YAML æè¿°æ–‡ä»¶ã€‚ç„¶åï¼Œåœ¨æ‚¨è‡ªå·±å…¬å¸çš„æŸä¸ªè§’è½ï¼Œæ‚¨æ‰¾åˆ°ä¸€ä¸ªä½ éå¸¸äº†è§£çš„æ•°æ®åº“ï¼Œå¸Œæœ›ç”¨å®ƒæ¥è¯¥ CMS çš„æ•°æ®ã€‚\nä½ å¸Œæœ›åŒæ—¶ä½¿ç”¨å®ƒä»¬ï¼Œæ­¤å¤–ï¼Œä½ å¸Œæœ›è‡ªå®šä¹‰é…ç½®æ–‡ä»¶ä»¥ä¾¿ä½ çš„èµ„æºå®ä¾‹åœ¨é›†ç¾¤ä¸­æ˜¾ç¤ºï¼Œå¹¶é€šè¿‡æ·»åŠ ä¸€ä¸ªæ ‡ç­¾æ¥åŒºåˆ†åœ¨åŒä¸€é›†ç¾¤ä¸­åšåŒæ ·äº‹æƒ…çš„å…¶ä»–èµ„æºã€‚åŒæ—¶ä¹Ÿå¸Œæœ›ä¸ºå…¶é…ç½®é€‚å½“çš„ CPU ã€å†…å­˜å’Œå‰¯æœ¬æ•°ã€‚\næ­¤å¤–ï¼Œä½ è¿˜æƒ³è¦é…ç½®æ•´ä¸ªé…ç½®çš„å¤šç§å˜åŒ–ï¼šä¸€ä¸ªä¸“é—¨ç”¨äºæµ‹è¯•å’Œå®éªŒçš„å°æœåŠ¡å®ä¾‹ï¼ˆå°±è®¡ç®—èµ„æºè€Œè¨€ï¼‰ï¼Œæˆ–æ›´å¤§çš„ç”¨äºå¯¹å¤–æä¾›æœåŠ¡çš„ç”Ÿäº§çº§åˆ«çš„æœåŠ¡å®ä¾‹ã€‚åŒæ—¶ï¼Œå…¶ä»–çš„å›¢é˜Ÿä¹Ÿå¸Œæœ›æ‹¥æœ‰ä»–ä»¬è‡ªå·±çš„æœåŠ¡å®ä¾‹ã€‚\nå®šåˆ¶å°±æ˜¯å¤ç”¨ kubernetes çš„é…ç½®å¹¶ä¸æ˜¯ä»£ç ï¼ˆæ˜¯ä½¿ç”¨ YAML æè¿°çš„ API å¯¹è±¡ï¼Œä¸¥æ ¼æ¥è¯´åº”è¯¥æ˜¯æ•°æ®ï¼‰ï¼Œä½†æ˜¯é…ç½®çš„ç”Ÿå‘½å‘¨æœŸä¸ä»£ç çš„ç”Ÿå‘½å‘¨æœŸæœ‰è®¸å¤šç›¸ä¼¼ä¹‹å¤„ã€‚\nä½ éœ€è¦åœ¨ç‰ˆæœ¬æ§åˆ¶ä¸­ä¿ç•™é…ç½®ã€‚æ‰€æœ‰è€…çš„é…ç½®ä¸å¿…ä¸ä½¿ç”¨è€…çš„é…ç½®ç›¸åŒã€‚é…ç½®å¯ä»¥ä½œä¸ºæ•´ä½“çš„ä¸€éƒ¨åˆ†ã€‚è€Œç”¨æˆ·å¸Œæœ›ä¸ºåœ¨ä¸åŒçš„æƒ…å†µä¸‹å¤ç”¨è¿™äº›é…ç½®ã€‚\nä¸ä»£ç å¤ç”¨ç›¸åŒï¼Œä¸€ç§å¤ç”¨é…ç½®çš„æ–¹æ³•æ˜¯ç®€å•çš„å…¨éƒ¨æ‹·è´å¹¶è¿›è¡Œè‡ªå®šä¹‰ã€‚åƒä»£ç ä¸€æ ·ï¼Œåˆ‡æ–­ä¸æºä»£ç çš„è”ç³»ä½¿å¾—ä»æ”¹è¿›å˜çš„ååˆ†å›°éš¾ã€‚è®¸å¤šå›¢é˜Ÿå’Œç¯å¢ƒéƒ½ä½¿ç”¨è¿™ç§æ–¹æ³•ï¼Œæ¯ä¸ªå›¢é˜Ÿå’Œç¯å¢ƒéƒ½æ‹¥æœ‰è‡ªå·±çš„é…ç½®ï¼Œè¿™ä½¿å¾—ç®€å•çš„å‡çº§å˜å¾—ååˆ†æ£˜æ‰‹ã€‚\nå¦ä¸€ç§å¤ç”¨æ–¹æ³•æ˜¯å°†æºä»£ç æŠ½è±¡ä¸ºå‚æ•°åŒ–æ¨¡æ¿ã€‚ä½¿ç”¨ä¸€ä¸ªé€šè¿‡æ‰§è¡Œè„šæœ¬æ¥æ›¿æ¢æ‰€éœ€å‚æ•°çš„æ¨¡æ¿å¤„ç†å·¥å…·ç”Ÿæˆé…ç½®ï¼Œé€šè¿‡ä¸ºåŒä¸€æ¨¡æ¿è®¾ç½®ä¸åŒçš„å€¼æ¥è¾¾åˆ°å¤ç”¨çš„ç›®çš„ã€‚è€Œè¿™ç§æ–¹å¼é¢ä¸´çš„é—®é¢˜æ˜¯æ¨¡æ¿å’Œå‚æ•°æ–‡ä»¶å¹¶ä¸åœ¨ kubernetes API èµ„æºçš„è§„èŒƒä¸­ï¼Œè¿™ç§æ–¹å¼å¿…å®šæ˜¯ä¸€ç§åŒ…è£…äº† kubernetes API çš„æ–°ä¸œè¥¿ã€æ–°è¯­è¨€ã€‚è™½ç„¶è¿™ç§æ–¹å¼å¾ˆå¼ºå¤§ï¼Œä½†æ˜¯ä¹Ÿå¸¦æ¥äº†å­¦ä¹ æˆæœ¬å’Œå®‰è£…å·¥å…·çš„æˆæœ¬ã€‚ä¸åŒçš„å›¢é˜Ÿéœ€è¦ä¸åŒçš„æ›´æ”¹ï¼Œå› æ­¤å‡ ä¹æ‰€æœ‰å¯ä»¥åŒ…å«åœ¨ YAML æ–‡ä»¶ä¸­çš„è§„èŒƒéƒ½ä¼šéœ€è¦æŠ½è±¡æˆå‚æ•°ã€‚\nè‡ªå®šä¹‰é…ç½®çš„æ–°é€‰æ‹© kustomize ä¸­å·¥å…·çš„å£°æ˜ä¸è§„èŒƒæ˜¯ç”±åä¸º kustomization.yaml çš„æ–‡ä»¶å®šä¹‰ã€‚\nkustomize å°†ä¼šè¯»å–å£°æ˜æ–‡ä»¶å’Œ Kubernetes API èµ„æºæ–‡ä»¶ï¼Œå°†å…¶ç»„åˆç„¶åå°†å®Œæ•´çš„èµ„æºè¿›è¡Œæ ‡å‡†åŒ–çš„è¾“å‡ºã€‚è¾“å‡ºçš„æ–‡æœ¬å¯ä»¥è¢«å…¶ä»–å·¥å…·è¿›ä¸€æ­¥å¤„ç†ï¼Œæˆ–è€…ç›´æ¥é€šè¿‡ kubectl åº”ç”¨äºé›†ç¾¤ã€‚\nä¾‹å¦‚ï¼Œå¦‚æœ kustomization.yaml æ–‡ä»¶åŒ…æ‹¬ï¼š\ncommonLabels: app: hello resources: - deployment.yaml - configMap.yaml - service.yaml  ç¡®ä¿è¿™ä¸‰ä¸ªæ–‡ä»¶ä¸ kustomization.yaml ä½äºåŒä¸€ç›®å½•ä¸‹ï¼Œç„¶åè¿è¡Œï¼š\nkustomize build  å°†åˆ›å»ºåŒ…å«ä¸‰ä¸ªèµ„æºçš„ YAML æµï¼Œå…¶ä¸­ app: hello ä¸ºæ¯ä¸ªèµ„æºå…±åŒçš„æ ‡ç­¾ã€‚\nåŒæ ·çš„ï¼Œä½ å¯ä»¥ä½¿ç”¨ commonAnnotations å­—æ®µç»™æ‰€æœ‰èµ„æºæ·»åŠ æ³¨é‡Šï¼Œ namePrefix å­—æ®µä¸ºæ‰€æœ‰çš„èµ„æºæ·»åŠ å…±åŒçš„å‰ç¼€åã€‚è¿™äº›çç¢è€Œæœ‰å¸¸è§çš„å®šåˆ¶åªæ˜¯ä¸€ä¸ªå¼€å§‹ã€‚\nä¸€ä¸ªæ›´å¸¸è§çš„ä¾‹å­æ˜¯ï¼Œä½ éœ€è¦ä¸ºä¸€ç»„ç›¸åŒèµ„æºè®¾ç½®ä¸åŒçš„å‚æ•°ã€‚ä¾‹å¦‚ï¼šå¼€å‘ã€æ¼”ç¤ºå’Œç”Ÿäº§çš„å‚æ•°ã€‚\nä¸ºæ­¤ï¼ŒKustomize å…è®¸ç”¨æˆ·ä»¥ä¸€ä¸ªåº”ç”¨æè¿°æ–‡ä»¶ ï¼ˆYAML æ–‡ä»¶ï¼‰ä¸ºåŸºç¡€ï¼ˆBase YAMLï¼‰ï¼Œç„¶åé€šè¿‡ Overlay çš„æ–¹å¼ç”Ÿæˆæœ€ç»ˆéƒ¨ç½²åº”ç”¨æ‰€éœ€çš„æè¿°æ–‡ä»¶ã€‚ä¸¤è€…éƒ½æ˜¯ç”± kustomization æ–‡ä»¶è¡¨ç¤ºã€‚åŸºç¡€ï¼ˆBaseï¼‰å£°æ˜äº†å…±äº«çš„å†…å®¹ï¼ˆèµ„æºå’Œå¸¸è§çš„èµ„æºé…ç½®ï¼‰ï¼ŒOverlay åˆ™å£°æ˜äº†å·®å¼‚ã€‚\nè¿™é‡Œæ˜¯ä¸€ä¸ªç›®å½•æ ‘ï¼Œç”¨äºç®¡ç†é›†ç¾¤åº”ç”¨ç¨‹åºçš„ æ¼”ç¤º å’Œ ç”Ÿäº§ é…ç½®å‚æ•°ï¼š\nsomeapp/ â”œâ”€â”€ base/ â”‚ â”œâ”€â”€ kustomization.yaml â”‚ â”œâ”€â”€ deployment.yaml â”‚ â”œâ”€â”€ configMap.yaml â”‚ â””â”€â”€ service.yaml â””â”€â”€ overlays/ â”œâ”€â”€ production/ â”‚ â””â”€â”€ kustomization.yaml â”‚ â”œâ”€â”€ replica_count.yaml â””â”€â”€ staging/ â”œâ”€â”€ kustomization.yaml â””â”€â”€ cpu_count.yaml  someapp/base/kustomization.yaml æ–‡ä»¶æŒ‡å®šäº†å…¬å…±èµ„æºå’Œå¸¸è§è‡ªå®šä¹‰é…ç½®ï¼ˆä¾‹å¦‚ï¼Œå®ƒä»¬ä¸€äº›ç›¸åŒçš„æ ‡ç­¾ï¼Œåç§°å‰ç¼€å’Œæ³¨é‡Šï¼‰ã€‚\nsomeapp/overlays/production/kustomization.yaml æ–‡ä»¶çš„å†…å®¹å¯èƒ½æ˜¯ï¼š\ncommonLabels: env: production bases: - ../../base patches: - replica_count.yaml  è¿™ä¸ª kustomization æŒ‡å®šäº†ä¸€ä¸ª patch æ–‡ä»¶ replica_count.yaml ï¼Œå…¶å†…å®¹å¯èƒ½æ˜¯ï¼š\napiVersion: apps/v1 kind: Deployment metadata: name: the-deployment spec: replicas: 100  patch æ˜¯éƒ¨åˆ†çš„èµ„æºå£°æ˜ï¼Œåœ¨è¿™ä¸ªä¾‹å­ä¸­æ˜¯ Deployment çš„è¡¥ä¸ someapp/base/deployment.yaml ï¼Œä»…ä¿®æ”¹äº†å‰¯æœ¬æ•°ç”¨ä»¥å¤„ç†ç”Ÿäº§æµé‡ã€‚\nè¯¥è¡¥ä¸ä¸ä»…ä»…æ˜¯ä¸€ä¸ªæ— ä¸Šä¸‹æ–‡ {parameter nameï¼Œvalue} å…ƒç»„ã€‚å…¶ä½œä¸ºéƒ¨åˆ† deployment specï¼Œå¯ä»¥é€šè¿‡éªŒè¯ï¼Œå³ä½¿ä¸å…¶ä½™é…ç½®éš”ç¦»è¯»å–ï¼Œä¹Ÿå…·æœ‰æ˜ç¡®çš„ä¸Šä¸‹æ–‡å’Œç”¨é€”ã€‚\nè¦ä¸ºç”Ÿäº§ç¯å¢ƒåˆ›å»ºèµ„æºï¼Œè¯·è¿è¡Œï¼š\nkustomize build someapp/overlays/production  è¿è¡Œç»“æœå°†ä½œä¸ºä¸€ç»„å®Œæ•´èµ„æºæ‰“å°åˆ°æ ‡å‡†è¾“å‡ºï¼Œå¹¶å‡†å¤‡åº”ç”¨äºé›†ç¾¤ã€‚å¯ä»¥ç”¨ç±»ä¼¼çš„å‘½ä»¤å®šä¹‰æ¼”ç¤ºç¯å¢ƒçš„é…ç½®ã€‚\nç»¼ä¸Šæ‰€è¿° ä½¿ç”¨ kustomize ï¼Œæ‚¨å¯ä»¥ä»…ä½¿ç”¨ Kubernetes API èµ„æºæ–‡ä»¶å°±å¯ä»¥ç®¡ç†ä»»æ„æ•°é‡çš„ Kubernetes å®šåˆ¶é…ç½®ã€‚kustomize çš„æ¯ä¸ªäº§ç‰©éƒ½æ˜¯çº¯ YAML çš„ï¼Œæ¯ä¸ªéƒ½å¯ä»¥è¿›è¡ŒéªŒè¯å’Œè¿è¡Œçš„ã€‚kustomize é¼“åŠ±é€šè¿‡ fork/modify/rebase è¿™æ ·çš„å·¥ä½œæµæ¥ç®¡ç†æµ·é‡çš„åº”ç”¨æè¿°æ–‡ä»¶ã€‚\nå°è¯•hello worldç¤ºä¾‹ï¼Œå¼€å§‹ä½¿ç”¨ kustomize å§ï¼æœ‰å…³çš„åé¦ˆä¸è®¨è®ºï¼Œå¯ä»¥é€šè¿‡åŠ å…¥é‚®ä»¶åˆ—è¡¨æˆ–æ issueï¼Œæ¬¢è¿æäº¤PRã€‚\nè¯‘è€…æŒ‰ éšç€ kubernetes 1.14 çš„å‘å¸ƒï¼Œkustomize è¢«é›†æˆåˆ° kubectl ä¸­ï¼Œç”¨æˆ·å¯ä»¥åˆ©ç”¨ kubectl apply -k dir/ å°†æŒ‡å®šç›®å½•çš„ kustomization.yaml æäº¤åˆ°é›†ç¾¤ä¸­ã€‚\nåŸæ–‡é“¾æ¥ https://kubernetes.io/blog/2018/05/29/introducing-kustomize-template-free-configuration-customization-for-kubernetes/\n","date":1555320201,"expirydate":-62135596800,"kind":"page","lang":"zh","lastmod":1555320201,"objectID":"cfb7bbfe49edd6e9e1ac2e746913d5ff","permalink":"https://guoxudong.io/post/introducing-kustomize-template-free-configuration-customization-for-kubernetes/","publishdate":"2019-04-15T17:23:21+08:00","relpermalink":"/post/introducing-kustomize-template-free-configuration-customization-for-kubernetes/","section":"post","summary":"æœ¬æ–‡ä»‹ç»äº† Kubernetes åŸç”Ÿçš„åº”ç”¨ç®¡ç†å·¥å…· Kustomizeã€‚","tags":["ç¿»è¯‘","kustomize","kubernetes","å·¥å…·"],"title":"Kustomize: æ— éœ€æ¨¡æ¿å®šåˆ¶ä½ çš„ kubernetes é…ç½®","type":"post"},{"authors":["éƒ­æ—­ä¸œ"],"categories":["kustomize"],"content":" åˆè¯† Kustomize ç¬¬ä¸€æ¬¡å¬è¯´ Kustomize å…¶å®æ˜¯åœ¨ kubernetes 1.14 å‘å¸ƒæ—¶å€™ï¼Œå®ƒè¢«é›†æˆåˆ° kubectl ä¸­ï¼Œæˆä¸ºäº†ä¸€ä¸ªå­å‘½ä»¤ï¼Œä½†ä¹Ÿåªæ˜¯æ‰«äº†ä¸€çœ¼ï¼Œå¹¶æ²¡æœ‰æ·±ç©¶ã€‚çœŸæ­£è®©æˆ‘æ³¨æ„åˆ°å®ƒï¼Œå¹¶ä¸»åŠ¨å¼€å§‹äº†è§£å…¶åŠŸèƒ½å’Œä½¿ç”¨æ–¹æ³•çš„ï¼Œæ˜¯å¼ ç£Šå¤§ç¥åœ¨äº‘æ –ç¤¾åŒºå‘è¡¨çš„ä¸€ç¯‡æ–‡ç« ã€Šä»Kubernetes 1.14 å‘å¸ƒï¼Œçœ‹æŠ€æœ¯ç¤¾åŒºæ¼”è¿›æ–¹å‘ã€‹ï¼Œä»–åœ¨æ–‡ä¸­æ˜¯è¿™ä¹ˆè¯´çš„ï¼š\n Kustomize å…è®¸ç”¨æˆ·ä»¥ä¸€ä¸ªåº”ç”¨æè¿°æ–‡ä»¶ ï¼ˆYAML æ–‡ä»¶ï¼‰ä¸ºåŸºç¡€ï¼ˆBase YAMLï¼‰ï¼Œç„¶åé€šè¿‡ Overlay çš„æ–¹å¼ç”Ÿæˆæœ€ç»ˆéƒ¨ç½²åº”ç”¨æ‰€éœ€çš„æè¿°æ–‡ä»¶ï¼Œè€Œä¸æ˜¯åƒ Helm é‚£æ ·åªæä¾›åº”ç”¨æè¿°æ–‡ä»¶æ¨¡æ¿ï¼Œç„¶åé€šè¿‡å­—ç¬¦æ›¿æ¢ï¼ˆTemplatingï¼‰çš„æ–¹å¼æ¥è¿›è¡Œå®šåˆ¶åŒ–ã€‚\n è¿™ä¸æ­£æˆ‘åœ¨è‹¦è‹¦å¯»æ‰¾çš„ä¸œè¥¿å˜›ï¼è‡ªä»å…¬å¸ç¡®å®šäº†åº”ç”¨å®¹å™¨åŒ–çš„æ–¹æ¡ˆï¼Œè‡³ä»Šå·²æœ‰åŠå¹´å¤šäº†ï¼Œè¿™æœŸé—´æˆ‘ä»¬çš„æœåŠ¡ä¸€ä¸ªæ¥ä¸€ä¸ªçš„å®ç°äº†å®¹å™¨åŒ–ï¼Œéƒ¨ç½²åˆ°äº† kubernetes é›†ç¾¤ä¸­ã€‚kubernetes é›†ç¾¤ä¹Ÿæœ‰åŸå…ˆäº†1ä¸ªæµ‹è¯•é›†ç¾¤ï¼Œå‡ ä¸ªèŠ‚ç‚¹ï¼Œå‘å±•åˆ°äº†å¦‚ä»Šçš„å¤šä¸ªé›†ç¾¤ï¼Œå‡ åä¸ªèŠ‚ç‚¹ã€‚è€Œåœ¨æ¨è¿›å®¹å™¨åŒ–çš„è¿‡ç¨‹ä¸­ï¼Œæ¯ä¸ªæœåŠ¡éƒ½å¯¹å¯¹åº”å¤šä¸ªåº”ç”¨æè¿°æ–‡ä»¶ï¼ˆ YAML æ–‡ä»¶ï¼‰ï¼Œè€Œæ ¹æ®ç¯å¢ƒçš„ä¸åŒï¼Œåˆé…ç½®äº†å¤šå¥—çš„åº”ç”¨æè¿°æ–‡ä»¶ã€‚éšç€æœåŠ¡è¶Šéƒ¨è¶Šå¤šï¼Œåº”ç”¨æè¿°æ–‡ä»¶æ›´æ˜¯å‘ˆçˆ†ç‚¸å¼çš„å¢é•¿ã€‚\næ„Ÿè°¢ devops æ–‡åŒ–ï¼Œå®ƒæ˜¯æˆ‘ä¸éœ€è¦ä¸ºæ¯ä¸ªåº”ç”¨å»å†™ YAML æ–‡ä»¶ï¼Œå„ä¸ªåº”ç”¨çš„å¼€å‘ç»„æ‰¿æ‹…äº†è¿™ä¸€å·¥ä½œï¼Œæˆ‘åªéœ€è¦ä¸ºä»–ä»¬æä¾›åŸºç¡€æ¨¡æ¿å³å¯ã€‚ä½†åº”ç”¨ä¸Šçº¿åå‡ºç°çš„ OOM ã€æœåŠ¡æ— æ³•æ‹‰èµ·ç­‰ YAML æ–‡ä»¶é…ç½®æœ‰è¯¯å¯¼è‡´çš„é—®é¢˜æ¥è¸µè€Œè‡³ï¼Œä½¿å¾—æˆ‘å¿…é¡»è¦æ·±å…¥å„ä¸ªæœåŠ¡ï¼Œä¸ºä»–ä»¬é…ç½®ç¬¦åˆä»–ä»¬é…ç½®ã€‚è™½ç„¶ä¹Ÿä½¿ç”¨äº† helm ï¼Œä½†æ˜¯å…¶åªæä¾›åº”ç”¨æè¿°æ–‡ä»¶æ¨¡æ¿ï¼Œåœ¨ä¸åŒç¯å¢ƒæ‹‰èµ·ä¸€æ•´å¥—æœåŠ¡ä¼šèŠ‚çœå¾ˆå¤šæ—¶é—´ï¼Œè€Œåƒæˆ‘ä»¬è¿™ç§åœ¨æŒ‡å®šç¯å¢ƒå¿«é€Ÿè¿­ä»£çš„æœåŠ¡ï¼Œå¹¶ä¸ä¼šå‡å°‘å¾ˆå¤šæ—¶é—´ã€‚é’ˆå¯¹è¿™ç§æƒ…å†µï¼Œæˆ‘å·²ç»è®¡åˆ’è¦è‡ªå·±å¼€å‘ä¸€å¥—æ›´ç¬¦åˆæˆ‘ä»¬å·¥ä½œè¿™ç§åœºæ™¯çš„åº”ç”¨ç®¡ç†æœåŠ¡ï¼Œé›†æˆåœ¨æˆ‘ä»¬è‡ªå·±çš„ devops å¹³å°ä¸­ã€‚\nè¿™æ—¶ Kustomize å‡ºç°äº†ï¼Œæˆ‘æ˜é”çš„æ„Ÿè§‰åˆ° Kustomize å¯èƒ½å°±æ˜¯è§£å†³æˆ‘ç°é˜¶æ®µé—®é¢˜çš„ä¸€å‰‚è‰¯è¯ã€‚\nä»€ä¹ˆæ˜¯ Kustomize ï¼Ÿ  Kubernetes native configuration management Kustomize introduces a template-free way to customize application configuration that simplifies the use of off-the-shelf applications. Now, built into kubectl as apply -k.\nkustomize å…è®¸ç”¨æˆ·ä»¥ä¸€ä¸ªåº”ç”¨æè¿°æ–‡ä»¶ ï¼ˆYAML æ–‡ä»¶ï¼‰ä¸ºåŸºç¡€ï¼ˆBase YAMLï¼‰ï¼Œç„¶åé€šè¿‡ Overlay çš„æ–¹å¼ç”Ÿæˆæœ€ç»ˆéƒ¨ç½²åº”ç”¨æ‰€éœ€çš„æè¿°æ–‡ä»¶ã€‚è€Œå…¶ä»–ç”¨æˆ·å¯ä»¥å®Œå…¨ä¸å—å½±å“çš„ä½¿ç”¨ä»»ä½•ä¸€ä¸ª Base YAML æˆ–è€…ä»»ä½•ä¸€å±‚ç”Ÿæˆå‡ºæ¥çš„ YAML ã€‚è¿™ä½¿å¾—æ¯ä¸€ä¸ªç”¨æˆ·éƒ½å¯ä»¥é€šè¿‡ç±»ä¼¼fork/modify/rebase è¿™æ · Git é£æ ¼çš„æµç¨‹æ¥ç®¡ç†æµ·é‡çš„åº”ç”¨æè¿°æ–‡ä»¶ã€‚è¿™ç§ PATCH çš„æ€æƒ³è·Ÿ Docker é•œåƒæ˜¯éå¸¸ç›¸ä¼¼çš„ï¼Œå®ƒå¯ä»¥è§„é¿â€œå­—ç¬¦æ›¿æ¢â€å¯¹åº”ç”¨æè¿°æ–‡ä»¶çš„å…¥ä¾µï¼Œä¹Ÿä¸éœ€è¦ç”¨æˆ·å­¦ä¹ é¢å¤–çš„ DSL è¯­æ³•ï¼ˆæ¯”å¦‚ Luaï¼‰ã€‚\n è€Œå…¶æˆä¸º kubectl å­å‘½ä»¤åˆ™ä»£è¡¨è¿™ kubectl æœ¬èº«çš„æ’ä»¶æœºåˆ¶çš„æˆç†Ÿï¼Œæœªæ¥å¯èƒ½æœ‰æ›´å¤šçš„å·¥å…·å‘½ä»¤é›†æˆåˆ° kubectl ä¸­ã€‚æ‹¿å¼ ç£Šå¤§ç¥çš„è¿™å¼ å›¾ä¸éš¾çœ‹å‡ºï¼Œåœ¨ kubernetes åŸç”Ÿåº”ç”¨ç®¡ç†ç³»ç»Ÿä¸­ï¼Œåº”ç”¨æè¿°æ–‡ä»¶åœ¨æ•´ä¸ªåº”ç”¨ç®¡ç†ä½“ç³»ä¸­å æ®æ ¸å¿ƒä½ç½®ï¼Œé€šè¿‡åº”ç”¨æè¿°æ–‡ä»¶å¯ä»¥ç»„åˆå’Œç¼–æ’å¤šç§ kubernetes API èµ„æºï¼Œkubernetes é€šè¿‡æ§åˆ¶å™¨æ¥ä¿è¯é›†ç¾¤ä¸­çš„èµ„æºä¸åº”ç”¨çŠ¶æ€ä¸æè¿°æ–‡ä»¶å®Œå…¨ä¸€è‡´ã€‚\nKustomize ä¸åƒ Helm é‚£æ ·éœ€è¦ä¸€æ•´å¥—ç‹¬ç«‹çš„ä½“ç³»æ¥å®Œæˆç®¡ç†åº”ç”¨ï¼Œè€Œæ˜¯å®Œå…¨é‡‡ç”¨ kubernetes çš„è®¾è®¡ç†å¿µæ¥å®Œæˆç®¡ç†åº”ç”¨çš„ç›®çš„ã€‚åŒæ—¶ä½¿ç”¨èµ·æ¥ä¹Ÿæ›´åŠ çš„å¾—å¿ƒåº”æ‰‹ã€‚\nå‚è€ƒ  Kustomize - kustomize.io\n ä»Kubernetes 1.14 å‘å¸ƒï¼Œçœ‹æŠ€æœ¯ç¤¾åŒºæ¼”è¿›æ–¹å‘ - yq.aliyun.com\n  ","date":1555306379,"expirydate":-62135596800,"kind":"page","lang":"zh","lastmod":1555306379,"objectID":"78fd9fb10ddd154bd4ad042fc0a6867a","permalink":"https://guoxudong.io/post/kustomize-1/","publishdate":"2019-04-15T13:32:59+08:00","relpermalink":"/post/kustomize-1/","section":"post","summary":"æœ¬ç¯‡ä¸ºç³»åˆ—æ–‡ç« ç¬¬ä¸€ç¯‡ï¼Œä»‹ç»æˆ‘å¯¹ Kustomize çš„äº†è§£è¿‡ç¨‹ä»¥åŠ Kustomize æ˜¯ä»€ä¹ˆï¼Œä¸ºä»€ä¹ˆå®ƒèƒ½è§£å†³æˆ‘çš„ç‡ƒçœ‰ä¹‹æ€¥ã€‚","tags":["kubernetes","kustomize","å·¥å…·"],"title":"ä½¿ç”¨ Kustomize å¸®ä½ ç®¡ç† kubernetes åº”ç”¨ï¼ˆä¸€ï¼‰ï¼šä»€ä¹ˆæ˜¯ Kustomize ï¼Ÿ","type":"post"},{"authors":["éƒ­æ—­ä¸œ"],"categories":["æœåŠ¡ç½‘æ ¼"],"content":" æ‰€è°“è¾¹è½¦æ¨¡å¼ï¼ˆ Sidecar pattern ï¼‰ï¼Œä¹Ÿè¯‘ä½œæŒæ–—æ¨¡å¼ï¼Œæ˜¯åˆ†å¸ƒå¼æ¶æ„ä¸­äº‘è®¾è®¡æ¨¡å¼çš„ä¸€ç§ã€‚å› ä¸ºå…¶éå¸¸ç±»ä¼¼äºç”Ÿæ´»ä¸­çš„è¾¹ä¸‰è½®æ‘©æ‰˜è½¦è€Œå¾—åã€‚è¯¥è®¾è®¡æ¨¡å¼é€šè¿‡ç»™åº”ç”¨ç¨‹åºåŠ ä¸Šä¸€ä¸ªâ€œè¾¹è½¦â€çš„æ–¹å¼æ¥æ‹“å±•åº”ç”¨ç¨‹åºç°æœ‰çš„åŠŸèƒ½ã€‚è¿™ç§è®¾è®¡æ¨¡å¼å‡ºç°çš„å¾ˆæ—©ï¼Œå®ç°çš„æ–¹å¼ä¹Ÿå¤šç§å¤šæ ·ã€‚ç°åœ¨è¿™ä¸ªæ¨¡å¼æ›´æ˜¯éšç€å¾®æœåŠ¡çš„ç«çƒ­ä¸ Service Mesh çš„é€æ¸æˆç†Ÿè€Œè¿›å…¥äººä»¬çš„è§†é‡ã€‚\nä»€ä¹ˆæ˜¯è¾¹è½¦æ¨¡å¼ åœ¨ Azure Architecture Center çš„äº‘è®¾è®¡æ¨¡å¼ä¸­æ˜¯è¿™ä¹ˆä»‹ç»è¾¹è½¦æ¨¡å¼çš„ï¼š\n Deploy components of an application into a separate process or container to provide isolation and encapsulation.\n\u0026mdash; Sidecar pattern\n è¿™é‡Œè¦æ³¨æ„çš„æ˜¯ï¼š è¿™é‡Œçš„ Sidecar æ˜¯åˆ†å¸ƒå¼æ¶æ„ä¸­äº‘è®¾è®¡æ¨¡å¼çš„ä¸€ç§ï¼Œä¸æˆ‘ä»¬ç›®å‰åœ¨ä½¿ç”¨çš„ Istio æˆ– Linkerd ä¸­çš„ Sidecar æ˜¯è®¾è®¡ä¸å®ç°çš„åŒºåˆ«ï¼Œåæ–‡ä¸­æåˆ°çš„è¾¹è½¦æ¨¡å¼å‡æ˜¯æŒ‡è¿™ç§è®¾è®¡æ¨¡å¼ï¼Œè¯·å‹¿ä¸ Istio æˆ– å…¶ä»– Service Mesh è½¯ä»¶ ä¸­çš„ Sidecar æ··æ·†ã€‚\nè¾¹è½¦æ¨¡å¼æ˜¯ä¸€ç§åˆ†å¸ƒå¼æ¶æ„çš„è®¾è®¡æ¨¡å¼ã€‚å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œè¾¹è½¦å°±æ˜¯åŠ è£…åœ¨æ‘©æ‰˜è½¦æ—æ¥è¾¾åˆ°æ‹“å±•åŠŸèƒ½çš„ç›®çš„ï¼Œæ¯”å¦‚è¡Œé©¶æ›´åŠ ç¨³å®šï¼Œå¯ä»¥æ‹‰æ›´å¤šçš„äººå’Œè´§ç‰©ï¼Œååœ¨è¾¹è½¦ä¸Šçš„äººå¯ä»¥ç»™é©¾é©¶å‘˜æŒ‡è·¯ç­‰ã€‚è¾¹è½¦æ¨¡å¼é€šè¿‡ç»™åº”ç”¨æœåŠ¡åŠ è£…ä¸€ä¸ªâ€œè¾¹è½¦â€æ¥è¾¾åˆ°æ§åˆ¶å’Œé€»è¾‘çš„åˆ†ç¦»çš„ç›®çš„ã€‚\næ¯”å¦‚æ—¥å¿—è®°å½•ã€ç›‘æ§ã€æµé‡æ§åˆ¶ã€æœåŠ¡æ³¨å†Œã€æœåŠ¡å‘ç°ã€æœåŠ¡é™æµã€æœåŠ¡ç†”æ–­ç­‰åœ¨ä¸šåŠ¡æœåŠ¡ä¸­ä¸éœ€è¦å®ç°çš„æ§åˆ¶é¢åŠŸèƒ½ï¼Œå¯ä»¥äº¤ç»™â€œè¾¹è½¦â€ï¼Œä¸šåŠ¡æœåŠ¡åªéœ€è¦ä¸“æ³¨å®ç°ä¸šåŠ¡é€»è¾‘å³å¯ã€‚å¦‚ä¸Šå›¾é‚£æ ·ï¼Œåº”ç”¨æœåŠ¡ä½ åªç®¡å¼€å¥½ä½ çš„è½¦ï¼Œæ‰“ä»—çš„äº‹æƒ…å°±äº¤ç»™è¾¹è½¦ä¸Šçš„ä»£ç†å°±å¥½ã€‚è¿™ä¸åˆ†å¸ƒå¼å’Œå¾®æœåŠ¡æ¶æ„å®Œç¾å¥‘åˆï¼ŒçœŸæ­£çš„å®ç°äº†æ§åˆ¶å’Œé€»è¾‘çš„åˆ†ç¦»ä¸è§£è€¦ã€‚\nè¾¹è½¦æ¨¡å¼è®¾è®¡ åœ¨è®¾è®¡ä¸Šè¾¹è½¦æ¨¡å¼ä¸ç½‘å…³æ¨¡å¼æœ‰ç±»ä¼¼ä¹‹å¤„ï¼Œä½†æ˜¯å…¶ç²’åº¦æ›´ç»†ã€‚å…¶ä¸ºæ¯ä¸ªæœåŠ¡éƒ½é…å¤‡ä¸€ä¸ªâ€œè¾¹è½¦â€ï¼Œè¿™ä¸ªâ€œè¾¹è½¦â€œå¯ä»¥ç†è§£ä¸ºä¸€ä¸ª agent ï¼Œè¿™ä¸ªæœåŠ¡æ‰€æœ‰çš„é€šä¿¡éƒ½æ˜¯é€šè¿‡è¿™ä¸ª agent æ¥å®Œæˆçš„ï¼Œè¿™ä¸ª agent åŒæœåŠ¡ä¸€èµ·åˆ›å»ºï¼Œä¸€èµ·é”€æ¯ã€‚åƒæœåŠ¡æ³¨å†Œã€æœåŠ¡å‘ç°ã€ç›‘æ§ã€æµé‡æ§åˆ¶ã€æ—¥å¿—è®°å½•ã€æœåŠ¡é™æµå’ŒæœåŠ¡æœåŠ¡ç†”æ–­ç­‰åŠŸèƒ½å®Œå…¨å¯ä»¥åšæˆæ ‡å‡†åŒ–çš„ç»„ä»¶å’Œæ¨¡å—ï¼Œä¸éœ€è¦åœ¨å•ç‹¬å®ç°å…¶åŠŸèƒ½æ¥æ¶ˆè€—ä¸šåŠ¡å¼€å‘çš„ç²¾åŠ›å’Œæ—¶é—´æ¥å¼€å‘å’Œè°ƒè¯•è¿™äº›åŠŸèƒ½ï¼Œè¿™æ ·å¯ä»¥å¼€å‘å‡ºçœŸæ­£é«˜å†…èšä½è€¦åˆçš„è½¯ä»¶ã€‚\nè¿™é‡Œæœ‰ä¸¤ç§æ–¹æ³•æ¥å®ç°è¾¹è½¦æ¨¡å¼ï¼š\n é€šè¿‡ SDK ã€ Lib ç­‰è½¯ä»¶åŒ…çš„å½¢å¼ï¼Œåœ¨å¼€å‘æ—¶å¼•å…¥è¯¥è½¯ä»¶åŒ…ä¾èµ–ï¼Œä½¿å…¶ä¸ä¸šåŠ¡æœåŠ¡é›†æˆèµ·æ¥ã€‚\nè¿™ç§æ–¹æ³•å¯ä»¥ä¸åº”ç”¨å¯†åˆ‡é›†æˆï¼Œæé«˜èµ„æºåˆ©ç”¨ç‡å¹¶ä¸”æé«˜åº”ç”¨æ€§èƒ½ã€‚ä½†æ˜¯è¿™ç§æ–¹æ³•æ˜¯å¯¹ä»£ç æœ‰ä¾µå…¥çš„ï¼Œå—åˆ°ç¼–ç¨‹è¯­è¨€å’Œè½¯ä»¶å¼€å‘äººå‘˜æ°´å¹³çš„é™åˆ¶ï¼Œä½†å½“è¯¥ä¾èµ–æœ‰ bug æˆ–è€…éœ€è¦å‡çº§æ—¶ï¼Œä¸šåŠ¡ä»£ç éœ€è¦é‡æ–°ç¼–è¯‘å’Œå‘å¸ƒã€‚åŒæ—¶ï¼Œå¦‚æœè¯¥ä¾èµ–å®£å¸ƒåœæ­¢ç»´æŠ¤æˆ–è€…é—­æºï¼Œé‚£ä¹ˆä¼šç»™è¯¥æœåŠ¡å¸¦æ¥ä¸å°çš„å½±å“ã€‚\n ä»¥ Sidecar çš„å½¢å¼ï¼Œåœ¨è¿ç»´çš„æ—¶å€™ä¸åº”ç”¨æœåŠ¡é›†æˆåœ¨ä¸€èµ·ã€‚\nè¿™ç§æ–¹å¼å¯¹åº”ç”¨æœåŠ¡æ²¡æœ‰ä¾µå…¥æ€§ï¼Œä¸å—ç¼–ç¨‹è¯­è¨€å’Œå¼€å‘äººå‘˜æ°´å¹³çš„é™åˆ¶ï¼Œåšåˆ°äº†æ§åˆ¶ä¸é€»è¾‘åˆ†å¼€éƒ¨ç½²ã€‚ä½†æ˜¯ä¼šå¢åŠ åº”ç”¨å»¶è¿Ÿï¼Œå¹¶ä¸”ç®¡ç†å’Œéƒ¨ç½²çš„å¤æ‚åº¦ä¼šå¢åŠ ã€‚\n  è¾¹è½¦æ¨¡å¼è§£å†³äº†ä»€ä¹ˆé—®é¢˜ è¾¹è½¦æ¨¡å¼åœ¨æ¦‚å¿µä¸Šæ˜¯æ¯”è¾ƒç®€å•çš„ï¼Œä½†æ˜¯åœ¨å®è·µä¸­è¿˜æ˜¯è¦äº†è§£è¾¹è½¦æ¨¡å¼åˆ°åº•è§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Œæˆ‘ä»¬ä¸ºä»€ä¹ˆè¦ä½¿ç”¨è¾¹è½¦æ¨¡å¼ï¼Ÿ\n æ§åˆ¶ä¸é€»è¾‘åˆ†ç¦»çš„é—®é¢˜\nè¾¹è½¦æ¨¡å¼æ˜¯åŸºäºå°†æ§åˆ¶ä¸é€»è¾‘åˆ†ç¦»å’Œè§£è€¦çš„æ€æƒ³ï¼Œé€šä¿—çš„è®²å°±æ˜¯è®©ä¸“ä¸šçš„äººåšä¸“ä¸šçš„äº‹ï¼Œä¸šåŠ¡ä»£ç åªéœ€è¦å…³å¿ƒå…¶å¤æ‚çš„ä¸šåŠ¡é€»è¾‘ï¼Œå…¶ä»–çš„äº‹æƒ…â€è¾¹è½¦â€œä¼šå¸®å…¶å¤„ç†ï¼Œä»è¿™ä¸ªè§’åº¦çœ‹ï¼Œå¯èƒ½å«è·Ÿç­æˆ–è€…ç§˜ä¹¦æ¨¡å¼ä¹Ÿä¸é”™ :)\næ—¥å¿—è®°å½•ã€ç›‘æ§ã€æµé‡æ§åˆ¶ã€æœåŠ¡æ³¨å†Œã€æœåŠ¡å‘ç°ã€æœåŠ¡é™æµã€æœåŠ¡ç†”æ–­ã€é‰´æƒã€è®¿é—®æ§åˆ¶å’ŒæœåŠ¡è°ƒç”¨å¯è§†åŒ–ç­‰ï¼Œè¿™äº›åŠŸèƒ½ä»æœ¬è´¨ä¸Šå’Œä¸šåŠ¡æœåŠ¡çš„å…³ç³»å¹¶ä¸å¤§ï¼Œè€Œä¼ ç»Ÿçš„è½¯ä»¶å·¥ç¨‹åœ¨å¼€å‘å±‚é¢å®Œæˆè¿™äº›åŠŸèƒ½ï¼Œè¿™å¯¼è‡´äº†å„ç§å„æ ·ç»´æŠ¤ä¸Šçš„é—®é¢˜ã€‚\nå°±å¥½åƒä¸€ä¸ªå¨å¸ˆä¸æ˜¯å¿…é¡»å»å…³å¿ƒé£Ÿæçš„äº§åœ°ã€é¥­åº—çš„é€‰å€ã€æ˜¯ç»™å¤§å…çš„å®¢äººä¸Šèœè¿˜æ˜¯ç»™åŒ…æˆ¿çš„å®¢äººä¸Šèœ\u0026hellip;ä»–åªéœ€è¦åšå¥½èœå°±å¥½ï¼Œè™½ç„¶ä¸Šé¢çš„è¿™äº›äº‹ä»–éƒ½å¯ä»¥åšã€‚è€Œä¼ ç»Ÿçš„è½¯ä»¶å·¥ç¨‹å°±åƒæ˜¯ä¸€ä¸ªå°é¥­åº—çš„å¨å¸ˆï¼Œä»–å³æ˜¯è€æ¿åˆæ˜¯å¨å¸ˆï¼Œæ—¢éœ€è¦ä¹°èœåˆéœ€è¦ç‚’èœï¼Œæ‰€æœ‰çš„äº‹æƒ…éƒ½è¦ä»–ä¸€ä¸ªäººåšï¼Œå¦‚æœå®¢äººä¸€å¤šï¼Œå°±ä¼šå˜çš„æ‰‹å¿™è„šä¹±ï¼›è€Œæ§åˆ¶ä¸é€»è¾‘åˆ†ç¦»çš„è½¯ä»¶ï¼Œå…¶é€»è¾‘éƒ¨åˆ†å°±åƒæ˜¯é«˜æ¡£é…’åº—çš„å¨å¸ˆï¼Œä»–åªéœ€è¦å°†èœåšå¥½å³å¯ï¼Œå…¶ä»–çš„äº‹æƒ…ç”±åƒâ€è¾¹è½¦â€œè¿™æ ·çš„æˆå‘˜å¸®å…¶å¤„ç†ã€‚\n è§£å†³æœåŠ¡ä¹‹é—´è°ƒç”¨è¶Šæ¥è¶Šå¤æ‚çš„é—®é¢˜\néšç€åˆ†å¸ƒå¼æ¶æ„è¶Šæ¥è¶Šå¤æ‚å’Œå¾®æœåŠ¡è¶Šæ‹†è¶Šç»†ï¼Œæˆ‘ä»¬è¶Šæ¥è¶Šè¿«åˆ‡çš„å¸Œæœ›æœ‰ä¸€ä¸ªç»Ÿä¸€çš„æ§åˆ¶é¢æ¥ç®¡ç†æˆ‘ä»¬çš„å¾®æœåŠ¡ï¼Œæ¥å¸®åŠ©æˆ‘ä»¬ç»´æŠ¤å’Œç®¡ç†æ‰€æœ‰å¾®æœåŠ¡ï¼Œè¿™æ—¶ä¼ ç»Ÿå¼€å‘å±‚é¢ä¸Šçš„æ§åˆ¶å°±è¿œè¿œä¸å¤Ÿäº†ã€‚è€Œè¾¹è½¦æ¨¡å¼å¯ä»¥å¾ˆå¥½çš„è§£å†³è¿™ä¸ªé—®é¢˜ã€‚\n  ä»è¾¹è½¦æ¨¡å¼åˆ° Service Mesh è¾¹è½¦æ¨¡å¼æœ‰æ•ˆçš„åˆ†ç¦»äº†ç³»ç»Ÿæ§åˆ¶å’Œä¸šåŠ¡é€»è¾‘ï¼Œå¯ä»¥å°†æ‰€æœ‰çš„æœåŠ¡è¿›è¡Œç»Ÿä¸€ç®¡ç†ï¼Œè®©å¼€å‘äººå‘˜æ›´ä¸“æ³¨äºä¸šåŠ¡å¼€å‘ï¼Œæ˜¾è‘—çš„æå‡å¼€å‘æ•ˆç‡ã€‚è€Œéµå¾ªè¿™ç§æ¨¡å¼è¿›è¡Œå®è·µä»å¾ˆæ—©ä»¥å‰å°±å¼€å§‹äº†ï¼Œå¼€å‘äººå‘˜ä¸€ç›´è¯•å›¾å°†ä¸Šæ–‡ä¸­æˆ‘ä»¬æåˆ°çš„åŠŸèƒ½ï¼ˆå¦‚ï¼šæµé‡æ§åˆ¶ã€æœåŠ¡æ³¨å†Œã€æœåŠ¡å‘ç°ã€æœåŠ¡é™æµã€æœåŠ¡ç†”æ–­ç­‰ï¼‰æå–æˆä¸€ä¸ªæ ‡å‡†åŒ–çš„ Sidecar ï¼Œé€šè¿‡ Sidecar ä»£ç†æ¥ä¸å…¶ä»–ç³»ç»Ÿè¿›è¡Œäº¤äº’ï¼Œè¿™æ ·å¯ä»¥å¤§å¤§ç®€åŒ–ä¸šåŠ¡å¼€å‘å’Œè¿ç»´ã€‚è€Œéšç€åˆ†å¸ƒå¼æ¶æ„å’Œå¾®æœåŠ¡è¢«è¶Šæ¥è¶Šå¤šçš„å…¬å¸å’Œå¼€å‘è€…æ¥å—å¹¶ä½¿ç”¨ï¼Œè¿™ä¸€éœ€æ±‚æ—¥ç›Šå‡¸æ˜¾ã€‚\nè¿™å°±æ˜¯ Service Mesh æœåŠ¡ç½‘æ ¼è¯ç”Ÿçš„å¥‘æœºï¼Œå®ƒæ˜¯ CNCFï¼ˆCloud Native Computing Foundationï¼Œäº‘åŸç”ŸåŸºé‡‘ä¼šï¼‰ç›®å‰ä¸»æ¨çš„æ–°ä¸€ä»£å¾®æœåŠ¡æ¶æ„ã€‚ William Morgan åœ¨ What\u0026rsquo;s a service mesh? And why do I need one? ã€è¯‘æ–‡ã€‘ä¸­è§£é‡Šäº†ä»€ä¹ˆæ˜¯ Service Mesh ã€‚\nService MeshÂ æœ‰å¦‚ä¸‹å‡ ä¸ªç‰¹ç‚¹ï¼š\n åº”ç”¨ç¨‹åºé—´é€šè®¯çš„ä¸­é—´å±‚ è½»é‡çº§ç½‘ç»œä»£ç† åº”ç”¨ç¨‹åºæ— æ„ŸçŸ¥ è§£è€¦åº”ç”¨ç¨‹åºçš„é‡è¯•/è¶…æ—¶ã€ç›‘æ§ã€è¿½è¸ªå’ŒæœåŠ¡å‘ç°  Service Mesh å°†åº•å±‚é‚£äº›éš¾ä»¥æ§åˆ¶çš„ç½‘ç»œé€šè®¯ç»Ÿä¸€ç®¡ç†ï¼Œè¯¸å¦‚ï¼šæµé‡ç®¡æ§ï¼Œä¸¢åŒ…é‡è¯•ï¼Œè®¿é—®æ§åˆ¶ç­‰ã€‚è€Œä¸Šå±‚çš„åº”ç”¨å±‚åè®®åªéœ€å…³å¿ƒä¸šåŠ¡é€»è¾‘å³å¯ã€‚Service Mesh æ˜¯ä¸€ä¸ªç”¨äºå¤„ç†æœåŠ¡é—´é€šä¿¡çš„åŸºç¡€è®¾æ–½å±‚ï¼Œå®ƒè´Ÿè´£ä¸ºæ„å»ºå¤æ‚çš„äº‘åŸç”Ÿåº”ç”¨ä¼ é€’å¯é çš„ç½‘ç»œè¯·æ±‚ã€‚\nä½ çœŸçš„éœ€è¦ Service Mesh å—ï¼Ÿ æ­£å¦‚ NGINX åœ¨å…¶åšå®¢ä¸Šå‘è¡¨çš„ä¸€ç¯‡æ–‡ç« åå« Do I Need a Service Mesh?  ã€è¯‘æ–‡ã€‘ çš„æ–‡ç« ä¸­æåˆ°ï¼š\n As the complexity of the application increases, service mesh becomes a realistic alternative to implementing capabilities service-by-service.\néšç€åº”ç”¨ç¨‹åºå¤æ‚æ€§çš„å¢åŠ ï¼ŒæœåŠ¡ç½‘æ ¼å°†æˆä¸ºå®ç°æœåŠ¡åˆ°æœåŠ¡çš„èƒ½åŠ›çš„ç°å®é€‰æ‹©ã€‚\n éšç€æˆ‘ä»¬çš„å¾®æœåŠ¡è¶Šæ¥è¶Šç»†åˆ†ï¼Œæˆ‘ä»¬æ‰€è¦ç®¡ç†çš„æœåŠ¡æ­£åœ¨æˆå€çš„å¢é•¿ç€ï¼ŒKubernetes æä¾›äº†ä¸°å¯Œçš„åŠŸèƒ½ï¼Œä½¿å¾—æˆ‘ä»¬å¯ä»¥å¿«é€Ÿçš„éƒ¨ç½²å’Œè°ƒåº¦è¿™äº›æœåŠ¡ï¼ŒåŒæ—¶ä¹Ÿæä¾›äº†æˆ‘ä»¬ç†Ÿæ‚‰çš„æ–¹å¼æ¥å®ç°é‚£äº›å¤æ‚çš„åŠŸèƒ½ï¼Œä½†æ˜¯å½“ä¸´ç•Œç‚¹åˆ°æ¥æ—¶ï¼Œå¯èƒ½å°±æ˜¯æˆ‘ä»¬çœŸæ­£è¦å»è€ƒè™‘ä½¿ç”¨ Service Mesh çš„æ—¶å€™äº†ã€‚\nå‚è€ƒ  Sidecar pattern ï¼š https://docs.microsoft.com/en-us/azure/architecture/patterns/sidecar\n What\u0026rsquo;s a service mesh? And why do I need one?ï¼š https://buoyant.io/2017/04/25/whats-a-service-mesh-and-why-do-i-need-one/\n Do I Need a Service Mesh?ï¼šhttps://www.nginx.com/blog/do-i-need-a-service-mesh/\n  ","date":1554876205,"expirydate":-62135596800,"kind":"page","lang":"zh","lastmod":1554876205,"objectID":"488197fd3c04b7422c3fe16c678cc7cc","permalink":"https://guoxudong.io/post/sidercar-to-servicemesh/","publishdate":"2019-04-10T14:03:25+08:00","relpermalink":"/post/sidercar-to-servicemesh/","section":"post","summary":"è°ˆè°ˆä»è¾¹è½¦æ¨¡å¼è¿™ä¸€åˆ†å¸ƒå¼æ¶æ„çš„è®¾è®¡æ¨¡å¼åˆ° Service Mesh çš„æ¼”å˜ã€‚","tags":["Service Mesh"],"title":"ä»è¾¹è½¦æ¨¡å¼åˆ° Service Mesh","type":"post"},{"authors":["éƒ­æ—­ä¸œ"],"categories":["ç¿»è¯‘"],"content":" DevOps æ˜¯ä»€ä¹ˆï¼Ÿ â€œDevOpsâ€ è¿™ä¸ªè¯æ˜¯ development å’Œ operations è¿™ä¸¤ä¸ªè¯çš„ç»„åˆã€‚å®ƒæ˜¯ä¸€ç§ä¿ƒè¿›å¼€å‘å’Œè¿ç»´å›¢é˜Ÿä¹‹é—´çš„åä½œï¼Œä»¥è‡ªåŠ¨åŒ–å’Œå¯é‡å¤çš„æ–¹å¼æ›´å¿«åœ°å°†ä»£ç éƒ¨ç½²åˆ°ç”Ÿäº§ä¸­çš„æ–‡åŒ–ã€‚\nDevOps å¸®åŠ©å›¢ä½“æé«˜è½¯ä»¶å’ŒæœåŠ¡çš„äº¤ä»˜é€Ÿåº¦ã€‚å®ƒä½¿å›¢é˜Ÿèƒ½å¤Ÿæ›´å¥½åœ°ä¸ºå®¢æˆ·æœåŠ¡ï¼Œå¹¶æé«˜åœ¨å¸‚åœºä¸­çš„ç«äº‰åŠ›ã€‚\nç®€è€Œè¨€ä¹‹ï¼Œ DevOps å¯ä»¥å®šä¹‰ä¸ºé€šè¿‡æ›´å¥½çš„æ²Ÿé€šå’Œåä½œï¼Œä½¿å¼€å‘å’Œè¿ç»´ä¿æŒä¸€è‡´ã€‚\næœ¬æ‰‹å†Œä¸­ï¼Œæ‚¨å°†å­¦åˆ°ï¼š\n DevOps æ˜¯ä»€ä¹ˆï¼Ÿ ä¸ºä»€ä¹ˆéœ€è¦ DevOps ï¼Ÿ DevOps ä¸ä¼ ç»Ÿè¿ç»´æœ‰ä»€ä¹ˆä¸åŒï¼Ÿ ä¸ºä»€ä¹ˆä½¿ç”¨ DevOps ï¼Ÿ DevOps çš„ç”Ÿå‘½å‘¨æœŸ DevOps çš„å·¥ä½œæµ DevOps ä¸æ•æ·æœ‰ä»€ä¹ˆä¸åŒï¼Ÿ DevOps VS Agile DevOps åŸåˆ™ è°å¯ä»¥åš DevOps å·¥ç¨‹å¸ˆï¼Ÿ DevOps å·¥ç¨‹å¸ˆçš„è§’è‰²ã€èŒè´£å’ŒæŠ€èƒ½ DevOps å·¥ç¨‹å¸ˆå¯ä»¥æŒ£å¤šå°‘é’±ï¼Ÿ DevOps åŸ¹è®­è®¤è¯ DevOps è‡ªåŠ¨åŒ–å·¥å…· DevOps çš„æœªæ¥æ˜¯æ€æ ·çš„ï¼Ÿ æ€»ç»“  ä¸ºä»€ä¹ˆéœ€è¦ DevOps ï¼Ÿ  åœ¨å®è¡Œ DevOps ä¹‹å‰ï¼Œå¼€å‘å’Œè¿ç»´å›¢é˜Ÿæ˜¯å®Œå…¨å­¤ç«‹çš„ã€‚ æµ‹è¯•å’Œéƒ¨ç½²æ˜¯è®¾è®¡åœ¨æ„å»ºä¹‹åå®Œæˆçš„ç‹¬ç«‹æ´»åŠ¨ã€‚å› æ­¤ï¼Œä»–ä»¬æ¯”å®é™…æ„å»ºå‘¨æœŸæ¶ˆè€—æ›´å¤šæ—¶é—´ã€‚ åœ¨ä¸ä½¿ç”¨ DevOps çš„æƒ…å†µä¸‹ï¼Œå›¢é˜Ÿæˆå‘˜å°†å¤§é‡æ—¶é—´èŠ±åœ¨æµ‹è¯•ï¼Œéƒ¨ç½²å’Œè®¾è®¡ä¸Šï¼Œè€Œä¸æ˜¯æ„å»ºé¡¹ç›®ã€‚ æ‰‹åŠ¨éƒ¨ç½²ä»£ç ä¼šå¯¼è‡´ç”Ÿäº§ä¸­å‡ºç°äººä¸ºé”™è¯¯ã€‚ å¼€å‘å’Œè¿ç»´å›¢é˜Ÿéƒ½æœ‰å„è‡ªçš„æ—¶é—´è¡¨ï¼Œæ—¶é—´çš„ä¸åŒæ­¥å¯¼è‡´ç”Ÿäº§äº¤ä»˜è¿›ä¸€æ­¥å»¶è¯¯ã€‚  æé«˜è½¯ä»¶äº¤ä»˜ç‡æ˜¯ä¸šåŠ¡æ–¹æœ€è¿«åˆ‡çš„éœ€æ±‚ã€‚æ ¹æ® Forrester Consulting Study ç»Ÿè®¡ï¼Œåªæœ‰17ï¼…çš„å›¢é˜Ÿå¯ä»¥è¶³å¤Ÿå¿«åœ°äº¤ä»˜è½¯ä»¶ã€‚æ›´æ˜¯è¯æ˜äº†è¿™ä¸€ç—›ç‚¹ã€‚\nDevOps ä¸ä¼ ç»Ÿè¿ç»´æœ‰ä»€ä¹ˆä¸åŒï¼Ÿ è®©æˆ‘ä»¬å°†ä¼ ç»Ÿè½¯ä»¶ç€‘å¸ƒå¼€å‘æ¨¡å‹ä¸ DevOps è¿›è¡Œæ¯”è¾ƒï¼Œä»¥äº†è§£ DevOps å¸¦æ¥çš„å˜åŒ–ã€‚\næˆ‘ä»¬å‡è®¾æœ‰ä¸€ä¸ªåº”ç”¨ç¨‹åºè®¡åˆ’åœ¨2å‘¨å†…ä¸Šçº¿ï¼Œä»£ç å®Œæˆ80ï¼…ã€‚è¯¥åº”ç”¨ç¨‹åºæ˜¯ä¸€ä¸ªæ–°çš„å‘å¸ƒï¼Œä»è´­ä¹°æœåŠ¡å™¨å¼€å§‹\n   ç€‘å¸ƒå¼å¼€å‘ DevOps     è®¢è´­æ–°æœåŠ¡å™¨åï¼Œå¼€å‘å›¢é˜Ÿéœ€è¦è¿›è¡Œæµ‹è¯•ã€‚è¿ç»´å›¢é˜Ÿæ ¹æ®éœ€æ±‚æ–‡æ¡£å¼€å§‹éƒ¨ç½²åŸºç¡€è®¾æ–½ã€‚ è®¢è´­æ–°æœåŠ¡å™¨åï¼Œå¼€å‘å’Œè¿ç»´å›¢é˜Ÿæ ¹æ®éœ€æ±‚æ–‡æ¡£å…±åŒè°ƒè¯•éƒ¨ç½²æ–°æœåŠ¡å™¨ã€‚è¿™æ ·å¼€å‘äººå‘˜å¯ä»¥æ›´å¥½åœ°äº†è§£æœåŠ¡å™¨çš„åŸºç¡€æ¶æ„ã€‚   å…³äºæ•…éšœè½¬ç§»ï¼Œå†—ä½™ç­–ç•¥ï¼Œæ•°æ®ä¸­å¿ƒä½ç½®å’Œå­˜å‚¨è¦æ±‚çš„è§„åˆ’å­˜åœ¨åå·®ï¼Œå› ä¸ºå¼€å‘äººå‘˜å¯¹åº”ç”¨ç¨‹åºæœ‰æ·±å…¥äº†è§£ï¼Œä½†ä»–ä»¬æ— æ³•æä¾›ä»»ä½•ååŠ©ã€‚ ç”±äºå¼€å‘äººå‘˜çš„åŠ å…¥ï¼Œæœ‰å…³æ•…éšœè½¬ç§»ï¼Œå†—ä½™ç­–ç•¥ï¼Œç¾éš¾æ¢å¤ï¼Œæ•°æ®ä¸­å¿ƒä½ç½®å’Œå­˜å‚¨è¦æ±‚çš„è§„åˆ’éå¸¸å‡†ç¡®ã€‚   è¿ç»´å›¢é˜Ÿå¯¹å¼€å‘å›¢é˜Ÿçš„è¿›å±•ä¸€æ— æ‰€çŸ¥ã€‚åªèƒ½æ ¹æ®è¿ç»´å›¢é˜Ÿç†è§£åˆ¶å®šç›‘æ§è®¡åˆ’ã€‚ åœ¨ DevOps ä¸­ï¼Œè¿ç»´å›¢é˜Ÿå®Œå…¨äº†è§£å¼€å‘äººå‘˜çš„è¿›å±•ã€‚é€šè¿‡äº’åŠ¨ï¼Œå…±åŒåˆ¶å®šæ»¡è¶³è¿ç»´å’Œä¸šåŠ¡éœ€æ±‚çš„ç›‘æ§è®¡åˆ’ã€‚ä»–ä»¬è¿˜ä½¿ç”¨åº”ç”¨ç¨‹åºæ€§èƒ½ç›‘è§†ï¼ˆAPMï¼‰å·¥å…·ä»¥ä¼˜åŒ–åº”ç”¨ã€‚   åœ¨ä¸Šçº¿ä¹‹å‰ï¼Œå‹åŠ›æµ‹è¯•ä½¿åº”ç”¨ç¨‹åºå´©æºƒã€‚å‘å¸ƒå»¶è¿Ÿäº†ã€‚ åœ¨ä¸Šçº¿ä¹‹å‰ï¼Œå‹åŠ›æµ‹è¯•ä½¿åº”ç”¨ç¨‹åºæœ‰ç‚¹æ…¢ã€‚å¼€å‘å›¢é˜Ÿè¿…é€Ÿè§£å†³äº†ç“¶é¢ˆé—®é¢˜ã€‚è¯¥åº”ç”¨ç¨‹åºæŒ‰æ—¶å‘å¸ƒã€‚    ä¸ºä»€ä¹ˆä½¿ç”¨ DevOps ï¼Ÿ DevOps å…è®¸æ•æ·å¼€å‘å›¢é˜Ÿå®æ–½æŒç»­é›†æˆå’ŒæŒç»­äº¤ä»˜ã€‚è¿™æœ‰åŠ©äºä»–ä»¬æ›´å¿«åœ°å°†äº§å“æ¨å‘å¸‚åœºã€‚\nå…¶ä»–é‡è¦åŸå› æ˜¯ï¼š\n å¯é¢„æµ‹æ€§ï¼š DevOps å¯ä»¥æ˜¾ç€é™ä½æ–°ç‰ˆæœ¬çš„æ•…éšœç‡ã€‚ è‡ªæ„ˆæ€§ï¼š å¯ä»¥éšæ—¶å°†åº”ç”¨å›æ»šåˆ°è¾ƒæ—©çš„ç‰ˆæœ¬ã€‚ å¯ç»´æŠ¤æ€§ï¼š åœ¨æ–°ç‰ˆæœ¬å´©æºƒæˆ–å½“å‰ç³»ç»Ÿä¸å¯ç”¨çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥æ¯«ä¸è´¹åŠ›åœ°è¿›è¡Œæ¢å¤ã€‚ ä¸Šçº¿æ—¶é—´ï¼š DevOps é€šè¿‡ç®€åŒ–è½¯ä»¶äº¤ä»˜æµç¨‹å°†ä¸Šçº¿æ—¶é—´ç¼©çŸ­è‡³50ï¼…ã€‚å¯¹äºäº’è”ç½‘å’Œç§»åŠ¨åº”ç”¨æ—¶é—´æ›´çŸ­ã€‚ æ›´é«˜çš„è´¨é‡ï¼š DevOps å¸®åŠ©å›¢é˜Ÿæé«˜åº”ç”¨ç¨‹åºå¼€å‘çš„è´¨é‡ã€‚ é™ä½é£é™©ï¼š DevOps åœ¨è½¯ä»¶äº¤ä»˜çš„ç”Ÿå‘½å‘¨æœŸä¸­åŒ…å«å®‰å…¨æ£€æŸ¥ã€‚å®ƒæœ‰åŠ©äºå‡å°‘æ•´ä¸ªè½¯ä»¶ç”Ÿå‘½å‘¨æœŸä¸­çš„å®‰å…¨é£é™©ã€‚ å¼¹æ€§ï¼š è½¯ä»¶ç³»ç»Ÿçš„è¿è¡ŒçŠ¶æ€æ›´ç¨³å®šï¼Œæ›´å®‰å…¨ï¼Œæ›´æ”¹æ˜¯å¯å®¡è®¡çš„ã€‚ æˆæœ¬æ•ˆç›Šï¼š DevOps åœ¨è½¯ä»¶å¼€å‘è¿‡ç¨‹ä¸­æä¾›äº†æˆæœ¬æ•ˆç›Šï¼Œè¿™å§‹ç»ˆæ˜¯äº’è”ç½‘å…¬å¸ç®¡ç†å±‚æ‰€æœŸæœ›çš„ã€‚ å°†å¤§çš„ä»£ç åº“åˆ†æˆå°å—ï¼š DevOps æ˜¯åŸºäºæ•æ·ç¼–ç¨‹æ–¹æ³•çš„ã€‚å› æ­¤ï¼Œå®ƒå…è®¸å°†å¤§çš„ä»£ç åº“åˆ†è§£ä¸ºæ›´å°ä¸”æ˜“äºç®¡ç†çš„å—ã€‚  ä»€ä¹ˆæ—¶å€™ä½¿ç”¨ DevOps ï¼Ÿ DevOps åº”è¯¥ç”¨äºå¤§å‹åˆ†å¸ƒå¼åº”ç”¨ç¨‹åºï¼Œä¾‹å¦‚ç”µå­å•†åŠ¡ç«™ç‚¹æˆ–æ‰˜ç®¡åœ¨äº‘å¹³å°ä¸Šçš„åº”ç”¨ç¨‹åºã€‚\nä»€ä¹ˆæ—¶å€™ä¸ä½¿ç”¨ DevOpsï¼Ÿ å®ƒä¸åº”è¯¥ç”¨äºå…³é”®ä»»åŠ¡åº”ç”¨ç¨‹åºï¼Œå¦‚é“¶è¡Œï¼Œç”µåŠ›è®¾æ–½å’Œå…¶ä»–æ•æ„Ÿæ•°æ®ç«™ç‚¹ã€‚æ­¤ç±»åº”ç”¨ç¨‹åºéœ€è¦å¯¹ç”Ÿäº§ç¯å¢ƒè¿›è¡Œä¸¥æ ¼çš„è®¿é—®æ§åˆ¶ï¼Œè¯¦ç»†çš„å˜æ›´ç®¡ç†ç­–ç•¥ï¼Œå®Œå–„çš„æ•°æ®ä¸­å¿ƒè®¿é—®æ§åˆ¶ç­–ç•¥ã€‚\nDevOps çš„ç”Ÿå‘½å‘¨æœŸ DevOps æ˜¯å¼€å‘å’Œè¿ç»´ä¹‹é—´çš„æ·±åº¦é›†æˆã€‚åœ¨ä¸äº†è§£ DevOps ç”Ÿå‘½å‘¨æœŸçš„æƒ…å†µä¸‹ï¼Œæ˜¯æ— æ³•çœŸæ­£ç†è§£ DevOps çš„ã€‚\nä»¥ä¸‹æ˜¯æœ‰å…³ DevOpsç”Ÿå‘½å‘¨æœŸçš„ç®€è¦ä¿¡æ¯ï¼š\n å¼€å‘\nåœ¨æ­¤é˜¶æ®µï¼Œæ•´ä¸ªå¼€å‘è¿‡ç¨‹åˆ†ä¸ºå°çš„å¼€å‘å‘¨æœŸã€‚è¿™æœ‰åˆ©äº DevOps å›¢é˜ŸåŠ å¿«è½¯ä»¶å¼€å‘å’Œäº¤ä»˜è¿‡ç¨‹ã€‚\n æµ‹è¯•\nQA å›¢é˜Ÿä½¿ç”¨ Selenium ç­‰è‡ªåŠ¨åŒ–æµ‹è¯•å·¥å…·æ¥è¯†åˆ«å’Œä¿®å¤æ–°ä»£ç ä¸­çš„é”™è¯¯ã€‚\n é›†æˆ\nåœ¨æ­¤é˜¶æ®µï¼Œæ–°åŠŸèƒ½ä¸ä¸»åˆ†æ”¯ä»£ç é›†æˆï¼Œå¹¶è¿›è¡Œæµ‹è¯•ã€‚åªæœ‰æŒç»­é›†æˆå’Œæµ‹è¯•æ‰èƒ½å®ç°æŒç»­äº¤ä»˜ã€‚\n éƒ¨ç½²\nåœ¨æ­¤é˜¶æ®µï¼Œéƒ¨ç½²è¿‡ç¨‹æŒç»­è¿›è¡Œã€‚å®ƒçš„æ‰§è¡Œæ–¹å¼æ˜¯ä»»ä½•æ—¶å€™åœ¨ä»£ç ä¸­è¿›è¡Œçš„ä»»ä½•æ›´æ”¹éƒ½ä¸åº”å½±å“é«˜æµé‡ç½‘ç«™çš„è¿è¡Œã€‚\n ç›‘æµ‹\nåœ¨æ­¤é˜¶æ®µï¼Œè¿ç»´å›¢é˜Ÿå°†è´Ÿè´£å¤„ç†ä¸åˆé€‚çš„ç³»ç»Ÿè¡Œä¸ºæˆ–ç”Ÿäº§ä¸­å‘ç°çš„é”™è¯¯ã€‚\n  DevOps çš„å·¥ä½œæµ å·¥ä½œæµå…è®¸æ’åˆ—å’Œåˆ†ç¦»ç”¨æˆ·æœ€éœ€è¦çš„ä»»åŠ¡ã€‚å®ƒè¿˜èƒ½å¤Ÿåœ¨é…ç½®ä»»åŠ¡æ—¶ååº”å…¶æœ€ç†æƒ³è¿‡ç¨‹ã€‚\nDevOps ä¸æ•æ·æœ‰ä»€ä¹ˆä¸åŒï¼Ÿ DevOps VS Agile è¿™æ˜¯ä¸€ä¸ªå…¸å‹çš„ITæµç¨‹\næ•æ·è§£å†³äº†å®¢æˆ·å’Œå¼€å‘äººå‘˜æ²Ÿé€šä¸­çš„é—®é¢˜\nDevOps è§£å†³äº†å¼€å‘äººå‘˜è¿ç»´äººå‘˜æ²Ÿé€šä¸­çš„é—®é¢˜\n   æ•æ· DevOps     å¼ºè°ƒæ‰“ç ´å¼€å‘äººå‘˜å’Œç®¡ç†å±‚ä¹‹é—´çš„éšœç¢ã€‚ DevOps æ˜¯å…³äºè½¯ä»¶å¼€å‘å’Œè¿ç»´å›¢é˜Ÿçš„ã€‚   è§£å†³å®¢æˆ·éœ€æ±‚ä¸å¼€å‘å›¢é˜Ÿä¹‹é—´çš„è·ç¦»ã€‚ è§£å†³å¼€å‘å’Œè¿ç»´å›¢é˜Ÿä¹‹é—´çš„è·ç¦»ã€‚   é‡ç‚¹å…³æ³¨åŠŸèƒ½å’ŒéåŠŸèƒ½å‡†å¤‡ã€‚ å®ƒä¾§é‡äºè¿ç»´å’Œä¸šåŠ¡å‡†å¤‡ã€‚   æ•æ·å¼€å‘ä¸»è¦æ¶‰åŠå…¬å¸å¯¹å¼€å‘æ–¹å¼çš„æ€è€ƒã€‚ DevOps å¼ºè°ƒä»¥æœ€å¯é å’Œæœ€å®‰å…¨çš„æ–¹å¼éƒ¨ç½²è½¯ä»¶ï¼Œè€Œè¿™äº›æ–¹å¼å¹¶ä¸æ€»æ˜¯æœ€å¿«çš„ã€‚   æ•æ·å¼€å‘éå¸¸æ³¨é‡åŸ¹è®­æ‰€æœ‰å›¢é˜Ÿæˆå‘˜ï¼Œä½¿ä»–ä»¬æ‹¥æœ‰å„ç§ç›¸åŒçš„æŠ€èƒ½ã€‚å› æ­¤ï¼Œå½“å‡ºç°é—®é¢˜æ—¶ï¼Œä»»ä½•å›¢é˜Ÿæˆå‘˜éƒ½å¯ä»¥åœ¨æ²¡æœ‰å›¢é˜Ÿé¢†å¯¼çš„æƒ…å†µä¸‹ä»åˆ«çš„æˆå‘˜é‚£é‡Œè·å¾—å¸®åŠ©ã€‚ DevOps åœ¨å¼€å‘å’Œè¿ç»´å›¢é˜Ÿä¹‹é—´ä¼ æ’­æŠ€èƒ½ï¼Œå¹¶ä¿æŒä¸€è‡´çš„æ²Ÿé€šã€‚   æ•æ·å¼€å‘ç®¡ç† â€œsprintâ€ ï¼Œæ„å‘³ç€æ—¶é—´æ›´çŸ­ï¼ˆä¸åˆ°ä¸€ä¸ªæœˆï¼‰ï¼Œå¹¶ä¸”åœ¨æ­¤æœŸé—´å°†äº§ç”Ÿå’Œå‘å¸ƒå¤šä¸ªåŠŸèƒ½ã€‚ DevOps åŠªåŠ›äº‰å–ä¸»è¦ç‰ˆæœ¬çš„ç¨³å®šå¯é ï¼Œè€Œä¸æ˜¯æ›´å°å’Œæ›´é¢‘ç¹çš„å‘å¸ƒç‰ˆæœ¬ã€‚    DevOps åŸåˆ™ è¿™é‡Œæœ‰å…­ä¸ªåœ¨é‡‡ç”¨ DevOps æ—¶å¿…ä¸å¯å°‘çš„åŸåˆ™ï¼š\n ä»¥å®¢æˆ·ä¸ºä¸­å¿ƒï¼š DevOps å›¢é˜Ÿå¿…é¡»ä»¥å®¢æˆ·ä¸ºä¸­å¿ƒï¼Œå› ä¸ºæ˜¯ä»–ä»¬ä¸æ–­å‘æˆ‘çš„äº§å“å’ŒæœåŠ¡æŠ•èµ„ã€‚ ç«¯åˆ°ç«¯çš„è´£ä»»ï¼š DevOps å›¢é˜Ÿéœ€è¦åœ¨äº§å“çš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸæä¾›æ€§èƒ½æ”¯æŒã€‚è¿™æé«˜äº†äº§å“çš„æ°´å¹³å’Œè´¨é‡ã€‚ æŒç»­æ”¹è¿›ï¼š DevOps æ–‡åŒ–ä¸“æ³¨äºæŒç»­æ”¹è¿›ï¼Œä»¥å°½é‡å‡å°‘æµªè´¹ã€‚å®ƒä¸æ–­åŠ å¿«äº§å“æˆ–æœåŠ¡æ”¹è¿›çš„é€Ÿåº¦ã€‚ è‡ªåŠ¨åŒ–ä¸€åˆ‡ï¼š è‡ªåŠ¨åŒ–æ˜¯ DevOps æµç¨‹çš„é‡è¦åŸåˆ™ã€‚è¿™ä¸ä»…é€‚ç”¨äºè½¯ä»¶å¼€å‘ï¼ŒåŒæ—¶ä¹Ÿé€‚ç”¨äºæ•´ä¸ªåŸºç¡€æ¶æ„ç¯å¢ƒã€‚ ä½œä¸ºä¸€ä¸ªå›¢é˜Ÿå·¥ä½œï¼š åœ¨ DevOps æ–‡åŒ–è§’è‰²ä¸­ï¼Œè®¾è®¡äººå‘˜ï¼Œå¼€å‘äººå‘˜å’Œæµ‹è¯•äººå‘˜å·²ç»å®šä¹‰ã€‚ä»–ä»¬æ‰€éœ€è¦åšçš„å°±æ˜¯ä½œä¸ºä¸€ä¸ªå›¢é˜Ÿå®Œæˆåˆä½œã€‚ ç›‘æ§å’Œæµ‹è¯•æ‰€æœ‰å†…å®¹ï¼š DevOps å›¢é˜Ÿæ‹¥æœ‰å¼ºå¤§çš„ç›‘æ§å’Œæµ‹è¯•ç¨‹åºæ˜¯éå¸¸é‡è¦çš„ã€‚  è°å¯ä»¥åš DevOps å·¥ç¨‹å¸ˆï¼Ÿ DevOps å·¥ç¨‹å¸ˆæ˜¯ä¸€åITä¸“ä¸šäººå‘˜ï¼Œä»–ä¸è½¯ä»¶å¼€å‘äººå‘˜ï¼Œç³»ç»Ÿè¿ç»´äººå‘˜å’Œå…¶ä»–ITäººå‘˜ä¸€èµ·ç®¡ç†ä»£ç å‘å¸ƒã€‚DevOps åº”å…·å¤‡ä¸å¼€å‘ï¼Œæµ‹è¯•å’Œè¿ç»´å›¢é˜Ÿè¿›è¡Œæ²Ÿé€šå’Œåä½œçš„ç¡¬æŠ€èƒ½å’Œè½¯æŠ€èƒ½ã€‚\nDevOps æ–¹æ³•éœ€è¦å¯¹ä»£ç ç‰ˆæœ¬è¿›è¡Œé¢‘ç¹çš„å¢é‡æ›´æ”¹ï¼Œè¿™æ„å‘³ç€é¢‘ç¹çš„éƒ¨ç½²å’Œæµ‹è¯•æ–¹æ¡ˆã€‚å°½ç®¡ DevOps å·¥ç¨‹å¸ˆéœ€è¦å¶å°”ä»å¤´å¼€å§‹ç¼–ç ï¼Œä½†é‡è¦çš„æ˜¯ä»–ä»¬åº”è¯¥å…·å¤‡è½¯ä»¶å¼€å‘è¯­è¨€çš„åŸºç¡€çŸ¥è¯†ã€‚\nDevOps å·¥ç¨‹å¸ˆå°†ä¸å¼€å‘å›¢é˜Ÿçš„å·¥ä½œäººå‘˜ä¸€èµ·è§£å†³è¿æ¥ä»£ç çš„å…ƒç´ ï¼ˆå¦‚åº“æˆ–è½¯ä»¶å¼€å‘å·¥å…·åŒ…ï¼‰æ‰€éœ€çš„ç¼–ç å’Œè„šæœ¬ã€‚\nDevOps å·¥ç¨‹å¸ˆçš„è§’è‰²ã€èŒè´£å’ŒæŠ€èƒ½ DevOps å·¥ç¨‹å¸ˆè´Ÿè´£è½¯ä»¶åº”ç”¨ç¨‹åºå¹³å°çš„ç”Ÿäº§å’ŒæŒç»­ç»´æŠ¤ã€‚\nä»¥ä¸‹æ˜¯ DevOps å·¥ç¨‹å¸ˆçš„ä¸€äº›è§’è‰²ï¼ŒèŒè´£å’ŒæŠ€èƒ½ï¼š\n èƒ½å¤Ÿè·¨å¹³å°å’Œåº”ç”¨ç¨‹åºåŸŸæ‰§è¡Œç³»ç»Ÿæ•…éšœæ’é™¤å’Œé—®é¢˜è§£å†³ã€‚ é€šè¿‡å¼€æ”¾çš„ï¼Œæ ‡å‡†çš„å¹³å°æœ‰æ•ˆç®¡ç†é¡¹ç›®ã€‚ æé«˜é¡¹ç›®å¯è§æ€§å’Œå¯è¿½æº¯æ€§ã€‚ é€šè¿‡åä½œæé«˜å¼€å‘è´¨é‡å¹¶é™ä½å¼€å‘æˆæœ¬ã€‚ åˆ†æã€è®¾è®¡å’Œè¯„ä¼°è‡ªåŠ¨åŒ–è„šæœ¬å’Œç³»ç»Ÿã€‚ é€šè¿‡ä½¿ç”¨æœ€ä½³çš„äº‘å®‰å…¨è§£å†³æ–¹æ¡ˆç¡®ä¿ç³»ç»Ÿçš„å®‰å…¨ã€‚ DevOps å·¥ç¨‹å¸ˆåº”è¯¥å…·å¤‡é—®é¢˜è§£å†³è€…å’Œå¿«é€Ÿå­¦ä¹ è€…çš„è½¯æŠ€èƒ½ã€‚  DevOps å·¥ç¨‹å¸ˆå¯ä»¥æŒ£å¤šå°‘é’±ï¼Ÿ DevOps æ˜¯æœ€çƒ­é—¨çš„ITä¸“ä¸šä¹‹ä¸€ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆé‚£é‡Œéƒ½æœ‰å¾ˆå¤šæœºä¼šçš„åŸå› ã€‚å› æ­¤ï¼Œå³ä½¿æ˜¯åˆçº§DevOpså·¥ç¨‹å¸ˆçš„è–ªé…¬æ°´å¹³ä¹Ÿç›¸å½“é«˜ã€‚åœ¨ç¾å›½ï¼Œåˆçº§DevOpså·¥ç¨‹å¸ˆçš„å¹³å‡å¹´è–ªä¸º78,696ç¾å…ƒã€‚\nDevOps åŸ¹è®­è®¤è¯ DevOps åŸ¹è®­è®¤è¯å¯ä»¥å¸®åŠ©ä»»ä½•æ¸´æœ›æˆä¸º DevOps å·¥ç¨‹å¸ˆèŒä¸šçš„äººã€‚è®¤è¯å¯ä» Amazon web services ã€ Red Hat ã€ Microsoft Academy ã€ DevOps Institute è·å¾—ã€‚\nAWS Certified DevOps Engineer\næ­¤ DevOps å·¥ç¨‹å¸ˆè¯ä¹¦å°†æµ‹è¯•æ‚¨å¦‚ä½•ä½¿ç”¨æœ€å¸¸è§çš„ DevOps æ¨¡å¼åœ¨ AWS ä¸Šå¼€å‘ï¼Œéƒ¨ç½²å’Œç»´æŠ¤åº”ç”¨ç¨‹åºã€‚å®ƒè¿˜ä¼šè¯„ä¼° DevOps æ–¹æ³•çš„æ ¸å¿ƒåŸåˆ™ã€‚\nè¯¥è®¤è¯æœ‰ä¸¤ä¸ªå¿…è¦æ¡ä»¶ï¼šè®¤è¯è´¹ç”¨ä¸º300ç¾å…ƒï¼ŒæŒç»­æ—¶é—´ä¸º170åˆ†é’Ÿã€‚\nRed Hat Certification\nçº¢å¸½ä¸º DevOps ä¸“ä¸šäººå£«æä¾›ä¸åŒçº§åˆ«çš„è®¤è¯ï¼Œå¦‚ä¸‹æ‰€ç¤º:\n Red Hat Certificate of Expertise in Platform-as-a-Service Red Hat Certificate of Expertise in Containerized Application Development Red Hat Certificate of Expertise in Ansible Automation Red Hat Certificate of Expertise in Configuration Management Red Hat Certificate of Expertise in Container Administration  Devops Institute\nDevops Instituteæ˜¯å›´ç»•æ–°å…´ DevOps å®è·µçš„å…¨çƒå­¦ä¹ ç¤¾åŒºã€‚è¯¥ç»„ç»‡æ­£åœ¨ä¸º DevOps èƒ½åŠ›èµ„æ ¼è®¾ç½®è´¨é‡æ ‡å‡†ã€‚Devops Instituteç›®å‰æä¾›ä¸‰ä¸ªè¯¾ç¨‹å’Œè®¤è¯ã€‚\nå…¬å¸æä¾›çš„è®¤è¯è¯¾ç¨‹æœ‰ï¼š\n DevOps Foundation DevOps Foundation Certified Certified Agile Service Manager Certified Agile Process Owner DevOps Test Engineering Continuous Delivery Architecture DevOps Leader DevSecOps Engineering  DevOps è‡ªåŠ¨åŒ–å·¥å…· æ‰€æœ‰æµ‹è¯•æµç¨‹è‡ªåŠ¨åŒ–å¹¶å¯¹å…¶è¿›è¡Œé…ç½®ä»¥å®ç°è‡³å…³é‡è¦çš„é€Ÿåº¦å’Œçµæ´»æ€§ã€‚æ­¤è¿‡ç¨‹ç§°ä¸º DevOps è‡ªåŠ¨åŒ–ã€‚\nç»´æŠ¤åºå¤§çš„ITåŸºç¡€æ¶æ„çš„å¤§å‹ DevOps å›¢é˜Ÿé¢ä¸´çš„å›°éš¾å¯ä»¥ç®€è¦åˆ†ä¸ºå…­ä¸ªä¸åŒçš„ç±»åˆ«ã€‚\n åŸºç¡€è®¾æ–½è‡ªåŠ¨åŒ– é…ç½®ç®¡ç† éƒ¨ç½²è‡ªåŠ¨åŒ– æ€§èƒ½ç®¡ç† æ—¥å¿—ç®¡ç† ç›‘æµ‹  è®©æˆ‘ä»¬çœ‹çœ‹æ¯ä¸ªç±»åˆ«ä¸­çš„å·¥å…·ä»¥åŠå®ƒä»¬å¦‚ä½•è§£å†³ç—›ç‚¹ï¼š\nåŸºç¡€è®¾æ–½è‡ªåŠ¨åŒ– äºšé©¬é€Šç½‘ç»œæœåŠ¡ï¼ˆAWSï¼‰ï¼šä½œä¸ºäº‘æœåŠ¡ï¼Œæ‚¨æ— éœ€å»ºç«‹å®é™…çš„æ•°æ®ä¸­å¿ƒã€‚æ­¤å¤–ï¼Œå®ƒä»¬æ˜“äºæŒ‰éœ€æ‰©å±•ã€‚æ²¡æœ‰å‰æœŸç¡¬ä»¶æˆæœ¬ã€‚å®ƒå¯ä»¥é…ç½®ä¸ºè‡ªåŠ¨æ ¹æ®æµé‡é…ç½®æ›´å¤šæœåŠ¡å™¨ã€‚\né…ç½®ç®¡ç† Chefï¼šå®ƒæ˜¯ä¸€ä¸ªæœ‰ç”¨çš„ DevOps å·¥å…·ï¼Œç”¨äºæå‡é€Ÿåº¦ï¼Œè§„æ¨¡å’Œä¸€è‡´æ€§ã€‚å®ƒå¯ç”¨äºç®€åŒ–å¤æ‚ä»»åŠ¡å¹¶æ‰§è¡Œé…ç½®ç®¡ç†ã€‚ä½¿ç”¨æ­¤å·¥å…·ï¼ŒDevOps å›¢é˜Ÿå¯ä»¥é¿å…åœ¨ä¸€ä¸‡å°æœåŠ¡å™¨ä¸Šè¿›è¡Œæ›´æ”¹ã€‚ç›¸åï¼Œåªéœ€è¦åœ¨ä¸€ä¸ªåœ°æ–¹è¿›è¡Œæ›´æ”¹ï¼Œè¿™äº›æ›´æ”¹ä¼šè‡ªåŠ¨åæ˜ åœ¨å…¶ä»–æœåŠ¡å™¨ä¸­ã€‚\néƒ¨ç½²è‡ªåŠ¨åŒ– Jenkinsï¼šè¯¥å·¥å…·æœ‰åŠ©äºæŒç»­é›†æˆå’Œæµ‹è¯•ã€‚é€šè¿‡åœ¨éƒ¨ç½²æ„å»ºåå¿«é€ŸæŸ¥æ‰¾é—®é¢˜ï¼Œæ›´â€‹â€‹è½»æ¾åœ°é›†æˆé¡¹ç›®æ›´æ”¹ã€‚\næ—¥å¿—ç®¡ç† Splunkï¼šå¯ä»¥è§£å†³åœ¨ä¸€ä¸ªåœ°æ–¹èšåˆï¼Œå­˜å‚¨å’Œåˆ†ææ‰€æœ‰æ—¥å¿—çš„é—®é¢˜çš„å·¥å…·ã€‚\næ€§èƒ½ç®¡ç† App Dynamicï¼šå®ƒæ˜¯ä¸€ä¸ª DevOps å·¥å…·ï¼Œæä¾›å®æ—¶æ€§èƒ½ç›‘æ§ã€‚æ­¤å·¥å…·æ”¶é›†çš„æ•°æ®å¯å¸®åŠ©å¼€å‘äººå‘˜åœ¨å‘ç”Ÿé—®é¢˜æ—¶è¿›è¡Œè°ƒè¯•ã€‚\nç›‘æ§ Nagiosï¼šåœ¨åŸºç¡€æ¶æ„å’Œç›¸å…³æœåŠ¡å‡ºç°æ•…éšœæ—¶é€šçŸ¥ç›¸å…³äººå‘˜ä¹Ÿå¾ˆé‡è¦ã€‚Nagios å°±æ˜¯è¿™æ ·ä¸€ç§å·¥å…·ï¼Œå®ƒå¯ä»¥å¸®åŠ© DevOps å›¢é˜Ÿæ‰¾åˆ°å¹¶çº æ­£é—®é¢˜ã€‚\nDevOps çš„æœªæ¥æ˜¯æ€æ ·çš„ï¼Ÿ  å›¢é˜Ÿå°†ä»£ç éƒ¨ç½²å‘¨æœŸè½¬æ¢ä¸ºæ•°å‘¨å’Œæ•°æœˆï¼Œè€Œä¸æ˜¯æ•°å¹´ã€‚ å¾ˆå¿«å°±ä¼šçœ‹åˆ°ï¼ŒDevOps å·¥ç¨‹å¸ˆå¯ä»¥æ¯”ä¼ä¸šä¸­çš„ä»»ä½•å…¶ä»–äººæ›´å¤šåœ°æ¥è¿‘å’Œç®¡ç†ç»ˆç«¯ç”¨æˆ·ã€‚ DevOps æ­£åœ¨æˆä¸ºITäººå‘˜çš„é‡è¦æŠ€èƒ½ã€‚ä¾‹å¦‚ï¼ŒLinux æ‹›è˜è¿›è¡Œçš„ä¸€é¡¹è°ƒæŸ¥å‘ç°ï¼Œ25ï¼…çš„å—è®¿è€…çš„æ±‚èŒè€…å¯»æ±‚ DevOps å·¥ä½œã€‚ DevOps å’ŒæŒç»­äº¤ä»˜å°†ç»§ç»­å­˜åœ¨ã€‚å› ä¸ºå…¬å¸éœ€è¦å‘å±•ï¼Œä»–ä»¬åˆ«æ— é€‰æ‹©ï¼Œåªèƒ½æ”¹å˜ã€‚ç„¶è€Œï¼ŒDevOps æ¦‚å¿µçš„ä¸»æµåŒ–åˆ™éœ€è¦5åˆ°10å¹´ã€‚  æ€»ç»“  DevOps æ˜¯ä¸€ç§ä¿ƒè¿›å¼€å‘å’Œè¿ç»´å›¢é˜Ÿä¹‹é—´çš„åä½œï¼Œä»¥è‡ªåŠ¨åŒ–å’Œå¯é‡å¤çš„æ–¹å¼æ›´å¿«åœ°å°†ä»£ç éƒ¨ç½²åˆ°ç”Ÿäº§ä¸­çš„æ–‡åŒ–ã€‚ åœ¨ DevOps å‡ºç°ä¹‹å‰è¿ç»´å’Œå¼€å‘å›¢é˜Ÿå®Œå…¨ç‹¬ç«‹ã€‚ æ‰‹åŠ¨éƒ¨ç½²ä»£ç ä¼šå¯¼è‡´ç”Ÿäº§ä¸­å‡ºç°äººä¸ºé”™è¯¯ã€‚ åœ¨æ—§çš„è½¯ä»¶å¼€å‘æµç¨‹ä¸­ï¼Œè¿ç»´å›¢é˜Ÿä¸äº†è§£å¼€å‘å›¢é˜Ÿçš„è¿›åº¦ã€‚å› æ­¤ï¼Œè¿ç»´å›¢é˜Ÿåªèƒ½æ ¹æ®ä»–ä»¬è‡ªå·±çš„ç†è§£åˆ¶å®šäº†åŸºç¡€è®¾æ–½çš„è´­ä¹°å’Œç›‘æ§è®¡åˆ’ã€‚ åœ¨ DevOps æµç¨‹ä¸­ï¼Œè¿ç»´å›¢é˜Ÿå……åˆ†äº†è§£å¼€å‘äººå‘˜çš„è¿›åº¦ã€‚é‡‡è´­å’Œç›‘æ§è®¡åˆ’å‡†ç¡®æ— è¯¯ã€‚ DevOps æä¾›å¯ç»´æŠ¤æ€§ï¼Œå¯é¢„æµ‹æ€§ï¼Œæ›´é«˜è´¨é‡çš„ä»£ç å’Œæ›´å‡†ç¡®çš„ä¸Šçº¿æ—¶é—´ã€‚ æ•æ·æµç¨‹ä¾§é‡äºåŠŸèƒ½å’ŒéåŠŸèƒ½å‡†å¤‡ï¼Œè€Œ DevOps åˆ™ä¾§é‡äºITåŸºç¡€æ¶æ„æ–¹é¢ã€‚ DevOps ç”Ÿå‘½å‘¨æœŸåŒ…æ‹¬å¼€å‘ï¼Œæµ‹è¯•ï¼Œé›†æˆï¼Œéƒ¨ç½²å’Œç›‘æ§ã€‚ DevOps å·¥ç¨‹å¸ˆå°†ä¸å¼€å‘å›¢é˜Ÿå·¥ä½œäººå‘˜åˆä½œï¼Œä»¥è§£å†³ç¼–ç å’Œè„šæœ¬ç¼–å†™éœ€æ±‚ã€‚ DevOps å·¥ç¨‹å¸ˆåº”è¯¥å…·å¤‡é—®é¢˜è§£å†³è€…çš„è½¯æŠ€èƒ½ï¼Œå¹¶ä¸”æ˜¯ä¸€ä¸ªå¿«é€Ÿå­¦ä¹ è€…ã€‚ DevOps è®¤è¯å¯ä» Amazon web servicesï¼ŒRed Hatï¼ŒMicrosoft Academyï¼ŒDevOps Institute è·å¾— DevOps å¯å¸®åŠ©å›¢é˜Ÿå°†ä»£ç éƒ¨ç½²å‘¨æœŸè½¬æ¢ä¸ºæ•°å‘¨å’Œæ•°æœˆï¼Œè€Œä¸æ˜¯æ•°å¹´ã€‚  åŸæ–‡é“¾æ¥ https://www.guru99.com/devops-tutorial.html\n","date":1554787316,"expirydate":-62135596800,"kind":"page","lang":"zh","lastmod":1554787316,"objectID":"b238927f28f34b86efe319037ab06e47","permalink":"https://guoxudong.io/post/devops-tutorial/","publishdate":"2019-04-09T13:21:56+08:00","relpermalink":"/post/devops-tutorial/","section":"post","summary":"â€œDevOpsâ€è¿™ä¸ªè¯æ˜¯ â€œdevelopmentâ€ å’Œ â€œoperationsâ€è¿™ä¸¤ä¸ªè¯çš„ç»„åˆã€‚å®ƒæ˜¯ä¸€ç§ä¿ƒè¿›å¼€å‘å’Œè¿ç»´å›¢é˜Ÿä¹‹é—´çš„åä½œï¼Œä»¥è‡ªåŠ¨åŒ–å’Œå¯é‡å¤çš„æ–¹å¼æ›´å¿«åœ°å°†ä»£ç éƒ¨ç½²åˆ°ç”Ÿäº§ä¸­çš„æ–‡åŒ–ã€‚","tags":["devops","ç¿»è¯‘"],"title":"Devopså…¥é—¨æ‰‹å†Œ","type":"post"},{"authors":["éƒ­æ—­ä¸œ"],"categories":["éƒ¨ç½²å®‰è£…"],"content":"  Rancher ä¸ä»…å¯ä»¥åœ¨ä»»ä½•äº‘æä¾›å•†çš„ä»»ä½•åœ°æ–¹éƒ¨ç½² Kubernetes é›†ç¾¤ï¼Œè€Œä¸”è¿˜å°†å®ƒä»¬é›†ä¸­åœ¨é›†ä¸­å¼çš„èº«ä»½éªŒè¯å’Œè®¿é—®æ§åˆ¶ä¹‹ä¸‹ã€‚ç”±äºå®ƒä¸èµ„æºçš„è¿è¡Œä½ç½®æ— å…³ï¼Œå› æ­¤æ‚¨å¯ä»¥è½»æ¾åœ°åœ¨ä¸åŒçš„ç¯å¢ƒéƒ¨ç½²ä½ çš„ kubernetes é›†ç¾¤å¹¶æ“ä½œä»–ä»¬ã€‚ Rancher ä¸æ˜¯å°†éƒ¨ç½²å‡ ä¸ªç‹¬ç«‹çš„ Kubernetes é›†ç¾¤ï¼Œè€Œæ˜¯å°†å®ƒä»¬ç»Ÿä¸€ä¸ºä¸€ä¸ªå•ç‹¬çš„æ‰˜ç®¡Kubernetes Cloudã€‚\n å‰è¨€ ç›®å‰æˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ rancher 2.1.1ç‰ˆæœ¬ï¼Œåœ¨å»å¹´ rancher å‘å¸ƒ v2.1.* ç‰ˆæœ¬çš„æ—¶å€™åšè¿‡ä¸€æ¬¡å‡çº§ï¼Œå½“æ—¶é‡åˆ°äº†å¾ˆå¤šé—®é¢˜ï¼Œè™½ç„¶éƒ½ä¸€ä¸€è§£å†³ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰æœ‰æ•ˆçš„è®°å½•ä¸‹æ¥ï¼Œè¿™é‡Œåœ¨å‡çº§ v2.2.* ç‰ˆæœ¬çš„æ—¶å€™åšä¸€ä¸ªè®°å½•ä»¥ä¾¿åœ¨ä»Šåå‡çº§çš„æ—¶å€™çš„æä¾›å‚è€ƒä½œç”¨ã€‚\nå‡çº§å‰çš„å‡†å¤‡  é¦–å…ˆæŸ¥çœ‹å½“å‰ rancher ç‰ˆæœ¬ï¼Œè®°ä¸‹è¿™ä¸ªç‰ˆæœ¬å·åé¢éœ€è¦ä½¿ç”¨ã€‚æŸ¥çœ‹æ–¹å¼å°±æ˜¯ç™»é™† rancher åœ¨å·¦ä¸‹è§’å°±å¯ä»¥çœ‹åˆ°å½“å‰ç‰ˆæœ¬å·ï¼Œæˆ‘ä»¬è¿™é‡Œä½¿ç”¨çš„v2.1.1ç‰ˆæœ¬ã€‚ æ‰“å¼€å®˜æ–¹æ–‡æ¡£ï¼Œè¿™é‡Œæ¨èå¯¹ç…§å®˜æ–¹æ–‡æ¡£è¿›è¡Œå‡çº§ï¼Œä¸€èˆ¬å®˜æ–¹æ–‡æ¡£éƒ½ä¼šåŠæ—¶æ›´æ–°å¹¶æä¾›æœ€ä½³å‡çº§æ–¹æ³•ï¼Œè€Œä¸€èˆ¬çš„åšå®¢ä¼šå› ä¸ºå…¶å†™ä½œæ—¶é—´ã€ä½¿ç”¨ç‰ˆæœ¬ã€éƒ¨ç½²ç¯å¢ƒçš„ä¸åŒæœ‰æ‰€åå·®ã€‚å®˜æ–¹æ–‡æ¡£ï¼š https://www.cnrancher.com/docs/rancher/v2.x/cn/upgrades/single-node-upgrade/  å‡çº§  é¦–å…ˆè·å–æ­£åœ¨è¿è¡Œçš„ rancher å®¹å™¨ ID,ç”±ä»¥ä¸‹å‘½ä»¤å¯çŸ¥ RANCHER_CONTAINER_ID ä¸º 83167cb60134\n$ docker ps CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES 83167cb60134 rancher/rancher:latest \u0026quot;entrypoint.sh\u0026quot; 4 months ago Up 4 months 0.0.0.0:80-\u0026gt;80/tcp, 0.0.0.0:443-\u0026gt;443/tcp priceless_newton  åœæ­¢è¯¥å®¹å™¨\n$ docker stop {RANCHER_CONTAINER_ID}  åˆ›å»ºæ­£åœ¨è¿è¡Œçš„ Rancher Server å®¹å™¨çš„æ•°æ®å·å®¹å™¨ï¼Œå°†åœ¨å‡çº§ä¸­ä½¿ç”¨ï¼Œè¿™é‡Œå‘½åä¸º rancher-data å®¹å™¨ã€‚\n æ›¿æ¢{RANCHER_CONTAINER_ID}ä¸ºä¸Šä¸€æ­¥ä¸­çš„å®¹å™¨IDã€‚ æ›¿æ¢{RANCHER_CONTAINER_TAG}ä¸ºä½ å½“å‰æ­£åœ¨è¿è¡Œçš„Rancherç‰ˆæœ¬ï¼Œå¦‚ä¸Šé¢çš„å…ˆå†³æ¡ä»¶ä¸­æ‰€è¿°ã€‚\n$ docker create --volumes-from {RANCHER_CONTAINER_ID} --name rancher-data rancher/rancher:{RANCHER_CONTAINER_TAG}   å¤‡ä»½ rancher-data æ•°æ®å·å®¹å™¨\nå¦‚æœå‡çº§å¤±è´¥ï¼Œå¯ä»¥é€šè¿‡æ­¤å¤‡ä»½è¿˜åŸRancher Serverï¼Œå®¹å™¨å‘½å:rancher-data-snapshot-.\n æ›¿æ¢{RANCHER_CONTAINER_ID}ä¸ºä¸Šä¸€æ­¥ä¸­çš„å®¹å™¨IDã€‚ æ›¿æ¢{CURRENT_VERSION}ä¸ºå½“å‰å®‰è£…çš„Rancherç‰ˆæœ¬çš„æ ‡è®°ã€‚ æ›¿æ¢{RANCHER_CONTAINER_TAG}ä¸ºå½“å‰æ­£åœ¨è¿è¡Œçš„Rancherç‰ˆæœ¬ï¼Œå¦‚å…ˆå†³æ¡ä»¶ä¸­æ‰€è¿° ã€‚\n$ docker create --volumes-from {RANCHER_CONTAINER_ID} --name rancher-data-snapshot-{CURRENT_VERSION} rancher/rancher:{RANCHER_CONTAINER_TAG}   æ‹‰å–Rancherçš„æœ€æ–°é•œåƒ,è¿™é‡Œç¡®ä¿æœ‰å¤–ç½‘ï¼Œå¯èƒ½æ‹‰å–åˆ°æ–°çš„é•œåƒï¼Œå¦‚æœæ²¡æœ‰å¤–ç½‘ï¼Œè¿™é‡Œå°±éœ€è¦å°†é•œåƒä¸Šä¼ åˆ°ç§æœ‰é•œåƒä»“åº“ï¼Œå°†æ‹‰å–åœ°å€è®¾ç½®ä¸ºç§æœ‰é•œåƒä»“åº“å³å¯\n$ docker pull rancher/rancher:latest  é€šè¿‡ rancher-data æ•°æ®å·å®¹å™¨å¯åŠ¨æ–°çš„ Rancher Server å®¹å™¨ã€‚\nè¿™é‡Œè¦æ³¨æ„åˆ°ï¼Œæˆ‘ä»¬è¿™æ˜¯ä½¿ç”¨çš„æ˜¯ç‹¬ç«‹å®¹å™¨+å¤–éƒ¨ä¸ƒå±‚è´Ÿè½½å‡è¡¡ï¼Œæ˜¯é€šè¿‡é˜¿é‡Œäº‘SLBè¿›è¡ŒSSLè¯ä¹¦è®¤è¯ï¼Œéœ€è¦åœ¨å¯åŠ¨çš„æ—¶å€™å¢åŠ --no-cacerts\n$ docker run -d --volumes-from rancher-data --restart=unless-stopped -p 80:80 -p 443:443 rancher/rancher:latest --no-cacerts   å‡çº§è¿‡ç¨‹ä¼šéœ€è¦ä¸€å®šæ—¶é—´ï¼Œä¸è¦åœ¨å‡çº§è¿‡ç¨‹ä¸­ç»ˆæ­¢å‡çº§ï¼Œå¼ºåˆ¶ç»ˆæ­¢å¯èƒ½ä¼šå¯¼è‡´æ•°æ®åº“è¿ç§»é”™è¯¯ã€‚\nå‡çº§ Rancher Serveråï¼Œ server å®¹å™¨ä¸­çš„æ•°æ®ä¼šä¿å­˜åˆ° rancher-data å®¹å™¨ä¸­ï¼Œä»¥ä¾¿å°†æ¥å‡çº§ã€‚\n åˆ é™¤æ—§ç‰ˆæœ¬ Rancher Server å®¹å™¨\nå¦‚æœä½ åªæ˜¯åœæ­¢ä»¥å‰çš„Rancher Serverå®¹å™¨(å¹¶ä¸”ä¸åˆ é™¤å®ƒ),åˆ™æ—§ç‰ˆæœ¬å®¹å™¨å¯èƒ½éšç€ä¸»æœºé‡å¯åè‡ªåŠ¨è¿è¡Œï¼Œå¯¼è‡´å®¹å™¨ç«¯å£å†²çªã€‚\n å‡çº§æˆåŠŸ\nè®¿é—® rancher å¯ä»¥çœ‹åˆ°å³ä¸‹è§’ç‰ˆæœ¬å·²ç»å®Œæˆæ›´æ–°ã€‚\n  ","date":1554002135,"expirydate":-62135596800,"kind":"page","lang":"zh","lastmod":1554002135,"objectID":"69746155b644a99ee7a09912d6465296","permalink":"https://guoxudong.io/post/rancher-update-2.2.1/","publishdate":"2019-03-31T11:15:35+08:00","relpermalink":"/post/rancher-update-2.2.1/","section":"post","summary":"Rancher ä¸ä»…å¯ä»¥åœ¨ä»»ä½•äº‘æä¾›å•†çš„ä»»ä½•åœ°æ–¹éƒ¨ç½² Kubernetes é›†ç¾¤ï¼Œè€Œä¸”è¿˜å°†å®ƒä»¬é›†ä¸­åœ¨é›†ä¸­å¼çš„èº«ä»½éªŒè¯å’Œè®¿é—®æ§åˆ¶ä¹‹ä¸‹ã€‚ç”±äºå®ƒä¸èµ„æºçš„è¿è¡Œä½ç½®æ— å…³ï¼Œå› æ­¤æ‚¨å¯ä»¥è½»æ¾åœ°åœ¨ä¸åŒçš„ç¯å¢ƒéƒ¨ç½²ä½ çš„ kubernetes é›†ç¾¤å¹¶æ“ä½œä»–ä»¬ã€‚ Rancher ä¸æ˜¯å°†éƒ¨ç½²å‡ ä¸ªç‹¬ç«‹çš„ Kubernetes é›†ç¾¤ï¼Œè€Œæ˜¯å°†å®ƒä»¬ç»Ÿä¸€ä¸ºä¸€ä¸ªå•ç‹¬çš„æ‰˜ç®¡Kubernetes Cloudã€‚","tags":["rancher","å®¹å™¨","kubernetes"],"title":"å•èŠ‚ç‚¹ç‰ˆrancherå‡çº§æŒ‡å—","type":"post"},{"authors":["éƒ­æ—­ä¸œ"],"categories":["ç¿»è¯‘"],"content":"  ä½œè€…ï¼šWilliam Morgan å‘è¡¨äº2017å¹´4æœˆ25æ—¥ï¼Œ2018å¹´11æœˆ26æ—¥æœ‰æ‰€ä¿®æ”¹ã€‚\n Service Mesh æ˜¯ä¸€ä¸ªä¸“é—¨ä½¿æœåŠ¡ä¸æœåŠ¡ä¹‹é—´çš„é€šä¿¡å˜å¾—å®‰å…¨ã€å¿«é€Ÿå’Œå¯é çš„çš„åŸºç¡€è®¾æ–½ã€‚å¦‚æœä½ æ­£åœ¨åœ¨æ„å»ºä¸€ä¸ªäº‘åŸç”Ÿï¼ˆ Cloud Native ï¼‰åº”ç”¨ï¼Œé‚£ä¹ˆä½ ä¸€å®šéœ€è¦ Service Mesh ã€‚\nåœ¨è¿‡å»çš„ä¸€å¹´ä¸­ï¼Œ Service Mesh æˆä¸ºäº†äº‘åŸç”ŸæŠ€æœ¯æ ˆçš„å…³é”®ç»„ä»¶ã€‚åƒ Paypal , Ticketmaster å’Œ Credit Karma è¿™æ ·çš„å¤§å‚ï¼Œå·²ç»å°† Service Mesh åŠ å…¥åˆ°ä»–ä»¬çš„å…¨éƒ¨åº”ç”¨ä¸­ã€‚å¹¶ä¸”åœ¨2017å¹´1æœˆï¼Œå¼€æºçš„ Service Mesh è½¯ä»¶ Linkerd åŠ å…¥äº‘åŸç”ŸåŸºé‡‘ä¼šï¼ˆ CNCF ï¼‰ï¼Œæˆä¸ºäº‘åŸç”ŸåŸºé‡‘ä¼šï¼ˆ CNCF ï¼‰çš„å®˜æ–¹é¡¹ç›®ã€‚ä½†æ˜¯ä»€ä¹ˆæ˜¯çœŸæ­£çš„ Service Mesh ï¼Ÿå®ƒåˆä¸ºä½•çªç„¶å˜çš„å¦‚æ­¤é‡è¦ï¼Ÿ\nåœ¨è¿™ç¯‡æ–‡ç« ï¼Œæˆ‘ä¼šè®²è§£ Service Mesh çš„å®šä¹‰ï¼Œå¹¶é€šè¿‡åº”ç”¨æœåŠ¡æ¶æ„è¿‡å»åå¹´çš„å‘å±•è¿½æº¯å…¶èµ·æºã€‚å¹¶å°† Service Mesh ä¸å…¶ä»–ç›¸ä¼¼çš„æ¦‚å¿µï¼ˆåŒ…æ‹¬ API ç½‘å…³ï¼Œè¾¹ç¼˜ä»£ç†ä»¥åŠ ESB ï¼ˆenterprise service busï¼‰ï¼‰è¿›è¡ŒåŒºåˆ†ã€‚æœ€ç»ˆï¼Œå°†ä¼šæè¿° Service Mesh çš„å‘å±•æ–¹å‘ï¼Œä»¥åŠéšç€äº‘åŸç”Ÿæ¦‚å¿µçš„æ™®åŠï¼ŒService Mesh å‘ç”Ÿçš„å˜åŒ–ã€‚\nä»€ä¹ˆæ˜¯ Service Mesh Service Mesh è¿™ä¸ªæœåŠ¡ç½‘ç»œä¸“æ³¨äºå¤„ç†æœåŠ¡å’ŒæœåŠ¡é—´çš„é€šè®¯ã€‚å…¶ä¸»è¦è´Ÿè´£æ„é€ ä¸€ä¸ªç¨³å®šå¯é çš„æœåŠ¡é€šè®¯çš„åŸºç¡€è®¾æ–½ï¼Œå¹¶è®©æ•´ä¸ªæ¶æ„æ›´ä¸ºçš„å…ˆè¿›å’Œ Cloud Nativeã€‚åœ¨å·¥ç¨‹ä¸­ï¼ŒService Mesh åŸºæœ¬æ¥è¯´æ˜¯ä¸€ç»„è½»é‡çº§çš„æœåŠ¡ä»£ç†å’Œåº”ç”¨é€»è¾‘çš„æœåŠ¡åœ¨ä¸€èµ·ï¼Œå¹¶ä¸”å¯¹äºåº”ç”¨æœåŠ¡æ˜¯é€æ˜çš„ã€‚\nService Mesh ä½œä¸ºç‹¬ç«‹å±‚çš„æ¦‚å¿µä¸äº‘åŸç”Ÿåº”ç”¨çš„å…´èµ·æœ‰å…³ã€‚åœ¨äº‘åŸç”Ÿæ¨¡å¼ï¼Œå•ä¸ªåº”ç”¨å¯èƒ½æœ‰æ•°ç™¾ä¸ªæœåŠ¡ç»„æˆï¼Œæ¯ä¸ªæœåŠ¡åˆå¯èƒ½æœ‰ä¸Šåƒä¸ªå®ä¾‹ï¼Œè€Œæ¯ä¸ªå®ä¾‹éƒ½æœ‰å¯èƒ½è¢«åƒ kubernetes è¿™æ ·çš„æœåŠ¡è°ƒåº¦å™¨ä¸æ–­è°ƒåº¦ä»è€Œä¸æ–­å˜åŒ–çŠ¶æ€ã€‚è€Œè¿™äº›å¤æ‚çš„é€šä¿¡åˆæ™®éæ˜¯æœåŠ¡è¿è¡Œæ—¶è¡Œä¸ºçš„ä¸€éƒ¨åˆ†ï¼Œè¿™æ—¶ç¡®ä¿ç«¯åˆ°ç«¯çš„é€šä¿¡çš„æ€§èƒ½å’Œå¯é æ€§å°±å˜çš„è‡³å…³é‡è¦ã€‚\nService Mesh å°±æ˜¯ä¸€ä¸ªç½‘ç»œæ¨¡å‹å—ï¼Ÿ Service Mesh æ˜¯ä¸€ä¸ªä½äº TCP/IP ä¸Šçš„æŠ½è±¡å±‚çš„ç½‘ç»œæ¨¡å‹ã€‚å®ƒå‡å®šåº•å±‚ L3/L4 ç½‘ç»œå­˜åœ¨å¹¶ä¸”èƒ½å¤Ÿä»ä¸€ç‚¹å‘å¦ä¸€ç‚¹ä¼ è¾“æ•°æ®ã€‚ï¼ˆå®ƒè¿˜å‡å®šè¿™ä¸ªç½‘ç»œå’Œç¯å¢ƒçš„å…¶ä»–æ–¹é¢ä¸€æ ·ä¸å¯é ï¼Œæ‰€ä»¥ Service Mesh ä¹Ÿå¿…é¡»èƒ½å¤Ÿå¤„ç†ç½‘ç»œæ•…éšœã€‚ï¼‰\nåœ¨æŸäº›æ–¹é¢ï¼ŒService Mesh å°±åƒæ˜¯ç½‘ç»œä¸ƒå±‚æ¨¡å‹ä¸­çš„ç¬¬å››å±‚ TCP åè®®ã€‚å…¶æŠŠåº•å±‚çš„é‚£äº›éå¸¸éš¾æ§åˆ¶çš„ç½‘ç»œé€šè®¯æ–¹é¢çš„æ§åˆ¶é¢çš„ä¸œè¥¿éƒ½ç®¡äº†ï¼ˆæ¯”å¦‚ï¼šä¸¢åŒ…é‡ä¼ ã€æ‹¥å¡æ§åˆ¶ã€æµé‡æ§åˆ¶ï¼‰ï¼Œè€Œæ›´ä¸ºä¸Šé¢çš„åº”ç”¨å±‚çš„åè®®ï¼Œåªéœ€è¦å…³å¿ƒè‡ªå·±ä¸šåŠ¡åº”ç”¨å±‚ä¸Šçš„äº‹äº†ã€‚\nä¸ TCP ä¸åŒçš„æ˜¯ï¼Œ Service Mesh æƒ³è¦è¾¾æˆçš„ç›®çš„ä¸ä»…ä»…æ˜¯æ­£å¸¸çš„ç½‘ç»œé€šè®¯ã€‚å®ƒä¸ºåº”ç”¨æä¾›äº†ç»Ÿä¸€çš„ï¼Œå¯è§†åŒ–çš„ä»¥åŠå¯æ§åˆ¶çš„æ§åˆ¶å¹³é¢ã€‚Service Mesh æ˜¯è¦å°†æœåŠ¡é—´çš„é€šä¿¡ä»æ— æ³•å‘ç°å’Œæ§åˆ¶çš„åŸºç¡€è®¾æ–½ä¸­åˆ†ç¦»å‡ºæ¥ï¼Œå¹¶å¯¹å…¶è¿›è¡Œç›‘æ§ã€ç®¡ç†å’Œæ§åˆ¶ã€‚\nService Mesh å®é™…ä¸Šåšäº†ä»€ä¹ˆï¼Ÿ åœ¨äº‘åŸç”Ÿåº”ç”¨ä¸­ä¼ é€’å¯é çš„è¯·æ±‚æ˜¯ååˆ†å¤æ‚çš„ã€‚è€Œ Linkerd æä¾›äº†æœåŠ¡ç†”æ–­ã€é‡è¯•ã€è´Ÿè½½å‡è¡¡ã€ç†”æ–­é™çº§ç­‰åŠŸèƒ½ï¼Œé€šè¿‡å…¶å¼ºå¤§çš„åŠŸèƒ½æ¥ç®¡ç†é‚£äº›å¿…é¡»è¿è¡Œåœ¨å¤æ‚ç¯å¢ƒä¸­çš„æœåŠ¡ã€‚\nè¿™é‡Œåˆ—ä¸¾ä¸€ä¸ªé€šè¿‡ Linkerd å‘æœåŠ¡å‘å‡ºè¯·æ±‚çš„ç®€å•æµç¨‹ï¼š\n é€šè¿‡ Linkerd çš„åŠ¨æ€è·¯ç”±è§„åˆ™æ¥ç¡®å®šæ‰“ç®—è¿æ¥å“ªä¸ªæœåŠ¡ã€‚è¿™ä¸ªè¯·æ±‚æ˜¯è¦è·¯ç”±åˆ°ç”Ÿäº§ç¯å¢ƒè¿˜æ˜¯æ¼”ç¤ºç¯å¢ƒï¼Ÿæ˜¯è¯·æ±‚æœ¬åœ°æ•°æ®ä¸­å¿ƒçš„æœåŠ¡è¿˜æ˜¯äº‘ä¸Šçš„æœåŠ¡ï¼Ÿæ˜¯è¯·æ±‚æ­£åœ¨æµ‹è¯•çš„æœ€æ–°ç‰ˆçš„æœåŠ¡è¿˜æ˜¯å·²ç»åœ¨ç”Ÿäº§ä¸­ç»è¿‡éªŒè¯çš„è€ç‰ˆæœ¬ï¼Ÿæ‰€æœ‰çš„è¿™äº›è·¯ç”±è§„åˆ™éƒ½æ˜¯åŠ¨æ€é…ç½®çš„ï¼Œå¯ä»¥å…¨å±€åº”ç”¨ä¹Ÿå¯ä»¥éƒ¨åˆ†åº”ç”¨ã€‚ æ‰¾åˆ°æ­£ç¡®çš„ç›®çš„æœåŠ¡åï¼Œ Linkerd ä»ä¸€ä¸ªæˆ–å‡ ä¸ªç›¸å…³çš„æœåŠ¡å‘ç°ç«¯ç‚¹æ£€ç´¢å®ä¾‹æ± ã€‚å¦‚æœè¿™äº›ä¿¡æ¯ä¸ Linkerd çš„æœåŠ¡å‘ç°ä¿¡æ¯ä¸åŒï¼Œ Linkerd ä¼šå†³å®šä¿¡ä»»å“ªäº›ä¿¡æ¯æ¥æºã€‚ Linkerd ä¼šæ ¹æ®è§‚å¯Ÿåˆ°çš„æœ€è¿‘çš„å“åº”å»¶è¿Ÿæ¥é€‰æ‹©é€Ÿåº¦æœ€å¿«çš„å®ä¾‹ã€‚ Linkerd å‘é€è¯·æ±‚ç»™è¿™ä¸ªå®ä¾‹ï¼Œè®°å½•å»¶è¿Ÿå’Œå“åº”ç±»å‹ã€‚ å¦‚æœè¿™ä¸ªå®ä¾‹æŒ‚äº†ã€æ— å“åº”æˆ–è€…æ— æ³•å¤„ç†è¯·æ±‚ï¼Œ Linkerd ä¼šå†å¦ä¸€ä¸ªå®ä¾‹ä¸Šé‡è¯•è¿™ä¸ªè¯·æ±‚ã€‚ï¼ˆä½†åªæœ‰åœ¨è¯·æ±‚æ˜¯å¹‚ç­‰çš„æ—¶å€™ï¼‰ å¦‚æœä¸€ä¸ªå®ä¾‹ä¸€ç›´è¯·æ±‚å¤±è´¥ï¼Œ Linkerd ä¼šå°†å…¶ç§»å‡ºå®šæ—¶é‡è¯•çš„è´Ÿè½½å‡è¡¡æ± ã€‚ å¦‚æœè¯·æ±‚è¶…æ—¶ï¼Œ Linkerd ä¼šä¸»åŠ¨å°†è¯·æ±‚å¤±æ•ˆï¼Œè€Œä¸æ˜¯è¿›ä¸€æ­¥é‡è¯•ä»è€Œå¢åŠ è´Ÿè½½ã€‚ Linkerd ä¼šè®°å½•æŒ‡æ ‡å’Œåˆ†å¸ƒå¼çš„è¿½è¸ªä¸Šè¿°è¡Œä¸ºçš„å„ä¸ªæ–¹é¢ï¼Œå°†ä»–ä»¬ä¿å­˜åœ¨é›†ä¸­çš„æŒ‡æ ‡ç³»ç»Ÿä¸­ã€‚  ä»¥ä¸Šåªæ˜¯ç®€åŒ–ç‰ˆçš„ä»‹ç»ï¼Œ Linkerd è¿˜å¯ä»¥å¯åŠ¨å’Œé‡è¯• TLS ï¼Œæ‰§è¡Œåè®®å‡çº§ï¼ŒåŠ¨æ€åˆ‡æ¢æµé‡ï¼Œç”šè‡³åœ¨æ•…éšœä¹‹åæ•°æ®ä¸­å¿ƒçš„åˆ‡æ¢ã€‚ å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œè¿™äº›åŠŸèƒ½æ—¨åœ¨ä¸ºæ¯ä¸ªå®ä¾‹å’Œåº”ç”¨ç¨‹åºæä¾›å¼¹æ€§ä¼¸ç¼©ã€‚è€Œå¤§è§„æ¨¡çš„åˆ†å¸ƒå¼ç³»ç»Ÿï¼ˆæ— è®ºæ˜¯å¦‚ä½•æ„å»ºçš„ï¼‰éƒ½æœ‰ä¸€ä¸ªå…±åŒç‰¹ç‚¹ï¼šéƒ½ä¼šå› ä¸ºè®¸å¤šå°çš„æ•…éšœï¼Œè€Œå‡çº§ä¸ºå…¨ç³»ç»Ÿç¾éš¾æ€§çš„æ•…éšœã€‚Service Mesh åˆ™è¢«è®¾è®¡ä¸ºé€šè¿‡å¿«é€Ÿçš„å¤±æ•ˆå’Œå‡å°‘è´Ÿè½½æ¥ä¿æŠ¤æ•´ä¸ªç³»ç»Ÿå…å—è¿™æ ·ç¾éš¾æ€§çš„æ•…éšœã€‚\nä¸ºä»€ä¹ˆ Service Mesh æ˜¯å¿…è¦çš„ï¼Ÿ Service Mesh æœ¬è´¨ä¸Šå¹¶ä¸æ˜¯ä»€ä¹ˆæ–°æŠ€æœ¯ï¼Œè€Œæ˜¯åŠŸèƒ½æ‰€åœ¨ä½ç½®çš„è½¬å˜ã€‚Web åº”ç”¨éœ€è¦ç®¡ç†å¤æ‚çš„æœåŠ¡é€šä¿¡ï¼ŒService Mesh æ¨¡å¼çš„èµ·æºå’Œæ¼”å˜è¿‡ç¨‹å¯ä»¥è¿½æº¯åˆ°15å¹´å‰ã€‚\nå‚è€ƒ2000å¹´å·¦å³ä¸­å‹ Web åº”ç”¨çš„å…¸å‹ä¸‰å±‚æ¶æ„ï¼Œåœ¨è¿™ä¸ªæ¶æ„ä¸­ï¼Œåº”ç”¨è¢«åˆ†ä¸ºä¸‰å±‚ï¼šåº”ç”¨é€»è¾‘ã€web æœåŠ¡é€»è¾‘ã€å­˜å‚¨é€»è¾‘ã€‚å±‚ä¹‹é—´çš„é€šä¿¡è™½ç„¶å¤æ‚ï¼Œä½†æ˜¯æ¯•ç«ŸèŒƒå›´æœ‰é™ï¼Œæœ€å¤šåªæœ‰2è·³ã€‚è¿™é‡Œå¹¶ä¸æ˜¯ â€œMeshâ€ çš„ï¼Œä½†åœ¨æ¯å±‚ä¸­å¤„ç†è·³è½¬çš„ä»£ç æ˜¯å­˜åœ¨é€šä¿¡é€»è¾‘çš„ã€‚\nå½“è¿™ç§æ¶æ„å‘æ›´å¤§è§„æ¨¡å‘å±•çš„æ—¶å€™ï¼Œè¿™ç§é€šä¿¡æ–¹å¼å°±æ— ä»¥ä¸ºç»§äº†ã€‚åƒ Google , Netflix , å’Œ Twitte ï¼Œåœ¨é¢ä¸´å·¨å¤§çš„è¯·æ±‚æµé‡çš„æ—¶å€™ï¼Œä»–ä»¬çš„å®ç°äº†äº‘åŸç”Ÿåº”ç”¨çš„å‰èº«ï¼šåº”ç”¨è¢«åˆ†å‰²æˆäº†è®¸å¤šæœåŠ¡ï¼ˆç°åœ¨ç§°ä½œâ€œå¾®æœåŠ¡â€ï¼‰ï¼Œè¿™äº›æœåŠ¡ç»„æˆäº†ä¸€ç§ç½‘æ ¼ç»“æ„ã€‚åœ¨è¿™äº›ç³»ç»Ÿä¸­ï¼Œé€šç”¨é€šä¿¡å±‚çªç„¶å…´èµ·ï¼Œè¡¨ç°ä¸ºâ€œèƒ–å®¢æˆ·ç«¯â€çš„å½¢å¼ - Twitter çš„ Finagle, Netflix çš„ Hystrix å’Œ Google çš„ Stubby éƒ½æ˜¯å¾ˆå…¸å‹çš„ä¾‹å­ã€‚\nç°åœ¨çœ‹æ¥ï¼Œåƒ Finagle ã€Stubby å’Œ Hystrix è¿™æ ·çš„åº“å°±æ˜¯æœ€æ—©çš„ Service Meshã€‚è™½ç„¶å®ƒä»¬æ˜¯ä¸ºç‰¹å®šç¯å¢ƒã€è¯­è¨€å’Œæ¡†æ¶å®šåˆ¶äº†ï¼Œä½†éƒ½æ˜¯ä½œä¸ºåŸºç¡€è®¾æ–½ä¸“é—¨ç”¨äºç®¡ç†æœåŠ¡é—´çš„é€šä¿¡ï¼Œå¹¶ï¼ˆåœ¨ Finagle å’Œ Hystrix å¼€æºçš„æƒ…å†µä¸‹ï¼‰åœ¨å…¶ä»–å…¬å¸çš„åº”ç”¨ä¸­è¢«ä½¿ç”¨ã€‚\nè¿™ä¸‰ä¸ªç»„ä»¶éƒ½æœ‰åº”ç”¨è‡ªé€‚åº”æœºåˆ¶ï¼Œä»¥ä¾¿åœ¨è´Ÿè½½ä¸­è¿›è¡Œæ‹“å±•ï¼Œå¹¶å¤„ç†åœ¨äº‘ç¯å¢ƒä¸­çš„éƒ¨åˆ†æ•…éšœã€‚ä½†æ˜¯å¯¹äºæ•°ç™¾ä¸ªæœåŠ¡æˆ–æ•°åƒä¸ªå®ä¾‹ï¼Œä»¥åŠä¸æ—¶éœ€è¦é‡æ–°è°ƒåº¦çš„ä¸šåŠ¡å±‚å®ä¾‹ï¼Œå•ä¸ªè¯·æ±‚é€šè¿‡çš„è°ƒç”¨é“¾å¯èƒ½å˜çš„éå¸¸å¤æ‚ï¼Œè€Œä¸”æœåŠ¡å¯èƒ½ç”±ä¸åŒçš„è¯­è¨€ç¼–å†™ï¼Œè¿™æ—¶åŸºäºåº“çš„è§£å†³æ–¹æ¡ˆå¯èƒ½å°±ä¸å†é€‚ç”¨äº†ã€‚\næœåŠ¡é€šä¿¡çš„å¤æ‚æ€§å’Œé‡è¦æ€§å¯¼è‡´æˆ‘ä»¬æ€¥éœ€ä¸€ä¸ªä¸“é—¨çš„åŸºç¡€è®¾æ–½å±‚æ¥å¤„ç†æœåŠ¡é—´çš„é€šä¿¡ï¼Œè¯¥å±‚éœ€è¦ä¸ä¸šåŠ¡ä»£ç è§£è€¦ï¼Œå¹¶ä¸”å…·æœ‰æ•è·åº•å±‚ç¯å¢ƒçš„åŠ¨æ€æœºåˆ¶ã€‚è¿™å°±æ˜¯ Service Mesh ã€‚\nService Mesh çš„æœªæ¥ Service Mesh åœ¨äº‘ç”Ÿæ€ä¸‹è¿…é€Ÿçš„æˆé•¿ï¼Œå¹¶ä¸”æœ‰ç€ä»¤äººæ¿€åŠ¨çš„æœªæ¥ç­‰å¾…æ¢ç´¢ã€‚å¯¹æ— æœåŠ¡å™¨è®¡ç®—ï¼ˆServerlessï¼Œ ä¾‹å¦‚ Amazon çš„ Lambdaï¼‰é€‚ç”¨çš„ Service Mesh ç½‘ç»œæ¨¡å‹ï¼Œåœ¨äº‘ç”Ÿæ€ç³»ç»Ÿä¸­è§’è‰²çš„è‡ªç„¶æ‹“å±•ã€‚Service Mesh å¯èƒ½æˆä¸ºæœåŠ¡èº«ä»½å’Œè®¿é—®ç­–ç•¥è¿™äº›åœ¨äº‘åŸç”Ÿé¢†åŸŸè¿˜æ˜¯æ¯”è¾ƒæ–°çš„æŠ€æœ¯çš„åŸºç¡€ã€‚æœ€åï¼ŒService Mesh ï¼Œå¦‚ä¹‹å‰çš„TCP / IPï¼Œå°†æ¨è¿›åŠ å…¥åˆ°åº•å±‚çš„åŸºç¡€æ¶æ„ä¸­ã€‚å°±åƒ Linkerd æ˜¯ç”±åƒ Finagle è¿™æ ·çš„ç³»ç»Ÿå‘å±•è€Œæ¥ï¼ŒService Mesh å°†ä½œä¸ºå•ç‹¬çš„ç”¨æˆ·ç©ºé—´ä»£ç†æ·»åŠ åˆ°äº‘åŸç”ŸæŠ€æœ¯æ ˆä¸­ç»§ç»­å‘å±•ã€‚\nç»“è¯­ Service Mesh æ˜¯äº‘åŸç”ŸæŠ€æœ¯æ ˆçš„å…³é”®æŠ€æœ¯ã€‚Linkerd æˆç«‹ä»…1å¹´å°±æˆä¸ºäº†äº‘åŸç”ŸåŸºé‡‘ä¼šï¼ˆCNCFï¼‰çš„ä¸€éƒ¨åˆ†ï¼Œæ‹¥æœ‰è“¬å‹ƒå‘å±•çš„ç¤¾åŒºå’Œè´¡çŒ®è€…ã€‚ä½¿ç”¨è€…ä»åƒ Monzo è¿™æ ·é¢ è¦†è‹±å›½é“¶è¡Œä¸šçš„åˆ›ä¸šå…¬å¸ï¼Œåˆ°åƒ Paypalã€ Ticketmaster å’Œ Credit Karma è¿™æ ·çš„äº’è”ç½‘å¤§å‚ï¼Œå†åˆ°åƒ Houghton Mifflin Harcourt è¿™æ ·ç»è¥äº†æ•°ç™¾å¹´çš„å…¬å¸ã€‚\nä½¿ç”¨è€…å’Œè´¡çŒ®è€…æ¯å¤©éƒ½åœ¨ Linkerd ç¤¾åŒºå±•ç¤º Service Mesh åˆ›é€ çš„ä»·å€¼ã€‚æˆ‘ä»¬å°†è‡´åŠ›äºæ‰“é€ è¿™ä¸€ä»¤äººæƒŠå¹çš„äº§å“ï¼Œå¹¶ç»§ç»­å‘å±•å£®å¤§æˆ‘ä»¬çš„ç¤¾åŒºï¼ŒåŠ å…¥æˆ‘ä»¬å§ï¼\nåŸæ–‡é“¾æ¥ https://buoyant.io/2017/04/25/whats-a-service-mesh-and-why-do-i-need-one/\n","date":1553509040,"expirydate":-62135596800,"kind":"page","lang":"zh","lastmod":1553509040,"objectID":"eb4a0539fb3ed49ca0b08950721945a5","permalink":"https://guoxudong.io/post/whats-a-service-mesh-and-why-do-i-need-one/","publishdate":"2019-03-25T18:17:20+08:00","relpermalink":"/post/whats-a-service-mesh-and-why-do-i-need-one/","section":"post","summary":"Service Mesh æ˜¯ä¸€ä¸ªä¸“é—¨ç”¨äºä½¿æœåŠ¡ä¸æœåŠ¡ä¹‹é—´çš„é€šä¿¡å˜å¾—å®‰å…¨ã€å¿«é€Ÿå’Œå¯é çš„çš„åŸºç¡€è®¾æ–½ã€‚å¦‚æœä½ æ­£åœ¨åœ¨æ„å»ºä¸€ä¸ªäº‘åŸç”Ÿï¼ˆ Cloud Native ï¼‰åº”ç”¨ï¼Œé‚£ä¹ˆ Service Mesh æ˜¯ä½ éœ€è¦çš„ã€‚","tags":["ç¿»è¯‘","service mesh"],"title":"Service Meshæ˜¯ä»€ä¹ˆï¼Œæˆ‘ä»¬åˆä¸ºä»€ä¹ˆéœ€è¦å®ƒ","type":"post"},{"authors":["éƒ­æ—­ä¸œ"],"categories":["istio"],"content":" å‰è¨€ ä¹‹å‰ä»‹ç»äº† Istio å’Œ Service Mesh èƒ½ç»™æˆ‘ä»¬å¸¦æ¥ä»€ä¹ˆï¼Œæˆ‘ä»¬ä¸ºä»€ä¹ˆè¦ç”¨ Istio ï¼Œä½†å¤§å®¶å¯¹ Istio çš„è®¤è¯†å¯èƒ½è¿˜æ²¡æœ‰é‚£ä¹ˆæ·±åˆ»ã€‚æ­£å¦‚Linux çš„åˆ›å§‹äºº Linus Torvalds çš„é‚£å¥è¯ï¼šTalk is cheap. Show me the code. è¿™é‡Œæˆ‘ä»¬éƒ¨ç½²ä¸€ä¸ªdemoï¼Œç”±å››ä¸ªå•ç‹¬çš„å¾®æœåŠ¡æ„æˆï¼ˆæ³¨æ„è¿™é‡Œçš„å››ä¸ªå¾®æœåŠ¡æ˜¯ç”±ä¸åŒçš„è¯­è¨€ç¼–å†™çš„ï¼‰ï¼Œç”¨æ¥æ¼”ç¤ºå¤šç§ Istio ç‰¹æ€§ã€‚è¿™ä¸ªåº”ç”¨æ¨¡ä»¿åœ¨çº¿ä¹¦åº—çš„ä¸€ä¸ªåˆ†ç±»ï¼Œæ˜¾ç¤ºä¸€æœ¬ä¹¦çš„ä¿¡æ¯ã€‚é¡µé¢ä¸Šä¼šæ˜¾ç¤ºä¸€æœ¬ä¹¦çš„æè¿°ï¼Œä¹¦ç±çš„ç»†èŠ‚ï¼ˆISBNã€é¡µæ•°ç­‰ï¼‰ï¼Œä»¥åŠå…³äºè¿™æœ¬ä¹¦çš„ä¸€äº›è¯„è®ºã€‚\nBookinfo åº”ç”¨ Bookinfo åº”ç”¨åˆ†ä¸ºå››ä¸ªå•ç‹¬çš„å¾®æœåŠ¡ï¼š\n - ```details``` ï¼šè¿™ä¸ªå¾®æœåŠ¡åŒ…å«äº†ä¹¦ç±çš„ä¿¡æ¯ã€‚ - ```reviews``` ï¼šè¿™ä¸ªå¾®æœåŠ¡åŒ…å«äº†ä¹¦ç±ç›¸å…³çš„è¯„è®ºã€‚å®ƒè¿˜ä¼šè°ƒç”¨ ratings å¾®æœåŠ¡ã€‚ - ```ratings``` ï¼šratings å¾®æœåŠ¡ä¸­åŒ…å«äº†ç”±ä¹¦ç±è¯„ä»·ç»„æˆçš„è¯„çº§ä¿¡æ¯ã€‚ è¿™é‡Œä¸»è¦ä½¿ç”¨```reviews```æ¥æ¼”ç¤º Istio ç‰¹æ€§ï¼Œ```reviews``` å¾®æœåŠ¡æœ‰ 3 ä¸ªç‰ˆæœ¬ï¼š - v1 ç‰ˆæœ¬ä¸ä¼šè°ƒç”¨ ```ratings``` æœåŠ¡ã€‚ - v2 ç‰ˆæœ¬ä¼šè°ƒç”¨ ```ratings``` æœåŠ¡ï¼Œå¹¶ä½¿ç”¨ 1 åˆ° 5 ä¸ªé»‘è‰²æ˜Ÿå½¢å›¾æ ‡æ¥æ˜¾ç¤ºè¯„åˆ†ä¿¡æ¯ã€‚ - v3 ç‰ˆæœ¬ä¼šè°ƒç”¨ ```ratings``` æœåŠ¡ï¼Œå¹¶ä½¿ç”¨ 1 åˆ° 5 ä¸ªçº¢è‰²æ˜Ÿå½¢å›¾æ ‡æ¥æ˜¾ç¤ºè¯„åˆ†ä¿¡æ¯ã€‚ ä¸‹å›¾å±•ç¤ºäº†è¿™ä¸ªåº”ç”¨çš„ç«¯åˆ°ç«¯æ¶æ„ã€‚ ![Istio æ³¨å…¥ä¹‹å‰çš„ Bookinfo åº”ç”¨](https://istio.io/docs/examples/bookinfo/noistio.svg) \u0026lt;center\u0026gt;Istio æ³¨å…¥ä¹‹å‰çš„ Bookinfo åº”ç”¨\u0026lt;/center\u0026gt; Bookinfo æ˜¯ä¸€ä¸ªå¼‚æ„åº”ç”¨ï¼Œå‡ ä¸ªå¾®æœåŠ¡æ˜¯ç”±ä¸åŒçš„è¯­è¨€ç¼–å†™çš„ã€‚è¿™äº›æœåŠ¡å¯¹ Istio **å¹¶æ— ä¾èµ–**ï¼Œä½†æ˜¯æ„æˆäº†ä¸€ä¸ªæœ‰ä»£è¡¨æ€§çš„æœåŠ¡ç½‘æ ¼çš„ä¾‹å­ï¼šå®ƒç”±å¤šä¸ªæœåŠ¡ã€å¤šä¸ªè¯­è¨€æ„æˆï¼Œå¹¶ä¸” reviews æœåŠ¡å…·æœ‰å¤šä¸ªç‰ˆæœ¬ã€‚ ## éƒ¨ç½²åº”ç”¨ è¿™é‡Œ Istio çš„å®‰è£…éƒ¨ç½²å°±ä¸åœ¨èµ˜è¿°äº†ã€‚ å€¼å¾—æ³¨æ„çš„æ˜¯ï¼šå¦‚æœä½¿ç”¨çš„æ˜¯**é˜¿é‡Œäº‘**å®¹å™¨æœåŠ¡å®‰è£…çš„ Istio ï¼Œéœ€è¦åœ¨ ```å®¹å™¨æœåŠ¡```-```å¸‚åœº```-```åº”ç”¨ç›®å½•``` ä¸­é€‰æ‹© ```gateway``` è¿›è¡Œå®‰è£…ï¼Œè¿™é‡Œæä¾›äº†å¤šç§ ```gateway``` ï¼Œæˆ‘ä»¬é€‰æ‹© ```istio-ingressgateway```ï¼Œé€‰æ‹©ç›´æ¥å®‰è£…çš„è¯ä¼šé»˜è®¤åˆ›å»º ```LoadBalancer``` ç±»å‹çš„Serviceï¼Œä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªç»å…¸ç½‘ç»œSLBï¼Œè¿™é‡Œæ˜¯å¯ä»¥è°ƒæ•´çš„ï¼Œä¼šåœ¨åç»­çš„æ–‡ç« ä¸­è¿›è¡Œè¯¦ç»†è®²è§£ï¼Œè¿™é‡Œä¸åšèµ˜è¿°ã€‚ åœ¨ Istio ä¸­è¿è¡Œè¿™ä¸€åº”ç”¨ï¼Œæ— éœ€å¯¹åº”ç”¨è‡ªèº«åšå‡ºä»»ä½•æ”¹å˜ã€‚æˆ‘ä»¬åªè¦ç®€å•çš„åœ¨ Istio ç¯å¢ƒä¸­å¯¹æœåŠ¡è¿›è¡Œé…ç½®å’Œè¿è¡Œï¼Œå…·ä½“ä¸€ç‚¹è¯´å°±æ˜¯æŠŠ Envoy sidecar æ³¨å…¥åˆ°æ¯ä¸ªæœåŠ¡ä¹‹ä¸­ã€‚è¿™ä¸ªè¿‡ç¨‹æ‰€éœ€çš„å…·ä½“å‘½ä»¤å’Œé…ç½®æ–¹æ³•ç”±è¿è¡Œæ—¶ç¯å¢ƒå†³å®šï¼Œè€Œéƒ¨ç½²ç»“æœè¾ƒä¸ºä¸€è‡´ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š ![Bookinfo åº”ç”¨](https://istio.io/docs/examples/bookinfo/withistio.svg) \u0026lt;center\u0026gt;Bookinfo åº”ç”¨\u0026lt;/center\u0026gt; æ‰€æœ‰çš„å¾®æœåŠ¡éƒ½å’Œ Envoy sidecar é›†æˆåœ¨ä¸€èµ·ï¼Œè¢«é›†æˆæœåŠ¡æ‰€æœ‰çš„å‡ºå…¥æµé‡éƒ½è¢« sidecar æ‰€åŠ«æŒï¼Œè¿™æ ·å°±ä¸ºå¤–éƒ¨æ§åˆ¶å‡†å¤‡äº†æ‰€éœ€çš„ Hookï¼Œç„¶åå°±å¯ä»¥åˆ©ç”¨ Istio æ§åˆ¶å¹³é¢ä¸ºåº”ç”¨æä¾›æœåŠ¡è·¯ç”±ã€é¥æµ‹æ•°æ®æ”¶é›†ä»¥åŠç­–ç•¥å®æ–½ç­‰åŠŸèƒ½ã€‚ ### ä¸‹è½½å®‰è£… åˆ° GitHub ä¸­ istio çš„ [release](https://github.com/istio/istio/releases) ä¸­ä¸‹è½½ç›¸åº”ç‰ˆæœ¬çš„ istio åŒ…ï¼Œä¸‹è½½åå°† ```bin``` ç›®å½•é…ç½®åˆ°ç¯å¢ƒå˜é‡ ```PATH``` ä¸­ ```export PATH=\u0026quot;/istio/bin:$PATH\u0026quot;``` ï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ ```istio 1.0.5``` ç‰ˆæœ¬ Bookinfo è¿™ä¸ªåº”ç”¨å°±åœ¨ ```samples/```ç›®å½•ä¸‹ ## åœ¨ é˜¿é‡Œäº‘å®¹å™¨æœåŠ¡ï¼ˆkubernetesï¼‰ ä¸­è¿è¡Œ å¯åŠ¨åº”ç”¨å®¹å™¨ï¼Œè¿™é‡Œæä¾›ä¸¤ç§æ³¨å…¥æ–¹æ³•ï¼š**æ‰‹å·¥æ³¨å…¥**å’Œ**è‡ªåŠ¨æ³¨å…¥** - è‡ªåŠ¨æ³¨å…¥ éœ€è¦ä¿®æ”¹ namespace ï¼Œä¸ºå…¶æ·»åŠ  label æ ‡ç­¾ï¼Œè¿™æ ·æ‰€ä»¥åœ¨è¿™ä¸ª namespace ä¸­åˆ›å»ºçš„åº”ç”¨éƒ½ä¼šè¢«è‡ªåŠ¨æ³¨å…¥ sidecar  bash $ kubectl label namespace {inject-namespace} istio-injection=enabled $ kubectl apply -f samples/bookinfo/platform/kube/bookinfo.yaml\n - æ‰‹å·¥æ³¨å…¥ éœ€è¦ä½¿ç”¨ istioctl å‘½ä»¤ç”Ÿæˆæ³¨å…¥ååº”ç”¨çš„é…ç½®ï¼Œç„¶ååœ¨éƒ¨ç½²åº”ç”¨  bash $ istioctl kube-inject -f samples/bookinfo/platform/kube/bookinfo.yaml | kubectl apply -f -\n ç”±äºæ˜¯æµ‹è¯•ï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨æ‰‹å·¥æ³¨å…¥çš„æ–¹æ³•ã€‚ ä¸Šé¢çš„å‘½ä»¤ä¼šå¯åŠ¨å…¨éƒ¨çš„å››ä¸ªæœåŠ¡ï¼Œå…¶ä¸­ä¹ŸåŒ…æ‹¬äº† ```reviews``` æœåŠ¡çš„ä¸‰ä¸ªç‰ˆæœ¬ï¼ˆ```v1```ã€```v2``` ä»¥åŠ ```v3```ï¼‰  bash\n  $ istioctl kube-inject -f bookinfo.yaml | kubectl apply -f - service/details created deployment.extensions/details-v1 configured service/ratings created deployment.extensions/ratings-v1 created service/reviews created deployment.extensions/reviews-v1 created deployment.extensions/reviews-v2 created deployment.extensions/reviews-v3 created service/productpage created deployment.extensions/productpage-v1 created $ kubectl get po NAME READY STATUS RESTARTS AGE details-v1-8685d68cf9-8fwdb 2\u0026frasl;2 Running 0 1h productpage-v1-5fd9fddc97-tx88z 2\u0026frasl;2 Running 0 1h ratings-v1-7c4d756c55-cn76d 2\u0026frasl;2 Running 0 1h reviews-v1-5d868db586-w28q5 2\u0026frasl;2 Running 0 1h reviews-v2-787647c7d9-7sc52 2\u0026frasl;2 Running 0 1h reviews-v3-6964c86584-8728m 2\u0026frasl;2 Running 0 1h $ kubectl get svc NAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE details ClusterIP 10.11.224.17  9080/TCP 1h productpage ClusterIP 10.11.16.86  9080/TCP 1h ratings ClusterIP 10.11.244.59  9080/TCP 1h reviews ClusterIP 10.11.162.37  9080/TCP 1h\n å¯ä»¥çœ‹åˆ° Bookinfo åº”ç”¨å·²ç»æ­£å¸¸è¿è¡Œ ### æŒ‡å®š ingress å’Œ IP çš„ç«¯å£ 1. ä¸ºä¸ºåº”ç”¨ç¨‹åºå®šä¹‰å…¥å£ç½‘å…³ï¼š ```bash $ kubectl apply -f samples/bookinfo/networking/bookinfo-gateway.yaml ``` 2. ç¡®è®¤ç½‘å…³åˆ›å»ºå®Œæˆ ```bash $ kubectl get gateway NAME AGE bookinfo-gateway 1h ``` 3. å¿«é€ŸæŸ¥è¯¢è®¿é—®åœ°å€ï¼Œè¿™é‡Œçš„æ˜¯ä¹‹å‰åœ¨é˜¿é‡Œäº‘ä¸Šåˆ›å»ºçš„ ```LoadBalancer``` ç±»å‹çš„ Service ```bash $ kubectl get svc istio-ingressgateway -n istio-system NAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE istio-ingressgateway LoadBalancer 10.11.18.83 xxx.xxx.xxx.xxx 80:xxx/TCP,443:xxx/TCP 2h ``` ### æŸ¥çœ‹æ•ˆæœ è®¿é—® http://{EXTERNAL-IP}/productpage æ³¨æ„ï¼šè¿™é‡Œæœ€åä¸èƒ½æœ‰/ï¼Œå¦åˆ™å°†æ‰¾ä¸åˆ°é¡µé¢ ![image](http://wx4.sinaimg.cn/large/ad5fbf65ly1g1ad2jg6p3j21g90mxgo7.jpg) å¤šæ¬¡åˆ·æ–°æµè§ˆå™¨ï¼Œå°†åœ¨ ```productpage``` ä¸­çœ‹åˆ°è¯„è®ºçš„ä¸åŒçš„ç‰ˆæœ¬ï¼Œå®ƒä»¬ä¼šæŒ‰ç…§ round robinï¼ˆçº¢æ˜Ÿã€é»‘æ˜Ÿã€æ²¡æœ‰æ˜Ÿæ˜Ÿï¼‰çš„æ–¹å¼å±•ç°ï¼Œè¿™ä¸‰ä¸ªå±•ç¤ºåˆ†æ¥æ¥è‡ª```v1```ã€```v2```å’Œ```v3```ç‰ˆæœ¬ï¼Œå› ä¸ºè¿˜æ²¡æœ‰ä½¿ç”¨ Istio æ¥æ§åˆ¶ç‰ˆæœ¬çš„è·¯ç”±ï¼Œæ‰€ä»¥è¿™é‡Œæ˜¾ç¤ºçš„æ˜¯ä»¥è½®è¯¢çš„è´Ÿè½½å‡è¡¡ç®—æ³•è¿›è¡Œå±•ç¤ºã€‚ ### è¯·æ±‚è·¯ç”± BookInfoç¤ºä¾‹éƒ¨ç½²äº†ä¸‰ä¸ªç‰ˆæœ¬çš„reviewsæœåŠ¡ï¼Œå› æ­¤éœ€è¦è®¾ç½®ä¸€ä¸ªç¼ºçœè·¯ç”±ã€‚å¦åˆ™å½“å¤šæ¬¡è®¿é—®è¯¥åº”ç”¨ç¨‹åºæ—¶ï¼Œä¼šå‘ç°æœ‰æ—¶è¾“å‡ºä¼šåŒ…å«å¸¦æ˜Ÿçº§çš„è¯„ä»·å†…å®¹ï¼Œæœ‰æ—¶åˆæ²¡æœ‰ã€‚å‡ºç°è¯¥ç°è±¡çš„åŸå› æ˜¯å½“æ²¡æœ‰ä¸ºåº”ç”¨æ˜¾å¼æŒ‡å®šç¼ºçœè·¯ç”±æ—¶ï¼ŒIstioä¼šå°†è¯·æ±‚éšæœºè·¯ç”±åˆ°è¯¥æœåŠ¡çš„æ‰€æœ‰å¯ç”¨ç‰ˆæœ¬ä¸Šã€‚ åœ¨ä½¿ç”¨ Istio æ§åˆ¶ Bookinfo ç‰ˆæœ¬è·¯ç”±ä¹‹å‰ï¼Œä½ éœ€è¦åœ¨ç›®æ ‡è§„åˆ™ä¸­å®šä¹‰å¥½å¯ç”¨çš„ç‰ˆæœ¬ ã€‚ è¿è¡Œä»¥ä¸‹å‘½ä»¤ä¸º Bookinfo æœåŠ¡åˆ›å»ºçš„é»˜è®¤çš„ç›®æ ‡è§„åˆ™ï¼š - å¦‚æœä¸éœ€è¦å¯ç”¨åŒå‘TLSï¼Œè¯·æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š ```bash $ kubectl apply -f samples/bookinfo/networking/destination-rule-all.yaml ``` - å¦‚æœéœ€è¦å¯ç”¨åŒå‘ TLSï¼Œè¯·æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š ```bash $ kubectl apply -f samples/bookinfo/networking/destination-rule-all-mtls.yaml ``` ç­‰å¾…å‡ ç§’é’Ÿï¼Œç­‰å¾…ç›®æ ‡è§„åˆ™ç”Ÿæ•ˆã€‚ä½ å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹ç›®æ ‡è§„åˆ™ï¼š ```bash kubectl get destinationrules NAME AGE details 28s productpage 28s ratings 28s reviews 28s ``` ### å°†æ‰€æœ‰å¾®æœåŠ¡çš„ç¼ºçœç‰ˆæœ¬è®¾ç½®ä¸ºv1 é€šè¿‡è¿è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œå°†æ‰€æœ‰å¾®æœåŠ¡çš„ç¼ºçœç‰ˆæœ¬è®¾ç½®ä¸ºv1ï¼š  bash $ kubectl apply -f samples/bookinfo/networking/virtual-service-all-v1.yaml\n å¯ä»¥é€šè¿‡ä¸‹é¢çš„å‘½ä»¤æ¥æ˜¾ç¤ºæ‰€æœ‰å·²åˆ›å»ºçš„è·¯ç”±è§„åˆ™ï¼š  bash $ kubectl get virtualservices NAME AGE bookinfo 33m details 8s productpage 8s ratings 8s reviews 8s\n æ˜¾ç¤ºå·²åˆ›å»ºçš„è¯¦ç»†è·¯ç”±è§„åˆ’ï¼š  bash $ kubectl get virtualservices -o yaml\n ç”±äºè·¯ç”±è§„åˆ™æ˜¯é€šè¿‡å¼‚æ­¥æ–¹å¼åˆ†å‘åˆ°ä»£ç†çš„ï¼Œè¿‡ä¸€æ®µæ—¶é—´åè§„åˆ™æ‰ä¼šåŒæ­¥åˆ°æ‰€æœ‰podä¸Šã€‚å› æ­¤éœ€è¦ç­‰å‡ ç§’é’Ÿåå†å°è¯•è®¿é—®åº”ç”¨ã€‚ åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ Bookinfo åº”ç”¨ç¨‹åºçš„URL: http://{EXTERNAL-IP}/productpageã€‚ ![image](http://wx4.sinaimg.cn/large/ad5fbf65ly1g1adqyf9dej21g70oitbd.jpg) å¯ä»¥çœ‹åˆ° Bookinfo åº”ç”¨ç¨‹åºçš„ ```productpage``` é¡µé¢ï¼Œæ˜¾ç¤ºçš„å†…å®¹ä¸­ä¸åŒ…å«å¸¦æ˜Ÿçš„è¯„ä»·ä¿¡æ¯ï¼Œè¿™æ˜¯å› ä¸º ```reviews:v1``` æœåŠ¡ä¸ä¼šè®¿é—®ratingsæœåŠ¡ã€‚ ### å°†æ¥è‡ªç‰¹å®šç”¨æˆ·çš„è¯·æ±‚è·¯ç”±åˆ°reviews:v2 æœ¬ä¾‹ä¸­ï¼Œé¦–å…ˆä½¿ç”¨ Istio å°†100%çš„è¯·æ±‚æµé‡éƒ½è·¯ç”±åˆ°äº† Bookinfo æœåŠ¡çš„```v1```ç‰ˆæœ¬ï¼›ç„¶åå†è®¾ç½®äº†ä¸€æ¡è·¯ç”±è§„åˆ™ï¼Œè·¯ç”±è§„åˆ™åŸºäºè¯·æ±‚çš„ headerï¼ˆä¾‹å¦‚ä¸€ä¸ªç”¨æˆ·cookieï¼‰é€‰æ‹©æ€§åœ°å°†ç‰¹å®šçš„æµé‡è·¯ç”±åˆ°äº† ```reviews``` æœåŠ¡çš„```v2```ç‰ˆæœ¬ã€‚ é€šè¿‡è¿è¡Œå¦‚ä¸‹å‘½ä»¤ï¼ŒæŠŠæ¥è‡ªæµ‹è¯•ç”¨æˆ·\u0026quot;jason\u0026quot;çš„è¯·æ±‚è·¯ç”±åˆ° ```reviews:v2 ```ï¼Œä»¥å¯ç”¨ratingsæœåŠ¡ã€‚  bash $ kubectl apply -f samples/bookinfo/networking/virtual-service-reviews-test-v2.yaml\n é€šè¿‡å¦‚ä¸‹å‘½ä»¤ç¡®è®¤è§„åˆ™æ˜¯å¦åˆ›å»ºï¼š  bash $ kubectl get virtualservice reviews -o yaml apiVersion: networking.istio.io/v1alpha3 kind: VirtualService metadata: annotations: kubectl.kubernetes.io/last-applied-configuration: | {\u0026ldquo;apiVersion\u0026rdquo;:\u0026ldquo;networking.istio.io/v1alpha3\u0026rdquo;,\u0026ldquo;kind\u0026rdquo;:\u0026ldquo;VirtualService\u0026rdquo;,\u0026ldquo;metadata\u0026rdquo;:{\u0026ldquo;annotations\u0026rdquo;:{},\u0026ldquo;name\u0026rdquo;:\u0026ldquo;reviews\u0026rdquo;,\u0026ldquo;namespace\u0026rdquo;:\u0026ldquo;default\u0026rdquo;},\u0026ldquo;spec\u0026rdquo;:{\u0026ldquo;hosts\u0026rdquo;:[\u0026ldquo;reviews\u0026rdquo;],\u0026ldquo;http\u0026rdquo;:[{\u0026ldquo;match\u0026rdquo;:[{\u0026ldquo;headers\u0026rdquo;:{\u0026ldquo;end-user\u0026rdquo;:{\u0026ldquo;exact\u0026rdquo;:\u0026ldquo;jason\u0026rdquo;}}}],\u0026ldquo;route\u0026rdquo;:[{\u0026ldquo;destination\u0026rdquo;:{\u0026ldquo;host\u0026rdquo;:\u0026ldquo;reviews\u0026rdquo;,\u0026ldquo;subset\u0026rdquo;:\u0026ldquo;v2\u0026rdquo;}}]},{\u0026ldquo;route\u0026rdquo;:[{\u0026ldquo;destination\u0026rdquo;:{\u0026ldquo;host\u0026rdquo;:\u0026ldquo;reviews\u0026rdquo;,\u0026ldquo;subset\u0026rdquo;:\u0026ldquo;v1\u0026rdquo;}}]}]}} creationTimestamp: \u0026ldquo;2019-03-21T06:01:10Z\u0026rdquo; generation: 1 name: reviews namespace: default resourceVersion: \u0026ldquo;62486214\u0026rdquo; selfLink: /apis/networking.istio.io/v1alpha3/namespaces/default/virtualservices/reviews uid: b9e41681-4b9e-11e9-a679-00163e045478 spec: hosts: - reviews http: - match: - headers: end-user: exact: jason route: - destination: host: reviews subset: v2 - route: - destination: host: reviews subset: v1\n ç¡®è®¤è§„åˆ™å·²åˆ›å»ºä¹‹åï¼Œåœ¨æµè§ˆå™¨ä¸­æ‰“å¼€BookInfoåº”ç”¨ç¨‹åºçš„URL: http://{EXTERNAL-IP}/productpageã€‚ ä»¥\u0026quot;jason\u0026quot;ç”¨æˆ·ç™»å½• ```productpage``` é¡µé¢ï¼Œæ‚¨å¯ä»¥åœ¨æ¯æ¡è¯„ä»·åé¢çœ‹åˆ°æ˜Ÿçº§ä¿¡æ¯ã€‚ è¿™é‡Œç™»å½•ç”¨æˆ·åä¸º ```jason``` ï¼Œå¯†ç éšä¾¿è¾“å…¥å³å¯ ![image](http://wx4.sinaimg.cn/large/ad5fbf65ly1g1adtjugp3j21gb0iygoa.jpg) ### æµé‡è½¬ç§» é™¤äº†åŸºäºå†…å®¹çš„è·¯ç”±ï¼ŒIstioè¿˜æ”¯æŒåŸºäºæƒé‡çš„è·¯ç”±è§„åˆ™ã€‚ é¦–å…ˆï¼Œå°†æ‰€æœ‰å¾®æœåŠ¡çš„ç¼ºçœç‰ˆæœ¬è®¾ç½®ä¸ºv1ï¼š  bash $ kubectl replace -f samples/bookinfo/networking/virtual-service-all-v1.yaml\n å…¶æ¬¡ï¼Œä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤æŠŠ50%çš„æµé‡ä»reviews:v1è½¬ç§»åˆ°reviews:v3:  bash $ kubectl replace -f samples/bookinfo/networking/virtual-service-reviews-50-v3.yaml\n åœ¨æµè§ˆå™¨ä¸­å¤šæ¬¡åˆ·æ–°productpageé¡µé¢ï¼Œå¤§çº¦æœ‰50%çš„å‡ ç‡ä¼šçœ‹åˆ°é¡µé¢ä¸­å‡ºç°å¸¦çº¢æ˜Ÿçš„è¯„ä»·å†…å®¹ã€‚ è¯´æ˜ï¼š æ³¨æ„è¯¥æ–¹å¼å’Œä½¿ç”¨å®¹å™¨ç¼–æ’å¹³å°çš„éƒ¨ç½²ç‰¹æ€§æ¥è¿›è¡Œç‰ˆæœ¬è¿ç§»æ˜¯å®Œå…¨ä¸åŒçš„ã€‚å®¹å™¨ç¼–æ’å¹³å°ä½¿ç”¨äº†å®ä¾‹scalingæ¥å¯¹æµé‡è¿›è¡Œç®¡ç†ã€‚è€Œé€šè¿‡Istioï¼Œä¸¤ä¸ªç‰ˆæœ¬çš„reviewsæœåŠ¡å¯ä»¥ç‹¬ç«‹åœ°è¿›è¡Œæ‰©å®¹å’Œç¼©å®¹ï¼Œå¹¶ä¸ä¼šå½±å“è¿™ä¸¤ä¸ªç‰ˆæœ¬æœåŠ¡ä¹‹é—´çš„æµé‡åˆ†å‘ã€‚ å¦‚æœè§‰å¾— ```reviewsï¼šv3``` å¾®æœåŠ¡å·²ç»ç¨³å®šï¼Œä½ å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤ï¼Œ å°† ```virtual service``` 100ï¼…çš„æµé‡è·¯ç”±åˆ° ```reviewsï¼šv3```ï¼Œä»è€Œå®ç°ä¸€ä¸ªç°åº¦å‘å¸ƒçš„åŠŸèƒ½ã€‚  bash $ kubectl replace -f samples/bookinfo/networking/virtual-service-reviews-v3.yaml ```\nåœ¨åä¸ºäº‘ï¼ˆCCEï¼‰ä¸Šè¿è¡Œ åä¸ºäº‘ç‡å…ˆå°† Istio ä½œä¸ºäº§å“æŠ•å…¥åˆ°å…¬æœ‰äº‘ä¸­è¿›è¡Œå•†ä¸šåº”ç”¨ï¼Œå¼€é€šæ–¹å¼ååˆ†ç®€å•ï¼Œåªè¦åœ¨åä¸ºäº‘CCEä¸Šåˆ›å»ºé›†ç¾¤ï¼Œç„¶åç”³è¯· Istio å…¬æµ‹å³å¯ã€‚\nä¸ºäº†æ–¹ä¾¿æµ‹è¯• Bookinfo åº”ç”¨åœ¨åä¸ºäº‘ä¸Šæä¾›äº†ä¸€é”®ä½“éªŒåº”ç”¨ï¼Œç‚¹å‡»å³å¯çœå»åˆšåˆšé‚£ä¸€ç³»åˆ—çš„ kubectl æ“ä½œ\nä¸€é”®åˆ›å»ºä½“éªŒåº”ç”¨\nç‚¹å‡»ç°åº¦å‘å¸ƒå³å¯\nåˆ›å»ºé‡‘ä¸é›€å‘å¸ƒ\né€‰æ‹©ç°åº¦å‘å¸ƒçš„ç»„ä»¶\nå¡«å†™ç‰ˆæœ¬å·\né€‰æ‹©é•œåƒç‰ˆæœ¬\nç‰ˆæœ¬åˆ›å»ºå®Œæˆåé…ç½®ç°åº¦ç­–ç•¥\né€‰æ‹©ç›¸åº”ç­–ç•¥ï¼Œç­–ç•¥ä¸‹å‘å³å¯\næ€»çš„æ¥è¯´ï¼Œåä¸ºäº‘çš„ Istio ç¡®å®å·²ç»æ˜¯å•†ä¸šåŒ–åº”ç”¨ï¼Œè¿™é‡Œåªæ˜¯å±•ç¤ºäº†éƒ¨åˆ†ç°åº¦å‘å¸ƒçš„åŠŸèƒ½ã€‚å…¶ä»–æ¯”å¦‚æµé‡æ²»ç†ï¼Œæµé‡ç›‘æ§ç­‰åŠŸèƒ½è¿˜æ²¡å±•ç¤ºï¼Œè¿™äº›åŠŸèƒ½åšçš„ååˆ†ç»†è‡´ï¼Œå€¼å¾—å°è¯•ã€‚\nå‚è€ƒ åœ¨Kubernetesä¸ŠåŸºäºIstioå®ç°Service Meshæ™ºèƒ½è·¯ç”±\nåŸºäºISTIOæœåŠ¡ç½‘æ ¼çš„ç°åº¦å‘å¸ƒ\n","date":1553132538,"expirydate":-62135596800,"kind":"page","lang":"zh","lastmod":1553132538,"objectID":"895c4b9783d98e5b4153fd4e54b471b3","permalink":"https://guoxudong.io/post/istio-bookinfo-demo/","publishdate":"2019-03-21T09:42:18+08:00","relpermalink":"/post/istio-bookinfo-demo/","section":"post","summary":"æ­£å¦‚Linux çš„åˆ›å§‹äºº Linus Torvalds çš„é‚£å¥è¯ï¼šTalk is cheap. Show me the code. è¿™é‡Œæˆ‘ä»¬éƒ¨ç½²ä¸€ä¸ªdemoï¼Œç”±å››ä¸ªå•ç‹¬çš„å¾®æœåŠ¡æ„æˆï¼ˆæ³¨æ„è¿™é‡Œçš„å››ä¸ªå¾®æœåŠ¡æ˜¯ç”±ä¸åŒçš„è¯­è¨€ç¼–å†™çš„ï¼‰ï¼Œç”¨æ¥æ¼”ç¤ºå¤šç§ Istio ç‰¹æ€§ã€‚","tags":["istio","service mesh","é˜¿é‡Œäº‘","åä¸ºäº‘"],"title":"Istioåˆæ¢ä¹‹Bookinfoæ ·ä¾‹éƒ¨ç½²","type":"post"},{"authors":["éƒ­æ—­ä¸œ"],"categories":["istio"],"content":" å‰è¨€  å…¬å¸äº18å¹´10æœˆæ­£å¼ç¡®è®¤æœåŠ¡å®¹å™¨åŒ–ï¼Œåˆ°18å¹´12æœˆ4æ—¥ç¬¬ä¸€ä¸ªæœåŠ¡æ­£å¼éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒkubernetesé›†ç¾¤ï¼Œå†åˆ°å¦‚ä»Šå·²æœ‰23ä¸ªæœåŠ¡å®Œæˆäº†ç”Ÿäº§ç¯å¢ƒå®¹å™¨åŒ–çš„åˆ‡æ¢ï¼Œæ›´å¤šçš„æœåŠ¡åœ¨æµ‹è¯•ç¯å¢ƒå®¹å™¨åŒ–éƒ¨ç½²éšæ—¶å¯ä»¥åˆ‡æ¢åˆ°ç”Ÿäº§ç¯å¢ƒã€‚ç›®å‰æ–°é¡¹ç›®çš„å¼€å‘ï¼Œå¤§éƒ¨åˆ†éƒ½ç›´æ¥åœ¨æµ‹è¯•ç¯å¢ƒå®¹å™¨åŒ–éƒ¨ç½²ï¼Œä¸å†éœ€è¦æ–°è´­ECSæ­å»ºæµ‹è¯•ç¯å¢ƒã€‚éšç€å®¹å™¨åŒ–çš„æ·±å…¥ï¼ŒæœåŠ¡é—´çš„é€šä¿¡å’Œè”ç³»å˜çš„æ›´åŠ å¤æ‚ï¼Œå…¶ä¸­é€šä¿¡çš„å¯è§†åŒ–ã€æµé‡çš„æ§åˆ¶å’ŒæœåŠ¡è´¨é‡çš„è¯„ä¼°é—®é¢˜æ—¥ç›Šå‡¸æ˜¾ï¼Œæˆä¸ºäº†å¾®æœåŠ¡æ–¹æ¡ˆçš„çŸ­æ¿ã€‚è¿™ä¸ªæ—¶å€™Service meshå°±è¿›å…¥äº†æˆ‘ä»¬çš„è§†é‡ã€‚\nService meshæ˜¯ä»€ä¹ˆ **è¿™é‡Œæ³¨æ„ï¼š**```istio```åªæ˜¯```Service mesh```æœåŠ¡ç½‘æ ¼çš„ä¸€ç§ã€‚ ### æœåŠ¡ç½‘æ ¼çš„ç‰¹ç‚¹ æœåŠ¡ç½‘æ ¼æœ‰å¦‚ä¸‹å‡ ä¸ªç‰¹ç‚¹ï¼š - åº”ç”¨ç¨‹åºé—´é€šè®¯çš„ä¸­é—´å±‚ - è½»é‡çº§ç½‘ç»œä»£ç† - åº”ç”¨ç¨‹åºæ— æ„ŸçŸ¥ - è§£è€¦åº”ç”¨ç¨‹åºçš„é‡è¯•/è¶…æ—¶ã€ç›‘æ§ã€è¿½è¸ªå’ŒæœåŠ¡å‘ç° ç›®å‰ä¸¤æ¬¾æµè¡Œçš„æœåŠ¡ç½‘æ ¼å¼€æºè½¯ä»¶ [Linkerd](https://linkerd.io) å’Œ [Istio](https://Istio.io) éƒ½å¯ä»¥ç›´æ¥åœ¨ Kubernetes ä¸­é›†æˆï¼Œå…¶ä¸­ Linkerd å·²ç»æˆä¸º CNCF æˆå‘˜ï¼ŒIstio åœ¨ 2018å¹´7æœˆ31æ—¥å®£å¸ƒ [1.0](https://istio.io/zh/blog/2018/announcing-1.0/)ã€‚ ### æœåŠ¡ç½‘æ ¼çš„å‘å±•å†å² * Spring Cloud Spring Cloud è¯ç”Ÿäº2015å¹´ï¼ŒSpring Cloud æœ€æ—©åœ¨åŠŸèƒ½å±‚é¢ä¸ºå¾®æœåŠ¡æ²»ç†å®šä¹‰äº†ä¸€ç³»åˆ—æ ‡å‡†ç‰¹æ€§ï¼Œæ¯”å¦‚ï¼šæ™ºèƒ½è·¯ç”±ã€æœåŠ¡ç†”æ–­ã€æœåŠ¡æ³¨å†Œäºå‘ç°ç­‰è¿™äº›åè¯æˆ‘æœ€æ—©çœ‹åˆ°éƒ½æ˜¯åœ¨ Sprint Cloud ç›¸å…³æ–‡ç« ä¸­ã€‚åŒæ—¶ä¹Ÿæœ‰ä¸€äº›ç¼ºç‚¹ï¼Œæ¯”å¦‚ï¼šéœ€è¦åœ¨ä»£ç çº§åˆ«å¯¹è¯¸å¤šç»„ä»¶è¿›è¡Œæ§åˆ¶ï¼Œå¹¶ä¸”éƒ½ä¾èµ–äº Java çš„å®ç°ï¼Œè¿™ä¸å¾®æœåŠ¡çš„å¤šè¯­è¨€åä½œèƒŒé“è€Œé©°ï¼›æ²¡æœ‰å¯¹èµ„æºçš„è°ƒåº¦ã€devopsç­‰æä¾›ç›¸å…³æ”¯æŒï¼Œéœ€è¦å€ŸåŠ©å¹³å°æ¥å®Œæˆï¼›ä¼—æ‰€å‘¨çŸ¥çš„Eurekaé—­æºç­‰ã€‚ * Linkerd Service mesh è¿™ä¸ªå‘½åå°±æ˜¯æ¥æºäºLinkerdã€‚Linkerd å¾ˆå¥½åœ°ç»“åˆäº† kubernetes æ‰€æä¾›çš„åŠŸèƒ½ï¼Œäº2017å¹´åŠ å…¥CNCFã€‚ * Istio 2017å¹´5æœˆï¼Œ Googleã€ IBM å’Œ Lyft å®£å¸ƒäº†Istioçš„è¯ç”Ÿã€‚ä¸€ç»å‘å¸ƒï¼Œä¾¿ç«‹å³è·å¾—Red Hatã€F5ç­‰å¤§å‚å“åº”ï¼Œç¤¾åŒºæ´»è·ƒåº¦é«˜æ¶¨ï¼Œå¾ˆå¿«è¶…è¶Šäº† Linkerdï¼Œæˆä¸ºäº† Service mesh çš„ä»£è¡¨äº§å“ã€‚ * å›½å†…æœåŠ¡ç½‘æ ¼ è¿™é‡Œä¸å¾—ä¸æçš„æ˜¯å›½å†…æœåŠ¡ç½‘æ ¼çš„å…´èµ·ï¼Œåœ¨ Service mesh æ¦‚å¿µå…·ä½“å®šä¹‰ä»¥å‰ï¼Œå›½å†…çš„è®¸å¤šå‚å•†å°±å·²ç»å¼€å§‹äº†å¾®æœåŠ¡è¿›ç¨‹ï¼ŒåŒæ—¶åœ¨åšè‡ªå·±çš„å¾®æœåŠ¡æ²»ç†äº§å“ã€‚è€Œåœ¨ Service mesh æ¦‚å¿µæ™®åŠä¹‹åï¼Œå‚å•†æ„è¯†åˆ°äº†è‡ªå·±äº§å“ä¹Ÿå…·æœ‰ Service mesh çš„ç‰¹ç‚¹ï¼Œå°†è‡ªå·±çš„æœåŠ¡æ²»ç†å¹³å°è¿›è¡Œäº†æ”¹é€ å’Œå®Œå–„ï¼Œæ¨å‡ºäº†è‡ªå·±çš„ Service mesh äº§å“ã€‚ä¾‹å¦‚ï¼Œå¾®åšã€è…¾è®¯å’Œåä¸ºéƒ½æœ‰è‡ªå·±çš„æœåŠ¡ç½‘æ ¼äº§å“ï¼Œåä¸ºæ›´æ˜¯å·²ç»å°†äº§å“æŠ•å…¥åˆ°å…¬æœ‰äº‘ä¸­è¿›è¡Œå•†ä¸šåº”ç”¨ã€‚èš‚èšé‡‘æœçš„ SOFAMesh åˆ™æ˜¯é’ˆå¯¹å¤§æµé‡çš„ç”Ÿäº§åœºæ™¯ï¼Œåœ¨ Istio çš„æ¶æ„åŸºç¡€ä¸Šè¿›è¡Œä¿®æ”¹å¹¶æ¨å¹¿ã€‚ ## Istioåˆæ˜¯ä»€ä¹ˆ  Istio``` æä¾›äº†ä¸€ä¸ªå®Œæ•´çš„è§£å†³æ–¹æ¡ˆï¼Œé€šè¿‡ä¸ºæ•´ä¸ªæœåŠ¡ç½‘æ ¼æä¾›è¡Œä¸ºæ´å¯Ÿå’Œæ“ä½œæ§åˆ¶æ¥æ»¡è¶³å¾®æœåŠ¡åº”ç”¨ç¨‹åºçš„å¤šæ ·åŒ–éœ€æ±‚ã€‚Istio å…è®¸æ‚¨è¿æ¥ã€ä¿æŠ¤ã€æ§åˆ¶å’Œè§‚æµ‹æœåŠ¡ã€‚åœ¨è¾ƒé«˜çš„å±‚æ¬¡ä¸Šï¼ŒIstio æœ‰åŠ©äºé™ä½è¿™äº›éƒ¨ç½²çš„å¤æ‚æ€§ï¼Œå¹¶å‡è½»å¼€å‘å›¢é˜Ÿçš„å‹åŠ›ã€‚å®ƒæ˜¯ä¸€ä¸ªå®Œå…¨å¼€æºçš„æœåŠ¡ç½‘æ ¼ï¼Œå¯ä»¥é€æ˜åœ°åˆ†å±‚åˆ°ç°æœ‰çš„åˆ†å¸ƒå¼åº”ç”¨ç¨‹åºä¸Šã€‚å®ƒä¹Ÿæ˜¯ä¸€ä¸ªå¹³å°ï¼ŒåŒ…æ‹¬å…è®¸å®ƒé›†æˆåˆ°ä»»ä½•æ—¥å¿—è®°å½•å¹³å°ã€é¥æµ‹æˆ–ç­–ç•¥ç³»ç»Ÿçš„ APIã€‚Istio çš„å¤šæ ·åŒ–åŠŸèƒ½é›†ä½¿æ‚¨èƒ½å¤ŸæˆåŠŸé«˜æ•ˆåœ°è¿è¡Œåˆ†å¸ƒå¼å¾®æœåŠ¡æ¶æ„ï¼Œå¹¶æä¾›ä¿æŠ¤ã€è¿æ¥å’Œç›‘æ§å¾®æœåŠ¡çš„ç»Ÿä¸€æ–¹æ³•ã€‚\nIstioçš„æ¶æ„ Istioæ€»çš„æ¥è¯´ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼šæ§åˆ¶å¹³é¢å’Œæ•°æ®å¹³é¢\n  æ•°æ®å¹³é¢ç”±ä¸€ç»„ä»¥ sidecar æ–¹å¼éƒ¨ç½²çš„æ™ºèƒ½ä»£ç†ï¼ˆEnvoyï¼‰ç»„æˆã€‚sidecaré€šè¿‡æ³¨å…¥çš„æ–¹å¼å’Œä¸šåŠ¡å®¹å™¨å…±å­˜äºä¸€ä¸ª Pod ä¸­ï¼Œä¼šåŠ«ä¸šåŠ¡å®¹å™¨çš„æµé‡ï¼Œæ¥å—æ§åˆ¶é¢ç»„ä»¶çš„æ§åˆ¶ï¼Œå¯ä»¥è°ƒèŠ‚å’Œæ§åˆ¶å¾®æœåŠ¡åŠ Mixer ä¹‹é—´æ‰€æœ‰çš„ç½‘ç»œé€šä¿¡ã€‚ æ§åˆ¶å¹³é¢æ˜¯ Istio çš„æ ¸å¿ƒï¼Œè´Ÿè´£ç®¡ç†å’Œé…ç½®ä»£ç†æ¥è·¯ç”±æµé‡ã€‚æ­¤å¤–æ§åˆ¶å¹³é¢é…ç½® Mixer ä»¥å®æ–½ç­–ç•¥å’Œæ”¶é›†é¥æµ‹æ•°æ®ã€‚  ä¸‹å›¾æ˜¾ç¤ºäº†æ„æˆæ¯ä¸ªé¢æ¿çš„ä¸åŒç»„ä»¶ï¼š å›¾ç‰‡ä¸ºåŸåˆ›ï¼Œè½¬è½½è¯·æ ‡è®°å‡ºå¤„https://blog.maoxianplay.com/\nEnvoy Istio ä½¿ç”¨ Envoy ä»£ç†çš„æ‰©å±•ç‰ˆæœ¬ï¼ŒEnvoy æ˜¯ä»¥ C++ å¼€å‘çš„é«˜æ€§èƒ½ä»£ç†ï¼Œç”¨äºè°ƒè§£æœåŠ¡ç½‘æ ¼ä¸­æ‰€æœ‰æœåŠ¡çš„æ‰€æœ‰å…¥ç«™å’Œå‡ºç«™æµé‡ã€‚Envoy çš„è®¸å¤šå†…ç½®åŠŸèƒ½è¢« Istio å‘æ‰¬å…‰å¤§ï¼Œä¾‹å¦‚ï¼š\n åŠ¨æ€æœåŠ¡å‘ç° è´Ÿè½½å‡è¡¡ TLS ç»ˆæ­¢ HTTP/2 \u0026amp; gRPC ä»£ç† ç†”æ–­å™¨ å¥åº·æ£€æŸ¥ã€åŸºäºç™¾åˆ†æ¯”æµé‡æ‹†åˆ†çš„ç°åº¦å‘å¸ƒ æ•…éšœæ³¨å…¥ ä¸°å¯Œçš„åº¦é‡æŒ‡æ ‡  Envoy è¢«éƒ¨ç½²ä¸º sidecarï¼Œå’Œå¯¹åº”æœåŠ¡åœ¨åŒä¸€ä¸ª Kubernetes pod ä¸­ã€‚è¿™å…è®¸ Istio å°†å¤§é‡å…³äºæµé‡è¡Œä¸ºçš„ä¿¡å·ä½œä¸ºå±æ€§æå–å‡ºæ¥ï¼Œè€Œè¿™äº›å±æ€§åˆå¯ä»¥åœ¨ Mixer ä¸­ç”¨äºæ‰§è¡Œç­–ç•¥å†³ç­–ï¼Œå¹¶å‘é€ç»™ç›‘æ§ç³»ç»Ÿï¼Œä»¥æä¾›æ•´ä¸ªç½‘æ ¼è¡Œä¸ºçš„ä¿¡æ¯ã€‚\nSidecar ä»£ç†æ¨¡å‹è¿˜å¯ä»¥å°† Istio çš„åŠŸèƒ½æ·»åŠ åˆ°ç°æœ‰éƒ¨ç½²ä¸­ï¼Œè€Œæ— éœ€é‡æ–°æ„å»ºæˆ–é‡å†™ä»£ç ã€‚å¯ä»¥é˜…è¯»æ›´å¤šæ¥äº†è§£ä¸ºä»€ä¹ˆæˆ‘ä»¬åœ¨è®¾è®¡ç›®æ ‡ä¸­é€‰æ‹©è¿™ç§æ–¹å¼ã€‚\nMixer Mixer æ˜¯ä¸€ä¸ªç‹¬ç«‹äºå¹³å°çš„ç»„ä»¶ï¼Œè´Ÿè´£åœ¨æœåŠ¡ç½‘æ ¼ä¸Šæ‰§è¡Œè®¿é—®æ§åˆ¶å’Œä½¿ç”¨ç­–ç•¥ï¼Œå¹¶ä» Envoy ä»£ç†å’Œå…¶ä»–æœåŠ¡æ”¶é›†é¥æµ‹æ•°æ®ã€‚ä»£ç†æå–è¯·æ±‚çº§å±æ€§ï¼Œå‘é€åˆ° Mixer è¿›è¡Œè¯„ä¼°ã€‚\nMixer ä¸­åŒ…æ‹¬ä¸€ä¸ªçµæ´»çš„æ’ä»¶æ¨¡å‹ï¼Œä½¿å…¶èƒ½å¤Ÿæ¥å…¥åˆ°å„ç§ä¸»æœºç¯å¢ƒå’ŒåŸºç¡€è®¾æ–½åç«¯ï¼Œä»è¿™äº›ç»†èŠ‚ä¸­æŠ½è±¡å‡º Envoy ä»£ç†å’Œ Istio ç®¡ç†çš„æœåŠ¡ã€‚\nPilot Pilot ä¸º Envoy sidecar æä¾›æœåŠ¡å‘ç°åŠŸèƒ½ï¼Œä¸ºæ™ºèƒ½è·¯ç”±ï¼ˆä¾‹å¦‚ A/B æµ‹è¯•ã€é‡‘ä¸é›€éƒ¨ç½²ç­‰ï¼‰å’Œå¼¹æ€§ï¼ˆè¶…æ—¶ã€é‡è¯•ã€ç†”æ–­å™¨ç­‰ï¼‰æä¾›æµé‡ç®¡ç†åŠŸèƒ½ã€‚å®ƒå°†æ§åˆ¶æµé‡è¡Œä¸ºçš„é«˜çº§è·¯ç”±è§„åˆ™è½¬æ¢ä¸ºç‰¹å®šäº Envoy çš„é…ç½®ï¼Œå¹¶åœ¨è¿è¡Œæ—¶å°†å®ƒä»¬ä¼ æ’­åˆ° sidecarã€‚\nPilot å°†å¹³å°ç‰¹å®šçš„æœåŠ¡å‘ç°æœºåˆ¶æŠ½è±¡åŒ–å¹¶å°†å…¶åˆæˆä¸ºç¬¦åˆ Envoy æ•°æ®å¹³é¢ API çš„ä»»ä½• sidecar éƒ½å¯ä»¥ä½¿ç”¨çš„æ ‡å‡†æ ¼å¼ã€‚è¿™ç§æ¾æ•£è€¦åˆä½¿å¾— Istio èƒ½å¤Ÿåœ¨å¤šç§ç¯å¢ƒä¸‹è¿è¡Œï¼ˆä¾‹å¦‚ï¼ŒKubernetesã€Consulã€Nomadï¼‰ï¼ŒåŒæ—¶ä¿æŒç”¨äºæµé‡ç®¡ç†çš„ç›¸åŒæ“ä½œç•Œé¢ã€‚\nCitadel Citadel é€šè¿‡å†…ç½®èº«ä»½å’Œå‡­è¯ç®¡ç†èµ‹èƒ½å¼ºå¤§çš„æœåŠ¡é—´å’Œæœ€ç»ˆç”¨æˆ·èº«ä»½éªŒè¯ã€‚å¯ç”¨äºå‡çº§æœåŠ¡ç½‘æ ¼ä¸­æœªåŠ å¯†çš„æµé‡ï¼Œå¹¶ä¸ºè¿ç»´äººå‘˜æä¾›åŸºäºæœåŠ¡æ ‡è¯†è€Œä¸æ˜¯ç½‘ç»œæ§åˆ¶çš„å¼ºåˆ¶æ‰§è¡Œç­–ç•¥çš„èƒ½åŠ›ã€‚ä» 0.5 ç‰ˆæœ¬å¼€å§‹ï¼ŒIstio æ”¯æŒåŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ï¼Œä»¥æ§åˆ¶è°å¯ä»¥è®¿é—®æ‚¨çš„æœåŠ¡ï¼Œè€Œä¸æ˜¯åŸºäºä¸ç¨³å®šçš„ä¸‰å±‚æˆ–å››å±‚ç½‘ç»œæ ‡è¯†ã€‚\nGalley(1.1ç‰ˆæœ¬æ–°å¢) Galley ä»£è¡¨å…¶ä»–çš„ Istio æ§åˆ¶å¹³é¢ç»„ä»¶ï¼Œç”¨æ¥éªŒè¯ç”¨æˆ·ç¼–å†™çš„ Istio API é…ç½®ã€‚éšç€æ—¶é—´çš„æ¨ç§»ï¼ŒGalley å°†æ¥ç®¡ Istio è·å–é…ç½®ã€ å¤„ç†å’Œåˆ†é…ç»„ä»¶çš„é¡¶çº§è´£ä»»ã€‚å®ƒå°†è´Ÿè´£å°†å…¶ä»–çš„ Istio ç»„ä»¶ä¸ä»åº•å±‚å¹³å°ï¼ˆä¾‹å¦‚ Kubernetesï¼‰è·å–ç”¨æˆ·é…ç½®çš„ç»†èŠ‚ä¸­éš”ç¦»å¼€æ¥ã€‚\nç»“è¯­ åœ¨äº‘åŸç”Ÿæ¶æ„ä¸‹ï¼Œå®¹å™¨çš„ä½¿ç”¨ç»™äºˆäº†å¼‚æ„åº”ç”¨ç¨‹åºçš„æ›´å¤šå¯è¡Œæ€§ï¼ŒKubernetes å¢å¼ºäº†åº”ç”¨çš„æ¨ªå‘æ‰©å®¹èƒ½åŠ›ï¼Œç”¨æˆ·å¯ä»¥å¿«é€Ÿçš„ç¼–æ’å‡ºå¤æ‚ç¯å¢ƒã€å¤æ‚ä¾èµ–å…³ç³»çš„åº”ç”¨ç¨‹åºï¼ŒIstioå¯ä»¥ä½¿å¼€å‘è€…åˆæ— é¡»è¿‡åˆ†å…³å¿ƒåº”ç”¨ç¨‹åºçš„ç›‘æ§ã€æ‰©å±•æ€§ã€æœåŠ¡å‘ç°å’Œåˆ†å¸ƒå¼è¿½è¸ªè¿™äº›ç¹ççš„äº‹æƒ…è€Œä¸“æ³¨äºç¨‹åºå¼€å‘ï¼Œèµ‹äºˆå¼€å‘è€…æ›´å¤šçš„åˆ›é€ æ€§ã€‚\nå‚è€ƒ  Istio å®˜æ–¹æ–‡æ¡£ - istio.io ã€Šæ·±å…¥æµ…å‡ºistioã€‹  ","date":1553044348,"expirydate":-62135596800,"kind":"page","lang":"zh","lastmod":1553044348,"objectID":"97d5b460929f3318418cbd4a948da365","permalink":"https://guoxudong.io/post/istio-share/","publishdate":"2019-03-20T09:12:28+08:00","relpermalink":"/post/istio-share/","section":"post","summary":"åœ¨äº‘åŸç”Ÿæ¶æ„ä¸‹ï¼Œå®¹å™¨çš„ä½¿ç”¨ç»™äºˆäº†å¼‚æ„åº”ç”¨ç¨‹åºçš„æ›´å¤šå¯è¡Œæ€§ï¼ŒKubernetes å¢å¼ºäº†åº”ç”¨çš„æ¨ªå‘æ‰©å®¹èƒ½åŠ›ï¼Œç”¨æˆ·å¯ä»¥å¿«é€Ÿçš„ç¼–æ’å‡ºå¤æ‚ç¯å¢ƒã€å¤æ‚ä¾èµ–å…³ç³»çš„åº”ç”¨ç¨‹åºï¼ŒIstioå¯ä»¥ä½¿å¼€å‘è€…åˆæ— é¡»è¿‡åˆ†å…³å¿ƒåº”ç”¨ç¨‹åºçš„ç›‘æ§ã€æ‰©å±•æ€§ã€æœåŠ¡å‘ç°å’Œåˆ†å¸ƒå¼è¿½è¸ªè¿™äº›ç¹ççš„äº‹æƒ…è€Œä¸“æ³¨äºç¨‹åºå¼€å‘ï¼Œèµ‹äºˆå¼€å‘è€…æ›´å¤šçš„åˆ›é€ æ€§ã€‚","tags":["istio","service mesh"],"title":"æµ…æServiceMesh \u0026 Istio","type":"post"},{"authors":["éƒ­æ—­ä¸œ"],"categories":["æœåŠ¡ç½‘æ ¼"],"content":" æœ¬æ–‡è½¬è‡ªã€ŠIstio æœåŠ¡ç½‘æ ¼è¿›é˜¶å®æˆ˜ã€‹\nä»€ä¹ˆæ˜¯æœåŠ¡ç½‘æ ¼ï¼Ÿ Service mesh åˆè¯‘ä½œ â€œæœåŠ¡ç½‘æ ¼â€ï¼Œä½œä¸ºæœåŠ¡é—´é€šä¿¡çš„åŸºç¡€è®¾æ–½å±‚ã€‚Buoyant å…¬å¸çš„ CEO Willian Morgan åœ¨ä»–çš„è¿™ç¯‡æ–‡ç«  WHATâ€™S A SERVICE MESH? AND WHY DO I NEED ONE? ä¸­è§£é‡Šäº†ä»€ä¹ˆæ˜¯ Service Meshï¼Œä¸ºä»€ä¹ˆäº‘åŸç”Ÿåº”ç”¨éœ€è¦ Service Meshã€‚\næœåŠ¡ç½‘æ ¼æ˜¯ç”¨äºå¤„ç†æœåŠ¡é—´é€šä¿¡çš„ä¸“ç”¨åŸºç¡€è®¾æ–½å±‚ã€‚å®ƒè´Ÿè´£é€šè¿‡åŒ…å«ç°ä»£äº‘åŸç”Ÿåº”ç”¨ç¨‹åºçš„å¤æ‚æœåŠ¡æ‹“æ‰‘æ¥å¯é åœ°ä¼ é€’è¯·æ±‚ã€‚å®é™…ä¸Šï¼ŒæœåŠ¡ç½‘æ ¼é€šå¸¸é€šè¿‡ä¸€ç»„è½»é‡çº§ç½‘ç»œä»£ç†æ¥å®ç°ï¼Œè¿™äº›ä»£ç†ä¸åº”ç”¨ç¨‹åºä»£ç ä¸€èµ·éƒ¨ç½²ï¼Œè€Œä¸éœ€è¦æ„ŸçŸ¥åº”ç”¨ç¨‹åºæœ¬èº«ã€‚â€”â€” Willian Morgan Buoyant CEO\næœåŠ¡ç½‘æ ¼ï¼ˆService Meshï¼‰è¿™ä¸ªæœ¯è¯­é€šå¸¸ç”¨äºæè¿°æ„æˆè¿™äº›åº”ç”¨ç¨‹åºçš„å¾®æœåŠ¡ç½‘ç»œä»¥åŠåº”ç”¨ä¹‹é—´çš„äº¤äº’ã€‚éšç€è§„æ¨¡å’Œå¤æ‚æ€§çš„å¢é•¿ï¼ŒæœåŠ¡ç½‘æ ¼è¶Šæ¥è¶Šéš¾ä»¥ç†è§£å’Œç®¡ç†ã€‚å®ƒçš„éœ€æ±‚åŒ…æ‹¬æœåŠ¡å‘ç°ã€è´Ÿè½½å‡è¡¡ã€æ•…éšœæ¢å¤ã€æŒ‡æ ‡æ”¶é›†å’Œç›‘æ§ä»¥åŠé€šå¸¸æ›´åŠ å¤æ‚çš„è¿ç»´éœ€æ±‚ï¼Œä¾‹å¦‚ A/B æµ‹è¯•ã€é‡‘ä¸é›€å‘å¸ƒã€é™æµã€è®¿é—®æ§åˆ¶å’Œç«¯åˆ°ç«¯è®¤è¯ç­‰ã€‚\næœåŠ¡ç½‘æ ¼çš„ç‰¹ç‚¹ æœåŠ¡ç½‘æ ¼æœ‰å¦‚ä¸‹å‡ ä¸ªç‰¹ç‚¹ï¼š\n åº”ç”¨ç¨‹åºé—´é€šè®¯çš„ä¸­é—´å±‚ è½»é‡çº§ç½‘ç»œä»£ç† åº”ç”¨ç¨‹åºæ— æ„ŸçŸ¥ è§£è€¦åº”ç”¨ç¨‹åºçš„é‡è¯•/è¶…æ—¶ã€ç›‘æ§ã€è¿½è¸ªå’ŒæœåŠ¡å‘ç°  ç›®å‰ä¸¤æ¬¾æµè¡Œçš„æœåŠ¡ç½‘æ ¼å¼€æºè½¯ä»¶ Linkerd å’Œ Istio éƒ½å¯ä»¥ç›´æ¥åœ¨ Kubernetes ä¸­é›†æˆï¼Œå…¶ä¸­ Linkerd å·²ç»æˆä¸º CNCF æˆå‘˜ï¼ŒIstio åœ¨ 2018å¹´7æœˆ31æ—¥å®£å¸ƒ 1.0ã€‚\nç†è§£æœåŠ¡ç½‘æ ¼ å¦‚æœç”¨ä¸€å¥è¯æ¥è§£é‡Šä»€ä¹ˆæ˜¯æœåŠ¡ç½‘æ ¼ï¼Œå¯ä»¥å°†å®ƒæ¯”ä½œæ˜¯åº”ç”¨ç¨‹åºæˆ–è€…è¯´å¾®æœåŠ¡é—´çš„ TCP/IPï¼Œè´Ÿè´£æœåŠ¡ä¹‹é—´çš„ç½‘ç»œè°ƒç”¨ã€é™æµã€ç†”æ–­å’Œç›‘æ§ã€‚å¯¹äºç¼–å†™åº”ç”¨ç¨‹åºæ¥è¯´ä¸€èˆ¬æ— é¡»å…³å¿ƒ TCP/IP è¿™ä¸€å±‚ï¼ˆæ¯”å¦‚é€šè¿‡ HTTP åè®®çš„ RESTful åº”ç”¨ï¼‰ï¼ŒåŒæ ·ä½¿ç”¨æœåŠ¡ç½‘æ ¼ä¹Ÿå°±æ— é¡»å…³å¿ƒæœåŠ¡ä¹‹é—´çš„é‚£äº›åŸæ¥æ˜¯é€šè¿‡åº”ç”¨ç¨‹åºæˆ–è€…å…¶ä»–æ¡†æ¶å®ç°çš„äº‹æƒ…ï¼Œæ¯”å¦‚ Spring Cloudã€OSSï¼Œç°åœ¨åªè¦äº¤ç»™æœåŠ¡ç½‘æ ¼å°±å¯ä»¥äº†ã€‚\nPhil CalÃ§ado åœ¨ä»–çš„è¿™ç¯‡åšå®¢ Pattern: Service Mesh ä¸­è¯¦ç»†è§£é‡Šäº†æœåŠ¡ç½‘æ ¼çš„æ¥é¾™å»è„‰ï¼š\n ä»æœ€åŸå§‹çš„ä¸»æœºä¹‹é—´ç›´æ¥ä½¿ç”¨ç½‘çº¿ç›¸è¿ ç½‘ç»œå±‚çš„å‡ºç° é›†æˆåˆ°åº”ç”¨ç¨‹åºå†…éƒ¨çš„æ§åˆ¶æµ åˆ†è§£åˆ°åº”ç”¨ç¨‹åºå¤–éƒ¨çš„æ§åˆ¶æµ åº”ç”¨ç¨‹åºçš„ä¸­é›†æˆæœåŠ¡å‘ç°å’Œæ–­è·¯å™¨ å‡ºç°äº†ä¸“é—¨ç”¨äºæœåŠ¡å‘ç°å’Œæ–­è·¯å™¨çš„è½¯ä»¶åŒ…/åº“ï¼Œå¦‚ Twitter çš„ Finagle å’Œ Facebook çš„ Proxygenï¼Œè¿™æ—¶å€™è¿˜æ˜¯é›†æˆåœ¨åº”ç”¨ç¨‹åºå†…éƒ¨ å‡ºç°äº†ä¸“é—¨ç”¨äºæœåŠ¡å‘ç°å’Œæ–­è·¯å™¨çš„å¼€æºè½¯ä»¶ï¼Œå¦‚ Netflix OSSã€Airbnb çš„ synapse å’Œ nerve æœ€åä½œä¸ºå¾®æœåŠ¡çš„ä¸­é—´å±‚æœåŠ¡ç½‘æ ¼å‡ºç°  æœåŠ¡ç½‘æ ¼çš„æ¶æ„å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š\nå›¾ç‰‡æ¥è‡ªï¼šPattern: Service Mesh\næœåŠ¡ç½‘æ ¼ä½œä¸º sidecar è¿è¡Œï¼Œå¯¹åº”ç”¨ç¨‹åºæ¥è¯´æ˜¯é€æ˜ï¼Œæ‰€æœ‰åº”ç”¨ç¨‹åºé—´çš„æµé‡éƒ½ä¼šé€šè¿‡å®ƒï¼Œæ‰€ä»¥å¯¹åº”ç”¨ç¨‹åºæµé‡çš„æ§åˆ¶éƒ½å¯ä»¥åœ¨ serivce mesh ä¸­å®ç°ã€‚\næœåŠ¡ç½‘æ ¼å¦‚ä½•å·¥ä½œï¼Ÿ ä¸‹é¢ä»¥ Istio ä¸ºä¾‹è®²è§£æœåŠ¡ç½‘æ ¼å¦‚ä½•åœ¨ Kubernetes ä¸­å·¥ä½œã€‚\n Istio å°†æœåŠ¡è¯·æ±‚è·¯ç”±åˆ°ç›®çš„åœ°å€ï¼Œæ ¹æ®å…¶ä¸­çš„å‚æ•°åˆ¤æ–­æ˜¯åˆ°ç”Ÿäº§ç¯å¢ƒã€æµ‹è¯•ç¯å¢ƒè¿˜æ˜¯ staging ç¯å¢ƒä¸­çš„æœåŠ¡ï¼ˆæœåŠ¡å¯èƒ½åŒæ—¶éƒ¨ç½²åœ¨è¿™ä¸‰ä¸ªç¯å¢ƒä¸­ï¼‰ï¼Œæ˜¯è·¯ç”±åˆ°æœ¬åœ°ç¯å¢ƒè¿˜æ˜¯å…¬æœ‰äº‘ç¯å¢ƒï¼Ÿæ‰€æœ‰çš„è¿™äº›è·¯ç”±ä¿¡æ¯å¯ä»¥åŠ¨æ€é…ç½®ï¼Œå¯ä»¥æ˜¯å…¨å±€é…ç½®ä¹Ÿå¯ä»¥ä¸ºæŸäº›æœåŠ¡å•ç‹¬é…ç½®ã€‚ å½“ Istio ç¡®è®¤äº†ç›®çš„åœ°å€åï¼Œå°†æµé‡å‘é€åˆ°ç›¸åº”æœåŠ¡å‘ç°ç«¯ç‚¹ï¼Œåœ¨ Kubernetes ä¸­æ˜¯ serviceï¼Œç„¶å service ä¼šå°†æœåŠ¡è½¬å‘ç»™åç«¯çš„å®ä¾‹ã€‚ Istio æ ¹æ®å®ƒè§‚æµ‹åˆ°æœ€è¿‘è¯·æ±‚çš„å»¶è¿Ÿæ—¶é—´ï¼Œé€‰æ‹©å‡ºæ‰€æœ‰åº”ç”¨ç¨‹åºçš„å®ä¾‹ä¸­å“åº”æœ€å¿«çš„å®ä¾‹ã€‚ Istio å°†è¯·æ±‚å‘é€ç»™è¯¥å®ä¾‹ï¼ŒåŒæ—¶è®°å½•å“åº”ç±»å‹å’Œå»¶è¿Ÿæ•°æ®ã€‚ å¦‚æœè¯¥å®ä¾‹æŒ‚äº†ã€ä¸å“åº”äº†æˆ–è€…è¿›ç¨‹ä¸å·¥ä½œäº†ï¼ŒIstio å°†æŠŠè¯·æ±‚å‘é€åˆ°å…¶ä»–å®ä¾‹ä¸Šé‡è¯•ã€‚ å¦‚æœè¯¥å®ä¾‹æŒç»­è¿”å› errorï¼ŒIstio ä¼šå°†è¯¥å®ä¾‹ä»è´Ÿè½½å‡è¡¡æ± ä¸­ç§»é™¤ï¼Œç¨åå†å‘¨æœŸæ€§å¾—é‡è¯•ã€‚ å¦‚æœè¯·æ±‚çš„æˆªæ­¢æ—¶é—´å·²è¿‡ï¼ŒIstio ä¸»åŠ¨å¤±è´¥è¯¥è¯·æ±‚ï¼Œè€Œä¸æ˜¯å†æ¬¡å°è¯•æ·»åŠ è´Ÿè½½ã€‚ Istio ä»¥ metric å’Œåˆ†å¸ƒå¼è¿½è¸ªçš„å½¢å¼æ•è·ä¸Šè¿°è¡Œä¸ºçš„å„ä¸ªæ–¹é¢ï¼Œè¿™äº›è¿½è¸ªä¿¡æ¯å°†å‘é€åˆ°é›†ä¸­ metric ç³»ç»Ÿã€‚  ä¸ºä½•ä½¿ç”¨æœåŠ¡ç½‘æ ¼ï¼Ÿ æœåŠ¡ç½‘æ ¼å¹¶æ²¡æœ‰ç»™æˆ‘ä»¬å¸¦æ¥æ–°åŠŸèƒ½ï¼Œå®ƒæ˜¯ç”¨äºè§£å†³å…¶ä»–å·¥å…·å·²ç»è§£å†³è¿‡çš„é—®é¢˜ï¼Œåªä¸è¿‡è¿™æ¬¡æ˜¯åœ¨äº‘åŸç”Ÿçš„ Kubernetes ç¯å¢ƒä¸‹çš„å®ç°ã€‚\nåœ¨ä¼ ç»Ÿçš„ MVC ä¸‰å±‚ Web åº”ç”¨ç¨‹åºæ¶æ„ä¸‹ï¼ŒæœåŠ¡ä¹‹é—´çš„é€šè®¯å¹¶ä¸å¤æ‚ï¼Œåœ¨åº”ç”¨ç¨‹åºå†…éƒ¨è‡ªå·±ç®¡ç†å³å¯ï¼Œä½†æ˜¯åœ¨ç°ä»Šçš„å¤æ‚çš„å¤§å‹ç½‘ç«™æƒ…å†µä¸‹ï¼Œå•ä½“åº”ç”¨è¢«åˆ†è§£ä¸ºä¼—å¤šçš„å¾®æœåŠ¡ï¼ŒæœåŠ¡ä¹‹é—´çš„ä¾èµ–å’Œé€šè®¯ååˆ†å¤æ‚ï¼Œå‡ºç°äº† twitter å¼€å‘çš„ Finagleã€Netflix å¼€å‘çš„ Hystrix å’Œ Google çš„ Stubby è¿™æ ·çš„ â€œèƒ–å®¢æˆ·ç«¯â€ åº“ï¼Œè¿™äº›å°±æ˜¯æ—©æœŸçš„æœåŠ¡ç½‘æ ¼ï¼Œä½†æ˜¯å®ƒä»¬éƒ½ä»…é€‚ç”¨äºç‰¹å®šçš„ç¯å¢ƒå’Œç‰¹å®šçš„å¼€å‘è¯­è¨€ï¼Œå¹¶ä¸èƒ½ä½œä¸ºå¹³å°çº§çš„æœåŠ¡ç½‘æ ¼æ”¯æŒã€‚\nåœ¨äº‘åŸç”Ÿæ¶æ„ä¸‹ï¼Œå®¹å™¨çš„ä½¿ç”¨ç»™äºˆäº†å¼‚æ„åº”ç”¨ç¨‹åºçš„æ›´å¤šå¯è¡Œæ€§ï¼ŒKubernetes å¢å¼ºçš„åº”ç”¨çš„æ¨ªå‘æ‰©å®¹èƒ½åŠ›ï¼Œç”¨æˆ·å¯ä»¥å¿«é€Ÿçš„ç¼–æ’å‡ºå¤æ‚ç¯å¢ƒã€å¤æ‚ä¾èµ–å…³ç³»çš„åº”ç”¨ç¨‹åºï¼ŒåŒæ—¶å¼€å‘è€…åˆæ— é¡»è¿‡åˆ†å…³å¿ƒåº”ç”¨ç¨‹åºçš„ç›‘æ§ã€æ‰©å±•æ€§ã€æœåŠ¡å‘ç°å’Œåˆ†å¸ƒå¼è¿½è¸ªè¿™äº›ç¹ççš„äº‹æƒ…è€Œä¸“æ³¨äºç¨‹åºå¼€å‘ï¼Œèµ‹äºˆå¼€å‘è€…æ›´å¤šçš„åˆ›é€ æ€§ã€‚\nå‚è€ƒ  WHATâ€™S A SERVICE MESH? AND WHY DO I NEED ONE? - buoyant.io Istio: A service mesh for AWS ECS - medium.com åˆæ¬¡äº†è§£ Istio - istio.io Application Network Functions With ESBs, API Management, and Now.. Service Mesh? - blog.christianposta.com Pattern: Service Mesh - philcalcado.com Envoy å®˜æ–¹æ–‡æ¡£ä¸­æ–‡ç‰ˆ - servicemesher.com Istio å®˜æ–¹æ–‡æ¡£ - istio.io servicemesher/awesome-servicemesh - github.com  ","date":1552983176,"expirydate":-62135596800,"kind":"page","lang":"zh","lastmod":1552983176,"objectID":"a084ed7181e88533bb63bd4fa8b7a6d3","permalink":"https://guoxudong.io/post/istio-servicemesh/","publishdate":"2019-03-19T16:12:56+08:00","relpermalink":"/post/istio-servicemesh/","section":"post","summary":"ç°åœ¨Service Meshå¾ˆçƒ­ï¼Œä½†æ˜¯åˆ°åº•ä»€ä¹ˆäº‹Service Meshï¼ŒService Meshèƒ½ä¸ºæˆ‘ä»¬åšä»€ä¹ˆï¼Œæˆ‘ä»¬ä¸ºä»€ä¹ˆè¦ç”¨Service Meshã€‚","tags":["Service Mesh"],"title":"Service Meshæ˜¯ä»€ä¹ˆ","type":"post"},{"authors":["éƒ­æ—­ä¸œ"],"categories":["kubernetes"],"content":" å‰è¨€  éšç€å¾®æœåŠ¡å’Œå®¹å™¨åŒ–çš„æ·±å…¥äººå¿ƒï¼Œä»¥åŠkuberneteså·²ç»æˆä¸ºå®¹å™¨ç¼–æ’é¢†åŸŸçš„äº‹å®æ ‡å‡†ï¼Œè¶Šæ¥è¶Šå¤šçš„å…¬å¸å°†è‡ªå·±çš„æœåŠ¡è¿ç§»åˆ°kubernetesé›†ç¾¤ä¸­ã€‚è€Œéšç€kubernetesé›†ç¾¤çš„å¢åŠ ï¼Œé›†ç¾¤ç®¡ç†çš„é—®é¢˜å°±å‡¸æ˜¾å‡ºæ¥ï¼Œä¸åŒçš„ç¯å¢ƒå­˜åœ¨ä¸åŒçš„é›†ç¾¤ï¼Œä¸åŒçš„ä¸šåŠ¡çº¿ä¸åŒçš„é›†ç¾¤ï¼Œç”šè‡³æœ‰äº›å¼€å‘äººå‘˜éƒ½æœ‰è‡ªå·±çš„é›†ç¾¤ã€‚è¯šç„¶ï¼Œå¦‚æœé›†ç¾¤æ˜¯ä½¿ç”¨å…¬æœ‰äº‘å¦‚é˜¿é‡Œäº‘æˆ–åä¸ºäº‘çš„å®¹å™¨æœåŠ¡ï¼Œå¯ä»¥ç™»å½•å…¶æ§åˆ¶å°è¿›è¡Œé›†ç¾¤ç®¡ç†ï¼›æˆ–è€…ä½¿ç”¨rancherè¿™ç”¨çš„å¤šé›†ç¾¤ç®¡ç†å·¥å…·è¿›è¡Œç»Ÿä¸€çš„ç®¡ç†ã€‚ä½†æ˜¯åœ¨æƒ³æ“ä½œistioç‰¹æœ‰çš„å®¹å™¨èµ„æºï¼Œæˆ–è€…æƒ³ä½¿ç”¨istioctlçš„æ—¶å€™ï¼Œæˆ–è€…åƒæˆ‘ä¸€æ ·å°±æ˜¯æƒ³ä½¿ç”¨kubectlå‘½ä»¤çš„åŒå­¦ï¼Œè¿™ä¸ªæ—¶å€™å¤šé›†ç¾¤çš„åˆ‡æ¢å°±æ˜¾çš„ååˆ†é‡è¦äº†ã€‚\nç®€ä»‹ ## åŸç† ä½¿ç”¨```kubeconfig```æ–‡ä»¶ï¼Œæ‚¨å¯ä»¥ç»„ç»‡æ‚¨çš„ç¾¤é›†ï¼Œç”¨æˆ·å’Œåç§°ç©ºé—´ã€‚ è¿˜å¯ä»¥å®šä¹‰ä¸Šä¸‹æ–‡ä»¥å¿«é€Ÿè½»æ¾åœ°åœ¨ç¾¤é›†å’Œåç§°ç©ºé—´ä¹‹é—´åˆ‡æ¢ã€‚ ### ä¸Šä¸‹æ–‡(Context)  kubeconfig```æ–‡ä»¶ä¸­çš„ä¸Šä¸‹æ–‡å…ƒç´ ç”¨äºä»¥æ–¹ä¾¿çš„åç§°å¯¹è®¿é—®å‚æ•°è¿›è¡Œåˆ†ç»„ã€‚ æ¯ä¸ªä¸Šä¸‹æ–‡æœ‰ä¸‰ä¸ªå‚æ•°ï¼šé›†ç¾¤ï¼Œå‘½åç©ºé—´å’Œç”¨æˆ·ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œkubectlå‘½ä»¤è¡Œå·¥å…·ä½¿ç”¨å½“å‰ä¸Šä¸‹æ–‡ä¸­çš„å‚æ•°ä¸é›†ç¾¤è¿›è¡Œé€šä¿¡ã€‚å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤è®¾ç½®ä¸Šä¸‹æ–‡ï¼š\n kubectl config use-context  é…ç½®å†…å®¹ kubectl config view   å¦‚æœè®¾ç½®äº†--kubeconfigæ ‡å¿—ï¼Œåˆ™åªä½¿ç”¨æŒ‡å®šçš„æ–‡ä»¶ã€‚è¯¥æ ‡å¿—åªå…è®¸æœ‰ä¸€ä¸ªå®ä¾‹ã€‚ å¦‚æœç¯å¢ƒå˜é‡KUBECONFIGå­˜åœ¨ï¼Œé‚£ä¹ˆå°±ä½¿ç”¨è¯¥ç¯å¢ƒå˜é‡KUBECONFIGé‡Œé¢çš„å€¼ï¼Œå¦‚æœä¸å­˜åœ¨è¯¥ç¯å¢ƒå˜é‡KUBECONFIGï¼Œé‚£ä¹ˆé»˜è®¤å°±æ˜¯ä½¿ç”¨$HOME/.kube/configæ–‡ä»¶ã€‚  kubeconfigå†…å®¹ ä»ä¸‹é¢kubeconfigæ–‡ä»¶çš„é…ç½®æ¥çœ‹é›†ç¾¤ã€ç”¨æˆ·ã€ä¸Šä¸‹æ–‡ã€å½“å‰ä¸Šä¸‹æ–‡çš„å…³ç³»å°±æ¯”è¾ƒæ˜æ˜¾äº†ã€‚\napiVersion: v1 kind: Config preferences: {} clusters: - cluster: name: {cluster-name} users: - name: {user-name} contexts: - context: cluster: {cluster-name} user: {user-name} name: {context-name} current-context: {context-name}  ä¸ºä½•è¦è‡ªåŠ¨åˆå¹¶ åœ¨æ—¥å¸¸çš„å·¥ä½œä¸­ï¼Œå¦‚æœæˆ‘ä»¬éœ€è¦æ“ä½œå¤šä¸ªé›†ç¾¤ï¼Œä¼šå¾—åˆ°å¤šä¸ªkubeconfigé…ç½®æ–‡ä»¶ã€‚ä¸€èˆ¬çš„kubeconfigæ–‡ä»¶éƒ½æ˜¯yamlæ ¼å¼çš„ï¼Œä½†æ˜¯ä¹Ÿæœ‰å°‘éƒ¨åˆ†çš„é›†ç¾¤kubeconfigæ—¶å·²jsonæ–‡ä»¶çš„å½¢å¼ç»™å‡ºçš„ï¼ˆæ¯”å¦‚åä¸ºäº‘çš„=ã€‚=ï¼‰ï¼Œæ¯”å¦‚æˆ‘ä»¬å…¬å¸å†é˜¿é‡Œäº‘ã€åä¸ºäº‘å’Œè‡ªå»ºç¯å¢ƒä¸Šå‡å­˜åœ¨kubernetesé›†ç¾¤ï¼Œå¹³æ—¶æ“ä½œè¦åœ¨å¤šé›†ç¾¤ä¹‹é—´åˆ‡æ¢ï¼Œè¿™ä¹Ÿå°±å‚¬ç”Ÿäº†æˆ‘å†™è¿™ä¸ªå·¥å…·ï¼ˆå…¶å®å°±æ˜¯ä¸€ä¸ªè„šæœ¬ï¼‰çš„åŠ¨æœºã€‚\nè‡ªåŠ¨åˆå¹¶ç”Ÿæˆkubeconfig ä¼—æ‰€å‘¨çŸ¥ï¼Œyamlæ˜¯ä¸€ç§ç›´è§‚çš„èƒ½å¤Ÿè¢«ç”µè„‘è¯†åˆ«çš„æ•°æ®åºåˆ—åŒ–æ ¼å¼ï¼Œæ˜¯ä¸€ä¸ªå¯è¯»æ€§é«˜å¹¶ä¸”å®¹æ˜“è¢«äººç±»é˜…è¯»çš„è¯­è¨€å’Œjsonç›¸æ¯”ï¼ˆæ²¡æœ‰æ ¼å¼åŒ–ä¹‹å‰ï¼‰å¯è¯»æ€§æ›´å¼ºã€‚è€Œæˆ‘è¿™ä¸ªå·¥å…·å¹¶ä¸æ˜¯å¾ˆå…³å¿ƒkubeconfigçš„æ ¼å¼ï¼Œåªè¦å°†æƒ³è¦åˆå¹¶çš„kubeconfigæ”¾å…¥æŒ‡å®šæ–‡ä»¶å³å¯ã€‚\nGitHubï¼šhttps://github.com/sunny0826/mergeKubeConfig\né€‚ç”¨ç¯å¢ƒ  éœ€è¦åœ¨ç»ˆç«¯ä½¿ç”¨å‘½ä»¤è¡Œç®¡ç†å¤šé›†ç¾¤ kubernetesé›†ç¾¤ä¸­å®‰è£…äº†istioï¼Œéœ€è¦ä½¿ç”¨istioctlå‘½ä»¤ï¼Œä½†æ˜¯é›†ç¾¤èŠ‚ç‚¹å¹¶æ²¡æœ‰å®‰è£…istioctlï¼Œéœ€è¦åœ¨æœ¬åœ°ç»ˆç«¯æ“ä½œ ä¸æ„¿é¢‘ç¹ç¼–è¾‘.kubeç›®å½•ä¸­çš„configæ–‡ä»¶çš„åŒå­¦  å‡†å¤‡å·¥ä½œ  Pythonç¯å¢ƒï¼š2.7æˆ–è€…3å‡å¯ éœ€è¦ä¾èµ–åŒ…ï¼šPyYAML  å¼€å§‹ä½¿ç”¨  å®‰è£…ä¾èµ–ï¼š\npip install PyYAML  è¿è¡Œè„šæœ¬\n é»˜è®¤è¿è¡Œæ–¹å¼ï¼Œkubeconfigæ–‡ä»¶æ”¾å…¥configfileæ–‡ä»¶,æ³¨æ„åˆ æ‰ä½œä¸ºç¤ºä¾‹çš„ä¸¤ä¸ªæ–‡ä»¶\npython merge.py  è‡ªå®šä¹‰kubeconfigæ–‡ä»¶ç›®å½•\npython merge.py -d {custom-dir}    è¿è¡Œåæ“ä½œ  å°†ç”Ÿæˆçš„configæ–‡ä»¶æ”¾å…¥.kubeç›®å½•ä¸­\ncp config ~/.kube  æŸ¥çœ‹æ‰€æœ‰çš„å¯ä½¿ç”¨çš„kubernetesé›†ç¾¤è§’è‰²\nkubectl config get-contexts  æ›´å¤šå…³äºkubernetesé…ç½®æ–‡ä»¶æ“ä½œ\nkubectl config --help  åˆ‡æ¢kubernetesé…ç½®\nkubectl config use-context {your-contexts}   ç»“è¯­ åœ¨ä½¿ç”¨kubernetesåˆæœŸï¼Œåœ¨å¤šé›†ç¾¤ä¹‹é—´æˆ‘ä¸€ç›´æ˜¯é¢‘ç¹çš„åˆ‡æ¢.kube/configæ–‡ä»¶æ¥è¾¾åˆ°åˆ‡æ¢æ“ä½œé›†ç¾¤çš„ç›®çš„ã€‚è¿™ä¹Ÿå¯¼è‡´äº†æˆ‘çš„.kubeç›®å½•ä¸­å­˜åœ¨è¿™å¤šä¸ªç±»ä¼¼äºal_test_config.bakã€al_prod_config.bakã€hw_test_config.bakçš„æ–‡ä»¶ï¼Œæœ¬åœ°ç¯å¢ƒå·²ç»è‡ªå»ºç¯å¢ƒï¼Œåœ¨é›†ç¾¤åˆ‡æ¢çš„æ—¶å€™ååˆ†å¤´ç–¼ã€‚è€Œåæ¥ä½¿ç”¨--kubeconfigæ¥è¿›è¡Œåˆ‡æ¢é›†ç¾¤ï¼Œè™½ç„¶æ¯”ä¹‹å‰çš„æ–¹æ³•è¦æ–¹ä¾¿å¾ˆå¤šï¼Œä½†æ˜¯å¹¶ä¸ååˆ†ä¼˜é›…ã€‚è¿™ä¸ªç®€å•çš„å°å·¥å…·ä¸€ä¸¾è§£å†³äº†æˆ‘çš„æ–‡ä»¶ï¼Œå¯¹äºæˆ‘è¿™ä¸ªkubectlé‡åº¦ä¾èµ–è€…æ¥è¯´ååˆ†é‡è¦ã€‚\n","date":1552790702,"expirydate":-62135596800,"kind":"page","lang":"zh","lastmod":1552790702,"objectID":"b56bee2ceb79fd69e0f7dd288430f84d","permalink":"https://guoxudong.io/post/merge-kubeconfig/","publishdate":"2019-03-17T10:45:02+08:00","relpermalink":"/post/merge-kubeconfig/","section":"post","summary":"éšç€kubernetesé›†ç¾¤çš„å¢åŠ ï¼Œé›†ç¾¤ç®¡ç†çš„é—®é¢˜å°±å‡¸æ˜¾å‡ºæ¥ï¼Œä¸åŒçš„ç¯å¢ƒå­˜åœ¨ä¸åŒçš„é›†ç¾¤ï¼Œä¸åŒçš„ä¸šåŠ¡çº¿ä¸åŒçš„é›†ç¾¤ï¼Œç”šè‡³æœ‰äº›å¼€å‘äººå‘˜éƒ½æœ‰è‡ªå·±çš„é›†ç¾¤ã€‚è¿™é‡Œä»‹ç»ä¸€æ¬¾å·¥å…·æ¥è‡ªåŠ¨åˆå¹¶Kubeconfigï¼Œå®ç°å¤šk8sé›†ç¾¤åˆ‡æ¢ã€‚","tags":["kubernetes","å·¥å…·"],"title":"è‡ªåŠ¨åˆå¹¶Kubeconfigï¼Œå®ç°å¤šk8sé›†ç¾¤åˆ‡æ¢","type":"post"},{"authors":["éƒ­æ—­ä¸œ"],"categories":["ç³»ç»Ÿ"],"content":" ç®€ä»‹  Small. Simple. Secure.Alpine Linux is a security-oriented, lightweight Linux distribution based on musl libc and busybox.\nAlpine Linux æ˜¯ä¸€ä¸ªç¤¾åŒºå¼€å‘çš„é¢å‘å®‰å…¨åº”ç”¨çš„è½»é‡çº§Linuxå‘è¡Œç‰ˆã€‚ Alpine çš„æ„æ€æ˜¯â€œé«˜å±±çš„â€ï¼Œå®ƒé‡‡ç”¨äº†musl libcå’Œbusyboxä»¥å‡å°ç³»ç»Ÿçš„ä½“ç§¯å’Œè¿è¡Œæ—¶èµ„æºæ¶ˆè€—ï¼ŒåŒæ—¶è¿˜æä¾›äº†è‡ªå·±çš„åŒ…ç®¡ç†å·¥å…·apkã€‚\n é€‚ç”¨ç¯å¢ƒ ç”±äºå…¶å°å·§ã€å®‰å…¨ã€ç®€å•ä»¥åŠåŠŸèƒ½å®Œå¤‡çš„ç‰¹ç‚¹ï¼Œè¢«å¹¿æ³›åº”ç”¨äºä¼—å¤šDockerå®¹å™¨ä¸­ã€‚æˆ‘å¸ç›®å‰ä½¿ç”¨çš„åŸºç¡€é•œåƒå‡æ˜¯åŸºäºè¯¥ç³»ç»Ÿï¼Œdockerhubä¸Šæœ‰æä¾›å„ç§è¯­è¨€çš„åŸºç¡€é•œåƒ.å¦‚ï¼šnode:8-alpineã€python:3.6-alpineï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥åŸºäºalpineé•œåƒåˆ¶ä½œç¬¦åˆè‡ªå·±éœ€æ±‚çš„åŸºç¡€é•œåƒã€‚\nç®€å•çš„é•œåƒæ„å»ºç¤ºä¾‹ è¿™é‡Œæä¾›ä¸€ä¸ªpython3çš„åŸºç¡€é•œåƒçš„Dockerfileï¼Œget-pip.pyå¯åœ¨ https://pip.pypa.io/en/latest/installing/ ä¸‹è½½ã€‚\nFROM alpine MAINTAINER guoxudong@keking.cn # æ‹·è´å®‰è£…pipçš„è„šæœ¬ COPY get-pip.py /get-pip.py # è®¾ç½®alpineçš„é•œåƒåœ°å€ä¸ºé˜¿é‡Œäº‘çš„åœ°å€ RUN echo \u0026quot;https://mirrors.aliyun.com/alpine/v3.6/main/\u0026quot; \u0026gt; /etc/apk/repositories \\ # å®‰è£…ä¾èµ–åŒ… \u0026amp;\u0026amp; apk update \\ \u0026amp;\u0026amp; apk add --no-cache bash \\ # libevent-dev libxml2-dev libffi libxml2 libxslt libxslt-dev \\ python3 gcc g++ python3-dev python-dev linux-headers libffi-dev openssl-dev \\ # ç”±äºé€šè¿‡apkå®‰è£…çš„pipæ€»æ˜¯åŸºäºpython2.7çš„ç‰ˆæœ¬ï¼Œä¸ç¬¦åˆé¡¹ç›®è¦æ±‚ï¼Œæ­¤å¤„ä½¿ç”¨get-pip.pyçš„æ–¹å¼ #å®‰è£…åŸºäºpython3.6çš„pip \u0026amp;\u0026amp; python3 /get-pip.py \\ # åˆ é™¤ä¸å¿…è¦çš„è„šæœ¬ \u0026amp;\u0026amp; cd .. \\ \u0026amp;\u0026amp; rm -f /get-pip.py \\ # æ­¤ç¯å¢ƒä¸“ç”¨åšè¿è¡Œdjangoé¡¹ç›®ï¼Œå› æ­¤ç§»é™¤ä¸å¿…è¦çš„å·¥å…·ï¼Œå‡å°‘ç©ºé—´ # \u0026amp;\u0026amp; pip uninstall -y pip setuptools wheel \\ # æœ€åæ¸…ç©ºapkå®‰è£…æ—¶äº§ç”Ÿçš„æ— ç”¨æ–‡ä»¶ \u0026amp;\u0026amp; rm -rf /var/cache/apk/*  å¯¹æ¯”ï¼šåŒæ ·ç‰ˆæœ¬çš„pythonï¼Œå¯¹æ¯”é•œåƒå¤§å°ï¼Œå¯è§ä½¿ç”¨alpineçš„ä¼˜åŠ¿\n~ docker images | grep python python 3.4 ccbffa0d70d9 2 months ago 922MB alpine-python3 latest 69e41b673a50 2 months ago 297MB  apkåŒ…ç®¡ç†  é•œåƒæºé…ç½®\nå®˜æ–¹é•œåƒæºåˆ—è¡¨ï¼šhttp://dl-cdn.alpinelinux.org/alpine/MIRRORS.txt\n MIRRORS.txtä¸­æ˜¯å½“å‰Alpineå®˜æ–¹æä¾›çš„é•œåƒæºï¼ˆAlpineå®‰è£…çš„æ—¶å€™ç³»ç»Ÿè‡ªåŠ¨é€‰æ‹©æœ€ä½³é•œåƒæºï¼‰\n å›½å†…é•œåƒæº\n æ¸…åTUNAé•œåƒæºï¼šhttps://mirror.tuna.tsinghua.edu.cn/alpine/ ä¸­ç§‘å¤§é•œåƒæºï¼šhttp://mirrors.ustc.edu.cn/alpine/ é˜¿é‡Œäº‘é•œåƒæºï¼šhttp://mirrors.aliyun.com/alpine/  é•œåƒæºé…ç½®\nè¿™é‡Œæ¨èä½¿ç”¨é˜¿é‡Œäº‘é•œåƒæºï¼Œç”±äºå…¬å¸åº”ç”¨éƒ½æ˜¯éƒ¨ç½²åœ¨é˜¿é‡Œäº‘ä¸Šï¼Œä½¿ç”¨é˜¿é‡Œäº‘é•œåƒæºä¼šå¿«å¾ˆå¤š\n$ vi /etc/apk/repositories # å°†è¿™ä¸¤è¡Œæ’å…¥åˆ°repositoriesæ–‡ä»¶å¼€å¤´ http://mirrors.aliyun.com/alpine/v3.9/main http://mirrors.aliyun.com/alpine/v3.9/community # åé¢æ˜¯åŸæœ‰çš„é»˜è®¤é…ç½® http://dl-cdn.alpinelinux.org/alpine/v3.8/main http://dl-cdn.alpinelinux.org/alpine/v3.8/community  apkåŒ…ç®¡ç†å‘½ä»¤\nè¿™é‡Œä»‹ç»ä¸€äº›å¸¸ç”¨çš„æ“ä½œapkåŒ…ç®¡ç†å‘½ä»¤\n  bash\n  bash-4.3# apk \u0026ndash;help apk-tools 2.10.0, compiled for x86_64.\nInstalling and removing packages: add Add PACKAGEs to \u0026lsquo;world\u0026rsquo; and install (or upgrade) them, while ensuring that all dependencies are met del Remove PACKAGEs from \u0026lsquo;world\u0026rsquo; and uninstall them\nSystem maintenance: fix Repair package or upgrade it without modifying main dependencies update Update repository indexes from all remote repositories upgrade Upgrade currently installed packages to match repositories cache Download missing PACKAGEs to cache and/or delete unneeded files from cache\nQuerying information about packages: info Give detailed information about PACKAGEs or repositories list List packages by PATTERN and other criteria dot Generate graphviz graphs policy Show repository policy for packages\nRepository maintenance: index Create repository index file from FILEs fetch Download PACKAGEs from global repositories to a local directory verify Verify package integrity and signature manifest Show checksums of package contents\nUse apk  \u0026ndash;help for command-specific help. Use apk \u0026ndash;help \u0026ndash;verbose for a full command listing.\nThis apk has coffee making abilities.\n - ```apk info``` åˆ—å‡ºæ‰€æœ‰å·²å®‰è£…çš„è½¯ä»¶åŒ… - ```apk apk update``` æ›´æ–°æœ€æ–°æœ¬åœ°é•œåƒæº - ```apk upgrade``` å‡çº§è½¯ä»¶ - ```apk search``` æœç´¢å¯ç”¨è½¯ä»¶åŒ…ï¼Œ**æœç´¢ä¹‹å‰æœ€å¥½å…ˆæ›´æ–°é•œåƒæº**  bash $ apk search #æŸ¥æ‰¾æ‰€ä»¥å¯ç”¨è½¯ä»¶åŒ… $ apk search -v #æŸ¥æ‰¾æ‰€ä»¥å¯ç”¨è½¯ä»¶åŒ…åŠå…¶æè¿°å†…å®¹ $ apk search -v \u0026lsquo;acf*\u0026rsquo; #é€šè¿‡è½¯ä»¶åŒ…åç§°æŸ¥æ‰¾è½¯ä»¶åŒ… $ apk search -v -d \u0026lsquo;docker\u0026rsquo; #é€šè¿‡æè¿°æ–‡ä»¶æŸ¥æ‰¾ç‰¹å®šçš„è½¯ä»¶åŒ…\n - ```apk add``` ä»ä»“åº“ä¸­å®‰è£…æœ€æ–°è½¯ä»¶åŒ…ï¼Œå¹¶è‡ªåŠ¨å®‰è£…å¿…é¡»çš„ä¾èµ–åŒ…,ä¹Ÿå¯ä»¥ä»ç¬¬ä¸‰æ–¹ä»“åº“æ·»åŠ è½¯ä»¶åŒ…  bash $ apk add curl busybox-extras #è½¯ä»¶ä»¥ç©ºæ ¼åˆ†å¼€è¿™é‡Œï¼Œè¿™é‡Œåˆ—ä¸¾æˆ‘ä»¬ç”¨çš„æœ€å¤šçš„curlå’Œtelnet bash-4.3# apk add \u0026ndash;no-cache curl bash-4.3# apk add mongodb \u0026ndash;update-cache \u0026ndash;repository http://mirrors.ustc.edu.cn/alpine/v3.6/main/ \u0026ndash;allow-untrusted #ä»æŒ‡å®šé•œåƒæºæ‹‰å–\n å®‰è£…æŒ‡å®šç‰ˆæœ¬è½¯ä»¶åŒ…  bash bash-4.3# apk add mongodb=4.0.5-r0 bash-4.3# apk add \u0026lsquo;mongodb4.0.5\u0026rsquo;\n å‡çº§æŒ‡å®šè½¯ä»¶åŒ…  bash bash-4.3# apk add \u0026ndash;upgrade busybox #å‡çº§æŒ‡å®šè½¯ä»¶åŒ… ```\næ³¨ï¼šå®‰è£…ä¹‹å‰æœ€å¥½ä¿®æ”¹æœ¬åœ°é•œåƒæºï¼Œæ›´æ–°é•œåƒæºï¼Œæœç´¢è½¯ä»¶åŒ…æ˜¯å¦å­˜åœ¨ï¼Œé€‰æ‹©åˆé€‚å²¸æœ¬åœ¨è¿›è¡Œå®‰è£…ã€‚\n apk del å¸è½½å¹¶åˆ é™¤æŒ‡å®šè½¯ä»¶åŒ…   ç»“è¯­ Alpineä»¥å…¶å°å·§ã€ç®€å•åœ¨dockerå®¹å™¨ä¸­å¾—åˆ°äº†å¹¿æ³›çš„åº”ç”¨ã€‚ä½†æ˜¯Alpine Linuxä½¿ç”¨äº†muslï¼Œå¯èƒ½å’Œå…¶ä»–Linuxå‘è¡Œç‰ˆä½¿ç”¨çš„glibcå®ç°ä¼šæœ‰äº›ä¸åŒã€‚è¿™é‡Œä¸»è¦ä»‹ç»äº†å®ƒçš„åŸºç¡€ç”¨æ³•ï¼Œä½†æ˜¯è¶³ä»¥æ»¡è¶³æ—¥å¸¸è¿ç»´éœ€è¦ã€‚æ¯•ç«Ÿåœ¨kubernetesé›†ç¾¤ä¸­æ“ä½œå®¹å™¨å†…ç¯å¢ƒè¾ƒç›´æ¥åœ¨è™šæ‹Ÿæœºæˆ–è€…ç‰©ç†æœºä¸Šæ“ä½œæ›´ä¸ºå¤æ‚ï¼Œç”±äºç¼©å‡çš„å®¹å™¨çš„å¤§å°ï¼Œå¯¼è‡´å’ŒCentOSæˆ–Ubuntuç›¸æ¯”ç¼ºå°‘è®¸å¤šåŠŸèƒ½ã€‚è€Œç¼ºå°‘çš„è¿™äº›åŠŸèƒ½åˆä¸æƒ³åœ¨åŸºç¡€é•œåƒä¸­å®‰è£…å¯¼è‡´å®¹å™¨å˜å¤§ï¼Œè¿™ä¸ªæ—¶å€™å°±å¯ä»¥åœ¨å®¹å™¨è¿è¡Œåï¼Œæ ¹æ®å®é™…éœ€è¦å®‰è£…å³å¯ã€‚\nå‚è€ƒæ–‡æ¡£ https://wiki.alpinelinux.org/wiki/Alpine_Linux_package_management\n","date":1552614782,"expirydate":-62135596800,"kind":"page","lang":"zh","lastmod":1552614782,"objectID":"ebd9e58b0de01d4ad9db3158fb114c74","permalink":"https://guoxudong.io/post/alpine-linux/","publishdate":"2019-03-15T09:53:02+08:00","relpermalink":"/post/alpine-linux/","section":"post","summary":"Alpineä»¥å…¶å°å·§ã€ç®€å•åœ¨dockerå®¹å™¨ä¸­å¾—åˆ°äº†å¹¿æ³›çš„åº”ç”¨ã€‚ä½†æ˜¯Alpine Linuxä½¿ç”¨äº†muslï¼Œå¯èƒ½å’Œå…¶ä»–Linuxå‘è¡Œç‰ˆä½¿ç”¨çš„glibcå®ç°ä¼šæœ‰äº›ä¸åŒã€‚è¿™é‡Œä¸»è¦ä»‹ç»äº†å®ƒçš„åŸºç¡€ç”¨æ³•ï¼Œä½†æ˜¯è¶³ä»¥æ»¡è¶³æ—¥å¸¸è¿ç»´éœ€è¦ã€‚","tags":["Linux","Docker","å®¹å™¨"],"title":"Alpine Linuxè¯¦è§£","type":"post"},{"authors":["éƒ­æ—­ä¸œ"],"categories":["istio"],"content":" istioåº”ç”¨éƒ¨ç½²æ ·ä¾‹ è¯¥å®ä¾‹ä¸ºä¸€å¥—istioæœåŠ¡ä¸Šçº¿æµç¨‹ï¼šæ³¨å…¥-\u0026gt;éƒ¨ç½²-\u0026gt;åˆ›å»ºç›®æ ‡è§„åˆ™-\u0026gt;åˆ›å»ºé»˜è®¤è·¯ç”±ã€‚å°±å¤§å¤šæ•°istioæœåŠ¡ç½‘æ ¼åº”ç”¨å‡å¯åŸºäºè¿™ä¸€æµç¨‹ä¸Šçº¿ã€‚\néƒ¨ç½²istio istioæœ‰å¤šç§éƒ¨ç½²æ–¹å¼ï¼Œé˜¿é‡Œäº‘ã€åä¸ºäº‘ç­‰äº‘æœåŠ¡å•†å‡æä¾›ä¸€é”®å®‰è£…ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥é€šè¿‡GitHubä¸‹è½½releaseåŒ…ï¼Œä½¿ç”¨install/kubernetes/istio-demo.yamléƒ¨ç½²ï¼Œæˆ–è€…ä½¿ç”¨helméƒ¨ç½²ã€‚è¿™é‡Œé‡‡ç”¨é˜¿é‡Œäº‘å®¹å™¨æœåŠ¡ä¸€é”®éƒ¨ç½²istioã€‚\néƒ¨ç½²ä¸¤ä¸ªç‰ˆæœ¬çš„æœåŠ¡ è¿™é‡Œé€‰æ‹©ä¸€ä¸ªç®€å•çš„Pythoné¡¹ç›®ä½œä¸ºæœåŠ¡ç«¯ï¼Œè¿™é‡Œä½¿ç”¨å´”ç§€é¾™è€å“¥çš„flaskappæœåŠ¡ï¼Œè¯¥æœåŠ¡çš„ä½œç”¨å°±æ˜¯æä¾›2ä¸ªurlè·¯å¾„ï¼š\n ä¸€ä¸ªæ˜¯/envï¼Œç”¨æˆ·è·å–å®¹å™¨ä¸­çš„ç¯å¢ƒå˜é‡ï¼Œä¾‹å¦‚ http://flaskapp/env/version å¦ä¸€ä¸ªæ˜¯/fetch ï¼Œç”¨äºè·å–åœ¨å‚æ•°urlä¸­æŒ‡å®šçš„ç½‘å€çš„å†…å®¹ï¼Œä¾‹å¦‚ http://flaskapp/fetch?url=http://weibo.com  åˆ›å»º2ä¸ªDeploymentï¼Œåˆ†åˆ«å‘½åä¸º flaskapp-v1 å’Œ flaskapp-v2 ï¼ŒåŒæ—¶åˆ›å»ºä¸€ä¸ª Service ,å°†å…¶å‘½åä¸ºflaskappã€‚ä»£ç æ–‡ä»¶ä¸º flaskapp.istio.yamlã€‚\nimage: caption: \u0026quot;Image from: [**Pexels**](https://www.pexels.com)\u0026quot; focal_point: \u0026quot;\u0026quot; preview_only: false --- apiVersion: v1 kind: Service metadata: name: flaskapp labels: app: flaskapp spec: selector: app: flaskapp ports: - name: http port: 80 image: caption: \u0026quot;Image from: [**Pexels**](https://www.pexels.com)\u0026quot; focal_point: \u0026quot;\u0026quot; preview_only: false --- apiVersion: extensions/v1beta1 kind: Deployment metadata: name: flaskapp-v1 spec: replicas: 1 template: metadata: labels: app: flaskapp version: v1 spec: containers: - name: flaskapp image: dustise/flaskapp imagePullPolicy: IfNotPresent env: - name: version value: v1 image: caption: \u0026quot;Image from: [**Pexels**](https://www.pexels.com)\u0026quot; focal_point: \u0026quot;\u0026quot; preview_only: false --- apiVersion: extensions/v1beta1 kind: Deployment metadata: name: flaskapp-v2 spec: replicas: 1 template: metadata: labels: app: flaskapp version: v2 spec: containers: - name: flaskapp image: dustise/flaskapp imagePullPolicy: IfNotPresent env: - name: version value: v2  æ³¨æ„\n ä¸¤ä¸ªç‰ˆæœ¬Deploymentçš„é•œåƒä¸€è‡´ï¼Œä½†æ˜¯ä½¿ç”¨äº†ä¸åŒçš„versionæ ‡ç­¾åŒºåˆ†ï¼Œåˆ†åˆ«ä¸º v1 å’Œ v2 ã€‚å®é™…ç¯å¢ƒä¸­çš„é•œåƒæ˜¯ä¸åŒçš„ åœ¨ä¸¤ä¸ªDeploymentä¸­éƒ½æœ‰ä¸€ä¸ªåä¸ºversionçš„ç¯å¢ƒå˜é‡ï¼Œåˆ†åˆ«ä¸º v1 å’Œ v2 ã€‚è¿™é‡Œè®¾ç½®æ˜¯ä¸ºäº†æ–¹ä¾¿åç»­åŒºåˆ†æœåŠ¡ã€‚ ä¸¤ä¸ªDeploymentä¸­éƒ½ä½¿ç”¨äº† app å’Œ version æ ‡ç­¾ï¼Œåœ¨ istio ç½‘æ ¼åº”ç”¨ä¸­é€šå¸¸ä¼šä½¿ç”¨è¿™ä¸¤ä¸ªæ ‡ç­¾ä½œä¸ºåº”ç”¨å’Œç‰ˆæœ¬çš„æ ‡è¯†ã€‚ Service ä¸­çš„ Selector ä»…ä½¿ç”¨äº†ä¸€ä¸ª app æ ‡ç­¾ï¼Œè¿™æ„å‘³ç€è¯¥ Service å¯¹ä¸¤ä¸ª Deployment éƒ½æ˜¯æœ‰æ•ˆçš„ã€‚ å°†åœ¨ Service ä¸­å®šä¹‰çš„ç«¯å£æ ¹æ® istio è§„èŒƒå‘½åä¸ºhttpã€‚  istioæ³¨å…¥å¹¶éƒ¨ç½²æœåŠ¡ç«¯\n$ istioctl kube-inject -f flask.istio.yaml | kubectl apply -f - service/flaskapp created deployment.extensions/flaskapp-v1 created deployment.extensions/flaskapp-v2 created  åœ¨rancheræŸ¥çœ‹æ³¨å…¥æƒ…å†µ\nè¿™é‡Œä¹Ÿå¯ä»¥ä½¿ç”¨kubectl describe po flaskapp-v1-7d4f9b8459-2ncnfå‘½ä»¤æŸ¥çœ‹Podå®¹å™¨ï¼Œè¿™é‡Œå¯ä»¥çœ‹åˆ°Podä¸­å¤šäº†ä¸€ä¸ªå®¹å™¨ï¼Œåä¸ºistio-proxyï¼Œè¿™å°±è¡¨ç¤ºæ³¨å…¥æˆåŠŸäº†ã€‚è€Œå‰é¢istio-initçš„åˆå§‹åŒ–å®¹å™¨ï¼Œè¿™ä¸ªå®¹å™¨æ˜¯ç”¨äºåˆå§‹åŒ–åŠ«æŒçš„ã€‚\néƒ¨ç½²å®¢æˆ·ç«¯ è¿™é‡Œçš„å®¢æˆ·ç«¯æ˜¯ä¸€ä¸ªå®‰è£…äº†æµ‹è¯•å·¥å…·çš„é•œåƒï¼Œæµ‹è¯•çš„å†…å®¹å¯ä»¥åœ¨å®¹å™¨å†…é€šè¿‡shellå®Œæˆã€‚ä»£ç æ–‡ä»¶ä¸º sleep.istio.yamlã€‚\nimage: caption: \u0026quot;Image from: [**Pexels**](https://www.pexels.com)\u0026quot; focal_point: \u0026quot;\u0026quot; preview_only: false --- apiVersion: v1 kind: Service metadata: name: sleep labels: app: sleep version: v1 spec: selector: app: sleep version: v1 ports: - name: ssh port: 80 image: caption: \u0026quot;Image from: [**Pexels**](https://www.pexels.com)\u0026quot; focal_point: \u0026quot;\u0026quot; preview_only: false --- apiVersion: extensions/v1beta1 kind: Deployment metadata: name: sleep spec: replicas: 1 template: metadata: labels: app: sleep version: v1 spec: containers: - name: sleep image: dustise/sleep imagePullPolicy: IfNotPresent  istioæ³¨å…¥å¹¶éƒ¨ç½²å®¢æˆ·ç«¯\n$ istioctl kube-inject -f sleep.istio.yaml | kubectl apply -f - service/sleep created deployment.extensions/sleep created  sleepåº”ç”¨çš„Podè¿›å…¥RunningçŠ¶æ€å°±å¯ä»¥è¿›è¡ŒéªŒè¯äº†\néªŒè¯æœåŠ¡ ç›´æ¥åœ¨sleepå®¹å™¨ä¸­æ‰§è¡Œå‘½ä»¤è¡Œ\n$ for i in `seq 10`;do http --body http://flaskapp/env/version;done v1 v2 ... v1  è¯¥å‘½ä»¤ä½¿ç”¨ä¸€ä¸ªforå¾ªç¯ï¼Œé‡å¤è®¿é—® http://flaskapp/env/version ï¼ŒæŸ¥çœ‹å†…å®¹ï¼Œç»“æœä¸º v1 å’Œ v2 éšæœºå‡ºç°ï¼Œå„å ä¸€åŠã€‚å‡ºç° v1 å’Œ v2 ç‰ˆæœ¬è½®æµè°ƒç”¨çš„æ•ˆæœï¼Œè¾¾åˆ°äº†åŸºæœ¬çš„è´Ÿè½½å‡è¡¡çš„åŠŸèƒ½ã€‚\nåˆ›å»ºç›®æ ‡è§„åˆ™ ç›®æ ‡è§„åˆ™ä»£ç  flaskapp-destinationrule.yaml\napiVersion: networking.istio.io/v1alpha3 kind: DestinationRule metadata: name: flaskapp spec: host: flaskapp subsets: - name: v1 labels: version: v1 - name: v2 labels: version: v2  éƒ¨ç½²ç›®æ ‡è§„åˆ™ï¼ˆè¿™é‡Œä½¿ç”¨kubectlå’Œistioctlå‡å¯ï¼‰\n$ kubectl apply -f flaskapp-destinationrule.yaml Created config destination-rule/default/flaskapp at revision 59183403  åˆ›å»ºé»˜è®¤è·¯ç”± é»˜è®¤è·¯ç”±ä»£ç  flaskapp-default-vs-v2.yaml\napiVersion: networking.istio.io/v1alpha3 kind: VirtualService metadata: name: flaskapp-default-v2 spec: hosts: - flaskapp http: - route: - destination: host: flaskapp subset: v2  éƒ¨ç½²é»˜è®¤è·¯ç”±\n$ kubectl apply -f flaskapp-default-vs-v2.yaml Created config virtual-service/default/flaskapp-default-v2 at revision 59185583  éªŒè¯è·¯ç”±è§„åˆ™æ˜¯å¦ç”Ÿæ•ˆ å†æ¬¡åœ¨sleepå®¹å™¨ä¸­æ‰§è¡Œå‘½ä»¤ï¼ŒæŸ¥çœ‹æ–°å®šä¹‰çš„æµé‡ç®¡ç†è§„åˆ™æ˜¯å¦ç”Ÿæ•ˆ\n$ for i in `seq 10`;do http --body http://flaskapp/env/version;done v2 v2 v2 v2 v2 v2 v2 v2 v2 v2  è¿™é‡Œå°±å¯ä»¥çœ‹åˆ°ï¼Œè®¾ç½®çš„é»˜è®¤è·¯ç”±å·²ç»ç”Ÿæ•ˆäº†ï¼Œå¤šæ¬¡é‡å¤è®¿é—®ï¼Œè¿”å›çš„å†…å®¹éƒ½æ˜¯æ¥è‡ªç¯å¢ƒå˜é‡ version è®¾ç½®ä¸º v2 çš„ç‰ˆæœ¬ï¼Œä¹Ÿå°±æ˜¯v2ç‰ˆæœ¬ã€‚\nkialiæŸ¥çœ‹è°ƒç”¨æƒ…å†µ å¯ä»¥çœ‹åˆ°æµé‡éƒ½è¿›å…¥äº†v2ç‰ˆæœ¬ä¸­\nå°ç»“ è¿™é‡Œå®ç°äº†ä¸€ä¸ªæç®€çš„istioåº”ç”¨ï¼Œå¯ä»¥å¸®åŠ©æ–°æ‰‹å¿«é€Ÿå…¥é—¨ï¼Œå®˜ç½‘æä¾›çš„Bookinfoåº”ç”¨è¾ƒä¸ºå¤æ‚ã€‚è¿™é‡Œæä¾›çš„å°ä¾‹å­æ›´ä¸ºç®€æ´æ˜“æ‡‚ï¼Œéå¸¸åˆ©äºå…¥é—¨ã€‚\nå‚è€ƒ  ã€Šæ·±å…¥æµ…å‡ºIstioã€‹ \u0026mdash; å´”ç§€é¾™  ","date":1552463143,"expirydate":-62135596800,"kind":"page","lang":"zh","lastmod":1552463143,"objectID":"12e4e0fecb1ce1147c771738c6b397f2","permalink":"https://guoxudong.io/post/istio-demo/","publishdate":"2019-03-13T15:45:43+08:00","relpermalink":"/post/istio-demo/","section":"post","summary":"æç®€çš„istioæ ·ä¾‹éƒ¨ç½²ï¼Œå¯ä»¥å¸®åŠ©æ–°æ‰‹å¿«é€Ÿå…¥é—¨ï¼Œç›¸è¾ƒå®˜æ–¹æä¾›çš„Bookinfoåº”ç”¨æ›´å®¹æ˜“ä¸Šæ‰‹ã€‚","tags":["istio","service mesh","é˜¿é‡Œäº‘"],"title":"é˜¿é‡Œäº‘ç¯å¢ƒIstioåˆæ¢","type":"post"},{"authors":["éƒ­æ—­ä¸œ"],"categories":["devops"],"content":" ç®€ä»‹ image: caption: \u0026ldquo;Image from: Pexels\u0026ldquo; focal_point: \u0026ldquo;\u0026rdquo;\npreview_only: false jenkins pipeline Jenkins Pipeline (æˆ–ç®€ç§°ä¸º \u0026ldquo;Pipeline\u0026rdquo; )æ˜¯ä¸€å¥—æ’ä»¶ï¼Œå°†æŒç»­äº¤ä»˜çš„å®ç°å’Œå®æ–½é›†æˆåˆ° Jenkins ä¸­ã€‚\næŒç»­äº¤ä»˜Pipelineè‡ªåŠ¨åŒ–çš„è¡¨è¾¾äº†è¿™æ ·ä¸€ç§æµç¨‹ï¼šå°†åŸºäºç‰ˆæœ¬æ§åˆ¶ç®¡ç†çš„è½¯ä»¶æŒç»­çš„äº¤ä»˜åˆ°æ‚¨çš„ç”¨æˆ·å’Œæ¶ˆè´¹è€…æ‰‹ä¸­ã€‚\nJenkins Pipeline æä¾›äº†ä¸€å¥—å¯æ‰©å±•çš„å·¥å…·ï¼Œç”¨äºå°†â€œç®€å•åˆ°å¤æ‚â€çš„äº¤ä»˜æµç¨‹å®ç°ä¸ºâ€œæŒç»­äº¤ä»˜å³ä»£ç â€ã€‚ Jenkins Pipeline çš„å®šä¹‰é€šå¸¸è¢«å†™å…¥åˆ°ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ï¼ˆç§°ä¸º Jenkinsfile ï¼‰ä¸­ï¼Œè¯¥æ–‡ä»¶å¯ä»¥è¢«æ£€å…¥åˆ°é¡¹ç›®çš„æºä»£ç æ§åˆ¶åº“ä¸­ã€‚\næ‘˜è‡ªJenkinså®˜æ–¹æ–‡æ¡£\nSonarQube SonarQube is an open source platform to perform automatic reviews with static analysis of code to detect bugs, code smells and security vulnerabilities on 25+ programming languages including Java, C#, JavaScript, TypeScript, C/C++, COBOL and more.\nSonarQubeæ˜¯ä¸€ä¸ªå¼€æºçš„å¹³å°ï¼Œä»¥æ‰§è¡Œä¸ä»£ç çš„é™æ€åˆ†æï¼Œè‡ªåŠ¨å®¡æŸ¥ï¼Œå¯ä»¥æ£€æµ‹åœ¨25+çš„ç¼–ç¨‹è¯­è¨€å¦‚Javaï¼ŒCï¼ƒï¼ŒJavaScriptï¼ŒTypeScriptï¼ŒC/C++ï¼ŒCOBOLç­‰çš„ä»£ç ç¼ºé™·å’Œå®‰å…¨æ¼æ´ã€‚\nOWASP OWASPï¼Œå…¨ç§°æ˜¯ï¼šOpen Web Application Security Projectï¼Œç¿»è¯‘ä¸ºä¸­æ–‡å°±æ˜¯ï¼šå¼€æ”¾å¼Webåº”ç”¨ç¨‹åºå®‰å…¨é¡¹ç›®ï¼Œæ˜¯ä¸€ä¸ªéè¥åˆ©ç»„ç»‡ï¼Œä¸é™„å±äºä»»ä½•ä¼ä¸šæˆ–è´¢å›¢ï¼Œè¿™ä¹Ÿæ˜¯è¯¥ç»„ç»‡å¯ä»¥ä¸å—å•†ä¸šæ§åˆ¶åœ°è¿›è¡Œå®‰å…¨å¼€å‘åŠå®‰å…¨æ™®åŠçš„é‡è¦åŸå› ï¼Œè¯¦ç»†ä»‹ç»ã€‚OWASP Dependency-Checkï¼Œå®ƒè¯†åˆ«é¡¹ç›®ä¾èµ–å…³ç³»ï¼Œå¹¶æ£€æŸ¥æ˜¯å¦å­˜åœ¨ä»»ä½•å·²çŸ¥çš„ã€å…¬å¼€çš„ã€æ¼æ´ï¼ŒåŸºäºOWASP Top 10 2013ã€‚\nåœºæ™¯ åœ¨devopsç†å¿µä¸­ï¼ŒCI/CDæ¯«æ— ç–‘é—®æ˜¯æœ€é‡è¦çš„ä¸€ç¯ï¼Œè€Œä»£ç è´¨é‡æ£€æŸ¥åˆ™æ˜¯CIä¸­å¿…ä¸å¯å°‘çš„ä¸€æ­¥ã€‚åœ¨æ•æ·å¼€å‘çš„æ€æƒ³ä¸‹ï¼Œä»£ç çš„è¿­ä»£å‘¨æœŸå˜çŸ­ï¼Œäº¤ä»˜é€Ÿåº¦æå‡ï¼Œè¿™ä¸ªæ—¶å€™ä»£ç çš„è´¨é‡å°±å¾ˆéš¾ä¿è¯ï¼Œæµ‹è¯•åªèƒ½ä¿è¯åŠŸèƒ½å®Œæ•´ä¸å¯ç”¨ï¼Œè€Œä»£ç çš„è´¨é‡çº¯é reviewçš„è¯æ•ˆç‡åˆå¾ˆä½ï¼Œè¿™ä¸ªæ—¶å€™sonarå°±å¯ä»¥å¾ˆå¥½çš„å¸®åŠ©å¼€å‘è‡ªåŠ¨åŒ–æ£€æµ‹ä»£ç è´¨é‡ï¼Œé™ä½bugæ•°é‡ï¼Œä¹Ÿå¯ä»¥æ ¹æ®æ‰«æç»“æœå…»æˆè‰¯å¥½çš„ç¼–ç¨‹ä¹ æƒ¯ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥å‡å°‘æµ‹è¯•çš„å·¥ä½œé‡ï¼ŒçœŸæ­£æå‡æ•´ä¸ªå›¢é˜Ÿæ•ˆç‡ï¼Œå®ç°devopsç†å¿µã€‚\nå‰æ jenkinsã€sonarqubeæœåŠ¡å·²ç»æ­å»ºå®Œæˆï¼Œjenkinså®‰è£…sonaræ’ä»¶SonarQube Scanner for Jenkinsï¼Œjenkinsã€sonarqubeå®‰è£…Dependency-Checkæ’ä»¶OWASP Dependency-Check Plugin\nç‰ˆæœ¬ï¼šjenkins2.166ï¼Œsonarqube6.7.6\né…ç½®  ä¸‹è½½å®‰è£…jenkinsæ’ä»¶\n[ç³»ç»Ÿç®¡ç†]-[æ’ä»¶ç®¡ç†]-[å¯é€‰æ’ä»¶]-[SonarQube Scanner for Jenkins]\n SonarQubeç”Ÿæˆtokenï¼Œè¿™ä¸ªtokenä¸ä¼šæ˜¾ç¤ºç¬¬äºŒæ¬¡ï¼Œæ‰€ä»¥ä¸€å®šè¦è®°ä½\n SonarQubeé…ç½®Dependency-Check\n[é…ç½®]-[Dependency-Check]\n[æ³¨æ„ï¼š]è¿™é‡Œå»æ‰ ${WORKSPACE}/ï¼Œå¦åˆ™å°†æŠ¥\n[INFO] Dependency-Check XML report does not exists. Please check property sonar.dependencyCheck.reportPath:/data/jenkinsHome/workspace/xxx/${WORKSPACE}/dependency-check-report.xml   åœ¨pom.xmlæ–‡ä»¶ä¸­æ·»åŠ \n\u0026lt;plugin\u0026gt; \u0026lt;groupId\u0026gt;org.sonarsource.scanner.maven\u0026lt;/groupId\u0026gt; \u0026lt;artifactId\u0026gt;sonar-maven-plugin\u0026lt;/artifactId\u0026gt; \u0026lt;version\u0026gt;3.6.0.1398\u0026lt;/version\u0026gt; \u0026lt;/plugin\u0026gt;  é…ç½®jenkins\n[ç³»ç»Ÿç®¡ç†]-[ç³»ç»Ÿè®¾ç½®]-[SonarQube servers]\n sonaræ·»åŠ webhook\nåœ¨ä»£ç æ‰«ææˆåŠŸåï¼Œæ‰«æç»“æœéœ€è¦å›è°ƒjenkinsï¼Œæ·»åŠ çš„Jenkinsçš„webhookç»“æ„ä¸ºï¼šhttp://[jenkins_url]/sonarqube-webhook/\n[é…ç½®]-[webå›è°ƒæ¥å£]-[URL]\n ç¼–è¾‘jenkins pipeline\nåœ¨jenkinsfileæ–‡ä»¶ä¸­æ·»åŠ é…ç½®\nstage('ä¾èµ–å®‰å…¨æ£€æŸ¥') { steps{ dependencyCheckAnalyzer datadir: '', hintsFile: '', includeCsvReports: false, includeHtmlReports: true, includeJsonReports: false, includeVulnReports: true, isAutoupdateDisabled: false, outdir: '', scanpath: '', skipOnScmChange: false, skipOnUpstreamChange: false, suppressionFile: '', zipExtensions: '' } } stage('é™æ€ä»£ç æ£€æŸ¥') { steps { echo \u0026quot;starting codeAnalyze with SonarQube......\u0026quot; withSonarQubeEnv('sonar') { //æ³¨æ„è¿™é‡ŒwithSonarQubeEnv()ä¸­çš„å‚æ•°è¦ä¸ä¹‹å‰SonarQube serversä¸­Nameçš„é…ç½®ç›¸åŒ withMaven(maven: 'M3') { sh \u0026quot;mvn clean package -Dmaven.test.skip=true sonar:sonar -Dsonar.projectKey={é¡¹ç›®key} -Dsonar.projectName={é¡¹ç›®åç§°} -Dsonar.projectVersion={é¡¹ç›®ç‰ˆæœ¬} -Dsonar.sourceEncoding=UTF-8 -Dsonar.exclusions=src/test/** -Dsonar.sources=src/ -Dsonar.java.binaries=target/classes -Dsonar.host.url={SonarQubeåœ°å€} -Dsonar.login={SonarQubeçš„token}\u0026quot; } } script { timeout(1) { //è¿™é‡Œè®¾ç½®è¶…æ—¶æ—¶é—´1åˆ†é’Ÿï¼Œä¸ä¼šå‡ºç°ä¸€ç›´å¡åœ¨æ£€æŸ¥çŠ¶æ€ //åˆ©ç”¨sonar webhookåŠŸèƒ½é€šçŸ¥pipelineä»£ç æ£€æµ‹ç»“æœï¼Œæœªé€šè¿‡è´¨é‡é˜ˆï¼Œpipelineå°†ä¼šfail def qg = waitForQualityGate('sonar') //æ³¨æ„ï¼šè¿™é‡ŒwaitForQualityGate()ä¸­çš„å‚æ•°ä¹Ÿè¦ä¸ä¹‹å‰SonarQube serversä¸­Nameçš„é…ç½®ç›¸åŒ if (qg.status != 'OK') { error \u0026quot;æœªé€šè¿‡Sonarqubeçš„ä»£ç è´¨é‡é˜ˆæ£€æŸ¥ï¼Œè¯·åŠæ—¶ä¿®æ”¹ï¼failure: ${qg.status}\u0026quot; } } } } }  å‚æ•°è§£é‡Šï¼š\n sonar.projectKeyï¼šé¡¹ç›®key (å¿…å¡«é¡¹) sonar.projectNameï¼šé¡¹ç›®åç§°ï¼ˆå¿…å¡«é¡¹ï¼‰ sonar.projectVersionï¼šé¡¹ç›®ç‰ˆæœ¬ï¼ˆå¿…å¡«é¡¹ï¼‰ sonar.sourcesï¼šæºç ä½ç½®(ç›¸å¯¹è·¯å¾„ï¼‰ sonar.java.binariesï¼šç¼–è¯‘åçš„classä½ç½®ï¼ˆå¿…å¡«é¡¹ï¼Œç›¸å¯¹è·¯å¾„åŒä¸Šï¼‰ sonar.exclusionsï¼šæ’é™¤çš„æ‰«æçš„æ–‡ä»¶è·¯å¾„ sonar.host.urlï¼šSonarQubeåœ°å€ sonar.loginï¼šSonarQubeç”Ÿæˆçš„token   è¿è¡Œ æ‰§è¡Œjenkinsæ„å»ºï¼Œæ„å»ºæˆåŠŸåä¼šæ˜¾ç¤ºå¦‚ä¸‹ï¼Œåˆ™è¯æ˜sonarä»£ç æ‰«ææˆåŠŸä¸”é€šè¿‡ä»£ç è´¨é‡é˜ˆæ£€æŸ¥ æŸ¥çœ‹sonaræŠ¥å‘Šï¼Œè¿™é‡Œæœ‰ä¸¤ç§æ–¹å¼\n å¯ç›´æ¥ç™»å½•SonarQubeæŸ¥çœ‹æŠ¥å‘Š  ä¹Ÿå¯ç›´æ¥åœ¨jenkinsé¡µé¢ç‚¹å‡»SonarQubeå›¾æ ‡è¿›å…¥ï¼Œç‚¹å‡»ä»¥ä¸‹æ ‡è®°å‡å¯è¿›å»   å…¶ä»– é—®é¢˜ä¸€ï¼šæ— æ³•æ‰«æä»£ç ï¼Œé”™è¯¯æç¤º hudson.remoting.ProxyException: hudson.AbortException: SonarQube installation defined in this job (sonar) does not match any configured installation. Number of installations that can be configured: 1. If you want to reassign jobs to a different SonarQube installation, check the documentation under https://redirect.sonarsource.com/plugins/jenkins.html at hudson.plugins.sonar.SonarInstallation.checkValid(SonarInstallation.java:94) at hudson.plugins.sonar.SonarBuildWrapper.setUp(SonarBuildWrapper.java:67) at org.jenkinsci.plugins.workflow.steps.CoreWrapperStep$Execution.start(CoreWrapperStep.java:80) at org.jenkinsci.plugins.workflow.cps.DSL.invokeStep(DSL.java:268) Caused: hudson.remoting.ProxyException: org.codehaus.groovy.runtime.InvokerInvocationException: hudson.AbortException: SonarQube installation defined in this job (sonar) does not match any configured installation. Number of installations that can be configured: 1. If you want to reassign jobs to a different SonarQube installation, check the documentation under https://redirect.sonarsource.com/plugins/jenkins.html at org.jenkinsci.plugins.workflow.cps.CpsStepContext.replay(CpsStepContext.java:499) at org.jenkinsci.plugins.workflow.cps.DSL.invokeStep(DSL.java:295) at org.jenkinsci.plugins.workflow.cps.DSL.invokeStep(DSL.java:207) at org.jenkinsci.plugins.workflow.cps.DSL.invokeDescribable(DSL.java:395) at org.jenkinsci.plugins.workflow.cps.DSL.invokeMethod(DSL.java:179) at org.jenkinsci.plugins.workflow.cps.CpsScript.invokeMethod(CpsScript.java:122) at sun.reflect.GeneratedMethodAccessor1200.invoke(Unknown Source) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) at java.lang.reflect.Method.invoke(Method.java:498) at org.codehaus.groovy.reflection.CachedMethod.invoke(CachedMethod.java:93) at groovy.lang.MetaMethod.doMethodInvoke(MetaMethod.java:325) at groovy.lang.MetaClassImpl.invokeMethod(MetaClassImpl.java:1213) at groovy.lang.MetaClassImpl.invokeMethod(MetaClassImpl.java:1022) at org.codehaus.groovy.runtime.callsite.PogoMetaClassSite.call(PogoMetaClassSite.java:42) at org.codehaus.groovy.runtime.callsite.CallSiteArray.defaultCall(CallSiteArray.java:48) at org.codehaus.groovy.runtime.callsite.AbstractCallSite.call(AbstractCallSite.java:113) at org.kohsuke.groovy.sandbox.impl.Checker$1.call(Checker.java:157) at org.kohsuke.groovy.sandbox.GroovyInterceptor.onMethodCall(GroovyInterceptor.java:23) at org.jenkinsci.plugins.scriptsecurity.sandbox.groovy.SandboxInterceptor.onMethodCall(SandboxInterceptor.java:155) at org.kohsuke.groovy.sandbox.impl.Checker$1.call(Checker.java:155) at org.kohsuke.groovy.sandbox.impl.Checker.checkedCall(Checker.java:159) at org.kohsuke.groovy.sandbox.impl.Checker.checkedCall(Checker.java:129) at org.kohsuke.groovy.sandbox.impl.Checker.checkedCall(Checker.java:129) at org.kohsuke.groovy.sandbox.impl.Checker.checkedCall(Checker.java:129) at com.cloudbees.groovy.cps.sandbox.SandboxInvoker.methodCall(SandboxInvoker.java:17) Caused: hudson.remoting.ProxyException: java.lang.IllegalArgumentException: Failed to prepare withSonarQubeEnv step at org.jenkinsci.plugins.workflow.cps.DSL.invokeDescribable(DSL.java:397) at org.jenkinsci.plugins.workflow.cps.DSL.invokeMethod(DSL.java:179) at org.jenkinsci.plugins.workflow.cps.CpsScript.invokeMethod(CpsScript.java:122) at sun.reflect.GeneratedMethodAccessor1200.invoke(Unknown Source) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) at java.lang.reflect.Method.invoke(Method.java:498) at org.codehaus.groovy.reflection.CachedMethod.invoke(CachedMethod.java:93) at groovy.lang.MetaMethod.doMethodInvoke(MetaMethod.java:325) at groovy.lang.MetaClassImpl.invokeMethod(MetaClassImpl.java:1213) at groovy.lang.MetaClassImpl.invokeMethod(MetaClassImpl.java:1022) at org.codehaus.groovy.runtime.callsite.PogoMetaClassSite.call(PogoMetaClassSite.java:42) at org.codehaus.groovy.runtime.callsite.CallSiteArray.defaultCall(CallSiteArray.java:48) at org.codehaus.groovy.runtime.callsite.AbstractCallSite.call(AbstractCallSite.java:113) at org.kohsuke.groovy.sandbox.impl.Checker$1.call(Checker.java:157) at org.kohsuke.groovy.sandbox.GroovyInterceptor.onMethodCall(GroovyInterceptor.java:23) at org.jenkinsci.plugins.scriptsecurity.sandbox.groovy.SandboxInterceptor.onMethodCall(SandboxInterceptor.java:155) at org.kohsuke.groovy.sandbox.impl.Checker$1.call(Checker.java:155) at org.kohsuke.groovy.sandbox.impl.Checker.checkedCall(Checker.java:159) at org.kohsuke.groovy.sandbox.impl.Checker.checkedCall(Checker.java:129) at org.kohsuke.groovy.sandbox.impl.Checker.checkedCall(Checker.java:129) at org.kohsuke.groovy.sandbox.impl.Checker.checkedCall(Checker.java:129) at com.cloudbees.groovy.cps.sandbox.SandboxInvoker.methodCall(SandboxInvoker.java:17) at WorkflowScript.run(WorkflowScript:27) at ___cps.transform___(Native Method) at com.cloudbees.groovy.cps.impl.ContinuationGroup.methodCall(ContinuationGroup.java:57) at com.cloudbees.groovy.cps.impl.FunctionCallBlock$ContinuationImpl.dispatchOrArg(FunctionCallBlock.java:109) at com.cloudbees.groovy.cps.impl.FunctionCallBlock$ContinuationImpl.fixArg(FunctionCallBlock.java:82) at sun.reflect.GeneratedMethodAccessor249.invoke(Unknown Source) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) at java.lang.reflect.Method.invoke(Method.java:498) at com.cloudbees.groovy.cps.impl.ContinuationPtr$ContinuationImpl.receive(ContinuationPtr.java:72) at com.cloudbees.groovy.cps.impl.ClosureBlock.eval(ClosureBlock.java:46) at com.cloudbees.groovy.cps.Next.step(Next.java:83) at com.cloudbees.groovy.cps.Continuable$1.call(Continuable.java:174) at com.cloudbees.groovy.cps.Continuable$1.call(Continuable.java:163) at org.codehaus.groovy.runtime.GroovyCategorySupport$ThreadCategoryInfo.use(GroovyCategorySupport.java:122) at org.codehaus.groovy.runtime.GroovyCategorySupport.use(GroovyCategorySupport.java:261) at com.cloudbees.groovy.cps.Continuable.run0(Continuable.java:163) at org.jenkinsci.plugins.workflow.cps.SandboxContinuable.access$101(SandboxContinuable.java:34) at org.jenkinsci.plugins.workflow.cps.SandboxContinuable.lambda$run0$0(SandboxContinuable.java:59) at org.jenkinsci.plugins.scriptsecurity.sandbox.groovy.GroovySandbox.runInSandbox(GroovySandbox.java:121) at org.jenkinsci.plugins.workflow.cps.SandboxContinuable.run0(SandboxContinuable.java:58) at org.jenkinsci.plugins.workflow.cps.CpsThread.runNextChunk(CpsThread.java:182) at org.jenkinsci.plugins.workflow.cps.CpsThreadGroup.run(CpsThreadGroup.java:332) at org.jenkinsci.plugins.workflow.cps.CpsThreadGroup.access$200(CpsThreadGroup.java:83) at org.jenkinsci.plugins.workflow.cps.CpsThreadGroup$2.call(CpsThreadGroup.java:244) at org.jenkinsci.plugins.workflow.cps.CpsThreadGroup$2.call(CpsThreadGroup.java:232) at org.jenkinsci.plugins.workflow.cps.CpsVmExecutorService$2.call(CpsVmExecutorService.java:64) at java.util.concurrent.FutureTask.run(FutureTask.java:266) at hudson.remoting.SingleLaneExecutorService$1.run(SingleLaneExecutorService.java:131) at jenkins.util.ContextResettingExecutorService$1.run(ContextResettingExecutorService.java:28) at jenkins.security.ImpersonatingExecutorService$1.run(ImpersonatingExecutorService.java:59) at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511) at java.util.concurrent.FutureTask.run(FutureTask.java:266) at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) at java.lang.Thread.run(Thread.java:748) Finished: FAILURE  åŸå› ï¼šwithSonarQubeEnv()ä¸­çš„å‚æ•°ä¸ä¹‹å‰SonarQube serversä¸­Nameçš„é…ç½®ä¸åŒï¼Œå¯¼è‡´æ²¡æœ‰æ‰¾åˆ°æ‰¾åˆ°SonarQube\né—®é¢˜äºŒï¼šSonarQubeçš„tokené…ç½®ä¸å¯¹ï¼Œå¯¼è‡´æ— æ³•è¿æ¥sonar [ERROR] Failed to execute goal org.sonarsource.scanner.maven:sonar-maven-plugin:3.6.0.1398:sonar (default-cli) on project callcenter: Not authorized. Please check the properties sonar.login and sonar.password. -\u0026gt; [Help 1] [ERROR] [ERROR] To see the full stack trace of the errors, re-run Maven with the -e switch. [ERROR] Re-run Maven using the -X switch to enable full debug logging. [ERROR] [ERROR] For more information about the errors and possible solutions, please read the following articles: [ERROR] [Help 1] http://cwiki.apache.org/confluence/display/MAVEN/MojoExecutionException [Pipeline] } [withMaven] artifactsPublisher - Archive artifact pom.xml under cn/keking/callcenter/callcenter/0.0.1-SNAPSHOT/callcenter-0.0.1-SNAPSHOT.pom [withMaven] artifactsPublisher - Archive artifact target/callcenter-0.0.1-SNAPSHOT.jar under cn/keking/callcenter/callcenter/0.0.1-SNAPSHOT/callcenter-0.0.1-SNAPSHOT.jar [withMaven] artifactsPublisher - Archive artifact target/callcenter-0.0.1-SNAPSHOT-api.jar under cn/keking/callcenter/callcenter/0.0.1-SNAPSHOT/callcenter-0.0.1-SNAPSHOT-api.jar [withMaven] junitPublisher - Archive test results for Maven artifact cn.keking.callcenter:callcenter:jar:0.0.1-SNAPSHOT generated by maven-surefire-plugin:test (default-test): target/surefire-reports/*.xml [withMaven] junitPublisher - Jenkins JUnit Attachments Plugin not found, can't publish test attachments.Recording test results None of the test reports contained any result [withMaven] Jenkins Task Scanner Plugin not found, don't display results of source code scanning for 'TODO' and 'FIXME' in pipeline screen. [withMaven] Publishers: Pipeline Graph Publisher: 1 ms, Generated Artifacts Publisher: 891 ms, Junit Publisher: 4 ms, Dependencies Fingerprint Publisher: 5 ms [Pipeline] // withMaven [Pipeline] } WARN: Unable to locate 'report-task.txt' in the workspace. Did the SonarScanner succedeed?  åŸå› ï¼šsonar.loginçš„tokené…ç½®ä¸æ­£ç¡®æˆ–è€…æ²¡æœ‰é…ç½®\né—®é¢˜ä¸‰ï¼šjenkins pipelineåœ¨SonarQubeå›è°ƒæ—¶æ˜¾ç¤ºè¶…æ—¶ [Pipeline] waitForQualityGate Checking status of SonarQube task 'AWlX97LSgWqXn-z33SO5' on server 'sonar' SonarQube task 'AWlX97LSgWqXn-z33SO5' status is 'IN_PROGRESS' Cancelling nested steps due to timeout  åŸå› ï¼šSonarQubeæ²¡æœ‰é…ç½®webhookå›è°ƒï¼Œå¯¼è‡´è¯·æ±‚è¶…æ—¶ï¼ŒæŒ‰ç…§æ­¥éª¤4é…ç½®webhookå³å¯è§£å†³\né—®é¢˜å››ï¼šsonaræ‰¾ä¸åˆ°Dependency-Check XML [INFO] Sensor Dependency-Check [dependencycheck] [INFO] Process Dependency-Check report [INFO] Dependency-Check XML report does not exists. Please check property sonar.dependencyCheck.reportPath:/data/jenkinsHome/workspace/xxx/${WORKSPACE}/dependency-check-report.xml [INFO] Analysis skipped/aborted due to missing report file [INFO] Dependency-Check HTML report does not exists. Please check property sonar.dependencyCheck.htmlReportPath:/data/jenkinsHome/workspace/xxx/${WORKSPACE}/dependency-check-report.html [INFO] HTML-Dependency-Check report does not exist.  åŸå› ï¼šSonarQubeé…ç½®Dependency-Checkæ’ä»¶æœ‰è¯¯ï¼ŒæŒ‰ç…§ä¸Šæ–‡é…ç½®å³å¯\nç»“è¯­ sonarä¸jenkinsé›†æˆçš„æ–¹å¼è¿˜æœ‰å¾ˆå¤šï¼Œä¸æ­¢pipeline+mavenè¿™ä¸€ç§ï¼Œè¿˜æœ‰é…ç½®åœ¨jenkinsæ„å»ºä»»åŠ¡ä¸­ã€ç›´æ¥ä½¿ç”¨sonarè„šæœ¬ç­‰æ–¹æ³•ã€‚é‡‡ç”¨è¿™æ ·æ–¹æ³•ï¼Œä¸€æ–¹é¢æ˜¯é…ç½®ç›¸å¯¹ç®€å•ï¼Œä¸éœ€è¦æ¯ä¸ªæ„å»ºä»»åŠ¡éƒ½è¿›è¡Œé…ç½®ï¼Œåªéœ€è¦å°†jenkinsfileä¸­æ‹·å…¥ç›¸åº”ä»£ç å¹¶ä¿®æ”¹å‡ ä¸ªå‚æ•°å³å¯ã€‚åŒæ—¶å¯ä»¥åœ¨é™æ€ä»£ç æ‰«ææœŸé—´å®Œæ•´mavenæ‰“åŒ…ï¼Œå‡å°‘æŒç»­é›†æˆçš„æ—¶é—´ã€‚\n","date":1551921279,"expirydate":-62135596800,"kind":"page","lang":"zh","lastmod":1551921279,"objectID":"655d46de27435ce51770143eb117231f","permalink":"https://guoxudong.io/post/sonar-pipline/","publishdate":"2019-03-07T09:14:39+08:00","relpermalink":"/post/sonar-pipline/","section":"post","summary":"åœ¨devopsç†å¿µä¸­ï¼ŒCI/CDæ¯«æ— ç–‘é—®æ˜¯æœ€é‡è¦çš„ä¸€ç¯ï¼Œè€Œä»£ç è´¨é‡æ£€æŸ¥åˆ™æ˜¯CIä¸­å¿…ä¸å¯å°‘çš„ä¸€æ­¥ã€‚åœ¨æ•æ·å¼€å‘çš„æ€æƒ³ä¸‹ï¼Œä»£ç çš„è¿­ä»£å‘¨æœŸå˜çŸ­ï¼Œäº¤ä»˜é€Ÿåº¦æå‡ï¼Œè¿™ä¸ªæ—¶å€™ä»£ç çš„è´¨é‡å°±å¾ˆéš¾ä¿è¯ï¼Œæµ‹è¯•åªèƒ½ä¿è¯åŠŸèƒ½å®Œæ•´ä¸å¯ç”¨ï¼Œè€Œä»£ç çš„è´¨é‡çº¯é reviewçš„è¯æ•ˆç‡åˆå¾ˆä½ï¼Œè¿™ä¸ªæ—¶å€™sonar...","tags":["devops","jenkins","sonar"],"title":"Jenkins Pipelineé›†æˆSonarè¿›è¡Œä»£ç è´¨é‡æ£€æµ‹","type":"post"},{"authors":["éƒ­æ—­ä¸œ"],"categories":["kubernetes"],"content":" å‰è¨€ éšç€å…¬å¸å®¹å™¨åŒ–çš„æ·±å…¥ï¼Œè¶Šæ¥è¶Šå¤šçš„æœåŠ¡é™†ç»­è¿ç§»åˆ°kubernetesé›†ç¾¤ä¸­ï¼Œæœ‰äº›é—®é¢˜åœ¨æµ‹è¯•ç¯å¢ƒå¹¶æœªå‡¸æ˜¾ï¼Œä½†æ˜¯åœ¨ç”Ÿäº§ç¯å¢ƒä¸­è¿™äº›é—®é¢˜å°±æ˜¾å¾—æ ¼å¤–çš„æ‰çœ¼ã€‚è¿™é‡Œå°±å¯¹å®è·µä¸­kubernetesé›†ç¾¤ä¸­çš„7å±‚è´Ÿè½½å‡è¡¡å™¨ingressé‡åˆ°çš„é—®é¢˜è¿›è¡Œæ€»ç»“ã€‚\nHTTP(S)è´Ÿè½½å‡è¡¡å™¨-ingress Ingressæ˜¯kubernetes APIçš„æ ‡å‡†èµ„æºç±»å‹ä¹‹ä¸€ï¼Œå…¶æœ¬è´¨å°±æ˜¯ä¸€ç»„åŸºäºDNSåç§°(host)æˆ–URLè·¯å¾„æŠŠè¯·æ±‚è½¬å‘è‡³æŒ‡å®šçš„Serviceèµ„æºçš„è§„åˆ™ï¼Œç”¨äºå°†é›†ç¾¤å¤–çš„è¯·æ±‚æµé‡è½¬å‘è‡³é›†ç¾¤å†…éƒ¨å®ŒæˆæœåŠ¡å‘å¸ƒã€‚\nIngressæ§åˆ¶å™¨(Ingress Controller)å¯ä»¥ç”±ä»»ä½•å…·æœ‰åå‘ä»£ç†(HTTP/HTTPS)åŠŸèƒ½çš„æœåŠ¡ç¨‹åºå®ç°ï¼Œå¦‚Nginxã€Envoyã€HAProxyã€Vulcandå’ŒTraefikç­‰ã€‚Ingressæ§åˆ¶å™¨æœ¬èº«ä¹Ÿä½œä¸ºPodå¯¹è±¡ä¸è¢«ä»£ç†çš„è¿è¡Œä¸ºPodèµ„æºçš„åº”ç”¨è¿è¡ŒäºåŒä¸€ç½‘ç»œä¸­ã€‚æˆ‘ä»¬åœ¨è¿™é‡Œé€‰æ‹©äº†NGINX Ingress Controllerï¼Œç”±äºå¯¹NGINXçš„é…ç½®è¾ƒä¸ºç†Ÿæ‚‰ï¼ŒåŒæ—¶æˆ‘ä»¬ä½¿ç”¨çš„kubernetesæ˜¯é˜¿é‡Œäº‘çš„å®¹å™¨æœåŠ¡ï¼Œæ„å»ºé›†ç¾¤çš„æ—¶å€™ï¼Œå®¹å™¨æœåŠ¡ä¼šè‡ªå¸¦NGINX Ingress Controllerã€‚\næ ¹æ®å®é™…æƒ…å†µIngressè°ƒä¼˜ 1. è§£å†³400 Request Header Or Cookie Too Largeé—®é¢˜ image: caption: \u0026ldquo;Image from: Pexels\u0026ldquo; focal_point: \u0026ldquo;\u0026rdquo;\npreview_only: false ç°è±¡ å¾®ä¿¡å°ç¨‹åºéœ€è¦è°ƒç”¨åç«¯æ¥å£ï¼Œéœ€è¦åœ¨headerä¸­ä¼ ä¸€æ®µå¾ˆé•¿çš„tokenå‚æ•°ï¼Œç›´æ¥ä½¿ç”¨æµè§ˆå™¨è®¿é—®è¯¥ç«¯å£å¯ä»¥è®¿é—®é€šï¼Œä½†æ˜¯åœ¨åŠ ä¸Štokenè®¿é—®ä¹‹åï¼Œä¼šæŠ¥â€œ400 Request Header Or Cookie Too Largeâ€\n\u0026lt;html\u0026gt; \u0026lt;head\u0026gt; \u0026lt;title\u0026gt;400 Request Header Or Cookie Too Large\u0026lt;/title\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;center\u0026gt; \u0026lt;h1\u0026gt;400 Bad Request\u0026lt;/h1\u0026gt; \u0026lt;/center\u0026gt; \u0026lt;center\u0026gt;Request Header Or Cookie Too Large\u0026lt;/center\u0026gt; \u0026lt;hr\u0026gt; \u0026lt;center\u0026gt;nginx/1.15.6\u0026lt;/center\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt;  é—®é¢˜å®šä½ ç›´æ¥ä¿®æ”¹Serviceä½¿ç”¨nodeportçš„å½¢å¼è®¿é—®ï¼Œåˆ™æ²¡æœ‰æŠ¥é”™ï¼Œåˆæ­¥å®šä½éœ€è¦åœ¨ingressä¸­nginxé…ç½®å®¢æˆ·ç«¯çš„è¯·æ±‚å¤´ï¼Œè¿›å…¥Ingress Controllerçš„PodæŸ¥è¯¢é…ç½®ï¼Œæœç„¶æ˜¯è¯·æ±‚å¤´ç©ºé—´ä¸è¶³ã€‚\n$ cat nginx.conf | grep client_header_buffer_size client_header_buffer_size 1k; $ cat nginx.conf | grep large_client_header_buffers large_client_header_buffers 4 8k;  è§£å†³æ–¹æ³• åœ¨ingressä¸­æ·»åŠ æ³¨é‡Š\nnginx.ingress.kubernetes.io/server-snippet: client_header_buffer_size 2046k;  image: caption: \u0026ldquo;Image from: Pexels\u0026ldquo; focal_point: \u0026ldquo;\u0026rdquo;\npreview_only: false Server snippet\nUsing the annotation nginx.ingress.kubernetes.io/server-snippet it is possible to add custom configuration in the server configuration block. è¯¥æ³¨é‡Šæ˜¯å°†è‡ªå®šä¹‰é…ç½®åŠ å…¥nginxçš„serveré…ç½®ä¸­\nimage: caption: \u0026ldquo;Image from: Pexels\u0026ldquo; focal_point: \u0026ldquo;\u0026rdquo;\npreview_only: false 2. è§£å†³è¯·æ±‚è¶…æ—¶é—®é¢˜ ç°è±¡ æœ‰ä¸€ä¸ªæ•°æ®å¯¼å‡ºåŠŸèƒ½ï¼Œéœ€è¦å°†å¤§é‡æ•°æ®è¿›è¡Œå¤„ç†ï¼Œç„¶åä»¥Excelæ ¼å¼è¿”å›ï¼Œåœ¨å¯¼å‡ºä¸€ä¸ªå¤§çº¦3Wæ¡æ•°æ®çš„æ—¶å€™ï¼Œå‡ºç°è®¿é—®è¶…æ—¶æƒ…å†µã€‚\nè§£å†³æ–¹æ³• è°ƒæ•´proxy_read_timeoutï¼Œè¿æ¥æˆåŠŸå_ç­‰å€™åç«¯æœåŠ¡å™¨å“åº”æ—¶é—´_å…¶å®å·²ç»è¿›å…¥åç«¯çš„æ’é˜Ÿä¹‹ä¸­ç­‰å€™å¤„ç† åœ¨ingressä¸­æ·»åŠ æ³¨é‡Š\nnginx.ingress.kubernetes.io/proxy-read-timeout: 600   è¿™é‡Œéœ€è¦æ³¨æ„çš„äº‹è¯¥æ³¨é‡Šçš„valueéœ€è¦æ—¶numberç±»å‹ï¼Œä¸èƒ½åŠ sï¼Œå¦åˆ™å°†ä¸ç”Ÿæ•ˆ\n 3. å¢åŠ ç™½åå• ç°è±¡ åœ¨å®é™…çš„ä½¿ç”¨ä¸­ï¼Œä¼šæœ‰ä¸€éƒ¨åˆ†åº”ç”¨éœ€è¦è®¾ç½®åªå¯ä»¥åœ¨åŠå…¬åœºåœ°çš„ç½‘ç»œä½¿ç”¨ï¼Œä¹‹å‰ä½¿ç”¨é˜¿é‡Œäº‘ SLB çš„æ—¶å€™å¯ä»¥é’ˆå¯¹ç«¯å£è¿›è¡Œè®¿é—®æ§åˆ¶ï¼Œä½†æ˜¯ç°åœ¨èµ° ingress ï¼Œéƒ½æ˜¯ä»80 or 443ç«¯å£è¿›ï¼Œæ‰€ä»¥éœ€è¦åœ¨ ingress è®¾ç½®\nè§£å†³æ–¹æ³•  Whitelist source range\nYou can specify allowed client IP source ranges through the nginx.ingress.kubernetes.io/whitelist-source-range annotation. The value is a comma separated list of CIDRs, e.g. 10.0.0.0/24,172.10.0.1.\n åœ¨ ingress é‡Œé…ç½® nginx.ingress.kubernetes.io/whitelist-source-range ï¼Œå¦‚æœ‰å¤šä¸ªipæ®µï¼Œç”¨é€—å·åˆ†éš”å³å¯\nnginx.ingress.kubernetes.io/whitelist-source-range: 10.0.0.0/24  å¦‚æœæƒ³å…¨å±€é€‚ç”¨ï¼Œå¯ä»¥åœ¨é˜¿é‡Œäº‘ SLB é‡Œæ“ä½œï¼Œä¹Ÿå¯ä»¥å°†è¯¥é…ç½®åŠ å…¥åˆ° NGINX ConfigMap ä¸­ã€‚\nimage: caption: \u0026ldquo;Image from: Pexels\u0026ldquo; focal_point: \u0026ldquo;\u0026rdquo;\npreview_only: false æ ¹æ®å·¥ä½œä¸­é‡åˆ°çš„å®é™…é—®é¢˜ï¼ŒæŒç»­æ›´æ–°ä¸­\u0026hellip;\næ€»ç»“ ä½¿ç”¨NGINX ingress controllerçš„å¥½å¤„å°±æ˜¯å¯¹äºnginxé…ç½®ç›¸å¯¹æ¯”è¾ƒç†Ÿæ‚‰ï¼Œæ€§èƒ½ä¹Ÿä¸å·®ã€‚ç›¸å…³nginxé…ç½®çš„å¯¹åº”çš„ingresså¯ä»¥åœ¨ https://kubernetes.github.io/ingress-nginx/user-guide/nginx-configuration/annotations/ ä¸ŠæŸ¥åˆ°ã€‚\n","date":1551854525,"expirydate":-62135596800,"kind":"page","lang":"zh","lastmod":1551854525,"objectID":"395e2ad81521e8cc5dc441a894e886b6","permalink":"https://guoxudong.io/post/k8s-ingress-config/","publishdate":"2019-03-06T14:42:05+08:00","relpermalink":"/post/k8s-ingress-config/","section":"post","summary":"éšç€å…¬å¸å®¹å™¨åŒ–çš„æ·±å…¥ï¼Œè¶Šæ¥è¶Šå¤šçš„æœåŠ¡é™†ç»­è¿ç§»åˆ°kubernetesé›†ç¾¤ä¸­ï¼Œæœ‰äº›é—®é¢˜åœ¨æµ‹è¯•ç¯å¢ƒå¹¶æœªå‡¸æ˜¾ï¼Œä½†æ˜¯åœ¨ç”Ÿäº§ç¯å¢ƒä¸­è¿™äº›é—®é¢˜å°±æ˜¾å¾—æ ¼å¤–çš„æ‰çœ¼ã€‚è¿™é‡Œå°±å¯¹å®è·µä¸­kubernetesé›†ç¾¤ä¸­çš„7å±‚è´Ÿè½½å‡è¡¡å™¨ingressé‡åˆ°çš„é—®é¢˜è¿›è¡Œæ€»ç»“ã€‚","tags":["kubernetes","å®¹å™¨"],"title":"è§£å†³kubernetesä¸­ingress-nginxé…ç½®é—®é¢˜","type":"post"},{"authors":["éƒ­æ—­ä¸œ"],"categories":["kubernetes"],"content":" æ ¹æ®Podå¯¹è±¡çš„requestså’Œlimitså±æ€§ï¼Œkuberneteså°†Podå¯¹è±¡å½’ç±»åˆ°BestEffortã€Burstableå’ŒGuaranteedä¸‰ä¸ªæœåŠ¡è´¨é‡ï¼ˆQuality of Serviceï¼ŒQoSï¼‰ç±»åˆ«ã€‚\n  Guaranteed  cpu:requests=limits memory:requests=limits è¿™ç±»Podå…·æœ‰æœ€é«˜ä¼˜å…ˆçº§  Burstable  è‡³å°‘ä¸€ä¸ªå®¹å™¨è®¾ç½®äº†cpuæˆ–å†…å­˜èµ„æºçš„requests è¿™ç±»Podå…·æœ‰ä¸­ç­‰ä¼˜å…ˆçº§  BestEffort  æœªæœ‰ä»»ä½•ä¸€ä¸ªå®¹å™¨è®¾ç½®requestsæˆ–limitså±æ€§ è¿™ç±»Podå…·æœ‰æœ€ä½ä¼˜å…ˆçº§   åŒçº§åˆ«ä¼˜å…ˆçº§çš„Podèµ„æºåœ¨OOMæ—¶ï¼Œä¸è‡ªèº«çš„requestså±æ€§ç›¸æ¯”ï¼Œå…¶å†…å­˜å ç”¨æ¯”ä¾‹æœ€å¤§çš„Podå¯¹è±¡å°†è¢«é¦–å…ˆæ€æ­»ã€‚å¦‚ä¸Šå›¾åŒå±Burstableç±»åˆ«çš„Pod Aå°†å…ˆäºPod Bè¢«æ€æ­»ï¼Œè™½ç„¶å…¶å†…å­˜ç”¨é‡å°ï¼Œä½†ä¸è‡ªèº«çš„requestså€¼ç›¸æ¯”ï¼Œå®ƒçš„å ç”¨æ¯”ä¾‹95%è¦å¤§äºPod Bçš„80%ã€‚\n","date":1551698293,"expirydate":-62135596800,"kind":"page","lang":"zh","lastmod":1551698293,"objectID":"624af9b10deca3a288bfa7770b4a3f65","permalink":"https://guoxudong.io/post/k8s-qos/","publishdate":"2019-03-04T19:18:13+08:00","relpermalink":"/post/k8s-qos/","section":"post","summary":"æ ¹æ®Podå¯¹è±¡çš„requestså’Œlimitså±æ€§ï¼Œkuberneteså°†Podå¯¹è±¡å½’ç±»åˆ°BestEffortã€Burstableå’ŒGuaranteedä¸‰ä¸ªæœåŠ¡è´¨é‡ï¼ˆQuality of Serviceï¼ŒQoSï¼‰ç±»åˆ«ã€‚","tags":["kubernetes"],"title":"Podè´¨é‡æœåŠ¡ç±»åˆ«(QoS)","type":"post"},{"authors":["éƒ­æ—­ä¸œ"],"categories":["éƒ¨ç½²å®‰è£…"],"content":" å‰è¨€  ç›®å‰çš„é¡¹ç›®æ—¥å¿—éƒ½æ˜¯é€šè¿‡Logtailç›´æ¥é‡‡é›†ï¼ŒæŠ•é€’åˆ°OSSæŒä¹…åŒ–ï¼ŒåŒæ—¶å¯ä»¥é€šè¿‡é˜¿é‡Œäº‘æ—¥å¿—æœåŠ¡ã€devopsè‡ªå»ºå¹³å°è¿›è¡ŒæŸ¥çœ‹ï¼ˆè™½ç„¶å¤§éƒ¨åˆ†äººæ˜¯ç›´æ¥ç™»å½•ECSæŸ¥çœ‹=ã€‚=ï¼‰ï¼Œ åœ¨å¼€å§‹è¿›è¡Œå®¹å™¨åŒ–ä¹‹åï¼ŒåŒæ ·é‡åˆ°æ—¥å¿—çš„é—®é¢˜ï¼Œç›®å‰çš„è§£å†³æ–¹æ¡ˆæ˜¯é˜¿é‡Œäº‘æ—¥å¿—æœåŠ¡æŒä¹…åŒ–å’Œå±•ç°æ ¼å¼åŒ–åçš„æ—¥å¿—ã€ä½¿ç”¨rancheræŸ¥çœ‹å®æ—¶æ—¥å¿—ï¼Œ ä½†æ˜¯ä¹‹å‰ç”±äºrancherå¹³å°å‡ºç°ä¸€äº›é—®é¢˜ï¼Œå¯¼è‡´ä¸èƒ½åŠæ—¶æŸ¥çœ‹æ—¥å¿—çš„æƒ…å†µï¼Œåœ¨è¿™ä¸ªèƒŒæ™¯ä¸‹å¯¹é˜¿é‡Œäº‘æ—¥å¿—æœåŠ¡é‡‡é›†k8sæ—¥å¿—å’Œlivetailè¿›è¡Œæ­å»ºå¹¶è°ƒç ”æ­¤æ–¹æ¡ˆæ˜¯å¦å¯è¡Œã€‚\n ç®€ä»‹ï¼ˆè½¬è‡ªé˜¿é‡Œäº‘å®˜æ–¹æ–‡æ¡£ï¼‰ æ—¥å¿—æœåŠ¡ï¼ˆLog Serviceï¼Œç®€ç§° LOGï¼‰æ˜¯é’ˆå¯¹æ—¥å¿—ç±»æ•°æ®çš„ä¸€ç«™å¼æœåŠ¡ï¼Œåœ¨é˜¿é‡Œå·´å·´é›†å›¢ç»å†å¤§é‡å¤§æ•°æ®åœºæ™¯é”¤ç‚¼è€Œæˆã€‚æ‚¨æ— éœ€å¼€å‘å°±èƒ½å¿«æ·å®Œæˆæ—¥å¿—æ•°æ®é‡‡é›†ã€æ¶ˆè´¹ã€æŠ•é€’ä»¥åŠæŸ¥è¯¢åˆ†æç­‰åŠŸèƒ½ï¼Œæå‡è¿ç»´ã€è¿è¥æ•ˆç‡ï¼Œå»ºç«‹ DT æ—¶ä»£æµ·é‡æ—¥å¿—å¤„ç†èƒ½åŠ›ã€‚\nkubernetesæ—¥å¿—é‡‡é›†ç»„ä»¶å®‰è£… å®‰è£…Logtail  è¿›å…¥é˜¿é‡Œäº‘å®¹å™¨æœåŠ¡æ‰¾åˆ°é›†ç¾¤id  é€šè¿‡sshç™»å½•masterèŠ‚ç‚¹ï¼Œæˆ–è€…ä»»æ„å®‰è£…äº†kubectlå¹¶é…ç½®äº†è¯¥é›†ç¾¤kubeconfigçš„æœåŠ¡å™¨\n æ‰§è¡Œå‘½ä»¤ï¼Œå°†${your_k8s_cluster_id}æ›¿æ¢ä¸ºé›†ç¾¤id\nwget http://logtail-release-cn-hangzhou.oss-cn-hangzhou.aliyuncs.com/kubernetes/alicloud-log-k8s-install.sh -O alicloud-log-k8s-install.sh; chmod 744 ./alicloud-log-k8s-install.sh; sh ./alicloud-log-k8s-install.sh ${your_k8s_cluster_id}   Project k8s-log-${your_k8s_cluster_id}ä¸‹ä¼šè‡ªåŠ¨åˆ›å»ºåä¸ºconfig-operation-logçš„Logstoreï¼Œç”¨äºå­˜å‚¨alibaba-log-controllerçš„è¿è¡Œæ—¥å¿—ã€‚è¯·å‹¿åˆ é™¤æ­¤Logstoreï¼Œå¦åˆ™æ— æ³•ä¸ºalibaba-log-controlleræ’æŸ¥é—®é¢˜ã€‚ è‹¥æ‚¨éœ€è¦å°†æ—¥å¿—é‡‡é›†åˆ°å·²æœ‰çš„Projectï¼Œè¯·æ‰§è¡Œå®‰è£…å‘½ä»¤sh ./alicloud-log-k8s-install.sh${your_k8s_cluster_id} ${your_project_name} ï¼Œå¹¶ç¡®ä¿æ—¥å¿—æœåŠ¡Projectå’Œæ‚¨çš„Kubernetesé›†ç¾¤åœ¨åŒä¸€åœ°åŸŸã€‚  è¯¥æ¡å‘½ä»¤å…¶å®å°±æ˜¯æ‰§è¡Œäº†ä¸€ä¸ªshellè„šæœ¬ï¼Œä½¿ç”¨helmå®‰è£…äº†é‡‡é›†kubernetesé›†ç¾¤æ—¥å¿—çš„ç»„ä»¶\n#!/bin/bash if [ $# -eq 0 ] ; then echo \u0026quot;[Invalid Param], use sudo ./install-k8s-log.sh {your-k8s-cluster-id}\u0026quot; exit 1 fi clusterName=$(echo $1 | tr '[A-Z]' '[a-z]') curl --connect-timeout 5 http://100.100.100.200/latest/meta-data/region-id if [ $? != 0 ]; then echo \u0026quot;[FAIL] ECS meta server connect fail, only support alibaba cloud k8s service\u0026quot; exit 1 fi regionId=`curl http://100.100.100.200/latest/meta-data/region-id` aliuid=`curl http://100.100.100.200/latest/meta-data/owner-account-id` helmPackageUrl=\u0026quot;http://logtail-release-$regionId.oss-$regionId.aliyuncs.com/kubernetes/alibaba-cloud-log.tgz\u0026quot; wget $helmPackageUrl -O alibaba-cloud-log.tgz if [ $? != 0 ]; then echo \u0026quot;[FAIL] download alibaba-cloud-log.tgz from $helmPackageUrl failed\u0026quot; exit 1 fi project=\u0026quot;k8s-log-\u0026quot;$clusterName if [ $# -ge 2 ]; then project=$2 fi echo [INFO] your k8s is using project : $project helm install alibaba-cloud-log.tgz --name alibaba-log-controller \\ --set ProjectName=$project \\ --set RegionId=$regionId \\ --set InstallParam=$regionId \\ --set MachineGroupId=\u0026quot;k8s-group-\u0026quot;$clusterName \\ --set Endpoint=$regionId\u0026quot;-intranet.log.aliyuncs.com\u0026quot; \\ --set AlibabaCloudUserId=\u0026quot;:\u0026quot;$aliuid \\ --set LogtailImage.Repository=\u0026quot;registry.$regionId.aliyuncs.com/log-service/logtail\u0026quot; \\ --set ControllerImage.Repository=\u0026quot;registry.$regionId.aliyuncs.com/log-service/alibabacloud-log-controller\u0026quot; installRst=$? if [ $installRst -eq 0 ]; then echo \u0026quot;[SUCCESS] install helm package : alibaba-log-controller success.\u0026quot; exit 0 else echo \u0026quot;[FAIL] install helm package failed, errno \u0026quot; $installRst exit 0 fi  å‘½ä»¤æ‰§è¡Œåï¼Œä¼šåœ¨kubernetesé›†ç¾¤ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹è¿è¡Œä¸€ä¸ªæ—¥å¿—é‡‡é›†çš„podï¼šlogatail-dsï¼Œè¯¥podä½äºkube-system\n å®‰è£…å®Œæˆåï¼Œå¯ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ¥æŸ¥çœ‹podçŠ¶æ€ï¼Œè‹¥çŠ¶æ€å…¨éƒ¨æˆåŠŸåï¼Œåˆ™è¡¨ç¤ºå®‰è£…å®Œæˆ\n$ helm status alibaba-log-controller LAST DEPLOYED: Thu Nov 22 15:09:35 2018 NAMESPACE: default STATUS: DEPLOYED RESOURCES: ==\u0026gt; v1/ServiceAccount NAME SECRETS AGE alibaba-log-controller 1 6d ==\u0026gt; v1beta1/CustomResourceDefinition NAME AGE aliyunlogconfigs.log.alibabacloud.com 6d ==\u0026gt; v1beta1/ClusterRole alibaba-log-controller 6d ==\u0026gt; v1beta1/ClusterRoleBinding NAME AGE alibaba-log-controller 6d ==\u0026gt; v1beta1/DaemonSet NAME DESIRED CURRENT READY UP-TO-DATE AVAILABLE NODE SELECTOR AGE logtail-ds 16 16 16 16 16 \u0026lt;none\u0026gt; 6d ==\u0026gt; v1beta1/Deployment NAME DESIRED CURRENT UP-TO-DATE AVAILABLE AGE alibaba-log-controller 1 1 1 1 6d ==\u0026gt; v1/Pod(related) NAME READY STATUS RESTARTS AGE logtail-ds-2fqs4 1/1 Running 0 6d logtail-ds-4bz7w 1/1 Running 1 6d logtail-ds-6vg88 1/1 Running 0 6d logtail-ds-7tp6v 1/1 Running 0 6d logtail-ds-9575c 1/1 Running 0 6d logtail-ds-bgq84 1/1 Running 0 6d logtail-ds-kdlhr 1/1 Running 0 6d logtail-ds-lknxw 1/1 Running 0 6d logtail-ds-pdxfk 1/1 Running 0 6d logtail-ds-pf4dz 1/1 Running 0 6d logtail-ds-rzsnw 1/1 Running 0 6d logtail-ds-sqhbv 1/1 Running 0 6d logtail-ds-vvtwn 1/1 Running 0 6d logtail-ds-wwmhg 1/1 Running 0 6d logtail-ds-xbp4j 1/1 Running 0 6d logtail-ds-zpld9 1/1 Running 0 6d alibaba-log-controller-85f8fbb498-nzhc8 1/1 Running 0 6d   é…ç½®æ—¥å¿—ç»„ä»¶å±•ç¤º  åœ¨é›†ç¾¤å†…å®‰è£…å¥½æ—¥å¿—ç»„ä»¶åï¼Œç™»å½•é˜¿é‡Œäº‘æ—¥å¿—æœåŠ¡æ§åˆ¶å°ï¼Œå°±ä¼šå‘ç°æœ‰ä¸€ä¸ªæ–°çš„projectï¼Œåç§°ä¸ºk8s-log-{é›†ç¾¤id}  åˆ›å»ºLogstore  æ•°æ®å¯¼å…¥  é€‰æ‹©æ•°æ®ç±»å‹ä¸­é€‰æ‹©dockeræ ‡å‡†è¾“å‡º  æ•°æ®æºé…ç½®ï¼Œè¿™é‡Œå¯ä»¥ä½¿ç”¨é»˜è®¤çš„  é€‰æ‹©æ•°æ®æº  é…ç½®å¥½ä¹‹åç­‰å¾…1-2åˆ†é’Ÿï¼Œæ—¥å¿—å°±ä¼šè¿›æ¥äº†  ä¸ºäº†å¿«é€ŸæŸ¥è¯¢å’Œè¿‡æ»¤ï¼Œéœ€è¦é…ç½®ç´¢å¼•  æ·»åŠ å®¹å™¨åç§°ã€å‘½åç©ºé—´ã€podåç§°ä½œä¸ºç´¢å¼•ï¼ˆåç»­ä½¿ç”¨livetailéœ€è¦ï¼‰  è¿™æ ·å°±å®Œæˆäº†ä¸€ä¸ªk8sé›†ç¾¤æ—¥å¿—é‡‡é›†å’Œå±•ç¤ºçš„åŸºæœ¬æµç¨‹äº†\n  livetailåŠŸèƒ½ä½¿ç”¨ èƒŒæ™¯ä»‹ç» åœ¨çº¿ä¸Šè¿ç»´çš„åœºæ™¯ä¸­ï¼Œå¾€å¾€éœ€è¦å¯¹æ—¥å¿—é˜Ÿåˆ—ä¸­è¿›å…¥çš„æ•°æ®è¿›è¡Œå®æ—¶ç›‘æ§ï¼Œä»æœ€æ–°çš„æ—¥å¿—æ•°æ®ä¸­æå–å‡ºå…³é”®çš„ä¿¡æ¯è¿›è€Œå¿«é€Ÿåœ°åˆ†æå‡ºå¼‚å¸¸åŸå› ã€‚åœ¨ä¼ ç»Ÿçš„è¿ç»´æ–¹å¼ä¸­ï¼Œå¦‚æœéœ€è¦å¯¹æ—¥å¿—æ–‡ä»¶è¿›è¡Œå®æ—¶ç›‘æ§ï¼Œéœ€è¦åˆ°æœåŠ¡å™¨ä¸Šå¯¹æ—¥å¿—æ–‡ä»¶æ‰§è¡Œå‘½ä»¤tail -fï¼Œå¦‚æœå®æ—¶ç›‘æ§çš„æ—¥å¿—ä¿¡æ¯ä¸å¤Ÿç›´è§‚ï¼Œå¯ä»¥åŠ ä¸Šgrepæˆ–è€…grep -vè¿›è¡Œå…³é”®è¯è¿‡æ»¤ã€‚æ—¥å¿—æœåŠ¡åœ¨æ§åˆ¶å°æä¾›äº†æ—¥å¿—æ•°æ®å®æ—¶ç›‘æ§çš„äº¤äº’åŠŸèƒ½LiveTailï¼Œé’ˆå¯¹çº¿ä¸Šæ—¥å¿—è¿›è¡Œå®æ—¶ç›‘æ§åˆ†æï¼Œå‡è½»è¿ç»´å‹åŠ›ã€‚\nä½¿ç”¨æ–¹æ³•  è¿™é‡Œé€‰æ‹©æ¥æºç±»å‹ä¸ºkubernetesï¼Œå‘½åç©ºé—´ã€podåç§°ã€å®¹å™¨åç§°ä¸ºä¸Šä¸€æ­¥æ–°å»ºçš„3ä¸ªç´¢å¼•çš„å†…å®¹ï¼Œè¿‡æ»¤å…³é”®å­—çš„åŠŸåŠ³ä¸tailå‘½ä»¤ååŠ çš„grepå‘½ä»¤æ˜¯ä¸€æ ·çš„ï¼Œç”¨äºå…³é”®è¯è¿‡æ»¤  ç‚¹å‡»å¼€å¯livetailï¼Œè¿™æ—¶å°±æœ‰å®æ—¶æ—¥å¿—å±•ç¤ºå‡ºæ¥äº†   ä»¥ä¸Šå°±æ˜¯é˜¿é‡Œäº‘livetailæ—¥å¿—æœåŠ¡åŠŸèƒ½\n","date":1550124426,"expirydate":-62135596800,"kind":"page","lang":"zh","lastmod":1550124426,"objectID":"5d98828078eb8a1d588f28fbd4a208cd","permalink":"https://guoxudong.io/post/dashboard-k8s/","publishdate":"2019-02-14T14:07:06+08:00","relpermalink":"/post/dashboard-k8s/","section":"post","summary":"é˜¿é‡Œäº‘æ—¥å¿—æœåŠ¡é‡‡é›†k8sæ—¥å¿—å’ŒlivetailåŠŸèƒ½è°ƒç ”","tags":["é˜¿é‡Œäº‘","æ—¥å¿—","kubernetes"],"title":"é˜¿é‡Œäº‘æ—¥å¿—æœåŠ¡é‡‡é›†k8sæ—¥å¿—å¹¶å®ç°livetailåŠŸèƒ½","type":"post"},{"authors":[],"categories":[],"content":" Welcome to Slides academia\nFeatures  Efficiently write slides in Markdown 3-in-1: Create, Present, and Publish your slides Supports speaker notes Mobile friendly slides  Controls  Next: Right Arrow or Space Previous: Left Arrow Start: Home Finish: End Overview: Esc Speaker notes: S Fullscreen: F Zoom: Alt + Click PDF Export: E  Code Highlighting Inline code: variable\nCode block:\nporridge = \u0026quot;blueberry\u0026quot; if porridge == \u0026quot;blueberry\u0026quot;: print(\u0026quot;Eating...\u0026quot;)  Math In-line math: $x + y = z$\nBlock math:\n$$ f\\left( x \\right) = \\;\\frac{{2\\left( {x + 4} \\right)\\left( {x - 4} \\right)}}{{\\left( {x + 4} \\right)\\left( {x + 1} \\right)}} $$\nFragments Make content appear incrementally\n{{% fragment %}} One {{% /fragment %}} {{% fragment %}} **Two** {{% /fragment %}} {{% fragment %}} Three {{% /fragment %}}  Press Space to play!\nOne  Two  Three \nA fragment can accept two optional parameters:\n class: use a custom style (requires definition in custom CSS) weight: sets the order in which a fragment appears  Speaker Notes Add speaker notes to your presentation\n{{% speaker_note %}} - Only the speaker can read these notes - Press `S` key to view {{% /speaker_note %}}  Press the S key to view the speaker notes!\n Only the speaker can read these notes Press S key to view   Themes  black: Black background, white text, blue links (default) white: White background, black text, blue links league: Gray background, white text, blue links beige: Beige background, dark text, brown links sky: Blue background, thin dark text, blue links   night: Black background, thick white text, orange links serif: Cappuccino background, gray text, brown links simple: White background, black text, blue links solarized: Cream-colored background, dark green text, blue links  Custom Slide Customize the slide style and background\n{{\u0026lt; slide background-image=\u0026quot;/img/boards.jpg\u0026quot; \u0026gt;}} {{\u0026lt; slide background-color=\u0026quot;#0000FF\u0026quot; \u0026gt;}} {{\u0026lt; slide class=\u0026quot;my-style\u0026quot; \u0026gt;}}  Custom CSS Example Let\u0026rsquo;s make headers navy colored.\nCreate assets/css/reveal_custom.css with:\n.reveal section h1, .reveal section h2, .reveal section h3 { color: navy; }  Questions? Ask\nDocumentation\n","date":1549324800,"expirydate":-62135596800,"kind":"page","lang":"zh","lastmod":1549324800,"objectID":"0e6de1a61aa83269ff13324f3167c1a9","permalink":"https://guoxudong.io/slides/example/","publishdate":"2019-02-05T00:00:00Z","relpermalink":"/slides/example/","section":"slides","summary":"An introduction to using academia's Slides feature.","tags":[],"title":"Slides","type":"slides"},{"authors":["éƒ­æ—­ä¸œ"],"categories":["é—®é¢˜è§£å†³"],"content":"  æ–°ç‰ˆç›‘æ§å¤§å±äº18å¹´æœ€åä¸€å¤©æ­£å¼ä¸Šçº¿ï¼Œä¹‹åé™†ç»­è¿›è¡Œäº†å‡ æ¬¡ä¼˜åŒ–å’Œä¿®æ”¹ï¼Œæœ€è¿‘å‘ç°ä¸€ä¸ªæ¯”è¾ƒå¤§çš„bugï¼Œå°±æ˜¯ç›‘æ§æ˜¾ç¤ºçš„æ—¶é—´è½´ä¸å¯¹ï¼Œæ˜¾ç¤ºçš„å°±æ˜¯å’Œç›®å‰çš„æ—¶é—´ç›¸å·®8å°æ—¶ï¼Œè¿™å°±å¼•å‡ºäº†dockerä¸­çš„æ—¶åŒºé—®é¢˜\n é—®é¢˜çš„åŸå›  é»˜è®¤çš„æƒ…å†µï¼Œåœ¨K8Sé‡Œå¯åŠ¨ä¸€ä¸ªå®¹å™¨ï¼Œè¯¥å®¹å™¨çš„è®¾ç½®çš„æ—¶åŒºæ˜¯UTC0ï¼Œä½†æ˜¯å¯¹ç”¨æˆ·è€Œè¨€ï¼Œä¸»æœºç¯å¢ƒå¹¶ä¸åœ¨UTC0ã€‚æˆ‘ä»¬åœ¨UTC8ã€‚å¦‚æœä¸æŠŠå®¹å™¨çš„æ—¶åŒºå’Œä¸»æœºä¸»æœºè®¾ç½®ä¸ºä¸€è‡´ï¼Œåˆ™åœ¨æŸ¥æ‰¾æ—¥å¿—ç­‰æ—¶å€™å°†éå¸¸ä¸æ–¹ä¾¿ï¼Œä¹Ÿå®¹æ˜“é€ æˆè¯¯è§£ã€‚ä½†æ˜¯K8Sä»¥åŠDockerå®¹å™¨æ²¡æœ‰ä¸€ä¸ªç®€ä¾¿çš„è®¾ç½®/å¼€å…³åœ¨ç³»ç»Ÿå±‚é¢åšé…ç½®ã€‚éƒ½éœ€è¦æˆ‘ä»¬ä»å•ä¸ªå®¹å™¨å…¥æ‰‹åšè®¾ç½®ï¼Œå…·ä½“æœ‰ä¸¤ä¸ªæ–¹æ³•ï¼š\n ç›´æ¥ä¿®æ”¹é•œåƒçš„æ—¶é—´è®¾ç½®ï¼Œå¥½å¤„æ˜¯åº”ç”¨éƒ¨ç½²æ—¶æ— éœ€åšç‰¹æ®Šè®¾ç½®ï¼Œä½†æ˜¯éœ€è¦æ‰‹åŠ¨æ„å»ºDockeré•œåƒã€‚ éƒ¨ç½²åº”ç”¨æ—¶ï¼Œå•ç‹¬è¯»å–ä¸»æœºçš„â€œ/etc/localtimeâ€æ–‡ä»¶ï¼Œå³åˆ›å»ºpodæ—¶åŒæ­¥æ—¶åŒºï¼Œæ— éœ€ä¿®æ”¹é•œåƒï¼Œä½†æ˜¯æ¯ä¸ªåº”ç”¨éƒ½è¦å•ç‹¬è®¾ç½®ã€‚  é—®é¢˜çš„è§£å†³ è¿™é‡Œæˆ‘ä»¬é€‰æ‹©ç¬¬äºŒç§æ–¹æ³•ï¼Œå³ä¿®æ”¹éƒ¨ç½²åº”ç”¨çš„yamlæ–‡ä»¶ï¼Œåˆ›å»ºpodæ—¶åŒæ­¥æ—¶åŒº\napiVersion: extensions/v1beta1 kind: Deployment metadata: name: myweb spec: replicas: 2 template: metadata: labels: app: myweb spec: containers: - name: myweb image: nginx:apline ports: - containerPort: 80 #æŒ‚è½½åˆ°podä¸­ volumeMounts: - name: host-time mountPath: /etc/localtime #éœ€è¦è¢«æŒ‚è½½çš„å®¿ä¸»æœºçš„æ—¶åŒºæ–‡ä»¶ volumes: - name: host-time hostPath: path: /etc/localtime  æ•ˆæœå¯¹æ¯” ä¿®æ”¹æ—¶åŒºå‰ ä¿®æ”¹æ—¶åŒºå ","date":1548850693,"expirydate":-62135596800,"kind":"page","lang":"zh","lastmod":1548850693,"objectID":"724a6c0104bf30ec9864841a9ae9bd82","permalink":"https://guoxudong.io/post/pod-timezone/","publishdate":"2019-01-30T20:18:13+08:00","relpermalink":"/post/pod-timezone/","section":"post","summary":"è§£å†³å®¹å™¨ä¸­æ—¶åŒºé—®é¢˜ã€‚","tags":["kubernetes"],"title":"kubernetesä¸­podåŒæ­¥æ—¶åŒºé—®é¢˜","type":"post"},{"authors":["éƒ­æ—­ä¸œ"],"categories":["kubernetes"],"content":"  devopså¹³å°ç‡å…ˆåœ¨å…¬å¸å†…ä½¿ç”¨kubernetesé›†ç¾¤æä¾›åç«¯æœåŠ¡ï¼Œä½†æ˜¯ç”±äºä¹‹å‰ä¸€ç›´å¤„äºæ¢ç´¢é˜¶æ®µï¼Œæ‰€ä»¥ä½¿ç”¨çš„äº‹httpçš„æ–¹å¼æä¾›åç«¯æœåŠ¡ï¼Œä½†æ˜¯åœ¨å¼€å‘ç»Ÿä¸€å…¥å£åï¼Œå‡ºç°äº†è®¿é—®HTTPSé¡µé¢çš„è·¨åŸŸé—®é¢˜ï¼Œç”±æ­¤å¼•å‡ºäº†åç«¯æœåŠ¡é…ç½®SSLè¯ä¹¦çš„é—®é¢˜\n ä½¿ç”¨rancheré…ç½®SSLè¯ä¹¦ ä¸‹è½½SSLè¯ä¹¦æ–‡ä»¶ é¦–å…ˆéœ€è¦è·å¾—SSLè¯ä¹¦æ–‡ä»¶ï¼Œå¯ä»¥ç›´æ¥åœ¨é˜¿é‡Œäº‘SSLè¯ä¹¦ç®¡ç†æ§åˆ¶å°ä¸‹è½½\né€‰ä¸­éœ€è¦ä¸‹è½½è¯ä¹¦ï¼Œé€‰æ‹©ä¸‹è½½nginxè¯ä¹¦ å°†è¯ä¹¦ä¸Šä¼ é¡¹ç›® æ‰“å¼€rancherï¼Œé€‰æ‹©è¦ä½¿ç”¨è¯ä¹¦çš„é¡¹ç›®ï¼Œç‚¹å‡»èµ„æºä¸­çš„è¯ä¹¦\nå°†è¯ä¹¦ä¸Šä¼ é¡¹ç›® æ‰“å¼€rancherï¼Œé€‰æ‹©è¦ä½¿ç”¨è¯ä¹¦çš„é¡¹ç›®ï¼Œç‚¹å‡»èµ„æºä¸­çš„è¯ä¹¦ æ·»åŠ è¯ä¹¦ï¼Œç‚¹å‡»ä»æ–‡ä»¶ä¸Šä¼  ä¸Šä¼ è¯ä¹¦æ–‡ä»¶ä¸­çš„ç§˜é’¥å’Œè¯ä¹¦ï¼Œç‚¹å‡»ä¿å­˜å³å¯\nä½¿ç”¨yamlä¸Šä¼ è¯ä¹¦ è¿™ä¸ªè¯ä¹¦çš„åŸç†å…¶å®æ˜¯åœ¨ç›¸åº”çš„å‘½åç©ºé—´åˆ›å»ºäº†ä¸€ä¸ªåŒ…å«è¯ä¹¦ä¿¡æ¯çš„secrets\napiVersion: v1 data: tls.crt: {ç§é’¥} tls.key: {è¯ä¹¦} kind: Secret metadata: name: keking-cn namespace: devops-plat type: kubernetes.io/tls  åœ¨kubernetesä¸Šè¿è¡Œè¯¥yamlå³å¯\nrancherä¸­è¯ä¹¦ç»‘å®š é€‰ä¸­éœ€è¦ç»‘å®šè¯ä¹¦çš„ingressï¼Œç‚¹å‡»ç¼–è¾‘ï¼Œé€‰ä¸­è¯ä¹¦ï¼Œä¿å­˜å³å¯ï¼ˆç”±äºingress-controllerä¸­æ²¡æœ‰ç»‘å®šé»˜è®¤è¯ä¹¦ï¼Œæ‰€ä»¥è¿™é‡Œä¸èƒ½é€‰ä¸­é»˜è®¤ï¼‰ ä¿å­˜å®Œæ¯•ï¼Œè¯ä¹¦å³å¯ç”Ÿæ•ˆ\n","date":1546090093,"expirydate":-62135596800,"kind":"page","lang":"zh","lastmod":1546090093,"objectID":"3b233c793e2ed8e0e963331c3a77c714","permalink":"https://guoxudong.io/post/https-ingress/","publishdate":"2018-12-29T21:28:13+08:00","relpermalink":"/post/https-ingress/","section":"post","summary":"devopså¹³å°ç‡å…ˆåœ¨å…¬å¸å†…ä½¿ç”¨kubernetesé›†ç¾¤æä¾›åç«¯æœåŠ¡ï¼Œä½†æ˜¯ç”±äºä¹‹å‰ä¸€ç›´å¤„äºæ¢ç´¢é˜¶æ®µï¼Œæ‰€ä»¥ä½¿ç”¨çš„äº‹httpçš„æ–¹å¼æä¾›åç«¯æœåŠ¡ï¼Œä½†æ˜¯åœ¨å¼€å‘ç»Ÿä¸€å…¥å£åï¼Œå‡ºç°äº†è®¿é—®HTTPSé¡µé¢çš„è·¨åŸŸé—®é¢˜ï¼Œç”±æ­¤å¼•å‡ºäº†åç«¯æœåŠ¡é…ç½®SSLè¯ä¹¦çš„é—®é¢˜ã€‚","tags":["kubernetes","é˜¿é‡Œäº‘","rancher"],"title":"ä¸ºingressé…ç½®SSLè¯ä¹¦ï¼Œå®ç°HTTPSè®¿é—®","type":"post"},{"authors":["éƒ­æ—­ä¸œ"],"categories":["é—®é¢˜è§£å†³"],"content":"  è¿‘æœŸç”±äºå…¬å¸éœ€è¦å°†éƒ¨ç½²åœ¨ucloudä¸Šçš„rancherè¿ç§»åˆ°é˜¿é‡Œäº‘ä¸Šï¼Œæ‰€ä»¥å°†éƒ¨ç½²åˆ°é˜¿é‡Œäº‘çš„å›¾ä¸­é‡åˆ°çš„é—®é¢˜å’Œè¸©åˆ°çš„å‘åœ¨è¿™é‡Œè¿›è¡Œè®°å½•ã€‚\n æ— æ³•åˆ é™¤namespace åœ¨å®‰è£…æ–°ç¯å¢ƒçš„rancherä¹‹å‰ï¼Œéœ€è¦å°†kubernetesé›†ç¾¤ä¸­cattle-system nsä¸‹é¢çš„cluster-agentå’Œnode-agentå¹²æ‰ï¼Œè¿™é‡Œæˆ‘é€‰æ‹©ç›´æ¥åˆ é™¤cattle-systemè¿™ä¸ªå‘½åç©ºé—´\nkubectl delete ns cattle-system  ç„¶è€Œé—®é¢˜æ¥äº†ï¼Œåœ¨åˆ é™¤å‘½åç©ºé—´ä¹‹åï¼Œè¿™ä¸ªå‘½åç©ºé—´å¹¶æ²¡æœ‰ç«‹åˆ»è¢«åˆ é™¤ï¼Œè€Œæ˜¯ä¸€ç›´å¤„äºTerminatingçŠ¶æ€ï¼Œè¿™é‡Œæˆ‘ä¸“é—¨å†™äº†ä¸€ç¯‡æ–‡ç« è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œè¿™é‡Œå°±ä¸å†èµ˜è¿°\né˜¿é‡Œäº‘è¯ä¹¦é…ç½® ç”±äºä¹‹å‰ä½¿ç”¨çš„ucloudçš„æœºå™¨è¿›è¡Œæµ‹è¯•ï¼Œä½¿ç”¨é»˜è®¤è‡ªç­¾åè¯ä¹¦å¹¶æ²¡æœ‰ä½¿ç”¨SSLè¯ä¹¦ï¼Œæ‰€ä»¥åœ¨é…ç½®è¯ä¹¦è¿™é‡Œé‡åˆ°çš„è®¸å¤šçš„é—®é¢˜\né¦–å…ˆæ ¹æ®å®˜æ–¹æ–‡æ¡£ä½¿ç”¨æƒå¨CAæœºæ„é¢å‘çš„è¯ä¹¦ï¼Œè¿™é‡Œä½¿ç”¨çš„æ˜¯æœ¬å…¬å¸è‡ªå·±çš„è¯ä¹¦\nè·å–è¯ä¹¦æ–¹æ³•ï¼š ç‚¹å‡»ä¸‹è½½è¯ä¹¦ï¼Œé€‰æ‹©nginxè¯ä¹¦ä¸‹è½½ ä¹‹åå°†ä¸‹è½½çš„è¯ä¹¦ä¸Šä¼ åˆ°rancheræ‰€åœ¨æœåŠ¡å™¨ï¼Œå¹¶é…ç½®å¥½æ•°æ®å·æŒ‚è½½\nå°†ä¸‹é¢ä»£ç çš„æŒ‚è½½åœ°å€æŒ‡å‘è¯ä¹¦æ–‡ä»¶ï¼Œè¿è¡Œä»£ç \n$ docker run -d --restart=unless-stopped \\ -p 80:80 -p 443:443 \\ -v /root/var/log/auditlog:/var/log/auditlog \\ -e AUDIT_LEVEL=3 \\ -v /etc/your_certificate_directory/fullchain.pem:/etc/rancher/ssl/cert.pem \\ -v /etc/your_certificate_directory/privkey.pem:/etc/rancher/ssl/key.pem \\ rancher/rancher:latest --no-cacerts  ä¹‹åä¼šè‡ªåŠ¨å†²dockerhubä¸Šæ‹‰å–æœ€æ–°çš„rancherè¿›è¡Œè¿›è¡Œå®‰è£…ï¼Œä¹‹åä½¿ç”¨å‘½ä»¤\ndocker ps  æŸ¥çœ‹å®¹å™¨æ˜¯å¦åœ¨è¿è¡Œï¼Œå¦‚æœè¿è¡Œæ­£å¸¸ï¼Œåˆ™åç«¯çš„é…ç½®å°±å®Œæˆäº†\nåˆ’é‡ç‚¹ï¼šè¿™æ˜¯æ˜¯åœ¨åç«¯é…ç½®äº†è¯ä¹¦ï¼Œæ‰€ä»¥åœ¨é˜¿é‡Œäº‘çš„é…ç½®ä¸Šè¦ä½¿ç”¨å››å±‚TCPç›‘å¬\nè¿™ä¸ªåœ°æ–¹å¯æ˜¯å‘äº†æˆ‘è®¸ä¹…ï¼Œæˆ‘ä¸€ç›´åœ¨å‰ç«¯é…ç½®httpsä¸ƒå±‚ç›‘å¬ï¼Œå¯¼è‡´ä¸€ç›´æ— æ³•æ­£å¸¸è®¿é—®ï¼Œä¸€åº¦å·²ç»åˆ°äº†æ€€ç–‘äººç”Ÿçš„åœ°æ­¥=ã€‚=\nä¹‹åå°±æ˜¯ç®€å•çš„é˜¿é‡Œäº‘SLBé…ç½®å››å±‚TCPç›‘å¬ï¼Œè¿™é‡Œä¹Ÿå°±ä¸å†èµ˜è¿°äº†\nk8sé›†ç¾¤å¯¼å…¥rancher å‰åç«¯éƒ½å‡†å¤‡å°±ç»ªï¼Œç°åœ¨å°±å¯ä»¥è®¿é—®rancheräº†ï¼Œè®¿é—®rancheræ ¹æ®é¡µé¢æç¤ºè¿›è¡ŒåŸºæœ¬é…ç½®ï¼Œç™»å½•åé€‰æ‹©æ·»åŠ é›†ç¾¤\né€‰æ‹©å¯¼å…¥ç°æœ‰é›†ç¾¤ ä¸ºé›†ç¾¤åˆ›å»ºä¸€ä¸ªrancherä¸­çš„åç§°ï¼Œç„¶åæ ¹æ®æç¤ºå°†å‘½ä»¤æ‹·è´åˆ°k8sé›†ç¾¤æ‰€åœ¨å®¿ä¸»æœºæ‰§è¡Œå³å¯ï¼Œæ³¨æ„ï¼šè¿™é‡Œç”±äºé…ç½®äº†è¯ä¹¦ï¼Œæ‰€ä»¥é€‰æ‹©æœ‰è¯ä¹¦ï¼Œä¸ç»•è¿‡è¯ä¹¦çš„é‚£ä¸ªå‘½ä»¤æ‰§è¡Œï¼Œä¹‹åå°±å¯çœ‹åˆ°é›†ç¾¤æ•°æ®å¯¼å…¥ä¸­ ç­‰å¾…å‡ ç§’å³å¯å¼€å¿ƒçš„ä½¿ç”¨rancheräº†ï¼\nå…³äºrancheréƒ¨ç½²åè®¿é—®é›†ç¾¤apiè¶…æ—¶é—®é¢˜ ç»è¿‡æ’æŸ¥ï¼ŒåŸå› æ˜¯é˜¿é‡Œäº‘åœ¨å®¹å™¨æœåŠ¡å¯¹å¤–è¿æ¥å¤„è®¾ç½®äº†TLSåŒå‘è®¤è¯ï¼Œå¯¼è‡´rancherçš„å¤–ç½‘ipç»å¸¸æ€§çš„è¢«æ‹¦æˆªï¼Œå¯¼è‡´è¶…æ—¶\nè§£å†³åŠæ³•ï¼š\nå¯¹k8sé›†ç¾¤ä¸­rancherçš„cattle-cluster-agentä¼ é€’å†…ç½‘å‚æ•°ï¼Œå°†å…¶é…ç½®ä¸ºå†…ç½‘è¿æ¥ï¼Œå°±å¯ä»¥æ­£å¸¸è®¿é—®äº†\nkubectl -n cattle-system patch deployments cattle-cluster-agent --patch '{ \u0026quot;spec\u0026quot;: { \u0026quot;template\u0026quot;: { \u0026quot;spec\u0026quot;: { \u0026quot;hostAliases\u0026quot;: [{ \u0026quot;hostnames\u0026quot;:[\u0026quot;rancher.keking.cn\u0026quot;], #rancherçš„åŸŸå \u0026quot;ip\u0026quot;: \u0026quot;10.0.0.219\u0026quot; #rancheréƒ¨ç½²åœ°å€ }] } } } }'  ","date":1543487293,"expirydate":-62135596800,"kind":"page","lang":"zh","lastmod":1543487293,"objectID":"483d7eaa973ba9d89a2186ac056e2a42","permalink":"https://guoxudong.io/post/install-rancher/","publishdate":"2018-11-29T18:28:13+08:00","relpermalink":"/post/install-rancher/","section":"post","summary":"è¿‘æœŸç”±äºå…¬å¸éœ€è¦å°†éƒ¨ç½²åœ¨ucloudä¸Šçš„rancherè¿ç§»åˆ°é˜¿é‡Œäº‘ä¸Šï¼Œæ‰€ä»¥å°†éƒ¨ç½²åˆ°é˜¿é‡Œäº‘çš„å›¾ä¸­é‡åˆ°çš„é—®é¢˜å’Œè¸©åˆ°çš„å‘åœ¨è¿™é‡Œè¿›è¡Œè®°å½•ã€‚","tags":["å®¹å™¨","é˜¿é‡Œäº‘","rancher"],"title":"é˜¿é‡Œäº‘éƒ¨ç½²rancher2.1é‡‡å‘è®°","type":"post"},{"authors":["éƒ­æ—­ä¸œ"],"categories":["é—®é¢˜è§£å†³"],"content":"  è¿‘æœŸç”±äºå…¬å¸éœ€è¦å°†éƒ¨ç½²åœ¨ucloudä¸Šçš„rancherè¿ç§»åˆ°é˜¿é‡Œäº‘ä¸Šï¼Œæ‰€ä»¥éœ€è¦å°†åŸæœ‰Rancherä¾èµ–çš„namespaceï¼ˆcattle-systemï¼‰åˆ é™¤ï¼Œä½†åœ¨åˆ é™¤ä¸­å‡ºç°äº†åˆ é™¤çš„namespaceä¸€ç›´å¤„äºTerminatingçŠ¶æ€çš„æƒ…å†µ\n è§£å†³æ–¹æ¡ˆ è¿è¡Œå‘½ä»¤ï¼š\nkubectl edit namespaces cattle-system  å¯ä»¥çœ‹åˆ°namespacesçš„yamlé…ç½®ï¼š\nå°†finalizerçš„valueåˆ é™¤ï¼Œè¿™é‡Œå°†å…¶è®¾ç½®ä¸º[]\nä¿å­˜å³å¯çœ‹åˆ°è¯¥namespaceå·²è¢«åˆ é™¤\n","date":1542363493,"expirydate":-62135596800,"kind":"page","lang":"zh","lastmod":1542363493,"objectID":"fca2e4368aeab4e02ada1c55350b0100","permalink":"https://guoxudong.io/post/k8s-d-n/","publishdate":"2018-11-16T18:18:13+08:00","relpermalink":"/post/k8s-d-n/","section":"post","summary":"kubernetesè§£å†³åˆ é™¤çš„namespaceä¸€ç›´å¤„äºTerminatingçŠ¶æ€çš„æƒ…å†µã€‚","tags":["kubernetes"],"title":"Kubernetesåˆ é™¤ä¸€ç›´å¤„äºTerminatingçŠ¶æ€çš„namespace","type":"post"},{"authors":["éƒ­æ—­ä¸œ"],"categories":["kubernetes"],"content":"  éšç€2017å¹´AWSï¼ŒAzureå’Œé˜¿é‡Œäº‘ç›¸ç»§åœ¨å…¶åŸæœ‰å®¹å™¨æœåŠ¡ä¸Šæ–°å¢äº†å¯¹kubernetesçš„æ”¯æŒï¼Œè€ŒDockerå®˜ç½‘ä¹Ÿåœ¨åŒå¹´10æœˆå®£å¸ƒåŒæ—¶æ”¯æŒSwarmå¥½kuberneteså®¹å™¨ç¼–æ’ç³»ç»Ÿã€‚kubernetesä¿¨ç„¶å·²æˆä¸ºå®¹å™¨ç¼–æ’é¢†åŸŸäº‹å®ä¸Šçš„æ ‡å‡†ï¼Œè€Œ2018å¹´æ›´æ˜¯å„å¤§å…¬å¸ç›¸ç»§å°†æœåŠ¡è¿ç§»åˆ°kubernetesä¸Šï¼Œè€Œkubernetesåˆ™ä»¥æƒŠäººæ›´æ–°é€Ÿåº¦ï¼Œä¿æŒç€æ¯ä¸ªå­£åº¦å‘å¸ƒä¸€ä¸ªå¤§ç‰ˆæœ¬çš„é€Ÿåº¦é«˜é€Ÿå‘å±•ç€ã€‚\n kubernetesç‰¹å¾ kubernetesæ˜¯ä¸€ç§åœ¨ä¸€ç»„ä¸»æœºä¸Šè¿è¡Œå’ŒååŒå®¹å™¨åŒ–åº”ç”¨ç¨‹åºçš„ç³»ç»Ÿï¼Œæ—¨åœ¨æä¾›å¯é¢„æµ‹æ€§ã€å¯æ‹“å±•æ€§ä¸é«˜å¯ç”¨æ€§çš„æ–¹æ³•æ¥å®Œå…¨ç®¡ç†å®¹å™¨åŒ–åº”ç”¨å’ŒæœåŠ¡çš„ç”Ÿå‘½å‘¨æœŸå¹³å°ã€‚ç”¨æˆ·å¯ä»¥å®šä¹‰åº”ç”¨ç¨‹åºçš„è¿è¡Œæ–¹å¼ï¼Œä»¥åŠä¸å…¶ä»–åº”ç”¨ç¨‹åºæˆ–å¤–éƒ¨ä¸–ç•Œäº¤äº’çš„é€”å¾„ï¼Œå¹¶èƒ½å®ç°æœåŠ¡çš„æ‰©å®¹å’Œç¼©å®¹ï¼Œæ‰§è¡Œå¹³æ»‘æ»šåŠ¨æ›´æ–°ï¼Œä»¥åŠåœ¨ä¸åŒç‰ˆæœ¬çš„åº”ç”¨ç¨‹åºä¹‹é—´è°ƒåº¦æµé‡ä»¥æµ‹è¯•åŠŸèƒ½æˆ–å›æ»šæœ‰é—®é¢˜çš„éƒ¨ç½²ã€‚kubernetesæä¾›äº†æ¥å£å’Œå¯ç»„åˆå¸†è½¯å¹³å°åŸè¯­ï¼Œä½¿å¾—ç”¨æˆ·èƒ½å¤Ÿä»¥é«˜åº¦çš„çµæ´»æ€§å’Œå¯é æ€§å®šä¹‰åŠç®¡ç†åº”ç”¨ç¨‹åºã€‚\nkubernetesç»„ä»¶åŠç½‘ç»œé€šä¿¡ kubernetesé›†ç¾¤çš„å®¢æˆ·ç«¯å¯ä»¥åˆ†ä¸ºä¸¤ç±»ï¼šAPI Serverå®¢æˆ·ç«¯å’Œåº”ç”¨ç¨‹åºï¼ˆè¿è¡Œä¸ºPodä¸­çš„å®¹å™¨ï¼‰å®¢æˆ·ç«¯ã€‚  ç¬¬ä¸€ç±»å®¢æˆ·ç«¯é€šå¸¸åŒ…å«ç”¨æˆ·å’ŒPodå¯¹è±¡ä¸¤ç§ï¼Œå®ƒä»¬é€šè¿‡API Serverè®¿é—®kubernetesé›†ç¾¤å®Œæˆç®¡ç†ä»»åŠ¡ï¼Œä¾‹å¦‚ï¼Œç®¡ç†é›†ç¾¤ä¸Šçš„å„ç§èµ„æºå¯¹è±¡ã€‚ ç¬¬äºŒç±»å®¢æˆ·ç«¯ä¸€èˆ¬ä¹ŸåŒ…å«äººç±»ç”¨æˆ·å’ŒPodå¯¹è±¡ä¸¤ç§ï¼Œå®ƒä»¬çš„è®¿é—®ç›®æ ‡æ˜¯Podä¸Šè¿è¡Œäºå®¹å™¨ä¸­çš„åº”ç”¨ç¨‹åºæä¾›çš„å„ç§å…·ä½“çš„æœåŠ¡ï¼Œå¦‚redisæˆ–nginxç­‰ï¼Œä¸è¿‡ï¼Œè¿™äº›è®¿é—®è¯·æ±‚é€šå¸¸è¦ç»ç”±Serviceæˆ–Ingressèµ„æºå¯¹è±¡è¿›è¡Œã€‚å¦å¤–ï¼Œç¬¬äºŒç±»å®¢æˆ·ç«¯çš„è®¿é—®ç›®æ ‡å¯¹è±¡çš„æ“ä½œè¦ç»ç”±ç¬¬ä¸€ç±»å®¢æˆ·ç«¯åˆ›å»ºå’Œé…ç½®å®Œæˆåæ‰è¿›è¡Œã€‚\nè®¿é—®API Serveræ—¶ï¼Œäººç±»ç”¨æˆ·ä¸€èˆ¬å€ŸåŠ©äºå‘½ä»¤è¡Œå·¥å…·kubectlæˆ–å›¾å½¢UIï¼ˆä¾‹å¦‚kubernetes dashboardï¼‰è¿›è¡Œï¼Œä¹Ÿé€šè¿‡ç¼–ç¨‹æ¥å£è¿›è¡Œè®¿é—®ï¼ŒåŒ…æ‹¬REST APIã€‚è®¿é—®Podä¸­çš„åº”ç”¨æ—¶ï¼Œå…¶è®¿é—®æ–¹å¼è¦å–å†³äºPodä¸­çš„åº”ç”¨ç¨‹åºï¼Œä¾‹å¦‚ï¼Œå¯¹äºè¿è¡ŒNginxå®¹å™¨çš„Podæ¥è¯´ï¼Œå…¶æœ€å¸¸ç”¨å·¥å…·å°±æ˜¯æµè§ˆå™¨ã€‚\nç®¡ç†å‘˜ï¼ˆå¼€å‘äººå‘˜æˆ–è¿ç»´äººå‘˜ï¼‰ä½¿ç”¨kubernetesé›†ç¾¤çš„å¸¸è§æ“ä½œåŒ…æ‹¬é€šè¿‡æ§åˆ¶å™¨åˆ›å»ºPodï¼Œåœ¨Podçš„åŸºç¡€ä¸Šåˆ›å»ºServiceä¾›ç¬¬äºŒç±»å®¢æˆ·ç«¯è®¿é—®ï¼Œæ›´æ–°Podä¸­çš„åº”ç”¨ç‰ˆæœ¬ï¼ˆæ›´æ–°å’Œå›æ»šï¼‰ä»¥åŠå¯¹åº”ç”¨è§„æ¨¡è¿›è¡Œæ‰©å®¹æˆ–ç¼©å®¹ç­‰ï¼Œå¦å¤–è¿˜æœ‰é›†ç¾¤é™„ä»¶ç®¡ç†ã€å­˜å‚¨å·ç®¡ç†ã€ç½‘ç»œåŠç½‘ç»œç­–ç•¥ç®¡ç†ã€èµ„æºç®¡ç†å’Œå®‰å…¨ç®¡ç†ç­‰ã€‚\n  ","date":1538540293,"expirydate":-62135596800,"kind":"page","lang":"zh","lastmod":1538540293,"objectID":"aeb247588889fea5c6b82b8d280c985c","permalink":"https://guoxudong.io/post/k8s-topo/","publishdate":"2018-10-03T12:18:13+08:00","relpermalink":"/post/k8s-topo/","section":"post","summary":"éšç€2017å¹´AWSï¼ŒAzureå’Œé˜¿é‡Œäº‘ç›¸ç»§åœ¨å…¶åŸæœ‰å®¹å™¨æœåŠ¡ä¸Šæ–°å¢äº†å¯¹kubernetesçš„æ”¯æŒï¼Œè€ŒDockerå®˜ç½‘ä¹Ÿåœ¨åŒå¹´10æœˆå®£å¸ƒåŒæ—¶æ”¯æŒSwarmå¥½kuberneteså®¹å™¨ç¼–æ’ç³»ç»Ÿã€‚kubernetesä¿¨ç„¶å·²æˆä¸ºå®¹å™¨ç¼–æ’é¢†åŸŸäº‹å®ä¸Šçš„æ ‡å‡†ï¼Œè€Œ2018å¹´æ›´æ˜¯å„å¤§å…¬å¸ç›¸ç»§å°†æœåŠ¡è¿ç§»åˆ°kubernetesä¸Šï¼Œè€Œkubernetesåˆ™ä»¥æƒŠäººæ›´æ–°é€Ÿåº¦ï¼Œä¿æŒç€æ¯ä¸ªå­£åº¦å‘å¸ƒä¸€ä¸ªå¤§ç‰ˆæœ¬çš„é€Ÿåº¦é«˜é€Ÿå‘å±•ç€ã€‚","tags":["kubernetes"],"title":"kubernetesé›†ç¾¤æ¦‚è¿°","type":"post"},{"authors":["éƒ­æ—­ä¸œ"],"categories":["é—®é¢˜è§£å†³"],"content":"  ç²¾ç®€Dockeré•œåƒçš„å¥½å¤„å¾ˆå¤šï¼Œä¸ä»…å¯ä»¥èŠ‚çœå­˜å‚¨ç©ºé—´å’Œå¸¦å®½ï¼Œè¿˜èƒ½å‡å°‘å®‰å…¨éšæ‚£ã€‚ä¼˜åŒ–é•œåƒå¤§å°çš„æ‰‹æ®µå¤šç§å¤šæ ·ï¼Œå› æœåŠ¡æ‰€ä½¿ç”¨çš„åŸºç¡€å¼€å‘è¯­è¨€ä¸åŒè€Œæœ‰å·®å¼‚ã€‚æœ¬æ–‡å°†ä»‹ç»ç²¾ç®€Dockeré•œåƒçš„å‡ ç§é€šç”¨æ–¹æ³•ã€‚\n ç²¾ç®€Dockeré•œåƒå¤§å°çš„å¿…è¦æ€§ Dockeré•œåƒç”±å¾ˆå¤šé•œåƒå±‚ï¼ˆLayersï¼‰ç»„æˆï¼ˆæœ€å¤š127å±‚ï¼‰ï¼Œé•œåƒå±‚ä¾èµ–äºä¸€ç³»åˆ—çš„åº•å±‚æŠ€æœ¯ï¼Œæ¯”å¦‚æ–‡ä»¶ç³»ç»Ÿ(filesystems)ã€å†™æ—¶å¤åˆ¶(copy-on-write)ã€è”åˆæŒ‚è½½(union mounts)ç­‰æŠ€æœ¯ï¼Œä½ å¯ä»¥æŸ¥çœ‹Dockerç¤¾åŒºæ–‡æ¡£ä»¥äº†è§£æ›´å¤šæœ‰å…³Dockerå­˜å‚¨é©±åŠ¨çš„å†…å®¹ï¼Œè¿™é‡Œå°±ä¸å†èµ˜è¿°æŠ€æœ¯ç»†èŠ‚ã€‚æ€»çš„æ¥è¯´ï¼ŒDockerfileä¸­çš„æ¯æ¡æŒ‡ä»¤éƒ½ä¼šåˆ›å»ºä¸€ä¸ªé•œåƒå±‚ï¼Œç»§è€Œä¼šå¢åŠ æ•´ä½“é•œåƒçš„å°ºå¯¸ã€‚\nä¸‹é¢æ˜¯ç²¾ç®€Dockeré•œåƒå°ºå¯¸çš„å¥½å¤„ï¼š\n å‡å°‘æ„å»ºæ—¶é—´ å‡å°‘ç£ç›˜ä½¿ç”¨é‡ å‡å°‘ä¸‹è½½æ—¶é—´ å› ä¸ºåŒ…å«æ–‡ä»¶å°‘ï¼Œæ”»å‡»é¢å‡å°ï¼Œæé«˜äº†å®‰å…¨æ€§ æé«˜éƒ¨ç½²é€Ÿåº¦  äº”ç‚¹å»ºè®®å‡å°Dockeré•œåƒå°ºå¯¸\nä¸€ã€ä¼˜åŒ–åŸºç¡€é•œåƒ ä¼˜åŒ–åŸºç¡€é•œåƒçš„æ–¹æ³•å°±æ˜¯é€‰ç”¨åˆé€‚çš„æ›´å°çš„åŸºç¡€é•œåƒï¼Œå¸¸ç”¨çš„ Linux ç³»ç»Ÿé•œåƒä¸€èˆ¬æœ‰ Ubuntuã€CentOsã€Alpineï¼Œå…¶ä¸­Alpineæ›´æ¨èä½¿ç”¨ã€‚å¤§å°å¯¹æ¯”å¦‚ä¸‹ï¼š\nguoxudong@ubuntu ~/s\u0026gt; docker images REPOSITORY TAG IMAGE ID CREATED SIZE ubuntu latest 74f8760a2a8b 8 days ago 82.4MB alpine latest 11cd0b38bc3c 2 weeks ago 4.41MB centos 7 49f7960eb7e4 7 weeks ago 200MB debian latest 3bbb526d2608 8 days ago 101MB guoxudong@ubuntu ~/s\u0026gt;  Alpineæ˜¯ä¸€ä¸ªé«˜åº¦ç²¾ç®€åˆåŒ…å«äº†åŸºæœ¬å·¥å…·çš„è½»é‡çº§Linuxå‘è¡Œç‰ˆï¼ŒåŸºç¡€é•œåƒåªæœ‰4.41Mï¼Œå„å¼€å‘è¯­è¨€å’Œæ¡†æ¶éƒ½æœ‰åŸºäºAlpineåˆ¶ä½œçš„åŸºç¡€é•œåƒï¼Œå¼ºçƒˆæ¨èä½¿ç”¨å®ƒã€‚Alpineé•œåƒå„ä¸ªè¯­è¨€å’Œæ¡†æ¶æ”¯æŒæƒ…å†µï¼Œå¯ä»¥å‚è€ƒã€Šä¼˜åŒ–Dockeré•œåƒã€åŠ é€Ÿåº”ç”¨éƒ¨ç½²ã€‹ã€‚ æŸ¥çœ‹ä¸Šé¢çš„é•œåƒå°ºå¯¸å¯¹æ¯”ç»“æœï¼Œä½ ä¼šå‘ç°æœ€å°çš„é•œåƒä¹Ÿæœ‰4.41Mï¼Œé‚£ä¹ˆæœ‰åŠæ³•æ„å»ºæ›´å°çš„é•œåƒå—ï¼Ÿç­”æ¡ˆæ˜¯è‚¯å®šçš„ï¼Œä¾‹å¦‚ gcr.io/google_containers/pause-amd64:3.1 é•œåƒä»…æœ‰742KBã€‚ä¸ºä»€ä¹ˆè¿™ä¸ªé•œåƒèƒ½è¿™ä¹ˆå°ï¼Ÿåœ¨ä¸ºå¤§å®¶è§£å¯†ä¹‹å‰ï¼Œå†æ¨èä¸¤ä¸ªåŸºç¡€é•œåƒï¼š\n scratché•œåƒ\nscratchæ˜¯ä¸€ä¸ªç©ºé•œåƒï¼Œåªèƒ½ç”¨äºæ„å»ºå…¶ä»–é•œåƒï¼Œæ¯”å¦‚ä½ è¦è¿è¡Œä¸€ä¸ªåŒ…å«æ‰€æœ‰ä¾èµ–çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå¦‚Golangç¨‹åºï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨scratchä½œä¸ºåŸºç¡€é•œåƒã€‚ç°åœ¨ç»™å¤§å®¶å±•ç¤ºä¸€ä¸‹ä¸Šæ–‡æåˆ°çš„Google pauseé•œåƒDockerfileï¼š\nFROM scratch ARG ARCH ADD bin/pause-${ARCH} /pause ENTRYPOINT [\u0026quot;/pause\u0026quot;]  Google pauseé•œåƒä½¿ç”¨äº†scratchä½œä¸ºåŸºç¡€é•œåƒï¼Œè¿™ä¸ªé•œåƒæœ¬èº«æ˜¯ä¸å ç©ºé—´çš„ï¼Œä½¿ç”¨å®ƒæ„å»ºçš„é•œåƒå¤§å°å‡ ä¹å’ŒäºŒè¿›åˆ¶æ–‡ä»¶æœ¬èº«ä¸€æ ·å¤§ï¼Œæ‰€ä»¥é•œåƒéå¸¸å°ã€‚å½“ç„¶åœ¨æˆ‘ä»¬çš„Golangç¨‹åºä¸­ä¹Ÿä¼šä½¿ç”¨ã€‚å¯¹äºä¸€äº›Golang/Cç¨‹åºï¼Œå¯èƒ½ä¼šä¾èµ–ä¸€äº›åŠ¨æ€åº“ï¼Œä½ å¯ä»¥ä½¿ç”¨è‡ªåŠ¨æå–åŠ¨æ€åº“å·¥å…·ï¼Œæ¯”å¦‚lddã€linuxdeployqtç­‰æå–æ‰€æœ‰åŠ¨æ€åº“ï¼Œç„¶åå°†äºŒè¿›åˆ¶æ–‡ä»¶å’Œä¾èµ–åŠ¨æ€åº“ä¸€èµ·æ‰“åŒ…åˆ°é•œåƒä¸­ã€‚\n busyboxé•œåƒ\nscratchæ˜¯ä¸ªç©ºé•œåƒï¼Œå¦‚æœå¸Œæœ›é•œåƒé‡Œå¯ä»¥åŒ…å«ä¸€äº›å¸¸ç”¨çš„Linuxå·¥å…·ï¼Œbusyboxé•œåƒæ˜¯ä¸ªä¸é”™é€‰æ‹©ï¼Œé•œåƒæœ¬èº«åªæœ‰1.16Mï¼Œéå¸¸ä¾¿äºæ„å»ºå°é•œåƒã€‚\n  äºŒã€ä¸²è” Dockerfile æŒ‡ä»¤ å¤§å®¶åœ¨å®šä¹‰Dockerfileæ—¶ï¼Œå¦‚æœå¤ªå¤šçš„ä½¿ç”¨RUNæŒ‡ä»¤ï¼Œç»å¸¸ä¼šå¯¼è‡´é•œåƒæœ‰ç‰¹åˆ«å¤šçš„å±‚ï¼Œé•œåƒå¾ˆè‡ƒè‚¿ï¼Œè€Œä¸”ç”šè‡³ä¼šç¢°åˆ°è¶…å‡ºæœ€å¤§å±‚æ•°ï¼ˆ127å±‚ï¼‰é™åˆ¶çš„é—®é¢˜ï¼Œéµå¾ª Dockerfile æœ€ä½³å®è·µï¼Œæˆ‘ä»¬åº”è¯¥æŠŠå¤šä¸ªå‘½ä»¤ä¸²è”åˆå¹¶ä¸ºä¸€ä¸ª RUNï¼ˆé€šè¿‡è¿ç®—ç¬¦\u0026amp;\u0026amp;å’Œ/ æ¥å®ç°ï¼‰ï¼Œæ¯ä¸€ä¸ª RUN è¦ç²¾å¿ƒè®¾è®¡ï¼Œç¡®ä¿å®‰è£…æ„å»ºæœ€åè¿›è¡Œæ¸…ç†ï¼Œè¿™æ ·æ‰å¯ä»¥é™ä½é•œåƒä½“ç§¯ï¼Œä»¥åŠæœ€å¤§åŒ–çš„åˆ©ç”¨æ„å»ºç¼“å­˜ã€‚\nä¸‹é¢æ˜¯ä¸€ä¸ªä¼˜åŒ–å‰Dockerfileï¼š\nFROM ubuntu ENV VER 3.0.0 ENV TARBALL http://download.redis.io/releases/redis-$VER.tar.gz # ==\u0026gt; Install curl and helper tools... RUN apt-get update RUN apt-get install -y curl make gcc # ==\u0026gt; Download, compile, and install... RUN curl -L $TARBALL | tar zxv WORKDIR redis-$VER RUN make RUN make install #... # ==\u0026gt; Clean up... WORKDIR / RUN apt-get remove -y --auto-remove curl make gcc RUN apt-get clean RUN rm -rf /var/lib/apt/lists/* /redis-$VER #... CMD [\u0026quot;redis-server\u0026quot;]  æ„å»ºé•œåƒï¼Œåç§°å« test/test:0.1ã€‚\næˆ‘ä»¬å¯¹Dockerfileåšä¼˜åŒ–ï¼Œä¼˜åŒ–åDockerfileï¼š\nFROM ubuntu ENV VER 3.0.0 ENV TARBALL http://download.redis.io/releases/redis-$VER.tar.gz RUN echo \u0026quot;==\u0026gt; Install curl and helper tools...\u0026quot; \u0026amp;\u0026amp; \\ apt-get update \u0026amp;\u0026amp; \\ apt-get install -y curl make gcc \u0026amp;\u0026amp; \\ echo \u0026quot;==\u0026gt; Download, compile, and install...\u0026quot; \u0026amp;\u0026amp; \\ curl -L $TARBALL | tar zxv \u0026amp;\u0026amp; \\ cd redis-$VER \u0026amp;\u0026amp; \\ make \u0026amp;\u0026amp; \\ make install \u0026amp;\u0026amp; \\ echo \u0026quot;==\u0026gt; Clean up...\u0026quot; \u0026amp;\u0026amp; \\ apt-get remove -y --auto-remove curl make gcc \u0026amp;\u0026amp; \\ apt-get clean \u0026amp;\u0026amp; \\ rm -rf /var/lib/apt/lists/* /redis-$VER #... CMD [\u0026quot;redis-server\u0026quot;]  æ„å»ºé•œåƒï¼Œåç§°å« test/test:0.2ã€‚\nå¯¹æ¯”ä¸¤ä¸ªé•œåƒå¤§å°ï¼š\nroot@k8s-master:/tmp/iops# docker images REPOSITORY TAG IMAGE ID CREATED SIZE test/test 0.2 58468c0222ed 2 minutes ago 98.1MB test/test 0.1 e496cf7243f2 6 minutes ago 307MB root@k8s-master:/tmp/iops#  å¯ä»¥çœ‹åˆ°ï¼Œå°†å¤šæ¡RUNå‘½ä»¤ä¸²è”èµ·æ¥æ„å»ºçš„é•œåƒå¤§å°æ˜¯æ¯æ¡å‘½ä»¤åˆ†åˆ«RUNçš„ä¸‰åˆ†ä¹‹ä¸€ã€‚\næç¤ºï¼šä¸ºäº†åº”å¯¹é•œåƒä¸­å­˜åœ¨å¤ªå¤šé•œåƒå±‚ï¼ŒDocker 1.13ç‰ˆæœ¬ä»¥åï¼Œæä¾›äº†ä¸€ä¸ªå‹æ‰é•œåƒåŠŸèƒ½ï¼Œå³å°† Dockerfile ä¸­æ‰€æœ‰çš„æ“ä½œå‹ç¼©ä¸ºä¸€å±‚ã€‚è¿™ä¸ªç‰¹æ€§è¿˜å¤„äºå®éªŒé˜¶æ®µï¼ŒDockeré»˜è®¤æ²¡æœ‰å¼€å¯ï¼Œå¦‚æœè¦å¼€å¯ï¼Œéœ€è¦åœ¨å¯åŠ¨Dockeræ—¶æ·»åŠ -experimental é€‰é¡¹ï¼Œå¹¶åœ¨Docker build æ„å»ºé•œåƒæ—¶å€™æ·»åŠ  \u0026ndash;squash ã€‚æˆ‘ä»¬ä¸æ¨èä½¿ç”¨è¿™ä¸ªåŠæ³•ï¼Œè¯·åœ¨æ’°å†™ Dockerfile æ—¶éµå¾ªæœ€ä½³å®è·µç¼–å†™ï¼Œä¸è¦è¯•å›¾ç”¨è¿™ç§åŠæ³•å»å‹ç¼©é•œåƒã€‚\nä¸‰ã€ä½¿ç”¨å¤šé˜¶æ®µæ„å»º Dockerfileä¸­æ¯æ¡æŒ‡ä»¤éƒ½ä¼šä¸ºé•œåƒå¢åŠ ä¸€ä¸ªé•œåƒå±‚ï¼Œå¹¶ä¸”ä½ éœ€è¦åœ¨ç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ªé•œåƒå±‚ä¹‹å‰æ¸…ç†ä¸éœ€è¦çš„ç»„ä»¶ã€‚å®é™…ä¸Šï¼Œæœ‰ä¸€ä¸ªDockerfileç”¨äºå¼€å‘ï¼ˆå…¶ä¸­åŒ…å«æ„å»ºåº”ç”¨ç¨‹åºæ‰€éœ€çš„æ‰€æœ‰å†…å®¹ï¼‰ä»¥åŠä¸€ä¸ªç”¨äºç”Ÿäº§çš„ç˜¦å®¢æˆ·ç«¯ï¼Œå®ƒåªåŒ…å«ä½ çš„åº”ç”¨ç¨‹åºä»¥åŠè¿è¡Œå®ƒæ‰€éœ€çš„å†…å®¹ã€‚è¿™è¢«ç§°ä¸ºâ€œå»ºé€ è€…æ¨¡å¼â€ã€‚Docker 17.05.0-ceç‰ˆæœ¬ä»¥åæ”¯æŒå¤šé˜¶æ®µæ„å»ºã€‚ä½¿ç”¨å¤šé˜¶æ®µæ„å»ºï¼Œä½ å¯ä»¥åœ¨Dockerfileä¸­ä½¿ç”¨å¤šä¸ªFROMè¯­å¥ï¼Œæ¯æ¡FROMæŒ‡ä»¤å¯ä»¥ä½¿ç”¨ä¸åŒçš„åŸºç¡€é•œåƒï¼Œè¿™æ ·æ‚¨å¯ä»¥é€‰æ‹©æ€§åœ°å°†æœåŠ¡ç»„ä»¶ä»ä¸€ä¸ªé˜¶æ®µCOPYåˆ°å¦ä¸€ä¸ªé˜¶æ®µï¼Œåœ¨æœ€ç»ˆé•œåƒä¸­åªä¿ç•™éœ€è¦çš„å†…å®¹ã€‚\nä¸‹é¢æ˜¯ä¸€ä¸ªä½¿ç”¨ COPY --from å’Œ FROM ... AS ... çš„Dockerfileï¼š\n# Compile FROM golang:1.9.0 AS builder WORKDIR /go/src/v9.git...com/.../k8s-monitor COPY . . WORKDIR /go/src/v9.git...com/.../k8s-monitor RUN make build RUN mv k8s-monitor /root # Package # Use scratch image FROM scratch WORKDIR /root/ COPY --from=builder /root . EXPOSE 8080 CMD [\u0026quot;/root/k8s-monitor\u0026quot;]  æ„å»ºé•œåƒï¼Œä½ ä¼šå‘ç°ç”Ÿæˆçš„é•œåƒåªæœ‰ä¸Šé¢COPY æŒ‡ä»¤æŒ‡å®šçš„å†…å®¹ï¼Œé•œåƒå¤§å°åªæœ‰2Mã€‚è¿™æ ·åœ¨ä»¥å‰ä½¿ç”¨ä¸¤ä¸ªDockerfileï¼ˆä¸€ä¸ªDockerfileç”¨äºå¼€å‘å’Œä¸€ä¸ªç”¨äºç”Ÿäº§çš„ç˜¦å®¢æˆ·ç«¯ï¼‰ï¼Œç°åœ¨ä½¿ç”¨å¤šé˜¶æ®µæ„å»ºå°±å¯ä»¥æå®šã€‚\nå››ã€æ„å»ºä¸šåŠ¡æœåŠ¡é•œåƒæŠ€å·§ Dockeråœ¨buildé•œåƒçš„æ—¶å€™ï¼Œå¦‚æœæŸä¸ªå‘½ä»¤ç›¸å…³çš„å†…å®¹æ²¡æœ‰å˜åŒ–ï¼Œä¼šä½¿ç”¨ä¸Šä¸€æ¬¡ç¼“å­˜ï¼ˆcacheï¼‰çš„æ–‡ä»¶å±‚ï¼Œåœ¨æ„å»ºä¸šåŠ¡é•œåƒçš„æ—¶å€™å¯ä»¥æ³¨æ„ä¸‹é¢ä¸¤ç‚¹ï¼š\n ä¸å˜æˆ–è€…å˜åŒ–å¾ˆå°‘çš„ä½“ç§¯è¾ƒå¤§çš„ä¾èµ–åº“å’Œç»å¸¸ä¿®æ”¹çš„è‡ªæœ‰ä»£ç åˆ†å¼€ï¼› å› ä¸ºcacheç¼“å­˜åœ¨è¿è¡ŒDocker buildå‘½ä»¤çš„æœ¬åœ°æœºå™¨ä¸Šï¼Œå»ºè®®å›ºå®šä½¿ç”¨æŸå°æœºå™¨æ¥è¿›è¡ŒDocker buildï¼Œä»¥ä¾¿åˆ©ç”¨cacheã€‚  ä¸‹é¢æ˜¯æ„å»ºSpring Bootåº”ç”¨é•œåƒçš„ä¾‹å­ï¼Œç”¨æ¥è¯´æ˜å¦‚ä½•åˆ†å±‚ã€‚å…¶ä»–ç±»å‹çš„åº”ç”¨ï¼Œæ¯”å¦‚Java WARåŒ…ï¼ŒNodejsçš„npm æ¨¡å—ç­‰ï¼Œå¯ä»¥é‡‡å–ç±»ä¼¼çš„æ–¹å¼ã€‚\n åœ¨Dockerfileæ‰€åœ¨ç›®å½•ï¼Œè§£å‹ç¼©mavenç”Ÿæˆçš„jaråŒ…\n$ unzip \u0026lt;path-to-app-jar\u0026gt;.jar -d app  Dockerfile æˆ‘ä»¬æŠŠåº”ç”¨çš„å†…å®¹åˆ†æˆ4ä¸ªéƒ¨åˆ†COPYåˆ°é•œåƒé‡Œé¢ï¼šå…¶ä¸­å‰é¢3ä¸ªåŸºæœ¬ä¸å˜ï¼Œç¬¬4ä¸ªæ˜¯ç»å¸¸å˜åŒ–çš„è‡ªæœ‰ä»£ç ã€‚æœ€åä¸€è¡Œæ˜¯è§£å‹ç¼©åï¼Œå¯åŠ¨spring bootåº”ç”¨çš„æ–¹å¼ã€‚\nFROM openjdk:8-jre-alpine LABEL maintainer \u0026quot;opl-xws@xiaomi.com\u0026quot; COPY app/BOOT-INF/lib/ /app/BOOT-INF/lib/ COPY app/org /app/org COPY app/META-INF /app/META-INF COPY app/BOOT-INF/classes /app/BOOT-INF/classes EXPOSE 8080 CMD [\u0026quot;/usr/bin/java\u0026quot;, \u0026quot;-cp\u0026quot;, \u0026quot;/app\u0026quot;, \u0026quot;org.springframework.boot.loader.JarLauncher\u0026quot;]   è¿™æ ·åœ¨æ„å»ºé•œåƒæ—¶å€™å¯å¤§å¤§æé«˜æ„å»ºé€Ÿåº¦ã€‚\näº”ã€å…¶ä»–ä¼˜åŒ–åŠæ³•  RUNå‘½ä»¤ä¸­æ‰§è¡Œaptã€apkæˆ–è€…yumç±»å·¥å…·æŠ€å·§ï¼Œå¦‚æœåœ¨RUNå‘½ä»¤ä¸­æ‰§è¡Œaptã€apkæˆ–è€…yumç±»å·¥å…·ï¼Œå¯ä»¥å€ŸåŠ©è¿™äº›å·¥å…·æä¾›çš„ä¸€äº›å°æŠ€å·§æ¥å‡å°‘é•œåƒå±‚æ•°é‡åŠé•œåƒå¤§å°ã€‚ä¸¾å‡ ä¸ªä¾‹å­ï¼š\n åœ¨æ‰§è¡Œapt-get install -y æ—¶å¢åŠ é€‰é¡¹â€”â€Šno-install-recommends ï¼Œå¯ä»¥ä¸ç”¨å®‰è£…å»ºè®®æ€§ï¼ˆéå¿…é¡»ï¼‰çš„ä¾èµ–ï¼Œä¹Ÿå¯ä»¥åœ¨æ‰§è¡Œapk add æ—¶æ·»åŠ é€‰é¡¹\u0026ndash;no-cache è¾¾åˆ°åŒæ ·æ•ˆæœï¼› æ‰§è¡Œyum install -y æ—¶å€™ï¼Œ å¯ä»¥åŒæ—¶å®‰è£…å¤šä¸ªå·¥å…·ï¼Œæ¯”å¦‚yum install -y gcc gcc-c++ make \u0026hellip;ã€‚å°†æ‰€æœ‰yum install ä»»åŠ¡æ”¾åœ¨ä¸€æ¡RUNå‘½ä»¤ä¸Šæ‰§è¡Œï¼Œä»è€Œå‡å°‘é•œåƒå±‚çš„æ•°é‡ï¼› ç»„ä»¶çš„å®‰è£…å’Œæ¸…ç†è¦ä¸²è”åœ¨ä¸€æ¡æŒ‡ä»¤é‡Œé¢ï¼Œå¦‚ apk \u0026ndash;update add php7 \u0026amp;\u0026amp; rm -rf /var/cache/apk/* ï¼Œå› ä¸ºDockerfileçš„æ¯æ¡æŒ‡ä»¤éƒ½ä¼šäº§ç”Ÿä¸€ä¸ªæ–‡ä»¶å±‚ï¼Œå¦‚æœå°†apk add \u0026hellip;å’Œ rm -rf \u0026hellip; å‘½ä»¤åˆ†å¼€ï¼Œæ¸…ç†æ— æ³•å‡å°apkå‘½ä»¤äº§ç”Ÿçš„æ–‡ä»¶å±‚çš„å¤§å°ã€‚ Ubuntuæˆ–Debianå¯ä»¥ä½¿ç”¨ rm -rf /var/lib/apt/lists/* æ¸…ç†é•œåƒä¸­ç¼“å­˜æ–‡ä»¶ï¼›CentOSç­‰ç³»ç»Ÿä½¿ç”¨yum clean all å‘½ä»¤æ¸…ç†ã€‚  å‹ç¼©é•œåƒ\n  Docker è‡ªå¸¦çš„ä¸€äº›å‘½ä»¤è¿˜èƒ½ååŠ©å‹ç¼©é•œåƒï¼Œæ¯”å¦‚ export å’Œ import\ndocker run -d test/test:0.2 $ docker export 747dc0e72d13 | docker import - test/test:0.3  ä½¿ç”¨è¿™ç§æ–¹å¼éœ€è¦å…ˆå°†å®¹å™¨è¿è¡Œèµ·æ¥ï¼Œè€Œä¸”è¿™ä¸ªè¿‡ç¨‹ä¸­ä¼šä¸¢å¤±é•œåƒåŸæœ‰çš„ä¸€äº›ä¿¡æ¯ï¼Œæ¯”å¦‚ï¼šå¯¼å‡ºç«¯å£ï¼Œç¯å¢ƒå˜é‡ï¼Œé»˜è®¤æŒ‡ä»¤ã€‚\næŸ¥çœ‹è¿™ä¸¤ä¸ªé•œåƒhistoryä¿¡æ¯ï¼Œå¦‚ä¸‹ï¼Œå¯ä»¥çœ‹åˆ°test/test:0.3 ä¸¢å¤±äº†æ‰€æœ‰çš„é•œåƒå±‚ä¿¡æ¯ï¼š\nroot@k8s-master:/tmp/iops# docker history test/test:0.3 IMAGE CREATED CREATED BY SIZE COMMENT 6fb3f00b7a72 15 seconds ago 84.7MB Imported from - root@k8s-master:/tmp/iops# docker history test/test:0.2 IMAGE CREATED CREATED BY SIZE COMMENT 58468c0222ed 2 hours ago /bin/sh -c #(nop) CMD [\u0026quot;redis-server\u0026quot;] 0B 1af7ffe3d163 2 hours ago /bin/sh -c echo \u0026quot;==\u0026gt; Install curl and helper... 15.7MB 8bac6e733d54 2 hours ago /bin/sh -c #(nop) ENV TARBALL=http://downlo... 0B 793282f3ef7a 2 hours ago /bin/sh -c #(nop) ENV VER=3.0.0 0B 74f8760a2a8b 8 days ago /bin/sh -c #(nop) CMD [\u0026quot;/bin/bash\u0026quot;] 0B \u0026lt;missing\u0026gt; 8 days ago /bin/sh -c mkdir -p /run/systemd \u0026amp;\u0026amp; echo 'do... 7B \u0026lt;missing\u0026gt; 8 days ago /bin/sh -c sed -i 's/^#\\s*\\(deb.*universe\\)$... 2.76kB \u0026lt;missing\u0026gt; 8 days ago /bin/sh -c rm -rf /var/lib/apt/lists/* 0B \u0026lt;missing\u0026gt; 8 days ago /bin/sh -c set -xe \u0026amp;\u0026amp; echo '#!/bin/sh' \u0026gt; /... 745B \u0026lt;missing\u0026gt; 8 days ago /bin/sh -c #(nop) ADD file:5fabb77ea8d61e02d... 82.4MB root@k8s-master:/tmp/iops#  ç¤¾åŒºé‡Œè¿˜æœ‰å¾ˆå¤šå‹ç¼©å·¥å…·ï¼Œæ¯”å¦‚Docker-squash ï¼Œç”¨èµ·æ¥æ›´ç®€å•æ–¹ä¾¿ï¼Œå¹¶ä¸”ä¸ä¼šä¸¢å¤±åŸæœ‰é•œåƒçš„è‡ªå¸¦ä¿¡æ¯ï¼Œå¤§å®¶æœ‰å…´è¶£å¯ä»¥è¯•è¯•ã€‚\n","date":1538051293,"expirydate":-62135596800,"kind":"page","lang":"zh","lastmod":1538051293,"objectID":"959436d56c8f6a395bab0e76d949754d","permalink":"https://guoxudong.io/post/image-size/","publishdate":"2018-09-27T20:28:13+08:00","relpermalink":"/post/image-size/","section":"post","summary":"ç²¾ç®€Dockeré•œåƒçš„å¥½å¤„å¾ˆå¤šï¼Œä¸ä»…å¯ä»¥èŠ‚çœå­˜å‚¨ç©ºé—´å’Œå¸¦å®½ï¼Œè¿˜èƒ½å‡å°‘å®‰å…¨éšæ‚£ã€‚ä¼˜åŒ–é•œåƒå¤§å°çš„æ‰‹æ®µå¤šç§å¤šæ ·ï¼Œå› æœåŠ¡æ‰€ä½¿ç”¨çš„åŸºç¡€å¼€å‘è¯­è¨€ä¸åŒè€Œæœ‰å·®å¼‚ã€‚æœ¬æ–‡å°†ä»‹ç»ç²¾ç®€Dockeré•œåƒçš„å‡ ç§é€šç”¨æ–¹æ³•ã€‚","tags":["å®¹å™¨"],"title":"ç²¾ç®€dockeré•œåƒ","type":"post"},{"authors":["éƒ­æ—­ä¸œ"],"categories":["é—®é¢˜è§£å†³"],"content":" ç°è±¡ å¯åŠ¨dockerå®¹å™¨\ndocker run â€“name [CONTAINER_NAME] [CONTAINER_ID]  æŸ¥çœ‹å®¹å™¨è¿è¡ŒçŠ¶æ€\ndocker ps -a  å‘ç°åˆšåˆšå¯åŠ¨çš„mydockerå®¹å™¨å·²ç»é€€å‡º\nåŸå›  dockerå®¹å™¨çš„ä¸»çº¿ç¨‹ï¼ˆdockfileä¸­CMDæ‰§è¡Œçš„å‘½ä»¤ï¼‰ç»“æŸï¼Œå®¹å™¨ä¼šé€€å‡º\nè§£å†³åŠæ³•  å¯ä»¥ä½¿ç”¨äº¤äº’å¼å¯åŠ¨\ndocker run -i [CONTAINER_NAME or CONTAINER_ID]  ä¸Šé¢çš„ä¸å¤ªå‹å¥½ï¼Œå»ºè®®ä½¿ç”¨åå°æ¨¡å¼å’Œttyé€‰é¡¹\ndocker run -dit [CONTAINER_NAME or CONTAINER_ID]  Docker å®¹å™¨åœ¨åå°ä»¥å®ˆæŠ¤æ€ï¼ˆDaemonizedï¼‰å½¢å¼è¿è¡Œï¼Œå¯ä»¥é€šè¿‡æ·»åŠ  -d å‚æ•°æ¥å®ç°\n$ sudo docker run -d ubuntu:14.04 /bin/sh -c \u0026quot;while true; do echo hello world; sleep 1; done\u0026quot;  åœ¨è„šæœ¬æœ€åä¸€è¡Œæ·»åŠ tail -f /dev/nullï¼Œè¿™ä¸ªå‘½ä»¤æ°¸è¿œå®Œæˆä¸äº†ï¼Œæ‰€ä»¥è¯¥è„šæœ¬ä¸€ç›´ä¸ä¼šæ‰§è¡Œå®Œï¼Œæ‰€ä»¥è¯¥å®¹å™¨æ°¸è¿œä¸ä¼šé€€å‡ºã€‚\n   TIPs:é€€å‡ºæ—¶ï¼Œä½¿ç”¨[ctrl + D]ï¼Œè¿™æ ·ä¼šç»“æŸdockerå½“å‰çº¿ç¨‹ï¼Œå®¹å™¨ç»“æŸï¼Œå¯ä»¥ä½¿ç”¨ [ctrl + P] [ctrl + Q] é€€å‡ºè€Œä¸ç»ˆæ­¢å®¹å™¨è¿è¡Œ\nå¦‚ä¸‹å‘½ä»¤ï¼Œä¼šåœ¨æŒ‡å®šå®¹å™¨ä¸­æ‰§è¡ŒæŒ‡å®šå‘½ä»¤ï¼Œ [ctrl+D] é€€å‡ºåä¸ä¼šç»ˆæ­¢å®¹å™¨è¿è¡Œ\ndockeré»˜è®¤ä¼šæŠŠå®¹å™¨å†…éƒ¨pid=1çš„ä½œä¸ºé»˜è®¤çš„ç¨‹åº\n ","date":1538047623,"expirydate":-62135596800,"kind":"page","lang":"zh","lastmod":1538047623,"objectID":"461f3c5322cfd166c9de23b8fc70ccf9","permalink":"https://guoxudong.io/post/docker-quit/","publishdate":"2018-09-27T19:27:03+08:00","relpermalink":"/post/docker-quit/","section":"post","summary":"è§£å†³å®¹å™¨å¯åŠ¨é€€å‡ºé—®é¢˜ã€‚","tags":["å®¹å™¨","Linux"],"title":"Dockerå®¹å™¨å¯åŠ¨é€€å‡ºè§£å†³æ–¹æ¡ˆ","type":"post"},{"authors":["éƒ­æ—­ä¸œ"],"categories":["kubernetes"],"content":" èƒŒæ™¯  è‡ªä»å¾®æœåŠ¡ï¼ˆMicroserviceï¼‰çš„å‡ºç°ï¼Œå‡ºäºä¸šåŠ¡çš„éœ€è¦ï¼ŒITåº”ç”¨æ¨¡å‹ä¸æ–­çš„å˜é©ã€‚å¼€å‘æ¨¡å¼ä»ç€‘å¸ƒå¼åˆ°æ•æ·å¼€å‘ï¼›å¼€å‘ã€è¿ç»´å’Œæµ‹è¯•äº’ç›¸é…åˆçš„devopsæ€æƒ³ï¼›åº”ç”¨ç¨‹åºæ¶æ„ä»å•ä½“æ¨¡å‹åˆ°åˆ†å±‚æ¨¡å‹å†åˆ°å¾®æœåŠ¡ï¼›éƒ¨ç½²æ–¹å¼ä¹Ÿä»é¢å‘ç‰©ç†æœºåˆ°è™šæ‹Ÿé”®å†åˆ°å®¹å™¨ï¼›åº”ç”¨ç¨‹åºçš„åŸºç¡€æ¶æ„ä»è‡ªå»ºæœºæˆ¿åˆ°æ‰˜ç®¡å†åˆ°äº‘è®¡ç®—ï¼Œç­‰ç­‰ã€‚è¿™äº›å˜é©ä½¿å¾—ITæŠ€æœ¯åº”ç”¨çš„æ•ˆç‡å¤§å¤§æå‡ï¼ŒåŒæ—¶å´ä»¥æ›´ä½çš„æˆæœ¬äº¤ä»˜æ›´é«˜è´¨é‡çš„äº§å“ã€‚\nå°¤å…¶æ˜¯ä»¥Dockerä¸ºä»£è¡¨çš„å®¹å™¨æŠ€æœ¯çš„å‡ºç°ï¼Œç»ˆç»“äº†devopsä¸­äº¤ä»˜å’Œéƒ¨ç½²ç¯èŠ‚å› ç¯èŠ‚ã€é…ç½®åŠç¨‹åºæœ¬èº«çš„ä¸åŒè€Œé€ æˆçš„åŠ¨è¾„å‡ ç§ç”šè‡³åå‡ ç§éƒ¨ç½²é…ç½®çš„å›°å¢ƒï¼Œå°†å®ƒä»¬ç»Ÿä¸€åœ¨å®¹å™¨é•œåƒï¼ˆimageï¼‰ä¹‹ä¸Šã€‚è¿™å°±æ˜¯æˆ‘åœ¨å·¥ä½œä¸­é‡åˆ°æœ€å…ˆé‡åˆ°çš„å›°å¢ƒï¼ŒåŒæ—¶ä¹Ÿæ˜¯æˆ‘å¼€å§‹ç ”ç©¶å®¹å™¨æŠ€æœ¯çš„å¥‘æœºã€‚\nå¦‚ä»Šï¼Œè¶Šæ¥è¶Šå¤šçš„ä¼ä¸šæˆ–ç»„ç»‡å¼€å§‹å¼€å§‹é€‰æ‹©ä»¥é•œåƒæ–‡ä»¶ä¸ºäº¤ä»˜è½½ä½“ã€‚å®¹å™¨é•œåƒä¹‹å†…ç›´æ¥åŒ…å«äº†åº”ç”¨ç¨‹åºåŠå…¶ä¾èµ–çš„ç³»ç»Ÿç¯å¢ƒã€åº“ã€åŸºç¡€ç¨‹åºç­‰ï¼Œä»è€Œèƒ½å¤Ÿåœ¨å®¹å™¨å¼•æ“ä¸Šç›´æ¥è¿è¡Œã€‚\n å®¹å™¨æŠ€æœ¯æ¦‚è¿° å®¹å™¨æ˜¯ä¸€ç§è½»é‡çº§ã€å¯ç§»æ¤ã€è‡ªåŒ…å«çš„è½¯ä»¶æ‰“åŒ…æŠ€æœ¯ï¼Œå®ƒä½¿å¾—åº”ç”¨ç¨‹åºå¯ä»¥åœ¨å‡ ä¹ä»»ä½•åœ°æ–¹ä»¥ç›¸åŒçš„æ–¹å¼è¿è¡Œã€‚\nå®¹å™¨æœ‰åº”ç”¨ç¨‹åºæœ¬èº«å’Œå®ƒçš„ç¯å¢ƒä¾èµ–ï¼ˆåº“å’Œå…¶ä»–åº”ç”¨ç¨‹åºï¼‰ä¸¤éƒ¨åˆ†ç»„æˆï¼Œå¹¶åœ¨å®¿ä¸»æœºï¼ˆHostï¼‰æ“ä½œç³»ç»Ÿçš„ç”¨æˆ·ç©ºé—´ä¸­è¿è¡Œï¼Œä½†ä¸æ“ä½œç³»ç»Ÿçš„å…¶ä»–è¿›ç¨‹äº’ç›¸éš”ç¦»ï¼Œä»–ä»¬çš„å®ç°æœºåˆ¶æœ‰åˆ«äºVMWareã€KVMã€Xenç­‰å®ç°æ–¹æ¡ˆçš„è™šæ‹ŸåŒ–æŠ€æœ¯ã€‚å®¹å™¨ä¸è™šæ‹Ÿæœºçš„å¯¹æ¯”å…³ç³»å¦‚ä¸‹å›¾ ç”±äºåŒä¸€ä¸ªå®¿ä¸»æœºä¸Šçš„æ‰€æœ‰å®¹å™¨éƒ½å…±äº«å…¶åº•å±‚æ“ä½œç³»ç»Ÿï¼ˆå†…æ ¸ç©ºé—´ï¼‰ï¼Œè¿™å°±ä½¿å¾—å®¹å™¨åœ¨ä½“ç§¯ä¸Šè¦æ¯”ä¼ ç»Ÿçš„è™šæ‹Ÿæœºå°å¾ˆå¤šã€‚å¦å¤–ï¼Œå¯åŠ¨å®¹å™¨æ— é¡»å¯åŠ¨æ•´ä¸ªæ“ä½œç³»ç»Ÿï¼Œæ‰€ä»¥å®¹å™¨éƒ¨ç½²å’Œå¯åŠ¨çš„é€Ÿåº¦æ›´å¿«ï¼Œå¼€é”€æ›´å°ï¼Œä¹Ÿæ›´å®¹æ˜“è¿ç§»ã€‚äº‹å®ä¸Šï¼Œå®¹å™¨èµ‹äºˆäº†åº”ç”¨ç¨‹åºè¶…å¼ºçš„å¯ç§»æ¤èƒ½åŠ›ã€‚\nå®¹å™¨æŠ€æœ¯çš„ä¼˜åŠ¿  å¼€å‘æ–¹é¢ï¼šâ€œä¸€æ¬¡æ„å»ºã€åˆ°å¤„è¿è¡Œâ€ï¼ˆBuild Once, Run Anywhereï¼‰ã€‚å®¹å™¨æ„å‘³ç€ç¯å¢ƒéš”ç¦»å’Œå¯é‡å¤æ€§ï¼Œå¼€å‘äººå‘˜åªéœ€ä¸ºåº”ç”¨åˆ›å»ºä¸€ä¸ªè¿è¡Œç¯å¢ƒï¼Œå¹¶å°†å…¶æ‰“åŒ…æˆå®¹å™¨ä¾¿å¯åœ¨å„ç§éƒ¨ç½²ç¯å¢ƒä¸Šè¿è¡Œï¼Œå¹¶ä¸å®ƒæ‰€åœ¨çš„å®¿ä¸»æœºç¯å¢ƒéš”ç¦»ã€‚ è¿ç»´æ–¹é¢ï¼šâ€œä¸€æ¬¡é…ç½®ï¼Œè¿è¡Œæ‰€ä»¥â€ï¼ˆConfigure Once, Run Anythingï¼‰ã€‚ä¸€æ—¦é…ç½®å¥½æ ‡å‡†çš„å®¹å™¨è¿è¡Œæ—¶ç¯å¢ƒï¼ŒæœåŠ¡å™¨å°±å¯ä»¥è¿è¡Œä»»ä½•å®¹å™¨ï¼Œè¿™ä½¿å¾—è¿ç»´äººå‘˜çš„å·¥ä½œå˜å¾—æ›´é«˜æ•ˆã€ä¸€è‡´å’Œå¯é‡å¤ã€‚å®¹å™¨æ¶ˆé™¤äº†å¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§ç¯å¢ƒçš„ä¸ä¸€è‡´æ€§ã€‚  ","date":1535625922,"expirydate":-62135596800,"kind":"page","lang":"zh","lastmod":1535625922,"objectID":"92820ba0ae82f98eb11e3d5854f631a3","permalink":"https://guoxudong.io/post/con-in/","publishdate":"2018-08-30T18:45:22+08:00","relpermalink":"/post/con-in/","section":"post","summary":"è‡ªä»å¾®æœåŠ¡ï¼ˆMicroserviceï¼‰çš„å‡ºç°ï¼Œå‡ºäºä¸šåŠ¡çš„éœ€è¦ï¼ŒITåº”ç”¨æ¨¡å‹ä¸æ–­çš„å˜é©ã€‚å¼€å‘æ¨¡å¼ä»ç€‘å¸ƒå¼åˆ°æ•æ·å¼€å‘ï¼›å¼€å‘ã€è¿ç»´å’Œæµ‹è¯•äº’ç›¸é…åˆçš„devopsæ€æƒ³ï¼›åº”ç”¨ç¨‹åºæ¶æ„ä»å•ä½“æ¨¡å‹åˆ°åˆ†å±‚æ¨¡å‹å†åˆ°å¾®æœåŠ¡ï¼›éƒ¨ç½²æ–¹å¼ä¹Ÿä»é¢å‘ç‰©ç†æœºåˆ°è™šæ‹Ÿé”®å†åˆ°å®¹å™¨ï¼›åº”ç”¨ç¨‹åºçš„åŸºç¡€æ¶æ„ä»è‡ªå»ºæœºæˆ¿åˆ°æ‰˜ç®¡å†åˆ°äº‘è®¡ç®—ï¼Œç­‰ç­‰ã€‚è¿™äº›å˜é©ä½¿å¾—ITæŠ€æœ¯åº”ç”¨çš„æ•ˆç‡å¤§å¤§æå‡ï¼ŒåŒæ—¶å´ä»¥æ›´ä½çš„æˆæœ¬äº¤ä»˜æ›´é«˜è´¨é‡çš„äº§å“ã€‚","tags":["å®¹å™¨","äº‘åŸç”Ÿ"],"title":"å®¹å™¨æŠ€æœ¯æ¦‚è¿°","type":"post"},{"authors":["éƒ­æ—­ä¸œ"],"categories":["éƒ¨ç½²å®‰è£…"],"content":" å‰è¨€  æœ€è¿‘ç”±äºå…¬å¸ä¸šåŠ¡å‘å±•åˆ°äº†ç“¶é¢ˆï¼ŒåŸæœ‰çš„æŠ€æœ¯æ¶æ„å·²ç»é€æ¸æ— æ³•æ»¡è¶³ä¸šåŠ¡å¼€å‘å’Œæµ‹è¯•çš„éœ€æ±‚ï¼Œå‡ºç°äº†åº”ç”¨æµ‹è¯•ç¯å¢ƒæ­å»ºå¤æ‚ï¼Œæœ‰è®¸å¤šå¥—ï¼ˆçœŸçš„å¾ˆå¤šå¾ˆå¤šï¼‰åº”ç”¨ç¯å¢ƒï¼Œåº”ç”¨åœ¨æŒç»­é›†æˆ/æŒç»­äº¤ä»˜ä¹Ÿé‡åˆ°äº†å¾ˆå¤§çš„å›°éš¾ï¼Œç»è¿‡è®¨è®ºç ”ç©¶å†³å®šå¯¹åº”ç”¨å’Œå¾®æœåŠ¡è¿›è¡Œå®¹å™¨åŒ–ï¼Œè¿™å°±æ˜¯æˆ‘é¦–æ¬¡ç›´é¢dockerå’Œk8sçš„å¥‘æœº.\n Kubernetes ä»‹ç» Kubernetes æ˜¯ Google å›¢é˜Ÿå‘èµ·çš„å¼€æºé¡¹ç›®ï¼Œå®ƒçš„ç›®æ ‡æ˜¯ç®¡ç†è·¨å¤šä¸ªä¸»æœºçš„å®¹å™¨ï¼Œæä¾›åŸºæœ¬çš„éƒ¨ç½²ï¼Œç»´æŠ¤ä»¥åŠè¿ç”¨ä¼¸ç¼©ï¼Œä¸»è¦å®ç°è¯­è¨€ä¸º Go è¯­è¨€ã€‚ Kubernetesçš„ç‰¹ç‚¹ï¼š\n æ˜“å­¦ï¼šè½»é‡çº§ï¼Œç®€å•ï¼Œå®¹æ˜“ç†è§£ ä¾¿æºï¼šæ”¯æŒå…¬æœ‰äº‘ï¼Œç§æœ‰äº‘ï¼Œæ··åˆäº‘ï¼Œä»¥åŠå¤šç§äº‘å¹³å° å¯æ‹“å±•ï¼šæ¨¡å—åŒ–ï¼Œå¯æ’æ‹”ï¼Œæ”¯æŒé’©å­ï¼Œå¯ä»»æ„ç»„åˆ è‡ªä¿®å¤ï¼šè‡ªåŠ¨é‡è°ƒåº¦ï¼Œè‡ªåŠ¨é‡å¯ï¼Œè‡ªåŠ¨å¤åˆ¶  å‡†å¤‡å·¥ä½œ æ³¨ï¼šä»¥ä¸‹æ“ä½œéƒ½æ˜¯åœ¨rootæƒé™ä¸‹æ‰§è¡Œçš„\n å®‰è£…docker-ceï¼Œè¿™é‡Œä½¿ç”¨docker-ce-17.09.0.cç‰ˆæœ¬ï¼Œå®‰è£…æ–¹æ³•è§ä¹‹å‰çš„æ•™ç¨‹ å®‰è£…Kubeadm\n#å®‰è£… Kubeadm é¦–å…ˆæˆ‘ä»¬è¦é…ç½®å¥½é˜¿é‡Œäº‘çš„å›½å†…æºï¼Œæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š cat \u0026lt;\u0026lt;EOF \u0026gt; /etc/yum.repos.d/kubernetes.repo [kubernetes] name=Kubernetes baseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64 enabled=1 gpgcheck=0 EOF #ä¹‹åï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤æ¥é‡å»ºyumç¼“å­˜ï¼š yum -y install epel-releaseyum clean all yum makecache  æ¥ä¸‹æ¥éœ€è¦å®‰è£…æŒ‡å®šç‰ˆæœ¬çš„Kubeadmï¼ˆè¿™é‡Œè¦å®‰è£…æŒ‡å®šç‰ˆæœ¬ï¼Œå› ä¸ºåç»­ä¾èµ–çš„é•œåƒç”±äºæœ‰å¢™æ— æ³•æ‹‰å–ï¼Œè¿™é‡Œæˆ‘ä»¬åªæœ‰æŒ‡å®šç‰ˆæœ¬çš„é•œåƒï¼‰ï¼Œæ³¨æ„ï¼šè¿™é‡Œæ˜¯å®‰è£…æŒ‡å®šç‰ˆæœ¬çš„Kubeadmï¼Œk8sçš„ç‰ˆæœ¬æ›´æ–°ä¹‹å¿«å®Œå…¨è¶…å‡ºä½ çš„æƒ³è±¡ï¼\nyum -y install kubelet-1.11.0-0 yum -y install kubeadm-1.11.0-0 yum -y install kubectl-1.11.0-0 yum -y install kubernetes-cni #æ‰§è¡Œå‘½ä»¤å¯åŠ¨KubeadmæœåŠ¡ï¼š systemctl enable kubelet \u0026amp;\u0026amp; systemctl start kubelet  é…ç½® Kubeadm æ‰€ç”¨åˆ°çš„é•œåƒ è¿™é‡Œæ˜¯é‡ä¸­ä¹‹é‡ï¼Œå› ä¸ºåœ¨å›½å†…çš„åŸå› ï¼Œæ— æ³•è®¿é—®åˆ° Google çš„é•œåƒåº“ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦æ‰§è¡Œä»¥ä¸‹è„šæœ¬æ¥ä» Docker Hub ä»“åº“ä¸­è·å–ç›¸åŒçš„é•œåƒï¼Œå¹¶ä¸”æ›´æ”¹ TAG è®©å…¶å˜æˆä¸ Google æ‹‰å»é•œåƒä¸€è‡´ã€‚\næ–°å»ºä¸€ä¸ª Shell è„šæœ¬ï¼Œå¡«å…¥ä»¥ä¸‹ä»£ç ä¹‹åä¿å­˜\n#docker.sh #!/bin/bash images=(kube-proxy-amd64:v1.11.0 kube-scheduler-amd64:v1.11.0 kube-controller-manager-amd64:v1.11.0 kube-apiserver-amd64:v1.11.0 etcd-amd64:3.2.18 coredns:1.1.3 pause-amd64:3.1 kubernetes-dashboard-amd64:v1.8.3 k8s-dns-sidecar-amd64:1.14.9 k8s-dns-kube-dns-amd64:1.14.9 k8s-dns-dnsmasq-nanny-amd64:1.14.9 ) for imageName in ${images[@]} ; do docker pull keveon/$imageName docker tag keveon/$imageName k8s.gcr.io/$imageName docker rmi keveon/$imageName done # ä¸ªäººæ–°åŠ çš„ä¸€å¥ï¼ŒV 1.11.0 å¿…åŠ  docker tag da86e6ba6ca1 k8s.gcr.io/pause:3.1  ä¿å­˜åä½¿ç”¨chmodå‘½ä»¤èµ‹äºˆè„šæœ¬æ‰§è¡Œæƒé™\nchmod -R 777 ./docker.sh  æ‰§è¡Œè„šæœ¬æ‹‰å–é•œåƒ\nsh docker.sh #è¿™é‡Œå°±å¼€å§‹äº†æ¼«é•¿çš„æ‹‰å–é•œåƒä¹‹è·¯  å…³é—­æ‰swap\nsudo swapoff -a #è¦æ°¸ä¹…ç¦æ‰swapåˆ†åŒºï¼Œæ‰“å¼€å¦‚ä¸‹æ–‡ä»¶æ³¨é‡Šæ‰swapé‚£ä¸€è¡Œ # sudo vi /etc/stab  å…³é—­SELinuxçš„\n# ä¸´æ—¶ç¦ç”¨selinux # æ°¸ä¹…å…³é—­ ä¿®æ”¹/etc/sysconfig/selinuxæ–‡ä»¶è®¾ç½® sed -i 's/SELINUX=permissive/SELINUX=disabled/' /etc/sysconfig/selinux # è¿™é‡ŒæŒ‰å›è½¦ï¼Œä¸‹é¢æ˜¯ç¬¬äºŒæ¡å‘½ä»¤ setenforce 0  å…³é—­é˜²ç«å¢™\nsystemctl disable firewalld.service \u0026amp;\u0026amp; systemctl stop firewalld.service  é…ç½®è½¬å‘å‚æ•°\n# é…ç½®è½¬å‘ç›¸å…³å‚æ•°ï¼Œå¦åˆ™å¯èƒ½ä¼šå‡ºé”™ cat \u0026lt;\u0026lt;EOF \u0026gt; /etc/sysctl.d/k8s.conf net.bridge.bridge-nf-call-ip6tables = 1 net.bridge.bridge-nf-call-iptables = 1 vm.swappiness=0 EOF # è¿™é‡ŒæŒ‰å›è½¦ï¼Œä¸‹é¢æ˜¯ç¬¬äºŒæ¡å‘½ä»¤ sysctl --system  è¿™é‡Œå°±å®Œæˆäº†k8sé›†ç¾¤æ­å»ºçš„å‡†å¤‡å·¥ä½œï¼Œé›†ç¾¤æ­å»ºçš„è¯ä»¥ä¸Šæ“ä½œç»“æŸåå°†æ“ä½œå®Œçš„ç³»ç»Ÿåˆ¶ä½œæˆç³»ç»Ÿé•œåƒï¼Œæ–¹ä¾¿é›†ç¾¤æ­å»º\n  æ­£å¼å®‰è£… ä»¥ä¸‹çš„æ“ä½œéƒ½åªåœ¨ä¸»èŠ‚ç‚¹ä¸Šè¿›è¡Œï¼š\nåˆå§‹åŒ–é•œåƒ\nkubeadm init --kubernetes-version=v1.11.0 --pod-network-cidr=10.10.0.0/16 #è¿™é‡Œå¡«å†™é›†ç¾¤æ‰€åœ¨ç½‘æ®µ  ä¹‹åçš„è¾“å‡ºä¼šæ˜¯è¿™æ ·ï¼š\nI0712 10:46:30.938979 13461 feature_gate.go:230] feature gates: \u0026amp;{map[]} [init] using Kubernetes version: v1.11.0 [preflight] running pre-flight checks I0712 10:46:30.961005 13461 kernel_validator.go:81] Validating kernel version I0712 10:46:30.961061 13461 kernel_validator.go:96] Validating kernel config [WARNING SystemVerification]: docker version is greater than the most recently validated version. Docker version: 18.03.1-ce. Max validated version: 17.03 [WARNING Hostname]: hostname \u0026quot;g2-apigateway\u0026quot; could not be reached [WARNING Hostname]: hostname \u0026quot;g2-apigateway\u0026quot; lookup g2-apigateway on 100.100.2.138:53: no such host [preflight/images] Pulling images required for setting up a Kubernetes cluster [preflight/images] This might take a minute or two, depending on the speed of your internet connection [preflight/images] You can also perform this action in beforehand using 'kubeadm config images pull' [kubelet] Writing kubelet environment file with flags to file \u0026quot;/var/lib/kubelet/kubeadm-flags.env\u0026quot; [kubelet] Writing kubelet configuration to file \u0026quot;/var/lib/kubelet/config.yaml\u0026quot; [preflight] Activating the kubelet service [certificates] Generated ca certificate and key. [certificates] Generated apiserver certificate and key. [certificates] apiserver serving cert is signed for DNS names [g2-apigateway kubernetes kubernetes.default kubernetes.default.svc kubernetes.default.svc.cluster.local] and IPs [10.96.0.1 172.16.8.62] [certificates] Generated apiserver-kubelet-client certificate and key. [certificates] Generated sa key and public key. [certificates] Generated front-proxy-ca certificate and key. [certificates] Generated front-proxy-client certificate and key. [certificates] Generated etcd/ca certificate and key. [certificates] Generated etcd/server certificate and key. [certificates] etcd/server serving cert is signed for DNS names [g2-apigateway localhost] and IPs [127.0.0.1 ::1] [certificates] Generated etcd/peer certificate and key. [certificates] etcd/peer serving cert is signed for DNS names [g2-apigateway localhost] and IPs [172.16.8.62 127.0.0.1 ::1] [certificates] Generated etcd/healthcheck-client certificate and key. [certificates] Generated apiserver-etcd-client certificate and key. [certificates] valid certificates and keys now exist in \u0026quot;/etc/kubernetes/pki\u0026quot; [kubeconfig] Wrote KubeConfig file to disk: \u0026quot;/etc/kubernetes/admin.conf\u0026quot; [kubeconfig] Wrote KubeConfig file to disk: \u0026quot;/etc/kubernetes/kubelet.conf\u0026quot; [kubeconfig] Wrote KubeConfig file to disk: \u0026quot;/etc/kubernetes/controller-manager.conf\u0026quot; [kubeconfig] Wrote KubeConfig file to disk: \u0026quot;/etc/kubernetes/scheduler.conf\u0026quot; [controlplane] wrote Static Pod manifest for component kube-apiserver to \u0026quot;/etc/kubernetes/manifests/kube-apiserver.yaml\u0026quot; [controlplane] wrote Static Pod manifest for component kube-controller-manager to \u0026quot;/etc/kubernetes/manifests/kube-controller-manager.yaml\u0026quot; [controlplane] wrote Static Pod manifest for component kube-scheduler to \u0026quot;/etc/kubernetes/manifests/kube-scheduler.yaml\u0026quot; [etcd] Wrote Static Pod manifest for a local etcd instance to \u0026quot;/etc/kubernetes/manifests/etcd.yaml\u0026quot; [init] waiting for the kubelet to boot up the control plane as Static Pods from directory \u0026quot;/etc/kubernetes/manifests\u0026quot; [init] this might take a minute or longer if the control plane images have to be pulled [apiclient] All control plane components are healthy after 41.001672 seconds [uploadconfig] storing the configuration used in ConfigMap \u0026quot;kubeadm-config\u0026quot; in the \u0026quot;kube-system\u0026quot; Namespace [kubelet] Creating a ConfigMap \u0026quot;kubelet-config-1.11\u0026quot; in namespace kube-system with the configuration for the kubelets in the cluster [markmaster] Marking the node g2-apigateway as master by adding the label \u0026quot;node-role.kubernetes.io/master=''\u0026quot; [markmaster] Marking the node g2-apigateway as master by adding the taints [node-role.kubernetes.io/master:NoSchedule] [patchnode] Uploading the CRI Socket information \u0026quot;/var/run/dockershim.sock\u0026quot; to the Node API object \u0026quot;g2-apigateway\u0026quot; as an annotation [bootstraptoken] using token: o337m9.ceq32wg9g2gro7gx [bootstraptoken] configured RBAC rules to allow Node Bootstrap tokens to post CSRs in order for nodes to get long term certificate credentials [bootstraptoken] configured RBAC rules to allow the csrapprover controller automatically approve CSRs from a Node Bootstrap Token [bootstraptoken] configured RBAC rules to allow certificate rotation for all node client certificates in the cluster [bootstraptoken] creating the \u0026quot;cluster-info\u0026quot; ConfigMap in the \u0026quot;kube-public\u0026quot; namespace [addons] Applied essential addon: CoreDNS [addons] Applied essential addon: kube-proxy Your Kubernetes master has initialized successfully! To start using your cluster, you need to run the following as a regular user: mkdir -p $HOME/.kube sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config sudo chown $(id -u):$(id -g) $HOME/.kube/config You should now deploy a pod network to the cluster. Run \u0026quot;kubectl apply -f [podnetwork].yaml\u0026quot; with one of the options listed at: https://kubernetes.io/docs/concepts/cluster-administration/addons/ You can now join any number of machines by running the following on each node as root: kubeadm join 10.10.207.253:6443 --token t69z6h.lr2etdbg9mfx5r15 --discovery-token-ca-cert-hash sha256:90e3a748c0eb4cb7058f3d0ee8870ee5d746214ab0589b5e841fd5d68fec8f00  è¿™é‡Œæ³¨æ„æœ€åä¸€è¡Œï¼š\nkubeadm join 10.10.207.253:6443 --token t69z6h.lr2etdbg9mfx5r15 --discovery-token-ca-cert-hash sha256:90e3a748c0eb4cb7058f3d0ee8870ee5d746214ab0589b5e841fd5d68fec8f00  è¯æ˜é›†ç¾¤ä¸»èŠ‚ç‚¹å®‰è£…æˆåŠŸï¼Œè¿™é‡Œè¦è®°å¾—ä¿å­˜è¿™æ¡å‘½ä»¤ï¼Œä»¥ä¾¿ä¹‹åå„ä¸ªèŠ‚ç‚¹åŠ å…¥é›†ç¾¤\né…ç½®kubetlè®¤è¯ä¿¡æ¯\nexport KUBECONFIG=/etc/kubernetes/admin.conf # å¦‚æœä½ æƒ³æŒä¹…åŒ–çš„è¯ï¼Œç›´æ¥æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ã€æ¨èã€‘ echo \u0026quot;export KUBECONFIG=/etc/kubernetes/admin.conf\u0026quot; \u0026gt;\u0026gt; ~/.bash_profile  å®‰è£…flanelç½‘ç»œ\nmkdir -p /etc/cni/net.d/ cat \u0026lt;\u0026lt;EOF\u0026gt; /etc/cni/net.d/10-flannel.conf { \u0026quot;name\u0026quot;: \u0026quot;cbr0\u0026quot;, \u0026quot;type\u0026quot;: \u0026quot;flannel\u0026quot;, \u0026quot;delegate\u0026quot;: { \u0026quot;isDefaultGateway\u0026quot;: true } } EOF mkdir /usr/share/oci-umount/oci-umount.d -p mkdir /run/flannel/ cat \u0026lt;\u0026lt;EOF\u0026gt; /run/flannel/subnet.env FLANNEL_NETWORK=10.244.0.0/16 FLANNEL_SUBNET=10.244.1.0/24 FLANNEL_MTU=1450 FLANNEL_IPMASQ=true EOF  æœ€åéœ€è¦æ–°å»ºä¸€ä¸ªflannel.ymlæ–‡ä»¶ï¼š\nimage: caption: \u0026quot;Image from: [**Pexels**](https://www.pexels.com)\u0026quot; focal_point: \u0026quot;\u0026quot; preview_only: false --- kind: ClusterRole apiVersion: rbac.authorization.k8s.io/v1beta1 metadata: name: flannel rules: - apiGroups: - \u0026quot;\u0026quot; resources: - pods verbs: - get - apiGroups: - \u0026quot;\u0026quot; resources: - nodes verbs: - list - watch - apiGroups: - \u0026quot;\u0026quot; resources: - nodes/status verbs: - patch image: caption: \u0026quot;Image from: [**Pexels**](https://www.pexels.com)\u0026quot; focal_point: \u0026quot;\u0026quot; preview_only: false --- kind: ClusterRoleBinding apiVersion: rbac.authorization.k8s.io/v1beta1 metadata: name: flannel roleRef: apiGroup: rbac.authorization.k8s.io kind: ClusterRole name: flannel subjects: - kind: ServiceAccount name: flannel namespace: kube-system image: caption: \u0026quot;Image from: [**Pexels**](https://www.pexels.com)\u0026quot; focal_point: \u0026quot;\u0026quot; preview_only: false --- apiVersion: v1 kind: ServiceAccount metadata: name: flannel namespace: kube-system image: caption: \u0026quot;Image from: [**Pexels**](https://www.pexels.com)\u0026quot; focal_point: \u0026quot;\u0026quot; preview_only: false --- kind: ConfigMap apiVersion: v1 metadata: name: kube-flannel-cfg namespace: kube-system labels: tier: node app: flannel data: cni-conf.json: | { \u0026quot;name\u0026quot;: \u0026quot;cbr0\u0026quot;, \u0026quot;type\u0026quot;: \u0026quot;flannel\u0026quot;, \u0026quot;delegate\u0026quot;: { \u0026quot;isDefaultGateway\u0026quot;: true } } net-conf.json: | { \u0026quot;Network\u0026quot;: \u0026quot;10.10.0.0/16\u0026quot;, #è¿™é‡Œæ¢æˆé›†ç¾¤æ‰€åœ¨çš„ç½‘æ®µ \u0026quot;Backend\u0026quot;: { \u0026quot;Type\u0026quot;: \u0026quot;vxlan\u0026quot; } } image: caption: \u0026quot;Image from: [**Pexels**](https://www.pexels.com)\u0026quot; focal_point: \u0026quot;\u0026quot; preview_only: false --- apiVersion: extensions/v1beta1 kind: DaemonSet metadata: name: kube-flannel-ds namespace: kube-system labels: tier: node app: flannel spec: template: metadata: labels: tier: node app: flannel spec: hostNetwork: true nodeSelector: beta.kubernetes.io/arch: amd64 tolerations: - key: node-role.kubernetes.io/master operator: Exists effect: NoSchedule serviceAccountName: flannel initContainers: - name: install-cni image: quay.io/coreos/flannel:v0.9.1-amd64 command: - cp args: - -f - /etc/kube-flannel/cni-conf.json - /etc/cni/net.d/10-flannel.conf volumeMounts: - name: cni mountPath: /etc/cni/net.d - name: flannel-cfg mountPath: /etc/kube-flannel/ containers: - name: kube-flannel image: quay.io/coreos/flannel:v0.9.1-amd64 command: [ \u0026quot;/opt/bin/flanneld\u0026quot;, \u0026quot;--ip-masq\u0026quot;, \u0026quot;--kube-subnet-mgr\u0026quot; ] securityContext: privileged: true env: - name: POD_NAME valueFrom: fieldRef: fieldPath: metadata.name - name: POD_NAMESPACE valueFrom: fieldRef: fieldPath: metadata.namespace volumeMounts: - name: run mountPath: /run - name: flannel-cfg mountPath: /etc/kube-flannel/ volumes: - name: run hostPath: path: /run - name: cni hostPath: path: /etc/cni/net.d - name: flannel-cfg configMap: name: kube-flannel-cfg  æ‰§è¡Œï¼š\nkubectl create -f ./flannel.yml  é»˜è®¤æƒ…å†µä¸‹ï¼ŒmasterèŠ‚ç‚¹ä¸å‚ä¸å·¥ä½œè´Ÿè½½ï¼Œä½†å¦‚æœå¸Œæœ›å®‰è£…å‡ºä¸€ä¸ªall-in-oneçš„k8sç¯å¢ƒï¼Œåˆ™å¯ä»¥æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š\nè®©masterèŠ‚ç‚¹æˆä¸ºä¸€ä¸ªnodeèŠ‚ç‚¹ï¼š\nkubectl taint nodes --all node-role.kubernetes.io/master-  æŸ¥çœ‹èŠ‚ç‚¹ä¿¡æ¯ï¼š\nkubectl get nodes  ä¼šçœ‹åˆ°å¦‚ä¸‹çš„è¾“å‡ºï¼š\nNAME STATUS ROLES AGE VERSION k8s-master Ready master 18h v1.11.0  ä»¥ä¸‹æ˜¯èŠ‚ç‚¹é…ç½®\nåœ¨é…ç½®å¥½ä¸»èŠ‚ç‚¹ä¹‹åï¼Œå°±å¯ä»¥é…ç½®é›†ç¾¤çš„å…¶ä»–èŠ‚ç‚¹äº†ï¼Œè¿™é‡Œå»ºè®®ç›´æ¥å®‰è£…ä¹‹å‰åšå¥½å‡†å¤‡å·¥ä½œçš„ç³»ç»Ÿé•œåƒ è¿›å…¥èŠ‚ç‚¹æœºå™¨ä¹‹åï¼Œç›´æ¥æ‰§è¡Œä¹‹å‰ä¿å­˜å¥½çš„å‘½ä»¤\nkubeadm join 10.10.207.253:6443 --token t69z6h.lr2etdbg9mfx5r15 --discovery-token-ca-cert-hash sha256:90e3a748c0eb4cb7058f3d0ee8870ee5d746214ab0589b5e841fd5d68fec8f00  æ‰§è¡Œå®Œåä¼šçœ‹åˆ°ï¼š\n[preflight] running pre-flight checks [WARNING RequiredIPVSKernelModulesAvailable]: the IPVS proxier will not be used, because the following required kernel modules are not loaded: [ip_vs_wrr ip_vs_sh ip_vs ip_vs_rr] or no builtin kernel ipvs support: map[ip_vs_rr:{} ip_vs_wrr:{} ip_vs_sh:{} nf_conntrack_ipv4:{} ip_vs:{}] you can solve this problem with following methods: 1. Run 'modprobe -- ' to load missing kernel modules; 2. Provide the missing builtin kernel ipvs support I0725 09:59:27.929247 10196 kernel_validator.go:81] Validating kernel version I0725 09:59:27.929356 10196 kernel_validator.go:96] Validating kernel config [discovery] Trying to connect to API Server \u0026quot;10.10.207.253:6443\u0026quot; [discovery] Created cluster-info discovery client, requesting info from \u0026quot;https://10.10.207.253:6443\u0026quot; [discovery] Requesting info from \u0026quot;https://10.10.207.253:6443\u0026quot; again to validate TLS against the pinned public key [discovery] Cluster info signature and contents are valid and TLS certificate validates against pinned roots, will use API Server \u0026quot;10.10.207.253:6443\u0026quot; [discovery] Successfully established connection with API Server \u0026quot;10.10.207.253:6443\u0026quot; [kubelet] Downloading configuration for the kubelet from the \u0026quot;kubelet-config-1.11\u0026quot; ConfigMap in the kube-system namespace [kubelet] Writing kubelet configuration to file \u0026quot;/var/lib/kubelet/config.yaml\u0026quot; [kubelet] Writing kubelet environment file with flags to file \u0026quot;/var/lib/kubelet/kubeadm-flags.env\u0026quot; [preflight] Activating the kubelet service [tlsbootstrap] Waiting for the kubelet to perform the TLS Bootstrap... [patchnode] Uploading the CRI Socket information \u0026quot;/var/run/dockershim.sock\u0026quot; to the Node API object \u0026quot;k8s-node1\u0026quot; as an annotation This node has joined the cluster: * Certificate signing request was sent to master and a response was received. * The Kubelet was informed of the new secure connection details. Run 'kubectl get nodes' on the master to see this node join the cluster.  è¿™é‡Œå°±è¡¨ç¤ºæ‰§è¡Œå®Œæ¯•äº†ï¼Œå¯ä»¥å»ä¸»èŠ‚ç‚¹æ‰§è¡Œå‘½ä»¤ï¼š\nkubectl get nodes  å¯ä»¥çœ‹åˆ°èŠ‚ç‚¹å·²åŠ å…¥é›†ç¾¤ï¼š\nNAME STATUS ROLES AGE VERSION k8s-master Ready master 20h v1.11.0 k8s-node1 Ready \u0026lt;none\u0026gt; 20h v1.11.0 k8s-node2 Ready \u0026lt;none\u0026gt; 20h v1.11.0  è¿™æœŸé—´å¯èƒ½éœ€è¦ç­‰å¾…ä¸€æ®µæ—¶é—´ï¼ŒçŠ¶æ€æ‰ä¼šå…¨éƒ¨å˜ä¸ºready\nkubernetes-dashboardå®‰è£… è¯¦è§ï¼škuberneteså®‰è£…dashboard\né‡‡å‘æŒ‡å— æœ‰æ—¶ä¼šå‡ºç°masterèŠ‚ç‚¹ä¸€ç›´å¤„äºnotreadyçš„çŠ¶æ€ï¼Œè¿™é‡Œå¯èƒ½æ˜¯æ²¡æœ‰å¯åŠ¨flannelï¼Œåªéœ€è¦æŒ‰ç…§ä¸Šé¢çš„æ•™ç¨‹é…ç½®å¥½flannelï¼Œç„¶åæ‰§è¡Œï¼š\nkubectl create -f ./flannel.yml  ","date":1534248423,"expirydate":-62135596800,"kind":"page","lang":"zh","lastmod":1534248423,"objectID":"f47500b86b1d8019a23c252f4c415470","permalink":"https://guoxudong.io/post/install-k8s/","publishdate":"2018-08-14T20:07:03+08:00","relpermalink":"/post/install-k8s/","section":"post","summary":"æœ€è¿‘ç”±äºå…¬å¸ä¸šåŠ¡å‘å±•åˆ°äº†ç“¶é¢ˆï¼ŒåŸæœ‰çš„æŠ€æœ¯æ¶æ„å·²ç»é€æ¸æ— æ³•æ»¡è¶³ä¸šåŠ¡å¼€å‘å’Œæµ‹è¯•çš„éœ€æ±‚ï¼Œå‡ºç°äº†åº”ç”¨æµ‹è¯•ç¯å¢ƒæ­å»ºå¤æ‚ï¼Œæœ‰è®¸å¤šå¥—ï¼ˆçœŸçš„å¾ˆå¤šå¾ˆå¤šï¼‰åº”ç”¨ç¯å¢ƒï¼Œåº”ç”¨åœ¨æŒç»­é›†æˆ/æŒç»­äº¤ä»˜ä¹Ÿé‡åˆ°äº†å¾ˆå¤§çš„å›°éš¾ï¼Œç»è¿‡è®¨è®ºç ”ç©¶å†³å®šå¯¹åº”ç”¨å’Œå¾®æœåŠ¡è¿›è¡Œå®¹å™¨åŒ–ï¼Œè¿™å°±æ˜¯æˆ‘é¦–æ¬¡ç›´é¢dockerå’Œk8sçš„å¥‘æœºã€‚","tags":["å®¹å™¨","kubernetes"],"title":"centos7.2 å®‰è£…k8s v1.11.0","type":"post"},{"authors":["éƒ­æ—­ä¸œ"],"categories":["éƒ¨ç½²å®‰è£…"],"content":" å‰è¨€  åœ¨ä½¿ç”¨centos7ï¼Œå¹¶ä½¿ç”¨è«å®‰è£…æ¬è¿å·¥çš„æ—¶å€™ï¼Œå¾€å¾€ä¸å¸Œæœ›å®‰è£…æœ€æ–°ç‰ˆæœ¬çš„æ¬è¿å·¥ï¼Œè€Œæ˜¯å¸Œæœ›å®‰è£…ä¸è‡ªå·±ç†Ÿæ‚‰æˆ–è€…å½“å‰ä¸šåŠ¡ç¯å¢ƒéœ€è¦çš„ç‰ˆæœ¬ï¼Œä¾‹å¦‚ç›®å‰Kubernetesæ”¯æŒçš„æœ€æ–°æ¬è¿å·¥ç‰ˆæœ¬ä¸ºv17.03ï¼Œæ‰€ä»¥å°±äº§ç”Ÿäº†å®‰è£…æŒ‡å®šç‰ˆæœ¬ç å¤´å·¥äººçš„éœ€æ±‚ã€‚\n å®‰è£…æ­¥éª¤ # å®‰è£…ä¾èµ–åŒ… yum install -y yum-utils device-mapper-persistent-data lvm2 # æ·»åŠ Dockerè½¯ä»¶åŒ…æº yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo #å…³é—­æµ‹è¯•ç‰ˆæœ¬listï¼ˆåªæ˜¾ç¤ºç¨³å®šç‰ˆï¼‰ sudo yum-config-manager --enable docker-ce-edge sudo yum-config-manager --enable docker-ce-test # æ›´æ–°yumåŒ…ç´¢å¼• yum makecache fast #NO.1 ç›´æ¥å®‰è£…Docker CE ï¼ˆwill always install the highest possible versionï¼Œå¯èƒ½ä¸ç¬¦åˆä½ çš„éœ€æ±‚ï¼‰ yum install docker-ce #NO.2 æŒ‡å®šç‰ˆæœ¬å®‰è£… yum list docker-ce --showduplicates|sort -r #æ‰¾åˆ°éœ€è¦å®‰è£…çš„ yum install docker-ce-17.09.0.ce -y #å¯åŠ¨docker systemctl start docker \u0026amp; systemctl enable docker  é‡‡å‘æŒ‡å—  å½“ç„¶æœ¬ç€ä¸‡äº‹çš†æœ‰å‘çš„åŸåˆ™ï¼Œè¿™é‡Œä¹Ÿæ˜¯æœ‰å‘çš„ï¼Œåœ¨å®‰è£…ä¸­ä¹Ÿæ˜¯ä¼šé‡åˆ°å¦‚ä¸‹çš„é—®é¢˜\n åœ¨æ‰§è¡Œä¸€ä¸‹å‘½ä»¤çš„æ—¶å€™ï¼š\nyum install docker-ce-17.03.0.ce -y  ä¼šå‡ºç°å¦‚ä¸‹çš„æŠ¥é”™ï¼š\n--\u0026gt; Finished Dependency Resolution Error: Package: docker-ce-17.03.0.ce-1.el7.centos.x86_64 (docker-ce-stable) Requires: docker-ce-selinux \u0026gt;= 17.03.0.ce-1.el7.centos Available: docker-ce-selinux-17.03.0.ce-1.el7.centos.noarch (docker-ce-stable) docker-ce-selinux = 17.03.0.ce-1.el7.centos Available: docker-ce-selinux-17.03.1.ce-1.el7.centos.noarch (docker-ce-stable) docker-ce-selinux = 17.03.1.ce-1.el7.centos Available: docker-ce-selinux-17.03.2.ce-1.el7.centos.noarch (docker-ce-stable) docker-ce-selinux = 17.03.2.ce-1.el7.centos You could try using --skip-broken to work around the problem You could try running: rpm -Va --nofiles --nodigest  åœ¨å‡ºç°è¿™ä¸ªé—®é¢˜ä¹‹åï¼Œéœ€è¦æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š\n#è¦å…ˆå®‰è£…docker-ce-selinux-17.03.2.ceï¼Œå¦åˆ™å®‰è£…docker-ceä¼šæŠ¥é”™ yum install https://download.docker.com/linux/centos/7/x86_64/stable/Packages/docker-ce-selinux-17.03.2.ce-1.el7.centos.noarch.rpm #ç„¶åå†å®‰è£… docker-ce-17.03.2.ceï¼Œå°±èƒ½æ­£å¸¸å®‰è£… yum install docker-ce-17.03.2.ce-1.el7.centos  ","date":1534248321,"expirydate":-62135596800,"kind":"page","lang":"zh","lastmod":1534248321,"objectID":"26a8efe61d330e4635ae4d1e83bc5664","permalink":"https://guoxudong.io/post/install-docker/","publishdate":"2018-08-14T20:05:21+08:00","relpermalink":"/post/install-docker/","section":"post","summary":"åœ¨ä½¿ç”¨CentOS7ï¼Œå¹¶ä½¿ç”¨è«å®‰è£…æ¬è¿å·¥çš„æ—¶å€™ï¼Œå¾€å¾€ä¸å¸Œæœ›å®‰è£…æœ€æ–°ç‰ˆæœ¬çš„æ¬è¿å·¥ï¼Œè€Œæ˜¯å¸Œæœ›å®‰è£…ä¸è‡ªå·±ç†Ÿæ‚‰æˆ–è€…å½“å‰ä¸šåŠ¡ç¯å¢ƒéœ€è¦çš„ç‰ˆæœ¬ï¼Œä¾‹å¦‚ç›®å‰Kubernetesæ”¯æŒçš„æœ€æ–°æ¬è¿å·¥ç‰ˆæœ¬ä¸ºv17.03ï¼Œæ‰€ä»¥å°±äº§ç”Ÿäº†å®‰è£…æŒ‡å®šç‰ˆæœ¬ç å¤´å·¥äººçš„éœ€æ±‚ã€‚","tags":["å®¹å™¨","Linux"],"title":"centos7å®‰è£…æŒ‡å®šç‰ˆæœ¬çš„docker","type":"post"},{"authors":null,"categories":null,"content":" åˆ†äº«äºŒç»´ç      å¾®ä¿¡åˆ†äº«   æ‰«æåˆ†äº« æ‰«æäºŒç»´ç ï¼Œåˆ†äº«ç²¾å½©åšæ–‡ï¼\n         function getQueryVariable(variable) { var query = window.location.search.substring(1); var vars = query.split(\"\u0026\"); for (var i = 0; i  ","date":-62135596800,"expirydate":-62135596800,"kind":"page","lang":"zh","lastmod":-62135596800,"objectID":"5cd44e2cce277be566a0bb929960415b","permalink":"https://guoxudong.io/share/","publishdate":"0001-01-01T00:00:00Z","relpermalink":"/share/","section":"","summary":" åˆ†äº«äºŒç»´ç      å¾®ä¿¡åˆ†äº«   æ‰«æåˆ†äº« æ‰«æäºŒç»´ç ï¼Œåˆ†äº«ç²¾å½©åšæ–‡ï¼\n         function getQueryVariable(variable) { var query = window.location.search.substring(1); var vars = query.split(\"\u0026\"); for (var i = 0; i  ","tags":null,"title":"","type":"page"}]