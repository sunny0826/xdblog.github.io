<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Kubernetes on GuoXD Blog</title>
    <link>https://guoxudong.io/en/tags/kubernetes/</link>
    <description>Recent content in Kubernetes on GuoXD Blog</description>
    <generator>Source Themes academia (https://sourcethemes.com/academic/)</generator>
    <language>en-us</language>
    <copyright>&lt;a rel=&#39;license&#39; href=&#39;http://creativecommons.org/licenses/by-nc/4.0/&#39; target=&#39;_blank&#39;&gt;çŸ¥è¯†å…±äº«ç½²å-éå•†ä¸šæ€§ä½¿ç”¨ 4.0 å›½é™…è®¸å¯åè®®&lt;/a&gt;</copyright>
    <lastBuildDate>Tue, 18 Feb 2020 14:15:42 +0800</lastBuildDate>
    
	    <atom:link href="https://guoxudong.io/en/tags/kubernetes/index.xml" rel="self" type="application/rss+xml" />
    
    
    <item>
      <title>Kubernetes ä¸­ä¼˜åŒ–æµé‡å’Œå®‰å…¨æ€§éœ€è¦æ³¨æ„çš„7ç‚¹è¦æ±‚</title>
      <link>https://guoxudong.io/en/post/7-requirements-for-optimized-traffic-flow-and-security-in-kubernetes/</link>
      <pubDate>Tue, 18 Feb 2020 14:15:42 +0800</pubDate>
      
      <guid>https://guoxudong.io/en/post/7-requirements-for-optimized-traffic-flow-and-security-in-kubernetes/</guid>
      <description>

&lt;p&gt;æ ¹æ® &lt;a href=&#34;https://portworx.com/wp-content/uploads/2018/12/Portworx-Container-Adoption-Survey-Report-2018.pdf&#34; target=&#34;_blank&#34;&gt;Portworx åœ¨2018å¹´è¿›è¡Œçš„ä¸€é¡¹è°ƒæŸ¥&lt;/a&gt;ï¼Œäº”åˆ†ä¹‹å››çš„ä¼ä¸šç°åœ¨æ­£åœ¨ä½¿ç”¨å®¹å™¨ï¼Œå…¶ä¸­83ï¼…çš„ä¼ä¸šæ­£åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨ã€‚è€Œè¿™ä¸ªæ•°å­—åœ¨2017å¹´åªæœ‰67ï¼…ï¼Œå¾ˆæ˜æ˜¾ï¼Œå®¹å™¨ä¸ä»…ä»…æ˜¯ä¸€ç§æ—¶å°šã€‚&lt;/p&gt;

&lt;p&gt;ä½†æ˜¯ï¼Œéšç€å®¹å™¨çš„æµè¡Œï¼Œä¸€äº›å…¬å¸å¼€å§‹åœ¨ Kubernetes å†…å»ºç«‹æœ‰æ•ˆçš„æµé‡æ§åˆ¶å’Œå®‰å…¨ç­–ç•¥ã€‚&lt;/p&gt;

&lt;p&gt;ä½œä¸ºå®¹å™¨è°ƒåº¦å’Œé›†ç¾¤ç®¡ç†å¹³å°ï¼ŒKubernetes è‡´åŠ›äºæä¾›å‡ºè‰²çš„åŸºç¡€æ¶æ„ï¼Œå› æ­¤è¢«æ— æ•°å…¬å¸é‡‡ç”¨ã€‚å®ƒåˆšåˆšå¼€æºäº”å‘¨å¹´ï¼Œæœ€è¿‘åœ¨ç¦å¸ƒæ–¯å‘è¡¨çš„ä¸€ç¯‡åä¸º&lt;a href=&#34;https://www.forbes.com/sites/janakirammsv/2019/05/25/5-exciting-facts-about-kubernetes-on-the-eve-of-its-5th-anniversary/#87a930c3e736&#34; target=&#34;_blank&#34;&gt;ã€ŠKubernetes â€œthe most popular open source project of our timesâ€ã€‹&lt;/a&gt;çš„æ–‡ç« è¡¨ç¤ºï¼ŒKubernetes å·²è¢« Capital Oneï¼ŒING Groupï¼ŒPhilipsï¼ŒVMware å’Œ Huawei ç­‰å…¬å¸ä½¿ç”¨ã€‚&lt;/p&gt;

&lt;p&gt;å¯¹äºä½¿ç”¨å¾®æœåŠ¡æ¶æ„ï¼ˆMSAï¼‰å¼€å‘æ¥åº”ç”¨ç¨‹åºçš„å…¬å¸æ¥è¯´ï¼ŒKubernetes å…·æœ‰è®¸å¤šä¼˜åŠ¿ï¼Œç‰¹åˆ«æ˜¯åœ¨åº”ç”¨ç¨‹åºéƒ¨ç½²æ–¹é¢ã€‚&lt;/p&gt;

&lt;p&gt;å‡ºäºä¸Šé¢è¿™äº›åŸå› ï¼Œç ”å‘å›¢é˜Ÿæœ‰å¿…è¦äº†è§£ Kubernetes ç‹¬æœ‰çš„æµé‡å’Œå®‰å…¨æƒ…å†µã€‚åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†ä»‹ç»ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Kubernetes æ˜¯ä»€ä¹ˆã€‚&lt;/li&gt;
&lt;li&gt;Kubernetes é¢ä¸´çš„æŒ‘æˆ˜ã€‚&lt;/li&gt;
&lt;li&gt;Kubernetes ä¸­çš„ä¸ƒä¸ªæœ€é‡è¦çš„æµé‡å’Œå®‰å…¨è¦æ±‚ã€‚&lt;/li&gt;
&lt;li&gt;å…³äºå¼€å‘å’Œæ“ä½œç®€ä¾¿æ€§çš„æ³¨æ„äº‹é¡¹ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;è®©æˆ‘ä»¬å¼€å§‹å§ã€‚&lt;/p&gt;

&lt;h2 id=&#34;kubernetes-æ˜¯ä»€ä¹ˆ&#34;&gt;Kubernetes æ˜¯ä»€ä¹ˆ&lt;/h2&gt;

&lt;p&gt;Kubernetes æ˜¯ä¸€ä¸ªå¼€æºçš„å®¹å™¨ç¼–æ’ç³»ç»Ÿã€‚æ ¹æ® &lt;a href=&#34;https://kubernetes.io/docs/concepts/overview/what-is-kubernetes/&#34; target=&#34;_blank&#34;&gt;Kubernetesâ€™ own definition&lt;/a&gt;ï¼Œå®ƒæ˜¯ä¸€ä¸ªå¯ç§»æ¤ä¸”å¯æ‰©å±•çš„ç¨‹åºï¼Œç”¨äºç®¡ç†å®¹å™¨åŒ–çš„å·¥ä½œè´Ÿè½½å’ŒæœåŠ¡ï¼Œå¹¶æä¾›ä»¥å®¹å™¨ä¸ºä¸­å¿ƒçš„ç®¡ç†ç¯å¢ƒã€‚&lt;/p&gt;

&lt;p&gt;ä¸‹å›¾æè¿°äº† Kubernetes çš„åŸºæœ¬å·¥ä½œæ–¹å¼ã€‚å›¾ä¸­å¯ä»¥çœ‹åˆ°ä¸€ä¸ªä¸»èŠ‚ç‚¹å’Œä¸¤ä¸ªå·¥ä½œèŠ‚ç‚¹ã€‚ä¸»èŠ‚ç‚¹ç”¨æ¥å‘Šè¯‰å·¥ä½œç¨‹åºèŠ‚ç‚¹éœ€è¦åšä»€ä¹ˆå·¥ä½œï¼Œè€Œå·¥ä½œç¨‹åºèŠ‚ç‚¹åˆ™æ‰§è¡Œä¸»èŠ‚ç‚¹æä¾›ç»™å®ƒä»¬çš„æŒ‡ä»¤ã€‚åŒæ—¶å¯ä»¥æ·»åŠ å…¶ä»– Kubernetes å·¥ä½œèŠ‚ç‚¹ä»¥æ‰©å±•åŸºç¡€æ¶æ„ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://tvax1.sinaimg.cn/large/ad5fbf65gy1gc0k2knw9zj20r30czq6p.jpg&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;

&lt;p&gt;å¦‚æœä»”ç»†è§‚å¯Ÿï¼Œæ‚¨ä¼šå‘ç°åœ¨æ¯ä¸ªéƒ¨åˆ†ä¸­éƒ½å‡ºç°äº† â€œDockerâ€ ä¸€è¯ã€‚Docker æ˜¯ä¸€ä¸ªå®¹å™¨å¹³å°ï¼Œéå¸¸é€‚åˆåœ¨å•ä¸ªç‰©ç†æœºæˆ–è™šæ‹Ÿæœºï¼ˆVMï¼‰ä¸Šè¿è¡Œå®¹å™¨ã€‚&lt;/p&gt;

&lt;p&gt;ä½†æ˜¯ï¼Œå¦‚æœæ‚¨è¦åœ¨å¤šä¸ªä¸åŒçš„åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨æ•°ç™¾ä¸ªå®¹å™¨ï¼Œä¸”æ‚¨ä¸å¸Œæœ›å°†å®ƒä»¬å…¨éƒ¨æ”¾åœ¨ä¸€å°è®¡ç®—æœºä¸Šã€‚è¿™æ˜¯å‚¬ç”Ÿ Kubernetes çš„æŒ‘æˆ˜ä¹‹ä¸€ã€‚&lt;/p&gt;

&lt;p&gt;ä½¿ç”¨ overlay ç½‘ç»œï¼ˆå¦‚ä¸Šå›¾ä¸­çš„çº¢è‰²æ¡æ‰€ç¤ºï¼‰ï¼Œä¸»èŠ‚ç‚¹ä¸­çš„å®¹å™¨ä¸å¿…çŸ¥é“å®ƒéœ€è¦ä¸ä¹‹é€šä¿¡çš„å®¹å™¨ä½äºå“ªä¸ªèŠ‚ç‚¹ï¼Œå°±å¯ä»¥ç›´æ¥ä¸ä¹‹é€šä¿¡ã€‚&lt;/p&gt;

&lt;p&gt;Kubernetes çš„å¦ä¸€ä¸ªä¸»è¦åŠŸèƒ½æ˜¯å°†ä¿¡æ¯æ‰“åŒ…åˆ° â€œpodâ€ ä¸­ï¼Œå¦‚æœåº”ç”¨ç¨‹åºç”±å¤šä¸ªå®¹å™¨ç»„æˆï¼Œåˆ™å¯ä»¥å°†è¿™äº›å®¹å™¨ç»„æˆä¸€ä¸ª pod ï¼Œå¹¶å…±äº«æ•´ä¸ªç”Ÿå‘½å‘¨æœŸã€‚&lt;/p&gt;

&lt;h2 id=&#34;kubernetes-é¢ä¸´çš„æŒ‘æˆ˜&#34;&gt;Kubernetes é¢ä¸´çš„æŒ‘æˆ˜&lt;/h2&gt;

&lt;p&gt;åƒæ‰€æœ‰å…¶ä»–å®¹å™¨ç¼–æ’ç³»ç»Ÿä¸€æ ·ï¼ŒKubernetes ä¹Ÿé¢ä¸´çš„è¯¸å¤šæŒ‘æˆ˜ï¼Œå…¶ä¸­åŒ…æ‹¬ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;å†…éƒ¨å’Œå¤–éƒ¨ç½‘ç»œæ˜¯éš”ç¦»çš„ã€‚&lt;/li&gt;
&lt;li&gt;å®¹å™¨å’Œå®¹å™¨çš„ IP åœ°å€ä¼šå‘ç”Ÿå˜åŒ–ã€‚&lt;/li&gt;
&lt;li&gt;å¾®æœåŠ¡ä¹‹é—´æ²¡æœ‰è®¿é—®æ§åˆ¶ã€‚&lt;/li&gt;
&lt;li&gt;æ²¡æœ‰åº”ç”¨ç¨‹åºå±‚çš„å¯è§æ€§ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;è®©æˆ‘ä»¬æ›´æ·±å…¥åœ°æ¢è®¨è¿™äº›æŒ‘æˆ˜ã€‚Kubernetes çš„ç½‘ç»œä¸æ˜¯å¸¸è§„çš„ç½‘ç»œï¼Œå› ä¸ºå°½ç®¡ä½¿ç”¨äº† overlay ç½‘ç»œï¼Œä½†å†…éƒ¨å’Œå¤–éƒ¨ç½‘ç»œå´æ˜¯å½¼æ­¤ä¸é€šçš„ã€‚&lt;/p&gt;

&lt;p&gt;å¦å¤–ï¼ŒKubernetes ä¼šéš”ç¦»å‘ç”Ÿæ•…éšœçš„èŠ‚ç‚¹æˆ– Podï¼Œä»¥é˜²æ­¢å®ƒä»¬å…³é—­æ•´ä¸ªåº”ç”¨ç¨‹åºã€‚è¿™å¯èƒ½å¯¼è‡´èŠ‚ç‚¹ä¹‹é—´çš„IPåœ°å€é¢‘ç¹æ›´æ”¹ã€‚æƒ³è¦å‘ç°å®¹å™¨æˆ–å®¹å™¨çš„IPåœ°å€çš„æœåŠ¡å°±å¿…é¡»å¼„æ¸…æ¥šæ–°çš„IPåœ°å€æ˜¯ä»€ä¹ˆã€‚&lt;/p&gt;

&lt;p&gt;å½“æ¶‰åŠå¾®æœåŠ¡ä¹‹é—´çš„è®¿é—®æ§åˆ¶æ—¶ï¼Œå¯¹äºä¼ä¸šè€Œè¨€ï¼Œé‡è¦çš„æ˜¯è¦è®¤è¯†åˆ° Kubernetes èŠ‚ç‚¹ä¹‹é—´çš„æµé‡ä¹Ÿèƒ½å¤Ÿæµå…¥å¤–éƒ¨ç‰©ç†è®¾å¤‡æˆ– VMã€‚è¿™å¯èƒ½ä¼šæ¶ˆè€—èµ„æºå¹¶å‰Šå¼±å®‰å…¨æ€§ã€‚&lt;/p&gt;

&lt;p&gt;æœ€åï¼Œæ— æ³•åœ¨åº”ç”¨ç¨‹åºå±‚æ£€æŸ¥ä¿¡æ¯æ˜¯ä¸€ä¸ªå¤§é—®é¢˜ã€‚æ²¡æœ‰è¿™ç§å¯è§æ€§ï¼Œä¼ä¸šå¯èƒ½ä¼šé”™è¿‡æ”¶é›†è¯¦ç»†åˆ†æä¿¡æ¯çš„å…³é”®æœºä¼šã€‚&lt;/p&gt;

&lt;h2 id=&#34;kubernetes-å’Œäº‘å®‰å…¨è¦æ±‚&#34;&gt;Kubernetes å’Œäº‘å®‰å…¨è¦æ±‚&lt;/h2&gt;

&lt;p&gt;åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬å·²ç»è®¨è®ºäº† Kubernetes çš„åŸºæœ¬åŠŸèƒ½ä»¥åŠå®ƒæ‰€å¸¦æ¥çš„æŒ‘æˆ˜ã€‚ç°åœ¨ï¼ŒåŸºäº &lt;a href=&#34;https://www.a10networks.com/&#34; target=&#34;_blank&#34;&gt;A10 Networks&lt;/a&gt; 15å¹´çš„ç»éªŒï¼Œæˆ‘ä»¬å°†ç»§ç»­è®¨è®º Kubernetes å’Œäº‘å®‰å…¨æ€§çš„è¦æ±‚ã€‚&lt;/p&gt;

&lt;p&gt;æˆ‘ä»¬å°†è®¨è®ºå¦‚ä¸‹ä¸ƒç‚¹è¦æ±‚ï¼š&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;é«˜çº§åº”ç”¨ç¨‹åºäº¤ä»˜æ§åˆ¶å™¨ï¼ˆADCï¼‰&lt;/li&gt;
&lt;li&gt;ä½¿è´Ÿè½½å‡è¡¡å™¨ï¼ˆLBï¼‰é…ç½®ä¸åŸºç¡€æ¶æ„ä¿æŒåŒæ­¥&lt;/li&gt;
&lt;li&gt;å—åŒ—å‘æµé‡çš„å®‰å…¨&lt;/li&gt;
&lt;li&gt;ä¸ºå¤§è§„æ¨¡éƒ¨ç½²å‡†å¤‡çš„ä¸­å¤®æ§åˆ¶å™¨&lt;/li&gt;
&lt;li&gt;å¾®æœåŠ¡ä¹‹é—´çš„è®¿é—®æ§åˆ¶&lt;/li&gt;
&lt;li&gt;ä¸œè¥¿å‘æµé‡åŠ å¯†&lt;/li&gt;
&lt;li&gt;åº”ç”¨æµé‡åˆ†æ&lt;/li&gt;
&lt;/ol&gt;

&lt;h3 id=&#34;1-é«˜çº§åº”ç”¨ç¨‹åºäº¤ä»˜æ§åˆ¶å™¨-adc&#34;&gt;1. é«˜çº§åº”ç”¨ç¨‹åºäº¤ä»˜æ§åˆ¶å™¨ï¼ˆADCï¼‰&lt;/h3&gt;

&lt;p&gt;&lt;img src=&#34;https://tvax4.sinaimg.cn/large/ad5fbf65gy1gc0ldvmd2ij20r30bjad0.jpg&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;

&lt;p&gt;è™½ç„¶ä¼ä¸šå¯èƒ½å·²ç»åœ¨å…¶åŸºç¡€æ¶æ„çš„å…¶ä»–åŒºåŸŸä½¿ç”¨äº†é«˜çº§åº”ç”¨ç¨‹åºäº¤ä»˜æ§åˆ¶å™¨ï¼Œä½†ä¹Ÿæœ‰å¿…è¦ä¸º Kubernetes éƒ¨ç½²ä¸€ä¸ªã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œè¿™å°†å…è®¸ç®¡ç†å‘˜æ“ä½œåœ¨ Kubernetes å‰çš„é«˜çº§è´Ÿè½½å‡è¡¡å™¨ã€‚&lt;/p&gt;

&lt;p&gt;Kubernetes å·²ç»é…å¤‡äº†åä¸º &lt;em&gt;kube-proxy&lt;/em&gt; çš„ç½‘ç»œä»£ç†ã€‚å®ƒæä¾›äº†ç®€å•çš„ç”¨æ³•ï¼šé€šè¿‡åœ¨ä¸‰å±‚ä¸­è°ƒæ•´ iptables è§„åˆ™æ¥å·¥ä½œã€‚ä½†è¿™æ˜¯éå¸¸åŸºæœ¬çš„ï¼Œå¹¶ä¸å¤§å¤šæ•°ä¼ä¸šæ“ä½œä¹ æƒ¯çš„æœ‰æ‰€ä¸åŒã€‚&lt;/p&gt;

&lt;p&gt;è®¸å¤šäººä¼šå°† ADC æˆ–è´Ÿè½½å‡è¡¡å™¨æ”¾åœ¨ä»–ä»¬çš„ Kubernetes å‰ã€‚è¿™æ ·å°±å¯ä»¥åˆ›å»ºä¸€ä¸ªé™æ€çš„è™šæ‹Ÿ IPï¼Œæ‰€æœ‰äººéƒ½å¯ä»¥ä½¿ç”¨å®ƒï¼Œå¹¶åŠ¨æ€é…ç½®æ‰€æœ‰å†…å®¹ã€‚&lt;/p&gt;

&lt;p&gt;éšç€ Pod å’Œå®¹å™¨çš„å¯åŠ¨ï¼Œå¯ä»¥åŠ¨æ€é…ç½® ADCï¼Œä»¥æä¾›å¯¹æ–°åº”ç”¨ç¨‹åºçš„è®¿é—®ï¼ŒåŒæ—¶å®ç°ç½‘ç»œå®‰å…¨ç­–ç•¥ï¼Œå¹¶åœ¨æŸäº›æƒ…å†µä¸‹å®æ–½ä¸šåŠ¡æ•°æ®è§„åˆ™ã€‚é€šå¸¸ï¼Œè¿™æ˜¯é€šè¿‡ä½¿ç”¨ â€œIngress controllerâ€ æ¥å®ç°çš„ï¼Œå…¶å¯ä»¥ç›‘æ§åˆ°æ–°çš„å®¹å™¨å’Œå®¹å™¨çš„å¯åŠ¨ï¼Œå¹¶ä¸”å¯ä»¥é…ç½® ADC ä»¥æä¾›å¯¹æ–°åº”ç”¨ç¨‹åºçš„è®¿é—®æƒé™ï¼Œæˆ–è€…å°†æ›´æ”¹é€šçŸ¥ç»™å¦ä¸€ä¸ª â€œKubernetes controllerâ€ èŠ‚ç‚¹ã€‚&lt;/p&gt;

&lt;h3 id=&#34;2-ä½¿è´Ÿè½½å‡è¡¡å™¨-lb-é…ç½®ä¸åŸºç¡€æ¶æ„ä¿æŒåŒæ­¥&#34;&gt;2. ä½¿è´Ÿè½½å‡è¡¡å™¨ï¼ˆLBï¼‰é…ç½®ä¸åŸºç¡€æ¶æ„ä¿æŒåŒæ­¥&lt;/h3&gt;

&lt;p&gt;&lt;img src=&#34;https://tvax1.sinaimg.cn/large/ad5fbf65gy1gc0ll8lr83j20r30aytbc.jpg&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;

&lt;p&gt;ç”±äºåœ¨ Kubernetes ä¸­ä¸€åˆ‡éƒ½æ˜¯å¯ä»¥ä¸æ–­å˜åŒ–çš„ï¼Œå› æ­¤ä½äºé›†ç¾¤å‰çš„è´Ÿè½½å‡è¡¡å™¨æ˜¯æ— æ³•è¿½è¸ªæ‰€æœ‰äº‹æƒ…çš„ã€‚é™¤éæ‚¨æœ‰ç±»ä¼¼ä¸Šå›¾ç´«è‰²æ¡†æ‰€ç¤ºçš„ä¸œè¥¿ã€‚&lt;/p&gt;

&lt;p&gt;è¯¥ç´«è‰²æ¡†ä¸º Ingress Controllerï¼Œå½“å®¹å™¨å¯åŠ¨æˆ–åœæ­¢æ—¶ï¼Œä¼šåœ¨ Kubernetes ä¸­åˆ›å»ºä¸€ä¸ªäº‹ä»¶ã€‚ç„¶åï¼ŒIngress Controller ä¼šè¯†åˆ«è¯¥äº‹ä»¶å¹¶åšå‡ºç›¸åº”çš„å“åº”ã€‚&lt;/p&gt;

&lt;p&gt;å¦‚ä¸Šå›¾æ‰€ç¤ºï¼ŒIngress Controlle è¯†åˆ«åˆ°å®¹å™¨å·²å¯åŠ¨ï¼Œå¹¶å°†å…¶æ”¾å…¥è´Ÿè½½å‡è¡¡æ± ã€‚è¿™æ ·ï¼Œåº”ç”¨ç¨‹åºæ§åˆ¶å™¨ï¼ˆæ— è®ºæ˜¯åœ¨äº‘ä¹‹ä¸Šè¿˜æ˜¯å†…éƒ¨ï¼‰éƒ½å¯ä»¥ä¿æŒæœ€æ–°çŠ¶æ€ã€‚&lt;/p&gt;

&lt;p&gt;è¿™å‡è½»äº†ç®¡ç†å‘˜çš„è´Ÿæ‹…ï¼Œå¹¶ä¸”æ¯”æ‰‹åŠ¨ç®¡ç†æ•ˆç‡æ›´é«˜ã€‚&lt;/p&gt;

&lt;h3 id=&#34;3-å—åŒ—å‘æµé‡çš„å®‰å…¨&#34;&gt;3. å—åŒ—å‘æµé‡çš„å®‰å…¨&lt;/h3&gt;

&lt;p&gt;&lt;img src=&#34;https://tvax4.sinaimg.cn/large/ad5fbf65gy1gc1hnwxcqlj20r30bpgon.jpg&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;

&lt;p&gt;å—åŒ—å’Œä¸œè¥¿æ–¹éƒ½æ˜¯ç”¨æ¥æè¿°æµé‡æµå‘çš„é€šç”¨æœ¯è¯­ã€‚å—åŒ—æµé‡æ˜¯æŒ‡æµé‡æµå…¥å’Œæµå‡º Kubernetesã€‚&lt;/p&gt;

&lt;p&gt;å¦‚å‰æ‰€è¿°ï¼Œä¼ä¸šéœ€è¦åœ¨ Kubernetes å‰æ”¾ç½®ä¸€äº›è®¾å¤‡æ¥ç›‘è§†æµé‡ã€‚ä¾‹å¦‚ï¼Œé˜²ç«å¢™ï¼ŒDDoS é˜²æŠ¤æˆ–ä»»ä½•å…¶ä»–å¯æ•è·æ¶æ„æµé‡çš„è®¾å¤‡ã€‚&lt;/p&gt;

&lt;p&gt;è¿™äº›è®¾å¤‡åœ¨æµé‡ç®¡ç†æ–¹é¢ä¹Ÿå¾ˆæœ‰ç”¨ã€‚å› æ­¤ï¼Œå¦‚æœæµé‡éœ€è¦æµå‘ç‰¹å®šçš„åŒºåŸŸï¼Œè¿™æ˜¯ç†æƒ³çš„é€‰æ‹©ã€‚Ingress Controller åœ¨è¿™æ–¹é¢ä¹Ÿå¯ä»¥æä¾›å¾ˆå¤šå¸®åŠ©ã€‚&lt;/p&gt;

&lt;p&gt;å¦‚æœä¼ä¸šå¯ä»¥é€šè¿‡ç»Ÿä¸€çš„è§£å†³æ–¹æ¡ˆä½¿è¿™ç§åŠŸèƒ½è‡ªåŠ¨åŒ–ï¼Œé‚£ä¹ˆä»–ä»¬å¯ä»¥å¾—åˆ°ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;æ›´ç®€åŒ–æ“ä½œ&lt;/li&gt;
&lt;li&gt;æ›´å¥½çš„åº”ç”¨ç¨‹åºæ€§èƒ½&lt;/li&gt;
&lt;li&gt;å¯åœ¨ä¸ä¸­æ–­å‰ç«¯çš„æƒ…å†µä¸‹è¿›è¡Œåç«¯æ›´æ”¹&lt;/li&gt;
&lt;li&gt;è‡ªåŠ¨åŒ–çš„å®‰å…¨ç­–ç•¥&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&#34;4-ä¸ºå¤§è§„æ¨¡éƒ¨ç½²å‡†å¤‡çš„ä¸­å¤®æ§åˆ¶å™¨&#34;&gt;4. ä¸ºå¤§è§„æ¨¡éƒ¨ç½²å‡†å¤‡çš„ä¸­å¤®æ§åˆ¶å™¨&lt;/h3&gt;

&lt;p&gt;&lt;img src=&#34;https://tva4.sinaimg.cn/large/ad5fbf65gy1gc1i8wydpyj20r30bamzf.jpg&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;

&lt;p&gt;ä¼ä¸šè¿˜éœ€è¦è€ƒè™‘åˆ°æ¨ªå‘æ‰©å±•ï¼Œç‰¹åˆ«æ˜¯åœ¨å®‰å…¨æ€§æ–¹é¢ã€‚&lt;/p&gt;

&lt;p&gt;å¦‚ä¸Šå›¾æ‰€ç¤ºï¼ŒIngress Controllerï¼ˆç”±ç´«è‰²æ¡†è¡¨ç¤ºï¼‰ä»ç„¶å­˜åœ¨ï¼Œä½†æ˜¯è¿™æ¬¡å®ƒæ­£åœ¨å¤„ç†æ¥è‡ªå¤šä¸ª Kubernetes èŠ‚ç‚¹çš„è¯·æ±‚ï¼Œå¹¶ä¸”æ­£åœ¨è§‚æµ‹æ•´ä¸ª Kubernetes é›†ç¾¤ã€‚&lt;/p&gt;

&lt;p&gt;Ingress Controller å‰æ–¹çš„è“è‰²åœ†åœˆæ˜¯ &lt;a href=&#34;https://www.a10networks.com/products/harmony-controller/&#34; target=&#34;_blank&#34;&gt;A10 Networks Harmony Controller&lt;/a&gt;ã€‚è¿™ç§æ§åˆ¶å™¨å¯ä»¥å®ç°é«˜æ•ˆçš„è´Ÿè½½åˆ†é…ï¼Œå¹¶ä¸”å¯ä»¥å°†ä¿¡æ¯å¿«é€Ÿå‘é€åˆ°é€‚å½“çš„ä½ç½®ã€‚&lt;/p&gt;

&lt;p&gt;ä½¿ç”¨è¿™æ ·çš„ä¸­å¤®æ§åˆ¶å™¨ï¼Œå¿…é¡»é€‰æ‹©ä¸€ç§åœ¨ç°æœ‰è§£å†³æ–¹æ¡ˆä¸Šè¿›è¡Œå°‘é‡é¢å¤–é…ç½®ï¼Œå°±å¯è¿›è¡Œæ‰©å®¹å’Œç¼©å®¹çš„è§£å†³æ–¹æ¡ˆã€‚&lt;/p&gt;

&lt;h3 id=&#34;5-å¾®æœåŠ¡ä¹‹é—´çš„è®¿é—®æ§åˆ¶&#34;&gt;5. å¾®æœåŠ¡ä¹‹é—´çš„è®¿é—®æ§åˆ¶&lt;/h3&gt;

&lt;p&gt;&lt;img src=&#34;https://tva3.sinaimg.cn/large/ad5fbf65gy1gc1ikekni3j20r30ckjuz.jpg&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;

&lt;p&gt;ä¸æµå…¥å’Œæµå‡º Kubernetes çš„å—åŒ—æµé‡ç›¸åï¼Œä¸œè¥¿å‘æµé‡åœ¨ Kubernetes èŠ‚ç‚¹ä¹‹é—´æµåŠ¨ã€‚åœ¨ä¸Šå›¾ä¸­ï¼Œæ‚¨å¯ä»¥çœ‹åˆ°ä¸œè¥¿å‘æµé‡æ˜¯å¦‚ä½•è¿ä½œçš„ã€‚&lt;/p&gt;

&lt;p&gt;å½“æµé‡åœ¨ Kubernetes èŠ‚ç‚¹ä¹‹é—´æµåŠ¨æ—¶ï¼Œå¯ä»¥é€šè¿‡ç‰©ç†ç½‘ç»œï¼Œè™šæ‹Ÿç½‘ç»œæˆ– overlay ç½‘ç»œæ¥å‘é€è¯¥æµé‡ã€‚å¦‚æœä¸é€šè¿‡æŸç§æ–¹å¼æ¥ç›‘æ§é‚£äº›ä¸œè¥¿å‘çš„æµé‡ï¼Œé‚£ä¹ˆå¯¹æµé‡å¦‚ä½•ä»ä¸€ä¸ª pod æˆ–å®¹å™¨æµå‘å¦ä¸€ä¸ª pod æˆ–å®¹å™¨çš„äº†è§£å°±å˜å¾—éå¸¸å›°éš¾ã€‚&lt;/p&gt;

&lt;p&gt;å¦å¤–ï¼Œå®ƒè¿˜å¯èƒ½å¸¦æ¥ä¸¥é‡çš„å®‰å…¨é£é™©ï¼š&lt;strong&gt;è·å¾—å¯¹ä¸€ä¸ªå®¹å™¨çš„è®¿é—®æƒé™çš„æ”»å‡»è€…å¯ä»¥è®¿é—®æ•´ä¸ªå†…éƒ¨ç½‘ç»œ&lt;/strong&gt;ã€‚&lt;/p&gt;

&lt;p&gt;å¹¸è¿çš„æ˜¯ï¼Œä¼ä¸šå¯ä»¥é€šè¿‡â€œæœåŠ¡ç½‘æ ¼â€ï¼ˆä¾‹å¦‚ A10 Secure Service Meshï¼‰æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚é€šè¿‡å……å½“å®¹å™¨ä¹‹é—´çš„ä»£ç†ä»¥å®ç°å®‰å…¨è§„åˆ™ï¼Œè¿™å¯ä»¥ç¡®ä¿ä¸œè¥¿å‘çš„æµé‡å®‰å…¨ï¼Œå¹¶ä¸”è¿˜å¯ä»¥å¸®åŠ©æ‰©å±•ï¼Œè´Ÿè½½å‡è¡¡ï¼ŒæœåŠ¡ç›‘è§†ç­‰ã€‚&lt;/p&gt;

&lt;p&gt;æ­¤å¤–ï¼ŒæœåŠ¡ç½‘æ ¼å¯ä»¥åœ¨ Kubernetes å†…éƒ¨è¿è¡Œï¼Œè€Œæ— éœ€å°†æµé‡å‘é€åˆ°ç‰©ç†è®¾å¤‡æˆ– VMã€‚ä½¿ç”¨æœåŠ¡ç½‘æ ¼ï¼Œä¸œè¥¿å‘çš„æµé‡çŠ¶å†µå¦‚ä¸‹æ‰€ç¤ºï¼š&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://tvax1.sinaimg.cn/large/ad5fbf65gy1gc1ikyysvtj20r30bcn0n.jpg&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;

&lt;p&gt;é€šè¿‡è¿™ç§è§£å†³æ–¹æ¡ˆï¼Œåƒé‡‘èæœºæ„è¿™æ ·çš„ä¼ä¸šå¯ä»¥è½»æ¾åœ°å°†ä¿¡æ¯ä¿ç•™åœ¨åº”æœ‰çš„ä½ç½®ï¼Œè€Œä¸ç”¨æ‹…å¿ƒå½±å“å®‰å…¨æ€§ã€‚&lt;/p&gt;

&lt;h3 id=&#34;6-ä¸œè¥¿å‘æµé‡åŠ å¯†&#34;&gt;6. ä¸œè¥¿å‘æµé‡åŠ å¯†&lt;/h3&gt;

&lt;p&gt;&lt;img src=&#34;https://tva1.sinaimg.cn/large/ad5fbf65gy1gc1ivrlln4j20r309ojtt.jpg&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;

&lt;p&gt;å¦‚æœæ²¡æœ‰é€‚å½“çš„åŠ å¯†ï¼ŒæœªåŠ å¯†çš„ä¿¡æ¯å¯èƒ½ä¼šä»ä¸€ä¸ªç‰©ç† Kubernetes èŠ‚ç‚¹æµåˆ°å¦ä¸€ä¸ªã€‚è¿™æ˜¯ä¸€ä¸ªä¸¥é‡çš„é—®é¢˜ï¼Œç‰¹åˆ«æ˜¯å¯¹äºéœ€è¦å¤„ç†ç‰¹åˆ«æ•æ„Ÿä¿¡æ¯çš„é‡‘èæœºæ„å’Œå…¶ä»–ä¼ä¸šã€‚&lt;/p&gt;

&lt;p&gt;è¿™å°±æ˜¯ä¸ºä»€ä¹ˆå¯¹äºä¼ä¸šè€Œè¨€ï¼Œåœ¨è¯„ä¼°äº‘å®‰å…¨äº§å“æ—¶ï¼Œé‡è¦çš„æ˜¯é€‰æ‹©ä¸€ç§å¯ä»¥åœ¨ç¦»å¼€èŠ‚ç‚¹æ—¶å¯¹æµé‡è¿›è¡ŒåŠ å¯†ï¼Œå¹¶åœ¨è¿›å…¥èŠ‚ç‚¹æ—¶å¯¹å…¶è¿›è¡Œè§£å¯†çš„æ–¹æ³•ã€‚&lt;/p&gt;

&lt;p&gt;ä¾›åº”å•†å¯ä»¥é€šè¿‡ä¸¤ç§æ–¹å¼æä¾›è¿™ç§ç±»å‹çš„ä¿æŠ¤ï¼š&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://tva4.sinaimg.cn/large/ad5fbf65gy1gc1ixe7n4xj20r30b0aci.jpg&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;

&lt;p&gt;ç¬¬ä¸€ä¸ªé€‰æ‹©æ˜¯ Sidecar ä»£ç†éƒ¨ç½²ï¼Œè¿™ç§æ–¹æ³•ä¹Ÿæ˜¯æœ€å—æ¬¢è¿çš„ã€‚&lt;/p&gt;

&lt;p&gt;é€šè¿‡è¿™æ ·çš„éƒ¨ç½²ï¼Œç®¡ç†å‘˜å¯ä»¥å‘Šè¯‰ Kubernetesï¼Œæ¯å½“å¯åŠ¨ç‰¹å®š pod æ—¶ï¼Œåº”åœ¨è¯¥ pod ä¸­å¯åŠ¨ä¸€ä¸ªæˆ–å¤šä¸ªå…¶ä»–å®¹å™¨ã€‚&lt;/p&gt;

&lt;p&gt;é€šå¸¸ï¼Œå…¶ä»–å®¹å™¨æ˜¯æŸç§ç±»å‹çš„ä»£ç†ï¼Œå¯ä»¥ç®¡ç†ä» Pod æµå…¥å’Œæµå‡ºçš„æµé‡ã€‚&lt;/p&gt;

&lt;p&gt;ä»ä¸Šå›¾å¯ä»¥çœ‹å‡ºï¼ŒSidecar ä»£ç†éƒ¨ç½²çš„ä¸åˆ©ä¹‹å¤„åœ¨äºï¼Œæ¯ä¸ª pod éƒ½éœ€è¦å¯åŠ¨ä¸€ä¸ª Sidecarï¼Œå› æ­¤å°†å ç”¨ä¸€å®šæ•°é‡çš„èµ„æºã€‚&lt;/p&gt;

&lt;p&gt;å¦ä¸€æ–¹é¢ï¼Œä¼ä¸šä¹Ÿå¯ä»¥é€‰æ‹©ä¸­å¿ƒè¾å°„ä»£ç†éƒ¨ç½²ã€‚åœ¨è¿™ç§ç±»å‹çš„éƒ¨ç½²ä¸­ï¼Œä¸€ä¸ªä»£ç†ä¼šå¤„ç†ä»æ¯ä¸ª Kubernetes èŠ‚ç‚¹æµå‡ºçš„æµé‡ã€‚è¿™æ ·åªéœ€è¦è¾ƒå°‘çš„èµ„æºã€‚&lt;/p&gt;

&lt;h3 id=&#34;7-åº”ç”¨æµé‡åˆ†æ&#34;&gt;7. åº”ç”¨æµé‡åˆ†æ&lt;/h3&gt;

&lt;p&gt;&lt;img src=&#34;https://tvax2.sinaimg.cn/large/ad5fbf65gy1gc1j83rredj20r30dfn2i.jpg&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;

&lt;p&gt;æœ€åä¸€ç‚¹æ˜¯ï¼Œä¼ä¸šäº†è§£åº”ç”¨ç¨‹åºå±‚æµé‡çš„è¯¦ç»†ä¿¡æ¯è‡³å…³é‡è¦ã€‚&lt;/p&gt;

&lt;p&gt;æœ‰äº†å¯åŒæ—¶ç›‘æ§å—åŒ—å’Œä¸œè¥¿å‘æµé‡çš„æ§åˆ¶å™¨ï¼Œå°±å·²ç»æœ‰äº†ä¸¤ä¸ªç†æƒ³çš„ç‚¹æ¥æ”¶é›†æµé‡ä¿¡æ¯ã€‚&lt;/p&gt;

&lt;p&gt;è¿™æ ·åšæ—¢å¯ä»¥å¸®åŠ©ä¼˜åŒ–åº”ç”¨ç¨‹åºï¼Œåˆå¯ä»¥æé«˜å®‰å…¨æ€§ï¼Œè¿˜å¯ä»¥æ‹“å±•å¤šç§ä¸åŒçš„åŠŸèƒ½ã€‚ä»æœ€ç®€å•åˆ°æœ€é«˜çº§çš„é¡ºåºæ’åˆ—ï¼Œè¿™äº›åŠŸèƒ½å¯ä»¥å®ç°ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;é€šè¿‡æè¿°æ€§åˆ†æè¿›è¡Œ&lt;strong&gt;æ€§èƒ½ç›‘æ§&lt;/strong&gt;ã€‚å¤§å¤šæ•°ä¾›åº”å•†éƒ½æä¾›æ­¤åŠŸèƒ½ã€‚&lt;/li&gt;
&lt;li&gt;é€šè¿‡è¯Šæ–­åˆ†æ&lt;strong&gt;æ›´å¿«åœ°è¿›è¡Œæ•…éšœæ’é™¤&lt;/strong&gt;ã€‚å°‘æ•°ä¾›åº”å•†æä¾›æ­¤åŠŸèƒ½ã€‚&lt;/li&gt;
&lt;li&gt;é€šè¿‡æœºå™¨å­¦ä¹ ç³»ç»Ÿç”Ÿæˆçš„é¢„æµ‹åˆ†æè·å¾—&lt;strong&gt;å»ºè®®&lt;/strong&gt;ã€‚æ›´å°‘çš„ä¾›åº”å•†æä¾›æ­¤åŠŸèƒ½ã€‚&lt;/li&gt;
&lt;li&gt;é€šè¿‡çœŸå®ç›´è§‚çš„AIç”Ÿæˆçš„è§„èŒƒåˆ†æè¿›è¡Œ&lt;strong&gt;è‡ªé€‚åº”æ§åˆ¶&lt;/strong&gt;ã€‚åªæœ‰æœ€å¥½ï¼Œæœ€å…ˆè¿›çš„ä¾›åº”å•†æ‰èƒ½æä¾›æ­¤åŠŸèƒ½ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;å› æ­¤ï¼Œå½“ä¼ä¸šä¸ä¾›åº”å•†äº¤æµæ—¶ï¼Œè‡³å…³é‡è¦çš„æ˜¯ç¡®å®šä»–ä»¬çš„äº§å“å¯ä»¥æä¾›å“ªäº›åŠŸèƒ½ã€‚&lt;/p&gt;

&lt;p&gt;ä½¿ç”¨ A10 Networks çš„ç±»ä¼¼äº§å“ï¼Œå¯ä»¥æŸ¥çœ‹å¤§å›¾åˆ†æä»¥åŠç›¸å…³çš„å•ä¸ªæ•°æ®åŒ…ï¼Œæ—¥å¿—æ¡ç›®æˆ–é—®é¢˜ã€‚å…·æœ‰è¿™ç§ç²’åº¦çš„äº§å“æ˜¯ä¼ä¸šåº”å¯»æ±‚çš„äº§å“ã€‚&lt;/p&gt;

&lt;h2 id=&#34;å…³äºå¼€å‘å’Œæ“ä½œç®€ä¾¿æ€§çš„æ³¨æ„äº‹é¡¹&#34;&gt;å…³äºå¼€å‘å’Œæ“ä½œç®€ä¾¿æ€§çš„æ³¨æ„äº‹é¡¹&lt;/h2&gt;

&lt;p&gt;æœ€åï¼Œè®©æˆ‘ä»¬çœ‹ä¸€ä¸‹ä¼ä¸šåœ¨ Kubernetes ä¸­çš„æµé‡å’Œå®‰å…¨æ€§æ–¹é¢åº”è¯¥è¿½å¯»çš„ä¸œè¥¿ã€‚è€ƒè™‘è¿™äº›å› ç´ è¿˜å¯ä»¥ä¸ºå¼€å‘å’Œè¿ç»´å›¢é˜Ÿå¤§å¤§ç®€åŒ–å·¥ä½œï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;å…·æœ‰ç»Ÿä¸€è§£å†³æ–¹æ¡ˆçš„ç®€å•ä½“ç³»ç»“æ„ã€‚&lt;/li&gt;
&lt;li&gt;é›†ä¸­ç®¡ç†å’Œæ§åˆ¶ï¼Œä¾¿äºè¿›è¡Œåˆ†æå’Œæ•…éšœæ’é™¤ã€‚&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨å¸¸è§çš„é…ç½®æ ¼å¼ï¼Œä¾‹å¦‚ YAML å’Œ JSONã€‚&lt;/li&gt;
&lt;li&gt;æ— éœ€æ›´æ”¹åº”ç”¨ç¨‹åºä»£ç æˆ–é…ç½®å³å¯å®ç°å®‰å…¨æ€§å’Œæ”¶é›†åˆ†æä¿¡æ¯ã€‚&lt;/li&gt;
&lt;li&gt;è‡ªåŠ¨åŒ–åº”ç”¨å®‰å…¨ç­–ç•¥ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;å¦‚æœå…¬å¸ä¼˜å…ˆè€ƒè™‘ä»¥ä¸Šè¿™äº›ï¼Œåˆ™ä¼ä¸šå¯ä»¥åœ¨ä½¿ç”¨ Kubernetes æ—¶äº«å—ç®€å•ã€è‡ªåŠ¨åŒ–å’Œå®‰å…¨çš„æµé‡ã€‚æ‚¨çš„åŸºç¡€è®¾æ–½ã€æ¶æ„å’Œè¿ç»´å›¢é˜Ÿéƒ½ä¼šå¯¹æ­¤æ„Ÿåˆ°æ»¡æ„ã€‚&lt;/p&gt;

&lt;div class=&#34;alert alert-note&#34;&gt;
  &lt;div&gt;
    &lt;p&gt;&lt;strong&gt;åŸæ–‡ä¿¡æ¯&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;ä½œè€…ï¼šAlmas Razaã€John Allen&lt;/p&gt;

&lt;p&gt;å‘è¡¨æ—¶é—´ï¼š31 Jul 2019 9:51am&lt;/p&gt;

&lt;p&gt;åœ°å€ï¼š&lt;a href=&#34;https://thenewstack.io/7-requirements-for-optimized-traffic-flow-and-security-in-kubernetes/&#34; target=&#34;_blank&#34;&gt;https://thenewstack.io/7-requirements-for-optimized-traffic-flow-and-security-in-kubernetes/&lt;/a&gt;&lt;/p&gt;

  &lt;/div&gt;
&lt;/div&gt;
</description>
    </item>
    
    <item>
      <title>K3d&#43;Kubecm æœ¬åœ°å¼€å‘è¿ç»´ä¸¤ä¸è¯¯</title>
      <link>https://guoxudong.io/en/post/k3d-k3s-kubecm/</link>
      <pubDate>Mon, 17 Feb 2020 11:51:39 +0800</pubDate>
      
      <guid>https://guoxudong.io/en/post/k3d-k3s-kubecm/</guid>
      <description>

&lt;h2 id=&#34;å‰è¨€&#34;&gt;å‰è¨€&lt;/h2&gt;

&lt;p&gt;k3s æ˜¯ç”± Rancher Labs äº2019å¹´å¹´åˆæ¨å‡ºçš„ä¸€æ¬¾è½»é‡çº§ Kubernetes å‘è¡Œç‰ˆï¼Œæ»¡è¶³åœ¨è¾¹ç¼˜è®¡ç®—ç¯å¢ƒä¸­è¿è¡Œåœ¨ x86ã€ARM64 å’Œ ARMv7 å¤„ç†å™¨ä¸Šçš„å°å‹ã€æ˜“äºç®¡ç†çš„ Kubernetes é›†ç¾¤æ—¥ç›Šå¢é•¿çš„éœ€æ±‚ã€‚&lt;/p&gt;

&lt;p&gt;k3s é™¤äº†åœ¨è¾¹ç¼˜è®¡ç®—é¢†åŸŸçš„åº”ç”¨å¤–ï¼Œåœ¨ç ”å‘ä¾§çš„è¡¨ç°ä¹Ÿååˆ†å‡ºè‰²ã€‚æˆ‘ä»¬å¯ä»¥å¿«é€Ÿåœ¨æœ¬åœ°æ‹‰èµ·ä¸€ä¸ªè½»é‡çº§çš„ k8s é›†ç¾¤ï¼Œè€Œ k3d åˆ™æ˜¯ k3s ç¤¾åŒºåˆ›å»ºçš„ä¸€ä¸ªå°å·¥å…·ï¼Œå¯ä»¥åœ¨ä¸€ä¸ª docker è¿›ç¨‹ä¸­è¿è¡Œæ•´ä¸ª k3s é›†ç¾¤ï¼Œç›¸æ¯”ç›´æ¥ä½¿ç”¨ k3s è¿è¡Œåœ¨æœ¬åœ°ï¼Œæ›´å¥½ç®¡ç†å’Œéƒ¨ç½²ã€‚&lt;/p&gt;

&lt;p&gt;åœ¨æ—¥å¸¸å·¥ä½œä¸­ï¼Œæ—¶é•¿è¦åœ¨æœ¬åœ°é›†ç¾¤å’Œå¤šä¸ªè¿œç¨‹é›†ç¾¤ä¹‹é—´åˆ‡æ¢æ¥å®Œæˆè¿ç»´å·¥ä½œï¼Œè¿™æ—¶ä½¿ç”¨ &lt;code&gt;kubecm&lt;/code&gt; å¿«é€Ÿå°† k3s é›†ç¾¤çš„ kubeconfig ä¸ç°æœ‰é›†ç¾¤çš„ kubeconfig åˆå¹¶ï¼Œå¹¶å¯å¿«é€Ÿåˆ‡æ¢é›†ç¾¤ï¼Œå¼€å‘è¿ç»´ä¸¤ä¸è¯¯ã€‚&lt;/p&gt;

&lt;h2 id=&#34;å®‰è£…-k3d&#34;&gt;å®‰è£… k3d&lt;/h2&gt;

&lt;p&gt;k3d æä¾›äº†å¤šç§å®‰è£…æ–¹å¼ï¼Œååˆ†æ–¹ä¾¿ã€‚&lt;/p&gt;

&lt;h3 id=&#34;ä½¿ç”¨è„šæœ¬å®‰è£…&#34;&gt;ä½¿ç”¨è„šæœ¬å®‰è£…&lt;/h3&gt;

&lt;p&gt;ç›´æ¥ä½¿ç”¨ &lt;code&gt;wget&lt;/code&gt; å’Œ &lt;code&gt;curl&lt;/code&gt; å®‰è£…&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;wget -q -O - https://raw.githubusercontent.com/rancher/k3d/master/install.sh | bash
# æˆ–
curl -s https://raw.githubusercontent.com/rancher/k3d/master/install.sh | bash
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;å®‰è£…æŒ‡å®šç‰ˆæœ¬&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;wget -q -O - https://raw.githubusercontent.com/rancher/k3d/master/install.sh | TAG=v1.3.4 bash
# æˆ–
curl -s https://raw.githubusercontent.com/rancher/k3d/master/install.sh | TAG=v1.3.4 bash
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;ä½¿ç”¨-homebrew-å®‰è£…&#34;&gt;ä½¿ç”¨ Homebrew å®‰è£…&lt;/h3&gt;

&lt;p&gt;MacOS æˆ–å®‰è£…äº† Homebrew çš„ Linux å¯ä»¥ä½¿ç”¨ brew å®‰è£…ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;brew install k3d
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;å…¶ä»–&#34;&gt;å…¶ä»–&lt;/h3&gt;

&lt;p&gt;è¿˜å¯ä»¥ç›´æ¥å‰å¾€ &lt;a href=&#34;https://github.com/rancher/k3d/releases&#34; target=&#34;_blank&#34;&gt;release é¡µé¢&lt;/a&gt; ä¸‹è½½äºŒè¿›åˆ¶å¯æ‰§è¡Œæ–‡ä»¶ï¼Œæˆ–è€…ç›´æ¥ä½¿ç”¨ &lt;code&gt;go install github.com/rancher/k3d&lt;/code&gt; å®‰è£…ã€‚&lt;/p&gt;

&lt;h2 id=&#34;åˆ›å»º-k3s-é›†ç¾¤&#34;&gt;åˆ›å»º k3s é›†ç¾¤&lt;/h2&gt;

&lt;p&gt;åˆ›å»º k3s é›†ç¾¤ä¹Ÿååˆ†ç®€å•ï¼Œä¸€è¡Œå‘½ä»¤å°±å¯æ‹‰èµ·ï¼Œé€Ÿåº¦éå¸¸å¿«ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-go&#34;&gt;$ k3d create -n k3s-local
INFO[0000] Created cluster network with ID facae4a046b169721805f93ec21ba1acb65b9efb8cf35866529178cb0fba75a9
INFO[0000] Created docker volume  k3d-k3s-local-images
INFO[0000] Creating cluster [k3s-local]
INFO[0000] Creating server using docker.io/rancher/k3s:v1.0.1...
INFO[0000] SUCCESS: created cluster [k3s-local]
INFO[0000] You can now use the cluster with:

export KUBECONFIG=&amp;quot;$(k3d get-kubeconfig --name=&#39;k3s-local&#39;)&amp;quot;
kubectl cluster-info
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ä½†æ˜¯ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå¦‚æœæ²¡æœ‰æ¢¯å­çš„è¯ï¼Œk3s é›†ç¾¤è™½ç„¶æ‹‰èµ·æ¥å¾ˆå¿«ï¼Œä½†å› ä¸ºæ‹‰ä¸åˆ°é•œåƒï¼Œé›†ç¾¤ç»„ä»¶éƒ½æ— æ³•æ­£å¸¸æ‹‰èµ·ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-go&#34;&gt;$ export KUBECONFIG=&amp;quot;$(k3d get-kubeconfig --name=&#39;k3s-local&#39;)&amp;quot;
$ kubectl get pod -n kube-system
NAME                                      READY   STATUS              RESTARTS   AGE
helm-install-traefik-8wxmr                0/1     ContainerCreating   0          3m30s
metrics-server-6d684c7b5-j4sc7            0/1     ContainerCreating   0          3m30s
coredns-d798c9dd-j6lpw                    0/1     ContainerCreating   0          3m30s
local-path-provisioner-58fb86bdfd-wv7sw   0/1     ContainerCreating   0          3m30s
$ kubectl describe pod coredns-d798c9dd-j6lpw -n kube-system
...
Events:
  Type     Reason                  Age                 From                           Message
  ----     ------                  ----                ----                           -------
  Normal   Scheduled               &amp;lt;unknown&amp;gt;           default-scheduler              Successfully assigned kube-system/coredns-d798c9dd-j6lpw to k3d-k3s-local-server
  Warning  FailedCreatePodSandBox  7s (x7 over 4m30s)  kubelet, k3d-k3s-local-server  Failed create pod sandbox: rpc error: code = Unknown desc = failed to get sandbox image &amp;quot;k8s.gcr.io/pause:3.1&amp;quot;: failed to pull image &amp;quot;k8s.gcr.io/pause:3.1&amp;quot;: failed to pull and unpack image &amp;quot;k8s.gcr.io/pause:3.1&amp;quot;: failed to resolve reference &amp;quot;k8s.gcr.io/pause:3.1&amp;quot;: failed to do request: Head https://k8s.gcr.io/v2/pause/manifests/3.1: dial tcp 64.233.189.82:443: i/o timeout
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;ç¦»çº¿å®‰è£…&#34;&gt;ç¦»çº¿å®‰è£…&lt;/h3&gt;

&lt;p&gt;å¦‚æœæ²¡æœ‰æ¢¯å­çš„è¯ï¼Œå°±åªèƒ½é€‰æ‹©ä½¿ç”¨ç¦»çº¿å®‰è£…ã€‚&lt;/p&gt;

&lt;h4 id=&#34;ä¸‹è½½ç¦»çº¿é•œåƒ&#34;&gt;ä¸‹è½½ç¦»çº¿é•œåƒ&lt;/h4&gt;

&lt;p&gt;å‰å¾€ &lt;a href=&#34;https://github.com/rancher/k3s/releases&#34; target=&#34;_blank&#34;&gt;release é¡µé¢&lt;/a&gt; ä¸‹è½½æŒ‡å®šç‰ˆæœ¬çš„é•œåƒï¼Œè¿™é‡Œæˆ‘ä»¬ä¸‹è½½æœ€æ–°çš„ &lt;a href=&#34;https://github.com/rancher/k3s/releases/tag/v1.17.2%2Bk3s1&#34; target=&#34;_blank&#34;&gt;v1.17.2+k3s1&lt;/a&gt; é•œåƒã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://tvax1.sinaimg.cn/large/ad5fbf65gy1gbzdedmqpdj20sh0k776o.jpg&#34; alt=&#34;image&#34; /&gt;&lt;/p&gt;

&lt;p&gt;ä¸‹è½½åˆ° &lt;code&gt;~/airgap&lt;/code&gt; ç›®å½•ä¸­ï¼Œå¹¶è¿›è¡Œè§£å‹ï¼Œå°†è§£å‹åçš„ç›®å½•é‡å‘½åä¸º &lt;code&gt;1.17.2&lt;/code&gt;ã€‚&lt;/p&gt;

&lt;h3 id=&#34;è¿è¡Œç¦»çº¿é•œåƒ&#34;&gt;è¿è¡Œç¦»çº¿é•œåƒ&lt;/h3&gt;

&lt;p&gt;è¿™é‡Œå†æ¬¡è¿è¡Œ k3dï¼Œéƒ¨ç½² k3s é›†ç¾¤ã€‚è¿™é‡Œè¦æ³¨æ„çš„æ˜¯ï¼ŒæŒ‚è½½ç¦»çº¿é•œåƒçš„è¯ï¼Œå¿…é¡»ä½¿ç”¨ &lt;code&gt;-i&lt;/code&gt; flag æ¥æŒ‡å®šé•œåƒç‰ˆæœ¬ï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ &lt;a href=&#34;https://github.com/rancher/k3s/releases/tag/v1.17.2%2Bk3s1&#34; target=&#34;_blank&#34;&gt;v1.17.2+k3s1&lt;/a&gt; ç‰ˆæœ¬ï¼Œè€Œé•œåƒçš„ tag åˆ™æ˜¯ &lt;code&gt;v1.17.2-k3s1&lt;/code&gt;ï¼Œå¦‚æœä¸ç¡®å®š tagï¼Œå¯ä»¥å» &lt;a href=&#34;https://hub.docker.com/r/rancher/k3s/tags&#34; target=&#34;_blank&#34;&gt;DockerHub&lt;/a&gt; ä¸ŠæŸ¥çœ‹ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-go&#34;&gt;$ k3d create -n k3s-local -i rancher/k3s:v1.17.2-k3s1  -v $(pwd)/airgap/v1.17.2/:/var/lib/rancher/k3s/agent/images/
INFO[0000] Created cluster network with ID 10b3fca995fcb491ae1fe1c901672bf6f0a0fd6f51785ba8403947d2773ebd43
INFO[0000] Created docker volume  k3d-k3s-local-images
INFO[0000] Creating cluster [k3s-local]
INFO[0000] Creating server using docker.io/rancher/k3s:v1.17.2-k3s1...
INFO[0000] SUCCESS: created cluster [k3s-local]
INFO[0000] You can now use the cluster with:

export KUBECONFIG=&amp;quot;$(k3d get-kubeconfig --name=&#39;k3s-local&#39;)&amp;quot;
kubectl cluster-info
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;æŸ¥çœ‹ k3s é›†ç¾¤ç»„ä»¶å¯åŠ¨çŠ¶æ€ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-go&#34;&gt;$ export KUBECONFIG=&amp;quot;$(k3d get-kubeconfig --name=&#39;k3s-local&#39;)&amp;quot;
$ kubectl get pod -A -w
NAMESPACE     NAME                                      READY   STATUS              RESTARTS   AGE
kube-system   local-path-provisioner-58fb86bdfd-7jzbw   0/1     ContainerCreating   0          6m35s
kube-system   coredns-d798c9dd-jhmds                    1/1     Running             0          6m35s
kube-system   metrics-server-6d684c7b5-4x2cd            1/1     Running             0          6m35s
kube-system   traefik-6787cddb4b-9v7r4                  0/1     ContainerCreating   0          16s
kube-system   svclb-traefik-fzrqj                       0/2     ContainerCreating   0          15s
kube-system   helm-install-traefik-h8k2j                0/1     Completed           0          6m35s
kube-system   svclb-traefik-fzrqj                       2/2     Running             0          21s
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;ä½¿ç”¨-kubecm&#34;&gt;ä½¿ç”¨ kubecm&lt;/h2&gt;

&lt;p&gt;åœ¨ k3s é›†ç¾¤å¯åŠ¨æˆåŠŸåï¼Œä½¿ç”¨ &lt;a href=&#34;https://github.com/sunny0826/kubecm&#34; target=&#34;_blank&#34;&gt;&lt;code&gt;kubecm&lt;/code&gt;&lt;/a&gt;ï¼Œå°† k3s çš„ kubeconfig ä¸ç°æœ‰ kubeconfig åˆå¹¶ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;kubecm add -f $(k3d get-kubeconfig --name=&#39;k3s-local&#39;) -n k3s -c
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;åˆ‡æ¢é›†ç¾¤ï¼Œé€‰æ‹© k3sã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-go&#34;&gt;$ kubecm s
Use the arrow keys to navigate: â†“ â†‘ â†’ â†  and / toggles search
Select Kube Context
  ğŸ˜¼ k3s(*)
    prod-tg
    test
â†“   banma

--------- Info ----------
Name:           k3s
Cluster:        cluster-485d6mhcfm
User:           user-485d6mhcfm
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ç°åœ¨å°±å¯ä»¥åœ¨æœ¬åœ°ä½¿ç”¨ k3s é›†ç¾¤è¿›è¡Œå¼€å‘å·¥ä½œï¼Œè€Œæœ‰è¿ç»´å·¥ä½œçš„æ—¶å€™ï¼Œä½¿ç”¨ &lt;code&gt;kubecm switch&lt;/code&gt; å¿«é€Ÿåˆ‡æ¢é›†ç¾¤ã€‚&lt;/p&gt;

&lt;h2 id=&#34;ç»“è¯­&#34;&gt;ç»“è¯­&lt;/h2&gt;

&lt;p&gt;&lt;img src=&#34;https://tva3.sinaimg.cn/large/ad5fbf65gy1gbzegsyex5j20x90n70vv.jpg&#34; alt=&#34;image&#34; /&gt;&lt;/p&gt;

&lt;p&gt;k3s åŒæ—¶æ”¯æŒ &lt;strong&gt;x86_64&lt;/strong&gt;ã€&lt;strong&gt;ARM64&lt;/strong&gt; å’Œ &lt;strong&gt;ARMv7&lt;/strong&gt; æ¶æ„ï¼Œå®ƒå¯ä»¥ååˆ†çµæ´»åœ°è·¨ä»»ä½•è¾¹ç¼˜åŸºç¡€æ¶æ„å·¥ä½œã€‚ä¸æ k3s åœ¨è¾¹ç¼˜è®¡ç®—é¢†åŸŸçš„åº”ç”¨ï¼Œä¸ä¹‹å‰ä½¿ç”¨çš„ &lt;a href=&#34;https://github.com/kubernetes/minikube&#34; target=&#34;_blank&#34;&gt;minikube&lt;/a&gt; ç›¸æ¯”ï¼Œk3s è£å‰ªæ‰äº†è®¸å¤šç”¨ä¸åˆ°çš„åŠŸèƒ½ï¼Œå¹¶ä¸”å®‰è£…æ›´ç®€å•ï¼Œå¯åŠ¨æ›´å¿«ï¼Œç©ºé—´å ç”¨ä¹Ÿæ›´å°ã€‚ç›¸ä¿¡ k3s åœ¨å¼€å‘ä¾§çš„ä½œç”¨ä¹Ÿä¼šè¶Šæ¥è¶Šå¤§ï¼Œä½¿äº‘åŸç”Ÿåº”ç”¨çš„å¼€å‘æ›´åŠ çš„ä¾¿åˆ©ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Kubecmï¼šç®¡ç†ä½ çš„ kubeconfig</title>
      <link>https://guoxudong.io/en/post/kubecm/</link>
      <pubDate>Mon, 09 Dec 2019 10:07:46 +0800</pubDate>
      
      <guid>https://guoxudong.io/en/post/kubecm/</guid>
      <description>

&lt;h2 id=&#34;å‰è¨€&#34;&gt;å‰è¨€&lt;/h2&gt;

&lt;p&gt;è¯¥é¡¹ç›®è„±èƒäº &lt;a href=&#34;https://github.com/sunny0826/mergeKubeConfig&#34; target=&#34;_blank&#34;&gt;mergeKubeConfig&lt;/a&gt; é¡¹ç›®ï¼Œæœ€æ—©å†™è¯¥é¡¹ç›®çš„ç›®çš„æ˜¯åœ¨ä¸€å †æ‚ä¹±æ— ç« çš„ kubeconfig ä¸­è‡ªç”±çš„åˆ‡æ¢ã€‚éšç€éœ€è¦æ“ä½œçš„ Kubernetes é›†ç¾¤è¶Šæ¥è¶Šå¤šï¼Œåœ¨ä¸åŒçš„é›†ç¾¤ä¹‹é—´åˆ‡æ¢ä¹Ÿè¶Šæ¥è¶Šéº»çƒ¦ï¼Œè€Œæ“ä½œ Kubernetes é›†ç¾¤çš„æœ¬è´¨ä¸è¿‡æ˜¯é€šè¿‡ &lt;code&gt;kubeconfig&lt;/code&gt; è®¿é—® Kubernetes é›†ç¾¤çš„ API Serverï¼Œä»¥æ“ä½œ Kubernetes çš„å„ç§èµ„æºï¼Œè€Œ &lt;code&gt;kubeconfig&lt;/code&gt; ä¸è¿‡æ˜¯ä¸€ä¸ª yaml æ–‡ä»¶ï¼Œç”¨æ¥ä¿å­˜è®¿é—®é›†ç¾¤çš„å¯†é’¥ï¼Œæœ€æ—©çš„ &lt;a href=&#34;https://github.com/sunny0826/mergeKubeConfig&#34; target=&#34;_blank&#34;&gt;mergeKubeConfig&lt;/a&gt; ä¸è¿‡æ˜¯ä¸€ä¸ªæ“ä½œ yaml æ–‡ä»¶çš„ Python è„šæœ¬ã€‚è€Œéšç€ golang å­¦ä¹ çš„æ·±å…¥ï¼Œä¹Ÿå°±åŠ¨äº†é‡å†™è¿™ä¸ªé¡¹ç›®çš„å¿µå¤´ï¼Œå°±è¿™æ · &lt;a href=&#34;https://github.com/sunny0826/kubecm&#34; target=&#34;_blank&#34;&gt;kubecm&lt;/a&gt; è¯ç”Ÿäº†ã€‚&lt;/p&gt;

&lt;h2 id=&#34;kubecm&#34;&gt;kubecm&lt;/h2&gt;

&lt;p&gt;&lt;a href=&#34;https://github.com/sunny0826/kubecm&#34; target=&#34;_blank&#34;&gt;kubecm&lt;/a&gt; ç”± golang ç¼–å†™ï¼Œæ”¯æŒ &lt;code&gt;Mac&lt;/code&gt; &lt;code&gt;Linux&lt;/code&gt; å’Œ &lt;code&gt;windows&lt;/code&gt; å¹³å°ï¼Œ&lt;code&gt;delete&lt;/code&gt; &lt;code&gt;rename&lt;/code&gt; &lt;code&gt;switch&lt;/code&gt; æä¾›æ¯”è¾ƒå®ç”¨çš„äº¤äº’å¼çš„æ“ä½œï¼Œç›®å‰çš„åŠŸèƒ½åŒ…æ‹¬ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;add ï¼šæ·»åŠ æ–°çš„ &lt;code&gt;kubeconfig&lt;/code&gt; åˆ° &lt;code&gt;$HOME/.kube/config&lt;/code&gt; ä¸­&lt;/li&gt;
&lt;li&gt;completion ï¼šå‘½ä»¤è¡Œè‡ªåŠ¨è¡¥å…¨åŠŸèƒ½&lt;/li&gt;
&lt;li&gt;deleteï¼šåˆ é™¤å·²æœ‰çš„ &lt;code&gt;context&lt;/code&gt; ï¼Œæä¾›äº¤äº’å¼å’ŒæŒ‡å®šåˆ é™¤ä¸¤ç§æ–¹å¼&lt;/li&gt;
&lt;li&gt;mergeï¼šå°†æŒ‡å®šç›®å½•ä¸­çš„ &lt;code&gt;kubeconfig&lt;/code&gt; åˆå¹¶ä¸ºä¸€ä¸ª &lt;code&gt;kubeconfig&lt;/code&gt; æ–‡ä»¶&lt;/li&gt;
&lt;li&gt;renameï¼šé‡åæŒ‡å®šçš„ &lt;code&gt;context&lt;/code&gt;ï¼Œæä¾›äº¤äº’å¼å’ŒæŒ‡å®šé‡å‘½åä¸¤ç§æ–¹å¼&lt;/li&gt;
&lt;li&gt;switchï¼šäº¤äº’å¼åˆ‡æ¢ &lt;code&gt;context&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;å®‰è£…&#34;&gt;å®‰è£…&lt;/h2&gt;

&lt;p&gt;&lt;a href=&#34;https://github.com/sunny0826/kubecm&#34; target=&#34;_blank&#34;&gt;kubecm&lt;/a&gt; æ”¯æŒ &lt;code&gt;Mac&lt;/code&gt; &lt;code&gt;Linux&lt;/code&gt; å’Œ &lt;code&gt;windows&lt;/code&gt; å¹³å°ï¼Œå®‰è£…æ–¹å¼ä¹Ÿæ¯”è¾ƒç®€å•ï¼š&lt;/p&gt;

&lt;h4 id=&#34;macos&#34;&gt;MacOS&lt;/h4&gt;

&lt;div class=&#34;alert alert-note&#34;&gt;
  &lt;div&gt;
    ä½¿ç”¨ &lt;code&gt;brew&lt;/code&gt; æˆ–è€…ç›´æ¥ä¸‹è½½äºŒè¿›åˆ¶å¯æ‰§è¡Œæ–‡ä»¶
  &lt;/div&gt;
&lt;/div&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;brew install sunny0826/tap/kubecm
&lt;/code&gt;&lt;/pre&gt;

&lt;h4 id=&#34;linux&#34;&gt;Linux&lt;/h4&gt;

&lt;div class=&#34;alert alert-note&#34;&gt;
  &lt;div&gt;
    ä¸‹è½½äºŒè¿›åˆ¶å¯æ‰§è¡Œæ–‡ä»¶
  &lt;/div&gt;
&lt;/div&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;# linux x86_64
curl -Lo kubecm.tar.gz https://github.com/sunny0826/kubecm/releases/download/v${VERSION}/kubecm_${VERSION}_Linux_x86_64.tar.gz
tar -zxvf kubecm.tar.gz kubecm
cd kubecm
sudo mv kubecm /usr/local/bin/
&lt;/code&gt;&lt;/pre&gt;

&lt;h4 id=&#34;windows&#34;&gt;Windows&lt;/h4&gt;

&lt;div class=&#34;alert alert-note&#34;&gt;
  &lt;div&gt;
    ä¸‹è½½äºŒè¿›åˆ¶å¯æ‰§è¡Œæ–‡ä»¶ï¼Œå¹¶å°†æ–‡ä»¶ç§»åŠ¨åˆ° &lt;code&gt;$PATH&lt;/code&gt; ä¸­å³å¯
  &lt;/div&gt;
&lt;/div&gt;

&lt;h2 id=&#34;å‘½ä»¤è¡Œè‡ªåŠ¨è¡¥å…¨&#34;&gt;å‘½ä»¤è¡Œè‡ªåŠ¨è¡¥å…¨&lt;/h2&gt;

&lt;div class=&#34;alert alert-note&#34;&gt;
  &lt;div&gt;
    &lt;a href=&#34;https://github.com/sunny0826/kubecm&#34; target=&#34;_blank&#34;&gt;kubecm&lt;/a&gt; æä¾›äº†å’Œ &lt;a href=&#34;https://github.com/kubernetes/kubectl&#34; target=&#34;_blank&#34;&gt;kubectl&lt;/a&gt; ä¸€æ ·çš„ completion å‘½ä»¤è¡Œè‡ªåŠ¨è¡¥å…¨åŠŸèƒ½ï¼ˆæ”¯æŒ bash/zshï¼‰
  &lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;ä»¥ &lt;code&gt;zsh&lt;/code&gt; ä¸ºä¾‹ï¼Œåœ¨ &lt;code&gt;$HOME/.zshrc&lt;/code&gt; ä¸­æ·»åŠ &lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-vim&#34;&gt;source &amp;lt;(kubecm completion zsh)
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ç„¶åä½¿ç”¨ &lt;code&gt;source&lt;/code&gt; å‘½ä»¤ï¼Œä½¿å…¶ç”Ÿæ•ˆ&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;source $HOME/.zshrc
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ä¹‹åï¼Œåœ¨è¾“å…¥ &lt;code&gt;kubecm&lt;/code&gt; åæŒ‰ &lt;kbd&gt;tab&lt;/kbd&gt; é”®ï¼Œå°±å¯ä»¥çœ‹åˆ°å‘½ä»¤è¡Œè‡ªåŠ¨è¡¥å…¨çš„å†…å®¹&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://tva2.sinaimg.cn/large/ad5fbf65gy1g9qa0yy3bvj21co0f2hdt.jpg&#34; alt=&#34;image&#34; /&gt;&lt;/p&gt;

&lt;h2 id=&#34;æ“ä½œ-kubeconfig&#34;&gt;æ“ä½œ kubeconfig&lt;/h2&gt;

&lt;div class=&#34;alert alert-note&#34;&gt;
  &lt;div&gt;
    &lt;a href=&#34;https://github.com/sunny0826/kubecm&#34; target=&#34;_blank&#34;&gt;kubecm&lt;/a&gt; å¯ä»¥å®ç° &lt;code&gt;kubeconfig&lt;/code&gt; çš„æŸ¥çœ‹ã€æ·»åŠ ã€åˆ é™¤ã€åˆå¹¶ã€é‡å‘½åå’Œåˆ‡æ¢
  &lt;/div&gt;
&lt;/div&gt;

&lt;h4 id=&#34;æŸ¥çœ‹&#34;&gt;æŸ¥çœ‹&lt;/h4&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;# æŸ¥çœ‹ $HOME/.kube/config ä¸­æ‰€æœ‰çš„ context
kubecm
&lt;/code&gt;&lt;/pre&gt;

&lt;h4 id=&#34;æ·»åŠ &#34;&gt;æ·»åŠ &lt;/h4&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;# æ·»åŠ  example.yaml åˆ° $HOME/.kube/config.yamlï¼Œè¯¥æ–¹å¼ä¸ä¼šè¦†ç›–æº kubeconfigï¼Œåªä¼šåœ¨å½“å‰ç›®å½•ä¸­ç”Ÿæˆä¸€ä¸ª config.yaml æ–‡ä»¶
kubecm add -f example.yaml

# åŠŸèƒ½åŒä¸Šï¼Œä½†æ˜¯ä¼šå°† example.yaml ä¸­çš„ context å‘½åä¸º test
kubecm add -f example.yaml -n test

# æ·»åŠ  -c ä¼šè¦†ç›–æº kubeconfig
kubecm add -f example.yaml -c
&lt;/code&gt;&lt;/pre&gt;

&lt;h4 id=&#34;åˆ é™¤&#34;&gt;åˆ é™¤&lt;/h4&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;# äº¤äº’å¼åˆ é™¤
kubecm delete
# åˆ é™¤æŒ‡å®š context
kubecm delete my-context
&lt;/code&gt;&lt;/pre&gt;

&lt;h4 id=&#34;åˆå¹¶&#34;&gt;åˆå¹¶&lt;/h4&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;# åˆå¹¶ test ç›®å½•ä¸­çš„ kubeconfig,è¯¥æ–¹å¼ä¸ä¼šè¦†ç›–æº kubeconfigï¼Œåªä¼šåœ¨å½“å‰ç›®å½•ä¸­ç”Ÿæˆä¸€ä¸ª config.yaml æ–‡ä»¶
kubecm merge -f test 

# æ·»åŠ  -c ä¼šè¦†ç›–æº kubeconfig
kubecm merge -f test -c
&lt;/code&gt;&lt;/pre&gt;

&lt;h4 id=&#34;é‡å‘½å&#34;&gt;é‡å‘½å&lt;/h4&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;# äº¤äº’å¼é‡å‘½å
kubecm rename
# å°† dev é‡å‘½åä¸º test
kubecm rename -o dev -n test
# é‡å‘½å current-context ä¸º dev
kubecm rename -n dev -c
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;æ•ˆæœå±•ç¤º&#34;&gt;æ•ˆæœå±•ç¤º&lt;/h2&gt;

&lt;p&gt;&lt;img src=&#34;Interaction.gif&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;

&lt;h2 id=&#34;ç»“è¯­&#34;&gt;ç»“è¯­&lt;/h2&gt;

&lt;p&gt;&lt;a href=&#34;https://github.com/sunny0826/kubecm&#34; target=&#34;_blank&#34;&gt;kubecm&lt;/a&gt; é¡¹ç›®çš„åˆè¡·ä¸ºå­¦ä¹  golang å¹¶ç†Ÿæ‚‰ client-go çš„ä½¿ç”¨ï¼Œéšç€ä½¿ç”¨çš„æ·±å…¥ï¼Œæ–­æ–­ç»­ç»­å¢åŠ äº†ä¸å°‘åŠŸèƒ½ï¼Œå¼€å‘å‡ºäº†ä¸€ä¸ªçœ‹ä¸Šå»è¿˜ç®—æ­£è§„çš„é¡¹ç›®ã€‚æ€»çš„æ¥è¯´éƒ½æ˜¯æ ¹æ®è‡ªå·±çš„å–œå¥½æ¥å¼€å‘çš„ä¸šä½™é¡¹ç›®ï¼Œæ¬¢è¿å„ä½é€šè¿‡ &lt;a href=&#34;https://github.com/sunny0826/kubecm/issues/new&#34; target=&#34;_blank&#34;&gt;ISSUE&lt;/a&gt; æ¥è¿›è¡Œäº¤æµå’Œè®¨è®ºã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>å°å·¥å…·ä»‹ç»ï¼šKubeWatch</title>
      <link>https://guoxudong.io/en/post/kubewatch/</link>
      <pubDate>Wed, 04 Dec 2019 17:09:51 +0800</pubDate>
      
      <guid>https://guoxudong.io/en/post/kubewatch/</guid>
      <description>

&lt;h2 id=&#34;å‰è¨€&#34;&gt;å‰è¨€&lt;/h2&gt;

&lt;p&gt;è¿™æ¬¡è¦ä»‹ç»ä¸€ä¸ª Kubernetes èµ„æºè§‚æµ‹å·¥å…·ï¼Œå®æ—¶ç›‘æ§ Kubernetes é›†ç¾¤ä¸­å„ç§èµ„æºçš„æ–°å»ºã€æ›´æ–°å’Œåˆ é™¤ï¼Œå¹¶å®æ—¶é€šçŸ¥åˆ°å„ç§åä½œè½¯ä»¶/èŠå¤©è½¯ä»¶ï¼Œç›®å‰æ”¯æŒçš„é€šçŸ¥æ¸ é“æœ‰ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;code&gt;slack&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;hipchat&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;mattermost&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;flock&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;webhook&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;æˆ‘è¿™è¾¹å¼€å‘äº†é’‰é’‰çš„é€šçŸ¥æ¸ é“ï¼Œä½†æ˜¯åœ¨ä¸Šæ¸¸ &lt;a href=&#34;https://github.com/bitnami-labs/kubewatch/issues/198&#34; target=&#34;_blank&#34;&gt;ISSUE#198&lt;/a&gt; ä¸­æå‡ºçš„è´¡çŒ®è¯·æ±‚å¹¶æ²¡æœ‰å¾—åˆ°å›åº”ï¼Œæ‰€ä»¥è¿™è¾¹åªèƒ½ fork äº†ä»£ç ï¼Œç„¶åè‡ªå·±è¿›è¡Œäº†å¼€å‘ï¼Œä»¥æ”¯æŒé’‰é’‰é€šçŸ¥ã€‚&lt;/p&gt;

&lt;h2 id=&#34;å®‰è£…&#34;&gt;å®‰è£…&lt;/h2&gt;

&lt;p&gt;è¿™é‡Œæ¨èä½¿ç”¨ helm è¿›è¡Œå®‰è£…ï¼Œå¿«é€Ÿéƒ¨ç½²&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;helm install kubewatch stable/kubewatch \
--set rbac.create=true \
--set slack.channel=&#39;#YOUR_CHANNEL&#39; \
--set slack.token=&#39;xoxb-YOUR_TOKEN&#39; \
--set resourcesToWatch.pod=true \
--set resourcesToWatch.daemonset=true
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;å¦‚æœæƒ³ä½¿ç”¨é’‰é’‰é€šçŸ¥ï¼Œåˆ™å¯ä»¥åœ¨ &lt;a href=&#34;https://github.com/sunny0826/kubewatch-chat&#34; target=&#34;_blank&#34;&gt;GitHub&lt;/a&gt; ä¸Šæ‹‰å–æˆ‘çš„ä»£ç ï¼Œä»£ç ä¸­åŒ…å« helm chart åŒ…ï¼Œå¯ç›´æ¥è¿›è¡Œå®‰è£…&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;git clone https://github.com/sunny0826/kubewatch-chat.git
cd kubewatch-chat
helm install kubewatch kubewatch \
--set dingtalk.sign=&amp;quot;XXX&amp;quot; \
--set dingtalk.token=&amp;quot;XXXX-XXXX-XXXX&amp;quot;
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;é’‰é’‰é…ç½®&#34;&gt;é’‰é’‰é…ç½®&lt;/h2&gt;

&lt;p&gt;åœ¨é’‰é’‰ä¸­åˆ›å»º &lt;code&gt;æ™ºèƒ½ç¾¤åŠ©æ‰‹&lt;/code&gt; ï¼Œä¹‹å&lt;/p&gt;

&lt;h3 id=&#34;è·å–-token&#34;&gt;è·å– token&lt;/h3&gt;

&lt;p&gt;å¤åˆ¶çš„ webhook ä¸­ &lt;code&gt;https://oapi.dingtalk.com/robot/send?access_token={YOUR_TOKEN}&lt;/code&gt;, &lt;code&gt;{YOUR_TOKEN}&lt;/code&gt; å°±æ˜¯è¦å¡«å…¥çš„ tokenã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://tva4.sinaimg.cn/large/ad5fbf65gy1g9ku2hvs16j20ep05smxk.jpg&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;

&lt;h2 id=&#34;å®‰å…¨è®¾ç½®&#34;&gt;å®‰å…¨è®¾ç½®&lt;/h2&gt;

&lt;p&gt;é’‰é’‰æ™ºèƒ½ç¾¤åŠ©æ‰‹åœ¨æ›´æ–°åæ–°å¢äº†å®‰å…¨è®¾ç½®ï¼Œæä¾›ä¸‰ç§éªŒè¯æ–¹å¼ &lt;code&gt;è‡ªå®šä¹‰å…³é”®è¯&lt;/code&gt; &lt;code&gt;åŠ ç­¾&lt;/code&gt; &lt;code&gt;IPåœ°å€ï¼ˆæ®µï¼‰&lt;/code&gt;ï¼Œè¿™é‡Œæ¨èä½¿ç”¨ &lt;code&gt;IPåœ°å€ï¼ˆæ®µï¼‰çš„æ–¹å¼&lt;/code&gt;ï¼Œç›´æ¥å°† Kubernetes é›†ç¾¤çš„å‡ºå£ IP å¡«å…¥è®¾ç½®å³å¯ã€‚åŒæ—¶ä¹Ÿæä¾›äº† &lt;code&gt;åŠ ç­¾&lt;/code&gt; çš„æ–¹å¼ï¼Œæ‹·è´ç§˜é’¥ï¼Œå°†å…¶å¡«å…¥ &lt;code&gt;dingtalk.sign&lt;/code&gt; ä¸­ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://tva1.sinaimg.cn/large/ad5fbf65gy1g9ku6qjwy2j20fo077glw.jpg&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;

&lt;h2 id=&#34;é¡¹ç›®é…ç½®&#34;&gt;é¡¹ç›®é…ç½®&lt;/h2&gt;

&lt;p&gt;ç¼–è¾‘ &lt;code&gt;kubewatch/value.yaml&lt;/code&gt; ï¼Œä¿®æ”¹é…ç½®&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-yaml&#34;&gt;## Global Docker image parameters
## Please, note that this will override the image parameters, including dependencies, configured to use the global value
## Current available global Docker image parameters: imageRegistry and imagePullSecrets
##
# global:
#   imageRegistry: myRegistryName
#   imagePullSecrets:
#     - myRegistryKeySecretName

slack:
  enabled: false
  channel: &amp;quot;&amp;quot;
  token: &amp;quot;xoxb&amp;quot;

hipchat:
  enabled: false
  # room: &amp;quot;&amp;quot;
  # token: &amp;quot;&amp;quot;
  # url: &amp;quot;&amp;quot;
mattermost:
  enabled: false
  # channel: &amp;quot;&amp;quot;
  # url: &amp;quot;&amp;quot;
  # username: &amp;quot;&amp;quot;
flock:
  enabled: false
  # url: &amp;quot;&amp;quot;
webhook:
  enabled: false
  # url: &amp;quot;&amp;quot;
dingtalk:
  enabled: true
  token: &amp;quot;&amp;quot;
  sign: &amp;quot;&amp;quot;

# namespace to watch, leave it empty for watching all.
namespaceToWatch: &amp;quot;&amp;quot;

# Resources to watch
resourcesToWatch:
  deployment: true
  replicationcontroller: false
  replicaset: false
  daemonset: false
  services: false
  pod: true
  job: false
  persistentvolume: false

image:
  registry: docker.io
#  repository: bitnami/kubewatch
  repository: guoxudongdocker/kubewatch-chart
#  tag: 0.0.4-debian-9-r405
  tag: latest
  pullPolicy: Always
  ## Optionally specify an array of imagePullSecrets.
  ## Secrets must be manually created in the namespace.
  ## ref: https://kubernetes.io/docs/tasks/configure-pod-container/pull-image-private-registry/
  ##
  # pullSecrets:
  #   - myRegistryKeySecretName

## String to partially override kubewatch.fullname template (will maintain the release name)
##
# nameOverride:

## String to fully override kubewatch.fullname template
##
# fullnameOverride:

rbac:
  # If true, create &amp;amp; use RBAC resources
  #
  create: true

serviceAccount:
  # Specifies whether a ServiceAccount should be created
  create: true
  # The name of the ServiceAccount to use.
  # If not set and create is true, a name is generated using the fullname template
  name:

resources: {}
  # limits:
  #   cpu: 100m
  #   memory: 300Mi
  # requests:
  #   cpu: 100m
  #   memory: 300Mi

# Affinity for pod assignment
# Ref: https://kubernetes.io/docs/concepts/configuration/assign-pod-node/#affinity-and-anti-affinity
# affinity: {}

# Tolerations for pod assignment
# Ref: https://kubernetes.io/docs/concepts/configuration/taint-and-toleration/
tolerations: []

# Node labels for pod assignment
# Ref: https://kubernetes.io/docs/user-guide/node-selection/
nodeSelector: {}

podAnnotations: {}
podLabels: {}
replicaCount: 1

&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ä½¿ç”¨ &lt;code&gt;value.yaml&lt;/code&gt; å®‰è£…&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;git clone https://github.com/sunny0826/kubewatch-chat.git
cd kubewatch-chat
helm install my-release -f kubewatch/values.yaml
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;slack-é…ç½®&#34;&gt;Slack é…ç½®&lt;/h2&gt;

&lt;p&gt;Slack ä¸º kubewatch é»˜è®¤çš„é€šçŸ¥è½¯ä»¶ï¼Œè¿™é‡Œå°±ä¸ç®€ä»‹ Slack çš„å®‰è£…å’Œæ³¨å†Œï¼Œç›´æ¥ä»åˆ›å»º APP å¼€å§‹&lt;/p&gt;

&lt;h3 id=&#34;åˆ›å»ºä¸€ä¸ª-app&#34;&gt;åˆ›å»ºä¸€ä¸ª APP&lt;/h3&gt;

&lt;p&gt;è¿›å»åˆ›å»º &lt;a href=&#34;https://api.slack.com/apps&#34; target=&#34;_blank&#34;&gt;APP é¡µé¢&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://tva1.sinaimg.cn/large/ad5fbf65gy1g9kum3x5npj21h40p6tdx.jpg&#34; alt=&#34;image&#34; /&gt;&lt;/p&gt;

&lt;p&gt;é€‰æ‹© &lt;code&gt;App Name&lt;/code&gt; å’Œ &lt;code&gt;Development Slack Workspace&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://tva1.sinaimg.cn/large/ad5fbf65gy1g9kupp0av1j210c0uejvj.jpg&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;

&lt;h3 id=&#34;æ·»åŠ -bot-ç”¨æˆ·&#34;&gt;æ·»åŠ  Bot ç”¨æˆ·&lt;/h3&gt;

&lt;p&gt;&lt;img src=&#34;https://tvax3.sinaimg.cn/large/ad5fbf65gy1g9kuszmgggj21n4156gu2.jpg&#34; alt=&#34;image&#34; /&gt;&lt;/p&gt;

&lt;h3 id=&#34;æ·»åŠ -app-åˆ°-workspace&#34;&gt;æ·»åŠ  App åˆ° Workspace&lt;/h3&gt;

&lt;p&gt;&lt;img src=&#34;https://tva3.sinaimg.cn/large/ad5fbf65gy1g9kuyzwzetj21qu0wmq9n.jpg&#34; alt=&#34;image&#34; /&gt;&lt;/p&gt;

&lt;h3 id=&#34;è·å–-bot-token&#34;&gt;è·å– Bot-token&lt;/h3&gt;

&lt;p&gt;&lt;img src=&#34;https://tvax3.sinaimg.cn/large/ad5fbf65gy1g9kv06dva8j21s60uajxf.jpg&#34; alt=&#34;image&#34; /&gt;&lt;/p&gt;

&lt;h2 id=&#34;é€šçŸ¥æ•ˆæœ&#34;&gt;é€šçŸ¥æ•ˆæœ&lt;/h2&gt;

&lt;p&gt;åœ¨ Slack ä¸­ï¼Œ&lt;code&gt;åˆ›å»º&lt;/code&gt; &lt;code&gt;æ›´æ–°&lt;/code&gt; &lt;code&gt;åˆ é™¤&lt;/code&gt; åˆ†åˆ«ä»¥ç»¿ã€é»„å’Œçº¢è‰²ä»£è¡¨&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://tvax1.sinaimg.cn/large/ad5fbf65gy1g9kv23nvmoj213c0mewj4.jpg&#34; alt=&#34;image&#34; /&gt;&lt;/p&gt;

&lt;p&gt;åœ¨é’‰é’‰ä¸­ï¼Œæˆ‘è¿›è¡Œäº†æ±‰åŒ–&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://tvax3.sinaimg.cn/large/ad5fbf65gy1g9kv5fppglj20dd08zdgs.jpg&#34; alt=&#34;image&#34; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://tvax4.sinaimg.cn/large/ad5fbf65gy1g9kv5uuxn4j20ea08fgmk.jpg&#34; alt=&#34;image&#34; /&gt;&lt;/p&gt;

&lt;h2 id=&#34;ç»“è¯­&#34;&gt;ç»“è¯­&lt;/h2&gt;

&lt;p&gt;å¯¹äº kubewatch æˆ‘ä»¬è¿™é‡Œä¸»è¦ç”¨ä½œç›‘æ§å„ç§ CronJob çš„å®šæ—¶è§¦å‘çŠ¶æ€ï¼Œå·²ç» ConfigMap å’Œ Secrets çš„çŠ¶æ€å˜åŒ–ï¼ŒåŒæ—¶ä¹Ÿè§‚å¯Ÿ HPA è§¦å‘çš„å¼¹æ€§ä¼¸ç¼©çš„çŠ¶æ€ï¼Œå¯ä»¥å®æ—¶è§‚æµ‹åˆ°ä¸šåŠ¡é«˜å³°çš„åˆ°æ¥ï¼Œæ˜¯ä¸€ä¸ªä¸é”™çš„å°å·¥å…·ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>ä½¿ç”¨ Velero è¿›è¡Œé›†ç¾¤å¤‡ä»½ä¸è¿ç§»</title>
      <link>https://guoxudong.io/en/post/aliyun-velero/</link>
      <pubDate>Wed, 13 Nov 2019 09:13:22 +0800</pubDate>
      
      <guid>https://guoxudong.io/en/post/aliyun-velero/</guid>
      <description>

&lt;h2 id=&#34;å‰è¨€&#34;&gt;å‰è¨€&lt;/h2&gt;

&lt;p&gt;åœ¨è¿‘æ—¥çš„ä¸€ä¸ªé£å’Œæ—¥ä¸½çš„ä¸‹åˆï¼Œæ­£åœ¨å¿«ä¹çš„å†™ bug æ—¶ï¼Œçªç„¶é—´é’‰é’‰å°±è¢« call çˆ†äº†ï¼ŒåŸæ¥æ˜¯ k8s æµ‹è¯•é›†ç¾¤çš„ä¸€ä¸ª namespace çªç„¶ä¸è§äº†ã€‚è¿™ä¸ª namespace é‡Œé¢æœ‰ 60 å¤šä¸ªæœåŠ¡ï¼Œç¬é—´å…¨éƒ¨æ²¡æœ‰äº†â€¦â€¦è™½ç„¶å¾—ç›Šäºæˆ‘ä»¬çš„ CI/CD ç³»ç»Ÿï¼Œè¿™äº›æœåŠ¡å¾ˆå¿«éƒ½é‡æ–°éƒ¨ç½²å¹¶æ­£å¸¸è¿è¡Œäº†ï¼Œä½†æ˜¯å¦‚æœåœ¨ç”Ÿäº§ç¯å¢ƒï¼Œé‚£åæœå°±æ˜¯ä¸å¯æƒ³è±¡çš„äº†ã€‚åœ¨æ’æŸ¥è¿™ä¸ªé—®é¢˜å‘ç”Ÿçš„åŸå› çš„åŒæ—¶ï¼Œé›†ç¾¤èµ„æºçš„ç¾å¤‡å’Œæ¢å¤åŠŸèƒ½å°±æä¸Šæ—¥ç¨‹äº†ï¼Œè¿™æ—¶ Velero å°±å‡ºç°äº†ã€‚&lt;/p&gt;

&lt;h2 id=&#34;velero&#34;&gt;Velero&lt;/h2&gt;

&lt;p&gt;&lt;a href=&#34;https://github.com/vmware-tanzu/velero&#34; target=&#34;_blank&#34;&gt;Velero&lt;/a&gt; æ˜¯ VMWare å¼€æºçš„ k8s é›†ç¾¤å¤‡ä»½ã€è¿ç§»å·¥å…·ã€‚å¯ä»¥å¸®åŠ©æˆ‘ä»¬å®Œæˆ k8s çš„ä¾‹è¡Œå¤‡ä»½å·¥ä½œï¼Œä»¥ä¾¿åœ¨å‡ºç°ä¸Šé¢é—®é¢˜çš„æ—¶å€™å¯ä»¥å¿«é€Ÿè¿›è¡Œæ¢å¤ã€‚åŒæ—¶ä¹Ÿæä¾›äº†é›†ç¾¤è¿ç§»åŠŸèƒ½ï¼Œå¯ä»¥å°† k8s èµ„æºè¿ç§»åˆ°å…¶ä»– k8s é›†ç¾¤çš„åŠŸèƒ½ã€‚Velero å°†é›†ç¾¤èµ„æºä¿å­˜åœ¨å¯¹è±¡å­˜å‚¨ä¸­ï¼Œé»˜è®¤æƒ…å†µä¸‹å¯ä»¥ä½¿ç”¨ &lt;a href=&#34;https://velero.io/docs/v1.1.0/aws-config&#34; target=&#34;_blank&#34;&gt;AWS&lt;/a&gt;ã€&lt;a href=&#34;https://velero.io/docs/v1.1.0/azure-config&#34; target=&#34;_blank&#34;&gt;Azure&lt;/a&gt;ã€&lt;a href=&#34;https://velero.io/docs/v1.1.0/gcp-config&#34; target=&#34;_blank&#34;&gt;GCP&lt;/a&gt; çš„å¯¹è±¡å­˜å‚¨ï¼ŒåŒæ—¶ä¹Ÿç»™å‡ºäº†æ’ä»¶åŠŸèƒ½ç”¨æ¥æ‹“å±•å…¶ä»–å¹³å°çš„å­˜å‚¨ï¼Œè¿™é‡Œæˆ‘ä»¬ç”¨åˆ°çš„å°±æ˜¯é˜¿é‡Œäº‘çš„å¯¹è±¡å­˜å‚¨ OSSï¼Œé˜¿é‡Œäº‘ä¹Ÿæä¾›äº† Velero çš„æ’ä»¶ï¼Œç”¨äºå°†å¤‡ä»½å­˜å‚¨åˆ° OSS ä¸­ã€‚ä¸‹é¢æˆ‘å°±ä»‹ç»ä¸€ä¸‹å¦‚ä½•åœ¨é˜¿é‡Œäº‘å®¹å™¨æœåŠ¡ ACK ä½¿ç”¨ Velero å®Œæˆå¤‡ä»½å’Œè¿ç§»ã€‚&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;Velero åœ°å€ï¼š&lt;a href=&#34;https://github.com/vmware-tanzu/velero&#34; target=&#34;_blank&#34;&gt;https://github.com/vmware-tanzu/velero&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;ACK æ’ä»¶åœ°å€ï¼š&lt;a href=&#34;https://github.com/AliyunContainerService/velero-plugin&#34; target=&#34;_blank&#34;&gt;https://github.com/AliyunContainerService/velero-plugin&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h3 id=&#34;ä¸‹è½½-velero-å®¢æˆ·ç«¯&#34;&gt;ä¸‹è½½ Velero å®¢æˆ·ç«¯&lt;/h3&gt;

&lt;p&gt;Velero ç”±å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ç»„æˆï¼ŒæœåŠ¡å™¨éƒ¨ç½²åœ¨ç›®æ ‡ k8s é›†ç¾¤ä¸Šï¼Œè€Œå®¢æˆ·ç«¯åˆ™æ˜¯è¿è¡Œåœ¨æœ¬åœ°çš„å‘½ä»¤è¡Œå·¥å…·ã€‚&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;å‰å¾€ &lt;a href=&#34;https://github.com/vmware-tanzu/velero/releases&#34; target=&#34;_blank&#34;&gt;Velero çš„ Release é¡µé¢&lt;/a&gt; ä¸‹è½½å®¢æˆ·ç«¯ï¼Œç›´æ¥åœ¨ GitHub ä¸Šä¸‹è½½å³å¯&lt;/li&gt;
&lt;li&gt;è§£å‹ release åŒ…&lt;/li&gt;
&lt;li&gt;å°† release åŒ…ä¸­çš„äºŒè¿›åˆ¶æ–‡ä»¶ &lt;code&gt;velero&lt;/code&gt; ç§»åŠ¨åˆ° &lt;code&gt;$PATH&lt;/code&gt; ä¸­çš„æŸä¸ªç›®å½•ä¸‹&lt;/li&gt;
&lt;li&gt;æ‰§è¡Œ &lt;code&gt;velero -h&lt;/code&gt; æµ‹è¯•&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&#34;åˆ›å»º-oss-bucket&#34;&gt;åˆ›å»º OSS bucket&lt;/h3&gt;

&lt;p&gt;åˆ›å»ºä¸€ä¸ª OSS bucket ç”¨äºå­˜å‚¨å¤‡ä»½æ–‡ä»¶ï¼Œè¿™é‡Œä¹Ÿå¯ä»¥ç”¨å·²æœ‰çš„ bucketï¼Œä¹‹åä¼šåœ¨ bucket ä¸­åˆ›å»º &lt;code&gt;backups&lt;/code&gt;ã€&lt;code&gt;metadata&lt;/code&gt;ã€&lt;code&gt;restores&lt;/code&gt;ä¸‰ä¸ªç›®å½•ï¼Œè¿™é‡Œå»ºè®®åœ¨å·²æœ‰çš„ bucket ä¸­åˆ›å»ºä¸€ä¸ªå­ç›®å½•ç”¨äºå­˜å‚¨å¤‡ä»½æ–‡ä»¶ã€‚&lt;/p&gt;

&lt;p&gt;åˆ›å»º OSS çš„æ—¶å€™ä¸€å®šè¦é€‰å¯¹åŒºåŸŸï¼Œè¦å’Œ ACK é›†ç¾¤åœ¨åŒä¸€ä¸ªåŒºåŸŸï¼Œå­˜å‚¨ç±»å‹å’Œè¯»å†™æƒé™é€‰æ‹©&lt;strong&gt;æ ‡å‡†å­˜å‚¨&lt;/strong&gt;å’Œ&lt;strong&gt;ç§æœ‰&lt;/strong&gt;ï¼š&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://tva3.sinaimg.cn/wap720/ad5fbf65gy1g8w7t8c4xbj21021d8thq.jpg&#34; alt=&#34;image&#34; /&gt;&lt;/p&gt;

&lt;h3 id=&#34;åˆ›å»ºé˜¿é‡Œäº‘-ram-ç”¨æˆ·&#34;&gt;åˆ›å»ºé˜¿é‡Œäº‘ RAM ç”¨æˆ·&lt;/h3&gt;

&lt;p&gt;è¿™é‡Œéœ€è¦åˆ›å»ºä¸€ä¸ªé˜¿é‡Œäº‘ RAM çš„ç”¨æˆ·ï¼Œç”¨äºæ“ä½œ OSS ä»¥åŠ ACK èµ„æºã€‚&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;p&gt;æ–°å»ºæƒé™ç­–ç•¥&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://tvax4.sinaimg.cn/large/ad5fbf65gy1g8w80cjiv2j21uo18cag8.jpg&#34; alt=&#34;image&#34; /&gt;&lt;/p&gt;

&lt;p&gt;ç­–ç•¥å†…å®¹ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-json&#34;&gt;{
    &amp;quot;Version&amp;quot;: &amp;quot;1&amp;quot;,
    &amp;quot;Statement&amp;quot;: [
        {
            &amp;quot;Action&amp;quot;: [
                &amp;quot;ecs:DescribeSnapshots&amp;quot;,
                &amp;quot;ecs:CreateSnapshot&amp;quot;,
                &amp;quot;ecs:DeleteSnapshot&amp;quot;,
                &amp;quot;ecs:DescribeDisks&amp;quot;,
                &amp;quot;ecs:CreateDisk&amp;quot;,
                &amp;quot;ecs:Addtags&amp;quot;,
                &amp;quot;oss:PutObject&amp;quot;,
                &amp;quot;oss:GetObject&amp;quot;,
                &amp;quot;oss:DeleteObject&amp;quot;,
                &amp;quot;oss:GetBucket&amp;quot;,
                &amp;quot;oss:ListObjects&amp;quot;
            ],
            &amp;quot;Resource&amp;quot;: [
                &amp;quot;*&amp;quot;
            ],
            &amp;quot;Effect&amp;quot;: &amp;quot;Allow&amp;quot;
        }
    ]
}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;æ–°å»ºç”¨æˆ·&lt;/p&gt;

&lt;p&gt;åœ¨æ–°å»ºç”¨æˆ·çš„æ—¶å€™è¦é€‰æ‹© &lt;code&gt;ç¼–ç¨‹è®¿é—®&lt;/code&gt;ï¼Œæ¥è·å– &lt;code&gt;AccessKeyID&lt;/code&gt; å’Œ &lt;code&gt;AccessKeySecret&lt;/code&gt;ï¼Œè¿™é‡Œè¯·åˆ›å»ºä¸€ä¸ªæ–°ç”¨äºç”¨äºå¤‡ä»½ï¼Œä¸è¦ä½¿ç”¨è€ç”¨æˆ·çš„ AK å’Œ ASã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://tvax2.sinaimg.cn/large/ad5fbf65gy1g8w8h4ek4uj21h40ue785.jpg&#34; alt=&#34;image&#34; /&gt;&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&#34;éƒ¨ç½²æœåŠ¡ç«¯&#34;&gt;éƒ¨ç½²æœåŠ¡ç«¯&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;&lt;p&gt;æ‹‰å– &lt;a href=&#34;https://github.com/AliyunContainerService/velero-plugin&#34; target=&#34;_blank&#34;&gt;Velero æ’ä»¶&lt;/a&gt; åˆ°æœ¬åœ°&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;git clone https://github.com/AliyunContainerService/velero-plugin
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;é…ç½®ä¿®æ”¹&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;&lt;p&gt;ä¿®æ”¹ &lt;code&gt;install/credentials-velero&lt;/code&gt; æ–‡ä»¶ï¼Œå°†æ–°å»ºç”¨æˆ·ä¸­è·å¾—çš„ &lt;code&gt;AccessKeyID&lt;/code&gt; å’Œ &lt;code&gt;AccessKeySecret&lt;/code&gt; å¡«å…¥ï¼Œè¿™é‡Œçš„ OSS EndPoint ä¸ºä¹‹å‰ OSS çš„è®¿é—®åŸŸåï¼ˆ&lt;strong&gt;æ³¨ï¼šè¿™é‡Œéœ€è¦é€‰æ‹©å¤–ç½‘è®¿é—®çš„ EndPointã€‚&lt;/strong&gt;ï¼‰ï¼š&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://tvax2.sinaimg.cn/large/ad5fbf65gy1g8w8xd1sgzj21c20cm75z.jpg&#34; alt=&#34;image&#34; /&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;ALIBABA_CLOUD_ACCESS_KEY_ID=&amp;lt;ALIBABA_CLOUD_ACCESS_KEY_ID&amp;gt;
ALIBABA_CLOUD_ACCESS_KEY_SECRET=&amp;lt;ALIBABA_CLOUD_ACCESS_KEY_SECRET&amp;gt;
ALIBABA_CLOUD_OSS_ENDPOINT=&amp;lt;ALIBABA_CLOUD_OSS_ENDPOINT&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;ä¿®æ”¹ &lt;code&gt;install/01-velero.yaml&lt;/code&gt;ï¼Œå°† OSS é…ç½®å¡«å…¥ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-yaml&#34;&gt;---
apiVersion: velero.io/v1
kind: BackupStorageLocation
metadata:
labels:
    component: velero
name: default
namespace: velero
spec:
config: {}
objectStorage:
    bucket: &amp;lt;ALIBABA_CLOUD_OSS_BUCKET&amp;gt;  # OSS bucket åç§°
    prefix: &amp;lt;OSS_PREFIX&amp;gt;    # bucket å­ç›®å½•
provider: alibabacloud
---
apiVersion: velero.io/v1
kind: VolumeSnapshotLocation
metadata:
labels:
    component: velero
name: default
namespace: velero
spec:
config:
    region: &amp;lt;REGION&amp;gt;    # åœ°åŸŸï¼Œå¦‚æœæ˜¯åä¸œ2ï¼ˆä¸Šæµ·ï¼‰ï¼Œåˆ™ä¸º cn-shanghai
provider: alibabacloud
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;k8s éƒ¨ç½² Velero æœåŠ¡&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;# æ–°å»º namespace
kubectl create namespace velero
# éƒ¨ç½² credentials-velero çš„ secret
kubectl create secret generic cloud-credentials --namespace velero --from-file cloud=install/credentials-velero
# éƒ¨ç½² CRD
kubectl apply -f install/00-crds.yaml
# éƒ¨ç½² Velero
kubectl apply -f install/01-velero.yaml
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;æµ‹è¯• Velero çŠ¶æ€&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ velero version
Client:
    Version: v1.1.0
    Git commit: a357f21aec6b39a8244dd23e469cc4519f1fe608
Server:
    Version: v1.1.0
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;å¯ä»¥çœ‹åˆ° Velero çš„å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯å·²ç»éƒ¨ç½²æˆåŠŸã€‚&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;æœåŠ¡ç«¯æ¸…ç†&lt;/p&gt;

&lt;p&gt;åœ¨å®Œæˆæµ‹è¯•æˆ–è€…éœ€è¦é‡æ–°å®‰è£…æ—¶ï¼Œæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤è¿›è¡Œæ¸…ç†ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;kubectl delete namespace/velero clusterrolebinding/velero
kubectl delete crds -l component=velero
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ol&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&#34;å¤‡ä»½æµ‹è¯•&#34;&gt;å¤‡ä»½æµ‹è¯•&lt;/h3&gt;

&lt;p&gt;&lt;code&gt;velero-plugin&lt;/code&gt; é¡¹ç›®ä¸­å·²ç»ç»™å‡º &lt;code&gt;example&lt;/code&gt; ç”¨äºæµ‹è¯•å¤‡ä»½ã€‚&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;p&gt;éƒ¨ç½²æµ‹è¯•æœåŠ¡&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;kubectl apply -f examples/base.yaml
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;å¯¹ &lt;code&gt;nginx-example&lt;/code&gt; æ‰€åœ¨çš„ namespace è¿›è¡Œå¤‡ä»½&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;velero backup create nginx-backup --include-namespaces nginx-example --wait
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;æ¨¡æ‹Ÿ namespace è¢«è¯¯åˆ &lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;kubectl delete namespaces nginx-example
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;ä½¿ç”¨ Velero è¿›è¡Œæ¢å¤&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;velero restore create --from-backup nginx-backup --wait
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&#34;é›†ç¾¤è¿ç§»&#34;&gt;é›†ç¾¤è¿ç§»&lt;/h3&gt;

&lt;p&gt;è¿ç§»æ–¹æ³•åŒå¤‡ä»½ï¼Œåœ¨å¤‡ä»½ååˆ‡æ¢é›†ç¾¤ï¼Œåœ¨æ–°é›†ç¾¤æ¢å¤å¤‡ä»½å³å¯ã€‚&lt;/p&gt;

&lt;h3 id=&#34;é«˜çº§ç”¨æ³•&#34;&gt;é«˜çº§ç”¨æ³•&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;&lt;p&gt;å®šæ—¶å¤‡ä»½&lt;/p&gt;

&lt;p&gt;å¯¹é›†ç¾¤èµ„æºè¿›è¡Œå®šæ—¶å¤‡ä»½ï¼Œåˆ™å¯åœ¨å‘ç”Ÿæ„å¤–çš„æƒ…å†µä¸‹ï¼Œè¿›è¡Œæ¢å¤ï¼ˆé»˜è®¤æƒ…å†µä¸‹ï¼Œå¤‡ä»½ä¿ç•™ 30 å¤©ï¼‰ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;# æ¯æ—¥1ç‚¹è¿›è¡Œå¤‡ä»½
velero create schedule &amp;lt;SCHEDULE NAME&amp;gt; --schedule=&amp;quot;0 1 * * *&amp;quot;
# æ¯æ—¥1ç‚¹è¿›è¡Œå¤‡ä»½ï¼Œå¤‡ä»½ä¿ç•™48å°æ—¶
velero create schedule &amp;lt;SCHEDULE NAME&amp;gt; --schedule=&amp;quot;0 1 * * *&amp;quot; --ttl 48h
# æ¯6å°æ—¶è¿›è¡Œä¸€æ¬¡å¤‡ä»½
velero create schedule &amp;lt;SCHEDULE NAME&amp;gt; --schedule=&amp;quot;@every 6h&amp;quot;
# æ¯æ—¥å¯¹ web namespace è¿›è¡Œä¸€æ¬¡å¤‡ä»½
velero create schedule &amp;lt;SCHEDULE NAME&amp;gt; --schedule=&amp;quot;@every 24h&amp;quot; --include-namespaces web
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;å®šæ—¶å¤‡ä»½çš„åç§°ä¸ºï¼š&lt;code&gt;&amp;lt;SCHEDULE NAME&amp;gt;-&amp;lt;TIMESTAMP&amp;gt;&lt;/code&gt;ï¼Œæ¢å¤å‘½ä»¤ä¸ºï¼š&lt;code&gt;velero restore create --from-backup &amp;lt;SCHEDULE NAME&amp;gt;-&amp;lt;TIMESTAMP&amp;gt;&lt;/code&gt;ã€‚&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;å¤‡ä»½åˆ é™¤&lt;/p&gt;

&lt;p&gt;ç›´æ¥æ‰§è¡Œå‘½ä»¤è¿›è¡Œåˆ é™¤&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;velero delete backups &amp;lt;BACKUP_NAME&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;å¤‡ä»½èµ„æºæŸ¥çœ‹&lt;/p&gt;

&lt;p&gt;å¤‡ä»½æŸ¥çœ‹&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;velero backup get
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;æŸ¥çœ‹å®šæ—¶å¤‡ä»½&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;velero schedule get
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;æŸ¥çœ‹å¯æ¢å¤å¤‡ä»½&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;velero restore get
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;å¤‡ä»½æ’é™¤é¡¹ç›®&lt;/p&gt;

&lt;p&gt;å¯ä¸ºèµ„æºæ·»åŠ æŒ‡å®šæ ‡ç­¾ï¼Œæ·»åŠ æ ‡ç­¾çš„èµ„æºåœ¨å¤‡ä»½çš„æ—¶å€™è¢«æ’é™¤ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;# æ·»åŠ æ ‡ç­¾
kubectl label -n &amp;lt;ITEM_NAMESPACE&amp;gt; &amp;lt;RESOURCE&amp;gt;/&amp;lt;NAME&amp;gt; velero.io/exclude-from-backup=true
# ä¸º default namespace æ·»åŠ æ ‡ç­¾
kubectl label -n default namespace/default velero.io/exclude-from-backup=true
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&#34;é—®é¢˜æ±‡æ€»&#34;&gt;é—®é¢˜æ±‡æ€»&lt;/h3&gt;

&lt;h4 id=&#34;æ—¶åŒºé—®é¢˜&#34;&gt;æ—¶åŒºé—®é¢˜&lt;/h4&gt;

&lt;p&gt;è¿›è¡Œå®šæ—¶å¤‡ä»½æ—¶ï¼Œå‘ç°å¤‡ä»½ä½¿ç”¨çš„äº‹ UTC æ—¶é—´ï¼Œå¹¶ä¸æ˜¯æœ¬åœ°æ—¶é—´ï¼Œç»è¿‡æ’æŸ¥åå‘ç°æ˜¯ &lt;code&gt;velero&lt;/code&gt; é•œåƒçš„æ—¶åŒºé—®é¢˜ï¼Œåœ¨è°ƒæ•´åå°±ä¼šæ­£å¸¸å®šæ—¶å¤‡ä»½äº†ï¼Œè¿™é‡Œæˆ‘é‡æ–°è°ƒæ•´äº†æ—¶åŒºï¼Œç›´æ¥è°ƒæ•´é•œåƒå°±å¥½ï¼Œä¿®æ”¹ &lt;code&gt;install/01-velero.yaml&lt;/code&gt; æ–‡ä»¶ï¼Œå°†é•œåƒæ›¿æ¢ä¸º &lt;code&gt;registry-vpc.cn-shanghai.aliyuncs.com/keking/velero:latest&lt;/code&gt;ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-yaml&#34;&gt;image:
  caption: &amp;quot;Image from: [**Pexels**](https://www.pexels.com)&amp;quot;
  focal_point: &amp;quot;&amp;quot;
  preview_only: false
---
apiVersion: extensions/v1beta1
kind: Deployment
metadata:
  name: velero
  namespace: velero
spec:
  replicas: 1
  selector:
    matchLabels:
      deploy: velero
  template:
    metadata:
      annotations:
        prometheus.io/path: /metrics
        prometheus.io/port: &amp;quot;8085&amp;quot;
        prometheus.io/scrape: &amp;quot;true&amp;quot;
      labels:
        component: velero
        deploy: velero
    spec:
      serviceAccountName: velero
      containers:
      - name: velero
        # sync from gcr.io/heptio-images/velero:latest
        image: registry-vpc.cn-shanghai.aliyuncs.com/keking/velero:latest   # ä¿®å¤æ—¶åŒºåçš„é•œåƒ
        imagePullPolicy: IfNotPresent
        command:
          - /velero
        args:
          - server
          - --default-volume-snapshot-locations=alibabacloud:default
        env:
          - name: VELERO_SCRATCH_DIR
            value: /scratch
          - name: ALIBABA_CLOUD_CREDENTIALS_FILE
            value: /credentials/cloud
        volumeMounts:
          - mountPath: /plugins
            name: plugins
          - mountPath: /scratch
            name: scratch
          - mountPath: /credentials
            name: cloud-credentials
      initContainers:
      - image: registry.cn-hangzhou.aliyuncs.com/acs/velero-plugin-alibabacloud:v1.2
        imagePullPolicy: IfNotPresent
        name: velero-plugin-alibabacloud
        volumeMounts:
        - mountPath: /target
          name: plugins
      volumes:
        - emptyDir: {}
          name: plugins
        - emptyDir: {}
          name: scratch
        - name: cloud-credentials
          secret:
            secretName: cloud-credentials

&lt;/code&gt;&lt;/pre&gt;

&lt;h4 id=&#34;ç‰ˆæœ¬é—®é¢˜&#34;&gt;ç‰ˆæœ¬é—®é¢˜&lt;/h4&gt;

&lt;p&gt;æˆªæ­¢å‘ç¨¿æ—¶ï¼ŒVelero å·²ç»å‘å¸ƒäº† v1.2.0 ç‰ˆæœ¬ï¼Œç›®å‰ ACK çš„ Velero çš„æ’ä»¶è¿˜æœªå‡çº§ã€‚&lt;/p&gt;

&lt;h2 id=&#34;ç»“è¯­&#34;&gt;ç»“è¯­&lt;/h2&gt;

&lt;p&gt;è¿‘æ—¥æ­£å¥½æœ‰ k8s é›†ç¾¤æœåŠ¡è¿ç§»æœåŠ¡çš„éœ€æ±‚ï¼Œä½¿ç”¨ Velero å®Œæˆäº†æœåŠ¡çš„è¿ç§»ï¼ŒåŒæ—¶ä¹Ÿæ¯æ—¥è¿›è¡Œé›†ç¾¤èµ„æºå¤‡ä»½ï¼Œå…¶èƒ½åŠ›å¯ä»¥æ»¡è¶³å®¹å™¨æœåŠ¡çš„ç¾å¤‡å’Œè¿ç§»åœºæ™¯ï¼Œå®æµ‹å¯ç”¨ï¼Œç°å·²è¿è¡Œåœ¨æ‰€æœ‰çš„ k8s é›†ç¾¤ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>ä½¿ç”¨ Grafana å±•ç¤ºé˜¿é‡Œäº‘ç›‘æ§æŒ‡æ ‡</title>
      <link>https://guoxudong.io/en/post/aliyun-cms-grafana/</link>
      <pubDate>Thu, 07 Nov 2019 11:08:36 +0800</pubDate>
      
      <guid>https://guoxudong.io/en/post/aliyun-cms-grafana/</guid>
      <description>

&lt;h2 id=&#34;å‰è¨€&#34;&gt;å‰è¨€&lt;/h2&gt;

&lt;p&gt;å¯¹äºé˜¿é‡Œäº‘ç”¨æˆ·æ¥è¯´ï¼Œé˜¿é‡Œäº‘ç›‘æ§æ˜¯ä¸€ä¸ªå¾ˆä¸é”™çš„äº§å“ï¼Œé¦–å…ˆå®ƒåœ¨é…é¢å†…ä½¿ç”¨æ˜¯å…è´¹çš„ï¼å…è´¹çš„ï¼å…è´¹çš„ï¼é‡è¦çš„äº‹æƒ…è¯´ä¸‰éã€‚ä»–çš„åŠŸèƒ½ç±»ä¼¼äº zabbixï¼Œä½†æ˜¯æ¯” zabbix æä¾›äº†æ›´å¤šçš„ç›‘æ§é¡¹ï¼ŒåŸºæœ¬ä¸Šåœ¨äº‘ä¸Šä½¿ç”¨çš„èµ„æºéƒ½å¯ä»¥é€šè¿‡äº‘ç›‘æ§æ¥å®æ—¶ç›‘æ§ã€‚è€Œå®ƒæä¾›çš„å¼€ç®±å³ç”¨æ–¹å¼ï¼Œå¤©ç„¶é›†æˆäº‘èµ„æºï¼Œå¹¶æä¾›å¤šç§å‘Šè­¦æ–¹å¼ï¼Œå…å»äº†ç›‘æ§ä¸å‘Šè­¦ç³»ç»Ÿæ­å»ºä¸ç»´æŠ¤çš„ç¹çï¼Œå¹¶ä¸”å‡å°‘äº†èµ„æºçš„æ¶ˆè€—ï¼Œæ¯”è´­ä¹° ECS è‡ªå·±æ­å»º zabbix è¦å°‘æ¶ˆè€—å¾ˆå¤šèµ„æºã€‚åŒæ—¶é˜¿é‡Œäº‘ç›‘æ§å’Œé˜¿é‡Œäº‘å…¶ä»–æœåŠ¡ä¸€æ ·ï¼Œä¹Ÿæä¾›äº†æ¯”è¾ƒå®Œæ•´çš„ OpenApi ä»¥åŠå„ç§è¯­è¨€çš„ sdkï¼Œå¯ä»¥åŸºäºé˜¿é‡Œäº‘çš„ OpenApi å°†å…¶ä¸è‡ªå·±çš„ç³»ç»Ÿé›†æˆã€‚æˆ‘ä»¬ä¹‹å‰ä¹Ÿæ˜¯è¿™ä¹ˆåšçš„ï¼Œä½†æ˜¯éšç€ç›‘æ§é¡¹çš„å¢åŠ ï¼Œä»¥åŠç»å¸¸éœ€è¦åœ¨åŠå…¬åœºåœ°ç›‘æ§æŠ•å±çš„ä¸“é¡¹ç›‘æ§é¡µï¼Œå…‰å‡­æˆ‘ä»¬çš„è¿ç»´å¼€å‘å·¥ç¨‹å¸ˆä½¿ç”¨ vue å†™é€Ÿåº¦æ˜æ˜¾è·Ÿä¸ä¸Šï¼Œè€Œä¸”é¡µé¢çš„ç¾è§‚ç¨‹åº¦ä¹Ÿå·®å¾ˆå¤šã€‚&lt;/p&gt;

&lt;h3 id=&#34;æ‰‹å†™å‰ç«¯-vs-grafana&#34;&gt;æ‰‹å†™å‰ç«¯ VS Grafana&lt;/h3&gt;

&lt;p&gt;æ‰‹å†™å‰ç«¯è™½ç„¶å¯å®šåˆ¶åŒ–ç¨‹åº¦æ›´é«˜ï¼Œä½†æ˜¯éœ€è¦æ¶ˆè€—å¤§é‡ç²¾åŠ›è¿›è¡Œè°ƒè¯•ï¼Œå¯¹äºè¿ç»´äººå‘˜ï¼Œå“ªæ€•æ˜¯è¿ç»´å¼€å‘ä¹Ÿæ˜¯åƒä¸æ¶ˆçš„ï¼ˆå‰ç«¯å°å“¥å“¥å’Œå°å§å§æ˜¯ä¸ä¼šæ¥å¸®ä½ çš„ï¼Œä¸‹å›¾å°±æ˜¯æˆ‘å»å¹´æ‹¿ vue å†™çš„ä¼ª Grafana å±•ç¤ºé¡µé¢ï¼ŒèŠ±è´¹äº†å¤§çº¦ä¸€å‘¨æ—¶é—´åœ¨è°ƒæ•´è¿™äº›å‰ç«¯å…ƒç´ ï¼‰ã€‚
&lt;img src=&#34;https://tva4.sinaimg.cn/large/ad5fbf65gy1g8pfrw1licj22ye1gg4qp.jpg&#34; alt=&#34;image&#34; /&gt;&lt;/p&gt;

&lt;p&gt;Grafana åˆ™æ ‡å‡†åŒ–ç¨‹åº¦å¾ˆé«˜ï¼Œå±•ç¤ºä¹Ÿæ›´åŠ ç¬¦åˆå¤§ä¼—å®¡ç¾ï¼ŒæŸäº›å®šåˆ¶åŒ–éœ€æ±‚å¯ä»¥é€šè¿‡è‡ªå®šä¹‰ DataSource æˆ–è€… AJAX æ’ä»¶çš„ iframe æ¨¡å¼å®Œæˆã€‚å¼€å‘åç«¯ DataSource è‚¯å®šå°±æ²¡æœ‰å‰ç«¯è°ƒæ•´ css é‚£ä¹ˆç—›è‹¦å’Œè€—æ—¶äº†ï¼Œæ•´ä½“é…ç½®å¼€å‘ä¸€ä¸ªè¿™æ ·çš„é¡µé¢å¯èƒ½åªæ¶ˆè€—ä¸€äººå¤©å°±èƒ½å®Œæˆã€‚è€Œåœ¨æ–°äº§å“ä¸Šçº¿æ—¶ï¼Œæ„å»ºä¸€ä¸ªä¸“é¡¹ç›‘æ§å±•ç¤ºé¡µé¢é€Ÿåº¦å°±æ›´å¿«äº†ï¼Œå‡ åˆ†é’Ÿå†…å°±èƒ½å®Œæˆã€‚
&lt;img src=&#34;https://tva4.sinaimg.cn/large/ad5fbf65gy1g8pfvp0keej22yc1g2khm.jpg&#34; alt=&#34;image&#34; /&gt;&lt;/p&gt;

&lt;h2 id=&#34;å…³äºé˜¿é‡Œäº‘ç›‘æ§&#34;&gt;å…³äºé˜¿é‡Œäº‘ç›‘æ§&lt;/h2&gt;

&lt;p&gt;äº‘ç›‘æ§ï¼ˆCloudMonitorï¼‰æ˜¯ä¸€é¡¹é’ˆå¯¹é˜¿é‡Œäº‘èµ„æºå’Œäº’è”ç½‘åº”ç”¨è¿›è¡Œç›‘æ§çš„æœåŠ¡ã€‚&lt;/p&gt;

&lt;p&gt;äº‘ç›‘æ§ä¸ºäº‘ä¸Šç”¨æˆ·æä¾›å¼€ç®±å³ç”¨çš„ä¼ä¸šçº§å¼€æ”¾å‹ä¸€ç«™å¼ç›‘æ§è§£å†³æ–¹æ¡ˆã€‚æ¶µç›– IT è®¾æ–½åŸºç¡€ç›‘æ§ï¼Œå¤–ç½‘ç½‘ç»œè´¨é‡æ‹¨æµ‹ç›‘æ§ï¼ŒåŸºäºäº‹ä»¶ã€è‡ªå®šä¹‰æŒ‡æ ‡ã€æ—¥å¿—çš„ä¸šåŠ¡ç›‘æ§ã€‚ä¸ºæ‚¨å…¨æ–¹ä½æä¾›æ›´é«˜æ•ˆã€æ›´å…¨é¢ã€æ›´çœé’±çš„ç›‘æ§æœåŠ¡ã€‚é€šè¿‡æä¾›è·¨äº§å“ã€è·¨åœ°åŸŸçš„åº”ç”¨åˆ†ç»„ç®¡ç†æ¨¡å‹å’ŒæŠ¥è­¦æ¨¡æ¿ï¼Œå¸®åŠ©æ‚¨å¿«é€Ÿæ„å»ºæ”¯æŒå‡ åç§äº‘äº§å“ã€ç®¡ç†æ•°ä¸‡å®ä¾‹çš„é«˜æ•ˆç›‘æ§æŠ¥è­¦ç®¡ç†ä½“ç³»ã€‚é€šè¿‡æä¾› Dashboardï¼Œå¸®åŠ©æ‚¨å¿«é€Ÿæ„å»ºè‡ªå®šä¹‰ä¸šåŠ¡ç›‘æ§å¤§ç›˜ã€‚ä½¿ç”¨äº‘ç›‘æ§ï¼Œä¸ä½†å¯ä»¥å¸®åŠ©æ‚¨æå‡æ‚¨çš„ç³»ç»ŸæœåŠ¡å¯ç”¨æ—¶é•¿ï¼Œè¿˜å¯ä»¥é™ä½ä¼ä¸š IT è¿ç»´ç›‘æ§æˆæœ¬ã€‚&lt;/p&gt;

&lt;p&gt;äº‘ç›‘æ§æœåŠ¡å¯ç”¨äºæ”¶é›†è·å–é˜¿é‡Œäº‘èµ„æºçš„ç›‘æ§æŒ‡æ ‡æˆ–ç”¨æˆ·è‡ªå®šä¹‰çš„ç›‘æ§æŒ‡æ ‡ï¼Œæ¢æµ‹æœåŠ¡å¯ç”¨æ€§ï¼Œä»¥åŠé’ˆå¯¹æŒ‡æ ‡è®¾ç½®è­¦æŠ¥ã€‚ä½¿æ‚¨å…¨é¢äº†è§£é˜¿é‡Œäº‘ä¸Šçš„èµ„æºä½¿ç”¨æƒ…å†µã€ä¸šåŠ¡çš„è¿è¡ŒçŠ¶å†µå’Œå¥åº·åº¦ï¼Œå¹¶åŠæ—¶æ”¶åˆ°å¼‚å¸¸æŠ¥è­¦åšå‡ºååº”ï¼Œä¿è¯åº”ç”¨ç¨‹åºé¡ºç•…è¿è¡Œã€‚&lt;/p&gt;

&lt;h2 id=&#34;å…³äº-grafana&#34;&gt;å…³äº Grafana&lt;/h2&gt;

&lt;p&gt;Grafana æ˜¯ä¸€ä¸ªè·¨å¹³å°çš„å¼€æºçš„åº¦é‡åˆ†æå’Œå¯è§†åŒ–å·¥å…·ï¼Œå¯ä»¥é€šè¿‡å°†é‡‡é›†çš„æ•°æ®æŸ¥è¯¢ç„¶åå¯è§†åŒ–çš„å±•ç¤ºï¼Œå¹¶åŠæ—¶é€šçŸ¥ã€‚ç”±äºäº‘ç›‘æ§çš„ Grafana è¿˜æ²¡æœ‰æ”¯æŒå‘Šè­¦ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿™é‡Œåªç”¨äº† Grafana çš„å¯è§†åŒ–åŠŸèƒ½ï¼Œè€Œå‘Šè­¦æœ¬èº«å°±æ˜¯äº‘ç›‘æ§è‡ªå¸¦çš„ï¼Œæ‰€ä»¥ä¹Ÿä¸éœ€è¦ä¾èµ– Grafana æ¥å®ç°ã€‚è€Œæˆ‘ä»¬çš„ Prometheus ä¹Ÿä½¿ç”¨äº† Grafana è¿›è¡Œæ•°æ®å¯è§†åŒ–ï¼Œæ‰€ä»¥æœ‰ç°æˆçš„ Grafana-Server ä½¿ç”¨ã€‚&lt;/p&gt;

&lt;h2 id=&#34;é˜¿é‡Œäº‘ç›‘æ§å¯¹æ¥-grafana&#34;&gt;é˜¿é‡Œäº‘ç›‘æ§å¯¹æ¥ Grafana&lt;/h2&gt;

&lt;p&gt;é¦–å…ˆ Grafana æœåŠ¡çš„éƒ¨ç½²æ–¹å¼è¿™é‡Œå°±ä¸åšä»‹ç»äº†ï¼Œè¯·ä½¿ç”¨è¾ƒæ–°ç‰ˆæœ¬çš„ Grafanaï¼Œæœ€å¥½æ˜¯ 5.5.0+ã€‚åæ–‡ä¸­ä¹Ÿæœ‰æˆ‘å¼€æºçš„åŸºäºé˜¿é‡Œäº‘äº‘ç›‘æ§çš„ Grafana çš„ helm chartï¼Œå¯ä»¥ä½¿ç”¨ helm å®‰è£…ï¼Œå¹¶ä¼šç›´æ¥å¯¼å…¥äº‘ç›‘æ§çš„æŒ‡æ ‡ï¼Œè¿™ä¸ªä¼šåœ¨åæ–‡ä¸­ä»‹ç»ã€‚&lt;/p&gt;

&lt;h3 id=&#34;å®‰è£…é˜¿é‡Œäº‘ç›‘æ§æ’ä»¶&#34;&gt;å®‰è£…é˜¿é‡Œäº‘ç›‘æ§æ’ä»¶&lt;/h3&gt;

&lt;p&gt;è¿›å…¥æ’ä»¶ç›®å½•è¿›è¡Œå®‰è£…&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;cd /var/lib/grafana/plugins/
git clone https://github.com/aliyun/aliyun-cms-grafana.git 
service grafana-server restart
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;å¦‚æœæ˜¯ä½¿ç”¨ docker æˆ–è€…éƒ¨ç½²åœ¨ k8s é›†ç¾¤ï¼Œè¿™é‡Œä¹Ÿå¯ä»¥ä½¿ç”¨ç¯å¢ƒå˜é‡åœ¨ Grafana éƒ¨ç½²çš„æ—¶å€™è¿›è¡Œå®‰è£…&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-yaml&#34;&gt;...
spec:
  containers:
  - env:
    - name: GF_INSTALL_PLUGINS  # å¤šä¸ªæ’ä»¶è¯·ä½¿ç”¨,éš”å¼€
      value: grafana-simple-json-datasource,https://github.com/aliyun/aliyun-cms-grafana/archive/master.zip;aliyun-cms-grafana
...
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;æ‚¨ä¹Ÿå¯ä»¥ä¸‹è½½ aliyun-cms-grafana.zip æ’ä»¶è§£å‹åï¼Œä¸Šä¼ æœåŠ¡å™¨çš„ Grafana çš„ plugins ç›®å½•ä¸‹ï¼Œé‡å¯ grafana-server å³å¯ã€‚&lt;/p&gt;

&lt;h3 id=&#34;é…ç½®äº‘ç›‘æ§-datasource&#34;&gt;é…ç½®äº‘ç›‘æ§ DataSource&lt;/h3&gt;

&lt;ol&gt;
&lt;li&gt;Grafana å¯åŠ¨åï¼Œè¿›å…¥ &lt;code&gt;Configuration&lt;/code&gt; é¡µé¢ï¼Œé€‰æ‹© &lt;code&gt;DataSource&lt;/code&gt; Tab é¡µï¼Œå•å‡»å³ä¸Šæ–¹çš„&lt;code&gt;Add data source&lt;/code&gt;ï¼Œæ·»åŠ æ•°æ®æºã€‚&lt;/li&gt;
&lt;li&gt;é€‰ä¸­&lt;code&gt;CMS Grafana Service&lt;/code&gt;ï¼Œå•å‡»&lt;code&gt;select&lt;/code&gt;ã€‚
&lt;img src=&#34;https://tvax2.sinaimg.cn/large/ad5fbf65gy1g8ph0ukr0pj21nm0jk76m.jpg&#34; alt=&#34;image&#34; /&gt;&lt;/li&gt;
&lt;li&gt;å¡«å†™é…ç½®é¡¹ï¼ŒURL æ ¹æ®äº‘ç›‘æ§æ‰€åœ¨åœ°åŸŸå¡«å†™ï¼Œå¹¶ä¸”å¡«å†™é˜¿é‡Œäº‘è´¦å·çš„ accessKeyId å’Œ accessSecretï¼Œå®Œæˆåå•å‡»&lt;code&gt;Save&amp;amp;Test&lt;/code&gt;ã€‚
&lt;img src=&#34;https://tvax3.sinaimg.cn/large/ad5fbf65gy1g8ph4bg2bij218m194n9f.jpg&#34; alt=&#34;image&#34; /&gt;&lt;/li&gt;
&lt;/ol&gt;

&lt;h3 id=&#34;åˆ›å»º-dashboard&#34;&gt;åˆ›å»º Dashboard&lt;/h3&gt;

&lt;ol&gt;
&lt;li&gt;å•å‡» &lt;code&gt;Create&lt;/code&gt; -&amp;gt; &lt;code&gt;Dashboard&lt;/code&gt; -&amp;gt; &lt;code&gt;Add Query&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;é…ç½®å›¾æ ‡ï¼Œæ•°æ®æºé€‰æ‹©ä¹‹å‰æ·»åŠ çš„ &lt;code&gt;CMS Grafana Service&lt;/code&gt;ï¼Œç„¶åæ–‡æ¡£ä¸­çš„é…ç½®é¡¹å¡«å…¥æŒ‡æ ‡å³å¯ï¼ˆè¿™é‡Œè¦æ³¨æ„çš„æ˜¯ï¼Œäº‘ç›‘æ§ API ç»™è¿”å›çš„åªæœ‰å®ä¾‹ IDï¼Œå¹¶æ²¡æœ‰è‡ªå®šä¹‰çš„å®ä¾‹åç§°ï¼Œè¿™é‡Œéœ€è¦æ‰‹åŠ¨å°†å…¶å¡«å…¥ &lt;code&gt;Y - column describe&lt;/code&gt; ä¸­ï¼›è€Œä¸”åªæ”¯æŒè¾“å…¥å•ä¸ª Dimensionï¼Œè‹¥è¾“å…¥å¤šä¸ªï¼Œé»˜è®¤é€‰ç¬¬ä¸€ä¸ªï¼Œç”±äºè¿™äº›é—®é¢˜æ‰æœ‰äº†åç»­æˆ‘å¼€å‘çš„ &lt;code&gt;cms-grafana-builder&lt;/code&gt; çš„åŠ¨æœºï¼‰ã€‚
&lt;img src=&#34;https://tva4.sinaimg.cn/large/ad5fbf65gy1g8phck0irbj22ye13in79.jpg&#34; alt=&#34;image&#34; /&gt;&lt;/li&gt;
&lt;li&gt;é…ç½®å‚è€ƒ &lt;a href=&#34;https://help.aliyun.com/document_detail/28619.html&#34; target=&#34;_blank&#34;&gt;äº‘äº§å“ç›‘æ§é¡¹&lt;/a&gt;ï¼Œ
&lt;img src=&#34;https://tva2.sinaimg.cn/large/ad5fbf65gy1g8phg832uvj21a40vo793.jpg&#34; alt=&#34;image&#34; /&gt;&lt;/li&gt;
&lt;/ol&gt;

&lt;h2 id=&#34;ä½¿ç”¨-helm-chart-çš„æ–¹å¼éƒ¨ç½²-grafana&#34;&gt;ä½¿ç”¨ helm chart çš„æ–¹å¼éƒ¨ç½² Grafana&lt;/h2&gt;

&lt;p&gt;é¡¹ç›®åœ°å€ï¼š&lt;a href=&#34;https://github.com/sunny0826/cms-grafana-builder&#34; target=&#34;_blank&#34;&gt;https://github.com/sunny0826/cms-grafana-builder&lt;/a&gt;&lt;/p&gt;

&lt;h3 id=&#34;cms-grafana-builder&#34;&gt;cms-grafana-builder&lt;/h3&gt;

&lt;p&gt;ç”±äºä¸Šæ–‡ä¸­çš„é—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦æ‰‹åŠ¨é€‰æ‹©æ¯ä¸ªå®ä¾‹ ID åˆ° Dimension ä¸­ï¼Œå¹¶ä¸”è¿˜è¦è®²è¯¥å®ä¾‹çš„åç§°é”®å…¥ &lt;code&gt;Y - column describe&lt;/code&gt; ä¸­ï¼Œååˆ†çš„ç¹çï¼Œæ ¹æœ¬ä¸å¯èƒ½å¤§æ‰¹é‡çš„è¾“å…¥ã€‚&lt;/p&gt;

&lt;p&gt;è¿™å°±æ˜¯æˆ‘å¼€å‘è¿™ä¸ª Grafana æŒ‡æ ‡å‚æ•°ç”Ÿæˆå™¨çš„åŸå› ï¼Œèµ·åˆåªæ˜¯ä¸€ä¸ª python è„šæœ¬ï¼Œç”¨æ¥å°†æˆ‘ä»¬è¦ç›‘æ§çš„æŒ‡æ ‡ç»„è£…æˆä¸€ä¸ª Grafana å¯ä»¥ä½¿ç”¨ json æ–‡ä»¶ï¼Œä¹‹åç»“åˆ Grafana çš„å®¹å™¨åŒ–éƒ¨ç½²æ–¹æ³•ï¼Œå°†å…¶åšæˆäº†ä¸€ä¸ª helm chartã€‚å¯ä»¥åœ¨å¯åŠ¨çš„æ—¶å€™è‡ªåŠ¨å°†éœ€è¦çš„å‚æ•°ç”Ÿæˆï¼Œå¹¶ä¸”æ¯æ—¥ä¼šå¯¹æ‰€æœ‰æŒ‡æ ‡è¿›è¡Œæ›´æ–°ï¼Œè¿™æ ·å°±ä¸ç”¨æ¯æ¬¡æ–°è´­æˆ–è€…é‡Šæ”¾æ‰èµ„æºåè¿˜éœ€è¦å†è·‘ä¸€éè„šæœ¬ã€‚&lt;/p&gt;

&lt;h3 id=&#34;éƒ¨ç½²&#34;&gt;éƒ¨ç½²&lt;/h3&gt;

&lt;p&gt;åªéœ€è¦å°†é¡¹ç›®æ‹‰å–ä¸‹æ¥è¿è¡Œ &lt;code&gt;helm install&lt;/code&gt; å‘½ä»¤&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;helm install my-release kk-grafana-cms \
--namespace {your_namespace} \
--set access_key_id={your_access_key_id} \
--set access_secret={your_access_secret} \
--set region_id={your_aliyun_region_id} \
--set password={admin_password}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;æ›´å¤šè¯¦æƒ…è§ &lt;a href=&#34;https://github.com/sunny0826/cms-grafana-builder&#34; target=&#34;_blank&#34;&gt;github README&lt;/a&gt;ï¼Œæ¬¢è¿æ issue äº¤æµã€‚&lt;/p&gt;

&lt;h3 id=&#34;æŒ‡æ ‡é€‰æ‹©&#34;&gt;æŒ‡æ ‡é€‰æ‹©&lt;/h3&gt;

&lt;p&gt;åœ¨éƒ¨ç½²æˆåŠŸåï¼Œå¯ä¿®æ”¹ ConfigMapï¼š&lt;code&gt;grafana-cms-metric&lt;/code&gt;ï¼Œç„¶åä¿®æ”¹å¯¹åº”çš„ç›‘æ§æŒ‡æ ‡é¡¹ã€‚&lt;/p&gt;

&lt;h3 id=&#34;æ•ˆæœ&#34;&gt;æ•ˆæœ&lt;/h3&gt;

&lt;p&gt;ECS:
&lt;img src=&#34;https://tvax1.sinaimg.cn/large/ad5fbf65gy1g8pi9toh3dj21gv0pldyf.jpg&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;

&lt;p&gt;RDS:
&lt;img src=&#34;https://tva2.sinaimg.cn/large/ad5fbf65gy1g8pi9o91ejj21h80q316p.jpg&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;

&lt;p&gt;EIP:
&lt;img src=&#34;https://tva4.sinaimg.cn/large/ad5fbf65gy1g8pi9i9if3j21h70q3aif.jpg&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;

&lt;p&gt;Redis:
&lt;img src=&#34;https://tvax1.sinaimg.cn/large/ad5fbf65gy1g8pi8ss733j21h30pz7b6.jpg&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;

&lt;h2 id=&#34;åè®°&#34;&gt;åè®°&lt;/h2&gt;

&lt;p&gt;ä¸ºäº†æ»¡è¶³å…¬å¸éœ€æ±‚ï¼Œåç»­è¿˜å¼€å‘ DataSource å®šåˆ¶éƒ¨åˆ†ï¼Œç”¨äºå…¬å¸ç›‘æ§å¤§å±çš„å±•ç¤ºï¼Œè¿™éƒ¨åˆ†æ˜¯å¦ä¸€ä¸ªé¡¹ç›®ï¼Œä¸åœ¨è¿™ä¸ªé¡¹ç›®é‡Œï¼Œå°±ä¸ç»†è¯´äº†ï¼Œä¹‹åæœ‰æœºä¼šæ€»ç»“åå†è¿›è¡Œåˆ†äº«ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>è§£å†³ Nginx-Ingress é‡å®šå‘å¤±è´¥é—®é¢˜</title>
      <link>https://guoxudong.io/en/post/nginx-ingress-error/</link>
      <pubDate>Fri, 16 Aug 2019 11:15:37 +0800</pubDate>
      
      <guid>https://guoxudong.io/en/post/nginx-ingress-error/</guid>
      <description>

&lt;h2 id=&#34;å‰è¨€&#34;&gt;å‰è¨€&lt;/h2&gt;

&lt;p&gt;æœ€è¿‘å¯¹å…¬å¸ Kubernetes é›†ç¾¤çš„ &lt;code&gt;nginx-ingress-controller&lt;/code&gt; è¿›è¡Œäº†å‡çº§ï¼Œä½†æ˜¯å‡çº§åå´å‡ºç°äº†å¤§é—®é¢˜ï¼Œä¹‹å‰æ‰€æœ‰é‡‡ç”¨ &lt;code&gt;nginx.ingress.kubernetes.io/rewrite-target: /&lt;/code&gt; æ³¨é‡Šè¿›è¡Œé‡å®šå‘çš„ Ingress è·¯ç”±å…¨éƒ¨å¤±æ•ˆäº†ï¼Œä½†æ˜¯é‚£äº›ç›´æ¥è§£æäº†åŸŸåï¼Œæ²¡æœ‰è¿›è¡Œé‡å®šå‘çš„å´æ²¡æœ‰å‘ç”Ÿè¿™ä¸ªé—®é¢˜ã€‚&lt;/p&gt;

&lt;h2 id=&#34;é—®é¢˜åˆ†æ&#34;&gt;é—®é¢˜åˆ†æ&lt;/h2&gt;

&lt;ol&gt;
&lt;li&gt;é¦–å…ˆæ£€æŸ¥å¯¹åº”æœåŠ¡å¥åº·çŠ¶æ€ï¼Œå‘ç°æ‰€æœ‰å‡ºé—®é¢˜çš„æœåŠ¡çš„çŠ¶æ€å‡æ­£å¸¸ï¼ŒåŒæ—¶å—å½±å“çš„ä¹‹å http è°ƒç”¨ï¼Œè€Œ RPC è°ƒç”¨å´ä¸å—å½±å“ï¼Œè¿™æ—¶é—®é¢˜å°±å®šä½åˆ°äº† ingressã€‚&lt;/li&gt;
&lt;li&gt;ç„¶åæ£€æŸ¥ nginx-ingress-controller ï¼Œå‘ç° nginx-ingress-controller çš„çŠ¶æ€ä¹Ÿæ˜¯æ­£å¸¸çš„ï¼Œè·¯ç”±ä¹Ÿæ˜¯æ­£å¸¸çš„ã€‚&lt;/li&gt;
&lt;li&gt;æœ€åå‘ç°å—å½±å“çš„åªæœ‰æ·»åŠ äº†é‡å®šå‘ç­–ç•¥çš„ ingress ã€‚&lt;/li&gt;
&lt;/ol&gt;

&lt;h2 id=&#34;é—®é¢˜è§£å†³&#34;&gt;é—®é¢˜è§£å†³&lt;/h2&gt;

&lt;p&gt;é—®é¢˜å·²ç»å®šä½ï¼Œæ¥ä¸‹æ¥å°±æ˜¯ç€æ‰‹è§£å†³é—®é¢˜ï¼Œè¿™æ—¶å€™å€¼å¾—æ³¨æ„çš„å°±æ˜¯ä¹‹å‰è¿›è¡Œäº†ä»€ä¹ˆå˜æ›´ï¼šå‡çº§äº† nginx-ingress-controller ç‰ˆæœ¬ï¼çœ‹æ¥é—®é¢˜å°±å‡ºç°åœ¨æ–°ç‰ˆæœ¬ä¸Šï¼Œé‚£ä¹ˆå°±æ‰“å¼€å®˜æ–¹æ–‡æ¡£ï¼š&lt;a href=&#34;https://kubernetes.github.io/ingress-nginx/examples/rewrite/&#34; target=&#34;_blank&#34;&gt;https://kubernetes.github.io/ingress-nginx/examples/rewrite/&lt;/a&gt; çœ‹ä¸€ä¸‹å§ã€‚&lt;/p&gt;

&lt;h3 id=&#34;attention&#34;&gt;Attention&lt;/h3&gt;

&lt;blockquote&gt;
&lt;p&gt;Starting in Version 0.22.0, ingress definitions using the annotation &lt;code&gt;nginx.ingress.kubernetes.io/rewrite-target&lt;/code&gt; are not backwards compatible with previous versions. In Version 0.22.0 and beyond, any substrings within the request URI that need to be passed to the rewritten path must explicitly be defined in a &lt;a href=&#34;https://www.regular-expressions.info/refcapture.html&#34; target=&#34;_blank&#34;&gt;capture group&lt;/a&gt;.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;æ–‡æ¡£ä¸Šç»™å‡ºäº†éå¸¸æ˜æ˜¾çš„è­¦å‘Šâš ï¸ï¼šä» V0.22.0 ç‰ˆæœ¬å¼€å§‹å°†ä¸å†å…¼å®¹ä¹‹å‰çš„å…¥å£å®šä¹‰ï¼Œå†æŸ¥çœ‹ä¸€ä¸‹æˆ‘çš„ nginx-ingress-controller ç‰ˆæœ¬ï¼Œæœç„¶é—®é¢˜å‡ºç°æ¥è¿™é‡Œã€‚&lt;/p&gt;

&lt;h3 id=&#34;note&#34;&gt;Note&lt;/h3&gt;

&lt;blockquote&gt;
&lt;p&gt;&lt;a href=&#34;https://www.regular-expressions.info/refcapture.html&#34; target=&#34;_blank&#34;&gt;Captured groups&lt;/a&gt; are saved in numbered placeholders, chronologically, in the form &lt;code&gt;$1&lt;/code&gt;, &lt;code&gt;$2&lt;/code&gt; &amp;hellip; &lt;code&gt;$n&lt;/code&gt;. These placeholders can be used as parameters in the &lt;code&gt;rewrite-target&lt;/code&gt; annotation.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h3 id=&#34;ç¤ºä¾‹&#34;&gt;ç¤ºä¾‹&lt;/h3&gt;

&lt;p&gt;åˆ°è¿™é‡Œé—®é¢˜å·²ç»è§£å†³äº†ï¼Œåœ¨æ›´æ–°äº† ingress çš„é…ç½®ä¹‹åï¼Œä¹‹å‰æ‰€æœ‰æ— æ³•é‡å®šå‘çš„æœåŠ¡ç°åœ¨éƒ½å·²ç»å¯ä»¥æ­£å¸¸è®¿é—®äº†ã€‚ä¿®æ”¹è§å¦‚ä¸‹ç¤ºä¾‹ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ echo &#39;
apiVersion: extensions/v1beta1
kind: Ingress
metadata:
  annotations:
    nginx.ingress.kubernetes.io/rewrite-target: /$2
  name: rewrite
  namespace: default
spec:
  rules:
  - host: rewrite.bar.com
    http:
      paths:
      - backend:
          serviceName: http-svc
          servicePort: 80
        path: /something(/|$)(.*)
&#39; | kubectl create -f -
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;ç»“è¯­&#34;&gt;ç»“è¯­&lt;/h2&gt;

&lt;p&gt;è§£å†³è¿™ä¸ªé—®é¢˜çš„å®é™…æ—¶é—´è™½ç„¶ä¸é•¿ï¼Œä½†æ˜¯ç€å®è®©äººå‡ºäº†ä¸€èº«å†·æ±—ï¼ŒåŒæ—¶ä¹Ÿç»™äº†æˆ‘è­¦ç¤ºï¼šå˜æ›´æœ‰é£é™©ï¼Œå‡çº§éœ€è°¨æ…ã€‚åœ¨å‡çº§ä¹‹å‰éœ€è¦å…ˆæµè§ˆæ–°ç‰ˆæœ¬çš„å‡çº§ä¿¡æ¯ï¼ŒåŒæ—¶éœ€è¦åˆ¶å®šå®Œå–„çš„å›æ»šç­–ç•¥ï¼Œç¡®ä¿ä¸‡æ— ä¸€å¤±ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>å¦‚ä½•æ„å»ºæ··åˆKuberneteså¹³å°</title>
      <link>https://guoxudong.io/en/post/how-we-built-our-hybrid-kubernetes-platfor/</link>
      <pubDate>Tue, 06 Aug 2019 14:01:30 +0800</pubDate>
      
      <guid>https://guoxudong.io/en/post/how-we-built-our-hybrid-kubernetes-platfor/</guid>
      <description>

&lt;blockquote&gt;
&lt;p&gt;éšç€3å¹´å‰é‡æ„ &lt;a href=&#34;https://www.dailymotion.com/&#34; target=&#34;_blank&#34;&gt;Dailymotion&lt;/a&gt; æ ¸å¿ƒAPIçš„å†³å®šï¼Œæˆ‘ä»¬å¸Œæœ›æä¾›ä¸€ç§æ›´æœ‰æ•ˆçš„æ–¹å¼æ¥æ‰˜ç®¡åº”ç”¨ç¨‹åºï¼Œ&lt;a href=&#34;https://medium.com/dailymotion/deploying-apps-on-multiple-kubernetes-clusters-with-helm-19ee2b06179e&#34; target=&#34;_blank&#34;&gt;ä¿ƒè¿›æˆ‘ä»¬çš„å¼€å‘å’Œç”Ÿäº§å·¥ä½œæµç¨‹&lt;/a&gt;ã€‚ æœ€ç»ˆå†³å®šä½¿ç”¨å®¹å™¨ç¼–æ’å¹³å°æ¥å®ç°è¿™ä¸€ç›®æ ‡ï¼Œé‚£ä¹ˆè‡ªç„¶å°±é€‰æ‹©äº† Kubernetesã€‚&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;é‚£ä¹ˆä¸ºä»€ä¹ˆè¦å»ºç«‹è‡ªå·±çš„Kuberneteså¹³å°ï¼Ÿ&lt;/p&gt;

&lt;h2 id=&#34;å€Ÿç”±-google-cloud-å¿«é€Ÿæ¨åŠ¨çš„-api-æŠ•å…¥ç”Ÿäº§&#34;&gt;å€Ÿç”± Google Cloud å¿«é€Ÿæ¨åŠ¨çš„ API æŠ•å…¥ç”Ÿäº§&lt;/h2&gt;

&lt;blockquote&gt;
&lt;p&gt;2016å¹´å¤&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;ä¸‰å¹´å‰ï¼Œåœ¨ &lt;a href=&#34;https://www.vivendi.com/&#34; target=&#34;_blank&#34;&gt;Vivendi&lt;/a&gt; æ”¶è´­ Dailymotion ä¹‹åï¼Œæ‰€æœ‰å¼€å‘å›¢é˜Ÿéƒ½ä¸“æ³¨äºä¸€ä¸ªç›®æ ‡ï¼šæä¾›å…¨æ–°çš„ Dailymotion äº§å“ã€‚&lt;/p&gt;

&lt;p&gt;æ ¹æ®å¯¹å®¹å™¨ã€ç¼–æ’è§£å†³æ–¹æ¡ˆå’Œä»¥å‰çš„ç»éªŒçš„åˆ†æï¼Œä½¿æˆ‘ä»¬ç¡®ä¿¡ Kubernetes æ˜¯æ­£ç¡®çš„é€‰æ‹©ã€‚è®¸å¤šå¼€å‘äººå‘˜å·²ç»æŒæ¡äº†è¿™ä¸€æ¦‚å¿µå¹¶çŸ¥é“å¦‚ä½•ä½¿ç”¨ Kubernetes ï¼Œè¿™å¯¹æˆ‘ä»¬çš„åŸºç¡€è®¾æ–½è½¬å‹æ¥è¯´æ˜¯ä¸€ä¸ªå·¨å¤§çš„ä¼˜åŠ¿ã€‚åœ¨åŸºç¡€æ¶æ„æ–¹é¢ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªå¼ºå¤§è€Œçµæ´»çš„å¹³å°æ¥æ‰˜ç®¡è¿™äº›æ–°å‹çš„äº‘åŸç”Ÿåº”ç”¨ç¨‹åºã€‚è€Œå…¬æœ‰äº‘ä¸ºæˆ‘ä»¬æä¾›äº†æå¤§çš„ä¾¿åˆ©ï¼Œäºæ˜¯æˆ‘ä»¬å†³å®šåœ¨ Google Kubernetes Engine ä¸Šéƒ¨ç½²æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºï¼Œå³ä½¿ä¹‹åæˆ‘ä»¬ä¹Ÿä¼šåœ¨è‡ªå·±çš„æ•°æ®ä¸­å¿ƒä¸­è¿›è¡Œæ··åˆéƒ¨ç½²ã€‚&lt;/p&gt;

&lt;h3 id=&#34;ä¸ºä½•é€‰æ‹©-gke&#34;&gt;ä¸ºä½•é€‰æ‹© GKE ï¼Ÿ&lt;/h3&gt;

&lt;p&gt;æˆ‘ä»¬åšå‡ºè¿™ä¸ªé€‰æ‹©ä¸»è¦æ˜¯å‡ºäºæŠ€æœ¯åŸå› ï¼Œä½†ä¹Ÿå› ä¸ºæˆ‘ä»¬éœ€è¦å¿«é€Ÿæä¾›åŸºç¡€è®¾æ–½æ¥æ»¡è¶³ Dailymotion çš„ä¸šåŠ¡éœ€æ±‚ã€‚å¹¶ä¸”å¯¹æ‰˜ç®¡çš„åº”ç”¨ç¨‹åºï¼ˆå¦‚åœ°ç†åˆ†å¸ƒï¼Œå¯ä¼¸ç¼©æ€§å’Œå¼¹æ€§ï¼‰æœ‰ä¸€äº›è¦æ±‚ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://ws2.sinaimg.cn/large/ad5fbf65gy1g5py1vm2k2j20hd0bbjtq.jpg&#34; alt=&#34;&#34; /&gt;
&lt;center&gt;Dailymotion çš„ GKE é›†ç¾¤&lt;/center&gt;&lt;/p&gt;

&lt;p&gt;Dailymotion ä½œä¸ºä¸€ä¸ªå…¨çƒæ€§çš„è§†é¢‘å¹³å°ï¼Œéœ€è¦é€šè¿‡å‡å°‘å»¶è¿Ÿæ¥æ”¹å–„ç”¨æˆ·ä½“éªŒã€‚ä¹‹å‰æˆ‘ä»¬ä»…åœ¨å·´é»æä¾› &lt;a href=&#34;https://developer.dailymotion.com/&#34; target=&#34;_blank&#34;&gt;API&lt;/a&gt; ï¼Œä½†è¿™æ ·å¹¶éæœ€ä½³ï¼Œæˆ‘ä»¬å¸Œæœ›èƒ½å¤Ÿåœ¨æ¬§æ´²ã€äºšæ´²ä»¥åŠç¾å›½æ‰˜ç®¡æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºã€‚&lt;/p&gt;

&lt;p&gt;è¿™ç§å»¶è¿Ÿé™åˆ¶æ„å‘³ç€æˆ‘ä»¬åœ¨å¹³å°çš„ç½‘ç»œè®¾è®¡æ–¹é¢é¢ä¸´ç€å·¨å¤§çš„æŒ‘æˆ˜ã€‚å¤§å¤šæ•°äº‘ä¾›åº”å•†è¦æ±‚æˆ‘ä»¬åœ¨æ¯ä¸ªåœ°åŒºåˆ›å»ºä¸€ä¸ªç½‘ç»œï¼Œå¹¶å°†æ‰€æœ‰è¿™äº›ç½‘ç»œé€šè¿‡ VPN ä¸æ‰˜ç®¡æœåŠ¡äº’è¿ï¼Œä½† Google Cloud å…è®¸æˆ‘ä»¬åœ¨æ‰€æœ‰ Google åœ°åŒºåˆ›å»ºä¸€ä¸ªå®Œå…¨è·¯ç”±çš„å•ä¸€ç½‘ç»œï¼Œè¯¥ç½‘ç»œåœ¨è¿è¥æ–¹é¢æä¾›äº†ä¾¿åˆ©å¹¶æé«˜äº†æ•ˆç‡ã€‚&lt;/p&gt;

&lt;p&gt;æ­¤å¤–ï¼ŒGoogle Cloud çš„ç½‘ç»œå’Œè´Ÿè½½å‡è¡¡æœåŠ¡éå¸¸æ£’ã€‚å®ƒå¯ä»¥å°†æˆ‘ä»¬çš„ç”¨æˆ·è·¯ç”±åˆ°æœ€è¿‘çš„é›†ç¾¤ï¼Œå¹¶ä¸”åœ¨å‘ç”Ÿæ•…éšœçš„æƒ…å†µä¸‹ï¼Œæµé‡ä¼šè‡ªåŠ¨è·¯ç”±åˆ°å¦ä¸€ä¸ªåŒºåŸŸè€Œæ— éœ€ä»»ä½•äººä¸ºå¹²é¢„ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://wx4.sinaimg.cn/large/ad5fbf65gy1g5pytelbwnj20jg0avq4x.jpg&#34; alt=&#34;&#34; /&gt;
&lt;center&gt;Google è´Ÿè½½å‡è¡¡ç›‘æ§&lt;/center&gt;&lt;/p&gt;

&lt;p&gt;æˆ‘ä»¬çš„å¹³å°åŒæ ·éœ€è¦ä½¿ç”¨ GPUï¼Œè€Œ Google Cloud å…è®¸æˆ‘ä»¬ä»¥éå¸¸æœ‰æ•ˆçš„æ–¹å¼ç›´æ¥åœ¨æˆ‘ä»¬çš„ Kubernetes é›†ç¾¤ä¸­ä½¿ç”¨å®ƒä»¬ã€‚&lt;/p&gt;

&lt;p&gt;æ‰€æœ‰è¿™ä¸€åˆ‡ä½¿æˆ‘ä»¬åœ¨å¯åŠ¨å6ä¸ªæœˆå¼€å§‹æ¥å…¥ Google Cloud åŸºç¡€æ¶æ„ä¸Šçš„ç”Ÿäº§æµé‡ã€‚&lt;/p&gt;

&lt;p&gt;ä½†æ˜¯ï¼Œå°½ç®¡å…·æœ‰æ•´ä½“ä¼˜åŠ¿ï¼Œä½†ä½¿ç”¨å…±æœ‰äº‘æœåŠ¡è¿˜æ˜¯è¦èŠ±è´¹ä¸å°‘æˆæœ¬ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬è¦è¯„ä¼°é‡‡å–çš„æ¯é¡¹æ‰˜ç®¡æœåŠ¡ï¼Œä»¥ä¾¿å°†æ¥å°†å…¶å†…éƒ¨åŒ–ã€‚äº‹å®ä¸Šï¼Œæˆ‘ä»¬åœ¨2016å¹´åº•å¼€å§‹æ„å»ºæˆ‘ä»¬çš„æœ¬åœ°é›†ç¾¤ï¼Œå¹¶å¯åŠ¨äº†æˆ‘ä»¬çš„æ··åˆç­–ç•¥ã€‚&lt;/p&gt;

&lt;h2 id=&#34;åœ¨-dailymotion-çš„å†…éƒ¨æ„å»ºå®¹å™¨ç¼–æ’å¹³å°&#34;&gt;åœ¨ Dailymotion çš„å†…éƒ¨æ„å»ºå®¹å™¨ç¼–æ’å¹³å°&lt;/h2&gt;

&lt;blockquote&gt;
&lt;p&gt;2016å¹´ç§‹&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;çœ‹åˆ°æ•´ä¸ªæŠ€æœ¯æ ˆå·²ç»å‡†å¤‡å¥½åœ¨ç”Ÿäº§ç¯å¢ƒä¸­åº”ç”¨ï¼Œä½†&lt;a href=&#34;https://tartiflette.io/&#34; target=&#34;_blank&#34;&gt;APIä»åœ¨å¼€å‘ä¸­&lt;/a&gt;ï¼Œè¿™ä½¿å¾—æˆ‘ä»¬æœ‰æ—¶é—´ä¸“æ³¨æ­å»ºæˆ‘ä»¬çš„æœ¬åœ°é›†ç¾¤ã€‚&lt;/p&gt;

&lt;p&gt;Dailymotion å¤šå¹´æ¥åœ¨å…¨çƒæ‹¥æœ‰è‡ªå·±çš„å†…å®¹åˆ†å‘ç½‘ç»œï¼Œæ¯æœˆæœ‰è¶…è¿‡30äº¿çš„è§†é¢‘æ’­æ”¾é‡ã€‚æ˜¾ç„¶ï¼Œæˆ‘ä»¬å¸Œæœ›åˆ©ç”¨ç°æœ‰çš„ä¼˜åŠ¿å¹¶åœ¨æˆ‘ä»¬ç°æœ‰çš„æ•°æ®ä¸­å¿ƒéƒ¨ç½²è‡ªå·±çš„ Kubernetes é›†ç¾¤ã€‚&lt;/p&gt;

&lt;p&gt;æˆ‘çš„ç›®å‰æ‹¥æœ‰6ä¸ªæ•°æ®ä¸­å¿ƒçš„2500å¤šå°æœåŠ¡å™¨ã€‚æ‰€æœ‰è¿™äº›éƒ½ä½¿ç”¨ Saltstack è¿›è¡Œé…ç½®ï¼Œæˆ‘ä»¬å¼€å§‹å‡†å¤‡æ‰€æœ‰éœ€è¦çš„å…¬å¼æ¥åˆ›å»ºä¸»èŠ‚ç‚¹ã€å·¥ä½œèŠ‚ç‚¹ä»¥åŠ Etcd é›†ç¾¤ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://wx2.sinaimg.cn/large/ad5fbf65gy1g5pzm4m985j20jg06tgm7.jpg&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;

&lt;h3 id=&#34;ç½‘ç»œéƒ¨åˆ†&#34;&gt;ç½‘ç»œéƒ¨åˆ†&lt;/h3&gt;

&lt;p&gt;æˆ‘ä»¬çš„ç½‘ç»œæ˜¯ä¸€ä¸ªå®Œå…¨è·¯ç”±çš„ç½‘ç»œã€‚æ¯ä¸ªæœåŠ¡å™¨ä½¿ç”¨Exabgpé€šè¿‡ç½‘ç»œå¹¿æ’­è‡ªå·±çš„IPã€‚æˆ‘ä»¬æ¯”è¾ƒäº†å‡ ä¸ªç½‘ç»œæ’ä»¶ï¼Œ &lt;a href=&#34;https://www.projectcalico.org/&#34; target=&#34;_blank&#34;&gt;Calico&lt;/a&gt; ä½¿ç”¨çš„æ˜¯ä¸‰å±‚ç½‘ç»œï¼Œå› æ­¤è¿™æ˜¯å”¯ä¸€æ»¡è¶³æˆ‘ä»¬éœ€æ±‚çš„ç½‘ç»œæ’ä»¶ã€‚&lt;/p&gt;

&lt;p&gt;ç”±äºæˆ‘ä»¬æƒ³è¦é‡ç”¨åŸºç¡€æ¶æ„ä¸­çš„æ‰€æœ‰ç°æœ‰å·¥å…·ï¼Œé¦–å…ˆè¦è§£å†³çš„é—®é¢˜æ˜¯æ’å…¥ä¸€ä¸ªè‡ªåˆ¶ç½‘ç»œå·¥å…·ï¼ˆæˆ‘ä»¬æ‰€æœ‰æœåŠ¡å™¨éƒ½ä½¿ç”¨å®ƒï¼‰ï¼Œé€šè¿‡æˆ‘ä»¬çš„ Kubernetes èŠ‚ç‚¹é€šè¿‡ç½‘ç»œå¹¿æ’­ IP èŒƒå›´ã€‚æˆ‘ä»¬è®© Calico ä¸º pod åˆ†é… IPï¼Œä½†ä¸ä½¿ç”¨å®ƒä¸æˆ‘ä»¬çš„ç½‘ç»œè®¾å¤‡è¿›è¡ŒBGPä¼šè¯ã€‚è·¯ç”±å®é™…ä¸Šæ˜¯ç”±Exabgpå¤„ç†çš„ï¼Œå®ƒå®£å¸ƒäº†Calicoä½¿ç”¨çš„å­ç½‘ã€‚è¿™ä½¿æˆ‘ä»¬å¯ä»¥ä»å†…éƒ¨ç½‘ç»œè®¿é—®ä»»ä½•podï¼Œå°¤å…¶æ˜¯æ¥è‡ªæˆ‘ä»¬çš„è´Ÿè½½å‡è¡¡å™¨ã€‚&lt;/p&gt;

&lt;h3 id=&#34;æˆ‘ä»¬å¦‚ä½•ç®¡ç†å…¥å£æµé‡&#34;&gt;æˆ‘ä»¬å¦‚ä½•ç®¡ç†å…¥å£æµé‡&lt;/h3&gt;

&lt;p&gt;ä¸ºäº†å°†ä¼ å…¥çš„è¯·æ±‚è·¯ç”±åˆ°æ­£ç¡®çš„æœåŠ¡ï¼Œæˆ‘ä»¬å¸Œæœ›ä½¿ç”¨ Ingress Controllers ä¸ Kubernetes çš„å…¥å£èµ„æºé›†æˆã€‚&lt;/p&gt;

&lt;p&gt;3å¹´å‰ï¼Œnginx-ingress-controller æ˜¯æœ€æˆç†Ÿçš„æ§åˆ¶å™¨ ï¼Œå¹¶ä¸” Nginx å·²ç»ä½¿ç”¨å¤šå¹´ï¼Œå¹¶ä»¥å…¶ç¨³å®šæ€§å’Œæ€§èƒ½è€Œé—»åã€‚&lt;/p&gt;

&lt;p&gt;åœ¨æˆ‘ä»¬çš„è®¾è®¡ä¸­ï¼Œæˆ‘ä»¬å†³å®šåœ¨ä¸“ç”¨çš„ 10Gbps åˆ€ç‰‡æœåŠ¡å™¨ä¸Šæ‰˜ç®¡æˆ‘ä»¬çš„æ§åˆ¶å™¨ã€‚æ¯ä¸ªæ§åˆ¶å™¨éƒ½æ’å…¥å…¶æ‰€å±é›†ç¾¤çš„ kube-apiserver ç«¯ç‚¹ã€‚åœ¨è¿™äº›æœåŠ¡å™¨ä¸Šï¼Œæˆ‘ä»¬è¿˜ä½¿ç”¨Exabgpæ¥å¹¿æ’­å…¬å…±æˆ–ç§æœ‰IPã€‚æˆ‘ä»¬çš„ç½‘ç»œæ‹“æ‰‘å…è®¸æˆ‘ä»¬ä½¿ç”¨æ¥è‡ªè¿™äº›æ§åˆ¶å™¨çš„BGPå°†æ‰€æœ‰æµé‡ç›´æ¥è·¯ç”±åˆ°æˆ‘ä»¬çš„podï¼Œè€Œæ— éœ€ä½¿ç”¨NodePortæœåŠ¡ç±»å‹ã€‚è¿™æ ·å¯ä»¥é¿å…èŠ‚ç‚¹ä¹‹é—´çš„æ°´å¹³æµé‡ï¼Œä»è€Œæé«˜æ•ˆç‡ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://ws3.sinaimg.cn/large/ad5fbf65gy1g5q05ex27bj20in0fbt9q.jpg&#34; alt=&#34;&#34; /&gt;
&lt;center&gt;ä» Internet åˆ° pods çš„æµé‡&lt;/center&gt;&lt;/p&gt;

&lt;p&gt;ç°åœ¨æˆ‘ä»¬å·²ç»çœ‹åˆ°äº†æˆ‘ä»¬å¦‚ä½•æ„å»ºæ··åˆå¹³å°ï¼Œæˆ‘ä»¬å¯ä»¥æ·±å…¥äº†è§£æµé‡è¿ç§»æœ¬èº«ã€‚&lt;/p&gt;

&lt;h2 id=&#34;å°†æµé‡ä»-google-cloud-è¿ç§»åˆ°-dailymotions-åŸºç¡€æ¶æ„&#34;&gt;å°†æµé‡ä» Google Cloud è¿ç§»åˆ° Dailymotions åŸºç¡€æ¶æ„&lt;/h2&gt;

&lt;blockquote&gt;
&lt;p&gt;2018å¹´ç§‹&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;ç»è¿‡è¿‘2å¹´çš„æ„å»ºã€æµ‹è¯•å’Œå¾®è°ƒï¼Œæˆ‘ä»¬å‘ç°è‡ªå·±æ‹¥æœ‰å®Œæ•´çš„ Kubernetes æŠ€æœ¯æ ˆï¼Œå¯ä»¥æ¥æ”¶éƒ¨åˆ†æµé‡ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://wx2.sinaimg.cn/large/ad5fbf65gy1g5q0b3o8laj20jg06sq36.jpg&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;

&lt;p&gt;ç›®å‰ï¼Œæˆ‘ä»¬çš„è·¯ç”±ç­–ç•¥éå¸¸ç®€å•ï¼Œä½†è¶³ä»¥è§£å†³æˆ‘ä»¬çš„é—®é¢˜ã€‚é™¤äº†æˆ‘ä»¬çš„å…¬å…±IPï¼ˆGoogle Cloudå’ŒDailymotionï¼‰ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜ä½¿ç”¨AWS Route 53 æ¥å®šä¹‰ç­–ç•¥å¹¶å°†ç»ˆç«¯ç”¨æˆ·æµé‡å¼•å…¥æˆ‘ä»¬é€‰æ‹©çš„é›†ç¾¤ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://ws2.sinaimg.cn/large/ad5fbf65gy1g5q0ds3spjj20jg07a0tk.jpg&#34; alt=&#34;&#34; /&gt;
&lt;center&gt;ä½¿ç”¨Route 53çš„è·¯ç”±ç­–ç•¥ç¤ºä¾‹&lt;/center&gt;&lt;/p&gt;

&lt;p&gt;åœ¨ Google Cloud ä¸Šå¾ˆç®€å•ï¼Œå› ä¸ºæˆ‘ä»¬ä¸ºæ‰€æœ‰ç¾¤é›†ä½¿ç”¨å”¯ä¸€çš„IPï¼Œå¹¶ä¸”ç”¨æˆ·è¢«è·¯ç”±åˆ°ä»–æœ€è¿‘çš„ GKE ç¾¤é›†ã€‚å¯¹äºæˆ‘ä»¬æ¥è¯´ï¼Œæˆ‘ä»¬ä¸ä½¿ç”¨ç›¸åŒçš„æŠ€æœ¯ï¼Œå› æ­¤æˆ‘ä»¬æ¯ä¸ªç¾¤é›†éƒ½æœ‰ä¸åŒçš„IPã€‚&lt;/p&gt;

&lt;p&gt;åœ¨æ­¤æ¬¡è¿ç§»è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†ç›®æ ‡å›½å®¶é€æ­¥çº³å…¥æˆ‘ä»¬çš„é›†ç¾¤å¹¶åˆ†æå…¶æ”¶ç›Šã€‚&lt;/p&gt;

&lt;p&gt;ç”±äºæˆ‘ä»¬çš„GKEé›†ç¾¤é…ç½®äº†è‡ªåŠ¨è°ƒèŠ‚è‡ªå®šä¹‰æŒ‡æ ‡ï¼Œå› æ­¤å®ƒä»¬ä¼šæ ¹æ®ä¼ å…¥æµé‡è¿›è¡Œæ‰©å±•/ç¼©å°ã€‚&lt;/p&gt;

&lt;p&gt;åœ¨æ­£å¸¸æ¨¡å¼ä¸‹ï¼ŒåŒºåŸŸçš„æ‰€æœ‰æµé‡éƒ½è·¯ç”±åˆ°æˆ‘ä»¬çš„å†…éƒ¨éƒ¨ç½²é›†ç¾¤ï¼Œè€ŒGKEé›†ç¾¤åˆ™ä½¿ç”¨Route 53æä¾›çš„è¿è¡ŒçŠ¶å†µæ£€æŸ¥ä½œä¸ºæ•…éšœè½¬ç§»ã€‚&lt;/p&gt;

&lt;h2 id=&#34;ç»“è¯­&#34;&gt;ç»“è¯­&lt;/h2&gt;

&lt;p&gt;æˆ‘ä»¬æ¥ä¸‹æ¥çš„æ­¥éª¤æ˜¯å®Œå…¨è‡ªåŠ¨åŒ–æˆ‘ä»¬çš„è·¯ç”±ç­–ç•¥ï¼Œä»¥å®ç°è‡ªåŠ¨æ··åˆç­–ç•¥ï¼Œä¸æ–­å¢å¼ºæˆ‘ä»¬çš„ç”¨æˆ·ä½“éªŒã€‚åœ¨æ•ˆç›Šæ–¹é¢ï¼Œæˆ‘ä»¬å¤§å¤§é™ä½äº†äº‘çš„æˆæœ¬ï¼Œç”šè‡³æ”¹å–„äº†APIå“åº”æ—¶é—´ã€‚æˆ‘ä»¬ç›¸ä¿¡æˆ‘ä»¬çš„äº‘å¹³å°è¶³ä»¥åœ¨éœ€è¦æ—¶å¤„ç†æ›´å¤šæµé‡ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>ä½¿ç”¨ Helm åœ¨å¤šé›†ç¾¤éƒ¨ç½²åº”ç”¨</title>
      <link>https://guoxudong.io/en/post/deploying-apps-on-multiple-kubernetes-clusters-with-hel/</link>
      <pubDate>Sun, 14 Jul 2019 14:16:56 +0800</pubDate>
      
      <guid>https://guoxudong.io/en/post/deploying-apps-on-multiple-kubernetes-clusters-with-hel/</guid>
      <description>

&lt;blockquote&gt;
&lt;p&gt;&lt;a href=&#34;https://www.dailymotion.com/&#34; target=&#34;_blank&#34;&gt;Dailymotion&lt;/a&gt; åœ¨ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ Kubernetes å·²ç»3å¹´äº†ï¼Œä½†æ˜¯ä¹Ÿé¢ä¸´ç€å¤šé›†ç¾¤éƒ¨ç½²åº”ç”¨çš„æŒ‘æˆ˜ï¼Œè¿™ä¹Ÿæ˜¯åœ¨è¿‡å»çš„å‡ å¹´ä¸­æˆ‘ä¸€ç›´åŠªåŠ›ä¼˜åŒ–å·¥å…·å’Œæ”¹è¿›å·¥ä½œæµçš„åŸå› ã€‚&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h2 id=&#34;å‰è¨€&#34;&gt;å‰è¨€&lt;/h2&gt;

&lt;p&gt;æœ¬æ–‡å°†é‡ç‚¹ä»‹ç»æˆ‘ä»¬å¦‚ä½•åœ¨å…¨çƒå¤šä¸ª Kubernetes é›†ç¾¤ä¸Šéƒ¨ç½²æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºã€‚&lt;/p&gt;

&lt;p&gt;ä¸ºäº†å°†åº”ç”¨ä¸€æ¬¡éƒ¨ç½²åˆ°å¤šä¸ª Kubernetes é›†ç¾¤ï¼Œæˆ‘ä»¬ä½¿ç”¨äº† &lt;a href=&#34;https://helm.sh/&#34; target=&#34;_blank&#34;&gt;Helm&lt;/a&gt;ï¼Œå¹¶å°†æ‰€æœ‰ chart å­˜å‚¨åœ¨ä¸€ä¸ª git ä»“åº“ä¸­ã€‚æˆ‘ä»¬ä½¿ç”¨ &lt;strong&gt;umbrella&lt;/strong&gt; æ¥éƒ¨ç½²ç”±å¤šä¸ªæœåŠ¡ç»„æˆçš„å®Œæ•´åº”ç”¨ç¨‹åºï¼Œè¿™åŸºæœ¬ä¸Šæ˜¯ä¸€ä¸ªå£°æ˜ä¾èµ–å…³ç³»çš„ chart ï¼Œå…¶å…è®¸æˆ‘ä»¬åœ¨å•ä¸ªå‘½ä»¤è¡Œä¸­å¼•å¯¼æˆ‘ä»¬çš„ API åŠå…¶æœåŠ¡ã€‚&lt;/p&gt;

&lt;p&gt;æ­¤å¤–ï¼Œæˆ‘ä»¬åœ¨ä½¿ç”¨ Helm ä¹‹å‰ä¼šè¿è¡Œä¸€ä¸ª python è„šæœ¬ï¼Œç”¨æ¥è¿›è¡Œæ£€æŸ¥ï¼Œæ„å»º chart ï¼Œæ·»åŠ  secrets å¹¶éƒ¨ç½²æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºã€‚æ‰€æœ‰è¿™äº›ä»»åŠ¡éƒ½æ˜¯ä½¿ç”¨ docker é•œåƒåœ¨ CI å¹³å°ä¸Šå®Œæˆçš„ã€‚&lt;/p&gt;

&lt;p&gt;ä¸‹é¢å°±è¿›è¡Œè¯¦ç»†ä»‹ç»&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;æ³¨æ„ï¼ï¼š&lt;/strong&gt; å½“ä½ é˜…è¯»è¿™ç¯‡åšæ–‡çš„æ—¶å€™ï¼ŒHelm 3 çš„ç¬¬ä¸€ä¸ª &lt;a href=&#34;https://github.com/helm/helm/releases/tag/v3.0.0-alpha.1&#34; target=&#34;_blank&#34;&gt;release&lt;/a&gt; å·²ç»å‘å¸ƒã€‚è¿™ä¸ªç‰ˆæœ¬å¸¦æ¥äº†ä¸€ç³»åˆ—å¢å¼ºåŠŸèƒ½ï¼Œè‚¯å®šä¼šè§£å†³æˆ‘ä»¬è¿‡å»é‡åˆ°çš„ä¸€äº›é—®é¢˜ã€‚&lt;/p&gt;

&lt;p&gt;image:
  caption: &amp;ldquo;Image from: &lt;a href=&#34;https://www.pexels.com&#34; target=&#34;_blank&#34;&gt;&lt;strong&gt;Pexels&lt;/strong&gt;&lt;/a&gt;&amp;ldquo;
  focal_point: &amp;ldquo;&amp;rdquo;&lt;/p&gt;

&lt;h2 id=&#34;preview-only-false&#34;&gt;preview_only: false&lt;/h2&gt;

&lt;h2 id=&#34;charts-å¼€å‘æµç¨‹&#34;&gt;Charts å¼€å‘æµç¨‹&lt;/h2&gt;

&lt;p&gt;åœ¨å¼€å‘åº”ç”¨ç¨‹åºæ—¶ï¼Œæˆ‘ä»¬ä½¿ç”¨&lt;a href=&#34;https://git-scm.com/book/en/v2/Git-Branching-Branching-Workflows&#34; target=&#34;_blank&#34;&gt;åˆ†æ”¯å·¥ä½œæµ&lt;/a&gt;ï¼Œå¼€å‘ chart æ—¶ä¹Ÿä½¿ç”¨ç›¸åŒæµç¨‹ã€‚&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;é¦–å…ˆï¼Œ&lt;strong&gt;dev&lt;/strong&gt; åˆ†æ”¯ç”¨äºæ„å»ºè¦åœ¨å¼€å‘é›†ç¾¤ä¸Šè¿›è¡Œæµ‹è¯•çš„ chart ã€‚&lt;/li&gt;
&lt;li&gt;ç„¶åï¼Œå½“å‘èµ· PR è¯·æ±‚åˆ° &lt;strong&gt;master&lt;/strong&gt; åˆ†æ”¯æ—¶ï¼Œå°†å‘å¸ƒåˆ°æ¼”ç¤ºç¯å¢ƒä¸­è¿›è¡ŒéªŒè¯ã€‚&lt;/li&gt;
&lt;li&gt;æœ€ç»ˆï¼Œæˆ‘ä»¬å°† PR è¯·æ±‚æäº¤çš„ä¿®æ”¹åˆå¹¶åˆ° &lt;strong&gt;prod&lt;/strong&gt; åˆ†æ”¯ï¼Œå°†è¿™ä¸ªä¿®æ”¹åº”ç”¨äºç”Ÿäº§ç¯å¢ƒã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;æˆ‘ä»¬ä½¿ç”¨ &lt;a href=&#34;https://chartmuseum.com/&#34; target=&#34;_blank&#34;&gt;Chartmuseum&lt;/a&gt; ä½œä¸ºç§æœ‰ä»“åº“æ¥å­˜å‚¨ chart ï¼Œæ¯ä¸ªç¯å¢ƒéƒ½æœ‰ä¸€ä¸ª ã€‚è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥åœ¨&lt;strong&gt;ç¯å¢ƒä¹‹é—´å®ç°æ˜ç¡®çš„éš”ç¦»&lt;/strong&gt;ï¼Œå¹¶ä¸”ç¡®ä¿è¯¥ chart åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨ä¹‹å‰å·²ç»è¿‡æµ‹è¯•ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://wx2.sinaimg.cn/large/ad5fbf65gy1g50h10d4xbj20ys0ee75e.jpg&#34; alt=&#34;&#34; /&gt;
&lt;center&gt;æ¯ä¸ªç¯å¢ƒçš„ Chart ä»“åº“&lt;/center&gt;&lt;/p&gt;

&lt;p&gt;å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå½“å¼€å‘äººå‘˜ push ä»£ç åˆ°ä»–ä»¬çš„ dev åˆ†æ”¯æ—¶ï¼Œä»–ä»¬çš„ chart ç‰ˆæœ¬ä¹Ÿä¼šè‡ªåŠ¨ push åˆ° dev ç¯å¢ƒçš„ Chartmuseum ã€‚å› æ­¤ï¼Œæ‰€æœ‰å¼€å‘äººå‘˜éƒ½ä½¿ç”¨ç›¸åŒçš„ dev å­˜å‚¨åº“ï¼Œä»–ä»¬å¿…é¡»å°å¿ƒçš„æŒ‡å®šè‡ªå·±çš„ chart ç‰ˆæœ¬ï¼Œä»¥é¿å…ä½¿ç”¨å…¶ä»–äººçš„å¯¹ chart çš„æ›´æ”¹ã€‚&lt;/p&gt;

&lt;p&gt;æ­¤å¤–ï¼Œæˆ‘ä»¬çš„ python è„šæœ¬é€šè¿‡ä½¿ç”¨ &lt;a href=&#34;https://kubeval.instrumenta.dev/&#34; target=&#34;_blank&#34;&gt;Kubeval&lt;/a&gt; åœ¨å®ƒä»¬æ¨é€åˆ° Chartmusem ä¹‹å‰éªŒè¯ Kubernetes å¯¹è±¡ä¸ Kubernetes OpenAPI è§„èŒƒã€‚&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;chart å¼€å‘å·¥ä½œæµ&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;&lt;img src=&#34;https://ws3.sinaimg.cn/large/ad5fbf65gy1g50hg9gmh2j20gr047t8o.jpg&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;æ ¹æ® &lt;a href=&#34;https://gazr.io/&#34; target=&#34;_blank&#34;&gt;gazr.io&lt;/a&gt; è§„èŒƒè®¾ç½®æˆ‘ä»¬çš„ pipeline ä»»åŠ¡ï¼ˆlintï¼Œunit-testï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;push docker é•œåƒï¼Œè¯¥é•œåƒåŒ…å«éƒ¨ç½²åº”ç”¨ç¨‹åºçš„ Python å·¥å…·ã€‚&lt;/li&gt;
&lt;li&gt;æ ¹æ®åˆ†æ”¯åç§°è®¾ç½®ç›¸åº”ç¯å¢ƒã€‚&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨ Kubeval æ£€æŸ¥ Kubernetes yamls ã€‚&lt;/li&gt;
&lt;li&gt;è‡ªåŠ¨å¢åŠ  chart ç‰ˆæœ¬åŠå…¶çˆ¶é¡¹ï¼ˆå–å†³äºæ›´æ”¹çš„ chart ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;å°† chart push åˆ°ä¸å…¶ç¯å¢ƒå¯¹åº”çš„ Chartmuseum ã€‚&lt;/li&gt;
&lt;/ol&gt;

&lt;h2 id=&#34;ç®¡ç†é›†ç¾¤å·®å¼‚&#34;&gt;ç®¡ç†é›†ç¾¤å·®å¼‚&lt;/h2&gt;

&lt;blockquote&gt;
&lt;p&gt;Cluster federation&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;æˆ‘ä»¬ä½¿ç”¨ &lt;a href=&#34;https://kubernetes.io/docs/concepts/cluster-administration/federation/&#34; target=&#34;_blank&#34;&gt;Kubernetes cluster federation&lt;/a&gt;ï¼Œå®ƒå…è®¸æˆ‘ä»¬ä»å•ä¸ª API ç«¯å£°æ˜ Kubernetes å¯¹è±¡ã€‚ä½†æ˜¯æˆ‘ä»¬é‡åˆ°çš„é—®é¢˜æ˜¯ï¼Œæ— æ³•åœ¨ federation ç«¯ä¸­åˆ›å»ºæŸäº› Kubernetes å¯¹è±¡ï¼Œå› æ­¤å¾ˆéš¾ç»´æŠ¤ federation å¯¹è±¡å’Œå…¶ä»–çš„ç¾¤é›†å¯¹è±¡ã€‚&lt;/p&gt;

&lt;p&gt;ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å†³å®šç‹¬ç«‹ç®¡ç†æˆ‘ä»¬çš„é›†ç¾¤ï¼Œåè€Œä½¿è¿™ä¸ªè¿‡ç¨‹å˜å¾—æ›´åŠ å®¹æ˜“ï¼ˆæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ federation v1ï¼Œv2 å¯èƒ½æœ‰æ‰€æ”¹å–„ï¼‰ã€‚&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;å¹³å°åœ°ç†åˆ†å¸ƒ&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;ç›®å‰ï¼Œæˆ‘ä»¬çš„å¹³å°åˆ†å¸ƒåœ¨6ä¸ªåœ°åŒºï¼Œ3ä¸ªåœ¨è‡ªå·±çš„æ•°æ®ä¸­å¿ƒï¼Œ3ä¸ªåœ¨å…¬æœ‰äº‘ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://ws1.sinaimg.cn/large/ad5fbf65gy1g50klup6yaj212w0ftq4h.jpg&#34; alt=&#34;&#34; /&gt;
&lt;center&gt;åˆ†å¸ƒå¼éƒ¨ç½²&lt;/center&gt;&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;Helm global values&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;4ä¸ªå…¨å±€çš„ Helm value å®šä¹‰é›†ç¾¤é—´çš„å·®å¼‚ã€‚è¿™äº›æ˜¯æˆ‘ä»¬æ‰€æœ‰ chart çš„æœ€å°é»˜è®¤å€¼ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-yaml&#34;&gt;    global:
        cloud: True
        env: staging
        region: us-central1
        clusterName: staging-us-central1
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;center&gt;global values&lt;/center&gt;&lt;/p&gt;

&lt;p&gt;è¿™äº›ä¿¡æ¯æœ‰åŠ©äºæˆ‘ä»¬ä¸ºåº”ç”¨ç¨‹åºå®šä¹‰ä¸Šä¸‹æ–‡ï¼Œå®ƒä»¬å¯ç”¨äºç›‘æ§ï¼Œè·Ÿè¸ªï¼Œè®°å½•ï¼Œè¿›è¡Œå¤–éƒ¨è°ƒç”¨ï¼Œæ‰©å±•ç­‰è®¸å¤šå†…å®¹&amp;hellip;&amp;hellip;&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;cloud&lt;/strong&gt;ï¼šæˆ‘ä»¬æœ‰ä¸€ä¸ªæ··åˆ Kubernetes é›†ç¾¤ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬çš„ API éƒ¨ç½²åœ¨ GCP å’Œæˆ‘ä»¬è‡ªå·±çš„æ•°æ®ä¸­å¿ƒã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;env&lt;/strong&gt;ï¼šå¯¹äºéç”Ÿäº§ç¯å¢ƒï¼ŒæŸäº›å€¼å¯èƒ½ä¼šå‘ç”Ÿå˜åŒ–ã€‚æœ¬è´¨ä¸Šæ˜¯èµ„æºå®šä¹‰å’Œè‡ªåŠ¨æ‰©å±•é…ç½®ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;region&lt;/strong&gt;ï¼šæ­¤ä¿¡æ¯ç”¨äºæ ‡è¯†ç¾¤é›†çš„ä½ç½®ï¼Œå¹¶å¯ç”¨äºå®šä¹‰å¤–éƒ¨æœåŠ¡çš„æœ€è¿‘ç«¯ç‚¹ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;clusterName&lt;/strong&gt;ï¼šå¦‚æœæˆ‘ä»¬æƒ³è¦ä¸ºæ¯ä¸ªç¾¤é›†å®šä¹‰ä¸€ä¸ªå€¼ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;ä¸‹é¢æ˜¯ä¸€ä¸ªå…·ä½“çš„ç¤ºä¾‹ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-yaml&#34;&gt;{{/* Returns Horizontal Pod Autoscaler replicas for GraphQL*/}}
{{- define &amp;quot;graphql.hpaReplicas&amp;quot; -}}
{{- if eq .Values.global.env &amp;quot;prod&amp;quot; }}
{{- if eq .Values.global.region &amp;quot;europe-west1&amp;quot; }}
minReplicas: 40
{{- else }}
minReplicas: 150
{{- end }}
maxReplicas: 1400
{{- else }}
minReplicas: 4
maxReplicas: 20
{{- end }}
{{- end -}}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;center&gt;helm template example&lt;/center&gt;&lt;/p&gt;

&lt;p&gt;è¯·æ³¨æ„ï¼Œæ­¤é€»è¾‘åœ¨å¸®åŠ©æ¨¡æ¿ä¸­å®šä¹‰ï¼Œä»¥ä¿æŒ Kubernetes YAML çš„å¯è¯»æ€§ã€‚&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;å£°æ˜åº”ç”¨&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;æˆ‘ä»¬çš„éƒ¨ç½²å·¥å…·åŸºäºå‡ ä¸ª YAML æ–‡ä»¶ï¼Œä¸‹é¢æ˜¯æˆ‘ä»¬å£°æ˜æœåŠ¡åŠå…¶æ¯ä¸ªé›†ç¾¤çš„æ‰©å±•æ‹“æ‰‘ï¼ˆå‰¯æœ¬æ•°é‡ï¼‰çš„ç¤ºä¾‹ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-yaml&#34;&gt;releases:
  - foo.world
 
foo.world:                # Release name
  services:               # List of dailymotion&#39;s apps/projects
    foobar:
      chart_name: foo-foobar
      repo: git@github.com:dailymotion/foobar
      contexts:
        prod-europe-west1:
          deployments:
            - name: foo-bar-baz
              replicas: 18
            - name: another-deployment
              replicas: 3
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;center&gt;service definition&lt;/center&gt;&lt;/p&gt;

&lt;p&gt;è¿™æ˜¯éƒ¨ç½²å·¥ä½œæµçš„æ‰€æœ‰æ­¥éª¤ï¼Œæœ€åä¸€æ­¥å°†åœ¨å¤šä¸ªç”Ÿäº§é›†ç¾¤ä¸ŠåŒæ—¶éƒ¨ç½²åº”ç”¨ç¨‹åºã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://ws1.sinaimg.cn/large/ad5fbf65gy1g50ldllp33j20mw0bxglz.jpg&#34; alt=&#34;&#34; /&gt;
&lt;center&gt;Jenkins deployment steps&lt;/center&gt;&lt;/p&gt;

&lt;h2 id=&#34;secrets-æ€ä¹ˆåŠ&#34;&gt;Secrets æ€ä¹ˆåŠ&lt;/h2&gt;

&lt;p&gt;åœ¨å®‰å…¨é¢†åŸŸï¼Œæˆ‘ä»¬ä¸“æ³¨äºè·Ÿè¸ªå¯èƒ½åœ¨ä¸åŒä½ç½®ä¼ æ’­çš„æ‰€æœ‰çš„ Secrets ï¼Œå¹¶å°†å…¶å­˜å‚¨åœ¨å·´é»çš„ &lt;a href=&#34;https://www.vaultproject.io/&#34; target=&#34;_blank&#34;&gt;Vault&lt;/a&gt; ã€‚&lt;/p&gt;

&lt;p&gt;æˆ‘ä»¬çš„éƒ¨ç½²å·¥å…·è´Ÿè´£ä» Vault æ£€ç´¢åŠ å¯†çš„å€¼ï¼Œå¹¶åœ¨éƒ¨ç½²æ—¶å°†å…¶æ³¨å…¥ Helm ã€‚&lt;/p&gt;

&lt;p&gt;ä¸ºæ­¤ï¼Œæˆ‘ä»¬å®šä¹‰äº†å­˜å‚¨åœ¨ Vault ä¸­çš„ Secrets ä¸æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºæ‰€éœ€çš„ Secrets ä¹‹é—´çš„æ˜ å°„ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-yaml&#34;&gt;secrets: 
     - secret_id: &amp;quot;stack1-app1-password&amp;quot;
       contexts:
         - name: &amp;quot;default&amp;quot;
           vaultPath: &amp;quot;/kv/dev/stack1/app1/test&amp;quot;
           vaultKey: &amp;quot;password&amp;quot;
         - name: &amp;quot;cluster1&amp;quot;
           vaultPath: &amp;quot;/kv/dev/stack1/app1/test&amp;quot;
           vaultKey: &amp;quot;password&amp;quot;
&lt;/code&gt;&lt;/pre&gt;

&lt;ul&gt;
&lt;li&gt;å®šä¹‰å°† Secrets å†™å…¥ Vault æ—¶è¦éµå¾ªçš„é€šç”¨è§„åˆ™ã€‚&lt;/li&gt;
&lt;li&gt;å¦‚æœ Secrets æœ‰ç‰¹å®šçš„ä¸Šä¸‹æ–‡/é›†ç¾¤ï¼Œåˆ™å¿…é¡»æ·»åŠ ç‰¹å®šæ¡ç›®ã€‚&lt;/li&gt;
&lt;li&gt;å¦åˆ™ï¼Œå°†ä½¿ç”¨é»˜è®¤å€¼ã€‚&lt;/li&gt;

&lt;li&gt;&lt;p&gt;å¯¹äºæ­¤åˆ—è¡¨ä¸­çš„æ¯ä¸ªé¡¹ç›®ï¼Œå°†åœ¨ Kubernetes Secrets ä¸­æ’å…¥ä¸€ä¸ª key/value ã€‚è¿™æ ·æˆ‘ä»¬ chart ä¸­çš„ Secrets æ¨¡æ¿éå¸¸ç®€å•ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-yaml&#34;&gt;apiVersion: v1
data:
{{- range $key,$value := .Values.secrets }}
{{ $key }}: {{ $value | b64enc | quote }}
{{ end }}
kind: Secret
metadata:
name: &amp;quot;{{ .Chart.Name }}&amp;quot;
labels:
chartVersion: &amp;quot;{{ .Chart.Version }}&amp;quot;
tillerVersion: &amp;quot;{{ .Capabilities.TillerVersion.SemVer }}&amp;quot;
type: Opaque
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;è­¦å‘Šä¸é™åˆ¶&#34;&gt;è­¦å‘Šä¸é™åˆ¶&lt;/h2&gt;

&lt;p&gt;image:
  caption: &amp;ldquo;Image from: &lt;a href=&#34;https://www.pexels.com&#34; target=&#34;_blank&#34;&gt;&lt;strong&gt;Pexels&lt;/strong&gt;&lt;/a&gt;&amp;ldquo;
  focal_point: &amp;ldquo;&amp;rdquo;&lt;/p&gt;

&lt;h2 id=&#34;preview-only-false-1&#34;&gt;preview_only: false&lt;/h2&gt;

&lt;h3 id=&#34;æ“ä½œå¤šä¸ªå­˜å‚¨åº“&#34;&gt;æ“ä½œå¤šä¸ªå­˜å‚¨åº“&lt;/h3&gt;

&lt;p&gt;ç›®å‰ï¼Œchart å’Œåº”ç”¨ç¨‹åºå¼€å‘æ˜¯åˆ†ç¦»çš„ã€‚è¿™æ„å‘³ç€å¼€å‘äººå‘˜å¿…é¡»å¤„ç†ä¸¤ä¸ª git å­˜å‚¨åº“ï¼Œä¸€ä¸ªç”¨äºåº”ç”¨ç¨‹åºï¼Œå¦ä¸€ä¸ªç”¨äºå®šä¹‰å¦‚ä½•åœ¨ Kubernetes ä¸Šéƒ¨ç½²ã€‚è€Œ2ä¸ª git å­˜å‚¨åº“æ„å‘³ç€ä¸¤ä¸ªå·¥ä½œæµç¨‹ï¼Œè¿™å¯¹äºæ–°æ‰‹æ¥è¯´å¯èƒ½ç›¸å½“å¤æ‚ã€‚&lt;/p&gt;

&lt;h3 id=&#34;ç®¡ç†-umbrella-charts-å¯èƒ½å¾ˆæ£˜æ‰‹&#34;&gt;ç®¡ç† umbrella charts å¯èƒ½å¾ˆæ£˜æ‰‹&lt;/h3&gt;

&lt;p&gt;å¦‚å‰æ‰€è¿°ï¼Œumbrella charts éå¸¸é€‚åˆå®šä¹‰ä¾èµ–å…³ç³»å¹¶å¿«é€Ÿéƒ¨ç½²å¤šä¸ªåº”ç”¨ç¨‹åºã€‚åŒæ—¶æˆ‘ä»¬ä½¿ç”¨ &lt;code&gt;--reuse-values&lt;/code&gt; é€‰é¡¹ï¼Œä»¥é¿å…æ¯æ¬¡éƒ¨ç½²ä½œä¸º umbrella charts ä¸€éƒ¨åˆ†çš„åº”ç”¨ç¨‹åºæ—¶éƒ½è¦ä¼ é€’æ‰€æœ‰å€¼ã€‚&lt;/p&gt;

&lt;p&gt;åœ¨æˆ‘ä»¬çš„ CD å·¥ä½œæµä¸­ï¼Œåªæœ‰2ä¸ªå€¼ä¼šå®šæœŸæ›´æ”¹ï¼šå‰¯æœ¬æ•°é‡å’Œé•œåƒæ ‡ç­¾ï¼ˆç‰ˆæœ¬ï¼‰ã€‚å¯¹äºå…¶ä»–æ›´ç¨³å®šçš„å€¼ï¼Œéœ€è¦æ‰‹åŠ¨æ›´æ–°ï¼Œè€Œä¸”è¿™äº›å€¼å¹¶ä¸æ˜¯å¾ˆå®¹æ˜“å¼„æ¸…æ¥šã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬æ›¾é‡åˆ°è¿‡éƒ¨ç½² umbrella charts çš„ä¸€ä¸ªé”™è¯¯å¯¼è‡´ä¸¥é‡çš„ä¸­æ–­ã€‚&lt;/p&gt;

&lt;h3 id=&#34;æ›´æ–°å¤šä¸ªé…ç½®æ–‡ä»¶&#34;&gt;æ›´æ–°å¤šä¸ªé…ç½®æ–‡ä»¶&lt;/h3&gt;

&lt;p&gt;æ·»åŠ æ–°åº”ç”¨ç¨‹åºæ—¶ï¼Œå¼€å‘äººå‘˜å¿…é¡»æ›´æ”¹å¤šä¸ªæ–‡ä»¶ï¼šåº”ç”¨ç¨‹åºå£°æ˜ï¼Œ Secrets åˆ—è¡¨ï¼Œå¦‚æœåº”ç”¨ç¨‹åºæ˜¯ umbrella charts çš„ä¸€éƒ¨åˆ†ï¼Œåˆ™å°†å…¶æ·»åŠ åˆ°ä¾èµ–ã€‚&lt;/p&gt;

&lt;h3 id=&#34;åœ¨-vault-ä¸Š-jenkins-æƒé™è¿‡å¤§&#34;&gt;åœ¨ Vault ä¸Šï¼Œ Jenkins æƒé™è¿‡å¤§&lt;/h3&gt;

&lt;p&gt;ç›®å‰ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ª &lt;a href=&#34;https://www.vaultproject.io/docs/auth/approle.html&#34; target=&#34;_blank&#34;&gt;AppRole&lt;/a&gt; å¯ä»¥è¯»å– Vault çš„æ‰€æœ‰ Secrets ã€‚&lt;/p&gt;

&lt;h3 id=&#34;å›æ»šè¿‡ç¨‹ä¸æ˜¯è‡ªåŠ¨åŒ–çš„&#34;&gt;å›æ»šè¿‡ç¨‹ä¸æ˜¯è‡ªåŠ¨åŒ–çš„&lt;/h3&gt;

&lt;p&gt;å›æ»šéœ€è¦åœ¨å¤šä¸ªé›†ç¾¤ä¸Šè¿è¡Œè¯¥å‘½ä»¤ï¼Œè¿™å¯èƒ½å®¹æ˜“å‡ºé”™ã€‚æˆ‘ä»¬åˆ¶ä½œæœ¬æ“ä½œæ‰‹å†Œæ˜¯å› ä¸ºæˆ‘ä»¬è¦ç¡®ä¿åº”ç”¨æ­£ç¡®çš„ç‰ˆæœ¬ ID ã€‚&lt;/p&gt;

&lt;h2 id=&#34;gitops-å®è·µ&#34;&gt;GitOps å®è·µ&lt;/h2&gt;

&lt;blockquote&gt;
&lt;p&gt;ç›®æ ‡&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;æˆ‘ä»¬çš„æƒ³æ³•æ˜¯å°† chart æ”¾å›åˆ°å®ƒéƒ¨ç½²çš„åº”ç”¨ç¨‹åºçš„å­˜å‚¨åº“ä¸‹ã€‚å·¥ä½œæµç¨‹ä¸åº”ç”¨åŒæ—¶å¼€å‘ï¼Œä¾‹å¦‚ï¼Œæ— è®ºä½•æ—¶åœ¨ä¸»æœåŠ¡å™¨ä¸Šåˆå¹¶åˆ†æ”¯ï¼Œéƒ½ä¼šè‡ªåŠ¨è§¦å‘éƒ¨ç½²ã€‚è¿™ç§æ–¹æ³•ä¸å½“å‰å·¥ä½œæµç¨‹çš„ä¸»è¦åŒºåˆ«åœ¨äºï¼Œæ‰€æœ‰å†…å®¹éƒ½å°†é€šè¿‡ git è¿›è¡Œç®¡ç†ï¼ˆåº”ç”¨ç¨‹åºæœ¬èº«ä»¥åŠæˆ‘ä»¬åœ¨ Kubernetes ä¸­éƒ¨ç½²å®ƒçš„æ–¹å¼ï¼‰ã€‚&lt;/p&gt;

&lt;p&gt;è¿™æ ·åšä¼˜ç‚¹ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;ä»å¼€å‘äººå‘˜çš„è§’åº¦æ¥çœ‹ï¼Œæ›´å®¹æ˜“ç†è§£ã€‚å­¦ä¹ å¦‚ä½•åœ¨æœ¬åœ° chart ä¸­åº”ç”¨æ›´æ”¹å°†æ›´å®¹æ˜“ã€‚&lt;/li&gt;
&lt;li&gt;å°†æœåŠ¡ deployment å®šä¹‰åœ¨ä¸æ­¤æœåŠ¡çš„ä»£ç ç›¸åŒçš„ä½ç½®ã€‚&lt;/li&gt;
&lt;li&gt;ç§»é™¤ umbrella charts ç®¡ç†ã€‚æœåŠ¡å°†æ‹¥æœ‰è‡ªå·±çš„ Helm ç‰ˆæœ¬ã€‚è¿™ä½¿å¾—åº”ç”¨ç¨‹åºç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼ˆå›æ»šï¼Œå‡çº§ï¼‰å½¢æˆé—­ç¯ï¼Œä¸ä¼šå½±å“å…¶ä»–æœåŠ¡ã€‚&lt;/li&gt;
&lt;li&gt;git åŠŸèƒ½å¯¹ chart ç®¡ç†çš„å¥½å¤„ï¼šå›æ»šï¼Œå®¡è®¡æ—¥å¿—&amp;hellip;&amp;hellip;å¦‚æœè¦è¿˜åŸ chart æ›´æ”¹ï¼Œå¯ä»¥ä½¿ç”¨ git è¿›è¡Œæ›´æ”¹ã€‚åŒæ—¶éƒ¨ç½²å°†è‡ªåŠ¨è§¦å‘ã€‚&lt;/li&gt;
&lt;li&gt;æˆ‘ä»¬è€ƒè™‘ä½¿ç”¨ Skaffold ç­‰å·¥å…·æ”¹è¿›å¼€å‘å·¥ä½œæµç¨‹ï¼Œè¿™äº›å·¥å…·å…è®¸å¼€å‘äººå‘˜åœ¨ç±»ä¼¼äºç”Ÿäº§çš„ç¯å¢ƒä¸­æµ‹è¯•ä»–ä»¬çš„æ›´æ”¹ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;blockquote&gt;
&lt;p&gt;2æ­¥è¿ç§»&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;æˆ‘ä»¬çš„å¼€å‘äººå‘˜å·²ä½¿ç”¨ä¸Šè¿°å·¥ä½œæµç¨‹2å¹´ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦å°½å¯èƒ½é¡ºåˆ©åœ°è¿›è¡Œè¿ç§»ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬å†³å®šåœ¨è¾¾åˆ°ç›®æ ‡ä¹‹å‰æ·»åŠ ä¸€ä¸ªä¸­é—´æ­¥éª¤ã€‚&lt;/p&gt;

&lt;p&gt;ç¬¬ä¸€æ­¥å¾ˆç®€å•ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;p&gt;æˆ‘ä»¬å°†ä¿ç•™ä¸€ä¸ªç±»ä¼¼çš„ç»“æ„æ¥é…ç½®æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºéƒ¨ç½²ï¼Œä½†æ˜¯åœ¨åä¸º â€œDailymotionReleaseâ€ çš„å•ä¸ªå¯¹è±¡ä¸­&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-yaml&#34;&gt;apiVersion: &amp;quot;v1&amp;quot;
kind: &amp;quot;DailymotionRelease&amp;quot;
metadata:
name: &amp;quot;app1.ns1&amp;quot;
environment: &amp;quot;dev&amp;quot;
branch: &amp;quot;mybranch&amp;quot;
spec:
slack_channel: &amp;quot;#admin&amp;quot;
chart_name: &amp;quot;app1&amp;quot;
scaling:
- context: &amp;quot;dev-us-central1-0&amp;quot;
  replicas:
    - name: &amp;quot;hermes&amp;quot;
      count: 2
- context: &amp;quot;dev-europe-west1-0&amp;quot;
  replicas:
    - name: &amp;quot;app1-deploy&amp;quot;
      count: 2
secrets:
- secret_id: &amp;quot;app1&amp;quot;
  contexts:
    - name: &amp;quot;default&amp;quot;
      vaultPath: &amp;quot;/kv/dev/ns1/app1/test&amp;quot;
      vaultKey: &amp;quot;password&amp;quot;
    - name: &amp;quot;dev-europe-west1-0&amp;quot;
      vaultPath: &amp;quot;/kv/dev/ns1/app1/test&amp;quot;
      vaultKey: &amp;quot;password&amp;quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;æ¯ä¸ªåº”ç”¨ç¨‹åºä¸€ä¸ªç‰ˆæœ¬ï¼ˆä¸å†ä½¿ç”¨ umbrella charts ï¼‰&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;å°† chart åŠ å…¥åº”ç”¨ç¨‹åº git å­˜å‚¨åº“ä¸­&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;æˆ‘ä»¬å·²ç»å¼€å§‹å‘æ‰€æœ‰å¼€å‘äººå‘˜ç§‘æ™®è¿™ä¸ªè¯ï¼Œå¹¶ä¸”è¿ç§»è¿‡ç¨‹å·²ç»å¼€å§‹ã€‚ç¬¬ä¸€æ­¥ä»ç„¶ä½¿ç”¨ CI å¹³å°è¿›è¡Œæ§åˆ¶ã€‚æˆ‘å°†åœ¨çŸ­æœŸå†…æ’°å†™å¦ä¸€ç¯‡åšæ–‡ï¼Œä»‹ç»ç¬¬äºŒæ­¥ï¼šæˆ‘ä»¬å¦‚ä½•é€šè¿‡ &lt;a href=&#34;https://github.com/weaveworks/flux&#34; target=&#34;_blank&#34;&gt;Flux&lt;/a&gt; å®ç°å‘ GitOps å·¥ä½œæµç¨‹çš„è¿ç§»ã€‚å°†æè¿°æˆ‘ä»¬çš„è®¾ç½®å’Œé¢ä¸´çš„æŒ‘æˆ˜ï¼ˆå¤šä¸ªå­˜å‚¨åº“ï¼ŒSecrets ç­‰ï¼‰ã€‚ æ•¬è¯·æœŸå¾…ï¼&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>é˜¿é‡Œäº‘ ACK æŒ‚è½½ NAS æ•°æ®å·</title>
      <link>https://guoxudong.io/en/post/nas-k8s/</link>
      <pubDate>Mon, 08 Jul 2019 15:09:56 +0800</pubDate>
      
      <guid>https://guoxudong.io/en/post/nas-k8s/</guid>
      <description>

&lt;h2 id=&#34;å‰è¨€&#34;&gt;å‰è¨€&lt;/h2&gt;

&lt;p&gt;ä»Šå¤©æ¥åˆ°ä¸€ä¸ªå°† NAS æ•°æ®å·æŒ‚è½½åˆ° Kubernetes é›†ç¾¤çš„éœ€æ±‚ï¼Œéœ€è¦å°†ä¸€ä¸ª NAS æ•°æ®å·æŒ‚è½½åˆ°é›†ç¾¤ä¸­ã€‚è¿™ä¸€å¾ˆç®€å•çš„æ“ä½œç”±äºå¥½ä¹…æ²¡æœ‰æ“ä½œäº†ï¼Œå»ç¿»çœ‹äº†ä¸€ä¸‹å®˜æ–¹æ–‡æ¡£ï¼Œå‘ç°å®˜æ–¹æ–‡æ¡£è¿˜åœ¨åœç•™åœ¨å»å¹´7æœˆä»½&amp;hellip;ä¸ºäº†é˜²æ­¢ä¹‹åè¿˜æœ‰ç›¸ä¼¼æƒ…å†µçš„å‘ç”Ÿï¼Œè¿™é‡Œå°†æ‰€æœ‰æ“ä½œåšä¸€ä¸ªç®€å•è®°å½•ã€‚&lt;/p&gt;

&lt;h2 id=&#34;è´­ä¹°å­˜å‚¨åŒ…-åˆ›å»ºæ–‡ä»¶ç³»ç»Ÿ&#34;&gt;è´­ä¹°å­˜å‚¨åŒ…ï¼ˆåˆ›å»ºæ–‡ä»¶ç³»ç»Ÿï¼‰&lt;/h2&gt;

&lt;p&gt;åœ¨æŒ‚è½½ NAS ä¹‹å‰ï¼Œé¦–å…ˆè¦å…ˆè´­ä¹° NAS æ–‡ä»¶å­˜å‚¨ï¼Œè¿™é‡Œæ¨èè´­ä¹°å­˜å‚¨åŒ…ï¼Œ100G çš„ SSD æ€¥é€Ÿå‹ä¸€å¹´åªéœ€1400å¤šï¼Œè€Œå®¹é‡å‹åªè¦279ï¼Œå¯¹äºæˆ‘è¿™ç§åªæœ‰å°‘é‡ NAS å­˜å‚¨éœ€æ±‚çš„äººæ¥è¯´æ˜¯æ˜¯é è°±çš„ï¼Œå› ä¸ºæˆ‘åªéœ€è¦5Gçš„å·¦å³çš„å­˜å‚¨ç©ºé—´ï¼ŒSSD æ€¥é€Ÿå‹ NAS ä¸€å¹´åªè¦18å—ï¼Œå®Œç¾ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://ws1.sinaimg.cn/large/ad5fbf65gy1g4sglwrx0gj22wa09gae4.jpg&#34; alt=&#34;image&#34; /&gt;&lt;/p&gt;

&lt;p&gt;é€‰æ‹©æƒ³è¦åˆ›å»º NAS æ‰€åœ¨ VPC å’Œ åŒºåŸŸ&lt;/p&gt;

&lt;h2 id=&#34;æ·»åŠ æŒ‚è½½ç‚¹&#34;&gt;æ·»åŠ æŒ‚è½½ç‚¹&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;&lt;p&gt;ç‚¹å‡»æ·»åŠ æŒ‚è½½ç‚¹
&lt;img src=&#34;https://wx3.sinaimg.cn/large/ad5fbf65gy1g4sgp0dos2j22ky0iowkr.jpg&#34; alt=&#34;image&#34; /&gt;&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;é€‰æ‹© VPC ç½‘ç»œã€äº¤æ¢æœºå’Œæƒé™ç»„
&lt;img src=&#34;https://wx2.sinaimg.cn/large/ad5fbf65gy1g4sgpwqrgoj20xu0vowib.jpg&#34; alt=&#34;image&#34; /&gt;&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;linux-æŒ‚è½½-nas-æ•°æ®å·&#34;&gt;Linux æŒ‚è½½ NAS æ•°æ®å·&lt;/h2&gt;

&lt;p&gt;åœ¨æŒ‚è½½ç‚¹åˆ›å»ºæˆåŠŸåï¼Œå°±å¯ä»¥å°† NAS æ•°æ®å·æŒ‚è½½åˆ° Linux ç³»ç»Ÿï¼Œè¿™é‡Œä»¥ CentOS ä¸ºä¾‹ï¼š&lt;/p&gt;

&lt;h3 id=&#34;å®‰è£…-nfs-å®¢æˆ·ç«¯&#34;&gt;å®‰è£… NFS å®¢æˆ·ç«¯&lt;/h3&gt;

&lt;p&gt;å¦‚æœ Linux ç³»ç»Ÿè¦æŒ‚è½½ NAS ï¼Œé¦–å…ˆéœ€è¦å®‰è£… NFS å®¢æˆ·ç«¯&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;sudo yum install nfs-utils
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;æŒ‚è½½-nfs-æ–‡ä»¶ç³»ç»Ÿ&#34;&gt;æŒ‚è½½ NFS æ–‡ä»¶ç³»ç»Ÿ&lt;/h3&gt;

&lt;p&gt;è¿™é‡Œé˜¿é‡Œäº‘æ—©å°±è¿›è¡Œäº†ä¼˜åŒ–ï¼Œç‚¹å‡»åˆ›å»ºçš„æ–‡ä»¶ç³»ç»Ÿï¼Œé¡µé¢ä¸Šå°±å¯ä»¥ copy æŒ‚è½½å‘½ä»¤ã€‚é¡µé¢æä¾›äº†æŒ‚è½½åœ°å€çš„ copy å’ŒæŒ‚è½½å‘½ä»¤çš„ copy åŠŸèƒ½ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://wx2.sinaimg.cn/large/ad5fbf65gy1g4sh2i33wnj22w40yyn55.jpg&#34; alt=&#34;image&#34; /&gt;&lt;/p&gt;

&lt;p&gt;æŒ‚è½½å‘½ä»¤ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;sudo mount -t nfs -o vers=4,minorversion=0,noresvport xxxxx.cn-shanghai.nas.aliyuncs.com:/ /mnt
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;æŸ¥çœ‹æŒ‚è½½ç»“æœ&#34;&gt;æŸ¥çœ‹æŒ‚è½½ç»“æœ&lt;/h3&gt;

&lt;p&gt;ç›´æ¥åœ¨æŒ‚è½½æ•°æ®å·æ‰€åœ¨æœåŠ¡ä¸Šæ‰§è¡Œå‘½ä»¤ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;df -h
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;å°±å¯ä»¥çœ‹åˆ°ç»“æœï¼š&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://ws1.sinaimg.cn/large/ad5fbf65gy1g4sh6xwyt8j20lj0850tq.jpg&#34; alt=&#34;image&#34; /&gt;&lt;/p&gt;

&lt;h2 id=&#34;kubernetes-é›†ç¾¤æŒ‚è½½-nas-æ•°æ®å·&#34;&gt;Kubernetes é›†ç¾¤æŒ‚è½½ NAS æ•°æ®å·&lt;/h2&gt;

&lt;p&gt;K8S çš„æŒä¹…æ•°æ®å·æŒ‚è½½å¤§åŒå°å¼‚ï¼Œæµç¨‹éƒ½æ˜¯ï¼š&lt;strong&gt;åˆ›å»ºPV&lt;/strong&gt; -&amp;gt; &lt;strong&gt;åˆ›å»ºPVC&lt;/strong&gt; -&amp;gt; &lt;strong&gt;ä½¿ç”¨PVC&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;ä¸‹é¢å°±ç®€å•ä»‹ç»åœ¨é˜¿é‡Œäº‘ä¸Šçš„æ“ä½œï¼š&lt;/p&gt;

&lt;h3 id=&#34;åˆ›å»ºå­˜å‚¨å·-pv&#34;&gt;åˆ›å»ºå­˜å‚¨å·ï¼ˆPVï¼‰&lt;/h3&gt;

&lt;p&gt;é¦–å…ˆè¦åˆ›å»ºå­˜å‚¨å·ï¼Œé€‰æ‹© &lt;strong&gt;å®¹å™¨æœåŠ¡&lt;/strong&gt; -&amp;gt; &lt;strong&gt;å­˜å‚¨å·&lt;/strong&gt; -&amp;gt; &lt;strong&gt;åˆ›å»º&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;è¿™é‡Œè¦æ³¨æ„çš„æ˜¯ï¼š&lt;strong&gt;æŒ‚è½½ç‚¹åŸŸåä½¿ç”¨ä¸Šé¢é¢çš„æŒ‚è½½åœ°å€&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://wx4.sinaimg.cn/large/ad5fbf65gy1g4shuiiyyqj20hc0hp0tz.jpg&#34; alt=&#34;image&#34; /&gt;&lt;/p&gt;

&lt;h3 id=&#34;åˆ›å»ºå­˜å‚¨å£°æ˜-pvc&#34;&gt;åˆ›å»ºå­˜å‚¨å£°æ˜ï¼ˆPVCï¼‰&lt;/h3&gt;

&lt;p&gt;&lt;strong&gt;é€‰æ‹© NAS&lt;/strong&gt; -&amp;gt; &lt;strong&gt;å·²æœ‰å­˜å‚¨å·&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;é€‰æ‹©åˆšæ‰åˆ›å»ºçš„å­˜å‚¨å·&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://ws4.sinaimg.cn/large/ad5fbf65gy1g4shv5vs1kj20hx0bvt9g.jpg&#34; alt=&#34;image&#34; /&gt;&lt;/p&gt;

&lt;h3 id=&#34;ä½¿ç”¨pvc&#34;&gt;ä½¿ç”¨PVC&lt;/h3&gt;

&lt;p&gt;ä½¿ç”¨çš„æ–¹æ³•è¿™é‡Œå°±ä¸åšè¯¦ç»†ä»‹ç»äº†ï¼Œç›¸å…³æ–‡ç« ä¹Ÿæ¯”è¾ƒå¤šï¼Œè¿™é‡Œå°±åªè®°å½• Deployment ä¸­ä½¿ç”¨çš„ yaml ç‰‡æ®µï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-yaml&#34;&gt;...
volumeMounts:
- mountPath: /data      # æŒ‚è½½è·¯å¾„
    name: volume-nas-test
...
volumes:
- name: volume-nas-test
persistentVolumeClaim:
    claimName: nas-test     # PVC åç§°
...
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;ç»“è¯­&#34;&gt;ç»“è¯­&lt;/h2&gt;

&lt;p&gt;è¿™é‡Œåªæ˜¯åšä¸€ä¸ªç®€å•çš„è®°å½•ï¼Œä»…é€‚ç”¨äºé˜¿é‡Œäº‘ ACK å®¹å™¨æœåŠ¡ï¼ŒåŒæ—¶ä¹Ÿæ˜¯ ACK çš„ä¸€ä¸ªç®€å•åº”ç”¨ã€‚ç”±äºä¸ç»å¸¸å¯¹æ•°æ®å·è¿›è¡Œæ“ä½œï¼Œè¿™é‡Œåšç®€å•çš„è®°å½•ï¼Œé˜²æ­¢ä»¥åä½¿ç”¨è¿˜è¦å†çœ‹ä¸€éæ–‡æ¡£ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>ã€è½¬ã€‘Kubernetes å„¿ç«¥æ’å›¾æŒ‡å—</title>
      <link>https://guoxudong.io/en/post/the-childrens-illustrated-guide-to-kubernetes/</link>
      <pubDate>Fri, 05 Jul 2019 09:50:58 +0800</pubDate>
      
      <guid>https://guoxudong.io/en/post/the-childrens-illustrated-guide-to-kubernetes/</guid>
      <description>

&lt;blockquote&gt;
&lt;p&gt;è½¬è‡ªæ˜é‡‘ç¤¾åŒºï¼ŒåŸæ–‡åœ°å€ï¼š&lt;a href=&#34;https://juejin.im/post/5d1b2a656fb9a07edc0b7058&#34; target=&#34;_blank&#34;&gt;https://juejin.im/post/5d1b2a656fb9a07edc0b7058&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h2 id=&#34;kubernetes-å„¿ç«¥æ’å›¾æŒ‡å—&#34;&gt;Kubernetes å„¿ç«¥æ’å›¾æŒ‡å—&lt;/h2&gt;

&lt;p&gt;&lt;img src=&#34;https://ws4.sinaimg.cn/large/ad5fbf65gy1g4nwsdbr8wj20qo0hs0w2.jpg&#34; alt=&#34;&#34; /&gt;
&lt;img src=&#34;https://wx3.sinaimg.cn/large/ad5fbf65gy1g4nwt5keovj210u0shmyc.jpg&#34; alt=&#34;&#34; /&gt;
&lt;img src=&#34;https://wx4.sinaimg.cn/large/ad5fbf65gy1g4nwteb85hj20qo0hsk5v.jpg&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;çŒ®ç»™æ‰€æœ‰è¯•å›¾å‘å­©å­ä»¬è§£é‡Šè½¯ä»¶å·¥ç¨‹çš„å®¶é•¿ã€‚&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://ws1.sinaimg.cn/large/ad5fbf65gy1g4nwu2t40sj20qo0hswqv.jpg&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;

&lt;p&gt;å¾ˆä¹…å¾ˆä¹…ä»¥å‰ï¼Œæœ‰ä¸€ä¸ªå« Phippy çš„åº”ç”¨ç¨‹åºã€‚å¥¹æ˜¯ä¸€ä¸ªç®€å•çš„åº”ç”¨ç¨‹åºï¼Œç”± PHP ç¼–å†™ä¸”åªæœ‰ä¸€ä¸ªé¡µé¢ã€‚å¥¹ä½åœ¨ä¸€ä¸ªéœ€è¦å’Œå…¶ä»–å¯æ€•çš„åº”ç”¨ç¨‹åºåˆ†äº«ç¯å¢ƒçš„ä¸»æœºä¸­ï¼Œå¥¹ä¸è®¤è¯†è¿™äº›åº”ç”¨ç¨‹åºå¹¶ä¸”ä¸æ„¿æ„å’Œä»–ä»¬æ¥å¾€ã€‚å¥¹å¸Œæœ›å¥¹èƒ½æ‹¥æœ‰ä¸€ä¸ªå±äºè‡ªå·±çš„ç¯å¢ƒï¼šåªæœ‰å¥¹è‡ªå·±å’Œå¥¹å¯ä»¥ç§°ä¹‹ä¸ºå®¶çš„ Web æœåŠ¡å™¨ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://wx1.sinaimg.cn/large/ad5fbf65gy1g4nwutz6f2j20qo0hsq90.jpg&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;

&lt;p&gt;æ¯ä¸ªåº”ç”¨ç¨‹åºéƒ½æœ‰ä¸ªè¿è¡Œæ‰€ä¾èµ–çš„ç¯å¢ƒã€‚å¯¹äº PHP åº”ç”¨ç¨‹åºæ¥è¯´ï¼Œè¿™ä¸ªç¯å¢ƒå¯èƒ½åŒ…æ‹¬ Web æœåŠ¡å™¨ï¼Œä¸€ä¸ªå¯è¯»æ–‡ä»¶ç³»ç»Ÿå’Œ PHP å¼•æ“æœ¬èº«ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://wx2.sinaimg.cn/large/ad5fbf65gy1g4nwvduq0mj20qo0hsdu8.jpg&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;

&lt;p&gt;æœ‰ä¸€å¤©ï¼Œä¸€åªå–„è‰¯çš„é²¸é±¼å‡ºç°äº†ã€‚ä»–å»ºè®®å° Phippy ä½åœ¨å®¹å™¨é‡Œï¼Œè¿™æ ·å¯èƒ½ä¼šæ›´å¿«ä¹ã€‚æ‰€ä»¥åº”ç”¨ç¨‹åº Phippy è¿ç§»åˆ°äº†å®¹å™¨ä¸­ã€‚è¿™ä¸ªå®¹å™¨å¾ˆæ£’ï¼Œä½†æ˜¯â€¦â€¦å®ƒæœ‰ç‚¹åƒä¸€ä¸ªæ¼‚æµ®åœ¨å¤§æµ·ä¸­å¤®çš„è±ªåèµ·å±…å®¤ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://wx2.sinaimg.cn/large/ad5fbf65gy1g4nwwr0uk3j20qo0hs0zi.jpg&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;

&lt;p&gt;å®¹å™¨æä¾›äº†ä¸€ä¸ªç‹¬ç«‹çš„ç¯å¢ƒï¼Œåº”ç”¨ç¨‹åºå¯ä»¥åœ¨è¿™ä¸ªç¯å¢ƒä¸­è¿è¡Œã€‚ä½†æ˜¯è¿™äº›å­¤ç«‹çš„å®¹å™¨å¸¸å¸¸éœ€è¦è¢«ç®¡ç†å¹¶ä¸å¤–é¢çš„ä¸–ç•Œè¿æ¥ã€‚å¯¹äºå­¤ç«‹çš„å®¹å™¨è€Œè¨€ï¼Œå…±äº«æ–‡ä»¶ç³»ç»Ÿã€ç½‘ç»œé€šä¿¡ã€è°ƒåº¦ã€è´Ÿè½½å‡è¡¡å’Œåˆ†å‘éƒ½æ˜¯è¦é¢å¯¹çš„æŒ‘æˆ˜ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://wx4.sinaimg.cn/large/ad5fbf65gy1g4nwx3kj32j20qo0hswr7.jpg&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;

&lt;p&gt;é²¸é±¼è€¸äº†è€¸è‚©ã€‚â€œå¯¹ä¸èµ·ï¼Œå­©å­ã€‚â€ä»–è¯´ç€ï¼Œæ¶ˆå¤±åœ¨æµ·é¢ä¸‹ã€‚å°±åœ¨ Phippy ç”šè‡³å¼€å§‹ç»æœ›æ—¶ï¼Œä¸€ä½é©¾é©¶ç€å·¨è½®çš„èˆ¹é•¿å‡ºç°åœ¨æµ·å¹³çº¿ä¸Šã€‚è¿™è‰˜èˆ¹ç”±å‡ åä¸ªç»‘åœ¨ä¸€èµ·çš„æœ¨ç­ç»„æˆï¼Œä½†ä»å¤–é¢æ¥çœ‹ï¼Œå®ƒå°±åƒä¸€è‰˜å·¨è½®ã€‚
â€œä½ å¥½å‘€ï¼Œè¿™ä½ PHP åº”ç”¨ç¨‹åºæœ‹å‹ã€‚æˆ‘æ˜¯ Kube èˆ¹é•¿ã€‚â€ç¿æ™ºçš„è€èˆ¹é•¿è¯´ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://wx3.sinaimg.cn/large/ad5fbf65gy1g4nwxm9w44j20qo0hsn3b.jpg&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;

&lt;p&gt;â€œKubernetesâ€ åœ¨å¸Œè…Šè¯­ä¸­æ˜¯èˆ¹é•¿çš„æ„æ€ã€‚æˆ‘ä»¬å¯ä»¥ä»è¿™ä¸ªå•è¯ä¸­å¾—åˆ° Cybernetic å’Œ Gubernatorial è¿™ä¸¤ä¸ªè¯ç»„ã€‚Kubernetes é¡¹ç›®ä¸“æ³¨äºæ„å»ºä¸€ä¸ªå¥å£®çš„å¹³å°ï¼Œç”¨äºåœ¨ç”Ÿäº§ç¯å¢ƒä¸­è¿è¡Œæ•°åƒä¸ªå®¹å™¨ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://wx2.sinaimg.cn/large/ad5fbf65gy1g4nwxzqi7vj20qo0hsgxn.jpg&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;

&lt;p&gt;â€œæˆ‘æ˜¯ Phippyã€‚â€å°åº”ç”¨ç¨‹åºè¯´ã€‚&lt;/p&gt;

&lt;p&gt;â€œå¾ˆé«˜å…´è®¤è¯†ä½ ã€‚â€èˆ¹é•¿ä¸€è¾¹è¯´ï¼Œä¸€è¾¹åœ¨å¥¹èº«ä¸Šè´´ä¸Šäº†ä¸€å¼ æ ‡æœ‰å§“åçš„æ ‡ç­¾ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://wx3.sinaimg.cn/large/ad5fbf65gy1g4nwygks8xj20qo0hs0zy.jpg&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;

&lt;p&gt;Kubernetes ä½¿ç”¨æ ‡ç­¾ä½œä¸ºâ€œåç‰Œâ€æ¥æ ‡è¯†äº‹ç‰©ã€‚å®ƒå¯ä»¥æ ¹æ®è¿™äº›æ ‡ç­¾è¿›è¡ŒæŸ¥è¯¢ã€‚æ ‡ç­¾æ˜¯å¼€æ”¾æ€§çš„ï¼šä½ å¯ä»¥ç”¨ä»–ä»¬æ¥è¡¨ç¤ºè§’è‰²ã€ç¨³å®šæ€§æˆ–å…¶ä»–é‡è¦çš„å±æ€§ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://ws1.sinaimg.cn/large/ad5fbf65gy1g4nwyt7gtqj20qo0hsdso.jpg&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;

&lt;p&gt;èˆ¹é•¿å»ºè®®åº”ç”¨ç¨‹åºæŠŠå¥¹çš„å®¹å™¨æ¬åˆ°èˆ¹ä¸Šçš„ä¸€ä¸ªèˆ¹èˆ±ä¸­ã€‚Phippy å¾ˆé«˜å…´åœ°æŠŠå¥¹çš„å®¹å™¨æ¬åˆ° Kube èˆ¹é•¿å·¨è½®çš„èˆ¹èˆ±å†…ã€‚Phippy è§‰å¾—è¿™é‡Œåƒå®¶ä¸€æ ·ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://ws1.sinaimg.cn/large/ad5fbf65gy1g4nwzc5uqej20qo0hswlp.jpg&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;

&lt;p&gt;åœ¨ Kubernetes ä¸­ï¼ŒPod ä»£è¡¨ä¸€ä¸ªå¯è¿è¡Œçš„å·¥ä½œå•å…ƒã€‚é€šå¸¸ï¼Œä½ ä¼šåœ¨ Pod ä¸­è¿è¡Œä¸€ä¸ªå®¹å™¨ã€‚ä½†æ˜¯å¯¹äºä¸€äº›å®¹å™¨ç´§å¯†è€¦åˆçš„æƒ…å†µï¼Œä½ å¯ä»¥é€‰æ‹©åœ¨åŒä¸€ä¸ª Pod ä¸­è¿è¡Œå¤šä¸ªå®¹å™¨ã€‚Kubernetes è´Ÿè´£å°†ä½ çš„ Pod å’Œç½‘ç»œä»¥åŠ Kubernetes çš„å…¶ä½™ç¯å¢ƒç›¸è¿ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://wx2.sinaimg.cn/large/ad5fbf65gy1g4nwztzwfsj20qo0hsqdi.jpg&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;

&lt;p&gt;Phippy æœ‰ä¸€äº›ä¸åŒå¯»å¸¸çš„å…´è¶£ï¼Œå¥¹å¾ˆå–œæ¬¢é—ä¼ å­¦å’Œç»µç¾Šã€‚æ‰€ä»¥å¥¹é—®èˆ¹é•¿ï¼šâ€œå¦‚æœæˆ‘æƒ³å…‹éš†æˆ‘è‡ªå·±ï¼Œæ˜¯å¦å¯ä»¥æ ¹æ®éœ€æ±‚å…‹éš†ä»»æ„æ¬¡æ•°å‘¢ï¼Ÿâ€&lt;/p&gt;

&lt;p&gt;â€œè¿™å¾ˆå®¹æ˜“ã€‚â€èˆ¹é•¿è¯´ã€‚èˆ¹é•¿æŠŠ Phippy ä»‹ç»ç»™äº† Replication Controllerã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://ws4.sinaimg.cn/large/ad5fbf65gy1g4nx08r8toj20qo0hsdnl.jpg&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;

&lt;p&gt;Replication Controller æä¾›ä¸€ç§ç®¡ç†ä»»æ„æ•°é‡ Pod çš„æ–¹æ³•ã€‚ä¸€ä¸ª Replication Controller åŒ…å«ä¸€ä¸ª Pod æ¨¡æ¿ï¼Œè¯¥æ¨¡æ¿å¯ä»¥è¢«å¤åˆ¶ä»»æ„æ¬¡æ•°ã€‚é€šè¿‡ Replication Controllerï¼ŒKubernetes å°†ç®¡ç† Pod çš„ç”Ÿå‘½å‘¨æœŸï¼ŒåŒ…æ‹¬ä¼¸ç¼©ã€æ»šåŠ¨æ›´æ–°å’Œç›‘æ§ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://wx2.sinaimg.cn/large/ad5fbf65gy1g4nx0phj56j20qo0hsnb3.jpg&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;

&lt;p&gt;æ— æ•°ä¸ªæ—¥å¤œï¼Œå°åº”ç”¨ç¨‹åºåœ¨å¥¹çš„èˆ¹èˆ±ä¸­ä¸å¥¹çš„å¤åˆ¶å“ç›¸å¤„ååˆ†æ„‰å¿«ã€‚ä½†ä¸è‡ªå·±ä¸ºä¼å¹¶æ²¡æœ‰æ‰€è¯´çš„é‚£ä¹ˆå¥½â€¦â€¦å³ä½¿ä½ æ‹¥æœ‰ N ä¸ªè‡ªå·±çš„å…‹éš†ä½“ã€‚
Kube èˆ¹é•¿æ…ˆç¥¥åœ°ç¬‘äº†ç¬‘ï¼šâ€œæˆ‘æ­£å¥½æœ‰ä¸€æ ·ä¸œè¥¿ã€‚â€
ä»–åˆšå¼€å£ï¼Œåœ¨ Phippy çš„ Replication Controller å’Œèˆ¹çš„å…¶ä»–éƒ¨åˆ†ä¹‹é—´æ‰“å¼€äº†ä¸€æ¡éš§é“ã€‚Kube èˆ¹é•¿ç¬‘ç€è¯´ï¼šâ€œå³ä½¿ä½ çš„å¤åˆ¶å“æ¥äº†åˆå»ï¼Œè¿™æ¡éš§é“å§‹ç»ˆä¼šç•™åœ¨è¿™é‡Œï¼Œä½ å¯ä»¥é€šè¿‡å®ƒå‘ç°å…¶ä»– Podï¼Œå…¶ä»– Pod ä¹Ÿå¯ä»¥å‘ç°ä½ ï¼â€&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://ws2.sinaimg.cn/large/ad5fbf65gy1g4nx160hjkj20qo0hsjyp.jpg&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;

&lt;p&gt;æœåŠ¡å‘ŠçŸ¥ Kubernetes ç¯å¢ƒçš„å…¶ä½™éƒ¨åˆ†ï¼ˆåŒ…æ‹¬å…¶ä»– Pod å’Œ Replication Controllerï¼‰ä½ çš„åº”ç”¨ç¨‹åºåŒ…å«äº†å“ªäº›æœåŠ¡ï¼Œå½“ Pod æ¥æ¥å¾€å¾€ï¼ŒæœåŠ¡çš„ IP åœ°å€å’Œç«¯å£å§‹ç»ˆä¿æŒä¸å˜ã€‚å…¶ä»–åº”ç”¨ç¨‹åºå¯ä»¥é€šè¿‡ Kurbenetes æœåŠ¡å‘ç°æ‰¾åˆ°ä½ çš„æœåŠ¡ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://wx2.sinaimg.cn/large/ad5fbf65gy1g4nx1kbahcj20qo0hsk2e.jpg&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;

&lt;p&gt;å¤šäºäº†è¿™äº›æœåŠ¡ï¼ŒPhippy å¼€å§‹æ¢ç´¢èˆ¹çš„å…¶ä»–éƒ¨åˆ†ã€‚ä¸ä¹…ä¹‹åï¼ŒPhippy é‡åˆ°äº† Goldieã€‚ä»–ä»¬æˆäº†æœ€å¥½çš„æœ‹å‹ã€‚æœ‰ä¸€å¤©ï¼ŒGoldie åšäº†ä¸€ä»¶ä¸åŒå¯»å¸¸çš„äº‹ã€‚å¥¹é€ç»™ Phippy ä¸€ä»¶ç¤¼ç‰©ã€‚Phippy çœ‹äº†ç¤¼ç‰©ä¸€çœ¼ï¼Œæ‚²ä¼¤çš„æ³ªæ°´å¤ºçœ¶è€Œå‡ºã€‚
â€œä½ ä¸ºä»€ä¹ˆè¿™ä¹ˆä¼¤å¿ƒå‘¢ï¼Ÿâ€Goldie é—®é“ã€‚
â€œæˆ‘å–œæ¬¢è¿™ä¸ªç¤¼ç‰©ï¼Œä½†æˆ‘æ²¡æœ‰åœ°æ–¹å¯ä»¥æ”¾å®ƒï¼â€Phippy æŠ½å™é“ã€‚
ä½† Goldie çŸ¥é“è¯¥æ€ä¹ˆåšã€‚â€œä¸ºä»€ä¹ˆä¸æŠŠå®ƒæ”¾å…¥å·ä¸­å‘¢ï¼Ÿâ€&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://ws4.sinaimg.cn/large/ad5fbf65gy1g4nx2ibi95j20qo0hsdnp.jpg&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;

&lt;p&gt;å·è¡¨ç¤ºå®¹å™¨å¯ä»¥è®¿é—®å’Œå­˜å‚¨ä¿¡æ¯çš„ä½ç½®ã€‚å¯¹äºåº”ç”¨ç¨‹åºï¼Œå·æ˜¾ç¤ºä¸ºæœ¬åœ°æ–‡ä»¶ç³»ç»Ÿçš„ä¸€éƒ¨åˆ†ã€‚ä½†å·å¯ä»¥ç”±æœ¬åœ°å­˜å‚¨ã€Cephã€Glusterã€æŒä¹…æ€§å—å­˜å‚¨ï¼Œä»¥åŠå…¶ä»–å­˜å‚¨åç«¯æ”¯æŒã€‚
Phippy å–œæ¬¢åœ¨ Kube èˆ¹é•¿çš„èˆ¹ä¸Šç”Ÿæ´»ï¼Œå¥¹å¾ˆäº«å—æ¥è‡ªæ–°æœ‹å‹çš„é™ªä¼´ï¼ˆGoldie çš„æ¯ä¸ªå…‹éš†äººéƒ½åŒæ ·ä»¤äººæ„‰æ‚¦ï¼‰ã€‚ä½†æ˜¯ï¼Œå½“å¥¹å›æƒ³èµ·åœ¨å¯æ€•çš„ä¸»æœºåº¦è¿‡çš„æ—¥å­ï¼Œå¥¹æƒ³çŸ¥é“å¥¹æ˜¯å¦ä¹Ÿå¯ä»¥æ‹¥æœ‰ä¸€ç‚¹è‡ªå·±çš„éšç§ã€‚
â€œè¿™å¬èµ·æ¥åƒæ˜¯ä½ æ‰€éœ€è¦çš„ï¼Œâ€Kube èˆ¹é•¿è¯´ï¼Œâ€œè¿™æ˜¯ä¸€ä¸ªå‘½åç©ºé—´ã€‚â€&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://ws2.sinaimg.cn/large/ad5fbf65gy1g4nx2nyz4uj20qo0hs10l.jpg&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;

&lt;p&gt;å‘½åç©ºé—´æ˜¯ Kubernetes å†…éƒ¨çš„åˆ†ç»„æœºåˆ¶ã€‚æœåŠ¡ã€Podã€Replication Controller å’Œå·å¯ä»¥åœ¨å‘½åç©ºé—´å†…éƒ¨è½»æ¾åä½œï¼Œä½†å‘½åç©ºé—´æä¾›äº†ä¸é›†ç¾¤å…¶ä»–éƒ¨åˆ†ä¸€å®šç¨‹åº¦çš„éš”ç¦»ã€‚
Phippy ä¸å¥¹çš„æ–°æœ‹å‹ä¸€èµ·ä¹˜å Kube èˆ¹é•¿çš„å·¨è½®èˆªè¡Œäºå¤§æµ·ä¹‹ä¸Šã€‚å¥¹ç»å†äº†è®¸å¤šä¼Ÿå¤§çš„å†’é™©ï¼Œä½†æœ€é‡è¦çš„æ˜¯ï¼ŒPhippy æ‰¾åˆ°äº†è‡ªå·±çš„å®¶ã€‚
æ‰€ä»¥ Phippy ä»æ­¤è¿‡ä¸Šäº†å¹¸ç¦çš„ç”Ÿæ´»ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://ws2.sinaimg.cn/large/ad5fbf65gy1g4nx34vepkj21120shwek.jpg&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>ç”±ä¸€å°é‚®ä»¶çœ‹ Mailing List åœ¨å¼€æºé¡¹ç›®ä¸­çš„é‡è¦æ€§</title>
      <link>https://guoxudong.io/en/post/kubernetes-client-python/</link>
      <pubDate>Thu, 04 Jul 2019 09:16:41 +0800</pubDate>
      
      <guid>https://guoxudong.io/en/post/kubernetes-client-python/</guid>
      <description>

&lt;blockquote&gt;
&lt;p&gt;åªè¦ä»”ç»†æ‰¾ï¼Œæƒ³è¦çš„è½®å­æ€»ä¼šæœ‰çš„ã€‚
&amp;mdash; æŸä¸çŸ¥å DevOps å·¥ç¨‹å¸ˆ&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;æ„Ÿè°¢ &lt;code&gt;kubernetes-dev&lt;/code&gt; çš„ Mailing List ï¼æ—©ä¸Šåœ¨æµè§ˆé‚®ä»¶æ—¶å‘ç°äº†ä¸‹é¢è¿™å°æœ‰è¶£çš„é‚®ä»¶ï¼š&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://wx3.sinaimg.cn/large/ad5fbf65gy1g4nkmrb8scj21780q0afv.jpg&#34; alt=&#34;image&#34; /&gt;&lt;/p&gt;

&lt;p&gt;æ¥è§¦ Kubernetes ä¹Ÿæœ‰ä¸çŸ­çš„æ—¶é—´äº†ï¼Œä¹Ÿè§è¯äº† Kubernetes å¹²æ‰ Swarm å’Œ Mesos æˆä¸ºå®¹å™¨ç¼–æ’é¢†åŸŸçš„äº‹å®æ ‡å‡†çš„è¿‡ç¨‹ã€‚åœ¨äº«å— Kubernetes åŠå…¶ç”Ÿæ€åœˆå¸¦æ¥çš„ä¾¿åˆ©çš„åŒæ—¶ä¹Ÿåœ¨ä¸º Kubernetes åŠ CNCF é¡¹ç›®è¿›è¡Œè´¡çŒ®ã€‚è€Œä½¿ç”¨ &lt;a href=&#34;https://github.com/kubernetes/kubectl&#34; target=&#34;_blank&#34;&gt;&lt;code&gt;kubectl&lt;/code&gt;&lt;/a&gt;ã€&lt;a href=&#34;https://github.com/rancher/rancher&#34; target=&#34;_blank&#34;&gt;&lt;code&gt;rancher&lt;/code&gt;&lt;/a&gt; ç”šè‡³æ˜¯ &lt;a href=&#34;https://github.com/IBM/kui&#34; target=&#34;_blank&#34;&gt;&lt;code&gt;kui&lt;/code&gt;&lt;/a&gt; è¿™äº› CLI å’Œ UI å·¥å…·å¯¹ Kubernetes é›†ç¾¤è¿›è¡Œæ“ä½œå’Œè§‚å¯Ÿã€‚&lt;/p&gt;

&lt;p&gt;è™½ç„¶ä¸Šé¢è¿™äº›å·¥å…·ä¸ºæ“ä½œ Kubernetes é›†ç¾¤å¸¦æ¥äº†æå¤§çš„ä¾¿åˆ©ï¼Œä½†æ˜¯å½’æ ¹åˆ°åº•è¿˜æ˜¯ä¸€äº›å¼€æºé¡¹ç›®ï¼Œå¹¶ä¸èƒ½æ»¡è¶³æˆ‘ä»¬çš„å…¨éƒ¨éœ€æ±‚ã€‚æ‰€ä»¥æˆ‘ä»¬åªèƒ½æ ¹æ®æˆ‘ä»¬è‡ªå·±çš„éœ€æ±‚å’Œ Kubernetes çš„ api-server è¿›è¡Œå®šåˆ¶ï¼Œä½†æ˜¯ç”±äº Kubernetes çš„ api-server æ¯”è¾ƒå¤æ‚ï¼ŒçŸ­æ—¶é—´å†…å¹¶ä¸æ˜¯é‚£ä¹ˆå¥½æ¢³ç†çš„ã€‚&lt;/p&gt;

&lt;h2 id=&#34;kubernetes-client-python&#34;&gt;kubernetes-client/python&lt;/h2&gt;

&lt;p&gt;ç”±äºæˆ‘ä»¬è‡ªç ”çš„ DevOps å¹³å°æ˜¯ä½¿ç”¨ python å¼€å‘çš„ï¼Œæ‰€ä»¥æˆ‘ä¹ŸåŸºäº python è¯­è¨€å¼€å‘äº†ä¸€å¥— Kubernetes Client ï¼Œä½†æ€»çš„æ¥è¯´ç”±äº Kubernetes çš„åŠŸèƒ½å®åœ¨å¤ªå¤šï¼Œè€Œæˆ‘çš„å¼€å‘å®è·µå¹¶ä¸æ˜¯å¾ˆå¤šï¼Œå¼€å‘å‡ºæ¥çš„åŠŸèƒ½åªæ˜¯å·®å¼ºäººæ„ã€‚&lt;/p&gt;

&lt;p&gt;è€Œ &lt;a href=&#34;https://github.com/kubernetes-client/python&#34; target=&#34;_blank&#34;&gt;&lt;code&gt;kubernetes-client/python&lt;/code&gt;&lt;/a&gt; è¿™ä¸ªå®˜æ–¹ç»™å‡ºçš„è½®å­æ˜¯çœŸçš„é¦™ï¼&lt;/p&gt;

&lt;h3 id=&#34;å®‰è£…æ–¹ä¾¿&#34;&gt;å®‰è£…æ–¹ä¾¿&lt;/h3&gt;

&lt;p&gt;è¿™ä¸ªå®‰è£…æ–¹å¼ç®€å•çš„ä»¤äººå‘æŒ‡ï¼Œæ”¯æŒçš„ python ç‰ˆæœ¬ä¸º &lt;code&gt;2.7 | 3.4 | 3.5 | 3.6 | 3.7&lt;/code&gt; å¹¶ä¸”å’Œæ‰€æœ‰ python ä¾èµ–åŒ…ä¸€æ ·ï¼Œåªéœ€è¦ä½¿ç”¨ &lt;code&gt;pip&lt;/code&gt; å®‰è£…å³å¯ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;pip install kubernetes
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;ç®€å•ç¤ºä¾‹&#34;&gt;ç®€å•ç¤ºä¾‹&lt;/h3&gt;

&lt;p&gt;æŸ¥çœ‹æ‰€æœ‰çš„ pod ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;#!/usr/bin/env python
#encoding: utf-8
#Author: guoxudong
from kubernetes import client, config

# Configs can be set in Configuration class directly or using helper utility
config.load_kube_config()

v1 = client.CoreV1Api()
print(&amp;quot;Listing pods with their IPs:&amp;quot;)
ret = v1.list_pod_for_all_namespaces(watch=False)
for i in ret.items:
    print(&amp;quot;%s\t%s\t%s&amp;quot; % (i.status.pod_ip, i.metadata.namespace, i.metadata.name))
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;è¿è¡ŒæŸ¥çœ‹ç»“æœï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-python&#34;&gt;Listing pods with their IPs:
172.22.1.126	kube-system	coredns-5975fdf55b-bqgkx
172.22.0.2	kube-system	coredns-5975fdf55b-vxbb4
10.16.16.13	kube-system	flexvolume-9ccf7
10.16.16.15	kube-system	flexvolume-h5xn2
10.16.16.14	kube-system	flexvolume-kvn5x
10.16.16.17	kube-system	flexvolume-mf4zv
10.16.16.14	kube-system	kube-proxy-worker-7lpfz
10.16.16.15	kube-system	kube-proxy-worker-9wd9s
10.16.16.17	kube-system	kube-proxy-worker-phbbj
10.16.16.13	kube-system	kube-proxy-worker-pst5d
172.22.1.9	kube-system	metrics-server-78b597d5bf-wdvqh
172.22.1.12	kube-system	nginx-ingress-controller-796ccc5d76-9jh5s
172.22.1.125	kube-system	nginx-ingress-controller-796ccc5d76-jwwwz
10.16.16.17	kube-system	terway-6mfs8
10.16.16.14	kube-system	terway-fz9ck
10.16.16.13	kube-system	terway-t9777
10.16.16.15	kube-system	terway-xbxlp
172.22.1.8	kube-system	tiller-deploy-5b5d8dd754-wpcrc
...
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;æœç„¶æ˜¯ä¸€ä¸ªå¥½è½®å­ï¼Œå¼•å…¥ kubeconfig çš„æ–¹å¼åŠå±•ç¤ºæ‰€æœ‰ namespace çš„ pod çš„æ–¹æ³•å°è£…çš„ä¹Ÿååˆ†ç®€æ´ï¼Œæ˜¯ä¸ªéå¸¸æ¼‚äº®çš„èŒƒä¾‹ã€‚å»ºè®®å¯ä»¥çœ‹ä¸€ä¸‹&lt;a href=&#34;https://github.com/kubernetes-client/python&#34; target=&#34;_blank&#34;&gt;æºç &lt;/a&gt;ï¼Œè‚¯å®šä¼šæœ‰æ”¶è·çš„ï¼&lt;/p&gt;

&lt;h3 id=&#34;æ”¯æŒç‰ˆæœ¬&#34;&gt;æ”¯æŒç‰ˆæœ¬&lt;/h3&gt;

&lt;p&gt;&lt;code&gt;client-python&lt;/code&gt; éµå¾ª &lt;a href=&#34;https://semver.org/lang/zh-CN/&#34; target=&#34;_blank&#34;&gt;semver&lt;/a&gt; è§„èŒƒï¼Œæ‰€ä»¥åœ¨ &lt;code&gt;client-python&lt;/code&gt; çš„ä¸»è¦ç‰ˆæœ¬å¢åŠ ä¹‹å‰ï¼Œä»£ç å°†ç»§ç»­ä½¿ç”¨æ˜ç¡®æ”¯æŒçš„ Kubernetes é›†ç¾¤ç‰ˆæœ¬ã€‚&lt;/p&gt;

&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;/th&gt;
&lt;th&gt;Kubernetes 1.5&lt;/th&gt;
&lt;th&gt;Kubernetes 1.6&lt;/th&gt;
&lt;th&gt;Kubernetes 1.7&lt;/th&gt;
&lt;th&gt;Kubernetes 1.8&lt;/th&gt;
&lt;th&gt;Kubernetes 1.9&lt;/th&gt;
&lt;th&gt;Kubernetes 1.10&lt;/th&gt;
&lt;th&gt;Kubernetes 1.11&lt;/th&gt;
&lt;th&gt;Kubernetes 1.12&lt;/th&gt;
&lt;th&gt;Kubernetes 1.13&lt;/th&gt;
&lt;th&gt;Kubernetes 1.14&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;

&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;client-python 1.0&lt;/td&gt;
&lt;td&gt;âœ“&lt;/td&gt;
&lt;td&gt;-&lt;/td&gt;
&lt;td&gt;-&lt;/td&gt;
&lt;td&gt;-&lt;/td&gt;
&lt;td&gt;-&lt;/td&gt;
&lt;td&gt;-&lt;/td&gt;
&lt;td&gt;-&lt;/td&gt;
&lt;td&gt;-&lt;/td&gt;
&lt;td&gt;-&lt;/td&gt;
&lt;td&gt;-&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;client-python 2.0&lt;/td&gt;
&lt;td&gt;+&lt;/td&gt;
&lt;td&gt;âœ“&lt;/td&gt;
&lt;td&gt;-&lt;/td&gt;
&lt;td&gt;-&lt;/td&gt;
&lt;td&gt;-&lt;/td&gt;
&lt;td&gt;-&lt;/td&gt;
&lt;td&gt;-&lt;/td&gt;
&lt;td&gt;-&lt;/td&gt;
&lt;td&gt;-&lt;/td&gt;
&lt;td&gt;-&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;client-python 3.0&lt;/td&gt;
&lt;td&gt;+&lt;/td&gt;
&lt;td&gt;+&lt;/td&gt;
&lt;td&gt;âœ“&lt;/td&gt;
&lt;td&gt;-&lt;/td&gt;
&lt;td&gt;-&lt;/td&gt;
&lt;td&gt;-&lt;/td&gt;
&lt;td&gt;-&lt;/td&gt;
&lt;td&gt;-&lt;/td&gt;
&lt;td&gt;-&lt;/td&gt;
&lt;td&gt;-&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;client-python 4.0&lt;/td&gt;
&lt;td&gt;+&lt;/td&gt;
&lt;td&gt;+&lt;/td&gt;
&lt;td&gt;+&lt;/td&gt;
&lt;td&gt;âœ“&lt;/td&gt;
&lt;td&gt;-&lt;/td&gt;
&lt;td&gt;-&lt;/td&gt;
&lt;td&gt;-&lt;/td&gt;
&lt;td&gt;-&lt;/td&gt;
&lt;td&gt;-&lt;/td&gt;
&lt;td&gt;-&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;client-python 5.0&lt;/td&gt;
&lt;td&gt;+&lt;/td&gt;
&lt;td&gt;+&lt;/td&gt;
&lt;td&gt;+&lt;/td&gt;
&lt;td&gt;+&lt;/td&gt;
&lt;td&gt;âœ“&lt;/td&gt;
&lt;td&gt;-&lt;/td&gt;
&lt;td&gt;-&lt;/td&gt;
&lt;td&gt;-&lt;/td&gt;
&lt;td&gt;-&lt;/td&gt;
&lt;td&gt;-&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;client-python 6.0&lt;/td&gt;
&lt;td&gt;+&lt;/td&gt;
&lt;td&gt;+&lt;/td&gt;
&lt;td&gt;+&lt;/td&gt;
&lt;td&gt;+&lt;/td&gt;
&lt;td&gt;+&lt;/td&gt;
&lt;td&gt;âœ“&lt;/td&gt;
&lt;td&gt;-&lt;/td&gt;
&lt;td&gt;-&lt;/td&gt;
&lt;td&gt;-&lt;/td&gt;
&lt;td&gt;-&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;client-python 7.0&lt;/td&gt;
&lt;td&gt;+&lt;/td&gt;
&lt;td&gt;+&lt;/td&gt;
&lt;td&gt;+&lt;/td&gt;
&lt;td&gt;+&lt;/td&gt;
&lt;td&gt;+&lt;/td&gt;
&lt;td&gt;+&lt;/td&gt;
&lt;td&gt;âœ“&lt;/td&gt;
&lt;td&gt;-&lt;/td&gt;
&lt;td&gt;-&lt;/td&gt;
&lt;td&gt;-&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;client-python 8.0&lt;/td&gt;
&lt;td&gt;+&lt;/td&gt;
&lt;td&gt;+&lt;/td&gt;
&lt;td&gt;+&lt;/td&gt;
&lt;td&gt;+&lt;/td&gt;
&lt;td&gt;+&lt;/td&gt;
&lt;td&gt;+&lt;/td&gt;
&lt;td&gt;+&lt;/td&gt;
&lt;td&gt;âœ“&lt;/td&gt;
&lt;td&gt;-&lt;/td&gt;
&lt;td&gt;-&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;client-python 9.0&lt;/td&gt;
&lt;td&gt;+&lt;/td&gt;
&lt;td&gt;+&lt;/td&gt;
&lt;td&gt;+&lt;/td&gt;
&lt;td&gt;+&lt;/td&gt;
&lt;td&gt;+&lt;/td&gt;
&lt;td&gt;+&lt;/td&gt;
&lt;td&gt;+&lt;/td&gt;
&lt;td&gt;+&lt;/td&gt;
&lt;td&gt;âœ“&lt;/td&gt;
&lt;td&gt;-&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;client-python 10.0&lt;/td&gt;
&lt;td&gt;+&lt;/td&gt;
&lt;td&gt;+&lt;/td&gt;
&lt;td&gt;+&lt;/td&gt;
&lt;td&gt;+&lt;/td&gt;
&lt;td&gt;+&lt;/td&gt;
&lt;td&gt;+&lt;/td&gt;
&lt;td&gt;+&lt;/td&gt;
&lt;td&gt;+&lt;/td&gt;
&lt;td&gt;+&lt;/td&gt;
&lt;td&gt;âœ“&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;client-python HEAD&lt;/td&gt;
&lt;td&gt;+&lt;/td&gt;
&lt;td&gt;+&lt;/td&gt;
&lt;td&gt;+&lt;/td&gt;
&lt;td&gt;+&lt;/td&gt;
&lt;td&gt;+&lt;/td&gt;
&lt;td&gt;+&lt;/td&gt;
&lt;td&gt;+&lt;/td&gt;
&lt;td&gt;+&lt;/td&gt;
&lt;td&gt;+&lt;/td&gt;
&lt;td&gt;âœ“&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

&lt;h2 id=&#34;mailing-list-çš„é‡è¦æ€§&#34;&gt;Mailing List çš„é‡è¦æ€§&lt;/h2&gt;

&lt;p&gt;è¿™æ¬¡çš„æ”¶è·å¾ˆå¤§ç¨‹åº¦å¾—ç›Šäº &lt;code&gt;kubernetes-dev&lt;/code&gt; çš„ Mailing List ä¹Ÿå°±æ˜¯é‚®ä»¶åˆ—è¡¨ã€‚è¿™ç§æ²Ÿé€šæ–¹å¼åœ¨å›½å†…ä¸æ˜¯å¾ˆæµè¡Œï¼Œå¤§å®¶æ›´å–œæ¬¢ä½¿ç”¨ QQ å’Œå¾®ä¿¡è¿™æ ·çš„å³æ—¶é€šè®¯è½¯ä»¶è¿›è¡Œäº¤æµï¼Œä½†æ˜¯å¤§å¤šæ•°è‘—åå¼€æºé¡¹ç›®éƒ½æ˜¯ä¸»è¦ä½¿ç”¨ &lt;strong&gt;Mailing List&lt;/strong&gt; è¿›è¡Œäº¤æµï¼Œäº¤æµçš„æ•°é‡ç”šè‡³æ¯”åœ¨ GitHub issue ä¸­è¿˜å¤šï¼Œåœ¨ä¸ Apache ã€ CNCF é¡¹ç›®å¼€æºçš„è´¡çŒ®è€…å’Œç»´æŠ¤è€…äº¤æµä¸­å¾—çŸ¥äº†ä½¿ç”¨ &lt;strong&gt;Mailing List&lt;/strong&gt; ä¸»è¦è€ƒè™‘æ˜¯ä¸€ä¸‹å‡ ç‚¹ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;è¿™ç§å¼‚æ­¥çš„äº¤æµæ–¹å¼å¯ä»¥è®©æ›´å¤šå…³å¿ƒè¯¥è¯é¢˜çš„å¼€å‘äººå‘˜ä¸€èµ·åŠ å…¥åˆ°è®¨è®ºä¸­ã€‚&lt;/li&gt;
&lt;li&gt;mailing list æ˜¯æ°¸ä¹…ä¿ç•™çš„ï¼Œå¦‚æœä½ å¯¹æŸä¸ªè¯é¢˜æ„Ÿå…´è¶£ï¼Œå¯ä»¥éšæ—¶å›å¤é‚®ä»¶ï¼Œå…³æ³¨è¿™ä¸ªè¯é¢˜çš„å¼€å‘è€…éƒ½ä¼šæ”¶åˆ°é‚®ä»¶ï¼Œæ— è®ºè¿™ä¸ªè¯é¢˜æ˜¯æ˜¨å¤©æå‡ºçš„ï¼Œè¿˜æ˜¯å»å¹´æå‡ºçš„ï¼Œæœ‰åŠ©äºè§£å†³ä¸€äº›é™ˆå¹´è€ BUG ï¼ˆä¿—ç§°æŠ€æœ¯å€ºï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;å³æ—¶é€šè®¯è½¯ä»¶è™½ç„¶å¾ˆä¾¿åˆ©ï¼Œä½†æ˜¯é—®é¢˜å¾ˆå¿«ä¼šè¢«è¯„è®ºé¡¶æ‰ï¼Œè™½ç„¶è¯¸å¦‚ slack è¿™æ ·çš„å·¥å…·è§£å†³äº†éƒ¨åˆ†è¿™æ–¹é¢çš„é—®é¢˜ï¼Œä½†æ˜¯è¿˜æ˜¯ä¸å¦‚ mailing list å¥½ç”¨ã€‚&lt;/li&gt;
&lt;li&gt;å¹¶ä¸æ˜¯æ‰€æœ‰åœ°åŒºçš„å¼€å‘è€…éƒ½æœ‰é«˜é€Ÿçš„å®½å¸¦ï¼Œæ€§èƒ½ä¼˜ç§€çš„PCï¼Œåœ¨åœ°çƒä¸Šå¾ˆå¤šåœ°åŒºè¿˜æ˜¯åªèƒ½ä½¿ç”¨æ‹¨å·ä¸Šç½‘ï¼Œç½‘é€Ÿåªæœ‰å‡ kb/sï¼Œä»–ä»¬ç”šè‡³ GitHub issue éƒ½æ— æ³•ä½¿ç”¨ã€‚ä½†æ˜¯ä½ ä¸èƒ½å‰¥å¤ºä»–ä»¬å‚ä¸å¼€æºé¡¹ç›®çš„æƒåˆ©ï¼Œè€Œ mailing list æ˜¯ä¸€ç§å¾ˆå¥½çš„äº¤æµæ–¹å¼ã€‚&lt;/li&gt;
&lt;li&gt;é€šè¿‡ mailing list å¯ä»¥å¾ˆå¥½æŒæ¡ç¤¾åŒºåŠ¨æ€ï¼Œæ•ˆæœæ˜æ˜¾å¥½äº GitHub watch ï¼Œå› ä¸ºå¹¶ä¸æ˜¯é¡¹ç›®çš„æ‰€æœ‰ commit éƒ½æ˜¯ä½ å…³å¿ƒçš„ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;ç»“è¯­&#34;&gt;ç»“è¯­&lt;/h2&gt;

&lt;p&gt;å¦‚æœä½ æœ‰å¿—äºå‚ä¸åˆ°å¼€æºè¿åŠ¨ï¼Œåœ¨äº«å—å¼€æºè½¯ä»¶å¸¦æ¥ä¾¿åˆ©çš„åŒäº‹ï¼Œè¿˜æƒ³ä¸ºå¼€æºè½¯ä»¶åšå‡ºè‡ªå·±çš„è´¡çŒ®ï¼Œé‚£ä¹ˆ mailing list æ˜¯ä½ è¿›å…¥ç¤¾åŒºæœ€å¥½çš„é€‰æ‹©ã€‚åœ¨ mailing list ä¸­å’Œæ¥è‡ªä¸–ç•Œå„åœ°å¿—åŒé“åˆçš„å¼€å‘è€…äº¤æµä¸­æå‡è‡ªå·±çš„èƒ½åŠ›ï¼Œåˆ›é€ æ›´å¤§çš„ä»·å€¼ï¼Œè¿ˆå‡ºä½ å‚ä¸å¼€æºè¿åŠ¨çš„ç¬¬ä¸€æ­¥ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>ä½¿ç”¨ Kustomize å¸®ä½ ç®¡ç† kubernetes åº”ç”¨ï¼ˆäº”ï¼‰ï¼šé…åˆ kubedog å®Œå–„ CI/CD çš„æœ€åä¸€æ­¥</title>
      <link>https://guoxudong.io/en/post/kustomize-5/</link>
      <pubDate>Wed, 03 Jul 2019 15:20:31 +0800</pubDate>
      
      <guid>https://guoxudong.io/en/post/kustomize-5/</guid>
      <description>

&lt;blockquote&gt;
&lt;p&gt;åœ¨ä»¥å¾€çš„ pipeline ä¸­ï¼Œä½¿ç”¨ kubectl è¿›è¡Œéƒ¨ç½² Deployment åæ— æ³•æ£€æŸ¥ Deployment æ˜¯å¦éƒ¨ç½²æˆåŠŸï¼Œåªèƒ½é€šè¿‡ä½¿ç”¨å‘½ä»¤/è„šæœ¬æ¥æ‰‹åŠ¨æ£€æŸ¥ Deployment çŠ¶æ€ï¼Œè€Œ kubedog è¿™ä¸ªå°å·¥å…·å®Œç¾è§£å†³äº†è¿™ä¸ªé—®é¢˜ï¼Œå®Œå–„äº† CI/CD æµæ°´çº¿çš„æœ€åä¸€æ­¥ã€‚&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h2 id=&#34;kubedog&#34;&gt;KubeDog&lt;/h2&gt;

&lt;p&gt;kubedog æ˜¯ä¸€ä¸ª lib åº“å’Œ CLI å°å·¥å…·ï¼Œå…è®¸åœ¨ CI/CD éƒ¨ç½² pipeline ä¸­è§‚å¯Ÿå’Œè·Ÿè¸ª Kubernetes èµ„æºã€‚ä¸ kustomize é…åˆï¼Œé›†æˆåˆ° pipeline ä¹‹åï¼Œå®Œç¾çš„è§£å†³äº† CI/CD çš„æœ€åä¸€æ­¥ï¼Œå®Œç¾çš„æ›¿ä»£äº†ä¹‹å‰ä¸å¤Ÿçµæ´»çš„è„šæœ¬ï¼ˆå¥½å§ï¼Œå…¶å®æˆ‘ä¹Ÿå¼€å‘äº†ç±»ä¼¼çš„å°å·¥å…·ï¼Œä½†æ˜¯æœ‰è¿™ä¹ˆå¥½ç”¨çš„è½®å­ï¼Œæ‹¿æ¥ç›´æ¥ç”¨ä½•ä¹è€Œä¸ä¸ºå‘¢ï¼Ÿï¼‰ã€‚&lt;/p&gt;

&lt;p&gt;kubedog æä¾›äº† lib åº“å’Œ CLI å°å·¥å…·ï¼Œè¿™é‡Œç”±äºæ˜¯ä»‹ç» CI/CD ä¸­çš„å®è·µï¼Œæ‰€ä»¥åªä»‹ç»å…¶ä¸­çš„ &lt;code&gt;rollout track&lt;/code&gt; åŠŸèƒ½ã€‚ lib åº“çš„ä½¿ç”¨å’Œ CLI çš„ &lt;code&gt;follow&lt;/code&gt; åŠŸèƒ½è¿™é‡Œå°±ä¸åšä»‹ç»äº†ï¼Œæœ‰å…´è¶£çš„åŒå­¦å¯ä»¥å» &lt;a href=&#34;https://github.com/flant/kubedog&#34; target=&#34;_blank&#34;&gt;GitHub&lt;/a&gt; ä¸ŠæŸ¥çœ‹è¯¥é¡¹ç›®çš„å„ç§ä½¿ç”¨æ–¹å¼ã€‚&lt;/p&gt;

&lt;h3 id=&#34;é›†æˆ-kubedog&#34;&gt;é›†æˆ KubeDog&lt;/h3&gt;

&lt;p&gt;ç”±äºæˆ‘å¸ç›®å‰ä½¿ç”¨çš„æ˜¯ &lt;a href=&#34;https://drone.io/&#34; target=&#34;_blank&#34;&gt;drone&lt;/a&gt; è¿›è¡Œ CI ï¼Œæ¯ä¸ª step éƒ½æ˜¯ç”±ä¸€ä¸ª docker åˆ¶ä½œçš„æ’ä»¶ç»„æˆã€‚æˆ‘åˆ¶ä½œäº†ä¸€ä¸ªåŒ…å« &lt;code&gt;kubectl&lt;/code&gt; ã€ &lt;code&gt;kustomize&lt;/code&gt; å’Œ &lt;code&gt;kubedog&lt;/code&gt; çš„é•œåƒã€‚è¯¥é•œåƒå·²ä¸Šä¼  dockerhub ï¼Œéœ€è¦çš„å¯ä»¥è‡ªè¡Œæ‹‰å–ä½¿ç”¨ &lt;code&gt;guoxudongdocker/kubectl&lt;/code&gt; ,è€Œè¯¥æ’ä»¶çš„ä½¿ç”¨ä¹Ÿåœ¨ &lt;a href=&#34;https://github.com/sunny0826/kubectl-kustomize&#34; target=&#34;_blank&#34;&gt;GitHub&lt;/a&gt; å’Œ &lt;a href=&#34;https://cloud.docker.com/u/guoxudongdocker/repository/docker/guoxudongdocker/kubectl&#34; target=&#34;_blank&#34;&gt;DockerHub&lt;/a&gt; ä¸ŠæŸ¥çœ‹ã€‚&lt;/p&gt;

&lt;p&gt;è€Œé›†æˆæ–¹å¼ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œç›´æ¥å°† &lt;code&gt;kubectl&lt;/code&gt; ã€ &lt;code&gt;kustomize&lt;/code&gt; å’Œ &lt;code&gt;kubedog&lt;/code&gt; çš„å¯æ‰§è¡ŒåŒ…ä¸‹è½½åˆ° &lt;code&gt;/usr/local/bin&lt;/code&gt; å¹¶èµ‹äºˆæ‰§è¡Œæƒé™å³å¯ï¼Œä¸‹é¢å°±æ˜¯ &lt;code&gt;Dockerfile&lt;/code&gt; æ–‡ä»¶ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-dockerfile&#34;&gt;FROM alpine

LABEL maintainer=&amp;quot;sunnydog0826@gmail.com&amp;quot;

ENV KUBE_LATEST_VERSION=&amp;quot;v1.14.1&amp;quot;

RUN apk add --update ca-certificates \
 &amp;amp;&amp;amp; apk add --update -t deps curl \
 &amp;amp;&amp;amp; curl -L https://storage.googleapis.com/kubernetes-release/release/${KUBE_LATEST_VERSION}/bin/linux/amd64/kubectl -o /usr/local/bin/kubectl \
 &amp;amp;&amp;amp; chmod +x /usr/local/bin/kubectl \
 &amp;amp;&amp;amp; curl -L https://github.com/kubernetes-sigs/kustomize/releases/download/v2.0.3/kustomize_2.0.3_linux_amd64 -o /usr/local/bin/kustomize \
 &amp;amp;&amp;amp; chmod +x /usr/local/bin/kustomize \
 &amp;amp;&amp;amp; curl -L https://dl.bintray.com/flant/kubedog/v0.2.0/kubedog-linux-amd64-v0.2.0 -o /usr/local/bin/kubedog \
 &amp;amp;&amp;amp; chmod +x /usr/local/bin/kubedog \
 &amp;amp;&amp;amp; apk del --purge deps \
 &amp;amp;&amp;amp; rm /var/cache/apk/*


WORKDIR /root
ENTRYPOINT [&amp;quot;kubectl&amp;quot;]
CMD [&amp;quot;help&amp;quot;]
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;kustomize-é…åˆ-kubedog-ä½¿ç”¨&#34;&gt;Kustomize é…åˆ KubeDog ä½¿ç”¨&lt;/h2&gt;

&lt;p&gt;åœ¨é•œåƒæ„å»ºå¥½ä¹‹åå°±å¯ä»¥ç›´æ¥ä½¿ç”¨äº†ï¼Œè¿™é‡Œä½¿ç”¨çš„æ˜¯ DockerHub çš„é•œåƒä»“åº“ï¼Œè¿™é‡Œå»ºè®®å°†é•œåƒåŒæ­¥åˆ°ç§æœ‰ä»“åº“ï¼Œæ¯”å¦‚é˜¿é‡Œäº‘çš„å®¹å™¨é•œåƒæœåŠ¡æˆ–è€… Habor ï¼Œå› ä¸ºå›½å†…æ‹‰å– DockerHub çš„é•œåƒä¸å¤ªç¨³å®šï¼Œç»å¸¸ä¼šæ‹‰å–é•œåƒå¤±è´¥æˆ–è€…è®¿é—®è¶…æ—¶ï¼Œåœ¨ CI/CD æµæ°´çº¿ä¸­æ¨èä½¿ç”¨æ›´ç¨³å®šé•œåƒã€‚&lt;/p&gt;

&lt;p&gt;ä»¥ä¸‹æ˜¯ &lt;code&gt;.drone.yml&lt;/code&gt; ç¤ºä¾‹ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-yaml&#34;&gt;kind: pipeline
name: {your-pipeline-name}

steps:
- name: Kubernetes éƒ¨ç½²
  image: guoxudongdocker/kubectl
  volumes:
  - name: kube
    path: /root/.kube
  commands:
    - cd deploy/overlays/dev    # è¿™é‡Œä½¿ç”¨ kustomize ,è¯¦ç»†ä½¿ç”¨æ–¹æ³•è¯·è§ https://github.com/kubernetes-sigs/kustomize
    - kustomize edit set image {your-docker-registry}:${DRONE_BUILD_NUMBER}
    - kubectl apply -k . &amp;amp;&amp;amp; kubedog rollout track deployment {your-deployment-name} -n {your-namespace} -t {your-tomeout}

...

volumes:
- name: kube
  host:
    path: /tmp/cache/.kube  # kubeconfig æŒ‚è½½ä½ç½®

trigger:
  branch:
  - master  # è§¦å‘ CI çš„åˆ†æ”¯
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ä»ä¸Šé¢çš„é…ç½®å¯è§ï¼Œåœ¨è¯¥ step ä¸­æ‰§è¡Œäº†å¦‚ä¸‹å‡ æ­¥ï¼š&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;è¿›å…¥ patch æ‰€åœ¨è·¯å¾„&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨äº† Kustomize å‘½ä»¤ &lt;code&gt;kustomize edit set image {your-docker-registry}:${DRONE_BUILD_NUMBER}&lt;/code&gt; æ–¹å¼å°†å‰é¢ step ä¸­æ„å»ºå¥½çš„é•œåƒçš„ tag æ’å…¥åˆ° patch ä¸­&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨ &lt;code&gt;kubectl apply -k .&lt;/code&gt; è¿›è¡Œ k8s éƒ¨ç½²ï¼Œè¦æ³¨æ„æœ€åçš„é‚£ä¸ª &lt;code&gt;.&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨ kubedog è·Ÿè¸ª Deployment éƒ¨ç½²çŠ¶æ€&lt;/li&gt;
&lt;/ol&gt;

&lt;blockquote&gt;
&lt;p&gt;å‘½ä»¤è§£æï¼š&lt;code&gt;kubedog rollout track deployment {your-deployment-name} -n {your-namespace} -t {your-tomeout}&lt;/code&gt;&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;deployment {your-deployment-name} : Deployment çš„åç§°&lt;/li&gt;
&lt;li&gt;-n {your-namespace} : Deployment æ‰€åœ¨çš„ namespace&lt;/li&gt;
&lt;li&gt;-t {your-tomeout} : è¶…æ—¶æ—¶é—´ï¼Œå•ä½ä¸ºç§’ï¼Œè¶…æ—¶åä¼šæŠ¥é”™ï¼Œè¿™é‡Œè¯·æ ¹æ®å®é™…éƒ¨ç½²æƒ…å†µè¿›è¡Œè®¾ç½®&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;

&lt;h2 id=&#34;ç»“è¯­&#34;&gt;ç»“è¯­&lt;/h2&gt;

&lt;p&gt;ä» Kubernetes release v1.14 ç‰ˆæœ¬å¼€å§‹ï¼Œ&lt;code&gt;kustomize&lt;/code&gt; é›†æˆåˆ° &lt;code&gt;kubectl&lt;/code&gt; ä¸­ï¼Œè¶Šæ¥è¶Šå¤š k8S å‘¨è¾¹çš„å°å·¥å…·å‡ºç°ã€‚è¿™äº›å°å·¥å…·çš„å‡ºç°å¸®åŠ©äº† Kubernetes çš„ä½¿ç”¨è€…æ¥æ‹‰å¹³ Kubernetes çš„ä½¿ç”¨æ›²çº¿ï¼ŒåŒæ—¶ä¹Ÿæ ‡å¿—ç€ K8S çš„æˆç†Ÿï¼Œè¶Šæ¥è¶Šå¤šçš„å¼€å‘äººå‘˜åŸºäºä½¿ç”¨ K8S çš„ç—›ç‚¹å¼€å‘ç›¸å…³å·¥å…·ã€‚å¥—ç”¨ä¸€å¥ä»Šå¹´ KubeCon çš„ Keynote æ¼”è®²ä¸Šï¼Œé˜¿é‡Œäº‘æ™ºèƒ½å®¹å™¨å¹³å°è´Ÿè´£äººä¸å®‡çš„è¯ï¼š &lt;strong&gt;Kubernetes æ­£å½“æ—¶ï¼Œäº‘åŸç”Ÿæœªæ¥å¯æœŸ&lt;/strong&gt; ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>è®°ä¸€æ¬¡ä½¿ç”¨ Kustomize æ—¶é‡åˆ°çš„æ„šè ¢é—®é¢˜</title>
      <link>https://guoxudong.io/en/post/kustomize-err-1/</link>
      <pubDate>Wed, 03 Jul 2019 13:44:50 +0800</pubDate>
      
      <guid>https://guoxudong.io/en/post/kustomize-err-1/</guid>
      <description>

&lt;h2 id=&#34;ç°è±¡&#34;&gt;ç°è±¡&lt;/h2&gt;

&lt;p&gt;åœ¨æ—¥å¸¸ CI/CD æµç¨‹ä¸­ï¼Œå·²ç»å°† Kustomize é›†æˆåˆ° pipeline ä¸­ä½¿ç”¨ï¼Œä½†æ˜¯åœ¨å¯¹ä¸€ä¸ªé¡¹ç›®è¿›è¡Œ Kustomize æ”¹é€ æ—¶ï¼Œå°†å•ä¸ª &lt;code&gt;deploy.yaml&lt;/code&gt; æ‹†åˆ†ä¸ºäº†è‹¥å¹²ä¸ª patch ä»¥è¾¾åˆ°çµæ´» Kubernetes éƒ¨ç½²çš„ç›®çš„ã€‚ä½†æ˜¯åœ¨ä½¿ç”¨ &lt;code&gt;kubectl apply -k .&lt;/code&gt; å‘½ä»¤è¿›è¡Œéƒ¨ç½²çš„æ—¶å€™é‡åˆ°äº† &lt;code&gt;error: failed to find an object with apps_v1_Deployment|myapp to apply the patch&lt;/code&gt; çš„æŠ¥é”™ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;http://wx3.sinaimg.cn/large/ad5fbf65gy1g4mm1m3vx9j21oe10y102.jpg&#34; alt=&#34;image&#34; /&gt;&lt;/p&gt;

&lt;h2 id=&#34;è§£å†³ä¹‹è·¯&#34;&gt;è§£å†³ä¹‹è·¯&lt;/h2&gt;

&lt;p&gt;ç”±äºä¹‹å‰çš„ä½¿ç”¨ä¸­æ²¡æœ‰é‡åˆ°æ­¤ç±»æŠ¥é”™ï¼Œçœ‹æŠ¥é”™ä¿¡æ¯åƒæ˜¯ &lt;code&gt;apiVersion&lt;/code&gt; çš„é—®é¢˜ï¼Œæ‰€ä»¥å…ˆæ£€æŸ¥äº†æ‰€æœ‰ patch çš„ &lt;code&gt;apiVersion&lt;/code&gt; ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰æ‰¾åˆ°æœ‰ä»€ä¹ˆé—®é¢˜ã€‚&lt;/p&gt;

&lt;h3 id=&#34;google-æœç´¢&#34;&gt;Google æœç´¢&lt;/h3&gt;

&lt;p&gt;å¯¹è¯¥æŠ¥é”™è¿›è¡Œäº†æœç´¢ï¼Œæœç´¢åˆ°å¦‚ä¸‹ç»“æœï¼š&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://ws4.sinaimg.cn/large/ad5fbf65gy1g4mmee8ctxj21900ns44c.jpg&#34; alt=&#34;image&#34; /&gt;
&lt;img src=&#34;https://wx4.sinaimg.cn/large/ad5fbf65gy1g4mmgrdz0fj21ou1b6wro.jpg&#34; alt=&#34;image&#34; /&gt;&lt;/p&gt;

&lt;p&gt;ï¼Ÿï¼Ÿï¼Ÿ ä¸ºä½•è¿™ä¸ª issue æ²¡æœ‰è§£å†³å°±è¢«æå‡ºè€…å…³é—­äº†ï¼Ÿ&lt;/p&gt;

&lt;h3 id=&#34;é—®é¢˜è§£å†³&#34;&gt;é—®é¢˜è§£å†³&lt;/h3&gt;

&lt;p&gt;åœ¨ Google äº†ä¸€åœˆä¹‹åè¿˜æ˜¯æ²¡æœ‰æ‰¾åˆ°ä»€ä¹ˆæœ‰è¥å…»çš„å›ç­”ï¼Œé—®é¢˜åˆå›åˆ°äº†åŸç‚¹&amp;hellip;åªèƒ½å¯¹æ‰€æœ‰çš„ patch çš„æ¯ä¸ªå­—ç¬¦å’Œæ¯ä¸ªé…ç½®é€ä¸€è¿›è¡Œäº†æ£€æŸ¥ã€‚ç»“æœå‘ç°æ˜¯ &lt;code&gt;name&lt;/code&gt; çš„å†…å®¹ base ä¸ overlays ä¸åŒ&amp;hellip; base ä¸­æ˜¯ &lt;code&gt;name:myapp&lt;/code&gt; ï¼Œè€Œ overlays ä¸­æ˜¯ &lt;code&gt;name:my-app&lt;/code&gt; &amp;hellip;&lt;/p&gt;

&lt;p&gt;å¥½å§ï¼Œissue å…³çš„æ˜¯æœ‰é“ç†çš„&amp;hellip;&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://wx1.sinaimg.cn/large/ad5fbf65gy1g4mmuqm6n2j2098048a9z.jpg&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>ä½¿ç”¨ Kustomize å¸®ä½ ç®¡ç† kubernetes åº”ç”¨ï¼ˆå››ï¼‰ï¼šç®€è¿°æ ¸å¿ƒé…ç½® kustomization.yaml</title>
      <link>https://guoxudong.io/en/post/kustomize-4/</link>
      <pubDate>Thu, 23 May 2019 12:50:12 +0800</pubDate>
      
      <guid>https://guoxudong.io/en/post/kustomize-4/</guid>
      <description>

&lt;h2 id=&#34;å‰è¨€&#34;&gt;å‰è¨€&lt;/h2&gt;

&lt;p&gt;åœ¨å‰é¢çš„æ–‡ç« ä¸­å·²ç»ä»‹ç»äº† kustomize æ˜¯ä»€ä¹ˆï¼Œä»¥åŠå¦‚ä½•å¼€å§‹ä½¿ç”¨å’Œå¦‚ä½•ç®€å•çš„åœ¨ CI/CD ä¸­ä½¿ç”¨ï¼Œæœ¬ç¯‡æ–‡ç« å°†ä¼šä»‹ç» kustomize çš„æ ¸å¿ƒæ–‡ä»¶ &lt;a href=&#34;https://github.com/kubernetes-sigs/kustomize/blob/master/docs/zh/kustomization.yaml&#34; target=&#34;_blank&#34;&gt;kustomization.yaml&lt;/a&gt;ã€‚&lt;/p&gt;

&lt;p&gt;å¦å¤–ï¼Œåšä¸»å·²ç»å‘ kustomize è´¡çŒ®äº†ä¸­æ–‡æ–‡æ¡£ï¼Œå·²è¢«å®˜æ–¹é‡‡çº³ï¼Œç°åœ¨åœ¨ kustomize ä¸­çš„ &lt;a href=&#34;https://github.com/kubernetes-sigs/kustomize/tree/master/docs/zh&#34; target=&#34;_blank&#34;&gt;&lt;code&gt;docs/zh&lt;/code&gt;&lt;/a&gt; ç›®å½•ä¸­å°±å¯çœ‹åˆ°ï¼Œç¿»è¯‘çš„ä¸å¥½çš„åœ°æ–¹æ¬¢è¿æŒ‡æ­£ã€‚åŒæ—¶ä¹Ÿåœ¨ GitHub ä¸Šæ–°å»ºäº†ä¸€ä¸ª åä¸º &lt;a href=&#34;https://github.com/sunny0826/kustomize-lab&#34; target=&#34;_blank&#34;&gt;kustomize-lab&lt;/a&gt; çš„ repo ç”¨äºæ¼”ç¤º kustomize çš„å„ç§ç”¨æ³•åŠæŠ€å·§ï¼Œæœ¬æ–‡ä¸­ä»‹ç»çš„å†…å®¹ä¹Ÿä¼šåŒæ­¥æ›´æ–°åˆ°è¯¥ repo ä¸­ï¼Œæ¬¢è¿ forkã€starã€PRã€‚&lt;/p&gt;

&lt;h2 id=&#34;kustomization-yaml-çš„ä½œç”¨&#34;&gt;&lt;code&gt;kustomization.yaml&lt;/code&gt; çš„ä½œç”¨&lt;/h2&gt;

&lt;blockquote&gt;
&lt;p&gt;Kustomize å…è®¸ç”¨æˆ·ä»¥ä¸€ä¸ªåº”ç”¨æè¿°æ–‡ä»¶ ï¼ˆYAML æ–‡ä»¶ï¼‰ä¸ºåŸºç¡€ï¼ˆBase YAMLï¼‰ï¼Œç„¶åé€šè¿‡ Overlay çš„æ–¹å¼ç”Ÿæˆæœ€ç»ˆéƒ¨ç½²åº”ç”¨æ‰€éœ€çš„æè¿°æ–‡ä»¶ã€‚&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;æœ‰å‰é¢çš„æ–‡ç« &lt;a href=&#34;../kustomize-2&#34;&gt;ã€Šä½¿ç”¨ Kustomize å¸®ä½ ç®¡ç† kubernetes åº”ç”¨ï¼ˆäºŒï¼‰ï¼š Kustomize çš„ä½¿ç”¨æ–¹æ³•ã€‹&lt;/a&gt;ä¸­å·²ç»ä»‹ç»äº†ï¼Œæ¯ä¸ª &lt;code&gt;base&lt;/code&gt; æˆ– &lt;code&gt;overlays&lt;/code&gt; ä¸­éƒ½å¿…é¡»è¦æœ‰ä¸€ä¸ª &lt;code&gt;kustomization.yaml&lt;/code&gt;ï¼Œè¿™é‡Œæˆ‘ä»¬çœ‹ä¸€ä¸‹å®˜æ–¹ç¤ºä¾‹ &lt;code&gt;helloWorld&lt;/code&gt; ä¸­çš„ &lt;code&gt;kustomization.yaml&lt;/code&gt;ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-YAML&#34;&gt;commonLabels:
  app: hello

resources:
- deployment.yaml
- service.yaml
- configMap.yaml
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;å¯ä»¥çœ‹åˆ°è¯¥é¡¹ç›®ä¸­åŒ…å«3ä¸ª resources ï¼Œ &lt;code&gt;deployment.yaml&lt;/code&gt;ã€&lt;code&gt;service.yaml&lt;/code&gt; ã€ &lt;code&gt;configMap.yaml&lt;/code&gt;ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;.
â””â”€â”€ helloWorld
    â”œâ”€â”€ configMap.yaml
    â”œâ”€â”€ deployment.yaml
    â”œâ”€â”€ kustomization.yaml
    â””â”€â”€ service.yaml
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ç›´æ¥æ‰§è¡Œå‘½ä»¤ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;kustomize build helloWorld
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;å°±å¯ä»¥çœ‹åˆ°ç»“æœäº†ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-YAML&#34;&gt;apiVersion: v1
data:
  altGreeting: Good Morning!
  enableRisky: &amp;quot;false&amp;quot;
kind: ConfigMap
metadata:
  labels:
    app: hello
  name: the-map
image:
  caption: &amp;quot;Image from: [**Pexels**](https://www.pexels.com)&amp;quot;
  focal_point: &amp;quot;&amp;quot;
  preview_only: false
---
apiVersion: v1
kind: Service
metadata:
  labels:
    app: hello
  name: the-service
spec:
  ports:
  - port: 8666
    protocol: TCP
    targetPort: 8080
  selector:
    app: hello
    deployment: hello
  type: LoadBalancer
image:
  caption: &amp;quot;Image from: [**Pexels**](https://www.pexels.com)&amp;quot;
  focal_point: &amp;quot;&amp;quot;
  preview_only: false
---
apiVersion: apps/v1
kind: Deployment
metadata:
  labels:
    app: hello
  name: the-deployment
spec:
  replicas: 3
  selector:
    matchLabels:
      app: hello
  template:
    metadata:
      labels:
        app: hello
        deployment: hello
    spec:
      containers:
      - command:
        - /hello
        - --port=8080
        - --enableRiskyFeature=$(ENABLE_RISKY)
        env:
        - name: ALT_GREETING
          valueFrom:
            configMapKeyRef:
              key: altGreeting
              name: the-map
        - name: ENABLE_RISKY
          valueFrom:
            configMapKeyRef:
              key: enableRisky
              name: the-map
        image: monopole/hello:1
        name: the-container
        ports:
        - containerPort: 8080
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ä»ä¸Šé¢çš„ç»“æœå¯ä»¥çœ‹å¤§ kustomize é€šè¿‡ &lt;code&gt;kustomization.yaml&lt;/code&gt; å°†3ä¸ª resources è¿›è¡Œäº†å¤„ç†ï¼Œç»™ä¸‰ä¸ª resources æ·»åŠ äº†å…±åŒçš„ labels &lt;code&gt;app: hello&lt;/code&gt; ã€‚è¿™ä¸ªç¤ºä¾‹å±•ç¤ºäº† &lt;code&gt;kustomization.yaml&lt;/code&gt; çš„ä½œç”¨ï¼š&lt;strong&gt;å°†ä¸åŒçš„ resources è¿›è¡Œæ•´åˆï¼ŒåŒæ—¶ä¸ºä»–ä»¬åŠ ä¸Šç›¸åŒçš„é…ç½®&lt;/strong&gt;ã€‚&lt;/p&gt;

&lt;h2 id=&#34;è¿›é˜¶ä½¿ç”¨&#34;&gt;è¿›é˜¶ä½¿ç”¨&lt;/h2&gt;

&lt;p&gt;ä¸Šé¢åªä¸è¿‡æ˜¯ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ï¼Œä¸‹é¢å°†ç»“åˆå®é™…æƒ…å†µåˆ†äº«ä¸€äº›æ¯”è¾ƒå®ç”¨çš„ç”¨æ³•&lt;/p&gt;

&lt;h3 id=&#34;æ ¹æ®ç¯å¢ƒç”Ÿæˆä¸åŒé…ç½®&#34;&gt;æ ¹æ®ç¯å¢ƒç”Ÿæˆä¸åŒé…ç½®&lt;/h3&gt;

&lt;p&gt;åœ¨å®é™…çš„ä½¿ç”¨ä¸­ï¼Œä½¿ç”¨æœ€å¤šçš„å°±æ˜¯ä¸ºä¸åŒçš„ç¯å¢ƒé…ç½®ä¸åŒçš„ &lt;code&gt;deploy.yaml&lt;/code&gt;ï¼Œè€Œä½¿ç”¨ kustomize å¯ä»¥æŠŠé…ç½®æ‹†åˆ†ä¸ºå¤šä¸ªå°çš„ patch ï¼Œç„¶åé€šè¿‡ kustomize æ¥è¿›è¡Œç»„åˆã€‚è€Œæ ¹æ®ç¯å¢ƒçš„ä¸åŒï¼Œæ¯ä¸ª patch éƒ½å¯èƒ½ä¸åŒï¼ŒåŒ…æ‹¬åˆ†é…çš„èµ„æºã€è®¿é—®çš„æ–¹å¼ã€éƒ¨ç½²çš„èŠ‚ç‚¹éƒ½å¯ä»¥è‡ªç”±çš„å®šåˆ¶ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;.
â”œâ”€â”€ flask-env
â”‚   â”œâ”€â”€ README.md
â”‚   â”œâ”€â”€ base
â”‚   â”‚   â”œâ”€â”€ deployment.yaml
â”‚   â”‚   â”œâ”€â”€ kustomization.yaml
â”‚   â”‚   â””â”€â”€ service.yaml
â”‚   â””â”€â”€ overlays
â”‚       â”œâ”€â”€ dev
â”‚       â”‚   â”œâ”€â”€ healthcheck_patch.yaml
â”‚       â”‚   â”œâ”€â”€ kustomization.yaml
â”‚       â”‚   â””â”€â”€ memorylimit_patch.yaml
â”‚       â””â”€â”€ prod
â”‚           â”œâ”€â”€ healthcheck_patch.yaml
â”‚           â”œâ”€â”€ kustomization.yaml
â”‚           â””â”€â”€ memorylimit_patch.yaml
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;è¿™é‡Œå¯ä»¥çœ‹åˆ°é…ç½®åˆ†ä¸ºäº† &lt;code&gt;base&lt;/code&gt; å’Œ &lt;code&gt;overlays&lt;/code&gt;ï¼Œ &lt;code&gt;overlays&lt;/code&gt; åˆ™æ˜¯ç»§æ‰¿äº† &lt;code&gt;base&lt;/code&gt; çš„é…ç½®ï¼ŒåŒæ—¶æ·»åŠ äº†è¯¸å¦‚ healthcheck å’Œ memorylimit ç­‰ä¸åŒçš„é…ç½®ï¼Œé‚£ä¹ˆæˆ‘ä»¬åˆ†åˆ«çœ‹ä¸€ä¸‹ &lt;code&gt;base&lt;/code&gt; å’Œ &lt;code&gt;overlays&lt;/code&gt; ä¸­ &lt;code&gt;kustomization.yaml&lt;/code&gt; çš„å†…å®¹&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;p&gt;base&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-YAML&#34;&gt;commonLabels:
app: test-cicd

resources:
- service.yaml
- deployment.yaml
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;code&gt;base&lt;/code&gt; ä¸­çš„ &lt;code&gt;kustomization.yaml&lt;/code&gt; ä¸­å®šä¹‰äº†ä¸€äº›åŸºç¡€é…ç½®&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;p&gt;overlays&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-YAML&#34;&gt;bases:
- ../../base
patchesStrategicMerge:
- healthcheck_patch.yaml
- memorylimit_patch.yaml
namespace: devops-dev
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;code&gt;overlays&lt;/code&gt; ä¸­çš„ &lt;code&gt;kustomization.yaml&lt;/code&gt; åˆ™æ˜¯åŸºäº &lt;code&gt;base&lt;/code&gt; æ–°å¢äº†ä¸€äº›ä¸ªæ€§åŒ–çš„é…ç½®ï¼Œæ¥è¾¾åˆ°ç”Ÿæˆä¸åŒç¯å¢ƒçš„ç›®çš„ã€‚&lt;/p&gt;

&lt;p&gt;æ‰§è¡Œå‘½ä»¤&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;kustomize build flask-env/overlays/dev
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ç»“æœ&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-YAML&#34;&gt;apiVersion: v1
kind: Service
metadata:
  labels:
    app: test-cicd
  name: test-cicd
  namespace: devops-dev
spec:
  ports:
  - name: http
    port: 80
    targetPort: 80
  selector:
    app: test-cicd
  type: ClusterIP
image:
  caption: &amp;quot;Image from: [**Pexels**](https://www.pexels.com)&amp;quot;
  focal_point: &amp;quot;&amp;quot;
  preview_only: false
---
apiVersion: apps/v1
kind: Deployment
metadata:
  labels:
    app: test-cicd
  name: test-cicd
  namespace: devops-dev
spec:
  replicas: 1
  selector:
    matchLabels:
      app: test-cicd
  template:
    metadata:
      labels:
        app: test-cicd
        version: 0.0.3
    spec:
      containers:
      - env:
        - name: ENV
          value: dev
        image: guoxudongdocker/flask-python:latest
        imagePullPolicy: Always
        livenessProbe:
          httpGet:
            path: /
            port: 80
          initialDelaySeconds: 10
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 20
        name: test-cicd
        readinessProbe:
          httpGet:
            path: /
            port: 80
          initialDelaySeconds: 10
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 20
        resources:
          limits:
            cpu: 300m
            memory: 500Mi
          requests:
            cpu: 300m
            memory: 500Mi
        volumeMounts:
        - mountPath: /etc/localtime
          name: host-time
      imagePullSecrets:
      - name: registry-pull-secret
      volumes:
      - hostPath:
          path: /etc/localtime
        name: host-time
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;å¯ä»¥çœ‹åˆ°åŒ…æ‹¬ &lt;code&gt;replicas&lt;/code&gt;ã€&lt;code&gt;limits&lt;/code&gt;ã€&lt;code&gt;requests&lt;/code&gt;ã€&lt;code&gt;env&lt;/code&gt; ç­‰ dev ä¸­ä¸ªæ€§çš„é…ç½®éƒ½å·²ç»å‡ºç°åœ¨äº†ç”Ÿæˆçš„ yaml ä¸­ã€‚ç”±äºç¯‡å¹…æœ‰é™ï¼Œè¿™é‡Œæ²¡æœ‰æŠŠæ‰€æœ‰çš„é…ç½®æœ‰ç½—åˆ—å‡ºæ¥ï¼Œéœ€è¦çš„å¯ä»¥å» &lt;a href=&#34;https://github.com/sunny0826/kustomize-lab&#34; target=&#34;_blank&#34;&gt;GitHub&lt;/a&gt; ä¸Šè‡ªå–ã€‚&lt;/p&gt;

&lt;h2 id=&#34;ç»“è¯­&#34;&gt;ç»“è¯­&lt;/h2&gt;

&lt;p&gt;ä¸Šé¢æ‰€æœ‰çš„ &lt;code&gt;kustomize build dir/&lt;/code&gt; éƒ½å¯ä»¥ä½¿ç”¨ &lt;code&gt;kubectl apply -k dir/&lt;/code&gt; å®ç°ï¼Œä½†æ˜¯éœ€è¦ &lt;code&gt;v14.0&lt;/code&gt; ç‰ˆä»¥ä¸Šçš„ &lt;code&gt;kubectl&lt;/code&gt;ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå…¶å®æˆ‘ä»¬åœ¨é›†æˆåˆ° CI/CD ä¸­çš„æ—¶å€™ï¼Œç”šè‡³éƒ½ä¸éœ€è¦ç”¨æ¥ &lt;code&gt;kustomize&lt;/code&gt; å‘½ä»¤é›†ï¼Œæœ‰ &lt;code&gt;kubectl&lt;/code&gt; å°±å¤Ÿäº†ã€‚&lt;/p&gt;

&lt;p&gt;ç”±äºç¯‡å¹…æœ‰é™ï¼Œè¿™é‡Œæ²¡æ³•å§æ‰€æœ‰ &lt;code&gt;kustomization.yaml&lt;/code&gt; çš„ç”¨é€”éƒ½ç½—åˆ—å‡ºæ¥ï¼Œä¸è¿‡å¯ä»¥åœ¨å®˜æ–¹æ–‡æ¡£ä¸­æ‰¾åˆ°æˆ‘æäº¤çš„ä¸­æ–‡ç¿»è¯‘ç‰ˆ &lt;a href=&#34;https://github.com/kubernetes-sigs/kustomize/blob/master/docs/zh/kustomization.yaml&#34; target=&#34;_blank&#34;&gt;&lt;code&gt;kustomization.yaml&lt;/code&gt;&lt;/a&gt;ï¼Œå¯ä»¥ç›´æ¥å»å®˜æ–¹ GitHub æŸ¥çœ‹ã€‚åŒæ—¶ &lt;a href=&#34;https://github.com/sunny0826/kustomize-lab&#34; target=&#34;_blank&#34;&gt;kustomize-lab&lt;/a&gt; ä¼šæŒç»­æ›´è¡Œï¼Œæ•¬è¯·å…³æ³¨ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>ä½¿ç”¨ Kustomize å¸®ä½ ç®¡ç† kubernetes åº”ç”¨ï¼ˆä¸‰ï¼‰ï¼šå°† Kustomize åº”ç”¨äº CI/CD</title>
      <link>https://guoxudong.io/en/post/kustomize-3/</link>
      <pubDate>Mon, 06 May 2019 16:46:28 +0800</pubDate>
      
      <guid>https://guoxudong.io/en/post/kustomize-3/</guid>
      <description>

&lt;h2 id=&#34;å‰è¨€&#34;&gt;å‰è¨€&lt;/h2&gt;

&lt;p&gt;é¦–å…ˆæ˜ç¡®è½¯ä»¶ç‰ˆæœ¬ï¼Œæˆ‘è¿™é‡Œä½¿ç”¨çš„æ˜¯ &lt;code&gt;Jenkins ver. 2.121.3&lt;/code&gt; ï¼Œè¿™ä¸ªç‰ˆæœ¬æ¯”è¾ƒè€ï¼Œå…¶ä¸Šå®‰è£… Kubernetes æ’ä»¶æ‰€ä½¿ç”¨ &lt;code&gt;kubectl&lt;/code&gt; ç‰ˆæœ¬ä¹Ÿæ¯”è¾ƒè€ï¼Œ&lt;strong&gt;æ— æ³•ä½¿ç”¨&lt;/strong&gt; Kustomize çš„ yaml æ–‡ä»¶éœ€è¦çš„ &lt;code&gt;apiVersion: apps/v1&lt;/code&gt; ï¼Œç›´æ¥ä½¿ç”¨ç”Ÿæˆ &lt;code&gt;deploy.yaml&lt;/code&gt; æ–‡ä»¶ä¼šæŠ¥é”™ï¼Œæ‰€ä»¥è¿™é‡Œé€‰æ‹©äº†è‡ªå·±æ„å»ºä¸€ä¸ªåŒ…å« &lt;code&gt;kubectl&lt;/code&gt; å’Œ &lt;code&gt;kustomize&lt;/code&gt; çš„é•œåƒï¼Œåœ¨é•œåƒä¸­ä½¿ç”¨ Kustomize ç”Ÿæˆæ‰€éœ€ yaml æ–‡ä»¶å¹¶åœ¨ Kubernetes ä¸Šéƒ¨ç½²ã€‚&lt;/p&gt;

&lt;h2 id=&#34;è½¯ä»¶ç‰ˆæœ¬&#34;&gt;è½¯ä»¶ç‰ˆæœ¬&lt;/h2&gt;

&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;è½¯ä»¶&lt;/th&gt;
&lt;th&gt;ç‰ˆæœ¬&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;

&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;Jenkins&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://jenkins.io/&#34; target=&#34;_blank&#34;&gt;2.121.3&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;kubectl&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://kubernetes.io/docs/tasks/tools/install-kubectl/&#34; target=&#34;_blank&#34;&gt;v1.14.1&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;kustomize&lt;/td&gt;
&lt;td&gt;&lt;a href=&#34;https://github.com/kubernetes-sigs/kustomize/releases&#34; target=&#34;_blank&#34;&gt;v2.0.3&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

&lt;h2 id=&#34;å‰æœŸå‡†å¤‡&#34;&gt;å‰æœŸå‡†å¤‡&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;Jenkins ï¼šæœ¬ç¯‡ä½¿ç”¨ Jenkins æ¼”ç¤º CI/CD ï¼Œå®‰è£… Jenkins å°±ä¸åœ¨èµ˜è¿°ï¼Œå¯ä»¥ä½¿ç”¨å¤šç§æ–¹æ³•å®‰è£… Jenkins ï¼Œè¯¦ç»†æ–¹æ³•è§&lt;a href=&#34;https://jenkins.io&#34; target=&#34;_blank&#34;&gt;å®˜ç½‘&lt;/a&gt;ã€‚åŒæ—¶ã€‚ CI/CD çš„å·¥å…·æœ‰å¾ˆå¤šï¼Œè¿™é‡Œä¸ºäº†çœäº‹ä½¿ç”¨ç¬”è€…ç°æœ‰çš„ Jenkins è¿›è¡Œæ¼”ç¤ºï¼Œ&lt;strong&gt;ä¸æ¨è&lt;/strong&gt;ä½¿ç”¨åŒç¬”è€…ä¸€æ ·çš„ç‰ˆæœ¬ï¼Œè¯·ä½¿ç”¨è¾ƒæ–°çš„ç‰ˆæœ¬ï¼›åŒæ—¶ä¹Ÿå¯ä»¥ä½¿ç”¨å…¶ä»– CI/CD å·¥å…·ï¼Œè¿™é‡Œæ¨èä½¿ç”¨ &lt;a href=&#34;https://drone.io/&#34; target=&#34;_blank&#34;&gt;drone&lt;/a&gt;ã€‚å¦‚æœæœ‰æ›´å¥½çš„æ–¹æ¡ˆï¼Œæ¬¢è¿äº¤æµï¼Œå¯ä»¥åœ¨&lt;a href=&#34;https://blog.maoxianplay.com/contact/&#34; target=&#34;_blank&#34;&gt;å…³äº&lt;/a&gt;ä¸­æ‰¾åˆ°æˆ‘çš„è”ç³»æ–¹å¼ã€‚&lt;/li&gt;

&lt;li&gt;&lt;pre&gt;&lt;code class=&#34;language-kubectl```&#34;&gt;- Web åº”ç”¨ï¼šè¿™é‡Œä½¿ç”¨ flask å†™äº†ä¸€ä¸ªç®€å•çš„ web åº”ç”¨ï¼Œç”¨äºæ¼”ç¤ºï¼ŒåŒæ ·ä»¥ä¸Šä¼  dockerhub [```guoxudongdocker/flask-python```](https://hub.docker.com/r/guoxudongdocker/flask-python)

## ç›®å½•ç»“æ„

é¦–å…ˆçœ‹ä¸€ä¸‹ç›®å½•ç»“æ„ï¼Œç›®å½•ä¸­åŒ…æ‹¬ ```Dockerfile``` ã€ ```Jenkinsfile``` ã€ Kustomize è¦ä½¿ç”¨çš„ ```deploy``` ç›®å½•ä»¥åŠ web åº”ç”¨ç›®å½•ã€‚

&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;bush&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;.
â”œâ”€â”€ Dockerfile
â”œâ”€â”€ Jenkinsfile
â”œâ”€â”€ app
â”‚   â”œâ”€â”€ main.py
â”‚   â””â”€â”€ uwsgi.ini
â””â”€â”€ deploy
    â”œâ”€â”€ base
    â”‚   â”œâ”€â”€ deployment.yaml
    â”‚   â”œâ”€â”€ kustomization.yaml
    â”‚   â””â”€â”€ service.yaml
    â””â”€â”€ overlays
        â”œâ”€â”€ dev
        â”‚   â”œâ”€â”€ healthcheck_patch.yaml
        â”‚   â”œâ”€â”€ kustomization.yaml
        â”‚   â””â”€â”€ memorylimit_patch.yaml
        â””â”€â”€ prod
            â”œâ”€â”€ healthcheck_patch.yaml
            â”œâ”€â”€ kustomization.yaml
            â””â”€â”€ memorylimit_patch.yaml&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;
è¿™é‡Œå¯ä»¥çœ‹åˆ° overlays æ€»å…±æœ‰ä¸¤ä¸ªå­ç›®å½• `dev` å’Œ `prod` ï¼Œåˆ†åˆ«ä»£è¡¨ä¸åŒç¯å¢ƒï¼Œåœ¨ä¸åŒçš„ç¯å¢ƒä¸­ï¼Œåº”ç”¨ä¸åŒçš„é…ç½®ã€‚

## Jenkins é…ç½®

Jenkins çš„é…ç½®ç›¸å¯¹ç®€å•ï¼Œåªéœ€è¦æ–°å»ºä¸€ä¸ª pipeline ç±»å‹çš„ job

![WX20190506-180159](https://wx4.sinaimg.cn/large/ad5fbf65gy1g2rr57oixbj20tn0ogq6v.jpg)

å¢åŠ å‚æ•°åŒ–æ„å»ºï¼Œ**æ³¨**ï¼šå‚æ•°åŒ–æ„å»ºéœ€è¦å®‰è£… Jenkins æ’ä»¶

![WX20190506-180918](https://ws4.sinaimg.cn/large/ad5fbf65gy1g2rrcb5ic9j21470q7mz8.jpg)

ç„¶åé…ç½®ä»£ç ä»“åº“å³å¯

![WX20190507-094958](https://ws3.sinaimg.cn/large/ad5fbf65gy1g2sij1xlb2j214w0nw0uw.jpg)

## Pipeline 

&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;groovy
podTemplate(label: &amp;lsquo;jnlp-slave&amp;rsquo;, cloud: &amp;lsquo;kubernetes&amp;rsquo;,
  containers: [
    containerTemplate(
        name: &amp;lsquo;jnlp&amp;rsquo;,
        image: &amp;lsquo;guoxudongdocker/jenkins-slave&amp;rsquo;,
        alwaysPullImage: true
    ),
    containerTemplate(name: &amp;lsquo;kubectl&amp;rsquo;, image: &amp;lsquo;guoxudongdocker/kubectl:v1.14.1&amp;rsquo;, command: &amp;lsquo;cat&amp;rsquo;, ttyEnabled: true),
  ],
  nodeSelector:&amp;lsquo;ci=jenkins&amp;rsquo;,
  volumes: [
    hostPathVolume(mountPath: &amp;lsquo;/var/run/docker.sock&amp;rsquo;, hostPath: &amp;lsquo;/var/run/docker.sock&amp;rsquo;),
    hostPathVolume(mountPath: &amp;lsquo;/usr/bin/docker&amp;rsquo;, hostPath: &amp;lsquo;/usr/bin/docker&amp;rsquo;),
    hostPathVolume(mountPath: &amp;lsquo;/usr/local/jdk&amp;rsquo;, hostPath: &amp;lsquo;/usr/local/jdk&amp;rsquo;),
    hostPathVolume(mountPath: &amp;lsquo;/usr/local/maven&amp;rsquo;, hostPath: &amp;lsquo;/usr/local/maven&amp;rsquo;),
    secretVolume(mountPath: &amp;lsquo;/home/jenkins/.kube&amp;rsquo;, secretName: &amp;lsquo;devops-ctl&amp;rsquo;),
  ],
)
{
    node(&amp;ldquo;jnlp-slave&amp;rdquo;){
        stage(&amp;lsquo;Git Checkout&amp;rsquo;){
            git branch: &amp;lsquo;${branch}&amp;rsquo;, url: &amp;lsquo;&lt;a href=&#34;https://github.com/sunny0826/flask-python.git&#39;&#34; target=&#34;_blank&#34;&gt;https://github.com/sunny0826/flask-python.git&#39;&lt;/a&gt;
        }
        stage(&amp;lsquo;Build and Push Image&amp;rsquo;){
            withCredentials([usernamePassword(credentialsId: &amp;lsquo;docker-register&amp;rsquo;, passwordVariable: &amp;lsquo;dockerPassword&amp;rsquo;, usernameVariable: &amp;lsquo;dockerUser&amp;rsquo;)]) {
                sh &amp;ldquo;&amp;rsquo;
                docker login -u ${dockerUser} -p ${dockerPassword}
                docker build -t guoxudongdocker/flask-python:${Tag} .
                docker push guoxudongdocker/flask-python:${Tag}
                &amp;ldquo;&amp;rsquo;
            }
        }
        stage(&amp;lsquo;Deploy to K8s&amp;rsquo;){
            if (&amp;lsquo;true&amp;rsquo; == &amp;ldquo;${deploy}&amp;rdquo;) {
                container(&amp;lsquo;kubectl&amp;rsquo;) {
                    sh &amp;ldquo;&amp;rsquo;
                    cd deploy/base
                    kustomize edit set image guoxudongdocker/flask-python:${Tag}
                    &amp;ldquo;&amp;rsquo;
                    echo &amp;ldquo;éƒ¨ç½²åˆ° Kubernetes&amp;rdquo;
                    if (&amp;lsquo;prod&amp;rsquo; == &amp;ldquo;${ENV}&amp;rdquo;) {
                        sh &amp;ldquo;&amp;rsquo;
                        # kustomize build deploy/overlays/prod | kubectl apply -f -
                        kubectl applt -k deploy/overlays/prod
                        &amp;ldquo;&amp;rsquo;
                    }else {
                        sh &amp;ldquo;&amp;rsquo;
                        # kustomize build deploy/overlays/dev | kubectl apply -f -
                        kubectl applt -k deploy/overlays/dev
                        &amp;ldquo;&amp;rsquo;
                    }	
                }
            }else{
                echo &amp;ldquo;è·³è¿‡Deploy to K8s&amp;rdquo;
            }&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;    }
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;}&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;
è¿™é‡Œè¦æ³¨æ„å‡ ç‚¹ï¼š

- æ‹‰å– git ä¸­çš„ä»£ç éœ€è¦åœ¨ jenkins ä¸­é…ç½®å‡­æ®ã€‚
- ç¬”è€…çš„ jenkins éƒ¨ç½²åœ¨ Kubernetes ä¸Šï¼Œè¦æ“ä½œé›†ç¾¤çš„è¯ï¼Œéœ€è¦å°† kubeconfig ä»¥ Secret çš„å½¢å¼æŒ‚è½½åˆ° jenkins æ‰€åœ¨ namespaceã€‚
- `jenkins-slave` éœ€è¦ Java ç¯å¢ƒè¿è¡Œï¼Œæ‰€ä»¥è¦å°†å®¿ä¸»æœºçš„ `jdk` æŒ‚è½½åˆ° `jenkins-slave` ä¸­ã€‚
- åŒæ ·çš„ï¼Œå®¿ä¸»æœºä¸­éœ€è¦äº‹å…ˆå®‰è£… `docker`ã€‚
- `docker-register` ä¸º dockerhub çš„ç™»å½•å‡­è¯ï¼Œéœ€è¦åœ¨ jenkins ä¸­æ·»åŠ ç›¸åº”çš„å‡­è¯ã€‚

## æ¼”ç¤º

image:
  caption: &amp;quot;Image from: [**Pexels**](https://www.pexels.com)&amp;quot;
  focal_point: &amp;quot;&amp;quot;
  preview_only: false
---

### å¼€å§‹æ„å»º

è¿™é‡Œé€‰æ‹©ç¯å¢ƒã€åˆ†æ”¯ï¼Œå¡«å…¥ç‰ˆæœ¬å³å¯å¼€å§‹æ„å»ºï¼Œ**æ³¨æ„ï¼š**è¿™é‡Œçš„ç‰ˆæœ¬å°†å·² tag çš„å½¢å¼æ ‡è®° docker é•œåƒã€‚

![WX20190507-095142](https://ws2.sinaimg.cn/large/ad5fbf65gy1g2sikst7tuj20ob0evabw.jpg)

è¿™é‡Œå°±å¯ä»¥çœ‹åˆ°æ„å»ºæˆåŠŸäº†

![WX20190507-103721](https://ws2.sinaimg.cn/large/ad5fbf65ly1g2sjw9w22ej20v80km0w3.jpg)

### æŸ¥çœ‹ç»“æœ

è¿™é‡Œä¸ºäº†æ–¹ä¾¿ï¼ˆå…¶å®å°±æ˜¯æ‡’ï¼‰ï¼Œæˆ‘å°±ä¸ç»™è¿™ä¸ªæœåŠ¡æ·»åŠ  ingress æ¥ä»å¤–éƒ¨è®¿é—®äº†ï¼Œè¿™é‡Œä½¿ç”¨ [KT](https://yq.aliyun.com/articles/690519) æ‰“é€šæœ¬åœ°å’Œ k8s é›†ç¾¤ç½‘ç»œæ¥è¿›è¡Œè°ƒè¯•ã€‚

&amp;gt;ä¸ºäº†ç®€åŒ–åœ¨Kubernetesä¸‹è¿›è¡Œè”è°ƒæµ‹è¯•çš„å¤æ‚åº¦ï¼Œäº‘æ•ˆåœ¨SSHéš§é“ç½‘ç»œçš„åŸºç¡€ä¸Šå¹¶ç»“åˆKubernetesç‰¹æ€§æ„å»ºäº†ä¸€æ¬¾é¢å‘å¼€å‘è€…çš„è¾…åŠ©å·¥å…·kt

è¿™é‡Œçœ‹åˆ°è¿™ä¸ªæœåŠ¡æ­£å¸¸å¯åŠ¨äº†

![WX20190507-104154](https://ws2.sinaimg.cn/large/ad5fbf65ly1g2sk11dnzxj20av027jrn.jpg)

### å‘å¸ƒæ–°ç‰ˆæœ¬

æ›´æ–° web æœåŠ¡å¹¶æäº¤

![WX20190507-104936](https://ws4.sinaimg.cn/large/ad5fbf65gy1g2sk94v1c5j209702vwej.jpg)


æŒ‰ç…§ä¸Šé¢æ­¥éª¤åœ¨ jenkins ä¸­é‡æ–°æ„å»ºï¼Œå½“ç„¶ä¹Ÿå¯ä»¥é…ç½®é’©å­ï¼Œæ¯æ¬¡ä»£ç æäº¤åè‡ªåŠ¨æ„å»º

### æŸ¥çœ‹æŸ¥çœ‹æ–°ç‰ˆæœ¬

åŒä¸Šé¢ä¸€æ ·ï¼Œåœ¨æ„å»ºæˆåŠŸåæŸ¥çœ‹æœåŠ¡æ˜¯å¦æ›´æ–°

![WX20190507-105539](https://wx4.sinaimg.cn/large/ad5fbf65gy1g2skfczaz4j20by01smx7.jpg)

å¯ä»¥çœ‹åˆ°ï¼Œç‰ˆæœ¬å·²ç»æ›´æ–°äº†

### å‘å¸ƒç”Ÿäº§ç¯å¢ƒ

è¿™é‡Œæ¨¡æ‹Ÿä¸€ä¸‹å‘å¸ƒç”Ÿäº§ç¯å¢ƒï¼Œå‡è®¾ç”Ÿäº§ç¯å¢ƒæ˜¯åœ¨ `devops-prod` çš„ namespace ä¸­ï¼Œè¿™é‡Œåªåšæ¼”ç¤ºä¹‹ç”¨ï¼ŒçœŸæ­£çš„ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œå¯èƒ½å­˜åœ¨ä¸æ­¢ä¸€ä¸ª k8s é›†ç¾¤ï¼Œè¿™æ—¶éœ€è¦ä¿®æ”¹ Jenkinsfile ä¸­çš„ `secretVolume` æ¥æŒ‚è½½ä¸åŒ k8s çš„ kubeconfig æ¥è¾¾åˆ°å‘å¸ƒåˆ°ä¸åŒé›†ç¾¤çš„ç›®çš„ã€‚å½“ç„¶ï¼Œä¸€èˆ¬å‘å¸ƒç”Ÿäº§ç¯å¢ƒåªéœ€é€‰æ‹©æµ‹è¯•é€šè¿‡çš„é•œåƒæ¥å‘å¸ƒå³å¯ï¼Œä¸éœ€è¦åœ¨è¿›è¡Œæ„å»ºæ‰“åŒ…ã€‚

![WX20190507-110730](https://ws3.sinaimg.cn/large/ad5fbf65gy1g2skrnbjyuj20fc0bjmxp.jpg)

### æŸ¥çœ‹ç”Ÿäº§ç‰ˆæœ¬

![WX20190507-110850](https://ws1.sinaimg.cn/large/ad5fbf65ly1g2skt3rp4yj20aq010glj.jpg)

### æ€»ç»“

ä¸Šé¢çš„è¿™äº›æ­¥éª¤ç®€å•çš„æ¼”ç¤ºäº†ä½¿ç”¨ jenkins è¿›è¡Œ CI/CD çš„æµç¨‹ï¼Œæµç¨‹ååˆ†ç®€å•ï¼Œè¿™é‡Œä»…ä¾›å‚è€ƒ

## Kustomize çš„ä½œç”¨

é‚£ä¹ˆï¼Œ Kustomize åœ¨æ•´ä¸ªæµç¨‹ä¸­åˆæ‰®æ¼”äº†ä¸€ä¸ªä»€ä¹ˆè§’è‰²å‘¢ï¼Ÿ

### æ›´æ–°é•œåƒ

åœ¨ `jenkinsfile` ä¸­å¯ä»¥çœ‹åˆ°ï¼Œ kustomize æ›´æ–°äº†åŸºç¡€é…ç½®çš„é•œåƒç‰ˆæœ¬ï¼Œè¿™é‡Œæˆ‘ä»¬ä¹‹å‰ä¸€ç›´æ˜¯ä½¿ç”¨ `sed -i &amp;quot;s/#Tag/${Tag}/g&amp;quot; deploy.yaml` æ¥è¿›è¡Œæ›¿æ¢äº†ï¼Œä½†æ˜¯ä¸åŒç¯å¢ƒå­˜åœ¨æ¯”è¾ƒå¤šçš„å·®å¼‚ï¼Œéœ€è¦æ›¿æ¢çš„è¶Šæ¥è¶Šå¤šï¼Œå¯¼è‡´ Jekninsfile ä¹Ÿè¶Šæ¥è¶Šè‡ƒè‚¿å’Œéš¾ä»¥ç»´æŠ¤ã€‚ kustomize è§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚

&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;bash
kustomize edit set image guoxudongdocker/flask-python:${Tag}&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;
### ç¯å¢ƒåŒºåˆ†

ä¸Šé¢ä¹Ÿæåˆ°äº†ï¼Œä¸åŒçš„ç¯å¢ƒæˆ‘ä»¬å­˜åœ¨è¿™è®¸å¤šå·®å¼‚ï¼Œè™½ç„¶çœ‹ä¸Šå»å¤§è‡´ç±»ä¼¼ï¼Œä½†æ˜¯å¾ˆå¤šç»†èŠ‚éƒ½éœ€è¦ä¿®æ”¹ã€‚è¿™æ—¶ kustomize å°±èµ·åˆ°äº†å¾ˆå¤§çš„ä½œç”¨ï¼Œä¸åŒç¯å¢ƒç›¸åŒçš„é…ç½®éƒ½æ”¾åœ¨ `base` ä¸­ï¼Œè€Œå·®å¼‚å°±å¯ä»¥åœ¨ `overlays` ä¸­å®ç°ã€‚

&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;bash
.
â”œâ”€â”€ base
â”‚   â”œâ”€â”€ deployment.yaml
â”‚   â”œâ”€â”€ kustomization.yaml
â”‚   â””â”€â”€ service.yaml
â””â”€â”€ overlays
    â”œâ”€â”€ dev
    â”‚   â”œâ”€â”€ healthcheck_patch.yaml
    â”‚   â”œâ”€â”€ kustomization.yaml
    â”‚   â””â”€â”€ memorylimit_patch.yaml
    â””â”€â”€ prod
        â”œâ”€â”€ healthcheck_patch.yaml
        â”œâ”€â”€ kustomization.yaml
        â””â”€â”€ memorylimit_patch.yaml&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;å¯ä»¥çœ‹åˆ°ï¼Œ `base` ä¸­ç»´æŠ¤äº†é¡¹ç›®å…±åŒçš„åŸºç¡€é…ç½®ï¼Œå¦‚æœæœ‰é•œåƒç‰ˆæœ¬ç­‰åŸºç¡€é…ç½®éœ€è¦ä¿®æ”¹ï¼Œå¯ä»¥ä½¿ç”¨ `kustomize edit set image ...` æ¥ç›´æ¥ä¿®æ”¹åŸºç¡€é…ç½®ï¼Œè€ŒçœŸæ­£ä¸åŒç¯å¢ƒï¼Œæˆ–è€…ä¸åŒä½¿ç”¨æƒ…å†µçš„é…ç½®åˆ™åœ¨ `overlays` ä¸­ ä»¥ patch çš„å½¢å¼æ·»åŠ é…ç½®ã€‚è¿™é‡Œæˆ‘çš„é…ç½®æ˜¯ prod ç¯å¢ƒéƒ¨ç½²çš„å‰¯æœ¬ä¸º2ï¼ŒåŒæ—¶ç»™åˆ°çš„èµ„æºä¹Ÿæ›´å¤šï¼Œè¯¦æƒ…å¯ä»¥åœ¨ [Github](https://github.com/sunny0826/flask-python) ä¸ŠæŸ¥çœ‹ã€‚

### ä¸ kubectl çš„é›†æˆ

åœ¨ jenkinsfile ä¸­å¯ä»¥çœ‹åˆ°

&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;bash&lt;/p&gt;

&lt;h1 id=&#34;kustomize-build-deploy-overlays-dev-kubectl-apply-f&#34;&gt;kustomize build deploy/overlays/dev | kubectl apply -f -&lt;/h1&gt;

&lt;p&gt;kubectl apply -k deploy/overlays/dev
```&lt;/p&gt;

&lt;p&gt;è¿™ä¸¤æ¡å‘½ä»¤çš„æ‰§è¡Œæ•ˆæœæ˜¯ä¸€æ ·çš„ï¼Œåœ¨ &lt;code&gt;kubectl v1.14.0&lt;/code&gt; ä»¥ä¸Šçš„ç‰ˆæœ¬ä¸­ï¼Œå·²ç»é›†æˆäº† kustomize ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ &lt;code&gt;kubectl&lt;/code&gt; è¿›è¡Œéƒ¨ç½²ã€‚&lt;/p&gt;

&lt;h2 id=&#34;ç»“è¯­&#34;&gt;ç»“è¯­&lt;/h2&gt;

&lt;p&gt;è¿™é‡Œåªæ˜¯å¯¹ kustomize åœ¨ CI/CD ä¸­ç®€å•åº”ç”¨çš„å±•ç¤ºï¼Œåªæ˜¯ä¸€ç§æ¯”è¾ƒç®€å•å’ŒåŸºç¡€çš„ä½¿ç”¨ï¼ŒçœŸæ­£çš„ CI æµç¨‹è¦æ¯”è¿™ä¸ªå¤æ‚çš„å¤šï¼Œè¿™é‡Œåªæ˜¯ä¸ºäº†æ¼”ç¤º kustomize çš„ä½¿ç”¨è€Œä¸´æ—¶æ­å»ºçš„ã€‚è€Œ kustomize è¿˜æœ‰å¾ˆå¤šé»‘ç§‘æŠ€çš„ç”¨æ³•ï¼Œå°†ä¼šåœ¨åç»­çš„æ–‡ç« ä¸­ä»‹ç»ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>4æœˆ29æ—¥ äº‘æ –ç¤¾åŒºåˆ†äº«PPT -- é˜¿é‡Œäº‘å®¹å™¨æœåŠ¡çš„ä¼˜åŠ¿ä¸è°ƒä¼˜</title>
      <link>https://guoxudong.io/en/post/aliyun-share/</link>
      <pubDate>Tue, 30 Apr 2019 18:46:24 +0800</pubDate>
      
      <guid>https://guoxudong.io/en/post/aliyun-share/</guid>
      <description>&lt;p&gt;è¯¥PPT ä¸º 2019å¹´4æœˆ26æ—¥ åœ¨äº‘æ –ç¤¾åŒºåˆ†äº«ä½¿ç”¨ï¼Œè¿™é‡Œç•™ä½œå±•ç¤ºå’Œè®°å½•ï¼Œä¸‹è½½åœ°å€å¯ä»¥å‚è€ƒä¸‹æ–¹é“¾æ¥ã€‚&lt;/p&gt;

&lt;iframe src=&#34;https://guoxudong.io/aliyun-share/index.html&#34; style=&#34;width: 100%;height:600px;&#34; frameborder=&#34;0&#34;&gt;&lt;/iframe&gt;

&lt;p&gt;ç”±äºå›¾ç‰‡èµ„æºä½äº GitHub ä¸Šï¼Œå›½å†…è®¿é—®å¯èƒ½ä¼šæœ‰äº›æ…¢ï¼Œå»ºè®®ä¸‹è½½è§‚çœ‹ã€‚&lt;/p&gt;

&lt;p&gt;PPT ä¸‹è½½åœ°å€ï¼š&lt;a href=&#34;https://yq.aliyun.com/articles/700084&#34; target=&#34;_blank&#34;&gt;https://yq.aliyun.com/articles/700084&lt;/a&gt;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>8åˆ†é’Ÿå…¥é—¨ K8S</title>
      <link>https://guoxudong.io/en/post/an-8-minute-introduction-to-k8s/</link>
      <pubDate>Tue, 30 Apr 2019 13:38:12 +0800</pubDate>
      
      <guid>https://guoxudong.io/en/post/an-8-minute-introduction-to-k8s/</guid>
      <description>

&lt;blockquote&gt;
&lt;p&gt;è¯»å®Œ &lt;a href=&#34;https://www.amazon.com/Kubernetes-Running-Dive-Future-Infrastructure/dp/1491935677&#34; target=&#34;_blank&#34;&gt;Kubernetes: Up and Running&lt;/a&gt; åï¼Œæˆ‘å†™ä¸‹äº†è¿™ç¯‡æ–‡ç« ã€‚æ—¨åœ¨ä¸ºé‚£äº›è®¤ä¸ºæ–‡ç«  &lt;a href=&#34;https://blog.maoxianplay.com/posts/cant/&#34; target=&#34;_blank&#34;&gt;TL;DR&lt;/a&gt; çš„äººè¿›è¡Œä¸€äº›æ€»ç»“ï¼Œè¿™åŒæ—¶ä¹Ÿæ˜¯ä¸€ç§å¼ºè¿«è‡ªå·±æ£€æŸ¥æ‰€é˜…è¯»å†…å®¹çš„å¥½æ–¹æ³•ã€‚&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;åŸºäº Google &lt;a href=&#34;https://kubernetes.io/blog/2015/04/borg-predecessor-to-kubernetes/&#34; target=&#34;_blank&#34;&gt;Borg&lt;/a&gt; çš„å¼€æºç³»ç»Ÿ K8S( Kubernetes ) æ˜¯ä¸€ä¸ªéå¸¸å¼ºå¤§çš„å®¹å™¨ç¼–æ’è°ƒåº¦ç³»ç»Ÿã€‚ å…¶æ•´ä¸ªç”Ÿæ€ç³»ç»Ÿï¼ŒåŒ…æ‹¬ï¼šå·¥å…·ï¼Œæ¨¡å—ï¼Œé™„åŠ ç»„ä»¶ç­‰ï¼Œéƒ½æ˜¯ä½¿ç”¨ Golang è¯­è¨€ç¼–å†™çš„ï¼Œè¿™ä½¿å¾— K8S åŠå…¶å‘¨è¾¹ç”Ÿæ€ç³»ç»ŸåŸºæœ¬ä¸Šæ˜¯é¢å‘ API å¯¹è±¡ã€è¿è¡Œé€Ÿåº¦éå¸¸å¿«çš„äºŒè¿›åˆ¶æ–‡ä»¶çš„é›†åˆï¼Œå¹¶ä¸”è¿™äº›äºŒè¿›åˆ¶æ–‡ä»¶éƒ½æœ‰å¾ˆå¥½çš„æ–‡æ¡£è®°å½•ï¼Œæ˜“äºç¼–å†™å’Œæ„å»ºåº”ç”¨ç¨‹åºã€‚&lt;/p&gt;

&lt;p&gt;åœ¨æ·±å…¥äº†è§£ä¹‹å‰ï¼Œæˆ‘æƒ³å…ˆä»‹ç»ä¸€ä¸‹ K8S çš„ç«äº‰å¯¹æ‰‹ï¼šECS ã€ Nomad å’Œ Mesos ã€‚ECS æ˜¯ AWS è‡ªå·±çš„ä¸šåŠ¡ç¼–æ’è§£å†³æ–¹æ¡ˆï¼Œè€Œæœ€è¿‘ AWS ä¸Šä¹Ÿå¼•å…¥äº†ä¸€ä¸ªæ‰˜ç®¡çš„ K8S ç³»ç»Ÿ &amp;ndash; EKS ã€‚ä¸¤è€…éƒ½æä¾› &lt;a href=&#34;https://aws.amazon.com/fargate/&#34; target=&#34;_blank&#34;&gt;FARGATE&lt;/a&gt; ï¼Œå…è®¸ç”¨æˆ·è¿è¡Œå…¶åº”ç”¨å¹¶å¿½ç•¥å…¶è¿è¡Œç‰©ç†èµ„æºã€‚&lt;/p&gt;

&lt;p&gt;K8S ä½œä¸ºä¸€ä¸ªå¼€æºç³»ç»Ÿï¼Œåœ¨é‡‡ç”¨é‡ä¸Šæ¯«æ— ç–‘é—®æ˜¯æœ€å¤§èµ¢å®¶ï¼ŒåŒæ—¶å®ƒä¹Ÿå¯ä»¥ä»¥æ‰˜ç®¡å½¢å¼åœ¨ä¸‰ä¸ªä¸»è¦äº‘æä¾›å•†ä¸Šæä¾›æœåŠ¡ã€‚ç„¶è€Œï¼Œå®ƒæ¯”å…¶ä»–ç³»ç»Ÿæ›´åŠ å¤æ‚ã€‚K8S å¯ä»¥å¤„ç†å‡ ä¹ä»»ä½•ç±»å‹çš„å®¹å™¨åŒ–å·¥ä½œè´Ÿè½½ï¼Œä½†è¿™å¹¶ä¸æ„å‘³ç€æ¯ä¸ªäººéƒ½éœ€è¦å®ƒã€‚ç”¨æˆ·ä¹Ÿå¯ä»¥é€‰æ‹©å…¶ä»–è§£å†³æ–¹æ¡ˆï¼Œä¾‹å¦‚ï¼Œå•ç‹¬éƒ¨ç½²åœ¨ AWS ä¸Šçš„äº’è”ç½‘äº§å“å¯ä»¥åœ¨ç”Ÿäº§ç¯å¢ƒå¾ˆå¥½çš„ä½¿ç”¨ ECS è€Œé K8Sã€‚&lt;/p&gt;

&lt;p&gt;è¯è™½å¦‚æ­¤ï¼Œk8sä¹Ÿæœ‰å…¶ç¥å¥‡ä¹‹å¤„ &amp;ndash; å®ƒå¯ä»¥åœ¨ä»»ä½•åœ°æ–¹éƒ¨ç½²ï¼ŒåŒæ—¶æ‹¥æœ‰ä¸€ä¸ªæ´»è·ƒçš„ç¤¾åŒºå’Œæ•°ç™¾ä¸ªæ ¸å¿ƒå¼€å‘äººå‘˜ï¼Œä»¥åŠå…¶å¹¿æ³›ç”Ÿæ€ç³»ç»Ÿä¸­çš„æ•°åƒä¸ªå…¶ä»–å¼€æºè´¡çŒ®è€…ã€‚å®ƒå¿«é€Ÿã€æ–°é¢–ã€æ¨¡å—åŒ–å’Œé¢å‘ API ï¼Œä½¿å…¶æˆä¸ºå¯¹äºæ„å»ºæ’ä»¶å’ŒæœåŠ¡éå¸¸å‹å¥½çš„ç³»ç»Ÿã€‚&lt;/p&gt;

&lt;h2 id=&#34;è¯ä¸å¤šè¯´-è¿™é‡ŒæŠŠ-k8s-åˆ†ä¸ºçš„11ä¸ªéƒ¨åˆ†ä»‹ç»&#34;&gt;è¯ä¸å¤šè¯´ï¼Œè¿™é‡ŒæŠŠ K8S åˆ†ä¸ºçš„11ä¸ªéƒ¨åˆ†ä»‹ç»&lt;/h2&gt;

&lt;h3 id=&#34;1-pods&#34;&gt;1. Pods&lt;/h3&gt;

&lt;p&gt;&lt;strong&gt;Pods&lt;/strong&gt; æ˜¯ K8S ä¸­åˆ›å»ºæˆ–éƒ¨ç½²çš„æœ€å°åŸºæœ¬å•ä½ã€‚ä¸€ä¸ª pod å¯ä»¥ç”±å¤šä¸ªå®¹å™¨ç»„æˆï¼Œè¿™äº›å®¹å™¨å°†å½¢æˆä¸€ä¸ªéƒ¨ç½²åœ¨å•ä¸ªèŠ‚ç‚¹ä¸Šçš„å•å…ƒã€‚ä¸€ä¸ª pod åŒ…å«ä¸€ä¸ªå®¹å™¨ä¹‹é—´å…±äº«çš„ IPã€‚åœ¨å¾®æœåŠ¡ä¸­ï¼Œ pod å°†æ˜¯æ‰§è¡ŒæŸäº›åç«¯å·¥ä½œæˆ–æä¾›ä¼ å…¥è¯·æ±‚çš„å¾®æœåŠ¡çš„å•ä¸ªå®ä¾‹ã€‚&lt;/p&gt;

&lt;h3 id=&#34;2-nodes&#34;&gt;2. Nodes&lt;/h3&gt;

&lt;p&gt;&lt;strong&gt;Node&lt;/strong&gt; å°±æ˜¯æœåŠ¡å™¨ã€‚å®ƒä»¬æ˜¯ K8S éƒ¨ç½²å…¶ pod çš„â€œè£¸æœºâ€ï¼ˆä¹Ÿå¯ä»¥æ˜¯è™šæ‹Ÿæœºï¼‰ã€‚Nodes ä¸º K8S æä¾›å¯ç”¨çš„ç¾¤é›†èµ„æºï¼Œä»¥ä¿æŒæ•°æ®ï¼Œè¿è¡Œä½œä¸šï¼Œç»´æŠ¤å·¥ä½œè´Ÿè½½å’Œåˆ›å»ºç½‘ç»œè·¯ç”±ã€‚&lt;/p&gt;

&lt;h3 id=&#34;3-labels-annotations&#34;&gt;3. Labels &amp;amp; Annotations&lt;/h3&gt;

&lt;p&gt;&lt;strong&gt;Labels&lt;/strong&gt; æ˜¯ K8S åŠå…¶ç»ˆç«¯ç”¨æˆ·è¿‡æ»¤å’Œç­›é€‰ç³»ç»Ÿä¸­ç±»ä¼¼èµ„æºçš„æ–¹å¼ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªèµ„æºéœ€è¦â€œè®¿é—®â€æˆ–ä¸å¦ä¸€ä¸ªèµ„æºå…³è”çš„ç²˜åˆå‰‚ã€‚ä¾‹å¦‚ï¼šä¸€ä¸ª Service æƒ³è¦å¼€æ”¾ Deployment çš„ç«¯å£ã€‚æ— è®ºæ˜¯ç›‘æ§ï¼Œè®°å½•ï¼Œæ—¥å¿—ï¼Œæµ‹è¯•ï¼Œä»»ä½•k8sèµ„æºéƒ½åº”æ·»åŠ  Labels ä»¥ä¾›è¿›ä¸€æ­¥æ£€æŸ¥ã€‚ä¾‹å¦‚ï¼š &lt;code&gt;app=worker&lt;/code&gt; ï¼Œä¸€ä¸ªç»™ç³»ç»Ÿä¸­æ‰€æœ‰å·¥ä½œ pod çš„æ ‡ç­¾ï¼Œç¨åå¯ä»¥ä½¿ç”¨ &lt;code&gt;kubectl&lt;/code&gt; å·¥å…·æˆ– k8s api ä½¿ç”¨ &lt;code&gt;--selector&lt;/code&gt; å­—æ®µè¿›è¡Œé€‰æ‹©ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Annotations&lt;/strong&gt; ä¸ Labels éå¸¸ç±»ä¼¼ï¼Œä½†æ˜¯å®ƒé€šå¸¸ä»¥å­—ç¬¦ä¸²çš„å½¢å¼ç”¨äºå­˜å‚¨å…ƒæ•°æ®ï¼Œä½†ä»–ä¸èƒ½ç”¨äºæ ‡è¯†å’Œé€‰æ‹©å¯¹è±¡ï¼Œé€šå¸¸ä¹Ÿä¸ä¼šè¢« Kubernetes ç›´æ¥ä½¿ç”¨ï¼Œå…¶ä¸»è¦ç›®çš„æ˜¯æ–¹ä¾¿å·¥å…·æˆ–ç”¨æˆ·çš„é˜…è¯»å’ŒæŸ¥æ‰¾ç­‰ã€‚&lt;/p&gt;

&lt;h3 id=&#34;4-æœåŠ¡å‘ç°&#34;&gt;4. æœåŠ¡å‘ç°&lt;/h3&gt;

&lt;p&gt;ä½œä¸ºç¼–æ’è°ƒåº¦å™¨ï¼Œæ§åˆ¶ä¸åŒå·¥ä½œè´Ÿè½½çš„èµ„æºï¼ŒK8S ç®¡ç† pods ã€jobs å’Œå…¶ä»–ä»»ä½•éœ€è¦ç½‘ç»œé€šä¿¡çš„ç‰©ç†èµ„æºã€‚ K8S ä½¿ç”¨ &lt;a href=&#34;https://kubernetes.io/docs/concepts/overview/components/#etcd&#34; target=&#34;_blank&#34;&gt;etcd&lt;/a&gt; ç®¡ç†è¿™äº›ã€‚ etcd æ˜¯ K8S çš„â€œå†…éƒ¨â€æ•°æ®åº“ï¼Œ Master èŠ‚ç‚¹ä½¿ç”¨å®ƒæ¥çŸ¥é“ä¸€åˆ‡èµ„æºéƒ½åœ¨å“ªé‡Œã€‚K8S è¿˜ä¸ºæ‚¨çš„æœåŠ¡æä¾›äº†å®æ—¶çš„ â€œæœåŠ¡å‘ç°â€ - æ‰€æœ‰ Pod éƒ½ä½¿ç”¨çš„è‡ªå®šä¹‰ DNS æœåŠ¡ï¼ˆCoreDNSï¼‰ï¼Œæ‚¨å¯ä»¥é€šè¿‡è§£æå…¶ä»–æœåŠ¡çš„åç§°æ¥è·å–å…¶ IP åœ°å€å’Œç«¯å£ã€‚å®ƒä¸éœ€è¦ä»»ä½•è®¾ç½®ï¼Œåœ¨ K8S é›†ç¾¤ä¸­â€œå¼€ç®±å³ç”¨â€ã€‚&lt;/p&gt;

&lt;h3 id=&#34;5-replicasets&#34;&gt;5. ReplicaSets&lt;/h3&gt;

&lt;p&gt;è™½ç„¶ pod è¿è¡Œä»»åŠ¡ï¼Œä½†é€šå¸¸å•ä¸ªå®ä¾‹æ˜¯ä¸å¤Ÿçš„ã€‚å‡ºäºå¯¹å†—ä½™å’Œè´Ÿè½½å¤„ç†çš„è€ƒè™‘ï¼Œéœ€è¦è¿›è¡Œå¤åˆ¶å®¹å™¨ï¼Œå³â€œå¼¹æ€§ç¼©æ”¾â€ã€‚K8S ä½¿ç”¨ &lt;strong&gt;ReplicaSet&lt;/strong&gt; æ¥å®ç°ä¼¸ç¼©æ‰©å±•ã€‚æ ¹æ®å‰¯æœ¬çš„æ•°é‡æ¥è¡¨ç¤ºç³»ç»Ÿçš„æœŸæœ›çŠ¶æ€ï¼Œå¹¶ä¸”åœ¨ä»»ä½•ç»™å®šæ—¶åˆ»ä¿æŒç³»ç»Ÿçš„å½“å‰çŠ¶æ€ã€‚&lt;/p&gt;

&lt;p&gt;è¿™ä¹Ÿæ˜¯é…ç½®è‡ªåŠ¨æ‰©å±•çš„åœ°æ–¹ï¼Œåœ¨ç³»ç»Ÿè´Ÿè½½é«˜æ—¶åˆ›å»ºæ–°çš„å‰¯æœ¬ï¼Œä»¥åŠåœ¨ä¸å†éœ€è¦è¿™äº›èµ„æºæ¥æ”¯æŒè¿è¡Œå·¥ä½œè´Ÿè½½æ—¶å‡å°‘æ‰©å±•ã€‚ç®€å•çš„è®²å°±æ˜¯ï¼šå°‘åˆ™å¢åŠ ï¼Œå¤šå¢åˆ é™¤ã€‚&lt;/p&gt;

&lt;h3 id=&#34;6-daemonsets&#34;&gt;6. DaemonSets&lt;/h3&gt;

&lt;p&gt;æœ‰æ—¶ï¼ŒæŸäº›åº”ç”¨ç¨‹åºåœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸Šåªéœ€è¦ä¸€ä¸ªå®ä¾‹ã€‚æœ€å¥½çš„ä¾‹å­å°±æ˜¯åƒ &lt;a href=&#34;https://www.elastic.co/products/beats/filebeat&#34; target=&#34;_blank&#34;&gt;FileBeat&lt;/a&gt; è¿™æ ·çš„æ—¥å¿—é‡‡é›†ç»„ä»¶ã€‚ä¸ºäº†è®© agent ä»èŠ‚ç‚¹ä¸Šæ”¶é›†æ—¥å¿—ï¼Œå®ƒéœ€è¦è¿è¡Œåœ¨æ‰€æœ‰èŠ‚ç‚¹ä¸Šï¼Œä½†åªéœ€è¦ä¸€ä¸ªå®ä¾‹å³å¯ã€‚ä¸ºäº†åˆ›å»ºæ»¡è¶³ä¸Šé¢éœ€æ±‚çš„çš„å·¥ä½œè´Ÿè½½ï¼ŒK8S ä½¿ç”¨ &lt;strong&gt;DaemonSets&lt;/strong&gt; æ¥å®Œæˆè¿™ä¸ªå·¥ä½œã€‚&lt;/p&gt;

&lt;h3 id=&#34;7-statefulsets&#34;&gt;7. StatefulSets&lt;/h3&gt;

&lt;p&gt;è™½ç„¶å¤§å¤šæ•°å¾®æœåŠ¡éƒ½æ˜¯æ— çŠ¶æ€çš„åº”ç”¨ç¨‹åºï¼Œä½†æ˜¯è¿˜æ˜¯æœ‰ä¸€éƒ¨åˆ†å¹¶ä¸æ˜¯ã€‚æœ‰çŠ¶æ€çš„å·¥ä½œè´Ÿè½½éœ€è¦ç”±æŸç§å¯é çš„ç£ç›˜å·æ¥æ”¯æŒã€‚è™½ç„¶åº”ç”¨ç¨‹åºå®¹å™¨æœ¬èº«å¯ä»¥æ˜¯ä¸å˜çš„ï¼Œå¹¶ä¸”å¯ä»¥ç”¨æ›´æ–°çš„ç‰ˆæœ¬æˆ–æ›´å¥åº·çš„å®ä¾‹æ¥æ›¿æ¢å®ƒä»¬ï¼Œä½†æ˜¯å³ä½¿ä½¿ç”¨å…¶ä»–å‰¯æœ¬ä¹Ÿæ˜¯éœ€è¦æŒä¹…åŒ–çš„æ•°æ®ã€‚ä¸ºæ­¤ï¼Œ&lt;strong&gt;StatefulSets&lt;/strong&gt; å…è®¸éƒ¨ç½²æ•´ä¸ªç”Ÿå‘½å‘¨æœŸå†…éœ€è¦è¿è¡Œåœ¨åŒä¸€èŠ‚ç‚¹çš„åº”ç”¨ç¨‹åºã€‚å®ƒè¿˜ä¿ç•™äº†å®ƒçš„ â€œåç§°â€ ; å®¹å™¨å†…çš„ &lt;code&gt;hostname&lt;/code&gt; å’Œæ•´ä¸ªé›†ç¾¤ä¸­æœåŠ¡å‘ç°çš„åç§°ã€‚ä¸€ä¸ªåŒ…å«3ä¸ª ZooKeeper çš„ StatefulSet å¯ä»¥å‘½åä¸º &lt;code&gt;zk-1&lt;/code&gt; ï¼Œ&lt;code&gt;zk-2&lt;/code&gt; å’Œ &lt;code&gt;zk-3&lt;/code&gt; è¿˜å¯ä»¥æ‰©å±•ä¸ºåŒ…å«å…¶ä»–æˆå‘˜ï¼Œå¦‚ &lt;code&gt;zk-4&lt;/code&gt; ï¼Œ &lt;code&gt;zk-5&lt;/code&gt; ç­‰&amp;hellip; StatefulSets è¿˜éœ€è¦ç®¡ç† PVC ã€‚&lt;/p&gt;

&lt;h3 id=&#34;8-jobs&#34;&gt;8. Jobs&lt;/h3&gt;

&lt;p&gt;K8S æ ¸å¿ƒå›¢é˜Ÿè€ƒå¯Ÿäº†ç»å¤§å¤šæ•°éœ€è¦ä½¿ç”¨ç¼–æ’ç³»ç»Ÿçš„åº”ç”¨ç¨‹åºã€‚è™½ç„¶å¤§å¤šæ•°åº”ç”¨ç¨‹åºéœ€è¦æŒç»­çš„æ­£å¸¸è¿è¡Œæ—¶é—´æ¥å¤„ç†æœåŠ¡è¯·æ±‚ï¼Œä¾‹å¦‚ Web æœåŠ¡ï¼Œä½†æœ‰æ—¶ä¹Ÿéœ€è¦è¿è¡Œæ‰¹é‡ä»»åŠ¡å¹¶åœ¨ä»»åŠ¡å®Œæˆåè¿›è¡Œæ¸…ç†ã€‚å¦‚æœæ‚¨æ„¿æ„ï¼Œå¯ä»¥ä½¿ç”¨å°å‹æ— æœåŠ¡å™¨ç¯å¢ƒã€‚è€Œåœ¨ K8S ä¸­å®ç°è¿™ä¸€åŠŸèƒ½ï¼Œå¯ä»¥ä½¿ç”¨ &lt;strong&gt;Job&lt;/strong&gt; èµ„æºã€‚Jobs æ­£æ˜¯å¬èµ·æ¥çš„é‚£æ ·ï¼Œä¸€ä¸ªå·¥ä½œè´Ÿè½½å®¹å™¨æ¥å®Œæˆç‰¹å®šçš„å·¥ä½œï¼Œå¹¶åœ¨æˆåŠŸåè¢«é”€æ¯ã€‚ä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­æ˜¯è®¾ç½®ä¸€ç»„ worker ï¼Œä»è¦å¤„ç†å’Œå­˜å‚¨çš„é˜Ÿåˆ—ä¸­è¯»å–ä»»åŠ¡ã€‚ä¸€æ—¦é˜Ÿåˆ—ä¸ºç©ºï¼Œç›´åˆ°ä¸‹ä¸€æ‰¹å‡†å¤‡å¥½è¿›è¡Œå¤„ç†ï¼Œéƒ½ä¸å†éœ€è¦å¯åŠ¨ workerã€‚&lt;/p&gt;

&lt;h3 id=&#34;9-configmaps-secrets&#34;&gt;9. ConfigMaps &amp;amp; Secrets&lt;/h3&gt;

&lt;p&gt;å¦‚æœæ‚¨è¿˜ä¸ç†Ÿæ‚‰ &lt;a href=&#34;https://12factor.net/&#34; target=&#34;_blank&#34;&gt;Twelve-Factor App manifest&lt;/a&gt; ã€Š&lt;a href=&#34;../12-factor&#34;&gt;åäºŒè¦ç´ åº”ç”¨&lt;/a&gt;ã€‹ ï¼Œå¯ä»¥ç‚¹å‡»é“¾æ¥äº†è§£ä¸€ä¸‹ã€‚ç°ä»£åº”ç”¨ç¨‹åºçš„ä¸€ä¸ªå…³é”®æ¦‚å¿µæ˜¯æ— ç¯å¢ƒï¼Œå¯é€šè¿‡æ³¨å…¥çš„ç¯å¢ƒå˜é‡è¿›è¡Œé…ç½®ã€‚åº”ç”¨ç¨‹åºåº”å®Œå…¨ä¸å…¶æ‰€åœ¨ä½ç½®æ— å…³ã€‚&lt;strong&gt;ConfigMaps&lt;/strong&gt; åœ¨ K8S ä¸­å®ç°è¿™ä¸€é‡è¦æ¦‚å¿µã€‚å…¶æœ¬è´¨ä¸Šæ˜¯ç¯å¢ƒå˜é‡çš„ key-value åˆ—è¡¨ï¼Œè¿™äº›å˜é‡è¢«ä¼ é€’ç»™æ­£åœ¨è¿è¡Œçš„å·¥ä½œè´Ÿè½½ä»¥ç¡®å®šä¸åŒçš„ runtime è¡Œä¸ºã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Secrets&lt;/strong&gt; ä¸ &lt;strong&gt;ConfigMaps&lt;/strong&gt; ç±»ä¼¼ï¼Œé€šè¿‡åŠ å¯†çš„æ–¹å¼é˜²æ­¢å¯†é’¥ã€å¯†ç ã€è¯ä¹¦ç­‰æ•æ„Ÿä¿¡æ¯æ³„æ¼ã€‚&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;æˆ‘ä¸ªäººè®¤ä¸ºåœ¨ä»»ä½•ç³»ç»Ÿä¸Šä½¿ç”¨å¯†ç çš„æœ€ä½³é€‰æ‹©æ˜¯ Hashicorp çš„ Vault ã€‚è¯·åŠ¡å¿…é˜…è¯»æˆ‘å»å¹´å†™çš„å…³äºå®ƒçš„&lt;a href=&#34;https://medium.com/prodopsio/security-for-dummies-protecting-application-secrets-made-easy-5ef3f8b748f7&#34; target=&#34;_blank&#34;&gt;æ–‡ç« &lt;/a&gt;ï¼Œå…³äº Vault å¯ä»¥ä¸ºä½ çš„äº§å“æä¾›çš„åŠŸèƒ½ï¼Œä»¥åŠæˆ‘çš„ä¸€ä½åŒäº‹å†™çš„å¦ä¸€ç¯‡æ›´å…·æŠ€æœ¯æ€§çš„[æ–‡ç« ](&lt;a href=&#34;https://medium.com/prodopsio/taking-your-hashicorp-vault-to-the-next-level-8549e7988b24ï¼‰ã€‚&#34; target=&#34;_blank&#34;&gt;https://medium.com/prodopsio/taking-your-hashicorp-vault-to-the-next-level-8549e7988b24ï¼‰ã€‚&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h3 id=&#34;10-deployments&#34;&gt;10. Deployments&lt;/h3&gt;

&lt;p&gt;ä¸ºäº†ä½¿æ–°ç‰ˆæœ¬å¿«é€Ÿæ›¿æ¢åŸæœ‰çš„åº”ç”¨ç¨‹åºï¼Œæˆ‘ä»¬å¸Œæœ›å°†æ„å»ºã€æµ‹è¯•å’Œå‘å¸ƒåœ¨ä¸€å—æ¥å®ç° &lt;a href=&#34;https://www.ibm.com/developerworks/community/blogs/beingagile/entry/short_feedback_loops_everywhere?lang=en&#34; target=&#34;_blank&#34;&gt;short feedback loops&lt;/a&gt; ã€‚K8S ä½¿ç”¨ Deployments æ¥ä¸æ–­éƒ¨ç½²æ–°è½¯ä»¶ï¼ŒDeployments æ˜¯ä¸€ç»„ç”¨æ¥æè¿°ç‰¹å®šè¿è¡Œå·¥ä½œè´Ÿè½½çš„å…ƒæ•°æ®ã€‚ä¾‹å¦‚ï¼šå‘å¸ƒæ–°ç‰ˆæœ¬ï¼Œbug ä¿®å¤ï¼Œç”šè‡³æ˜¯å›æ»šï¼ˆè¿™æ˜¯k8sçš„å¦ä¸€ä¸ªå†…éƒ¨é€‰é¡¹ï¼‰ã€‚&lt;/p&gt;

&lt;p&gt;åœ¨ K8S ä¸­éƒ¨ç½²è½¯ä»¶æœ‰ä¸¤ä¸ªä¸»è¦&lt;strong&gt;ç­–ç•¥&lt;/strong&gt;ï¼š&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;&lt;p&gt;&lt;strong&gt;Replacement&lt;/strong&gt;ï¼šå°†ä½¿ç”¨æ–°å‰¯æœ¬æ›¿æ¢æ‚¨çš„æ•´ä¸ªå·¥ä½œè´Ÿè½½ï¼Œæ•´ä¸ªè¿‡ç¨‹éœ€è¦å¼ºåˆ¶åœæœºã€‚&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;&lt;strong&gt;RollingUpdate&lt;/strong&gt;ï¼šk8sé€šè¿‡ä¸¤ç§ç‰¹å®šé…ç½®æ¥å®ç°ä½¿ç”¨æ–°çš„ Pods å®ä¾‹æ»šåŠ¨æ›´æ–°ï¼š&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;&lt;code&gt;MaxAvailable&lt;/code&gt; ï¼š è¯¥è®¾ç½®è¡¨ç¤ºåœ¨éƒ¨ç½²æ–°ç‰ˆæœ¬æ—¶å¯ç”¨çš„å·¥ä½œè´Ÿè½½çš„ç™¾åˆ†æ¯”ï¼ˆæˆ–ç¡®åˆ‡æ•°é‡ï¼‰ï¼Œ100ï¼…è¡¨ç¤ºâ€œæˆ‘æœ‰2ä¸ªå®¹å™¨ï¼Œä¿æŒ2ä¸ªå­˜æ´»å¹¶åœ¨æ•´ä¸ªéƒ¨ç½²æœŸé—´æ­£å¸¸æä¾›æœåŠ¡â€ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;MaxSurge&lt;/code&gt; ï¼š è¯¥è®¾ç½®è¡¨ç¤ºå‡çº§æœŸé—´æ€» Pod æ•°æœ€å¤šå¯ä»¥è¶…å‡ºæœŸæœ›çš„ç™¾åˆ†æ¯”ï¼ˆæˆ–æ•°é‡ï¼‰ï¼Œ100ï¼…è¡¨ç¤ºâ€œæˆ‘æœ‰ X ä¸ªå®¹å™¨ï¼Œå†éƒ¨ç½² X ä¸ªå®¹å™¨ï¼Œç„¶åå¼€å§‹æ¨å‡ºæ—§å®¹å™¨â€ã€‚&lt;/li&gt;
&lt;/ol&gt;&lt;/li&gt;
&lt;/ol&gt;

&lt;h3 id=&#34;11-storage&#34;&gt;11. Storage&lt;/h3&gt;

&lt;p&gt;K8S åœ¨å­˜å‚¨ä¸Šæ·»åŠ äº†ä¸€å±‚æŠ½è±¡ï¼Œå·¥ä½œè´Ÿè½½å¯ä»¥ä¸ºä¸åŒçš„ä»»åŠ¡è¯·æ±‚ç‰¹å®šçš„å­˜å‚¨ï¼Œç”šè‡³å¯ä»¥ç®¡ç†æŒç»­çš„æ—¶é—´å¯ä»¥è¶…è¿‡æŸä¸ªpodçš„ç”Ÿå‘½å‘¨æœŸã€‚ä¸ºäº†ç®€çŸ­èµ·è§ï¼Œæˆ‘æƒ³å‘æ‚¨ä»‹ç»æˆ‘æœ€è¿‘å‘å¸ƒçš„å…³äºk8så­˜å‚¨çš„&lt;a href=&#34;https://medium.com/prodopsio/k8s-will-not-solve-your-storage-problems-5bda2e6180b5&#34; target=&#34;_blank&#34;&gt;æ–‡ç« &lt;/a&gt;ï¼Œç‰¹åˆ«æ˜¯ä¸ºä»€ä¹ˆå®ƒä¸èƒ½å®Œå…¨è§£å†³æ•°æ®åº“éƒ¨ç½²ç­‰æ•°æ®æŒä¹…æ€§è¦æ±‚ã€‚&lt;/p&gt;

&lt;h2 id=&#34;æ¦‚å¿µæ€§ç†è§£&#34;&gt;æ¦‚å¿µæ€§ç†è§£&lt;/h2&gt;

&lt;p&gt;K8S æ˜¯æ ¹æ®ä¸€äº›æŒ‡å¯¼æ–¹å‘è®¾è®¡å’Œå¼€å‘çš„ï¼Œè€ƒè™‘åˆ°ç¤¾åŒºçš„æ€§è´¨ï¼Œæ¯ä¸ªç‰¹å¾ã€æ¦‚å¿µå’Œæƒ³æ³•éƒ½è¢«å†…ç½®äºç³»ç»Ÿä¸­ã€‚æ­¤å¤–ï¼Œç»ˆç«¯ç”¨æˆ·ä¼šä»¥æŸç§æ–¹å¼ä½¿ç”¨è¯¥ç³»ç»Ÿï¼Œä½œä¸ºä¸€ä¸ªå¼€æºå’Œå…è´¹çš„ç³»ç»Ÿï¼Œä¸å±äºä»»ä½•äººï¼Œä½ å¯ä»¥ç”¨å®ƒåšä»»ä½•ä½ æƒ³è¦åšçš„äº‹ã€‚&lt;/p&gt;

&lt;p&gt;é¢å‘ API ï¼šç³»ç»Ÿä¸­çš„æ¯ä¸ªéƒ¨åˆ†éƒ½ä»¥ä¸€ç§å¯é€šè¿‡è®°å½•è‰¯å¥½ä¸”å¯æ“ä½œçš„ API è¿›è¡Œäº¤äº’çš„æ–¹å¼è¿›è¡Œæ„å»ºã€‚æ ¸å¿ƒå¼€å‘äººå‘˜ç¡®ä¿ä½œä¸ºç»ˆç«¯ç”¨æˆ·çš„æ‚¨å¯ä»¥è¿›è¡Œæ›´æ”¹ï¼ŒæŸ¥è¯¢å’Œæ›´æ–°ï¼Œç”¨æ¥æä¾›æ›´å¥½çš„ç”¨æˆ·ä½“éªŒã€‚&lt;/p&gt;

&lt;p&gt;å·¥å…·å‹å¥½ ï¼š ä½œä¸ºä¸Šé¢ä¸€ç‚¹çš„è¡ç”Ÿï¼ŒK8S æ˜¯çƒ­è¡·äºåœ¨å…¶ API å‘¨å›´åˆ›å»ºå·¥å…·çš„ã€‚å®ƒå°†è‡ªèº«åšä¸ºä¸€ä¸ªåŸå§‹å¹³å°ï¼Œä»¥å¯å®šåˆ¶çš„æ–¹å¼æ„å»ºï¼Œä»¥ä¾›å…¶ä»–äººä½¿ç”¨ï¼Œå¹¶è¿›ä¸€æ­¥å¼€å‘ç”¨äºä¸åŒçš„å·¥å…·ã€‚æœ‰äº›å·²ç»å˜å¾—éå¸¸æœ‰åå¹¶è¢«å¹¿æ³›ä½¿ç”¨ï¼Œå¦‚ Spinnaker ï¼ŒIstio å’Œè®¸å¤šå…¶ä»–åŠŸå·¥å…·ã€‚&lt;/p&gt;

&lt;p&gt;å£°æ˜æ€§çŠ¶æ€ ï¼š é¼“åŠ±ç”¨æˆ·ä½¿ç”¨å…·æœ‰å£°æ˜æ€§æè¿°çš„ç³»ç»Ÿè€Œä¸æ˜¯å‘½ä»¤å¼æè¿°ã€‚è¿™æ„å‘³ç€ç³»ç»Ÿçš„çŠ¶æ€å’Œç»„ä»¶æœ€å¥½è¢«æè¿°ä¸ºåœ¨æŸç§ç‰ˆæœ¬æ§åˆ¶ï¼ˆå¦‚ git ï¼‰ä¸­ç®¡ç†çš„ä»£ç ï¼Œè€Œä¸ä¼šå› ä¸ºæŸä¸€å¤„æ‰‹åŠ¨æ›´æ”¹ä¹Ÿå¯¹æ•´ä½“æœ‰å½±å“ã€‚è¿™æ ·ï¼Œk8sæ›´å®¹æ˜“&lt;a href=&#34;https://en.wikipedia.org/wiki/Disaster_recovery&#34; target=&#34;_blank&#34;&gt;ç¾éš¾æ¢å¤&lt;/a&gt; ï¼Œæ˜“äºåœ¨å›¢é˜Ÿä¹‹é—´åˆ†äº«å’Œä¼ é€’ã€‚&lt;/p&gt;

&lt;h2 id=&#34;æœ€å&#34;&gt;æœ€å&lt;/h2&gt;

&lt;p&gt;æœ¬æ–‡è¯•å›¾å°†é‡ç‚¹æ”¾åœ¨ K8S çš„ä»‹ç»å’Œä¸»è¦æ¦‚å¿µä¸Šï¼Œå½“ç„¶ï¼ŒK8S è¿˜æœ‰å…¶ä»–éå¸¸é‡è¦çš„é¢†åŸŸï¼Œæ¯”å¦‚ç‰©ç†ç³»ç»Ÿæ„å»ºæ¨¡å—ï¼Œå¦‚ &lt;code&gt;kubelet&lt;/code&gt;ï¼Œ &lt;code&gt;kube-proxy&lt;/code&gt; ï¼Œ &lt;code&gt;api-server&lt;/code&gt; å’Œç»ˆç«¯æ“ä½œå·¥å…·ï¼š&lt;code&gt;kubectl&lt;/code&gt;ã€‚æˆ‘å°†åœ¨ä¸‹ä¸€ç¯‡æ–‡ç« ä¸­è®¨è®ºä»¥åŠä»‹ç»è¿™äº›å¾ˆé…·çš„åŠŸèƒ½ã€‚&lt;/p&gt;

&lt;p&gt;åŸæ–‡åœ°å€ï¼š &lt;a href=&#34;https://medium.com/prodopsio/an-8-minute-introduction-to-k8s-94fda1fa5184&#34; target=&#34;_blank&#34;&gt;https://medium.com/prodopsio/an-8-minute-introduction-to-k8s-94fda1fa5184&lt;/a&gt;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>é˜¿é‡Œäº‘å®¹å™¨æœåŠ¡æ–°å»ºé›†ç¾¤ä¼˜åŒ–æ–¹æ¡ˆ(æ›´æ–°ç‰ˆ)</title>
      <link>https://guoxudong.io/en/post/aliyun-k8s-perfect/</link>
      <pubDate>Thu, 25 Apr 2019 22:26:06 +0800</pubDate>
      
      <guid>https://guoxudong.io/en/post/aliyun-k8s-perfect/</guid>
      <description>

&lt;h2 id=&#34;å‰è¨€&#34;&gt;å‰è¨€&lt;/h2&gt;

&lt;p&gt;é€‰æ‹©é˜¿é‡Œäº‘çš„&lt;code&gt;å®¹å™¨æœåŠ¡&lt;/code&gt;ï¼Œä¸»è¦åŸå› æ˜¯å…¬å¸ä¸»è¦ä¸šåŠ¡åŸºæœ¬éƒ½åœ¨è¿è¡Œåœ¨é˜¿é‡Œäº‘ä¸Šã€‚ç›¸è¾ƒè‡ªå»º kubernetes é›†ç¾¤ï¼Œå®¹å™¨æœåŠ¡çš„ä¼˜åŠ¿åœ¨äºéƒ¨ç½²ç›¸å¯¹ç®€å•ï¼Œä¸é˜¿é‡Œäº‘ VPC å®Œç¾å…¼å®¹ï¼Œç½‘ç»œçš„é…ç½®ç›¸å¯¹ç®€å•ï¼Œè€Œå¦‚æœä½¿ç”¨ &lt;code&gt;kubeadm&lt;/code&gt; å®‰è£…éƒ¨ç½² kubernetes é›†ç¾¤ï¼Œé™¤äº†ä¼—æ‰€å‘¨çŸ¥çš„ç§‘å­¦ä¸Šç½‘çš„é—®é¢˜ï¼Œè¿˜æœ‰ä¸€ç³»åˆ—çš„é—®é¢˜ï¼ŒåŒ…æ‹¬ &lt;code&gt;etcd&lt;/code&gt; ã€ &lt;code&gt;Scheduler&lt;/code&gt; å’Œ &lt;code&gt;Controller-Manager&lt;/code&gt; çš„é«˜å¯ç”¨é—®é¢˜ç­‰ã€‚å¹¶ä¸”å¦‚æœä½¿ç”¨æ‰˜ç®¡ç‰ˆçš„é˜¿é‡Œäº‘ kubernetes å®¹å™¨æœåŠ¡ï¼Œè¿˜ä¼šçœæ‰3å° master èŠ‚ç‚¹çš„é’±ï¼Œå¹¶ä¸”å¯èƒ½å°† master èŠ‚ç‚¹çš„è¿ç»´é—®é¢˜ä¸¢ç»™é˜¿é‡Œäº‘è§£å†³ï¼Œå¹¶ä¸”å…¶æä¾›çš„ master èŠ‚ç‚¹æ€§èƒ½è‚¯å®šä¼šæ¯”è‡ªè´­çš„é…ç½®å¥½ï¼Œè¿™ç‚¹æ˜¯é˜¿é‡Œäº‘å®¹å™¨æœåŠ¡çš„ç ”å‘å°å“¥åœ¨æ¥æˆ‘å¸äº¤æµæ—¶ä¸“é—¨å¼ºè°ƒçš„ã€‚&lt;/p&gt;

&lt;h2 id=&#34;é—®é¢˜&#34;&gt;é—®é¢˜&lt;/h2&gt;

&lt;p&gt;å‰é¢å¹äº†é˜¿é‡Œäº‘å®¹å™¨æœåŠ¡çš„ä¼˜åŠ¿ï¼Œé‚£è¿™é‡Œå°±è¯´è¯´åœ¨å®è·µä¸­é‡åˆ°çš„å®¹å™¨æœåŠ¡çš„é—®é¢˜ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;p&gt;åœ¨æ–°å»ºé›†ç¾¤çš„æ—¶å€™éœ€è¦é€‰æ‹©ç›¸åº”çš„ VPC å¹¶é€‰æ‹© &lt;code&gt;Pod&lt;/code&gt; å’Œ &lt;code&gt;Service&lt;/code&gt; æ‰€åœ¨çš„ç½‘æ®µï¼Œè¿™ä¸¤ä¸ªç½‘æ®µä¸èƒ½å’Œ Node èŠ‚ç‚¹å­˜åœ¨äºåŒä¸€ç½‘æ®µï¼Œä½†æ˜¯å¦‚æœæ‚¨åœ¨é˜¿é‡Œäº‘ä¸­å­˜åœ¨ä¸æ­¢ä¸€ä¸ª VPC ï¼ˆVPCçš„ç½‘æ®µå¯ä»¥æ˜¯ 10.0.0.0/8ï¼Œ172.16-31.0.0/12-16ï¼Œ192.168.0.0/16 ï¼‰ï¼Œå¦‚æœç½‘æ®µè®¾ç½®ä¸å¯¹çš„è¯ï¼Œå°±å¯èƒ½ä¼šä½¿åŸæœ¬å­˜åœ¨è¯¥ç½‘æ®µçš„ ECS å¤±è”ï¼Œéœ€è¦åˆ é™¤é›†ç¾¤é‡æ–°åˆ›å»ºã€‚å¦‚æœåˆ é™¤å¤±è´¥çš„è¯ï¼Œè¿˜éœ€è¦æ‰‹åŠ¨åˆ é™¤è·¯ç”±è¡¨ä¸­çš„è®°å½•ï¼ˆ&lt;strong&gt;åˆ«é—®æˆ‘æ˜¯æ€ä¹ˆçŸ¥é“çš„&lt;/strong&gt;ï¼‰ã€‚&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;åœ¨ä½¿ç”¨å®¹å™¨æœåŠ¡åˆ›å»ºé›†ç¾¤åï¼Œä¼šåˆ›å»º2ä¸ª SLB ï¼ˆä¹‹å‰æ˜¯3ä¸ªï¼‰ï¼Œä¸€ä¸ªæ˜¯ SLB æ˜¯åœ¨ VPC ä¸Šå¹¶ä¸”ç»‘å®šä¸€ä¸ªå¼¹æ€§IPï¼ˆéœ€è¦åœ¨åˆ›å»ºçš„æ—¶å€™æ‰‹åŠ¨å‹¾é€‰åˆ›å»ºå¼¹æ€§IPï¼‰ç”¨äº API Serverï¼Œä¸€ä¸ªæ˜¯ç»å…¸ç½‘ç»œçš„ SLB ä½¿ç”¨æä¾›ç»™ Ingress ä½¿ç”¨ã€‚ä½†æ˜¯è¿™ä¸¤ä¸ªå¤–ç½‘IPåˆ›å»ºåçš„è§„æ ¼éƒ½æ˜¯é»˜è®¤æœ€å¤§å¸¦å®½ã€æŒ‰æµé‡æ”¶è´¹ï¼Œè¿™ä¸ªå¹¶ä¸ç¬¦åˆæˆ‘ä»¬çš„è¦æ±‚ï¼Œéœ€è¦æ‰‹åŠ¨ä¿®æ”¹ï¼Œ&lt;del&gt;ç„¶è€Œè¿™ä¸ªä¿®æ”¹éƒ½ä¼šåœ¨ç¬¬äºŒå¤©æ‰èƒ½ç”Ÿæ•ˆ&lt;/del&gt;ã€‚&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;å®¹å™¨æœåŠ¡åˆ›å»ºé›†ç¾¤åï¼ŒNode èŠ‚ç‚¹çš„åç§°ä¼šä½¿&lt;code&gt;{region-id}.{ECS-id}&lt;/code&gt;çš„å½¢å¼ï¼Œè¿™ä¸ªå‘½åæ–¹å¼åœ¨é›†ç¾¤ç›‘æ§ï¼Œä½¿ç”¨ &lt;code&gt;kubectl&lt;/code&gt; æ“ä½œé›†ç¾¤æ–¹é¢å°±æ˜¾å¾—æ¯”è¾ƒåäººç±»äº†ï¼Œæ¯æ¬¡éƒ½è¦å»æŸ¥ &lt;code&gt;ECS id&lt;/code&gt; æ‰èƒ½ç¡®å®šæ˜¯å“ªä¸ªèŠ‚ç‚¹ï¼Œè€Œè¿™ä¸ª Node èŠ‚ç‚¹åç§°æ˜¯ä¸èƒ½ä¿®æ”¹çš„ï¼&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;ç½‘æ®µé—®é¢˜è§£å†³&#34;&gt;ç½‘æ®µé—®é¢˜è§£å†³&lt;/h2&gt;

&lt;p&gt;è¿™ä¸ªæ¯”è¾ƒå¥½è§£å†³ï¼Œç”šè‡³å¯ä»¥è¯´ä¸ç”¨è§£å†³ï¼Œåªè¦æŠŠç½‘æ®µè§„åˆ’å¥½ï¼Œä¸è¦å‡ºç°ç½‘æ®µå†²çªå°±å¥½&lt;/p&gt;

&lt;h2 id=&#34;node-èŠ‚ç‚¹åç§°æ— æ³•ä¿®æ”¹é—®é¢˜è§£å†³&#34;&gt;Node èŠ‚ç‚¹åç§°æ— æ³•ä¿®æ”¹é—®é¢˜è§£å†³&lt;/h2&gt;

&lt;p&gt;è¿™ä¸ªåŠŸèƒ½ä¹‹å‰å·²æœ‰äººåœ¨é˜¿é‡Œè†å¬å¹³å°æå‡ºè¿™ä¸ªé—®é¢˜äº†ï¼Œå’¨è¯¢äº†å®¹å™¨æœåŠ¡çš„ç ”å‘å°å“¥ï¼Œå¾—åˆ°çš„åé¦ˆæ˜¯è¯¥åŠŸèƒ½å·²ç»åœ¨ç°åº¦æµ‹è¯•äº†ï¼Œç›¸ä¿¡å¾ˆå¿«å°±å¯ä»¥ä¸Šçº¿äº†ã€‚&lt;/p&gt;

&lt;h2 id=&#34;åˆ›å»º-slb-è§„æ ¼é—®é¢˜è§£å†³&#34;&gt;åˆ›å»º SLB è§„æ ¼é—®é¢˜è§£å†³&lt;/h2&gt;

&lt;p&gt;ç›¸è¾ƒä¹‹å‰è‡ªåŠ¨åˆ›å»º3ä¸ª SLB çš„æ–¹å¼ï¼Œç›®å‰çš„ç‰ˆæœ¬åªä¼šè‡ªåŠ¨åˆ›å»º2ä¸ªå¹¶ä¸”æœ‰ä¸€ä¸ªæ˜¯ VPC å†…ç½‘+å¼¹æ€§IPçš„æ–¹å¼ï¼Œå·²ç»è¿›è¡Œäº†ä¼˜åŒ–ï¼Œä½†æ˜¯ ingress ç»‘å®šçš„ SLB è¿˜æ˜¯ç»å…¸ç½‘ç»œç±»å‹ï¼Œæ— æ³•æ¥å…¥äº‘é˜²ç«å¢™å¹¶ä¸”è§„æ ¼ä¹Ÿæ˜¯ä¸åˆé€‚çš„ã€‚è¿™é‡Œç»™å‡ºè§£å†³æ–¹æ¡ˆï¼š&lt;/p&gt;

&lt;h3 id=&#34;æ–¹æ³•ä¸€-ä½¿ç”¨-kubectl-é…ç½®&#34;&gt;æ–¹æ³•ä¸€ï¼šä½¿ç”¨ &lt;code&gt;kubectl&lt;/code&gt; é…ç½®&lt;/h3&gt;

&lt;h4 id=&#34;1-åˆ›å»ºæ–°çš„-slb&#34;&gt;1. åˆ›å»ºæ–°çš„ SLB&lt;/h4&gt;

&lt;ul&gt;
&lt;li&gt;è¿™é‡Œéœ€è¦åˆ›å»ºä¸€ä¸ªæ–°çš„ SLB ç”¨æ¥ä»£æ›¿è‡ªåŠ¨åˆ›å»ºçš„ä¸ç¬¦åˆè¦æ±‚çš„ SLBã€‚è¿™é‡Œå¯ä»¥å…ˆç§ç½‘ SLB å…ˆä¸ç»‘å®šå¼¹æ€§IPã€‚&lt;strong&gt;&lt;em&gt;è¿™é‡Œè¦æ³¨æ„çš„äº‹ï¼Œæ–°å»ºçš„ SLB éœ€è¦ä¸ k8sé›†ç¾¤å¤„äºåŒä¸€ VPC å†…ï¼Œå¦åˆ™åœ¨åç»­ä¼šç»‘å®šå¤±è´¥&lt;/em&gt;&lt;/strong&gt;ã€‚
&lt;img src=&#34;https://wx4.sinaimg.cn/large/ad5fbf65gy1g1ma5lxgvdj21ws0s6qa5.jpg&#34; alt=&#34;image&#34; /&gt;&lt;/li&gt;
&lt;li&gt;æŸ¥çœ‹æ–°è´­ä¹° SLB çš„ ID
&lt;img src=&#34;https://wx4.sinaimg.cn/large/ad5fbf65gy1g1ma8zuq1gj20sa0hoq4b.jpg&#34; alt=&#34;image&#34; /&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&#34;2-åœ¨åˆ›å»ºé›†ç¾¤åé‡æ–°ç»‘å®š-ingress-controller-çš„-service&#34;&gt;2. åœ¨åˆ›å»ºé›†ç¾¤åé‡æ–°ç»‘å®š &lt;code&gt;ingress-controller&lt;/code&gt; çš„ &lt;code&gt;Service&lt;/code&gt;&lt;/h4&gt;

&lt;p&gt;é¦–å…ˆéœ€è¦ä½¿ç”¨ &lt;code&gt;kubectl&lt;/code&gt; æˆ–è€…ç›´æ¥åœ¨é˜¿é‡Œäº‘æ§åˆ¶å°æ“ä½œï¼Œåˆ›å»ºæ–°çš„ &lt;code&gt;nginx-ingress-svc&lt;/code&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-yaml&#34;&gt;# nginx ingress service
apiVersion: v1
kind: Service
metadata:
name: nginx-ingress-lb-{new-name}
namespace: kube-system
labels:
    app: nginx-ingress-lb-{new-name}
annotations:
    # set loadbalancer to the specified slb id
    service.beta.kubernetes.io/alicloud-loadbalancer-id: {SLB-ID}
    # set loadbalancer address type to intranet if using private slb instance
    #service.beta.kubernetes.io/alicloud-loadbalancer-address-type: intranet
    service.beta.kubernetes.io/alicloud-loadbalancer-force-override-listeners: &#39;true&#39;
    #service.beta.kubernetes.io/alicloud-loadbalancer-backend-label: node-role.kubernetes.io/ingress=true
spec:
type: LoadBalancer
# do not route traffic to other nodes
# and reserve client ip for upstream
externalTrafficPolicy: &amp;quot;Local&amp;quot;
ports:
- port: 80
    name: http
    targetPort: 80
- port: 443
    name: https
    targetPort: 443
selector:
    # select app=ingress-nginx pods
    app: ingress-nginx
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;åˆ›å»ºæˆåŠŸåï¼Œå¯ä»¥è¿›åˆ° SLB é¡µé¢æŸ¥çœ‹ï¼Œå¯ä»¥çœ‹åˆ° &lt;code&gt;80&lt;/code&gt; å’Œ &lt;code&gt;443&lt;/code&gt; ç«¯å£çš„ç›‘å¬å·²ç»è¢«æ·»åŠ äº†
    &lt;img src=&#34;https://wx4.sinaimg.cn/large/ad5fbf65gy1g1maej57c1j21ru0rwq8b.jpg&#34; alt=&#34;image&#34; /&gt;&lt;/p&gt;

&lt;h4 id=&#34;3-ç»‘å®šç¬¦åˆè¦æ±‚çš„å¼¹æ€§ip&#34;&gt;3. ç»‘å®šç¬¦åˆè¦æ±‚çš„å¼¹æ€§IP&lt;/h4&gt;

&lt;p&gt;ç¡®å®š SLB åˆ›å»ºæˆåŠŸå¹¶ä¸”å·²ç»æˆåŠŸç›‘å¬åï¼Œè¿™é‡Œå°±å¯ä»¥ä¸º SLB ç»‘å®šç¬¦åˆæ‚¨éœ€æ±‚çš„å¼¹æ€§IPäº†ï¼Œè¿™é‡Œæˆ‘ä»¬ç»‘å®šä¸€ä¸ªæŒ‰å®½å¸¦è®¡è´¹2Mçš„å¼¹æ€§IP&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://wx4.sinaimg.cn/large/ad5fbf65gy1g1mak2r0p3j207k07mq33.jpg&#34; alt=&#34;image&#34; /&gt;&lt;/p&gt;

&lt;h4 id=&#34;4-éªŒè¯è¿é€šæ€§&#34;&gt;4. éªŒè¯è¿é€šæ€§&lt;/h4&gt;

&lt;p&gt;åˆ°ä¸Šé¢è¿™æ­¥ï¼Œæˆ‘ä»¬çš„ ingress å…¥å£ SLB å·²ç»åˆ›å»ºå®Œæˆï¼Œè¿™é‡Œæˆ‘ä»¬éªŒè¯ä¸€ä¸‹æ˜¯å¦è”é€šã€‚&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;p&gt;åœ¨k8sé›†ç¾¤ä¸­éƒ¨ç½²ä¸€ä¸ª &lt;code&gt;nginx&lt;/code&gt; ï¼Œç›´æ¥åœ¨é˜¿é‡Œäº‘å®¹å™¨æœåŠ¡æ§åˆ¶å°æ“ä½œå³å¯
&lt;img src=&#34;https://wx4.sinaimg.cn/large/ad5fbf65gy1g1mant7ec6j21s40qegpr.jpg&#34; alt=&#34;image&#34; /&gt;
è¿™é‡Œåˆ›å»º ingress è·¯ç”±ï¼Œ&lt;strong&gt;æ³¨æ„ï¼šè¿™é‡Œçš„åŸŸåéœ€è¦è§£æåˆ°åˆšæ‰åˆ›å»ºçš„ SLB ç»‘å®šçš„å¼¹æ€§IP&lt;/strong&gt;
&lt;img src=&#34;https://wx4.sinaimg.cn/large/ad5fbf65gy1g1maqf7gdjj21ns0kymz8.jpg&#34; alt=&#34;image&#34; /&gt;&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;è®¿é—®è¯¥åŸŸåï¼Œæ˜¾ç¤º &lt;code&gt;nginx&lt;/code&gt; æ¬¢è¿é¡µï¼Œåˆ™è¯æ˜ä¿®æ”¹æˆåŠŸ
&lt;img src=&#34;https://wx4.sinaimg.cn/large/ad5fbf65gy1g1mat8srhnj21ak0hmact.jpg&#34; alt=&#34;image&#34; /&gt;&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&#34;æ–¹æ³•äºŒ-ä½¿ç”¨é˜¿é‡Œäº‘å®¹å™¨æœåŠ¡æ§åˆ¶å°é…ç½®&#34;&gt;æ–¹æ³•äºŒï¼š ä½¿ç”¨é˜¿é‡Œäº‘å®¹å™¨æœåŠ¡æ§åˆ¶å°é…ç½®&lt;/h3&gt;

&lt;h4 id=&#34;1-é˜¿é‡Œäº‘å®¹å™¨æ§åˆ¶å°åˆ›å»ºæ–°-service&#34;&gt;1. é˜¿é‡Œäº‘å®¹å™¨æ§åˆ¶å°åˆ›å»ºæ–° &lt;code&gt;service&lt;/code&gt;&lt;/h4&gt;

&lt;ul&gt;
&lt;li&gt;åœ¨é˜¿é‡Œäº‘å®¹å™¨æœåŠ¡æ§åˆ¶å°ï¼š&lt;code&gt;è·¯ç”±ä¸è´Ÿè½½å‡è¡¡&lt;/code&gt; &amp;ndash;&amp;gt; &lt;code&gt;æœåŠ¡&lt;/code&gt; ç‚¹å‡»&lt;code&gt;åˆ›å»º&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;é€‰æ‹© &lt;code&gt;kube-system&lt;/code&gt; å‘½åç©ºé—´&lt;/li&gt;
&lt;li&gt;ç±»å‹é€‰ä¸­&lt;code&gt;è´Ÿè½½å‡è¡¡&lt;/code&gt; - &lt;code&gt;å†…ç½‘è®¿é—®&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;å…³è” &lt;code&gt;nginx-ingress-controller&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;å¹¶æ·»åŠ ç«¯å£æ˜ å°„&lt;/li&gt;
&lt;li&gt;ç‚¹å‡»åˆ›å»º&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;img src=&#34;https://wx4.sinaimg.cn/large/ad5fbf65gy1g2g4fwfgevj20i50hsgmp.jpg&#34; alt=&#34;image&#34; /&gt;&lt;/p&gt;

&lt;h4 id=&#34;2-è¿›å…¥è´Ÿè½½å‡è¡¡æŸ¥çœ‹-slb-æ˜¯å¦åˆ›å»º&#34;&gt;2. è¿›å…¥è´Ÿè½½å‡è¡¡æŸ¥çœ‹ SLB æ˜¯å¦åˆ›å»º&lt;/h4&gt;

&lt;p&gt;å¯è§ SLB å·²ç»æˆåŠŸåˆ›å»º&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://wx4.sinaimg.cn/large/ad5fbf65gy1g2g4pb1d45j215303c74r.jpg&#34; alt=&#34;image&#34; /&gt;&lt;/p&gt;

&lt;h4 id=&#34;3-ç»‘å®šç¬¦åˆè¦æ±‚çš„å¼¹æ€§ip-1&#34;&gt;3. ç»‘å®šç¬¦åˆè¦æ±‚çš„å¼¹æ€§IP&lt;/h4&gt;

&lt;p&gt;åŒæ–¹æ³•ä¸€&lt;/p&gt;

&lt;h4 id=&#34;4-éªŒè¯è¿é€šæ€§-1&#34;&gt;4.éªŒè¯è¿é€šæ€§&lt;/h4&gt;

&lt;p&gt;åŒæ–¹æ³•ä¸€&lt;/p&gt;

&lt;h3 id=&#34;åç»­æ“ä½œ&#34;&gt;åç»­æ“ä½œ&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;åœ¨ç¡®å®šæ–°çš„ SLB åˆ›å»ºæˆåŠŸåï¼Œå°±å¯ä»¥å°†å®¹å™¨æœåŠ¡è‡ªåŠ¨åˆ›å»ºçš„ SLB é‡Šæ”¾äº†&lt;/li&gt;
&lt;li&gt;åˆ é™¤ &lt;code&gt;kube-system&lt;/code&gt; ä¸­åŸæœ¬ç»‘å®šçš„ &lt;code&gt;Service&lt;/code&gt; &lt;strong&gt;ï¼ˆç›®å‰ç‰ˆæœ¬å·²ç»å¯ä»¥å…³è”åˆ é™¤ç»‘å®šçš„ SLB äº†ï¼Œä¸ç”¨åˆ†å¼€æ“ä½œï¼‰&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è¿™é‡Œåˆ«å¿˜äº†ï¼Œè‡ªåŠ¨åˆ›å»ºç»™API Server çš„SLBè¿˜æ˜¯æŒ‰æµé‡ä»˜è´¹çš„ï¼Œè®°å¾—é™é…&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;åè®°&#34;&gt;åè®°&lt;/h2&gt;

&lt;p&gt;ä¸Šé¢çš„è¿™äº›é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆéƒ½å±äºä¸´æ—¶æ–¹æ¡ˆï¼Œå·²åœ¨é˜¿é‡Œçš„è†å¬å¹³å°æå‡ºäº†ä¸Šé¢çš„é—®é¢˜ï¼Œç›¸ä¿¡å¾ˆå¿«å°±ä¼šæœ‰æ‰€æ”¹è¿›ã€‚æ€»çš„æ¥è¯´ï¼Œé˜¿é‡Œäº‘å®¹å™¨æœåŠ¡åœ¨æä¾›ä¼˜è´¨çš„ kubernetes åŠŸèƒ½ï¼Œå¹¶ä¸”åªæ”¶ ECS çš„é’±ï¼Œå¯¹äºæƒ³å­¦ä¹  kubernetes åˆæ²¡æœ‰å¤ªå¤šèµ„é‡‘çš„åŒå­¦ä¹Ÿæ¯”è¾ƒå‹å¥½ï¼Œç›´æ¥ä¹°æŒ‰é‡ä»˜è´¹å®ä¾‹ï¼Œæµ‹è¯•å®Œé‡Šæ”¾å³å¯ï¼Œä¸ç”¨è´­ä¹° master èŠ‚ç‚¹ï¼Œååˆ†è‰¯å¿ƒï¼&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>å›°éš¾çš„ Kubernetes</title>
      <link>https://guoxudong.io/en/post/kubernetes-is-har/</link>
      <pubDate>Wed, 24 Apr 2019 10:18:46 +0800</pubDate>
      
      <guid>https://guoxudong.io/en/post/kubernetes-is-har/</guid>
      <description>

&lt;blockquote&gt;
&lt;p&gt;è™½ç„¶ Kubernetes èµ¢å¾—äº†å®¹å™¨ä¹‹ç«™ï¼Œä½†æ˜¯å…¶ä»ç„¶å¾ˆéš¾ä½¿ç”¨å¹¶ä¸”æ—¶é•¿å¼•èµ·äº‹æ•…ã€‚&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;æˆ‘æƒ³æˆ‘åº”è¯¥ç»™è¿™ç¯‡æ–‡ç« åšä¸€ç‚¹åºè¨€ã€‚ &lt;a href=&#34;https://kubernetes.io/&#34; target=&#34;_blank&#34;&gt;kubernetes&lt;/a&gt; ä¸ºè®¸å¤šåº”ç”¨ç¨‹åºæä¾›æ–°çš„ runtime ï¼Œå¦‚æœä½¿ç”¨å¾—å½“ï¼Œå®ƒå¯ä»¥æˆä¸ºä¸€ä¸ªå¼ºå¤§çš„å·¥å…·ï¼Œå¹¶ä¸”å¯ä»¥å°†æ‚¨å†²å¤æ‚çš„å¼€å‘ç”Ÿå‘½å‘¨æœŸä¸­è§£æ”¾å‡ºæ¥ã€‚ç„¶è€Œåœ¨è¿‡å»çš„å‡ å¹´é‡Œï¼Œæˆ‘çœ‹åˆ°å¾ˆå¤šäººå’Œå…¬å¸éƒ½ä¼šæ­å»ºä»–ä»¬çš„ Kubernetes ï¼Œä½†å¸¸å¸¸åªæ˜¯å¤„äºæµ‹è¯•é˜¶æ®µï¼Œä»æœªè¿›å…¥åˆ°ç”Ÿäº§ã€‚&lt;/p&gt;

&lt;h2 id=&#34;kubernetes-æ˜¯å¦‚ä½•è¿ä½œçš„&#34;&gt;Kubernetes æ˜¯å¦‚ä½•è¿ä½œçš„ï¼Ÿ&lt;/h2&gt;

&lt;p&gt;ç²—ç•¥çš„è®²ï¼Œ Kubernetes æˆ–è€… K8S çœ‹èµ·æ¥ååˆ†ç®€å•ã€‚æ‚¨è¿è¡Œçš„ Kubernetes èŠ‚ç‚¹è‡³å°‘è¢«åˆ†ä¸ºä¸¤ç±»ï¼šMaster å’Œ Workersã€‚Master èŠ‚ç‚¹é€šå¸¸ä¸è¿è¡Œä»»ä½•çœŸå®çš„å·¥ä½œè´Ÿè½½ï¼Œé‚£æ˜¯ Workers èŠ‚ç‚¹çš„å·¥ä½œã€‚&lt;/p&gt;

&lt;p&gt;Kubernetes çš„ Master èŠ‚ç‚¹åŒ…å«ä¸€ä¸ªåå« API server çš„ç»„ä»¶ï¼Œå…¶æä¾›çš„ API å¯ä»¥é€šè¿‡ &lt;code&gt;kubectl&lt;/code&gt; è°ƒç”¨ã€‚æ­¤å¤–è¿˜åŒ…æ‹¬ä¸€ä¸ª scheduler ï¼Œè´Ÿè´£è°ƒåº¦å®¹å™¨ï¼Œå†³å®šå®¹å™¨è¿è¡Œåœ¨å“ªä¸ªèŠ‚ç‚¹ã€‚æœ€åä¸€ä¸ªç»„ä»¶æ˜¯ controller-manager ï¼Œå®ƒå®é™…ä¸Šæ˜¯ä¸€ç»„å¤šä¸ªæ§åˆ¶å™¨ï¼Œè´Ÿè´£å¤„ç†èŠ‚ç‚¹ä¸­æ–­ã€å¤åˆ¶ã€åŠ å…¥ services å’Œ pods ï¼Œå¹¶ä¸”å¤„ç†æˆæƒç›¸å…³å†…å®¹ã€‚æ‰€æœ‰çš„æ•°æ®éƒ½å­˜å‚¨åœ¨ etcd ä¸­ï¼Œè¿™æ˜¯ä¸€ä¸ªå¯ä¿¡èµ–çš„åˆ†å¸ƒå¼é”®å€¼å­˜å‚¨æœåŠ¡ï¼ˆåŒ…å«ä¸€äº›éå¸¸é…·çš„åŠŸèƒ½ï¼‰ã€‚æ€»è€Œè¨€ä¹‹ï¼ŒMaster èŠ‚ç‚¹è´Ÿè´£ç®¡ç†é›†ç¾¤ï¼Œè¿™é‡Œæ²¡ä»€ä¹ˆç‰¹åˆ«å¤§çš„æƒŠå–œã€‚&lt;/p&gt;

&lt;p&gt;å¦ä¸€æ–¹é¢ï¼Œ çœŸå®çš„å·¥ä½œè´Ÿè½½è¿è¡Œåœ¨ Worker èŠ‚ç‚¹ä¸Šã€‚ä¸ºæ­¤ï¼Œå®ƒè¿˜åŒ…æ‹¬è®¸å¤šç»„ä»¶ã€‚é¦–å…ˆï¼ŒWorker èŠ‚ç‚¹ä¸Šä¼šè¿è¡Œ &lt;strong&gt;&lt;em&gt;kubelet&lt;/em&gt;&lt;/strong&gt; ï¼Œå®ƒæ˜¯ä¸è¯¥èŠ‚ç‚¹ä¸Šçš„å®¹å™¨ä¸€èµ·è¿è¡Œçš„ API ï¼Œè´Ÿè´£ä¸ç®¡æ§ç»„ä»¶æ²Ÿé€šï¼Œå¹¶æŒ‰ç…§ç®¡æ§ç»„ä»¶æŒ‡ç¤ºç®¡ç† Worker èŠ‚ç‚¹ã€‚å¦ä¸€ä¸ªç»„ä»¶å°±æ˜¯ &lt;strong&gt;&lt;em&gt;kube-proxy&lt;/em&gt;&lt;/strong&gt; ï¼Œå…¶è´Ÿè´£è½¬å‘ç½‘ç»œè¿æ¥ï¼Œæ ¹æ®æ‚¨çš„é…ç½®è¿è¡Œå®¹å™¨ã€‚å¯èƒ½è¿˜æœ‰å…¶ä»–ä¸œè¥¿ï¼Œå¦‚ &lt;strong&gt;&lt;em&gt;kube-dns&lt;/em&gt;&lt;/strong&gt; æˆ– &lt;strong&gt;&lt;em&gt;gVisor&lt;/em&gt;&lt;/strong&gt;ã€‚æ‚¨è¿˜éœ€è¦é›†æˆæŸç§ &lt;strong&gt;&lt;em&gt;overlay network&lt;/em&gt;&lt;/strong&gt; æˆ–åº•å±‚ç½‘ç»œè®¾ç½®ï¼Œä»¥ä¾¿ Kubernetes å¯ä»¥ç®¡ç†æ‚¨çš„ pod ä¹‹é—´çš„ç½‘ç»œã€‚&lt;/p&gt;

&lt;p&gt;å¦‚æœæ‚¨æƒ³è¦ä¸€ä¸ªæ›´å®Œæ•´çš„æ¦‚è¿°ï¼Œå»ºè®®å»çœ‹ Kelsey Hightowers çš„ &lt;a href=&#34;https://github.com/kelseyhightower/kubernetes-the-hard-way&#34; target=&#34;_blank&#34;&gt;Kubernetes  -  The Hard Way&lt;/a&gt;ã€‚&lt;/p&gt;

&lt;h2 id=&#34;ç”Ÿäº§å°±ç»ªçš„-kubernetes&#34;&gt;ç”Ÿäº§å°±ç»ªçš„ Kubernetes&lt;/h2&gt;

&lt;p&gt;åˆ°ç›®å‰ä¸ºæ­¢ï¼Œè¿™å¬èµ·æ¥å¹¶ä¸å¤ªç³Ÿç³•ã€‚åªæ˜¯å®‰è£…å‡ ä¸ªç¨‹åºã€é…ç½®ã€è¯ä¹¦ç­‰ã€‚ä¸è¦è¯¯ä¼šæˆ‘çš„æ„æ€ï¼Œè¿™ä»ç„¶æ˜¯ä¸€ä¸ªå­¦ä¹ æ›²çº¿ï¼Œä½†è¿™ä¹Ÿä¸æ˜¯ç³»ç»Ÿç®¡ç†å‘˜ä¸èƒ½å¤„ç†çš„é—®é¢˜ã€‚&lt;/p&gt;

&lt;p&gt;ç„¶è€Œï¼Œç®€å•åœ°æ‰‹åŠ¨å®‰è£… Kubernetes å¹¶ä¸ä»£è¡¨å…¶å·²ç»å®Œå…¨å‡†å¤‡å°±ç»ªï¼Œæ‰€ä»¥è®©æˆ‘ä»¬è°ˆè°ˆè®©è¿™ä¸ªä¸œè¥¿è¿è¡Œèµ·æ¥æ‰€éœ€çš„æ­¥éª¤ã€‚&lt;/p&gt;

&lt;p&gt;é¦–å…ˆï¼Œ&lt;strong&gt;å®‰è£…&lt;/strong&gt;ã€‚å¦‚æœæ‚¨æƒ³è¦æŸç§è‡ªåŠ¨å®‰è£…ï¼Œæ— è®ºæ˜¯ä½¿ç”¨ Ansible ï¼Œ Terraform è¿˜æ˜¯å…¶ä»–å·¥å…·ã€‚&lt;a href=&#34;https://github.com/kubernetes/kops&#34; target=&#34;_blank&#34;&gt;kops&lt;/a&gt; å¯ä»¥å¸®åŠ©æ‚¨è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä½†æ˜¯ä½¿ç”¨ kops æ„å‘³ç€æ‚¨å°†ä¸çŸ¥é“å®ƒæ˜¯å¦‚ä½•è®¾ç½®çš„ï¼Œå¹¶ä¸”å½“æ‚¨ä»¥åæƒ³è¦è°ƒè¯•æŸäº›ä¸œè¥¿æ—¶å¯èƒ½ä¼šå¼•èµ·ä¸€äº›å…¶ä»–é—®é¢˜ã€‚åº”å¯¹æ­¤è‡ªåŠ¨åŒ–è¿›è¡Œæµ‹è¯•ï¼Œå¹¶å®šæœŸè¿›è¡Œæ£€æŸ¥ã€‚&lt;/p&gt;

&lt;p&gt;å…¶æ¬¡ï¼Œæ‚¨éœ€è¦&lt;strong&gt;ç›‘æ§&lt;/strong&gt;æ‚¨çš„ Kubernetes å®‰è£…ã€‚æ‰€ä»¥æ‚¨éœ€è¦ &lt;a href=&#34;https://prometheus.io/&#34; target=&#34;_blank&#34;&gt;Prometheus&lt;/a&gt; ã€ &lt;a href=&#34;https://grafana.com/&#34; target=&#34;_blank&#34;&gt;Grafana&lt;/a&gt; ç­‰å·¥å…·ã€‚æ‚¨æ˜¯åœ¨ Kubernetes é‡Œé¢è¿è¡Œå®ƒå—ï¼Ÿ å¦‚æœæ‚¨çš„ Kubernetes æœ‰é—®é¢˜ï¼Œé‚£ä¹ˆæ‚¨çš„ç›‘æ§æ˜¯å¦ä¼šä¹Ÿä¼šæŒ‚æ‰ï¼Ÿ æˆ–è€…æ‚¨å•ç‹¬è¿è¡Œå®ƒï¼Ÿ å¦‚æœæ˜¯ï¼Œé‚£ä¹ˆæ‚¨åœ¨å“ªé‡Œè¿è¡Œå®ƒï¼Ÿ&lt;/p&gt;

&lt;p&gt;å¦å¤–å€¼å¾—æ³¨æ„çš„æ˜¯&lt;strong&gt;å¤‡ä»½&lt;/strong&gt;ã€‚å¦‚æœæ‚¨çš„ Master å´©æºƒï¼Œæ•°æ®æ— æ³•æ¢å¤å¹¶ä¸”æ‚¨éœ€è¦é‡æ–°é…ç½®ç³»ç»Ÿä¸Šçš„æ‰€æœ‰ pod ï¼Œæ‚¨ä¼šæ€ä¹ˆåšï¼Ÿæ‚¨æ˜¯å¦æµ‹è¯•äº†å†æ¬¡è¿è¡Œ CI ç³»ç»Ÿä¸­æ‰€æœ‰ä½œä¸šæ‰€éœ€çš„æ—¶é—´ï¼Ÿæ‚¨æœ‰ç¾éš¾æ¢å¤è®¡åˆ’å—ï¼Ÿ&lt;/p&gt;

&lt;p&gt;ç°åœ¨ï¼Œæ—¢ç„¶æˆ‘ä»¬åœ¨è°ˆè®º CI ç³»ç»Ÿï¼Œé‚£ä¹ˆæ‚¨éœ€è¦ä¸ºæ‚¨çš„é•œåƒè¿è¡Œ Docker é•œåƒä»“åº“ã€‚å½“ç„¶ï¼Œæ‚¨å¯ä»¥å†æ¬¡åœ¨ Kubernetes ä¸Šåšï¼Œä½†å¦‚æœ Kubernetes å´©æºƒ&amp;hellip;&amp;hellip;æ‚¨çŸ¥é“è¿™ä¸ªåæœã€‚å½“ç„¶ï¼ŒCI ç³»ç»Ÿä¸è¿è¡Œç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿéƒ½æœ‰è¿™ä¸ªé—®é¢˜ã€‚ç†æƒ³æƒ…å†µä¸‹ï¼Œè¿™äº›ç³»ç»Ÿæ˜¯ä¸ç”Ÿäº§ç¯å¢ƒéš”ç¦»çš„ï¼Œä»¥ä¾¿åœ¨ç³»ç»Ÿå‡ºç°é—®é¢˜æ—¶ï¼Œè‡³å°‘å¯ä»¥è®¿é—® git ï¼Œæ¥è¿›è¡Œé‡æ–°éƒ¨ç½²ç­‰æ“ä½œã€‚&lt;/p&gt;

&lt;h2 id=&#34;æ•°æ®å­˜å‚¨&#34;&gt;æ•°æ®å­˜å‚¨&lt;/h2&gt;

&lt;p&gt;æœ€åï¼Œæˆ‘ä»¬æ¥è°ˆè°ˆæœ€é‡è¦çš„éƒ¨åˆ†ï¼šå­˜å‚¨ã€‚Kubernetes æœ¬èº«å¹¶ä¸æä¾›å­˜å‚¨è§£å†³æ–¹æ¡ˆã€‚å½“ç„¶ï¼Œæ‚¨å¯ä»¥å°†å­˜å‚¨æŒ‚è½½åˆ°ä¸»æœºå®‰è£…ç›®å½•ï¼Œä½†è¿™æ—¢ä¸æ¨èä¹Ÿä¸ç®€å•ã€‚&lt;/p&gt;

&lt;p&gt;åŸºæœ¬ä¸Šéœ€è¦åœ¨ Kubernetes ä¸‹ä½¿ç”¨æŸç§å­˜å‚¨ã€‚ä¾‹å¦‚ï¼Œ&lt;a href=&#34;https://rook.io/&#34; target=&#34;_blank&#34;&gt;rook&lt;/a&gt; ä½¿å¾—è¿è¡Œ &lt;a href=&#34;https://ceph.com/&#34; target=&#34;_blank&#34;&gt;Ceph&lt;/a&gt; ä½œä¸ºåº•å±‚å—å­˜å‚¨éœ€æ±‚çš„å˜å¾—ç›¸å¯¹ç®€å•ï¼Œä½†æˆ‘å¯¹ Ceph çš„ä½“éªŒæ˜¯å®ƒè¿˜æœ‰æœ‰å¾ˆå¤šåœ°æ–¹éœ€è¦è°ƒæ•´ï¼Œæ‰€ä»¥æ‚¨ç»ä¸æ˜¯åªéœ€ç‚¹å‡»ä¸‹ä¸€æ­¥å°±èƒ½èµ°å‡ºå›°å¢ƒã€‚&lt;/p&gt;

&lt;h2 id=&#34;è°ƒè¯•&#34;&gt;è°ƒè¯•&lt;/h2&gt;

&lt;p&gt;åœ¨ä¸å¼€å‘äººå‘˜è°ˆè®º Kubernetes æ—¶ï¼Œä¸€ç§å¸¸è§çš„å›ç­”ç»å¸¸å‡ºç°ï¼šåœ¨ä½¿ç”¨ Kubernetes æ—¶ï¼Œäººä»¬å¸¸å¸¸åœ¨è°ƒè¯•åº”ç”¨ç¨‹åºæ—¶é‡åˆ°é—®é¢˜ã€‚å³ä½¿æ˜¯ä¸€ä¸ªä¾‹å¦‚å®¹å™¨æœªèƒ½å¯åŠ¨çš„ç®€å•é—®é¢˜ï¼Œä¹Ÿä¼šå¼•èµ·æ··ä¹±ã€‚&lt;/p&gt;

&lt;p&gt;å½“ç„¶ï¼Œè¿™æ˜¯ä¸€ä¸ªæ•™è‚²é—®é¢˜ã€‚åœ¨è¿‡å»çš„å‡ åå¹´ä¸­ï¼Œå¼€å‘äººå‘˜å·²ç»å­¦ä¼šäº†è°ƒè¯•çš„â€œç»å…¸â€æ­¥éª¤ï¼šåœ¨ &lt;code&gt;/vat/log/&lt;/code&gt; ä¸­æŸ¥çœ‹æ—¥å¿—ç­‰ã€‚ä½†æ˜¯å¯¹äºå®¹å™¨ï¼Œæˆ‘ä»¬ç”šè‡³ä¸çŸ¥é“å®¹å™¨è¿è¡Œåœ¨å“ªä¸ªæœåŠ¡å™¨ä¸Šï¼Œå› æ­¤å®ƒå‘ˆç°å‡ºäº†ä¸€ç§èŒƒå¼è½¬æ¢ã€‚&lt;/p&gt;

&lt;h2 id=&#34;é—®é¢˜-å¤æ‚&#34;&gt;é—®é¢˜ï¼šå¤æ‚&lt;/h2&gt;

&lt;p&gt;æ‚¨å¯èƒ½å·²ç»æ³¨æ„åˆ°æˆ‘æ­£åœ¨è·³è¿‡å…±æœ‰äº‘æä¾›å•†ç»™æ‚¨çš„ä¸œè¥¿ï¼Œå³ä½¿å®ƒä¸æ˜¯ä¸€ä¸ªå®Œæ•´çš„æ‰˜ç®¡ Kubernetesã€‚å½“ç„¶ï¼Œå¦‚æœæ‚¨ä½¿ç”¨æ‰˜ç®¡çš„ Kubernetes è§£å†³æ–¹æ¡ˆï¼Œè¿™å¾ˆå¥½ï¼Œé™¤äº†è°ƒè¯•ä¹‹å¤–ï¼Œæ‚¨ä¸éœ€è¦å¤„ç†ä¸Šé¢è¿™äº›é—®é¢˜ã€‚&lt;/p&gt;

&lt;p&gt;Kubernetes æ‹¥æœ‰è®¸å¤šå¯ä»¥ç§»åŠ¨ç»„ä»¶ï¼Œä½† Kubernetes æœ¬èº«ä¹Ÿå¹¶ä¸èƒ½æä¾›å®Œæ•´çš„è§£å†³æ–¹æ¡ˆã€‚ä¾‹å¦‚ï¼Œ&lt;a href=&#34;https://www.openshift.com/&#34; target=&#34;_blank&#34;&gt;RedHat OpenShift&lt;/a&gt; å¯ä»¥ï¼Œä½†å®ƒéœ€è¦èŠ±é’±ï¼Œå¹¶ä¸”ä»ç„¶éœ€è¦æ·»åŠ è‡ªå·±çš„ä¸œè¥¿ã€‚&lt;/p&gt;

&lt;p&gt;ç°åœ¨Kubernetesæ­£å¤„äº &lt;a href=&#34;https://www.gartner.com/en/research/methodologies/gartner-hype-cycle&#34; target=&#34;_blank&#34;&gt;Gartner hype cycle&lt;/a&gt; çš„é¡¶å³°ï¼Œæ¯ä¸ªäººéƒ½æƒ³è¦å®ƒï¼Œä½†å¾ˆå°‘æœ‰äººçœŸæ­£ç†è§£å®ƒã€‚åœ¨æ¥ä¸‹æ¥çš„å‡ å¹´é‡Œï¼Œä¸å°‘å…¬å¸å¿…é¡»æ„è¯†åˆ° Kubernetes å¹¶ä¸æ˜¯é“¶å¼¹ï¼Œè€Œå¦‚ä½•æ­£ç¡®æœ‰æ•ˆåœ°ä½¿ç”¨å®ƒæ‰æ˜¯å…³é”®ã€‚&lt;/p&gt;

&lt;p&gt;æˆ‘è®¤ä¸ºï¼Œå¦‚æœæ‚¨æœ‰èƒ½åŠ›å°† Ops å›¢é˜Ÿä¸“é—¨ç”¨äºä¸ºå¼€å‘äººå‘˜æ¥ç»´æŠ¤åº•å±‚å¹³å°ï¼Œé‚£ä¹ˆè¿è¡Œè‡ªå·±çš„ Kubernetes æ˜¯å€¼å¾—çš„ã€‚&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;æœ¬æ–‡ä½œè€…ï¼š&lt;a href=&#34;https://pasztor.at/&#34; target=&#34;_blank&#34;&gt;Janos Pasztor&lt;/a&gt;  2018-12-04&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;åŸæ–‡åœ°å€ï¼š&lt;a href=&#34;https://pasztor.at/blog/kubernetes-is-hard&#34; target=&#34;_blank&#34;&gt;https://pasztor.at/blog/kubernetes-is-hard&lt;/a&gt;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>ä½¿ç”¨ Kustomize å¸®ä½ ç®¡ç† kubernetes åº”ç”¨ï¼ˆäºŒï¼‰ï¼š Kustomize çš„ä½¿ç”¨æ–¹æ³•</title>
      <link>https://guoxudong.io/en/post/kustomize-2/</link>
      <pubDate>Fri, 19 Apr 2019 16:05:02 +0800</pubDate>
      
      <guid>https://guoxudong.io/en/post/kustomize-2/</guid>
      <description>

&lt;p&gt;æœ¬æ–‡ä»‹ç»ä½¿ç”¨å’Œç»´æŠ¤ Kustomize çš„æ–¹æ³•åŠæ­¥éª¤ã€‚&lt;/p&gt;

&lt;h2 id=&#34;å®šåˆ¶é…ç½®&#34;&gt;å®šåˆ¶é…ç½®&lt;/h2&gt;

&lt;p&gt;åœ¨è¿™ä¸ªå·¥ä½œæµæ–¹å¼ä¸­ï¼Œæ‰€æœ‰çš„é…ç½®æ–‡ä»¶ï¼ˆ YAML èµ„æºï¼‰éƒ½ä¸ºç”¨æˆ·æ‰€æœ‰ï¼Œå­˜åœ¨äºç§æœ‰ repo ä¸­ã€‚å…¶ä»–äººæ˜¯æ— æ³•ä½¿ç”¨çš„ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;http://wx4.sinaimg.cn/large/ad5fbf65gy1g2813d1ia7j20qo0f0dgk.jpg&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;&lt;p&gt;åˆ›å»ºä¸€ä¸ªç›®å½•ç”¨äºç‰ˆæœ¬æ§åˆ¶&lt;/p&gt;

&lt;p&gt;æˆ‘ä»¬å¸Œæœ›å°†ä¸€ä¸ªåä¸º &lt;strong&gt;&lt;em&gt;ldap&lt;/em&gt;&lt;/strong&gt; çš„ Kubernetes é›†ç¾¤åº”ç”¨çš„é…ç½®ä¿å­˜åœ¨è‡ªå·±çš„ repo ä¸­ã€‚
è¿™é‡Œä½¿ç”¨ &lt;code&gt;git&lt;/code&gt; è¿›è¡Œç‰ˆæœ¬æ§åˆ¶ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;git init ~/ldap
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;åˆ›å»ºä¸€ä¸ª &lt;code&gt;base&lt;/code&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;mkdir -p ~/ldap/base
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;åœ¨è¿™ä¸ªç›®å½•ä¸­åˆ›å»ºå¹¶æäº¤ &lt;code&gt;kustomization.yaml&lt;/code&gt; æ–‡ä»¶å’Œä¸€ç»„èµ„æºï¼Œä¾‹å¦‚ &lt;code&gt;deployment.yaml&lt;/code&gt; &lt;code&gt;service.yaml&lt;/code&gt; ç­‰ã€‚&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;åˆ›å»º &lt;code&gt;overlays&lt;/code&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;mkdir -p ~/ldap/overlays/staging
mkdir -p ~/ldap/overlays/production
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;æ¯ä¸ªç›®å½•éƒ½éœ€è¦ä¸€ä¸ª &lt;code&gt;kustomization.yaml&lt;/code&gt; æ–‡ä»¶ä»¥åŠä¸€ä¸ªæˆ–å¤šä¸ª &lt;code&gt;patch&lt;/code&gt; ï¼Œä¾‹å¦‚ &lt;code&gt;healthcheck_patch.yaml&lt;/code&gt; &lt;code&gt;memorylimit_patch.yaml&lt;/code&gt; ç­‰ã€‚ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-staging```&#34;&gt;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;production&lt;code&gt;ç›®å½•åˆ™å¯èƒ½ä¼šåœ¨&lt;/code&gt;deployment``` ä¸­å¢åŠ åœ¨å‰¯æœ¬æ•°ã€‚&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;ç”Ÿæˆ &lt;code&gt;variants&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;è¿è¡Œ &lt;code&gt;kustomize&lt;/code&gt; ï¼Œå°†ç”Ÿæˆçš„é…ç½®ç”¨äº kubernetes åº”ç”¨éƒ¨ç½²&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;kustomize build ~/ldap/overlays/staging | kubectl apply -f -
kustomize build ~/ldap/overlays/production | kubectl apply -f -
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;åœ¨ kubernetes 1.14 ç‰ˆæœ¬ï¼Œ &lt;code&gt;kustomize&lt;/code&gt; å·²ç»é›†æˆåˆ° &lt;code&gt;kubectl&lt;/code&gt; å‘½ä»¤ä¸­ï¼Œæˆä¸ºäº†å…¶ä¸€ä¸ªå­å‘½ä»¤ï¼Œå¯ä½¿ç”¨ &lt;code&gt;kubectl&lt;/code&gt; æ¥è¿›è¡Œéƒ¨ç½²&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;kubectl apply -k ~/ldap/overlays/staging
kubectl apply -k ~/ldap/overlays/production
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ol&gt;

&lt;h2 id=&#34;ä½¿ç”¨ç°æˆçš„é…ç½®&#34;&gt;ä½¿ç”¨ç°æˆçš„é…ç½®&lt;/h2&gt;

&lt;p&gt;åœ¨è¿™ä¸ªå·¥ä½œæµæ–¹å¼ä¸­ï¼Œå¯ä»åˆ«äººçš„ repo ä¸­ fork kustomize é…ç½®ï¼Œå¹¶æ ¹æ®è‡ªå·±çš„éœ€æ±‚æ¥é…ç½®ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;http://wx4.sinaimg.cn/large/ad5fbf65gy1g281xyfebej20qo0f0dgr.jpg&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;&lt;p&gt;é€šè¿‡ fork/modify/rebase ç­‰æ–¹å¼è·å¾—é…ç½®&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;å°†å…¶å…‹éš†ä¸ºä½ è‡ªå·±çš„ &lt;code&gt;base&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;åœ¨è¿™ä¸ª &lt;code&gt;bash&lt;/code&gt; ç›®å½•ç»´æŠ¤åœ¨ä¸€ä¸ª repo ä¸­ï¼Œåœ¨è¿™ä¸ªä¾‹å­ä½¿ç”¨ &lt;code&gt;ladp&lt;/code&gt; çš„ repo&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;mkdir ~/ldap
git clone https://github.com/$USER/ldap ~/ldap/base
cd ~/ldap/base
git remote add upstream git@github.com:$USER/ldap
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;åˆ›å»º &lt;code&gt;overlays&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;å¦‚ä¸Šé¢çš„æ¡ˆä¾‹ä¸€æ ·ï¼Œåˆ›å»ºå¹¶å®Œå–„ &lt;code&gt;overlays&lt;/code&gt; ç›®å½•ä¸­çš„å†…å®¹&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;mkdir -p ~/ldap/overlays/staging
mkdir -p ~/ldap/overlays/production
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ç”¨æˆ·å¯ä»¥å°† &lt;code&gt;overlays&lt;/code&gt; ç»´æŠ¤åœ¨ä¸åŒçš„ repo ä¸­&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;ç”Ÿæˆ &lt;code&gt;variants&lt;/code&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;kustomize build ~/ldap/overlays/staging | kubectl apply -f -
kustomize build ~/ldap/overlays/production | kubectl apply -f -
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;åœ¨ kubernetes 1.14 ç‰ˆæœ¬ï¼Œ &lt;code&gt;kustomize&lt;/code&gt; å·²ç»é›†æˆåˆ° &lt;code&gt;kubectl&lt;/code&gt; å‘½ä»¤ä¸­ï¼Œæˆä¸ºäº†å…¶ä¸€ä¸ªå­å‘½ä»¤ï¼Œå¯ä½¿ç”¨ &lt;code&gt;kubectl&lt;/code&gt; æ¥è¿›è¡Œéƒ¨ç½²&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;kubectl apply -k ~/ldap/overlays/staging
kubectl apply -k ~/ldap/overlays/production
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;ï¼ˆå¯é€‰ï¼‰æ›´æ–° &lt;code&gt;base&lt;/code&gt;
ç”¨æˆ·å¯ä»¥å®šæœŸä»ä¸Šæ¸¸ repo ä¸­ &lt;code&gt;rebase&lt;/code&gt; ä»–ä»¬çš„ &lt;code&gt;base&lt;/code&gt; ä»¥ä¿è¯åŠæ—¶æ›´æ–°&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;cd ~/ldap/base
git fetch upstream
git rebase upstream/master
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ol&gt;

&lt;h2 id=&#34;å‚è€ƒ&#34;&gt;å‚è€ƒ&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/kubernetes-sigs/kustomize/blob/master/docs/workflows.md&#34; target=&#34;_blank&#34;&gt;kustomize workflows - github.com&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>Rancher 2.2.1 è§£å†³å·¥ä½œè´Ÿè½½ç›‘æ§ä¸ºç©ºé—®é¢˜</title>
      <link>https://guoxudong.io/en/post/rancher-prometheus-fix-question/</link>
      <pubDate>Thu, 18 Apr 2019 17:46:08 +0800</pubDate>
      
      <guid>https://guoxudong.io/en/post/rancher-prometheus-fix-question/</guid>
      <description>

&lt;h2 id=&#34;å‰è¨€&#34;&gt;å‰è¨€&lt;/h2&gt;

&lt;p&gt;Rancher 2.2.X ç‰ˆæœ¬äº3æœˆåº•æ­£å¼GAï¼Œæ–°ç‰ˆæœ¬å¤„ç†å…¶ä»–éƒ¨åˆ†çš„ä¼˜åŒ–ä»¥å¤–ï¼Œæœ€å¤§äº®ç‚¹è«è¿‡äºæœ¬èº«é›†æˆäº† Prometheus ï¼Œå¯ä»¥é€šè¿‡ Rancher è‡ªå¸¦ UI æˆ–è€… Grafana æŸ¥çœ‹é›†ç¾¤çš„å®æ—¶ç›‘æ§ï¼Œå¯¹æ‰€æœ‰ç›‘æ§è¿›è¡Œäº†ä¸€æ¬¡èšåˆï¼Œä¸ç”¨å†å’Œä¹‹å‰ä¸€æ ·ï¼Œæ¯ä¸ªé›†ç¾¤éƒ½è¦å®‰è£…ä¸€ä¸ª Prometheus ç”¨äºç›‘æ§ï¼Œè€Œå‘Šè­¦éƒ¨åˆ†ä¹Ÿå¯ä½¿ç”¨ Rancher è‡ªå¸¦çš„é€šçŸ¥ç»„ä»¶è¿›è¡Œå‘Šè­¦ã€‚é€šçŸ¥æ–¹å¼ç›®å‰æ”¯æŒ Slack ã€ é‚®ä»¶ã€ PagerDuty ã€ Webhook ã€ ä¼ä¸šå¾®ä¿¡ï¼Œç”±äºæˆ‘å¸åŠå…¬ä½¿ç”¨é’‰é’‰ï¼Œæ‰€ä»¥æˆ‘ä»¬ä½¿ç”¨äº† Webhook çš„æ–¹å¼ï¼Œå‘Šè­¦è§¦å‘åé€šçŸ¥æˆ‘ä»¬çš„æ¶ˆæ¯æœåŠ¡ï¼Œç„¶åæ¶ˆæ¯æœåŠ¡å°†å…¶å‘é€åˆ°é’‰é’‰è¿›è¡Œå‘Šè­¦ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;http://wx2.sinaimg.cn/large/ad5fbf65gy1g26xsh6omvj20rk0ilta6.jpg&#34; alt=&#34;image&#34; /&gt;&lt;/p&gt;

&lt;h2 id=&#34;é—®é¢˜&#34;&gt;é—®é¢˜&lt;/h2&gt;

&lt;p&gt;Rancher é›†æˆ Prometheus åï¼Œç›‘æ§æ–¹é¢å˜çš„ååˆ†å¼ºå¤§ï¼Œä¸ç”¨å†å¾˜å¾Šäºå¤šä¸ªé›†ç¾¤çš„ Grafana ï¼Œç›´æ¥åœ¨ Rancher ä¸Šå³å¯æŸ¥çœ‹ï¼Œéå¸¸æ–¹ä¾¿&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;http://wx2.sinaimg.cn/large/ad5fbf65gy1g26xuv2frnj212b0onn1h.jpg&#34; alt=&#34;image&#34; /&gt;&lt;/p&gt;

&lt;p&gt;ä½†æ˜¯åœ¨ä½¿ç”¨çš„æ—¶å€™ï¼Œæˆ‘å‘ç°äº†ä¸€ä¸ªé—®é¢˜ï¼šå°±æ˜¯åœ¨æŸ¥çœ‹ å·¥ä½œè´Ÿè½½å’Œ Pod çš„æ—¶å€™ä¼šæ˜¾ç¤º &lt;strong&gt;&lt;em&gt;æ²¡æœ‰è¶³å¤Ÿçš„æ•°æ®ç»˜åˆ¶å›¾è¡¨&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;http://wx4.sinaimg.cn/large/ad5fbf65gy1g26xzvi2cpj20po057q31.jpg&#34; alt=&#34;image&#34; /&gt;&lt;/p&gt;

&lt;p&gt;è¿›å…¥ Grafana æŸ¥çœ‹ä¼šå‘ç°ï¼Œå…¶å®ç›‘æ§å‚æ•°æ˜¯å­˜åœ¨çš„ï¼Œä½†æ˜¯æ²¡æœ‰é‡‡é›†åˆ°å€¼ï¼Œæ‰€ä»¥å¹¶æ²¡æœ‰å±•ç¤ºå‡ºæ¥ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;http://wx4.sinaimg.cn/large/ad5fbf65gy1g26y4j4s3yj21f50m9wqj.jpg&#34; alt=&#34;image&#34; /&gt;&lt;/p&gt;

&lt;h2 id=&#34;è§£å†³&#34;&gt;è§£å†³&lt;/h2&gt;

&lt;p&gt;åœ¨æ£€æŸ¥äº†é…ç½®åå¹¶æ²¡æœ‰æ‰¾åˆ°åŸå› ï¼Œåªå¥½å» GitHub ä¸Šæä¸€ä¸ª issue æ¥è¯¢é—®ä¸€ä¸‹å¼€å‘è€…æˆ–è€…å…¶ä»–ç”¨æˆ·æœ‰æ— é‡åˆ°è¿™ä¸ªé—®é¢˜ã€‚&lt;/p&gt;

&lt;p&gt;Rancher å®˜æ–¹çš„å¼€å‘è€…è¿˜æ˜¯ååˆ†è´Ÿè´£çš„ï¼Œ GitHub ä¸Šç”¨æˆ·åä¸º &lt;a href=&#34;https://github.com/loganhz&#34; target=&#34;_blank&#34;&gt;Logan&lt;/a&gt; çš„å®˜æ–¹å°å“¥æ¥æˆ‘æŒ‡å¯¼è§£å†³è¿™ä¸ªé—®é¢˜ã€‚&lt;/p&gt;

&lt;p&gt;å°å“¥å‘ç°æˆ‘æ˜¯å¯¼å…¥çš„é›†ç¾¤ï¼Œè¦æˆ‘è¿›å…¥ Prometheus æŸ¥çœ‹ï¼Œå‘ç° &lt;code&gt;cattle-prometheus/exporter-kube-state-cluster-monitoring&lt;/code&gt; æœç„¶æ²¡æœ‰èµ·æ¥&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;http://wx4.sinaimg.cn/large/ad5fbf65gy1g26yb1p4eoj21db0am782.jpg&#34; alt=&#34;image&#34; /&gt;&lt;/p&gt;

&lt;p&gt;è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œéœ€è¦åœ¨é›†ç¾¤ç›‘æ§é…ç½®ä¸­æ·»åŠ ä¸€ä¸ªé«˜çº§é€‰é¡¹ï¼Œæ’å…¥å€¼ä¸ºï¼š&lt;code&gt;exporter-kubelets.https=false&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;http://wx4.sinaimg.cn/large/ad5fbf65gy1g26ycq6amfj221q0uggp8.jpg&#34; alt=&#34;image&#34; /&gt;&lt;/p&gt;

&lt;p&gt;ç‚¹å‡»ä¿å­˜ï¼Œé—®é¢˜å°±è§£å†³äº†ï¼&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;http://wx4.sinaimg.cn/large/ad5fbf65gy1g26yheqwp7j213e0g3di5.jpg&#34; alt=&#34;image&#34; /&gt;&lt;/p&gt;

&lt;h2 id=&#34;åè®°&#34;&gt;åè®°&lt;/h2&gt;

&lt;p&gt;ä½¿ç”¨ Rancher æœ‰åŠå¹´ï¼Œä»2.0ç‰ˆæœ¬ä¸€ç›´ç”¨åˆ°2.2ç‰ˆæœ¬ï¼Œè€Œ18å¹´åˆ†åˆ«åœ¨äº‘æ –å¤§ä¼šå’Œ KubeCon ä¸Šå¬äº† Rancher åˆ›å§‹äººæ¢èƒœåšå£«çš„æ¼”è®²ã€‚è€Œä»è¿™ä¸€ä¸ªå°é—®é¢˜ä¸Šå°±å¯ä»¥çœ‹åˆ° Rancher å®˜æ–¹å¯¹æ¯ä¸€ä¸ªç”¨æˆ·éƒ½æ˜¯ååˆ†é‡è§†çš„ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Kustomize: æ— éœ€æ¨¡æ¿å®šåˆ¶ä½ çš„ kubernetes é…ç½®</title>
      <link>https://guoxudong.io/en/post/introducing-kustomize-template-free-configuration-customization-for-kubernetes/</link>
      <pubDate>Mon, 15 Apr 2019 17:23:21 +0800</pubDate>
      
      <guid>https://guoxudong.io/en/post/introducing-kustomize-template-free-configuration-customization-for-kubernetes/</guid>
      <description>

&lt;blockquote&gt;
&lt;p&gt;ä½œè€…ï¼šJeff Regan (Google), Phil Wittrock (Google) 2018-05-29&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;å¦‚æœä½ åœ¨è¿è¡Œ kubernetes é›†ç¾¤ï¼Œä½ å¯èƒ½ä¼šæ‹·è´ä¸€äº›åŒ…å« kubernetes API å¯¹è±¡çš„ YAML æ–‡ä»¶ï¼Œå¹¶ä¸”æ ¹æ®ä½ çš„éœ€æ±‚æ¥ä¿®æ”¹è¿™äº›æ–‡ä»¶ï¼Œé€šè¿‡è¿™äº› YAML æ–‡ä»¶æ¥å®šä¹‰ä½ çš„ kubernetes é…ç½®ã€‚&lt;/p&gt;

&lt;p&gt;ä½†æ˜¯è¿™ç§æ–¹æ³•å­˜åœ¨å¾ˆéš¾æ‰¾åˆ°é…ç½®çš„æºå¤´å¹¶å¯¹å…¶è¿›è¡Œæ”¹è¿›ã€‚ä»Šå¤© Google å®£å¸ƒæ¨å‡º &lt;strong&gt;Kustomize&lt;/strong&gt; ï¼Œä¸€ä¸ªä½œä¸º &lt;a href=&#34;https://github.com/kubernetes/community/tree/master/sig-cli&#34; target=&#34;_blank&#34;&gt;SIG-CLI&lt;/a&gt; å­é¡¹ç›®çš„å‘½ä»¤è¡Œå·¥å…·ã€‚è¿™ä¸ªå·¥å…·æä¾›äº†ä¸€ä¸ªå…¨æ–°çš„ã€çº¯ç²¹çš„å£°æ˜å¼çš„æ–¹æ³•æ¥å®šåˆ¶ kubernetes é…ç½®ï¼Œéµå¾ªå¹¶åˆ©ç”¨æˆ‘ä»¬ç†Ÿæ‚‰ä¸”ç²¾å¿ƒè®¾è®¡çš„ Kubernetes APIã€‚&lt;/p&gt;

&lt;p&gt;æœ‰è¿™æ ·ä¸€ä¸ªå¸¸è§çš„åœºæ™¯ï¼Œåœ¨äº’è”ç½‘ä¸Šå¯ä»¥çœ‹åˆ°åˆ«äººçš„ CMSï¼ˆcontent management systemï¼Œå†…å®¹ç®¡ç†ç³»ç»Ÿï¼‰çš„ kubernetes é…ç½®ï¼Œè¿™ä¸ªé…ç½®æ˜¯ä¸€ç»„åŒ…æ‹¬ Kubernetes API å¯¹è±¡çš„ YAML æè¿°æ–‡ä»¶ã€‚ç„¶åï¼Œåœ¨æ‚¨è‡ªå·±å…¬å¸çš„æŸä¸ªè§’è½ï¼Œæ‚¨æ‰¾åˆ°ä¸€ä¸ªä½ éå¸¸äº†è§£çš„æ•°æ®åº“ï¼Œå¸Œæœ›ç”¨å®ƒæ¥è¯¥ CMS çš„æ•°æ®ã€‚&lt;/p&gt;

&lt;p&gt;ä½ å¸Œæœ›åŒæ—¶ä½¿ç”¨å®ƒä»¬ï¼Œæ­¤å¤–ï¼Œä½ å¸Œæœ›è‡ªå®šä¹‰é…ç½®æ–‡ä»¶ä»¥ä¾¿ä½ çš„èµ„æºå®ä¾‹åœ¨é›†ç¾¤ä¸­æ˜¾ç¤ºï¼Œå¹¶é€šè¿‡æ·»åŠ ä¸€ä¸ªæ ‡ç­¾æ¥åŒºåˆ†åœ¨åŒä¸€é›†ç¾¤ä¸­åšåŒæ ·äº‹æƒ…çš„å…¶ä»–èµ„æºã€‚åŒæ—¶ä¹Ÿå¸Œæœ›ä¸ºå…¶é…ç½®é€‚å½“çš„ CPU ã€å†…å­˜å’Œå‰¯æœ¬æ•°ã€‚&lt;/p&gt;

&lt;p&gt;æ­¤å¤–ï¼Œä½ è¿˜æƒ³è¦é…ç½®æ•´ä¸ªé…ç½®çš„å¤šç§å˜åŒ–ï¼šä¸€ä¸ªä¸“é—¨ç”¨äºæµ‹è¯•å’Œå®éªŒçš„å°æœåŠ¡å®ä¾‹ï¼ˆå°±è®¡ç®—èµ„æºè€Œè¨€ï¼‰ï¼Œæˆ–æ›´å¤§çš„ç”¨äºå¯¹å¤–æä¾›æœåŠ¡çš„ç”Ÿäº§çº§åˆ«çš„æœåŠ¡å®ä¾‹ã€‚åŒæ—¶ï¼Œå…¶ä»–çš„å›¢é˜Ÿä¹Ÿå¸Œæœ›æ‹¥æœ‰ä»–ä»¬è‡ªå·±çš„æœåŠ¡å®ä¾‹ã€‚&lt;/p&gt;

&lt;h2 id=&#34;å®šåˆ¶å°±æ˜¯å¤ç”¨&#34;&gt;å®šåˆ¶å°±æ˜¯å¤ç”¨&lt;/h2&gt;

&lt;p&gt;kubernetes çš„é…ç½®å¹¶ä¸æ˜¯ä»£ç ï¼ˆæ˜¯ä½¿ç”¨ YAML æè¿°çš„ API å¯¹è±¡ï¼Œä¸¥æ ¼æ¥è¯´åº”è¯¥æ˜¯æ•°æ®ï¼‰ï¼Œä½†æ˜¯é…ç½®çš„ç”Ÿå‘½å‘¨æœŸä¸ä»£ç çš„ç”Ÿå‘½å‘¨æœŸæœ‰è®¸å¤šç›¸ä¼¼ä¹‹å¤„ã€‚&lt;/p&gt;

&lt;p&gt;ä½ éœ€è¦åœ¨ç‰ˆæœ¬æ§åˆ¶ä¸­ä¿ç•™é…ç½®ã€‚æ‰€æœ‰è€…çš„é…ç½®ä¸å¿…ä¸ä½¿ç”¨è€…çš„é…ç½®ç›¸åŒã€‚é…ç½®å¯ä»¥ä½œä¸ºæ•´ä½“çš„ä¸€éƒ¨åˆ†ã€‚è€Œç”¨æˆ·å¸Œæœ›ä¸ºåœ¨ä¸åŒçš„æƒ…å†µä¸‹å¤ç”¨è¿™äº›é…ç½®ã€‚&lt;/p&gt;

&lt;p&gt;ä¸ä»£ç å¤ç”¨ç›¸åŒï¼Œä¸€ç§å¤ç”¨é…ç½®çš„æ–¹æ³•æ˜¯ç®€å•çš„å…¨éƒ¨æ‹·è´å¹¶è¿›è¡Œè‡ªå®šä¹‰ã€‚åƒä»£ç ä¸€æ ·ï¼Œåˆ‡æ–­ä¸æºä»£ç çš„è”ç³»ä½¿å¾—ä»æ”¹è¿›å˜çš„ååˆ†å›°éš¾ã€‚è®¸å¤šå›¢é˜Ÿå’Œç¯å¢ƒéƒ½ä½¿ç”¨è¿™ç§æ–¹æ³•ï¼Œæ¯ä¸ªå›¢é˜Ÿå’Œç¯å¢ƒéƒ½æ‹¥æœ‰è‡ªå·±çš„é…ç½®ï¼Œè¿™ä½¿å¾—ç®€å•çš„å‡çº§å˜å¾—ååˆ†æ£˜æ‰‹ã€‚&lt;/p&gt;

&lt;p&gt;å¦ä¸€ç§å¤ç”¨æ–¹æ³•æ˜¯å°†æºä»£ç æŠ½è±¡ä¸ºå‚æ•°åŒ–æ¨¡æ¿ã€‚ä½¿ç”¨ä¸€ä¸ªé€šè¿‡æ‰§è¡Œè„šæœ¬æ¥æ›¿æ¢æ‰€éœ€å‚æ•°çš„æ¨¡æ¿å¤„ç†å·¥å…·ç”Ÿæˆé…ç½®ï¼Œé€šè¿‡ä¸ºåŒä¸€æ¨¡æ¿è®¾ç½®ä¸åŒçš„å€¼æ¥è¾¾åˆ°å¤ç”¨çš„ç›®çš„ã€‚è€Œè¿™ç§æ–¹å¼é¢ä¸´çš„é—®é¢˜æ˜¯æ¨¡æ¿å’Œå‚æ•°æ–‡ä»¶å¹¶ä¸åœ¨ kubernetes API èµ„æºçš„è§„èŒƒä¸­ï¼Œè¿™ç§æ–¹å¼å¿…å®šæ˜¯ä¸€ç§åŒ…è£…äº† kubernetes API çš„æ–°ä¸œè¥¿ã€æ–°è¯­è¨€ã€‚è™½ç„¶è¿™ç§æ–¹å¼å¾ˆå¼ºå¤§ï¼Œä½†æ˜¯ä¹Ÿå¸¦æ¥äº†å­¦ä¹ æˆæœ¬å’Œå®‰è£…å·¥å…·çš„æˆæœ¬ã€‚ä¸åŒçš„å›¢é˜Ÿéœ€è¦ä¸åŒçš„æ›´æ”¹ï¼Œå› æ­¤å‡ ä¹æ‰€æœ‰å¯ä»¥åŒ…å«åœ¨ YAML æ–‡ä»¶ä¸­çš„è§„èŒƒéƒ½ä¼šéœ€è¦æŠ½è±¡æˆå‚æ•°ã€‚&lt;/p&gt;

&lt;h2 id=&#34;è‡ªå®šä¹‰é…ç½®çš„æ–°é€‰æ‹©&#34;&gt;è‡ªå®šä¹‰é…ç½®çš„æ–°é€‰æ‹©&lt;/h2&gt;

&lt;p&gt;&lt;strong&gt;kustomize&lt;/strong&gt; ä¸­å·¥å…·çš„å£°æ˜ä¸è§„èŒƒæ˜¯ç”±åä¸º &lt;code&gt;kustomization.yaml&lt;/code&gt; çš„æ–‡ä»¶å®šä¹‰ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;kustomize&lt;/strong&gt; å°†ä¼šè¯»å–å£°æ˜æ–‡ä»¶å’Œ Kubernetes API èµ„æºæ–‡ä»¶ï¼Œå°†å…¶ç»„åˆç„¶åå°†å®Œæ•´çš„èµ„æºè¿›è¡Œæ ‡å‡†åŒ–çš„è¾“å‡ºã€‚è¾“å‡ºçš„æ–‡æœ¬å¯ä»¥è¢«å…¶ä»–å·¥å…·è¿›ä¸€æ­¥å¤„ç†ï¼Œæˆ–è€…ç›´æ¥é€šè¿‡ &lt;strong&gt;kubectl&lt;/strong&gt; åº”ç”¨äºé›†ç¾¤ã€‚&lt;/p&gt;

&lt;p&gt;ä¾‹å¦‚ï¼Œå¦‚æœ &lt;code&gt;kustomization.yaml&lt;/code&gt; æ–‡ä»¶åŒ…æ‹¬ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-yaml&#34;&gt;commonLabels:
  app: hello
resources:
- deployment.yaml
- configMap.yaml
- service.yaml
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ç¡®ä¿è¿™ä¸‰ä¸ªæ–‡ä»¶ä¸ &lt;code&gt;kustomization.yaml&lt;/code&gt; ä½äºåŒä¸€ç›®å½•ä¸‹ï¼Œç„¶åè¿è¡Œï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;kustomize build
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;å°†åˆ›å»ºåŒ…å«ä¸‰ä¸ªèµ„æºçš„ YAML æµï¼Œå…¶ä¸­ &lt;code&gt;app: hello&lt;/code&gt; ä¸ºæ¯ä¸ªèµ„æºå…±åŒçš„æ ‡ç­¾ã€‚&lt;/p&gt;

&lt;p&gt;åŒæ ·çš„ï¼Œä½ å¯ä»¥ä½¿ç”¨ &lt;strong&gt;&lt;em&gt;commonAnnotations&lt;/em&gt;&lt;/strong&gt; å­—æ®µç»™æ‰€æœ‰èµ„æºæ·»åŠ æ³¨é‡Šï¼Œ &lt;strong&gt;&lt;em&gt;namePrefix&lt;/em&gt;&lt;/strong&gt; å­—æ®µä¸ºæ‰€æœ‰çš„èµ„æºæ·»åŠ å…±åŒçš„å‰ç¼€åã€‚è¿™äº›çç¢è€Œæœ‰å¸¸è§çš„å®šåˆ¶åªæ˜¯ä¸€ä¸ªå¼€å§‹ã€‚&lt;/p&gt;

&lt;p&gt;ä¸€ä¸ªæ›´å¸¸è§çš„ä¾‹å­æ˜¯ï¼Œä½ éœ€è¦ä¸ºä¸€ç»„ç›¸åŒèµ„æºè®¾ç½®ä¸åŒçš„å‚æ•°ã€‚ä¾‹å¦‚ï¼šå¼€å‘ã€æ¼”ç¤ºå’Œç”Ÿäº§çš„å‚æ•°ã€‚&lt;/p&gt;

&lt;p&gt;ä¸ºæ­¤ï¼Œ&lt;strong&gt;Kustomize&lt;/strong&gt; å…è®¸ç”¨æˆ·ä»¥ä¸€ä¸ªåº”ç”¨æè¿°æ–‡ä»¶ ï¼ˆYAML æ–‡ä»¶ï¼‰ä¸ºåŸºç¡€ï¼ˆBase YAMLï¼‰ï¼Œç„¶åé€šè¿‡ Overlay çš„æ–¹å¼ç”Ÿæˆæœ€ç»ˆéƒ¨ç½²åº”ç”¨æ‰€éœ€çš„æè¿°æ–‡ä»¶ã€‚ä¸¤è€…éƒ½æ˜¯ç”± kustomization æ–‡ä»¶è¡¨ç¤ºã€‚åŸºç¡€ï¼ˆBaseï¼‰å£°æ˜äº†å…±äº«çš„å†…å®¹ï¼ˆèµ„æºå’Œå¸¸è§çš„èµ„æºé…ç½®ï¼‰ï¼ŒOverlay åˆ™å£°æ˜äº†å·®å¼‚ã€‚&lt;/p&gt;

&lt;p&gt;è¿™é‡Œæ˜¯ä¸€ä¸ªç›®å½•æ ‘ï¼Œç”¨äºç®¡ç†é›†ç¾¤åº”ç”¨ç¨‹åºçš„ &lt;strong&gt;&lt;em&gt;æ¼”ç¤º&lt;/em&gt;&lt;/strong&gt; å’Œ &lt;strong&gt;&lt;em&gt;ç”Ÿäº§&lt;/em&gt;&lt;/strong&gt; é…ç½®å‚æ•°ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;someapp/
â”œâ”€â”€ base/
â”‚   â”œâ”€â”€ kustomization.yaml
â”‚   â”œâ”€â”€ deployment.yaml
â”‚   â”œâ”€â”€ configMap.yaml
â”‚   â””â”€â”€ service.yaml
â””â”€â”€ overlays/
    â”œâ”€â”€ production/
    â”‚   â””â”€â”€ kustomization.yaml
    â”‚   â”œâ”€â”€ replica_count.yaml
    â””â”€â”€ staging/
        â”œâ”€â”€ kustomization.yaml
        â””â”€â”€ cpu_count.yaml
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;strong&gt;&lt;code&gt;someapp/base/kustomization.yaml&lt;/code&gt; æ–‡ä»¶æŒ‡å®šäº†å…¬å…±èµ„æºå’Œå¸¸è§è‡ªå®šä¹‰é…ç½®ï¼ˆä¾‹å¦‚ï¼Œå®ƒä»¬ä¸€äº›ç›¸åŒçš„æ ‡ç­¾ï¼Œåç§°å‰ç¼€å’Œæ³¨é‡Šï¼‰ã€‚&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;&lt;code&gt;someapp/overlays/production/kustomization.yaml&lt;/code&gt; æ–‡ä»¶çš„å†…å®¹å¯èƒ½æ˜¯ï¼š&lt;/strong&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-yaml&#34;&gt;commonLabels:
  env: production
bases:
- ../../base
patches:
- replica_count.yaml
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;è¿™ä¸ª kustomization æŒ‡å®šäº†ä¸€ä¸ª &lt;strong&gt;&lt;em&gt;patch&lt;/em&gt;&lt;/strong&gt; æ–‡ä»¶ &lt;code&gt;replica_count.yaml&lt;/code&gt; ï¼Œå…¶å†…å®¹å¯èƒ½æ˜¯ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-yaml&#34;&gt;apiVersion: apps/v1
kind: Deployment
metadata:
  name: the-deployment
spec:
  replicas: 100
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;strong&gt;&lt;em&gt;patch&lt;/em&gt;&lt;/strong&gt; æ˜¯éƒ¨åˆ†çš„èµ„æºå£°æ˜ï¼Œåœ¨è¿™ä¸ªä¾‹å­ä¸­æ˜¯ Deployment çš„è¡¥ä¸ &lt;code&gt;someapp/base/deployment.yaml&lt;/code&gt; ï¼Œä»…ä¿®æ”¹äº†å‰¯æœ¬æ•°ç”¨ä»¥å¤„ç†ç”Ÿäº§æµé‡ã€‚&lt;/p&gt;

&lt;p&gt;è¯¥è¡¥ä¸ä¸ä»…ä»…æ˜¯ä¸€ä¸ªæ— ä¸Šä¸‹æ–‡ {parameter nameï¼Œvalue} å…ƒç»„ã€‚å…¶ä½œä¸ºéƒ¨åˆ† deployment specï¼Œå¯ä»¥é€šè¿‡éªŒè¯ï¼Œå³ä½¿ä¸å…¶ä½™é…ç½®éš”ç¦»è¯»å–ï¼Œä¹Ÿå…·æœ‰æ˜ç¡®çš„ä¸Šä¸‹æ–‡å’Œç”¨é€”ã€‚&lt;/p&gt;

&lt;p&gt;è¦ä¸ºç”Ÿäº§ç¯å¢ƒåˆ›å»ºèµ„æºï¼Œè¯·è¿è¡Œï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;kustomize build someapp/overlays/production
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;è¿è¡Œç»“æœå°†ä½œä¸ºä¸€ç»„å®Œæ•´èµ„æºæ‰“å°åˆ°æ ‡å‡†è¾“å‡ºï¼Œå¹¶å‡†å¤‡åº”ç”¨äºé›†ç¾¤ã€‚å¯ä»¥ç”¨ç±»ä¼¼çš„å‘½ä»¤å®šä¹‰æ¼”ç¤ºç¯å¢ƒçš„é…ç½®ã€‚&lt;/p&gt;

&lt;h2 id=&#34;ç»¼ä¸Šæ‰€è¿°&#34;&gt;ç»¼ä¸Šæ‰€è¿°&lt;/h2&gt;

&lt;p&gt;ä½¿ç”¨ &lt;strong&gt;kustomize&lt;/strong&gt; ï¼Œæ‚¨å¯ä»¥ä»…ä½¿ç”¨ Kubernetes API èµ„æºæ–‡ä»¶å°±å¯ä»¥ç®¡ç†ä»»æ„æ•°é‡çš„ Kubernetes å®šåˆ¶é…ç½®ã€‚kustomize çš„æ¯ä¸ªäº§ç‰©éƒ½æ˜¯çº¯ YAML çš„ï¼Œæ¯ä¸ªéƒ½å¯ä»¥è¿›è¡ŒéªŒè¯å’Œè¿è¡Œçš„ã€‚&lt;strong&gt;kustomize&lt;/strong&gt; é¼“åŠ±é€šè¿‡ fork/modify/rebase è¿™æ ·çš„&lt;a href=&#34;https://github.com/kubernetes-sigs/kustomize/blob/master/docs/workflows.md&#34; target=&#34;_blank&#34;&gt;å·¥ä½œæµ&lt;/a&gt;æ¥ç®¡ç†æµ·é‡çš„åº”ç”¨æè¿°æ–‡ä»¶ã€‚&lt;/p&gt;

&lt;p&gt;å°è¯•&lt;a href=&#34;https://github.com/kubernetes-sigs/kustomize/tree/master/examples/helloWorld&#34; target=&#34;_blank&#34;&gt;hello world&lt;/a&gt;ç¤ºä¾‹ï¼Œå¼€å§‹ä½¿ç”¨ &lt;strong&gt;kustomize&lt;/strong&gt; å§ï¼æœ‰å…³çš„åé¦ˆä¸è®¨è®ºï¼Œå¯ä»¥é€šè¿‡åŠ å…¥&lt;a href=&#34;https://groups.google.com/forum/#!forum/kustomize&#34; target=&#34;_blank&#34;&gt;é‚®ä»¶åˆ—è¡¨&lt;/a&gt;æˆ–æ &lt;a href=&#34;https://github.com/kubernetes-sigs/kustomize/issues/new&#34; target=&#34;_blank&#34;&gt;issue&lt;/a&gt;ï¼Œæ¬¢è¿æäº¤PRã€‚&lt;/p&gt;

&lt;h2 id=&#34;è¯‘è€…æŒ‰&#34;&gt;è¯‘è€…æŒ‰&lt;/h2&gt;

&lt;p&gt;éšç€ kubernetes 1.14 çš„å‘å¸ƒï¼Œkustomize è¢«é›†æˆåˆ° &lt;code&gt;kubectl&lt;/code&gt; ä¸­ï¼Œç”¨æˆ·å¯ä»¥åˆ©ç”¨ &lt;code&gt;kubectl apply -k dir/&lt;/code&gt; å°†æŒ‡å®šç›®å½•çš„ &lt;code&gt;kustomization.yaml&lt;/code&gt; æäº¤åˆ°é›†ç¾¤ä¸­ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;åŸæ–‡é“¾æ¥&lt;/strong&gt; &lt;a href=&#34;https://kubernetes.io/blog/2018/05/29/introducing-kustomize-template-free-configuration-customization-for-kubernetes/&#34; target=&#34;_blank&#34;&gt;https://kubernetes.io/blog/2018/05/29/introducing-kustomize-template-free-configuration-customization-for-kubernetes/&lt;/a&gt;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>ä½¿ç”¨ Kustomize å¸®ä½ ç®¡ç† kubernetes åº”ç”¨ï¼ˆä¸€ï¼‰ï¼šä»€ä¹ˆæ˜¯ Kustomize ï¼Ÿ</title>
      <link>https://guoxudong.io/en/post/kustomize-1/</link>
      <pubDate>Mon, 15 Apr 2019 13:32:59 +0800</pubDate>
      
      <guid>https://guoxudong.io/en/post/kustomize-1/</guid>
      <description>

&lt;h2 id=&#34;åˆè¯†-kustomize&#34;&gt;åˆè¯† Kustomize&lt;/h2&gt;

&lt;p&gt;ç¬¬ä¸€æ¬¡å¬è¯´ Kustomize å…¶å®æ˜¯åœ¨ kubernetes 1.14 å‘å¸ƒæ—¶å€™ï¼Œå®ƒè¢«é›†æˆåˆ° &lt;code&gt;kubectl&lt;/code&gt; ä¸­ï¼Œæˆä¸ºäº†ä¸€ä¸ªå­å‘½ä»¤ï¼Œä½†ä¹Ÿåªæ˜¯æ‰«äº†ä¸€çœ¼ï¼Œå¹¶æ²¡æœ‰æ·±ç©¶ã€‚çœŸæ­£è®©æˆ‘æ³¨æ„åˆ°å®ƒï¼Œå¹¶ä¸»åŠ¨å¼€å§‹äº†è§£å…¶åŠŸèƒ½å’Œä½¿ç”¨æ–¹æ³•çš„ï¼Œæ˜¯å¼ ç£Šå¤§ç¥åœ¨äº‘æ –ç¤¾åŒºå‘è¡¨çš„ä¸€ç¯‡æ–‡ç« &lt;a href=&#34;https://yq.aliyun.com/articles/697883&#34; target=&#34;_blank&#34;&gt;ã€Šä»Kubernetes 1.14 å‘å¸ƒï¼Œçœ‹æŠ€æœ¯ç¤¾åŒºæ¼”è¿›æ–¹å‘ã€‹&lt;/a&gt;ï¼Œä»–åœ¨æ–‡ä¸­æ˜¯è¿™ä¹ˆè¯´çš„ï¼š&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;Kustomize å…è®¸ç”¨æˆ·ä»¥ä¸€ä¸ªåº”ç”¨æè¿°æ–‡ä»¶ ï¼ˆYAML æ–‡ä»¶ï¼‰ä¸ºåŸºç¡€ï¼ˆBase YAMLï¼‰ï¼Œç„¶åé€šè¿‡ Overlay çš„æ–¹å¼ç”Ÿæˆæœ€ç»ˆéƒ¨ç½²åº”ç”¨æ‰€éœ€çš„æè¿°æ–‡ä»¶ï¼Œè€Œä¸æ˜¯åƒ Helm é‚£æ ·åªæä¾›åº”ç”¨æè¿°æ–‡ä»¶æ¨¡æ¿ï¼Œç„¶åé€šè¿‡å­—ç¬¦æ›¿æ¢ï¼ˆTemplatingï¼‰çš„æ–¹å¼æ¥è¿›è¡Œå®šåˆ¶åŒ–ã€‚&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;è¿™ä¸æ­£æˆ‘åœ¨è‹¦è‹¦å¯»æ‰¾çš„ä¸œè¥¿å˜›ï¼è‡ªä»å…¬å¸ç¡®å®šäº†åº”ç”¨å®¹å™¨åŒ–çš„æ–¹æ¡ˆï¼Œè‡³ä»Šå·²æœ‰åŠå¹´å¤šäº†ï¼Œè¿™æœŸé—´æˆ‘ä»¬çš„æœåŠ¡ä¸€ä¸ªæ¥ä¸€ä¸ªçš„å®ç°äº†å®¹å™¨åŒ–ï¼Œéƒ¨ç½²åˆ°äº† kubernetes é›†ç¾¤ä¸­ã€‚kubernetes é›†ç¾¤ä¹Ÿæœ‰åŸå…ˆäº†1ä¸ªæµ‹è¯•é›†ç¾¤ï¼Œå‡ ä¸ªèŠ‚ç‚¹ï¼Œå‘å±•åˆ°äº†å¦‚ä»Šçš„å¤šä¸ªé›†ç¾¤ï¼Œå‡ åä¸ªèŠ‚ç‚¹ã€‚è€Œåœ¨æ¨è¿›å®¹å™¨åŒ–çš„è¿‡ç¨‹ä¸­ï¼Œæ¯ä¸ªæœåŠ¡éƒ½å¯¹å¯¹åº”å¤šä¸ªåº”ç”¨æè¿°æ–‡ä»¶ï¼ˆ YAML æ–‡ä»¶ï¼‰ï¼Œè€Œæ ¹æ®ç¯å¢ƒçš„ä¸åŒï¼Œåˆé…ç½®äº†å¤šå¥—çš„åº”ç”¨æè¿°æ–‡ä»¶ã€‚éšç€æœåŠ¡è¶Šéƒ¨è¶Šå¤šï¼Œåº”ç”¨æè¿°æ–‡ä»¶æ›´æ˜¯å‘ˆçˆ†ç‚¸å¼çš„å¢é•¿ã€‚&lt;/p&gt;

&lt;p&gt;æ„Ÿè°¢ devops æ–‡åŒ–ï¼Œå®ƒæ˜¯æˆ‘ä¸éœ€è¦ä¸ºæ¯ä¸ªåº”ç”¨å»å†™ YAML æ–‡ä»¶ï¼Œå„ä¸ªåº”ç”¨çš„å¼€å‘ç»„æ‰¿æ‹…äº†è¿™ä¸€å·¥ä½œï¼Œæˆ‘åªéœ€è¦ä¸ºä»–ä»¬æä¾›åŸºç¡€æ¨¡æ¿å³å¯ã€‚ä½†åº”ç”¨ä¸Šçº¿åå‡ºç°çš„ OOM ã€æœåŠ¡æ— æ³•æ‹‰èµ·ç­‰ YAML æ–‡ä»¶é…ç½®æœ‰è¯¯å¯¼è‡´çš„é—®é¢˜æ¥è¸µè€Œè‡³ï¼Œä½¿å¾—æˆ‘å¿…é¡»è¦æ·±å…¥å„ä¸ªæœåŠ¡ï¼Œä¸ºä»–ä»¬é…ç½®ç¬¦åˆä»–ä»¬é…ç½®ã€‚è™½ç„¶ä¹Ÿä½¿ç”¨äº† &lt;code&gt;helm&lt;/code&gt; ï¼Œä½†æ˜¯å…¶åªæä¾›åº”ç”¨æè¿°æ–‡ä»¶æ¨¡æ¿ï¼Œåœ¨ä¸åŒç¯å¢ƒæ‹‰èµ·ä¸€æ•´å¥—æœåŠ¡ä¼šèŠ‚çœå¾ˆå¤šæ—¶é—´ï¼Œè€Œåƒæˆ‘ä»¬è¿™ç§åœ¨æŒ‡å®šç¯å¢ƒå¿«é€Ÿè¿­ä»£çš„æœåŠ¡ï¼Œå¹¶ä¸ä¼šå‡å°‘å¾ˆå¤šæ—¶é—´ã€‚é’ˆå¯¹è¿™ç§æƒ…å†µï¼Œæˆ‘å·²ç»è®¡åˆ’è¦è‡ªå·±å¼€å‘ä¸€å¥—æ›´ç¬¦åˆæˆ‘ä»¬å·¥ä½œè¿™ç§åœºæ™¯çš„åº”ç”¨ç®¡ç†æœåŠ¡ï¼Œé›†æˆåœ¨æˆ‘ä»¬è‡ªå·±çš„ devops å¹³å°ä¸­ã€‚&lt;/p&gt;

&lt;p&gt;è¿™æ—¶ Kustomize å‡ºç°äº†ï¼Œæˆ‘æ˜é”çš„æ„Ÿè§‰åˆ° Kustomize å¯èƒ½å°±æ˜¯è§£å†³æˆ‘ç°é˜¶æ®µé—®é¢˜çš„ä¸€å‰‚è‰¯è¯ã€‚&lt;/p&gt;

&lt;h2 id=&#34;ä»€ä¹ˆæ˜¯-kustomize&#34;&gt;ä»€ä¹ˆæ˜¯ Kustomize ï¼Ÿ&lt;/h2&gt;

&lt;blockquote&gt;
&lt;h4 id=&#34;kubernetes-native-configuration-management&#34;&gt;Kubernetes native configuration management&lt;/h4&gt;

&lt;p&gt;Kustomize introduces a template-free way to customize application configuration that simplifies the use of off-the-shelf applications. Now, built into &lt;code&gt;kubectl&lt;/code&gt; as &lt;code&gt;apply -k&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;&lt;code&gt;kustomize&lt;/code&gt;  å…è®¸ç”¨æˆ·ä»¥ä¸€ä¸ªåº”ç”¨æè¿°æ–‡ä»¶ ï¼ˆYAML æ–‡ä»¶ï¼‰ä¸ºåŸºç¡€ï¼ˆBase YAMLï¼‰ï¼Œç„¶åé€šè¿‡ Overlay çš„æ–¹å¼ç”Ÿæˆæœ€ç»ˆéƒ¨ç½²åº”ç”¨æ‰€éœ€çš„æè¿°æ–‡ä»¶ã€‚è€Œå…¶ä»–ç”¨æˆ·å¯ä»¥å®Œå…¨ä¸å—å½±å“çš„ä½¿ç”¨ä»»ä½•ä¸€ä¸ª Base YAML æˆ–è€…ä»»ä½•ä¸€å±‚ç”Ÿæˆå‡ºæ¥çš„ YAML ã€‚è¿™ä½¿å¾—æ¯ä¸€ä¸ªç”¨æˆ·éƒ½å¯ä»¥é€šè¿‡ç±»ä¼¼fork/modify/rebase è¿™æ · Git é£æ ¼çš„æµç¨‹æ¥ç®¡ç†æµ·é‡çš„åº”ç”¨æè¿°æ–‡ä»¶ã€‚è¿™ç§ PATCH çš„æ€æƒ³è·Ÿ Docker é•œåƒæ˜¯éå¸¸ç›¸ä¼¼çš„ï¼Œå®ƒå¯ä»¥è§„é¿â€œå­—ç¬¦æ›¿æ¢â€å¯¹åº”ç”¨æè¿°æ–‡ä»¶çš„å…¥ä¾µï¼Œä¹Ÿä¸éœ€è¦ç”¨æˆ·å­¦ä¹ é¢å¤–çš„ DSL è¯­æ³•ï¼ˆæ¯”å¦‚ Luaï¼‰ã€‚&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;è€Œå…¶æˆä¸º &lt;code&gt;kubectl&lt;/code&gt; å­å‘½ä»¤åˆ™ä»£è¡¨è¿™ &lt;code&gt;kubectl&lt;/code&gt; æœ¬èº«çš„æ’ä»¶æœºåˆ¶çš„æˆç†Ÿï¼Œæœªæ¥å¯èƒ½æœ‰æ›´å¤šçš„å·¥å…·å‘½ä»¤é›†æˆåˆ° &lt;code&gt;kubectl&lt;/code&gt; ä¸­ã€‚æ‹¿å¼ ç£Šå¤§ç¥çš„è¿™å¼ å›¾ä¸éš¾çœ‹å‡ºï¼Œåœ¨ kubernetes åŸç”Ÿåº”ç”¨ç®¡ç†ç³»ç»Ÿä¸­ï¼Œåº”ç”¨æè¿°æ–‡ä»¶åœ¨æ•´ä¸ªåº”ç”¨ç®¡ç†ä½“ç³»ä¸­å æ®æ ¸å¿ƒä½ç½®ï¼Œé€šè¿‡åº”ç”¨æè¿°æ–‡ä»¶å¯ä»¥ç»„åˆå’Œç¼–æ’å¤šç§ kubernetes API èµ„æºï¼Œkubernetes é€šè¿‡æ§åˆ¶å™¨æ¥ä¿è¯é›†ç¾¤ä¸­çš„èµ„æºä¸åº”ç”¨çŠ¶æ€ä¸æè¿°æ–‡ä»¶å®Œå…¨ä¸€è‡´ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;http://wx4.sinaimg.cn/large/ad5fbf65gy1g23cqlrodkj21bq0r8znk.jpg&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;

&lt;p&gt;Kustomize ä¸åƒ Helm é‚£æ ·éœ€è¦ä¸€æ•´å¥—ç‹¬ç«‹çš„ä½“ç³»æ¥å®Œæˆç®¡ç†åº”ç”¨ï¼Œè€Œæ˜¯å®Œå…¨é‡‡ç”¨ kubernetes çš„è®¾è®¡ç†å¿µæ¥å®Œæˆç®¡ç†åº”ç”¨çš„ç›®çš„ã€‚åŒæ—¶ä½¿ç”¨èµ·æ¥ä¹Ÿæ›´åŠ çš„å¾—å¿ƒåº”æ‰‹ã€‚&lt;/p&gt;

&lt;h2 id=&#34;å‚è€ƒ&#34;&gt;å‚è€ƒ&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;&lt;p&gt;&lt;a href=&#34;https://kustomize.io/&#34; target=&#34;_blank&#34;&gt;Kustomize - kustomize.io&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;&lt;a href=&#34;https://yq.aliyun.com/articles/697883&#34; target=&#34;_blank&#34;&gt;ä»Kubernetes 1.14 å‘å¸ƒï¼Œçœ‹æŠ€æœ¯ç¤¾åŒºæ¼”è¿›æ–¹å‘ - yq.aliyun.com&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>å•èŠ‚ç‚¹ç‰ˆrancherå‡çº§æŒ‡å—</title>
      <link>https://guoxudong.io/en/post/rancher-update-2.2.1/</link>
      <pubDate>Sun, 31 Mar 2019 11:15:35 +0800</pubDate>
      
      <guid>https://guoxudong.io/en/post/rancher-update-2.2.1/</guid>
      <description>

&lt;blockquote&gt;
&lt;p&gt;Rancher ä¸ä»…å¯ä»¥åœ¨ä»»ä½•äº‘æä¾›å•†çš„ä»»ä½•åœ°æ–¹éƒ¨ç½² Kubernetes é›†ç¾¤ï¼Œè€Œä¸”è¿˜å°†å®ƒä»¬é›†ä¸­åœ¨é›†ä¸­å¼çš„èº«ä»½éªŒè¯å’Œè®¿é—®æ§åˆ¶ä¹‹ä¸‹ã€‚ç”±äºå®ƒä¸èµ„æºçš„è¿è¡Œä½ç½®æ— å…³ï¼Œå› æ­¤æ‚¨å¯ä»¥è½»æ¾åœ°åœ¨ä¸åŒçš„ç¯å¢ƒéƒ¨ç½²ä½ çš„ kubernetes é›†ç¾¤å¹¶æ“ä½œä»–ä»¬ã€‚ Rancher ä¸æ˜¯å°†éƒ¨ç½²å‡ ä¸ªç‹¬ç«‹çš„ Kubernetes é›†ç¾¤ï¼Œè€Œæ˜¯å°†å®ƒä»¬ç»Ÿä¸€ä¸ºä¸€ä¸ªå•ç‹¬çš„æ‰˜ç®¡Kubernetes Cloudã€‚&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h2 id=&#34;å‰è¨€&#34;&gt;å‰è¨€&lt;/h2&gt;

&lt;p&gt;ç›®å‰æˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ rancher 2.1.1ç‰ˆæœ¬ï¼Œåœ¨å»å¹´ rancher å‘å¸ƒ &lt;code&gt;v2.1.*&lt;/code&gt; ç‰ˆæœ¬çš„æ—¶å€™åšè¿‡ä¸€æ¬¡å‡çº§ï¼Œå½“æ—¶é‡åˆ°äº†å¾ˆå¤šé—®é¢˜ï¼Œè™½ç„¶éƒ½ä¸€ä¸€è§£å†³ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰æœ‰æ•ˆçš„è®°å½•ä¸‹æ¥ï¼Œè¿™é‡Œåœ¨å‡çº§ &lt;code&gt;v2.2.*&lt;/code&gt; ç‰ˆæœ¬çš„æ—¶å€™åšä¸€ä¸ªè®°å½•ä»¥ä¾¿åœ¨ä»Šåå‡çº§çš„æ—¶å€™çš„æä¾›å‚è€ƒä½œç”¨ã€‚&lt;/p&gt;

&lt;h2 id=&#34;å‡çº§å‰çš„å‡†å¤‡&#34;&gt;å‡çº§å‰çš„å‡†å¤‡&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;é¦–å…ˆæŸ¥çœ‹å½“å‰ rancher ç‰ˆæœ¬ï¼Œè®°ä¸‹è¿™ä¸ªç‰ˆæœ¬å·åé¢éœ€è¦ä½¿ç”¨ã€‚æŸ¥çœ‹æ–¹å¼å°±æ˜¯ç™»é™† rancher åœ¨å·¦ä¸‹è§’å°±å¯ä»¥çœ‹åˆ°å½“å‰ç‰ˆæœ¬å·ï¼Œæˆ‘ä»¬è¿™é‡Œä½¿ç”¨çš„&lt;code&gt;v2.1.1&lt;/code&gt;ç‰ˆæœ¬ã€‚&lt;/li&gt;
&lt;li&gt;æ‰“å¼€å®˜æ–¹æ–‡æ¡£ï¼Œè¿™é‡Œæ¨èå¯¹ç…§å®˜æ–¹æ–‡æ¡£è¿›è¡Œå‡çº§ï¼Œä¸€èˆ¬å®˜æ–¹æ–‡æ¡£éƒ½ä¼šåŠæ—¶æ›´æ–°å¹¶æä¾›æœ€ä½³å‡çº§æ–¹æ³•ï¼Œè€Œä¸€èˆ¬çš„åšå®¢ä¼šå› ä¸ºå…¶å†™ä½œæ—¶é—´ã€ä½¿ç”¨ç‰ˆæœ¬ã€éƒ¨ç½²ç¯å¢ƒçš„ä¸åŒæœ‰æ‰€åå·®ã€‚å®˜æ–¹æ–‡æ¡£ï¼š &lt;a href=&#34;https://www.cnrancher.com/docs/rancher/v2.x/cn/upgrades/single-node-upgrade/&#34; target=&#34;_blank&#34;&gt;https://www.cnrancher.com/docs/rancher/v2.x/cn/upgrades/single-node-upgrade/&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;å‡çº§&#34;&gt;å‡çº§&lt;/h2&gt;

&lt;ol&gt;
&lt;li&gt;&lt;p&gt;é¦–å…ˆè·å–æ­£åœ¨è¿è¡Œçš„ rancher å®¹å™¨ ID,ç”±ä»¥ä¸‹å‘½ä»¤å¯çŸ¥ &lt;code&gt;RANCHER_CONTAINER_ID&lt;/code&gt; ä¸º &lt;code&gt;83167cb60134&lt;/code&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ docker ps
CONTAINER ID        IMAGE                    COMMAND             CREATED             STATUS              
PORTS                                       NAMES
83167cb60134        rancher/rancher:latest   &amp;quot;entrypoint.sh&amp;quot;     4 months ago        Up 4 months         0.0.0.0:80-&amp;gt;80/tcp, 0.0.0.0:443-&amp;gt;443/tcp   priceless_newton
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;åœæ­¢è¯¥å®¹å™¨&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ docker stop {RANCHER_CONTAINER_ID}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;åˆ›å»ºæ­£åœ¨è¿è¡Œçš„ Rancher Server å®¹å™¨çš„æ•°æ®å·å®¹å™¨ï¼Œå°†åœ¨å‡çº§ä¸­ä½¿ç”¨ï¼Œè¿™é‡Œå‘½åä¸º &lt;code&gt;rancher-data&lt;/code&gt; å®¹å™¨ã€‚&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;æ›¿æ¢{RANCHER_CONTAINER_ID}ä¸ºä¸Šä¸€æ­¥ä¸­çš„å®¹å™¨IDã€‚&lt;/li&gt;

&lt;li&gt;&lt;p&gt;æ›¿æ¢{RANCHER_CONTAINER_TAG}ä¸ºä½ å½“å‰æ­£åœ¨è¿è¡Œçš„Rancherç‰ˆæœ¬ï¼Œå¦‚ä¸Šé¢çš„å…ˆå†³æ¡ä»¶ä¸­æ‰€è¿°ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ docker create --volumes-from {RANCHER_CONTAINER_ID} --name rancher-data rancher/rancher:{RANCHER_CONTAINER_TAG}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;å¤‡ä»½ &lt;code&gt;rancher-data&lt;/code&gt; æ•°æ®å·å®¹å™¨&lt;/p&gt;

&lt;p&gt;å¦‚æœå‡çº§å¤±è´¥ï¼Œå¯ä»¥é€šè¿‡æ­¤å¤‡ä»½è¿˜åŸRancher Serverï¼Œå®¹å™¨å‘½å:rancher-data-snapshot-&lt;CURRENT_VERSION&gt;.&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;æ›¿æ¢{RANCHER_CONTAINER_ID}ä¸ºä¸Šä¸€æ­¥ä¸­çš„å®¹å™¨IDã€‚&lt;/li&gt;
&lt;li&gt;æ›¿æ¢{CURRENT_VERSION}ä¸ºå½“å‰å®‰è£…çš„Rancherç‰ˆæœ¬çš„æ ‡è®°ã€‚&lt;/li&gt;

&lt;li&gt;&lt;p&gt;æ›¿æ¢{RANCHER_CONTAINER_TAG}ä¸ºå½“å‰æ­£åœ¨è¿è¡Œçš„Rancherç‰ˆæœ¬ï¼Œå¦‚å…ˆå†³æ¡ä»¶ä¸­æ‰€è¿° ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ docker create --volumes-from {RANCHER_CONTAINER_ID} --name rancher-data-snapshot-{CURRENT_VERSION} rancher/rancher:{RANCHER_CONTAINER_TAG}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;æ‹‰å–Rancherçš„æœ€æ–°é•œåƒ,è¿™é‡Œç¡®ä¿æœ‰å¤–ç½‘ï¼Œå¯èƒ½æ‹‰å–åˆ°æ–°çš„é•œåƒï¼Œå¦‚æœæ²¡æœ‰å¤–ç½‘ï¼Œè¿™é‡Œå°±éœ€è¦å°†é•œåƒä¸Šä¼ åˆ°ç§æœ‰é•œåƒä»“åº“ï¼Œå°†æ‹‰å–åœ°å€è®¾ç½®ä¸ºç§æœ‰é•œåƒä»“åº“å³å¯&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ docker pull rancher/rancher:latest
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;é€šè¿‡ &lt;code&gt;rancher-data&lt;/code&gt; æ•°æ®å·å®¹å™¨å¯åŠ¨æ–°çš„ Rancher Server å®¹å™¨ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;è¿™é‡Œè¦æ³¨æ„åˆ°ï¼Œæˆ‘ä»¬è¿™æ˜¯ä½¿ç”¨çš„æ˜¯ç‹¬ç«‹å®¹å™¨+å¤–éƒ¨ä¸ƒå±‚è´Ÿè½½å‡è¡¡ï¼Œæ˜¯é€šè¿‡é˜¿é‡Œäº‘SLBè¿›è¡ŒSSLè¯ä¹¦è®¤è¯ï¼Œéœ€è¦åœ¨å¯åŠ¨çš„æ—¶å€™å¢åŠ &lt;code&gt;--no-cacerts&lt;/code&gt;&lt;/strong&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ docker run -d --volumes-from rancher-data --restart=unless-stopped -p 80:80 -p 443:443 rancher/rancher:latest --no-cacerts
&lt;/code&gt;&lt;/pre&gt;

&lt;blockquote&gt;
&lt;p&gt;å‡çº§è¿‡ç¨‹ä¼šéœ€è¦ä¸€å®šæ—¶é—´ï¼Œä¸è¦åœ¨å‡çº§è¿‡ç¨‹ä¸­ç»ˆæ­¢å‡çº§ï¼Œå¼ºåˆ¶ç»ˆæ­¢å¯èƒ½ä¼šå¯¼è‡´æ•°æ®åº“è¿ç§»é”™è¯¯ã€‚&lt;/p&gt;

&lt;p&gt;å‡çº§ Rancher Serveråï¼Œ server å®¹å™¨ä¸­çš„æ•°æ®ä¼šä¿å­˜åˆ° &lt;code&gt;rancher-data&lt;/code&gt; å®¹å™¨ä¸­ï¼Œä»¥ä¾¿å°†æ¥å‡çº§ã€‚&lt;/p&gt;
&lt;/blockquote&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;åˆ é™¤æ—§ç‰ˆæœ¬ Rancher Server å®¹å™¨&lt;/p&gt;

&lt;p&gt;å¦‚æœä½ åªæ˜¯åœæ­¢ä»¥å‰çš„Rancher Serverå®¹å™¨(å¹¶ä¸”ä¸åˆ é™¤å®ƒ),åˆ™æ—§ç‰ˆæœ¬å®¹å™¨å¯èƒ½éšç€ä¸»æœºé‡å¯åè‡ªåŠ¨è¿è¡Œï¼Œå¯¼è‡´å®¹å™¨ç«¯å£å†²çªã€‚&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;å‡çº§æˆåŠŸ&lt;/p&gt;

&lt;p&gt;è®¿é—® rancher å¯ä»¥çœ‹åˆ°å³ä¸‹è§’ç‰ˆæœ¬å·²ç»å®Œæˆæ›´æ–°ã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;http://wx4.sinaimg.cn/large/ad5fbf65gy1g1lzcmucn6j20ck03qt8p.jpg&#34; alt=&#34;image&#34; /&gt;&lt;/p&gt;&lt;/li&gt;
&lt;/ol&gt;
</description>
    </item>
    
    <item>
      <title>è‡ªåŠ¨åˆå¹¶Kubeconfigï¼Œå®ç°å¤šk8sé›†ç¾¤åˆ‡æ¢</title>
      <link>https://guoxudong.io/en/post/merge-kubeconfig/</link>
      <pubDate>Sun, 17 Mar 2019 10:45:02 +0800</pubDate>
      
      <guid>https://guoxudong.io/en/post/merge-kubeconfig/</guid>
      <description>

&lt;h2 id=&#34;å‰è¨€&#34;&gt;å‰è¨€&lt;/h2&gt;

&lt;blockquote&gt;
&lt;p&gt;éšç€å¾®æœåŠ¡å’Œå®¹å™¨åŒ–çš„æ·±å…¥äººå¿ƒï¼Œä»¥åŠkuberneteså·²ç»æˆä¸ºå®¹å™¨ç¼–æ’é¢†åŸŸçš„äº‹å®æ ‡å‡†ï¼Œè¶Šæ¥è¶Šå¤šçš„å…¬å¸å°†è‡ªå·±çš„æœåŠ¡è¿ç§»åˆ°kubernetesé›†ç¾¤ä¸­ã€‚è€Œéšç€kubernetesé›†ç¾¤çš„å¢åŠ ï¼Œé›†ç¾¤ç®¡ç†çš„é—®é¢˜å°±å‡¸æ˜¾å‡ºæ¥ï¼Œä¸åŒçš„ç¯å¢ƒå­˜åœ¨ä¸åŒçš„é›†ç¾¤ï¼Œä¸åŒçš„ä¸šåŠ¡çº¿ä¸åŒçš„é›†ç¾¤ï¼Œç”šè‡³æœ‰äº›å¼€å‘äººå‘˜éƒ½æœ‰è‡ªå·±çš„é›†ç¾¤ã€‚è¯šç„¶ï¼Œå¦‚æœé›†ç¾¤æ˜¯ä½¿ç”¨å…¬æœ‰äº‘å¦‚é˜¿é‡Œäº‘æˆ–åä¸ºäº‘çš„å®¹å™¨æœåŠ¡ï¼Œå¯ä»¥ç™»å½•å…¶æ§åˆ¶å°è¿›è¡Œé›†ç¾¤ç®¡ç†ï¼›æˆ–è€…ä½¿ç”¨rancherè¿™ç”¨çš„å¤šé›†ç¾¤ç®¡ç†å·¥å…·è¿›è¡Œç»Ÿä¸€çš„ç®¡ç†ã€‚ä½†æ˜¯åœ¨æƒ³æ“ä½œ&lt;code&gt;istio&lt;/code&gt;ç‰¹æœ‰çš„å®¹å™¨èµ„æºï¼Œæˆ–è€…æƒ³ä½¿ç”¨&lt;code&gt;istioctl&lt;/code&gt;çš„æ—¶å€™ï¼Œæˆ–è€…åƒæˆ‘ä¸€æ ·å°±æ˜¯æƒ³ä½¿ç”¨&lt;code&gt;kubectl&lt;/code&gt;å‘½ä»¤çš„åŒå­¦ï¼Œè¿™ä¸ªæ—¶å€™å¤šé›†ç¾¤çš„åˆ‡æ¢å°±æ˜¾çš„ååˆ†é‡è¦äº†ã€‚&lt;/p&gt;

&lt;h2 id=&#34;ç®€ä»‹&#34;&gt;ç®€ä»‹&lt;/h2&gt;

&lt;pre&gt;&lt;code class=&#34;language-kubectl```å‘½ä»¤è¡Œå·¥å…·é€šè¿‡```kubeconfig```æ–‡ä»¶çš„é…ç½®æ¥é€‰æ‹©é›†ç¾¤ä»¥åŠé›†ç¾¤çš„API&#34;&gt;
## åŸç†
ä½¿ç”¨```kubeconfig```æ–‡ä»¶ï¼Œæ‚¨å¯ä»¥ç»„ç»‡æ‚¨çš„ç¾¤é›†ï¼Œç”¨æˆ·å’Œåç§°ç©ºé—´ã€‚ è¿˜å¯ä»¥å®šä¹‰ä¸Šä¸‹æ–‡ä»¥å¿«é€Ÿè½»æ¾åœ°åœ¨ç¾¤é›†å’Œåç§°ç©ºé—´ä¹‹é—´åˆ‡æ¢ã€‚

### ä¸Šä¸‹æ–‡(Context) 
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;kubeconfig```æ–‡ä»¶ä¸­çš„ä¸Šä¸‹æ–‡å…ƒç´ ç”¨äºä»¥æ–¹ä¾¿çš„åç§°å¯¹è®¿é—®å‚æ•°è¿›è¡Œåˆ†ç»„ã€‚ æ¯ä¸ªä¸Šä¸‹æ–‡æœ‰ä¸‰ä¸ªå‚æ•°ï¼šé›†ç¾¤ï¼Œå‘½åç©ºé—´å’Œç”¨æˆ·ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œkubectlå‘½ä»¤è¡Œå·¥å…·ä½¿ç”¨å½“å‰ä¸Šä¸‹æ–‡ä¸­çš„å‚æ•°ä¸é›†ç¾¤è¿›è¡Œé€šä¿¡ã€‚å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤è®¾ç½®ä¸Šä¸‹æ–‡ï¼š&lt;/p&gt;
&lt;/blockquote&gt;

&lt;pre&gt;&lt;code&gt;kubectl config use-context
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;é…ç½®å†…å®¹&#34;&gt;é…ç½®å†…å®¹&lt;/h3&gt;

&lt;pre&gt;&lt;code&gt;kubectl config view
&lt;/code&gt;&lt;/pre&gt;

&lt;ol&gt;
&lt;li&gt;å¦‚æœè®¾ç½®äº†&lt;code&gt;--kubeconfig&lt;/code&gt;æ ‡å¿—ï¼Œåˆ™åªä½¿ç”¨æŒ‡å®šçš„æ–‡ä»¶ã€‚è¯¥æ ‡å¿—åªå…è®¸æœ‰ä¸€ä¸ªå®ä¾‹ã€‚&lt;/li&gt;
&lt;li&gt;å¦‚æœç¯å¢ƒå˜é‡&lt;code&gt;KUBECONFIG&lt;/code&gt;å­˜åœ¨ï¼Œé‚£ä¹ˆå°±ä½¿ç”¨è¯¥ç¯å¢ƒå˜é‡&lt;code&gt;KUBECONFIG&lt;/code&gt;é‡Œé¢çš„å€¼ï¼Œå¦‚æœä¸å­˜åœ¨è¯¥ç¯å¢ƒå˜é‡&lt;code&gt;KUBECONFIG&lt;/code&gt;ï¼Œé‚£ä¹ˆé»˜è®¤å°±æ˜¯ä½¿ç”¨&lt;code&gt;$HOME/.kube/config&lt;/code&gt;æ–‡ä»¶ã€‚&lt;/li&gt;
&lt;/ol&gt;

&lt;h3 id=&#34;kubeconfig-å†…å®¹&#34;&gt;&lt;code&gt;kubeconfig&lt;/code&gt;å†…å®¹&lt;/h3&gt;

&lt;p&gt;ä»ä¸‹é¢kubeconfigæ–‡ä»¶çš„é…ç½®æ¥çœ‹é›†ç¾¤ã€ç”¨æˆ·ã€ä¸Šä¸‹æ–‡ã€å½“å‰ä¸Šä¸‹æ–‡çš„å…³ç³»å°±æ¯”è¾ƒæ˜æ˜¾äº†ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;apiVersion: v1
kind: Config
preferences: {}

clusters:
- cluster:
name: {cluster-name}

users:
- name: {user-name}

contexts:
- context:
    cluster: {cluster-name}
    user: {user-name}
name: {context-name}

current-context: {context-name}
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;ä¸ºä½•è¦è‡ªåŠ¨åˆå¹¶&#34;&gt;ä¸ºä½•è¦è‡ªåŠ¨åˆå¹¶&lt;/h2&gt;

&lt;p&gt;åœ¨æ—¥å¸¸çš„å·¥ä½œä¸­ï¼Œå¦‚æœæˆ‘ä»¬éœ€è¦æ“ä½œå¤šä¸ªé›†ç¾¤ï¼Œä¼šå¾—åˆ°å¤šä¸ªkubeconfigé…ç½®æ–‡ä»¶ã€‚ä¸€èˆ¬çš„kubeconfigæ–‡ä»¶éƒ½æ˜¯yamlæ ¼å¼çš„ï¼Œä½†æ˜¯ä¹Ÿæœ‰å°‘éƒ¨åˆ†çš„é›†ç¾¤kubeconfigæ—¶å·²jsonæ–‡ä»¶çš„å½¢å¼ç»™å‡ºçš„ï¼ˆæ¯”å¦‚åä¸ºäº‘çš„=ã€‚=ï¼‰ï¼Œæ¯”å¦‚æˆ‘ä»¬å…¬å¸å†é˜¿é‡Œäº‘ã€åä¸ºäº‘å’Œè‡ªå»ºç¯å¢ƒä¸Šå‡å­˜åœ¨kubernetesé›†ç¾¤ï¼Œå¹³æ—¶æ“ä½œè¦åœ¨å¤šé›†ç¾¤ä¹‹é—´åˆ‡æ¢ï¼Œè¿™ä¹Ÿå°±å‚¬ç”Ÿäº†æˆ‘å†™è¿™ä¸ªå·¥å…·ï¼ˆå…¶å®å°±æ˜¯ä¸€ä¸ªè„šæœ¬ï¼‰çš„åŠ¨æœºã€‚&lt;/p&gt;

&lt;h2 id=&#34;è‡ªåŠ¨åˆå¹¶ç”Ÿæˆkubeconfig&#34;&gt;è‡ªåŠ¨åˆå¹¶ç”Ÿæˆkubeconfig&lt;/h2&gt;

&lt;p&gt;ä¼—æ‰€å‘¨çŸ¥ï¼Œyamlæ˜¯ä¸€ç§ç›´è§‚çš„èƒ½å¤Ÿè¢«ç”µè„‘è¯†åˆ«çš„æ•°æ®åºåˆ—åŒ–æ ¼å¼ï¼Œæ˜¯ä¸€ä¸ªå¯è¯»æ€§é«˜å¹¶ä¸”å®¹æ˜“è¢«äººç±»é˜…è¯»çš„è¯­è¨€å’Œjsonç›¸æ¯”ï¼ˆæ²¡æœ‰æ ¼å¼åŒ–ä¹‹å‰ï¼‰å¯è¯»æ€§æ›´å¼ºã€‚è€Œæˆ‘è¿™ä¸ªå·¥å…·å¹¶ä¸æ˜¯å¾ˆå…³å¿ƒkubeconfigçš„æ ¼å¼ï¼Œåªè¦å°†æƒ³è¦åˆå¹¶çš„kubeconfigæ”¾å…¥æŒ‡å®šæ–‡ä»¶å³å¯ã€‚&lt;/p&gt;

&lt;p&gt;GitHubï¼š&lt;a href=&#34;https://github.com/sunny0826/mergeKubeConfig&#34; target=&#34;_blank&#34;&gt;https://github.com/sunny0826/mergeKubeConfig&lt;/a&gt;&lt;/p&gt;

&lt;h3 id=&#34;é€‚ç”¨ç¯å¢ƒ&#34;&gt;é€‚ç”¨ç¯å¢ƒ&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;éœ€è¦åœ¨ç»ˆç«¯ä½¿ç”¨å‘½ä»¤è¡Œç®¡ç†å¤šé›†ç¾¤&lt;/li&gt;
&lt;li&gt;kubernetesé›†ç¾¤ä¸­å®‰è£…äº†istioï¼Œéœ€è¦ä½¿ç”¨&lt;code&gt;istioctl&lt;/code&gt;å‘½ä»¤ï¼Œä½†æ˜¯é›†ç¾¤èŠ‚ç‚¹å¹¶æ²¡æœ‰å®‰è£…&lt;code&gt;istioctl&lt;/code&gt;ï¼Œéœ€è¦åœ¨æœ¬åœ°ç»ˆç«¯æ“ä½œ&lt;/li&gt;
&lt;li&gt;ä¸æ„¿é¢‘ç¹ç¼–è¾‘.kubeç›®å½•ä¸­çš„configæ–‡ä»¶çš„åŒå­¦&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&#34;å‡†å¤‡å·¥ä½œ&#34;&gt;å‡†å¤‡å·¥ä½œ&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;Pythonç¯å¢ƒï¼š2.7æˆ–è€…3å‡å¯&lt;/li&gt;
&lt;li&gt;éœ€è¦ä¾èµ–åŒ…ï¼š&lt;code&gt;PyYAML&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&#34;å¼€å§‹ä½¿ç”¨&#34;&gt;å¼€å§‹ä½¿ç”¨&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;&lt;p&gt;å®‰è£…ä¾èµ–ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;pip install PyYAML
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;è¿è¡Œè„šæœ¬&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;p&gt;é»˜è®¤è¿è¡Œæ–¹å¼ï¼Œkubeconfigæ–‡ä»¶æ”¾å…¥&lt;code&gt;configfile&lt;/code&gt;æ–‡ä»¶,æ³¨æ„åˆ æ‰ä½œä¸ºç¤ºä¾‹çš„ä¸¤ä¸ªæ–‡ä»¶&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;python merge.py
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;è‡ªå®šä¹‰kubeconfigæ–‡ä»¶ç›®å½•&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;python merge.py -d {custom-dir}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&#34;è¿è¡Œåæ“ä½œ&#34;&gt;è¿è¡Œåæ“ä½œ&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;&lt;p&gt;å°†ç”Ÿæˆçš„configæ–‡ä»¶æ”¾å…¥.kubeç›®å½•ä¸­&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;cp config ~/.kube
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;æŸ¥çœ‹æ‰€æœ‰çš„å¯ä½¿ç”¨çš„kubernetesé›†ç¾¤è§’è‰²&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;kubectl config get-contexts
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;æ›´å¤šå…³äºkubernetesé…ç½®æ–‡ä»¶æ“ä½œ&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;kubectl config --help
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;åˆ‡æ¢kubernetesé…ç½®&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;kubectl config use-context {your-contexts}
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;ç»“è¯­&#34;&gt;ç»“è¯­&lt;/h2&gt;

&lt;p&gt;åœ¨ä½¿ç”¨kubernetesåˆæœŸï¼Œåœ¨å¤šé›†ç¾¤ä¹‹é—´æˆ‘ä¸€ç›´æ˜¯é¢‘ç¹çš„åˆ‡æ¢&lt;code&gt;.kube/config&lt;/code&gt;æ–‡ä»¶æ¥è¾¾åˆ°åˆ‡æ¢æ“ä½œé›†ç¾¤çš„ç›®çš„ã€‚è¿™ä¹Ÿå¯¼è‡´äº†æˆ‘çš„&lt;code&gt;.kube&lt;/code&gt;ç›®å½•ä¸­å­˜åœ¨è¿™å¤šä¸ªç±»ä¼¼äº&lt;code&gt;al_test_config.bak&lt;/code&gt;ã€&lt;code&gt;al_prod_config.bak&lt;/code&gt;ã€&lt;code&gt;hw_test_config.bak&lt;/code&gt;çš„æ–‡ä»¶ï¼Œæœ¬åœ°ç¯å¢ƒå·²ç»è‡ªå»ºç¯å¢ƒï¼Œåœ¨é›†ç¾¤åˆ‡æ¢çš„æ—¶å€™ååˆ†å¤´ç–¼ã€‚è€Œåæ¥ä½¿ç”¨&lt;code&gt;--kubeconfig&lt;/code&gt;æ¥è¿›è¡Œåˆ‡æ¢é›†ç¾¤ï¼Œè™½ç„¶æ¯”ä¹‹å‰çš„æ–¹æ³•è¦æ–¹ä¾¿å¾ˆå¤šï¼Œä½†æ˜¯å¹¶ä¸ååˆ†ä¼˜é›…ã€‚è¿™ä¸ªç®€å•çš„å°å·¥å…·ä¸€ä¸¾è§£å†³äº†æˆ‘çš„æ–‡ä»¶ï¼Œå¯¹äºæˆ‘è¿™ä¸ª&lt;code&gt;kubectl&lt;/code&gt;é‡åº¦ä¾èµ–è€…æ¥è¯´ååˆ†é‡è¦ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>è§£å†³kubernetesä¸­ingress-nginxé…ç½®é—®é¢˜</title>
      <link>https://guoxudong.io/en/post/k8s-ingress-config/</link>
      <pubDate>Wed, 06 Mar 2019 14:42:05 +0800</pubDate>
      
      <guid>https://guoxudong.io/en/post/k8s-ingress-config/</guid>
      <description>

&lt;h2 id=&#34;å‰è¨€&#34;&gt;å‰è¨€&lt;/h2&gt;

&lt;p&gt;éšç€å…¬å¸å®¹å™¨åŒ–çš„æ·±å…¥ï¼Œè¶Šæ¥è¶Šå¤šçš„æœåŠ¡é™†ç»­è¿ç§»åˆ°kubernetesé›†ç¾¤ä¸­ï¼Œæœ‰äº›é—®é¢˜åœ¨æµ‹è¯•ç¯å¢ƒå¹¶æœªå‡¸æ˜¾ï¼Œä½†æ˜¯åœ¨ç”Ÿäº§ç¯å¢ƒä¸­è¿™äº›é—®é¢˜å°±æ˜¾å¾—æ ¼å¤–çš„æ‰çœ¼ã€‚è¿™é‡Œå°±å¯¹å®è·µä¸­kubernetesé›†ç¾¤ä¸­çš„7å±‚è´Ÿè½½å‡è¡¡å™¨ingressé‡åˆ°çš„é—®é¢˜è¿›è¡Œæ€»ç»“ã€‚&lt;/p&gt;

&lt;h2 id=&#34;http-s-è´Ÿè½½å‡è¡¡å™¨-ingress&#34;&gt;HTTP(S)è´Ÿè½½å‡è¡¡å™¨-ingress&lt;/h2&gt;

&lt;p&gt;Ingressæ˜¯kubernetes APIçš„æ ‡å‡†èµ„æºç±»å‹ä¹‹ä¸€ï¼Œå…¶æœ¬è´¨å°±æ˜¯ä¸€ç»„åŸºäºDNSåç§°(host)æˆ–URLè·¯å¾„æŠŠè¯·æ±‚è½¬å‘è‡³æŒ‡å®šçš„Serviceèµ„æºçš„è§„åˆ™ï¼Œ&lt;strong&gt;ç”¨äºå°†é›†ç¾¤å¤–çš„è¯·æ±‚æµé‡è½¬å‘è‡³é›†ç¾¤å†…éƒ¨å®ŒæˆæœåŠ¡å‘å¸ƒ&lt;/strong&gt;ã€‚&lt;/p&gt;

&lt;p&gt;Ingressæ§åˆ¶å™¨(Ingress Controller)å¯ä»¥ç”±ä»»ä½•å…·æœ‰åå‘ä»£ç†(HTTP/HTTPS)åŠŸèƒ½çš„æœåŠ¡ç¨‹åºå®ç°ï¼Œå¦‚Nginxã€Envoyã€HAProxyã€Vulcandå’ŒTraefikç­‰ã€‚Ingressæ§åˆ¶å™¨æœ¬èº«ä¹Ÿä½œä¸ºPodå¯¹è±¡ä¸è¢«ä»£ç†çš„è¿è¡Œä¸ºPodèµ„æºçš„åº”ç”¨è¿è¡ŒäºåŒä¸€ç½‘ç»œä¸­ã€‚æˆ‘ä»¬åœ¨è¿™é‡Œé€‰æ‹©äº†NGINX Ingress Controllerï¼Œç”±äºå¯¹NGINXçš„é…ç½®è¾ƒä¸ºç†Ÿæ‚‰ï¼ŒåŒæ—¶æˆ‘ä»¬ä½¿ç”¨çš„kubernetesæ˜¯é˜¿é‡Œäº‘çš„å®¹å™¨æœåŠ¡ï¼Œæ„å»ºé›†ç¾¤çš„æ—¶å€™ï¼Œå®¹å™¨æœåŠ¡ä¼šè‡ªå¸¦NGINX Ingress Controllerã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;http://wx2.sinaimg.cn/large/ad5fbf65ly1g0t3yj7wecj20w50doab9.jpg&#34; alt=&#34;image&#34; /&gt;&lt;/p&gt;

&lt;h2 id=&#34;æ ¹æ®å®é™…æƒ…å†µingressè°ƒä¼˜&#34;&gt;æ ¹æ®å®é™…æƒ…å†µIngressè°ƒä¼˜&lt;/h2&gt;

&lt;h3 id=&#34;1-è§£å†³400-request-header-or-cookie-too-largeé—®é¢˜&#34;&gt;1. è§£å†³400 Request Header Or Cookie Too Largeé—®é¢˜&lt;/h3&gt;

&lt;p&gt;image:
  caption: &amp;ldquo;Image from: &lt;a href=&#34;https://www.pexels.com&#34; target=&#34;_blank&#34;&gt;&lt;strong&gt;Pexels&lt;/strong&gt;&lt;/a&gt;&amp;ldquo;
  focal_point: &amp;ldquo;&amp;rdquo;&lt;/p&gt;

&lt;h2 id=&#34;preview-only-false&#34;&gt;preview_only: false&lt;/h2&gt;

&lt;h4 id=&#34;ç°è±¡&#34;&gt;ç°è±¡&lt;/h4&gt;

&lt;p&gt;å¾®ä¿¡å°ç¨‹åºéœ€è¦è°ƒç”¨åç«¯æ¥å£ï¼Œéœ€è¦åœ¨headerä¸­ä¼ ä¸€æ®µå¾ˆé•¿çš„tokenå‚æ•°ï¼Œç›´æ¥ä½¿ç”¨æµè§ˆå™¨è®¿é—®è¯¥ç«¯å£å¯ä»¥è®¿é—®é€šï¼Œä½†æ˜¯åœ¨åŠ ä¸Štokenè®¿é—®ä¹‹åï¼Œä¼šæŠ¥â€œ400 Request Header Or Cookie Too Largeâ€&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-html&#34;&gt;&amp;lt;html&amp;gt;
    &amp;lt;head&amp;gt;
        &amp;lt;title&amp;gt;400 Request Header Or Cookie Too Large&amp;lt;/title&amp;gt;
    &amp;lt;/head&amp;gt;
    &amp;lt;body&amp;gt;
        &amp;lt;center&amp;gt;
            &amp;lt;h1&amp;gt;400 Bad Request&amp;lt;/h1&amp;gt;
        &amp;lt;/center&amp;gt;
        &amp;lt;center&amp;gt;Request Header Or Cookie Too Large&amp;lt;/center&amp;gt;
        &amp;lt;hr&amp;gt;
        &amp;lt;center&amp;gt;nginx/1.15.6&amp;lt;/center&amp;gt;
    &amp;lt;/body&amp;gt;
&amp;lt;/html&amp;gt;
&lt;/code&gt;&lt;/pre&gt;

&lt;h4 id=&#34;é—®é¢˜å®šä½&#34;&gt;é—®é¢˜å®šä½&lt;/h4&gt;

&lt;p&gt;ç›´æ¥ä¿®æ”¹Serviceä½¿ç”¨nodeportçš„å½¢å¼è®¿é—®ï¼Œåˆ™æ²¡æœ‰æŠ¥é”™ï¼Œåˆæ­¥å®šä½éœ€è¦åœ¨ingressä¸­nginxé…ç½®å®¢æˆ·ç«¯çš„è¯·æ±‚å¤´ï¼Œè¿›å…¥Ingress Controllerçš„PodæŸ¥è¯¢é…ç½®ï¼Œæœç„¶æ˜¯è¯·æ±‚å¤´ç©ºé—´ä¸è¶³ã€‚&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ cat nginx.conf | grep client_header_buffer_size
    client_header_buffer_size       1k;
$ cat nginx.conf | grep large_client_header_buffers
    large_client_header_buffers     4 8k;
&lt;/code&gt;&lt;/pre&gt;

&lt;h4 id=&#34;è§£å†³æ–¹æ³•&#34;&gt;è§£å†³æ–¹æ³•&lt;/h4&gt;

&lt;p&gt;åœ¨ingressä¸­æ·»åŠ æ³¨é‡Š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-nginx&#34;&gt;nginx.ingress.kubernetes.io/server-snippet: client_header_buffer_size 2046k;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;image:
  caption: &amp;ldquo;Image from: &lt;a href=&#34;https://www.pexels.com&#34; target=&#34;_blank&#34;&gt;&lt;strong&gt;Pexels&lt;/strong&gt;&lt;/a&gt;&amp;ldquo;
  focal_point: &amp;ldquo;&amp;rdquo;&lt;/p&gt;

&lt;h2 id=&#34;preview-only-false-1&#34;&gt;preview_only: false&lt;/h2&gt;

&lt;p&gt;&lt;strong&gt;Server snippet&lt;/strong&gt;&lt;br&gt;Using the annotation &lt;code&gt;nginx.ingress.kubernetes.io/server-snippet&lt;/code&gt; it is possible to add custom configuration in the server configuration block.
&lt;br&gt;è¯¥æ³¨é‡Šæ˜¯å°†è‡ªå®šä¹‰é…ç½®åŠ å…¥nginxçš„serveré…ç½®ä¸­&lt;/p&gt;

&lt;p&gt;image:
  caption: &amp;ldquo;Image from: &lt;a href=&#34;https://www.pexels.com&#34; target=&#34;_blank&#34;&gt;&lt;strong&gt;Pexels&lt;/strong&gt;&lt;/a&gt;&amp;ldquo;
  focal_point: &amp;ldquo;&amp;rdquo;&lt;/p&gt;

&lt;h2 id=&#34;preview-only-false-2&#34;&gt;preview_only: false&lt;/h2&gt;

&lt;h3 id=&#34;2-è§£å†³è¯·æ±‚è¶…æ—¶é—®é¢˜&#34;&gt;2. è§£å†³è¯·æ±‚è¶…æ—¶é—®é¢˜&lt;/h3&gt;

&lt;h4 id=&#34;ç°è±¡-1&#34;&gt;ç°è±¡&lt;/h4&gt;

&lt;p&gt;æœ‰ä¸€ä¸ªæ•°æ®å¯¼å‡ºåŠŸèƒ½ï¼Œéœ€è¦å°†å¤§é‡æ•°æ®è¿›è¡Œå¤„ç†ï¼Œç„¶åä»¥Excelæ ¼å¼è¿”å›ï¼Œåœ¨å¯¼å‡ºä¸€ä¸ªå¤§çº¦3Wæ¡æ•°æ®çš„æ—¶å€™ï¼Œå‡ºç°è®¿é—®è¶…æ—¶æƒ…å†µã€‚&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://ws2.sinaimg.cn/mw690/ad5fbf65ly1g0ubdwwzo5j21b30bjaat.jpg&#34; alt=&#34;image&#34; /&gt;&lt;/p&gt;

&lt;h4 id=&#34;è§£å†³æ–¹æ³•-1&#34;&gt;è§£å†³æ–¹æ³•&lt;/h4&gt;

&lt;p&gt;è°ƒæ•´proxy_read_timeoutï¼Œè¿æ¥æˆåŠŸå_ç­‰å€™åç«¯æœåŠ¡å™¨å“åº”æ—¶é—´_å…¶å®å·²ç»è¿›å…¥åç«¯çš„æ’é˜Ÿä¹‹ä¸­ç­‰å€™å¤„ç†
åœ¨ingressä¸­æ·»åŠ æ³¨é‡Š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-nginx&#34;&gt;nginx.ingress.kubernetes.io/proxy-read-timeout: 600
&lt;/code&gt;&lt;/pre&gt;

&lt;blockquote&gt;
&lt;p&gt;è¿™é‡Œéœ€è¦æ³¨æ„çš„äº‹è¯¥æ³¨é‡Šçš„valueéœ€è¦æ—¶numberç±»å‹ï¼Œä¸èƒ½åŠ sï¼Œå¦åˆ™å°†ä¸ç”Ÿæ•ˆ&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h3 id=&#34;3-å¢åŠ ç™½åå•&#34;&gt;3. å¢åŠ ç™½åå•&lt;/h3&gt;

&lt;h4 id=&#34;ç°è±¡-2&#34;&gt;ç°è±¡&lt;/h4&gt;

&lt;p&gt;åœ¨å®é™…çš„ä½¿ç”¨ä¸­ï¼Œä¼šæœ‰ä¸€éƒ¨åˆ†åº”ç”¨éœ€è¦è®¾ç½®åªå¯ä»¥åœ¨åŠå…¬åœºåœ°çš„ç½‘ç»œä½¿ç”¨ï¼Œä¹‹å‰ä½¿ç”¨é˜¿é‡Œäº‘ SLB çš„æ—¶å€™å¯ä»¥é’ˆå¯¹ç«¯å£è¿›è¡Œè®¿é—®æ§åˆ¶ï¼Œä½†æ˜¯ç°åœ¨èµ° ingress ï¼Œéƒ½æ˜¯ä»80 or 443ç«¯å£è¿›ï¼Œæ‰€ä»¥éœ€è¦åœ¨ ingress è®¾ç½®&lt;/p&gt;

&lt;h4 id=&#34;è§£å†³æ–¹æ³•-2&#34;&gt;è§£å†³æ–¹æ³•&lt;/h4&gt;

&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;Whitelist source range&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;You can specify allowed client IP source ranges through the nginx.ingress.kubernetes.io/whitelist-source-range annotation. The value is a comma separated list of CIDRs, e.g. 10.0.0.0/24,172.10.0.1.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;åœ¨ ingress é‡Œé…ç½® &lt;code&gt;nginx.ingress.kubernetes.io/whitelist-source-range&lt;/code&gt; ï¼Œå¦‚æœ‰å¤šä¸ªipæ®µï¼Œç”¨é€—å·åˆ†éš”å³å¯&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-nginx&#34;&gt;nginx.ingress.kubernetes.io/whitelist-source-range: 10.0.0.0/24
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;å¦‚æœæƒ³å…¨å±€é€‚ç”¨ï¼Œå¯ä»¥åœ¨é˜¿é‡Œäº‘ SLB é‡Œæ“ä½œï¼Œä¹Ÿå¯ä»¥å°†è¯¥é…ç½®åŠ å…¥åˆ° &lt;code&gt;NGINX ConfigMap&lt;/code&gt; ä¸­ã€‚&lt;/p&gt;

&lt;p&gt;image:
  caption: &amp;ldquo;Image from: &lt;a href=&#34;https://www.pexels.com&#34; target=&#34;_blank&#34;&gt;&lt;strong&gt;Pexels&lt;/strong&gt;&lt;/a&gt;&amp;ldquo;
  focal_point: &amp;ldquo;&amp;rdquo;&lt;/p&gt;

&lt;h2 id=&#34;preview-only-false-3&#34;&gt;preview_only: false&lt;/h2&gt;

&lt;p&gt;æ ¹æ®å·¥ä½œä¸­é‡åˆ°çš„å®é™…é—®é¢˜ï¼ŒæŒç»­æ›´æ–°ä¸­&amp;hellip;&lt;/p&gt;

&lt;h2 id=&#34;æ€»ç»“&#34;&gt;æ€»ç»“&lt;/h2&gt;

&lt;p&gt;ä½¿ç”¨NGINX ingress controllerçš„å¥½å¤„å°±æ˜¯å¯¹äºnginxé…ç½®ç›¸å¯¹æ¯”è¾ƒç†Ÿæ‚‰ï¼Œæ€§èƒ½ä¹Ÿä¸å·®ã€‚ç›¸å…³nginxé…ç½®çš„å¯¹åº”çš„ingresså¯ä»¥åœ¨ &lt;a href=&#34;https://kubernetes.github.io/ingress-nginx/user-guide/nginx-configuration/annotations/&#34; target=&#34;_blank&#34;&gt;https://kubernetes.github.io/ingress-nginx/user-guide/nginx-configuration/annotations/&lt;/a&gt; ä¸ŠæŸ¥åˆ°ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Podè´¨é‡æœåŠ¡ç±»åˆ«(QoS)</title>
      <link>https://guoxudong.io/en/post/k8s-qos/</link>
      <pubDate>Mon, 04 Mar 2019 19:18:13 +0800</pubDate>
      
      <guid>https://guoxudong.io/en/post/k8s-qos/</guid>
      <description>&lt;blockquote&gt;
&lt;p&gt;æ ¹æ®Podå¯¹è±¡çš„requestså’Œlimitså±æ€§ï¼Œkuberneteså°†Podå¯¹è±¡å½’ç±»åˆ°BestEffortã€Burstableå’ŒGuaranteedä¸‰ä¸ªæœåŠ¡è´¨é‡ï¼ˆQuality of Serviceï¼ŒQoSï¼‰ç±»åˆ«ã€‚&lt;/p&gt;
&lt;/blockquote&gt;

&lt;ul&gt;
&lt;li&gt;Guaranteed

&lt;ul&gt;
&lt;li&gt;cpu:requests=limits&lt;/li&gt;
&lt;li&gt;memory:requests=limits&lt;/li&gt;
&lt;li&gt;è¿™ç±»Podå…·æœ‰æœ€é«˜ä¼˜å…ˆçº§&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;Burstable

&lt;ul&gt;
&lt;li&gt;è‡³å°‘ä¸€ä¸ªå®¹å™¨è®¾ç½®äº†cpuæˆ–å†…å­˜èµ„æºçš„requests&lt;/li&gt;
&lt;li&gt;è¿™ç±»Podå…·æœ‰ä¸­ç­‰ä¼˜å…ˆçº§&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;BestEffort

&lt;ul&gt;
&lt;li&gt;æœªæœ‰ä»»ä½•ä¸€ä¸ªå®¹å™¨è®¾ç½®requestsæˆ–limitså±æ€§&lt;/li&gt;
&lt;li&gt;è¿™ç±»Podå…·æœ‰æœ€ä½ä¼˜å…ˆçº§&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;img src=&#34;http://ww1.sinaimg.cn/large/ad5fbf65ly1g0rv2ipzqkj20hx0edmx8.jpg&#34; alt=&#34;&#34; /&gt;&lt;/p&gt;

&lt;p&gt;åŒçº§åˆ«ä¼˜å…ˆçº§çš„Podèµ„æºåœ¨OOMæ—¶ï¼Œä¸è‡ªèº«çš„requestså±æ€§ç›¸æ¯”ï¼Œå…¶å†…å­˜å ç”¨æ¯”ä¾‹æœ€å¤§çš„Podå¯¹è±¡å°†è¢«é¦–å…ˆæ€æ­»ã€‚å¦‚ä¸Šå›¾åŒå±Burstableç±»åˆ«çš„Pod Aå°†å…ˆäºPod Bè¢«æ€æ­»ï¼Œè™½ç„¶å…¶å†…å­˜ç”¨é‡å°ï¼Œä½†ä¸è‡ªèº«çš„requestså€¼ç›¸æ¯”ï¼Œå®ƒçš„å ç”¨æ¯”ä¾‹95%è¦å¤§äºPod Bçš„80%ã€‚&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>é˜¿é‡Œäº‘æ—¥å¿—æœåŠ¡é‡‡é›†k8sæ—¥å¿—å¹¶å®ç°livetailåŠŸèƒ½</title>
      <link>https://guoxudong.io/en/post/dashboard-k8s/</link>
      <pubDate>Thu, 14 Feb 2019 14:07:06 +0800</pubDate>
      
      <guid>https://guoxudong.io/en/post/dashboard-k8s/</guid>
      <description>

&lt;h1 id=&#34;å‰è¨€&#34;&gt;å‰è¨€&lt;/h1&gt;

&lt;blockquote&gt;
&lt;p&gt;ç›®å‰çš„é¡¹ç›®æ—¥å¿—éƒ½æ˜¯é€šè¿‡Logtailç›´æ¥é‡‡é›†ï¼ŒæŠ•é€’åˆ°OSSæŒä¹…åŒ–ï¼ŒåŒæ—¶å¯ä»¥é€šè¿‡é˜¿é‡Œäº‘æ—¥å¿—æœåŠ¡ã€devopsè‡ªå»ºå¹³å°è¿›è¡ŒæŸ¥çœ‹ï¼ˆè™½ç„¶å¤§éƒ¨åˆ†äººæ˜¯ç›´æ¥ç™»å½•ECSæŸ¥çœ‹=ã€‚=ï¼‰ï¼Œ
åœ¨å¼€å§‹è¿›è¡Œå®¹å™¨åŒ–ä¹‹åï¼ŒåŒæ ·é‡åˆ°æ—¥å¿—çš„é—®é¢˜ï¼Œç›®å‰çš„è§£å†³æ–¹æ¡ˆæ˜¯é˜¿é‡Œäº‘æ—¥å¿—æœåŠ¡æŒä¹…åŒ–å’Œå±•ç°æ ¼å¼åŒ–åçš„æ—¥å¿—ã€ä½¿ç”¨rancheræŸ¥çœ‹å®æ—¶æ—¥å¿—ï¼Œ
ä½†æ˜¯ä¹‹å‰ç”±äºrancherå¹³å°å‡ºç°ä¸€äº›é—®é¢˜ï¼Œå¯¼è‡´ä¸èƒ½åŠæ—¶æŸ¥çœ‹æ—¥å¿—çš„æƒ…å†µï¼Œåœ¨è¿™ä¸ªèƒŒæ™¯ä¸‹å¯¹é˜¿é‡Œäº‘æ—¥å¿—æœåŠ¡é‡‡é›†k8sæ—¥å¿—å’Œlivetailè¿›è¡Œæ­å»ºå¹¶è°ƒç ”æ­¤æ–¹æ¡ˆæ˜¯å¦å¯è¡Œã€‚&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h1 id=&#34;ç®€ä»‹-è½¬è‡ªé˜¿é‡Œäº‘å®˜æ–¹æ–‡æ¡£&#34;&gt;ç®€ä»‹ï¼ˆè½¬è‡ªé˜¿é‡Œäº‘å®˜æ–¹æ–‡æ¡£ï¼‰&lt;/h1&gt;

&lt;p&gt;æ—¥å¿—æœåŠ¡ï¼ˆLog Serviceï¼Œç®€ç§° LOGï¼‰æ˜¯é’ˆå¯¹æ—¥å¿—ç±»æ•°æ®çš„ä¸€ç«™å¼æœåŠ¡ï¼Œåœ¨é˜¿é‡Œå·´å·´é›†å›¢ç»å†å¤§é‡å¤§æ•°æ®åœºæ™¯é”¤ç‚¼è€Œæˆã€‚æ‚¨æ— éœ€å¼€å‘å°±èƒ½å¿«æ·å®Œæˆæ—¥å¿—æ•°æ®é‡‡é›†ã€æ¶ˆè´¹ã€æŠ•é€’ä»¥åŠæŸ¥è¯¢åˆ†æç­‰åŠŸèƒ½ï¼Œæå‡è¿ç»´ã€è¿è¥æ•ˆç‡ï¼Œå»ºç«‹ DT æ—¶ä»£æµ·é‡æ—¥å¿—å¤„ç†èƒ½åŠ›ã€‚&lt;/p&gt;

&lt;h1 id=&#34;kubernetesæ—¥å¿—é‡‡é›†ç»„ä»¶å®‰è£…&#34;&gt;kubernetesæ—¥å¿—é‡‡é›†ç»„ä»¶å®‰è£…&lt;/h1&gt;

&lt;h2 id=&#34;å®‰è£…logtail&#34;&gt;å®‰è£…Logtail&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;&lt;p&gt;è¿›å…¥é˜¿é‡Œäº‘å®¹å™¨æœåŠ¡æ‰¾åˆ°é›†ç¾¤id
&lt;img src=&#34;https://guoxudong.io/images/source/log_ser.png&#34; alt=&#34;image&#34; /&gt;&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;é€šè¿‡sshç™»å½•masterèŠ‚ç‚¹ï¼Œæˆ–è€…ä»»æ„å®‰è£…äº†kubectlå¹¶é…ç½®äº†è¯¥é›†ç¾¤kubeconfigçš„æœåŠ¡å™¨&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;æ‰§è¡Œå‘½ä»¤ï¼Œå°†${your_k8s_cluster_id}æ›¿æ¢ä¸ºé›†ç¾¤id&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;wget http://logtail-release-cn-hangzhou.oss-cn-hangzhou.aliyuncs.com/kubernetes/alicloud-log-k8s-install.sh -O alicloud-log-k8s-install.sh; chmod 744 ./alicloud-log-k8s-install.sh; sh ./alicloud-log-k8s-install.sh ${your_k8s_cluster_id}
&lt;/code&gt;&lt;/pre&gt;

&lt;ul&gt;
&lt;li&gt;Project k8s-log-${your_k8s_cluster_id}ä¸‹ä¼šè‡ªåŠ¨åˆ›å»ºåä¸ºconfig-operation-logçš„Logstoreï¼Œç”¨äºå­˜å‚¨alibaba-log-controllerçš„è¿è¡Œæ—¥å¿—ã€‚è¯·å‹¿åˆ é™¤æ­¤Logstoreï¼Œå¦åˆ™æ— æ³•ä¸ºalibaba-log-controlleræ’æŸ¥é—®é¢˜ã€‚&lt;/li&gt;
&lt;li&gt;è‹¥æ‚¨éœ€è¦å°†æ—¥å¿—é‡‡é›†åˆ°å·²æœ‰çš„Projectï¼Œè¯·æ‰§è¡Œå®‰è£…å‘½ä»¤sh ./alicloud-log-k8s-install.sh${your_k8s_cluster_id} ${your_project_name} ï¼Œå¹¶ç¡®ä¿æ—¥å¿—æœåŠ¡Projectå’Œæ‚¨çš„Kubernetesé›†ç¾¤åœ¨åŒä¸€åœ°åŸŸã€‚&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;è¯¥æ¡å‘½ä»¤å…¶å®å°±æ˜¯æ‰§è¡Œäº†ä¸€ä¸ªshellè„šæœ¬ï¼Œä½¿ç”¨helmå®‰è£…äº†é‡‡é›†kubernetesé›†ç¾¤æ—¥å¿—çš„ç»„ä»¶&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-vim&#34;&gt;#!/bin/bash

if [ $# -eq 0 ] ; then
    echo &amp;quot;[Invalid Param], use sudo ./install-k8s-log.sh {your-k8s-cluster-id}&amp;quot;
    exit 1
fi
    
clusterName=$(echo $1 | tr &#39;[A-Z]&#39; &#39;[a-z]&#39;)
curl --connect-timeout 5  http://100.100.100.200/latest/meta-data/region-id
    
if [ $? != 0 ]; then
    echo &amp;quot;[FAIL] ECS meta server connect fail, only support alibaba cloud k8s service&amp;quot;
    exit 1
fi
    
regionId=`curl http://100.100.100.200/latest/meta-data/region-id`
aliuid=`curl http://100.100.100.200/latest/meta-data/owner-account-id`
    
helmPackageUrl=&amp;quot;http://logtail-release-$regionId.oss-$regionId.aliyuncs.com/kubernetes/alibaba-cloud-log.tgz&amp;quot;
wget $helmPackageUrl -O alibaba-cloud-log.tgz
if [ $? != 0 ]; then
    echo &amp;quot;[FAIL] download alibaba-cloud-log.tgz from $helmPackageUrl failed&amp;quot;
    exit 1
fi
    
project=&amp;quot;k8s-log-&amp;quot;$clusterName
if [ $# -ge 2 ]; then
    project=$2
fi
    
echo [INFO] your k8s is using project : $project
    
helm install alibaba-cloud-log.tgz --name alibaba-log-controller \
    --set ProjectName=$project \
    --set RegionId=$regionId \
    --set InstallParam=$regionId \
    --set MachineGroupId=&amp;quot;k8s-group-&amp;quot;$clusterName \
    --set Endpoint=$regionId&amp;quot;-intranet.log.aliyuncs.com&amp;quot; \
    --set AlibabaCloudUserId=&amp;quot;:&amp;quot;$aliuid \
    --set LogtailImage.Repository=&amp;quot;registry.$regionId.aliyuncs.com/log-service/logtail&amp;quot; \
    --set ControllerImage.Repository=&amp;quot;registry.$regionId.aliyuncs.com/log-service/alibabacloud-log-controller&amp;quot;
    
installRst=$?
    
if [ $installRst -eq 0 ]; then
    echo &amp;quot;[SUCCESS] install helm package : alibaba-log-controller success.&amp;quot;
    exit 0
else
    echo &amp;quot;[FAIL] install helm package failed, errno &amp;quot; $installRst
    exit 0
fi
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;å‘½ä»¤æ‰§è¡Œåï¼Œä¼šåœ¨kubernetesé›†ç¾¤ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹è¿è¡Œä¸€ä¸ªæ—¥å¿—é‡‡é›†çš„podï¼šlogatail-dsï¼Œè¯¥podä½äºkube-system&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://guoxudong.io/images/source/log_detail.png&#34; alt=&#34;image&#34; /&gt;&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;å®‰è£…å®Œæˆåï¼Œå¯ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ¥æŸ¥çœ‹podçŠ¶æ€ï¼Œè‹¥çŠ¶æ€å…¨éƒ¨æˆåŠŸåï¼Œåˆ™è¡¨ç¤ºå®‰è£…å®Œæˆ&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;$ helm status alibaba-log-controller
LAST DEPLOYED: Thu Nov 22 15:09:35 2018
NAMESPACE: default
STATUS: DEPLOYED
    
RESOURCES:
==&amp;gt; v1/ServiceAccount
NAME                    SECRETS  AGE
alibaba-log-controller  1        6d
    
==&amp;gt; v1beta1/CustomResourceDefinition
NAME                                   AGE
aliyunlogconfigs.log.alibabacloud.com  6d
    
==&amp;gt; v1beta1/ClusterRole
alibaba-log-controller  6d
    
==&amp;gt; v1beta1/ClusterRoleBinding
NAME                    AGE
alibaba-log-controller  6d
    
==&amp;gt; v1beta1/DaemonSet
NAME        DESIRED  CURRENT  READY  UP-TO-DATE  AVAILABLE  NODE SELECTOR  AGE
logtail-ds  16       16       16     16          16         &amp;lt;none&amp;gt;         6d
    
==&amp;gt; v1beta1/Deployment
NAME                    DESIRED  CURRENT  UP-TO-DATE  AVAILABLE  AGE
alibaba-log-controller  1        1        1           1          6d
    
==&amp;gt; v1/Pod(related)
NAME                                     READY  STATUS   RESTARTS  AGE
logtail-ds-2fqs4                         1/1    Running  0         6d
logtail-ds-4bz7w                         1/1    Running  1         6d
logtail-ds-6vg88                         1/1    Running  0         6d
logtail-ds-7tp6v                         1/1    Running  0         6d
logtail-ds-9575c                         1/1    Running  0         6d
logtail-ds-bgq84                         1/1    Running  0         6d
logtail-ds-kdlhr                         1/1    Running  0         6d
logtail-ds-lknxw                         1/1    Running  0         6d
logtail-ds-pdxfk                         1/1    Running  0         6d
logtail-ds-pf4dz                         1/1    Running  0         6d
logtail-ds-rzsnw                         1/1    Running  0         6d
logtail-ds-sqhbv                         1/1    Running  0         6d
logtail-ds-vvtwn                         1/1    Running  0         6d
logtail-ds-wwmhg                         1/1    Running  0         6d
logtail-ds-xbp4j                         1/1    Running  0         6d
logtail-ds-zpld9                         1/1    Running  0         6d
alibaba-log-controller-85f8fbb498-nzhc8  1/1    Running  0         6d
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&#34;é…ç½®æ—¥å¿—ç»„ä»¶å±•ç¤º&#34;&gt;é…ç½®æ—¥å¿—ç»„ä»¶å±•ç¤º&lt;/h1&gt;

&lt;ul&gt;
&lt;li&gt;&lt;p&gt;åœ¨é›†ç¾¤å†…å®‰è£…å¥½æ—¥å¿—ç»„ä»¶åï¼Œç™»å½•é˜¿é‡Œäº‘æ—¥å¿—æœåŠ¡æ§åˆ¶å°ï¼Œå°±ä¼šå‘ç°æœ‰ä¸€ä¸ªæ–°çš„projectï¼Œåç§°ä¸ºk8s-log-{é›†ç¾¤id}
&lt;img src=&#34;https://guoxudong.io/images/source/log_src_de.png&#34; alt=&#34;image&#34; /&gt;&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;åˆ›å»ºLogstore
&lt;img src=&#34;https://guoxudong.io/images/source/log-1.png&#34; alt=&#34;image&#34; /&gt;&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;æ•°æ®å¯¼å…¥
&lt;img src=&#34;https://guoxudong.io/images/source/log-2.png&#34; alt=&#34;image&#34; /&gt;&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;é€‰æ‹©æ•°æ®ç±»å‹ä¸­é€‰æ‹©dockeræ ‡å‡†è¾“å‡º
&lt;img src=&#34;https://guoxudong.io/images/source/log-3.png&#34; alt=&#34;image&#34; /&gt;&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;æ•°æ®æºé…ç½®ï¼Œè¿™é‡Œå¯ä»¥ä½¿ç”¨é»˜è®¤çš„
&lt;img src=&#34;https://guoxudong.io/images/source/log-4.png&#34; alt=&#34;image&#34; /&gt;&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;é€‰æ‹©æ•°æ®æº
&lt;img src=&#34;https://guoxudong.io/images/source/log-5.png&#34; alt=&#34;image&#34; /&gt;&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;é…ç½®å¥½ä¹‹åç­‰å¾…1-2åˆ†é’Ÿï¼Œæ—¥å¿—å°±ä¼šè¿›æ¥äº†
&lt;img src=&#34;https://guoxudong.io/images/source/log-6.png&#34; alt=&#34;image&#34; /&gt;&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;ä¸ºäº†å¿«é€ŸæŸ¥è¯¢å’Œè¿‡æ»¤ï¼Œéœ€è¦é…ç½®ç´¢å¼•
&lt;img src=&#34;https://guoxudong.io/images/source/log-7.png&#34; alt=&#34;image&#34; /&gt;&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;æ·»åŠ å®¹å™¨åç§°ã€å‘½åç©ºé—´ã€podåç§°ä½œä¸ºç´¢å¼•ï¼ˆåç»­ä½¿ç”¨livetailéœ€è¦ï¼‰
&lt;img src=&#34;https://guoxudong.io/images/source/log-8.png&#34; alt=&#34;image&#34; /&gt;&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;è¿™æ ·å°±å®Œæˆäº†ä¸€ä¸ªk8sé›†ç¾¤æ—¥å¿—é‡‡é›†å’Œå±•ç¤ºçš„åŸºæœ¬æµç¨‹äº†&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&#34;livetailåŠŸèƒ½ä½¿ç”¨&#34;&gt;livetailåŠŸèƒ½ä½¿ç”¨&lt;/h1&gt;

&lt;h2 id=&#34;èƒŒæ™¯ä»‹ç»&#34;&gt;èƒŒæ™¯ä»‹ç»&lt;/h2&gt;

&lt;p&gt;åœ¨çº¿ä¸Šè¿ç»´çš„åœºæ™¯ä¸­ï¼Œå¾€å¾€éœ€è¦å¯¹æ—¥å¿—é˜Ÿåˆ—ä¸­è¿›å…¥çš„æ•°æ®è¿›è¡Œå®æ—¶ç›‘æ§ï¼Œä»æœ€æ–°çš„æ—¥å¿—æ•°æ®ä¸­æå–å‡ºå…³é”®çš„ä¿¡æ¯è¿›è€Œå¿«é€Ÿåœ°åˆ†æå‡ºå¼‚å¸¸åŸå› ã€‚åœ¨ä¼ ç»Ÿçš„è¿ç»´æ–¹å¼ä¸­ï¼Œå¦‚æœéœ€è¦å¯¹æ—¥å¿—æ–‡ä»¶è¿›è¡Œå®æ—¶ç›‘æ§ï¼Œéœ€è¦åˆ°æœåŠ¡å™¨ä¸Šå¯¹æ—¥å¿—æ–‡ä»¶æ‰§è¡Œå‘½ä»¤tail -fï¼Œå¦‚æœå®æ—¶ç›‘æ§çš„æ—¥å¿—ä¿¡æ¯ä¸å¤Ÿç›´è§‚ï¼Œå¯ä»¥åŠ ä¸Šgrepæˆ–è€…grep -vè¿›è¡Œå…³é”®è¯è¿‡æ»¤ã€‚æ—¥å¿—æœåŠ¡åœ¨æ§åˆ¶å°æä¾›äº†æ—¥å¿—æ•°æ®å®æ—¶ç›‘æ§çš„äº¤äº’åŠŸèƒ½LiveTailï¼Œé’ˆå¯¹çº¿ä¸Šæ—¥å¿—è¿›è¡Œå®æ—¶ç›‘æ§åˆ†æï¼Œå‡è½»è¿ç»´å‹åŠ›ã€‚&lt;/p&gt;

&lt;h2 id=&#34;ä½¿ç”¨æ–¹æ³•&#34;&gt;ä½¿ç”¨æ–¹æ³•&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;&lt;p&gt;è¿™é‡Œé€‰æ‹©æ¥æºç±»å‹ä¸ºkubernetesï¼Œå‘½åç©ºé—´ã€podåç§°ã€å®¹å™¨åç§°ä¸ºä¸Šä¸€æ­¥æ–°å»ºçš„3ä¸ªç´¢å¼•çš„å†…å®¹ï¼Œè¿‡æ»¤å…³é”®å­—çš„åŠŸåŠ³ä¸tailå‘½ä»¤ååŠ çš„grepå‘½ä»¤æ˜¯ä¸€æ ·çš„ï¼Œç”¨äºå…³é”®è¯è¿‡æ»¤
&lt;img src=&#34;https://guoxudong.io/images/source/log-9.png&#34; alt=&#34;image&#34; /&gt;&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;ç‚¹å‡»å¼€å¯livetailï¼Œè¿™æ—¶å°±æœ‰å®æ—¶æ—¥å¿—å±•ç¤ºå‡ºæ¥äº†
&lt;img src=&#34;https://guoxudong.io/images/source/log-10.png&#34; alt=&#34;image&#34; /&gt;&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;strong&gt;ä»¥ä¸Šå°±æ˜¯é˜¿é‡Œäº‘livetailæ—¥å¿—æœåŠ¡åŠŸèƒ½&lt;/strong&gt;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>kubernetesä¸­podåŒæ­¥æ—¶åŒºé—®é¢˜</title>
      <link>https://guoxudong.io/en/post/pod-timezone/</link>
      <pubDate>Wed, 30 Jan 2019 20:18:13 +0800</pubDate>
      
      <guid>https://guoxudong.io/en/post/pod-timezone/</guid>
      <description>

&lt;blockquote&gt;
&lt;p&gt;æ–°ç‰ˆç›‘æ§å¤§å±äº18å¹´æœ€åä¸€å¤©æ­£å¼ä¸Šçº¿ï¼Œä¹‹åé™†ç»­è¿›è¡Œäº†å‡ æ¬¡ä¼˜åŒ–å’Œä¿®æ”¹ï¼Œæœ€è¿‘å‘ç°ä¸€ä¸ªæ¯”è¾ƒå¤§çš„bugï¼Œå°±æ˜¯ç›‘æ§æ˜¾ç¤ºçš„æ—¶é—´è½´ä¸å¯¹ï¼Œæ˜¾ç¤ºçš„å°±æ˜¯å’Œç›®å‰çš„æ—¶é—´ç›¸å·®8å°æ—¶ï¼Œè¿™å°±å¼•å‡ºäº†dockerä¸­çš„æ—¶åŒºé—®é¢˜&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h1 id=&#34;é—®é¢˜çš„åŸå› &#34;&gt;é—®é¢˜çš„åŸå› &lt;/h1&gt;

&lt;p&gt;é»˜è®¤çš„æƒ…å†µï¼Œåœ¨K8Sé‡Œå¯åŠ¨ä¸€ä¸ªå®¹å™¨ï¼Œè¯¥å®¹å™¨çš„è®¾ç½®çš„æ—¶åŒºæ˜¯UTC0ï¼Œä½†æ˜¯å¯¹ç”¨æˆ·è€Œè¨€ï¼Œä¸»æœºç¯å¢ƒå¹¶ä¸åœ¨UTC0ã€‚æˆ‘ä»¬åœ¨UTC8ã€‚å¦‚æœä¸æŠŠå®¹å™¨çš„æ—¶åŒºå’Œä¸»æœºä¸»æœºè®¾ç½®ä¸ºä¸€è‡´ï¼Œåˆ™åœ¨æŸ¥æ‰¾æ—¥å¿—ç­‰æ—¶å€™å°†éå¸¸ä¸æ–¹ä¾¿ï¼Œä¹Ÿå®¹æ˜“é€ æˆè¯¯è§£ã€‚ä½†æ˜¯K8Sä»¥åŠDockerå®¹å™¨æ²¡æœ‰ä¸€ä¸ªç®€ä¾¿çš„è®¾ç½®/å¼€å…³åœ¨ç³»ç»Ÿå±‚é¢åšé…ç½®ã€‚éƒ½éœ€è¦æˆ‘ä»¬ä»å•ä¸ªå®¹å™¨å…¥æ‰‹åšè®¾ç½®ï¼Œå…·ä½“æœ‰ä¸¤ä¸ªæ–¹æ³•ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;ç›´æ¥ä¿®æ”¹é•œåƒçš„æ—¶é—´è®¾ç½®ï¼Œå¥½å¤„æ˜¯åº”ç”¨éƒ¨ç½²æ—¶æ— éœ€åšç‰¹æ®Šè®¾ç½®ï¼Œä½†æ˜¯éœ€è¦æ‰‹åŠ¨æ„å»ºDockeré•œåƒã€‚&lt;/li&gt;
&lt;li&gt;éƒ¨ç½²åº”ç”¨æ—¶ï¼Œå•ç‹¬è¯»å–ä¸»æœºçš„â€œ/etc/localtimeâ€æ–‡ä»¶ï¼Œå³åˆ›å»ºpodæ—¶åŒæ­¥æ—¶åŒºï¼Œæ— éœ€ä¿®æ”¹é•œåƒï¼Œä½†æ˜¯æ¯ä¸ªåº”ç”¨éƒ½è¦å•ç‹¬è®¾ç½®ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&#34;é—®é¢˜çš„è§£å†³&#34;&gt;é—®é¢˜çš„è§£å†³&lt;/h1&gt;

&lt;p&gt;è¿™é‡Œæˆ‘ä»¬é€‰æ‹©ç¬¬äºŒç§æ–¹æ³•ï¼Œå³ä¿®æ”¹éƒ¨ç½²åº”ç”¨çš„yamlæ–‡ä»¶ï¼Œåˆ›å»ºpodæ—¶åŒæ­¥æ—¶åŒº&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-yaml&#34;&gt;apiVersion: extensions/v1beta1
kind: Deployment
metadata:
    name: myweb
spec:
    replicas: 2
    template:
        metadata:
        labels:
            app: myweb
        spec:
        containers:
        - name: myweb
            image: nginx:apline
            ports:
            - containerPort: 80
        #æŒ‚è½½åˆ°podä¸­
            volumeMounts:
            - name: host-time
            mountPath: /etc/localtime    
        #éœ€è¦è¢«æŒ‚è½½çš„å®¿ä¸»æœºçš„æ—¶åŒºæ–‡ä»¶
        volumes:
        - name: host-time
            hostPath:
            path: /etc/localtime
&lt;/code&gt;&lt;/pre&gt;

&lt;h1 id=&#34;æ•ˆæœå¯¹æ¯”&#34;&gt;æ•ˆæœå¯¹æ¯”&lt;/h1&gt;

&lt;h2 id=&#34;ä¿®æ”¹æ—¶åŒºå‰&#34;&gt;ä¿®æ”¹æ—¶åŒºå‰&lt;/h2&gt;

&lt;p&gt;&lt;img src=&#34;https://guoxudong.io/images/source/time-1.png&#34; alt=&#34;image&#34; /&gt;&lt;/p&gt;

&lt;h2 id=&#34;ä¿®æ”¹æ—¶åŒºå&#34;&gt;ä¿®æ”¹æ—¶åŒºå&lt;/h2&gt;

&lt;p&gt;&lt;img src=&#34;https://guoxudong.io/images/source/time-2.png&#34; alt=&#34;image&#34; /&gt;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>ä¸ºingressé…ç½®SSLè¯ä¹¦ï¼Œå®ç°HTTPSè®¿é—®</title>
      <link>https://guoxudong.io/en/post/https-ingress/</link>
      <pubDate>Sat, 29 Dec 2018 21:28:13 +0800</pubDate>
      
      <guid>https://guoxudong.io/en/post/https-ingress/</guid>
      <description>

&lt;blockquote&gt;
&lt;p&gt;devopså¹³å°ç‡å…ˆåœ¨å…¬å¸å†…ä½¿ç”¨kubernetesé›†ç¾¤æä¾›åç«¯æœåŠ¡ï¼Œä½†æ˜¯ç”±äºä¹‹å‰ä¸€ç›´å¤„äºæ¢ç´¢é˜¶æ®µï¼Œæ‰€ä»¥ä½¿ç”¨çš„äº‹httpçš„æ–¹å¼æä¾›åç«¯æœåŠ¡ï¼Œä½†æ˜¯åœ¨å¼€å‘ç»Ÿä¸€å…¥å£åï¼Œå‡ºç°äº†è®¿é—®HTTPSé¡µé¢çš„è·¨åŸŸé—®é¢˜ï¼Œç”±æ­¤å¼•å‡ºäº†åç«¯æœåŠ¡é…ç½®SSLè¯ä¹¦çš„é—®é¢˜&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h1 id=&#34;ä½¿ç”¨rancheré…ç½®sslè¯ä¹¦&#34;&gt;ä½¿ç”¨rancheré…ç½®SSLè¯ä¹¦&lt;/h1&gt;

&lt;h2 id=&#34;ä¸‹è½½sslè¯ä¹¦æ–‡ä»¶&#34;&gt;ä¸‹è½½SSLè¯ä¹¦æ–‡ä»¶&lt;/h2&gt;

&lt;p&gt;é¦–å…ˆéœ€è¦è·å¾—SSLè¯ä¹¦æ–‡ä»¶ï¼Œå¯ä»¥ç›´æ¥åœ¨é˜¿é‡Œäº‘SSLè¯ä¹¦ç®¡ç†æ§åˆ¶å°ä¸‹è½½&lt;/p&gt;

&lt;p&gt;é€‰ä¸­éœ€è¦ä¸‹è½½è¯ä¹¦ï¼Œé€‰æ‹©ä¸‹è½½nginxè¯ä¹¦
&lt;img src=&#34;https://guoxudong.io/images/source/zhengshu.png&#34; alt=&#34;image&#34; /&gt;&lt;/p&gt;

&lt;h2 id=&#34;å°†è¯ä¹¦ä¸Šä¼ é¡¹ç›®&#34;&gt;å°†è¯ä¹¦ä¸Šä¼ é¡¹ç›®&lt;/h2&gt;

&lt;p&gt;æ‰“å¼€rancherï¼Œé€‰æ‹©è¦ä½¿ç”¨è¯ä¹¦çš„é¡¹ç›®ï¼Œç‚¹å‡»èµ„æºä¸­çš„è¯ä¹¦&lt;/p&gt;

&lt;h2 id=&#34;å°†è¯ä¹¦ä¸Šä¼ é¡¹ç›®-1&#34;&gt;å°†è¯ä¹¦ä¸Šä¼ é¡¹ç›®&lt;/h2&gt;

&lt;p&gt;æ‰“å¼€rancherï¼Œé€‰æ‹©è¦ä½¿ç”¨è¯ä¹¦çš„é¡¹ç›®ï¼Œç‚¹å‡»èµ„æºä¸­çš„è¯ä¹¦
&lt;img src=&#34;https://guoxudong.io/images/source/https-1.png&#34; alt=&#34;image&#34; /&gt;
æ·»åŠ è¯ä¹¦ï¼Œç‚¹å‡»ä»æ–‡ä»¶ä¸Šä¼ 
&lt;img src=&#34;https://guoxudong.io/images/source/https-2.png&#34; alt=&#34;image&#34; /&gt;
ä¸Šä¼ è¯ä¹¦æ–‡ä»¶ä¸­çš„ç§˜é’¥å’Œè¯ä¹¦ï¼Œç‚¹å‡»ä¿å­˜å³å¯&lt;/p&gt;

&lt;h1 id=&#34;ä½¿ç”¨yamlä¸Šä¼ è¯ä¹¦&#34;&gt;ä½¿ç”¨yamlä¸Šä¼ è¯ä¹¦&lt;/h1&gt;

&lt;p&gt;è¿™ä¸ªè¯ä¹¦çš„åŸç†å…¶å®æ˜¯åœ¨ç›¸åº”çš„å‘½åç©ºé—´åˆ›å»ºäº†ä¸€ä¸ªåŒ…å«è¯ä¹¦ä¿¡æ¯çš„secrets&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-yaml&#34;&gt;apiVersion: v1
data:
    tls.crt: {ç§é’¥}
    tls.key: {è¯ä¹¦}
kind: Secret
metadata:
    name: keking-cn
    namespace: devops-plat
type: kubernetes.io/tls
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;åœ¨kubernetesä¸Šè¿è¡Œè¯¥yamlå³å¯&lt;/p&gt;

&lt;h1 id=&#34;rancherä¸­è¯ä¹¦ç»‘å®š&#34;&gt;rancherä¸­è¯ä¹¦ç»‘å®š&lt;/h1&gt;

&lt;p&gt;é€‰ä¸­éœ€è¦ç»‘å®šè¯ä¹¦çš„ingressï¼Œç‚¹å‡»ç¼–è¾‘ï¼Œé€‰ä¸­è¯ä¹¦ï¼Œä¿å­˜å³å¯ï¼ˆç”±äºingress-controllerä¸­æ²¡æœ‰ç»‘å®šé»˜è®¤è¯ä¹¦ï¼Œæ‰€ä»¥è¿™é‡Œä¸èƒ½é€‰ä¸­é»˜è®¤ï¼‰
&lt;img src=&#34;https://guoxudong.io/images/source/https-3.png&#34; alt=&#34;image&#34; /&gt;
ä¿å­˜å®Œæ¯•ï¼Œè¯ä¹¦å³å¯ç”Ÿæ•ˆ&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Kubernetesåˆ é™¤ä¸€ç›´å¤„äºTerminatingçŠ¶æ€çš„namespace</title>
      <link>https://guoxudong.io/en/post/k8s-d-n/</link>
      <pubDate>Fri, 16 Nov 2018 18:18:13 +0800</pubDate>
      
      <guid>https://guoxudong.io/en/post/k8s-d-n/</guid>
      <description>

&lt;blockquote&gt;
&lt;p&gt;è¿‘æœŸç”±äºå…¬å¸éœ€è¦å°†éƒ¨ç½²åœ¨ucloudä¸Šçš„rancherè¿ç§»åˆ°é˜¿é‡Œäº‘ä¸Šï¼Œæ‰€ä»¥éœ€è¦å°†åŸæœ‰Rancherä¾èµ–çš„namespaceï¼ˆcattle-systemï¼‰åˆ é™¤ï¼Œä½†åœ¨åˆ é™¤ä¸­å‡ºç°äº†åˆ é™¤çš„namespaceä¸€ç›´å¤„äºTerminatingçŠ¶æ€çš„æƒ…å†µ&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;&lt;img src=&#34;https://guoxudong.io/images/source/d-n-1.png&#34; alt=&#34;imgage&#34; /&gt;&lt;/p&gt;

&lt;h1 id=&#34;è§£å†³æ–¹æ¡ˆ&#34;&gt;è§£å†³æ–¹æ¡ˆ&lt;/h1&gt;

&lt;p&gt;è¿è¡Œå‘½ä»¤ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;kubectl edit namespaces cattle-system
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;å¯ä»¥çœ‹åˆ°namespacesçš„yamlé…ç½®ï¼š&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://guoxudong.io/images/source/d-n-2.png&#34; alt=&#34;imgage&#34; /&gt;&lt;/p&gt;

&lt;p&gt;å°†finalizerçš„valueåˆ é™¤ï¼Œè¿™é‡Œå°†å…¶è®¾ç½®ä¸º[]&lt;/p&gt;

&lt;p&gt;ä¿å­˜å³å¯çœ‹åˆ°è¯¥namespaceå·²è¢«åˆ é™¤&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;https://guoxudong.io/images/source/d-n-3.png&#34; alt=&#34;imgage&#34; /&gt;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>kubernetesé›†ç¾¤æ¦‚è¿°</title>
      <link>https://guoxudong.io/en/post/k8s-topo/</link>
      <pubDate>Wed, 03 Oct 2018 12:18:13 +0800</pubDate>
      
      <guid>https://guoxudong.io/en/post/k8s-topo/</guid>
      <description>

&lt;blockquote&gt;
&lt;p&gt;éšç€2017å¹´AWSï¼ŒAzureå’Œé˜¿é‡Œäº‘ç›¸ç»§åœ¨å…¶åŸæœ‰å®¹å™¨æœåŠ¡ä¸Šæ–°å¢äº†å¯¹kubernetesçš„æ”¯æŒï¼Œè€ŒDockerå®˜ç½‘ä¹Ÿåœ¨åŒå¹´10æœˆå®£å¸ƒåŒæ—¶æ”¯æŒSwarmå¥½kuberneteså®¹å™¨ç¼–æ’ç³»ç»Ÿã€‚kubernetesä¿¨ç„¶å·²æˆä¸ºå®¹å™¨ç¼–æ’é¢†åŸŸäº‹å®ä¸Šçš„æ ‡å‡†ï¼Œè€Œ2018å¹´æ›´æ˜¯å„å¤§å…¬å¸ç›¸ç»§å°†æœåŠ¡è¿ç§»åˆ°kubernetesä¸Šï¼Œè€Œkubernetesåˆ™ä»¥æƒŠäººæ›´æ–°é€Ÿåº¦ï¼Œä¿æŒç€æ¯ä¸ªå­£åº¦å‘å¸ƒä¸€ä¸ªå¤§ç‰ˆæœ¬çš„é€Ÿåº¦é«˜é€Ÿå‘å±•ç€ã€‚&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h1 id=&#34;kubernetesç‰¹å¾&#34;&gt;kubernetesç‰¹å¾&lt;/h1&gt;

&lt;p&gt;kubernetesæ˜¯ä¸€ç§åœ¨ä¸€ç»„ä¸»æœºä¸Šè¿è¡Œå’ŒååŒå®¹å™¨åŒ–åº”ç”¨ç¨‹åºçš„ç³»ç»Ÿï¼Œæ—¨åœ¨æä¾›å¯é¢„æµ‹æ€§ã€å¯æ‹“å±•æ€§ä¸é«˜å¯ç”¨æ€§çš„æ–¹æ³•æ¥å®Œå…¨ç®¡ç†å®¹å™¨åŒ–åº”ç”¨å’ŒæœåŠ¡çš„ç”Ÿå‘½å‘¨æœŸå¹³å°ã€‚ç”¨æˆ·å¯ä»¥å®šä¹‰åº”ç”¨ç¨‹åºçš„è¿è¡Œæ–¹å¼ï¼Œä»¥åŠä¸å…¶ä»–åº”ç”¨ç¨‹åºæˆ–å¤–éƒ¨ä¸–ç•Œäº¤äº’çš„é€”å¾„ï¼Œå¹¶èƒ½å®ç°æœåŠ¡çš„æ‰©å®¹å’Œç¼©å®¹ï¼Œæ‰§è¡Œå¹³æ»‘æ»šåŠ¨æ›´æ–°ï¼Œä»¥åŠåœ¨ä¸åŒç‰ˆæœ¬çš„åº”ç”¨ç¨‹åºä¹‹é—´è°ƒåº¦æµé‡ä»¥æµ‹è¯•åŠŸèƒ½æˆ–å›æ»šæœ‰é—®é¢˜çš„éƒ¨ç½²ã€‚kubernetesæä¾›äº†æ¥å£å’Œå¯ç»„åˆå¸†è½¯å¹³å°åŸè¯­ï¼Œä½¿å¾—ç”¨æˆ·èƒ½å¤Ÿä»¥é«˜åº¦çš„çµæ´»æ€§å’Œå¯é æ€§å®šä¹‰åŠç®¡ç†åº”ç”¨ç¨‹åºã€‚&lt;/p&gt;

&lt;h1 id=&#34;kubernetesç»„ä»¶åŠç½‘ç»œé€šä¿¡&#34;&gt;kubernetesç»„ä»¶åŠç½‘ç»œé€šä¿¡&lt;/h1&gt;

&lt;p&gt;kubernetesé›†ç¾¤çš„å®¢æˆ·ç«¯å¯ä»¥åˆ†ä¸ºä¸¤ç±»ï¼šAPI Serverå®¢æˆ·ç«¯å’Œåº”ç”¨ç¨‹åºï¼ˆè¿è¡Œä¸ºPodä¸­çš„å®¹å™¨ï¼‰å®¢æˆ·ç«¯ã€‚
&lt;img src=&#34;https://guoxudong.io/images/source/kubernetes-topo.png&#34; alt=&#34;image&#34; /&gt;&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;ç¬¬ä¸€ç±»å®¢æˆ·ç«¯é€šå¸¸åŒ…å«ç”¨æˆ·å’ŒPodå¯¹è±¡ä¸¤ç§ï¼Œå®ƒä»¬é€šè¿‡API Serverè®¿é—®kubernetesé›†ç¾¤å®Œæˆç®¡ç†ä»»åŠ¡ï¼Œä¾‹å¦‚ï¼Œç®¡ç†é›†ç¾¤ä¸Šçš„å„ç§èµ„æºå¯¹è±¡ã€‚&lt;/li&gt;

&lt;li&gt;&lt;p&gt;ç¬¬äºŒç±»å®¢æˆ·ç«¯ä¸€èˆ¬ä¹ŸåŒ…å«äººç±»ç”¨æˆ·å’ŒPodå¯¹è±¡ä¸¤ç§ï¼Œå®ƒä»¬çš„è®¿é—®ç›®æ ‡æ˜¯Podä¸Šè¿è¡Œäºå®¹å™¨ä¸­çš„åº”ç”¨ç¨‹åºæä¾›çš„å„ç§å…·ä½“çš„æœåŠ¡ï¼Œå¦‚redisæˆ–nginxç­‰ï¼Œä¸è¿‡ï¼Œè¿™äº›è®¿é—®è¯·æ±‚é€šå¸¸è¦ç»ç”±Serviceæˆ–Ingressèµ„æºå¯¹è±¡è¿›è¡Œã€‚å¦å¤–ï¼Œç¬¬äºŒç±»å®¢æˆ·ç«¯çš„è®¿é—®ç›®æ ‡å¯¹è±¡çš„æ“ä½œè¦ç»ç”±ç¬¬ä¸€ç±»å®¢æˆ·ç«¯åˆ›å»ºå’Œé…ç½®å®Œæˆåæ‰è¿›è¡Œã€‚&lt;/p&gt;

&lt;p&gt;è®¿é—®API Serveræ—¶ï¼Œäººç±»ç”¨æˆ·ä¸€èˆ¬å€ŸåŠ©äºå‘½ä»¤è¡Œå·¥å…·kubectlæˆ–å›¾å½¢UIï¼ˆä¾‹å¦‚kubernetes dashboardï¼‰è¿›è¡Œï¼Œä¹Ÿé€šè¿‡ç¼–ç¨‹æ¥å£è¿›è¡Œè®¿é—®ï¼ŒåŒ…æ‹¬REST APIã€‚è®¿é—®Podä¸­çš„åº”ç”¨æ—¶ï¼Œå…¶è®¿é—®æ–¹å¼è¦å–å†³äºPodä¸­çš„åº”ç”¨ç¨‹åºï¼Œä¾‹å¦‚ï¼Œå¯¹äºè¿è¡ŒNginxå®¹å™¨çš„Podæ¥è¯´ï¼Œå…¶æœ€å¸¸ç”¨å·¥å…·å°±æ˜¯æµè§ˆå™¨ã€‚&lt;/p&gt;

&lt;p&gt;ç®¡ç†å‘˜ï¼ˆå¼€å‘äººå‘˜æˆ–è¿ç»´äººå‘˜ï¼‰ä½¿ç”¨kubernetesé›†ç¾¤çš„å¸¸è§æ“ä½œåŒ…æ‹¬é€šè¿‡æ§åˆ¶å™¨åˆ›å»ºPodï¼Œåœ¨Podçš„åŸºç¡€ä¸Šåˆ›å»ºServiceä¾›ç¬¬äºŒç±»å®¢æˆ·ç«¯è®¿é—®ï¼Œæ›´æ–°Podä¸­çš„åº”ç”¨ç‰ˆæœ¬ï¼ˆæ›´æ–°å’Œå›æ»šï¼‰ä»¥åŠå¯¹åº”ç”¨è§„æ¨¡è¿›è¡Œæ‰©å®¹æˆ–ç¼©å®¹ç­‰ï¼Œå¦å¤–è¿˜æœ‰é›†ç¾¤é™„ä»¶ç®¡ç†ã€å­˜å‚¨å·ç®¡ç†ã€ç½‘ç»œåŠç½‘ç»œç­–ç•¥ç®¡ç†ã€èµ„æºç®¡ç†å’Œå®‰å…¨ç®¡ç†ç­‰ã€‚&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>centos7.2 å®‰è£…k8s v1.11.0</title>
      <link>https://guoxudong.io/en/post/install-k8s/</link>
      <pubDate>Tue, 14 Aug 2018 20:07:03 +0800</pubDate>
      
      <guid>https://guoxudong.io/en/post/install-k8s/</guid>
      <description>

&lt;h1 id=&#34;å‰è¨€&#34;&gt;å‰è¨€&lt;/h1&gt;

&lt;blockquote&gt;
&lt;p&gt;æœ€è¿‘ç”±äºå…¬å¸ä¸šåŠ¡å‘å±•åˆ°äº†ç“¶é¢ˆï¼ŒåŸæœ‰çš„æŠ€æœ¯æ¶æ„å·²ç»é€æ¸æ— æ³•æ»¡è¶³ä¸šåŠ¡å¼€å‘å’Œæµ‹è¯•çš„éœ€æ±‚ï¼Œå‡ºç°äº†åº”ç”¨æµ‹è¯•ç¯å¢ƒæ­å»ºå¤æ‚ï¼Œæœ‰è®¸å¤šå¥—ï¼ˆçœŸçš„å¾ˆå¤šå¾ˆå¤šï¼‰åº”ç”¨ç¯å¢ƒï¼Œåº”ç”¨åœ¨æŒç»­é›†æˆ/æŒç»­äº¤ä»˜ä¹Ÿé‡åˆ°äº†å¾ˆå¤§çš„å›°éš¾ï¼Œç»è¿‡è®¨è®ºç ”ç©¶å†³å®šå¯¹åº”ç”¨å’Œå¾®æœåŠ¡è¿›è¡Œå®¹å™¨åŒ–ï¼Œè¿™å°±æ˜¯æˆ‘é¦–æ¬¡ç›´é¢dockerå’Œk8sçš„å¥‘æœº.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h1 id=&#34;kubernetes-ä»‹ç»&#34;&gt;Kubernetes ä»‹ç»&lt;/h1&gt;

&lt;p&gt;Kubernetes æ˜¯ Google å›¢é˜Ÿå‘èµ·çš„å¼€æºé¡¹ç›®ï¼Œå®ƒçš„ç›®æ ‡æ˜¯ç®¡ç†è·¨å¤šä¸ªä¸»æœºçš„å®¹å™¨ï¼Œæä¾›åŸºæœ¬çš„éƒ¨ç½²ï¼Œç»´æŠ¤ä»¥åŠè¿ç”¨ä¼¸ç¼©ï¼Œä¸»è¦å®ç°è¯­è¨€ä¸º
Go è¯­è¨€ã€‚
Kubernetesçš„ç‰¹ç‚¹ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;æ˜“å­¦ï¼šè½»é‡çº§ï¼Œç®€å•ï¼Œå®¹æ˜“ç†è§£&lt;/li&gt;
&lt;li&gt;ä¾¿æºï¼šæ”¯æŒå…¬æœ‰äº‘ï¼Œç§æœ‰äº‘ï¼Œæ··åˆäº‘ï¼Œä»¥åŠå¤šç§äº‘å¹³å°&lt;/li&gt;
&lt;li&gt;å¯æ‹“å±•ï¼šæ¨¡å—åŒ–ï¼Œå¯æ’æ‹”ï¼Œæ”¯æŒé’©å­ï¼Œå¯ä»»æ„ç»„åˆ&lt;/li&gt;
&lt;li&gt;è‡ªä¿®å¤ï¼šè‡ªåŠ¨é‡è°ƒåº¦ï¼Œè‡ªåŠ¨é‡å¯ï¼Œè‡ªåŠ¨å¤åˆ¶&lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&#34;å‡†å¤‡å·¥ä½œ&#34;&gt;å‡†å¤‡å·¥ä½œ&lt;/h1&gt;

&lt;p&gt;&lt;strong&gt;æ³¨ï¼šä»¥ä¸‹æ“ä½œéƒ½æ˜¯åœ¨rootæƒé™ä¸‹æ‰§è¡Œçš„&lt;/strong&gt;&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;å®‰è£…docker-ceï¼Œè¿™é‡Œä½¿ç”¨docker-ce-17.09.0.cç‰ˆæœ¬ï¼Œå®‰è£…æ–¹æ³•è§&lt;a href=&#34;https://guoxudong.io/2018/install-docker&#34;&gt;ä¹‹å‰çš„æ•™ç¨‹&lt;/a&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;å®‰è£…Kubeadm&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;#å®‰è£… Kubeadm é¦–å…ˆæˆ‘ä»¬è¦é…ç½®å¥½é˜¿é‡Œäº‘çš„å›½å†…æºï¼Œæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š
cat &amp;lt;&amp;lt;EOF &amp;gt; /etc/yum.repos.d/kubernetes.repo
[kubernetes]
name=Kubernetes
baseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64
enabled=1
gpgcheck=0
EOF

#ä¹‹åï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤æ¥é‡å»ºyumç¼“å­˜ï¼š
yum -y install epel-releaseyum
clean all
yum makecache
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;æ¥ä¸‹æ¥éœ€è¦å®‰è£…æŒ‡å®šç‰ˆæœ¬çš„Kubeadmï¼ˆè¿™é‡Œè¦å®‰è£…æŒ‡å®šç‰ˆæœ¬ï¼Œå› ä¸ºåç»­ä¾èµ–çš„é•œåƒç”±äºæœ‰å¢™æ— æ³•æ‹‰å–ï¼Œè¿™é‡Œæˆ‘ä»¬åªæœ‰æŒ‡å®šç‰ˆæœ¬çš„é•œåƒï¼‰ï¼Œæ³¨æ„ï¼š&lt;strong&gt;è¿™é‡Œæ˜¯å®‰è£…æŒ‡å®šç‰ˆæœ¬çš„Kubeadmï¼Œk8sçš„ç‰ˆæœ¬æ›´æ–°ä¹‹å¿«å®Œå…¨è¶…å‡ºä½ çš„æƒ³è±¡ï¼&lt;/strong&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;yum -y install kubelet-1.11.0-0
yum -y install kubeadm-1.11.0-0
yum -y install kubectl-1.11.0-0
yum -y install kubernetes-cni
    
#æ‰§è¡Œå‘½ä»¤å¯åŠ¨KubeadmæœåŠ¡ï¼š
systemctl enable kubelet &amp;amp;&amp;amp; systemctl start kubelet
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;é…ç½® Kubeadm æ‰€ç”¨åˆ°çš„é•œåƒ
è¿™é‡Œæ˜¯é‡ä¸­ä¹‹é‡ï¼Œå› ä¸ºåœ¨å›½å†…çš„åŸå› ï¼Œæ— æ³•è®¿é—®åˆ° Google çš„é•œåƒåº“ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦æ‰§è¡Œä»¥ä¸‹è„šæœ¬æ¥ä» Docker Hub ä»“åº“ä¸­è·å–ç›¸åŒçš„é•œåƒï¼Œå¹¶ä¸”æ›´æ”¹ TAG è®©å…¶å˜æˆä¸ Google æ‹‰å»é•œåƒä¸€è‡´ã€‚&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;æ–°å»ºä¸€ä¸ª Shell è„šæœ¬ï¼Œå¡«å…¥ä»¥ä¸‹ä»£ç ä¹‹åä¿å­˜&lt;/strong&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-vim&#34;&gt;#docker.sh
#!/bin/bash
images=(kube-proxy-amd64:v1.11.0 kube-scheduler-amd64:v1.11.0 kube-controller-manager-amd64:v1.11.0 kube-apiserver-amd64:v1.11.0 etcd-amd64:3.2.18 coredns:1.1.3 pause-amd64:3.1 kubernetes-dashboard-amd64:v1.8.3 k8s-dns-sidecar-amd64:1.14.9 k8s-dns-kube-dns-amd64:1.14.9 k8s-dns-dnsmasq-nanny-amd64:1.14.9 )
for imageName in ${images[@]} ; do
docker pull keveon/$imageName
docker tag keveon/$imageName k8s.gcr.io/$imageName
docker rmi keveon/$imageName
done
# ä¸ªäººæ–°åŠ çš„ä¸€å¥ï¼ŒV 1.11.0 å¿…åŠ 
docker tag da86e6ba6ca1 k8s.gcr.io/pause:3.1
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;strong&gt;ä¿å­˜åä½¿ç”¨chmodå‘½ä»¤èµ‹äºˆè„šæœ¬æ‰§è¡Œæƒé™&lt;/strong&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;chmod -R 777 ./docker.sh
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;strong&gt;æ‰§è¡Œè„šæœ¬æ‹‰å–é•œåƒ&lt;/strong&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;sh docker.sh
#è¿™é‡Œå°±å¼€å§‹äº†æ¼«é•¿çš„æ‹‰å–é•œåƒä¹‹è·¯
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;strong&gt;å…³é—­æ‰swap&lt;/strong&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;sudo swapoff -a
#è¦æ°¸ä¹…ç¦æ‰swapåˆ†åŒºï¼Œæ‰“å¼€å¦‚ä¸‹æ–‡ä»¶æ³¨é‡Šæ‰swapé‚£ä¸€è¡Œ
# sudo vi /etc/stab
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;strong&gt;å…³é—­SELinuxçš„&lt;/strong&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;# ä¸´æ—¶ç¦ç”¨selinux
# æ°¸ä¹…å…³é—­ ä¿®æ”¹/etc/sysconfig/selinuxæ–‡ä»¶è®¾ç½®
sed -i &#39;s/SELINUX=permissive/SELINUX=disabled/&#39; /etc/sysconfig/selinux
# è¿™é‡ŒæŒ‰å›è½¦ï¼Œä¸‹é¢æ˜¯ç¬¬äºŒæ¡å‘½ä»¤
setenforce 0
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;strong&gt;å…³é—­é˜²ç«å¢™&lt;/strong&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;systemctl disable firewalld.service &amp;amp;&amp;amp; systemctl stop firewalld.service
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;strong&gt;é…ç½®è½¬å‘å‚æ•°&lt;/strong&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;# é…ç½®è½¬å‘ç›¸å…³å‚æ•°ï¼Œå¦åˆ™å¯èƒ½ä¼šå‡ºé”™
cat &amp;lt;&amp;lt;EOF &amp;gt; /etc/sysctl.d/k8s.conf
net.bridge.bridge-nf-call-ip6tables = 1
net.bridge.bridge-nf-call-iptables = 1
vm.swappiness=0
EOF
# è¿™é‡ŒæŒ‰å›è½¦ï¼Œä¸‹é¢æ˜¯ç¬¬äºŒæ¡å‘½ä»¤
sysctl --system
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;strong&gt;è¿™é‡Œå°±å®Œæˆäº†k8sé›†ç¾¤æ­å»ºçš„å‡†å¤‡å·¥ä½œï¼Œé›†ç¾¤æ­å»ºçš„è¯ä»¥ä¸Šæ“ä½œç»“æŸåå°†æ“ä½œå®Œçš„ç³»ç»Ÿåˆ¶ä½œæˆç³»ç»Ÿé•œåƒï¼Œæ–¹ä¾¿é›†ç¾¤æ­å»º&lt;/strong&gt;&lt;/p&gt;&lt;/li&gt;
&lt;/ol&gt;

&lt;h1 id=&#34;æ­£å¼å®‰è£…&#34;&gt;æ­£å¼å®‰è£…&lt;/h1&gt;

&lt;p&gt;&lt;strong&gt;ä»¥ä¸‹çš„æ“ä½œéƒ½åªåœ¨ä¸»èŠ‚ç‚¹ä¸Šè¿›è¡Œï¼š&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;åˆå§‹åŒ–é•œåƒ&lt;/strong&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;kubeadm init --kubernetes-version=v1.11.0 --pod-network-cidr=10.10.0.0/16  #è¿™é‡Œå¡«å†™é›†ç¾¤æ‰€åœ¨ç½‘æ®µ
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;strong&gt;ä¹‹åçš„è¾“å‡ºä¼šæ˜¯è¿™æ ·ï¼š&lt;/strong&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-go&#34;&gt;I0712 10:46:30.938979   13461 feature_gate.go:230] feature gates: &amp;amp;{map[]}
[init] using Kubernetes version: v1.11.0
[preflight] running pre-flight checks
I0712 10:46:30.961005   13461 kernel_validator.go:81] Validating kernel version
I0712 10:46:30.961061   13461 kernel_validator.go:96] Validating kernel config
    [WARNING SystemVerification]: docker version is greater than the most recently validated version. Docker version: 18.03.1-ce. Max validated version: 17.03
    [WARNING Hostname]: hostname &amp;quot;g2-apigateway&amp;quot; could not be reached
    [WARNING Hostname]: hostname &amp;quot;g2-apigateway&amp;quot; lookup g2-apigateway on 100.100.2.138:53: no such host
[preflight/images] Pulling images required for setting up a Kubernetes cluster
[preflight/images] This might take a minute or two, depending on the speed of your internet connection
[preflight/images] You can also perform this action in beforehand using &#39;kubeadm config images pull&#39;
[kubelet] Writing kubelet environment file with flags to file &amp;quot;/var/lib/kubelet/kubeadm-flags.env&amp;quot;
[kubelet] Writing kubelet configuration to file &amp;quot;/var/lib/kubelet/config.yaml&amp;quot;
[preflight] Activating the kubelet service
[certificates] Generated ca certificate and key.
[certificates] Generated apiserver certificate and key.
[certificates] apiserver serving cert is signed for DNS names [g2-apigateway kubernetes kubernetes.default kubernetes.default.svc kubernetes.default.svc.cluster.local] and IPs [10.96.0.1 172.16.8.62]
[certificates] Generated apiserver-kubelet-client certificate and key.
[certificates] Generated sa key and public key.
[certificates] Generated front-proxy-ca certificate and key.
[certificates] Generated front-proxy-client certificate and key.
[certificates] Generated etcd/ca certificate and key.
[certificates] Generated etcd/server certificate and key.
[certificates] etcd/server serving cert is signed for DNS names [g2-apigateway localhost] and IPs [127.0.0.1 ::1]
[certificates] Generated etcd/peer certificate and key.
[certificates] etcd/peer serving cert is signed for DNS names [g2-apigateway localhost] and IPs [172.16.8.62 127.0.0.1 ::1]
[certificates] Generated etcd/healthcheck-client certificate and key.
[certificates] Generated apiserver-etcd-client certificate and key.
[certificates] valid certificates and keys now exist in &amp;quot;/etc/kubernetes/pki&amp;quot;
[kubeconfig] Wrote KubeConfig file to disk: &amp;quot;/etc/kubernetes/admin.conf&amp;quot;
[kubeconfig] Wrote KubeConfig file to disk: &amp;quot;/etc/kubernetes/kubelet.conf&amp;quot;
[kubeconfig] Wrote KubeConfig file to disk: &amp;quot;/etc/kubernetes/controller-manager.conf&amp;quot;
[kubeconfig] Wrote KubeConfig file to disk: &amp;quot;/etc/kubernetes/scheduler.conf&amp;quot;
[controlplane] wrote Static Pod manifest for component kube-apiserver to &amp;quot;/etc/kubernetes/manifests/kube-apiserver.yaml&amp;quot;
[controlplane] wrote Static Pod manifest for component kube-controller-manager to &amp;quot;/etc/kubernetes/manifests/kube-controller-manager.yaml&amp;quot;
[controlplane] wrote Static Pod manifest for component kube-scheduler to &amp;quot;/etc/kubernetes/manifests/kube-scheduler.yaml&amp;quot;
[etcd] Wrote Static Pod manifest for a local etcd instance to &amp;quot;/etc/kubernetes/manifests/etcd.yaml&amp;quot;
[init] waiting for the kubelet to boot up the control plane as Static Pods from directory &amp;quot;/etc/kubernetes/manifests&amp;quot;
[init] this might take a minute or longer if the control plane images have to be pulled
[apiclient] All control plane components are healthy after 41.001672 seconds
[uploadconfig] storing the configuration used in ConfigMap &amp;quot;kubeadm-config&amp;quot; in the &amp;quot;kube-system&amp;quot; Namespace
[kubelet] Creating a ConfigMap &amp;quot;kubelet-config-1.11&amp;quot; in namespace kube-system with the configuration for the kubelets in the cluster
[markmaster] Marking the node g2-apigateway as master by adding the label &amp;quot;node-role.kubernetes.io/master=&#39;&#39;&amp;quot;
[markmaster] Marking the node g2-apigateway as master by adding the taints [node-role.kubernetes.io/master:NoSchedule]
[patchnode] Uploading the CRI Socket information &amp;quot;/var/run/dockershim.sock&amp;quot; to the Node API object &amp;quot;g2-apigateway&amp;quot; as an annotation
[bootstraptoken] using token: o337m9.ceq32wg9g2gro7gx
[bootstraptoken] configured RBAC rules to allow Node Bootstrap tokens to post CSRs in order for nodes to get long term certificate credentials
[bootstraptoken] configured RBAC rules to allow the csrapprover controller automatically approve CSRs from a Node Bootstrap Token
[bootstraptoken] configured RBAC rules to allow certificate rotation for all node client certificates in the cluster
[bootstraptoken] creating the &amp;quot;cluster-info&amp;quot; ConfigMap in the &amp;quot;kube-public&amp;quot; namespace
[addons] Applied essential addon: CoreDNS
[addons] Applied essential addon: kube-proxy

Your Kubernetes master has initialized successfully!

To start using your cluster, you need to run the following as a regular user:

mkdir -p $HOME/.kube
sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
sudo chown $(id -u):$(id -g) $HOME/.kube/config

You should now deploy a pod network to the cluster.
Run &amp;quot;kubectl apply -f [podnetwork].yaml&amp;quot; with one of the options listed at:
https://kubernetes.io/docs/concepts/cluster-administration/addons/

You can now join any number of machines by running the following on each node
as root:

kubeadm join 10.10.207.253:6443 --token t69z6h.lr2etdbg9mfx5r15 --discovery-token-ca-cert-hash sha256:90e3a748c0eb4cb7058f3d0ee8870ee5d746214ab0589b5e841fd5d68fec8f00
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;strong&gt;è¿™é‡Œæ³¨æ„æœ€åä¸€è¡Œï¼š&lt;/strong&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-go&#34;&gt;kubeadm join 10.10.207.253:6443 --token t69z6h.lr2etdbg9mfx5r15 --discovery-token-ca-cert-hash sha256:90e3a748c0eb4cb7058f3d0ee8870ee5d746214ab0589b5e841fd5d68fec8f00
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;è¯æ˜é›†ç¾¤ä¸»èŠ‚ç‚¹å®‰è£…æˆåŠŸï¼Œè¿™é‡Œè¦è®°å¾—ä¿å­˜è¿™æ¡å‘½ä»¤ï¼Œä»¥ä¾¿ä¹‹åå„ä¸ªèŠ‚ç‚¹åŠ å…¥é›†ç¾¤&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;é…ç½®kubetlè®¤è¯ä¿¡æ¯&lt;/strong&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;export KUBECONFIG=/etc/kubernetes/admin.conf
# å¦‚æœä½ æƒ³æŒä¹…åŒ–çš„è¯ï¼Œç›´æ¥æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ã€æ¨èã€‘
echo &amp;quot;export KUBECONFIG=/etc/kubernetes/admin.conf&amp;quot; &amp;gt;&amp;gt; ~/.bash_profile
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;strong&gt;å®‰è£…flanelç½‘ç»œ&lt;/strong&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;mkdir -p /etc/cni/net.d/

cat &amp;lt;&amp;lt;EOF&amp;gt; /etc/cni/net.d/10-flannel.conf
{
&amp;quot;name&amp;quot;: &amp;quot;cbr0&amp;quot;,
&amp;quot;type&amp;quot;: &amp;quot;flannel&amp;quot;,
&amp;quot;delegate&amp;quot;: {
&amp;quot;isDefaultGateway&amp;quot;: true
}
}
EOF

mkdir /usr/share/oci-umount/oci-umount.d -p

mkdir /run/flannel/

cat &amp;lt;&amp;lt;EOF&amp;gt; /run/flannel/subnet.env
FLANNEL_NETWORK=10.244.0.0/16
FLANNEL_SUBNET=10.244.1.0/24
FLANNEL_MTU=1450
FLANNEL_IPMASQ=true
EOF
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;strong&gt;æœ€åéœ€è¦æ–°å»ºä¸€ä¸ªflannel.ymlæ–‡ä»¶ï¼š&lt;/strong&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-yaml&#34;&gt;image:
  caption: &amp;quot;Image from: [**Pexels**](https://www.pexels.com)&amp;quot;
  focal_point: &amp;quot;&amp;quot;
  preview_only: false
---
kind: ClusterRole
apiVersion: rbac.authorization.k8s.io/v1beta1
metadata:
name: flannel
rules:
- apiGroups:
    - &amp;quot;&amp;quot;
    resources:
    - pods
    verbs:
    - get
- apiGroups:
    - &amp;quot;&amp;quot;
    resources:
    - nodes
    verbs:
    - list
    - watch
- apiGroups:
    - &amp;quot;&amp;quot;
    resources:
    - nodes/status
    verbs:
    - patch
image:
  caption: &amp;quot;Image from: [**Pexels**](https://www.pexels.com)&amp;quot;
  focal_point: &amp;quot;&amp;quot;
  preview_only: false
---
kind: ClusterRoleBinding
apiVersion: rbac.authorization.k8s.io/v1beta1
metadata:
name: flannel
roleRef:
apiGroup: rbac.authorization.k8s.io
kind: ClusterRole
name: flannel
subjects:
- kind: ServiceAccount
name: flannel
namespace: kube-system
image:
  caption: &amp;quot;Image from: [**Pexels**](https://www.pexels.com)&amp;quot;
  focal_point: &amp;quot;&amp;quot;
  preview_only: false
---
apiVersion: v1
kind: ServiceAccount
metadata:
name: flannel
namespace: kube-system
image:
  caption: &amp;quot;Image from: [**Pexels**](https://www.pexels.com)&amp;quot;
  focal_point: &amp;quot;&amp;quot;
  preview_only: false
---
kind: ConfigMap
apiVersion: v1
metadata:
name: kube-flannel-cfg
namespace: kube-system
labels:
    tier: node
    app: flannel
data:
cni-conf.json: |
    {
    &amp;quot;name&amp;quot;: &amp;quot;cbr0&amp;quot;,
    &amp;quot;type&amp;quot;: &amp;quot;flannel&amp;quot;,
    &amp;quot;delegate&amp;quot;: {
        &amp;quot;isDefaultGateway&amp;quot;: true
    }
    }
net-conf.json: |
    {
    &amp;quot;Network&amp;quot;: &amp;quot;10.10.0.0/16&amp;quot;,    #è¿™é‡Œæ¢æˆé›†ç¾¤æ‰€åœ¨çš„ç½‘æ®µ
    &amp;quot;Backend&amp;quot;: {
        &amp;quot;Type&amp;quot;: &amp;quot;vxlan&amp;quot;
    }
    }
image:
  caption: &amp;quot;Image from: [**Pexels**](https://www.pexels.com)&amp;quot;
  focal_point: &amp;quot;&amp;quot;
  preview_only: false
---
apiVersion: extensions/v1beta1
kind: DaemonSet
metadata:
name: kube-flannel-ds
namespace: kube-system
labels:
    tier: node
    app: flannel
spec:
template:
    metadata:
    labels:
        tier: node
        app: flannel
    spec:
    hostNetwork: true
    nodeSelector:
        beta.kubernetes.io/arch: amd64
    tolerations:
    - key: node-role.kubernetes.io/master
        operator: Exists
        effect: NoSchedule
    serviceAccountName: flannel
    initContainers:
    - name: install-cni
        image: quay.io/coreos/flannel:v0.9.1-amd64
        command:
        - cp
        args:
        - -f
        - /etc/kube-flannel/cni-conf.json
        - /etc/cni/net.d/10-flannel.conf
        volumeMounts:
        - name: cni
        mountPath: /etc/cni/net.d
        - name: flannel-cfg
        mountPath: /etc/kube-flannel/
    containers:
    - name: kube-flannel
        image: quay.io/coreos/flannel:v0.9.1-amd64
        command: [ &amp;quot;/opt/bin/flanneld&amp;quot;, &amp;quot;--ip-masq&amp;quot;, &amp;quot;--kube-subnet-mgr&amp;quot; ]
        securityContext:
        privileged: true
        env:
        - name: POD_NAME
        valueFrom:
            fieldRef:
            fieldPath: metadata.name
        - name: POD_NAMESPACE
        valueFrom:
            fieldRef:
            fieldPath: metadata.namespace
        volumeMounts:
        - name: run
        mountPath: /run
        - name: flannel-cfg
        mountPath: /etc/kube-flannel/
    volumes:
        - name: run
        hostPath:
            path: /run
        - name: cni
        hostPath:
            path: /etc/cni/net.d
        - name: flannel-cfg
        configMap:
            name: kube-flannel-cfg
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;strong&gt;æ‰§è¡Œï¼š&lt;/strong&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;kubectl create -f ./flannel.yml
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;é»˜è®¤æƒ…å†µä¸‹ï¼ŒmasterèŠ‚ç‚¹ä¸å‚ä¸å·¥ä½œè´Ÿè½½ï¼Œä½†å¦‚æœå¸Œæœ›å®‰è£…å‡ºä¸€ä¸ªall-in-oneçš„k8sç¯å¢ƒï¼Œåˆ™å¯ä»¥æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;è®©masterèŠ‚ç‚¹æˆä¸ºä¸€ä¸ªnodeèŠ‚ç‚¹ï¼š&lt;/strong&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;kubectl taint nodes --all node-role.kubernetes.io/master-
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;strong&gt;æŸ¥çœ‹èŠ‚ç‚¹ä¿¡æ¯ï¼š&lt;/strong&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;kubectl get nodes
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;strong&gt;ä¼šçœ‹åˆ°å¦‚ä¸‹çš„è¾“å‡ºï¼š&lt;/strong&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;NAME            STATUS     ROLES     AGE       VERSION
k8s-master      Ready      master    18h       v1.11.0
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;strong&gt;ä»¥ä¸‹æ˜¯èŠ‚ç‚¹é…ç½®&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;åœ¨é…ç½®å¥½ä¸»èŠ‚ç‚¹ä¹‹åï¼Œå°±å¯ä»¥é…ç½®é›†ç¾¤çš„å…¶ä»–èŠ‚ç‚¹äº†ï¼Œè¿™é‡Œå»ºè®®ç›´æ¥å®‰è£…ä¹‹å‰åšå¥½å‡†å¤‡å·¥ä½œçš„ç³»ç»Ÿé•œåƒ
è¿›å…¥èŠ‚ç‚¹æœºå™¨ä¹‹åï¼Œç›´æ¥æ‰§è¡Œä¹‹å‰ä¿å­˜å¥½çš„å‘½ä»¤&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;kubeadm join 10.10.207.253:6443 --token t69z6h.lr2etdbg9mfx5r15 --discovery-token-ca-cert-hash sha256:90e3a748c0eb4cb7058f3d0ee8870ee5d746214ab0589b5e841fd5d68fec8f00
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;æ‰§è¡Œå®Œåä¼šçœ‹åˆ°ï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-go&#34;&gt;[preflight] running pre-flight checks
        [WARNING RequiredIPVSKernelModulesAvailable]: the IPVS proxier will not be used, because the following required kernel modules are not loaded: [ip_vs_wrr ip_vs_sh ip_vs ip_vs_rr] or no builtin kernel ipvs support: map[ip_vs_rr:{} ip_vs_wrr:{} ip_vs_sh:{} nf_conntrack_ipv4:{} ip_vs:{}]
you can solve this problem with following methods:
1. Run &#39;modprobe -- &#39; to load missing kernel modules;
2. Provide the missing builtin kernel ipvs support

I0725 09:59:27.929247   10196 kernel_validator.go:81] Validating kernel version
I0725 09:59:27.929356   10196 kernel_validator.go:96] Validating kernel config
[discovery] Trying to connect to API Server &amp;quot;10.10.207.253:6443&amp;quot;
[discovery] Created cluster-info discovery client, requesting info from &amp;quot;https://10.10.207.253:6443&amp;quot;
[discovery] Requesting info from &amp;quot;https://10.10.207.253:6443&amp;quot; again to validate TLS against the pinned public key
[discovery] Cluster info signature and contents are valid and TLS certificate validates against pinned roots, will use API Server &amp;quot;10.10.207.253:6443&amp;quot;
[discovery] Successfully established connection with API Server &amp;quot;10.10.207.253:6443&amp;quot;
[kubelet] Downloading configuration for the kubelet from the &amp;quot;kubelet-config-1.11&amp;quot; ConfigMap in the kube-system namespace
[kubelet] Writing kubelet configuration to file &amp;quot;/var/lib/kubelet/config.yaml&amp;quot;
[kubelet] Writing kubelet environment file with flags to file &amp;quot;/var/lib/kubelet/kubeadm-flags.env&amp;quot;
[preflight] Activating the kubelet service
[tlsbootstrap] Waiting for the kubelet to perform the TLS Bootstrap...
[patchnode] Uploading the CRI Socket information &amp;quot;/var/run/dockershim.sock&amp;quot; to the Node API object &amp;quot;k8s-node1&amp;quot; as an annotation

This node has joined the cluster:
* Certificate signing request was sent to master and a response
was received.
* The Kubelet was informed of the new secure connection details.

Run &#39;kubectl get nodes&#39; on the master to see this node join the cluster.
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;strong&gt;è¿™é‡Œå°±è¡¨ç¤ºæ‰§è¡Œå®Œæ¯•äº†ï¼Œå¯ä»¥å»ä¸»èŠ‚ç‚¹æ‰§è¡Œå‘½ä»¤ï¼š&lt;/strong&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;kubectl get nodes
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;strong&gt;å¯ä»¥çœ‹åˆ°èŠ‚ç‚¹å·²åŠ å…¥é›†ç¾¤ï¼š&lt;/strong&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;NAME        STATUS    ROLES     AGE       VERSION
k8s-master  Ready     master    20h       v1.11.0
k8s-node1   Ready     &amp;lt;none&amp;gt;    20h       v1.11.0
k8s-node2   Ready     &amp;lt;none&amp;gt;    20h       v1.11.0
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;è¿™æœŸé—´å¯èƒ½éœ€è¦ç­‰å¾…ä¸€æ®µæ—¶é—´ï¼ŒçŠ¶æ€æ‰ä¼šå…¨éƒ¨å˜ä¸ºready&lt;/p&gt;

&lt;h1 id=&#34;kubernetes-dashboardå®‰è£…&#34;&gt;kubernetes-dashboardå®‰è£…&lt;/h1&gt;

&lt;p&gt;è¯¦è§ï¼š&lt;a href=&#34;https://guoxudong.io/2018/dashboard-k8s&#34;&gt;kuberneteså®‰è£…dashboard&lt;/a&gt;&lt;/p&gt;

&lt;h1 id=&#34;é‡‡å‘æŒ‡å—&#34;&gt;é‡‡å‘æŒ‡å—&lt;/h1&gt;

&lt;p&gt;æœ‰æ—¶ä¼šå‡ºç°masterèŠ‚ç‚¹ä¸€ç›´å¤„äºnotreadyçš„çŠ¶æ€ï¼Œè¿™é‡Œå¯èƒ½æ˜¯æ²¡æœ‰å¯åŠ¨flannelï¼Œåªéœ€è¦æŒ‰ç…§ä¸Šé¢çš„æ•™ç¨‹é…ç½®å¥½flannelï¼Œç„¶åæ‰§è¡Œï¼š&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;kubectl create -f ./flannel.yml
&lt;/code&gt;&lt;/pre&gt;
</description>
    </item>
    
  </channel>
</rss>
